<!DOCTYPE html>
<html lang="fr" class="no-js">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PACS de Clara & Elias</title>
    <meta name="description" content="Blog de voyage de Clara et Elias" />
    <link rel="stylesheet" type="text/css" href="./css/main.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
</head>

<body>
    <article id="bienvenue">
        <p>Bonjour, il nous faut nous connaitre pour accéder au PACS.</p>
        <button id="Go"> Accéder au test </button>
    </article>

    <article id="questionForm">
        <p id="headerQuestion"> LA QUESTION DE LA MORT QUI TUE</p>
        <div id="questionDiv">
            <p id="questionTitle"></p>
            <img id="questionImage" />
            <fieldset id="reponsesFieldset">

            </fieldset>
        </div>
    </article>

    <article id="reponseFausse">
        <p>Booouuuuuhhhhh ! Tout faux. On est sympas, tu peux réessayer !</p>
        <button id="TryAgain"> Essaye encore </button>
    </article>

    <article id="reponseVraie">
        Bravo, vous êtes invité à notre PACS.

        Celui-ci se déroulera à l'Alcazar.

        A très bientôt !
    </article>

    <script>
        window.onload = function () {

            // on recupère les questions
            $.getJSON('questions/questions-fr.json', function (questions) {
                // on récupère une question au hasard
                var i = 0;
                for (var question in questions) {
                    i++
                };

                // On affiche la question au clic sur le bouton
                $('#Go').click(function () {
                    min = Math.ceil(1);
                    max = Math.floor(i);
                    fillForm(questions[Math.floor(Math.random() * (max - min + 1)) + min]);
                });
                // On affiche la question au clic sur le bouton 
                $('#TryAgain').click(function () {
                    min = Math.ceil(1);
                    max = Math.floor(i);
                    fillForm(questions[Math.floor(Math.random() * (max - min + 1)) + min]);
                });
            });
        }

        function fillForm(question) {
            $("#reponseFausse").css("display", "none");
            $("#bienvenue").css("display", "none");
            $("#questionForm").css("display", "block");
            //nettoyage précédete question
            $('#questionTitle').empty();
            $('#questionImage').empty();
            $('#reponsesFieldset').empty();
            $("#questionImage").attr("src", "");

            // remplissage intulé question
            $('#questionTitle').html(question.question);
            // ajout image si besoin
            if (question.image) {
                $("#questionImage").attr("src", question.image);
            }
            // remplissage propositions réponses
            for (var reponse in question.reponses) {
                // TRICHEUR, OUST !!!
                var trueOrFalse = question.reponses[reponse].OK;
                $("#reponsesFieldset").append("<label><input id='reponse" + reponse + "' type='radio' name='reponseQuestion' value='" + trueOrFalse + "'>" + question.reponses[reponse].texte + "</label><br/>");
            }
            $("#reponsesFieldset").append("<br/><button id='valider'>C'est mon dernier mot !</button>");
            // On affiche la question au clic sur le bouton
            $('#valider').click(function () {
                checkReponse();
            });

            function checkReponse() {
                // JE TE VOIS BABABOUCH !!!
                var reponseValue = $("input[name='reponseQuestion']:checked").val();
                if (reponseValue) {
                    if (reponseValue == "true") {
                        $("#questionForm").css("display", "none");
                        $("#reponseVraie").css("display", "block");
                    } else {
                        $("#questionForm").css("display", "none");
                        $("#reponseFausse").css("display", "block");
                    }
                } else {
                    alert("Il faut se décider !");
                }
            }
        }

    //    });
    </script>
</body>

</html>