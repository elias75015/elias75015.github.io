/*!
 * @brief Geoportal SDK
 *
 * This software is released under the licence CeCILL-B (Free BSD compatible)
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-fr.txt
 * @see http://www.cecill.info/
 *
 * copyright CeCILL-B
 * copyright IGN
 * @author IGN
 * @version 1.0.0
 * @date 2017-12-21
 *
 */
/*!
 * OpenLayers 3. See http://openlayers.org/
 * License: https://raw.githubusercontent.com/openlayers/ol3/master/LICENSE.md
 * Version: v4.0.1
 */
/*!
 * Geoportal Extension for OpenLayers 3. See https://github.com/IGNF/geoportal-extensions
 * License: https://raw.githubusercontent.com/IGNF/geoportal-extensions/master/LICENCE.md
 * Version: v0.11.0
 */
;(function(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define([], factory);
  } else if (typeof exports === 'object') {
    module.exports = factory();
  } else {
    root.Gp = factory();
  }
}(this, function() {

/* BEGIN CODE */
var log4js, loggerCfg, UtilsLoggerByDefault, ol, gp, IMap, ol3OL3, Map, AHN;
log4js = undefined;
loggerCfg = {
    loggers: [{
            root: true,
            level: 'all',
            appenders: [{
                    type: 'Console',
                    layout: {
                        type: 'PatternLayout',
                        pattern: '%d{yyyy-MM-dd HH:mm:ss} [%p] %c - %m%n'
                    }
                }]
        }]
};
UtilsLoggerByDefault = function (Log4js, Config) {
    var LoggerByDefault = {
        getLogger: function (name) {
            Log4js.load(Config, function (error) {
                if (error) {
                    throw error;
                }
            });
            return Log4js.getLogger(name || 'default');
        }
    };
    return LoggerByDefault;
}(log4js, loggerCfg);
(function (root, factory) {
    if (typeof exports === 'object') {
        module.exports = factory();
    } else if (true) {
        ol = function () {
            return typeof factory === 'function' ? factory() : factory;
        }();
    } else {
        root.ol = factory();
    }
}(this, function () {
    var OPENLAYERS = {};
    var k, aa = this;
    function t(a, b) {
        var c = OPENLAYERS, d = a.split('.'), c = c || aa;
        d[0] in c || !c.execScript || c.execScript('var ' + d[0]);
        for (var e; d.length && (e = d.shift());)
            d.length || void 0 === b ? c[e] ? c = c[e] : c = c[e] = {} : c[e] = b;
    }
    var ba, ca;
    function da(a, b) {
        return a > b ? 1 : a < b ? -1 : 0;
    }
    function ea(a, b) {
        return 0 <= a.indexOf(b);
    }
    function fa(a, b, c) {
        var d = a.length;
        if (a[0] <= b)
            return 0;
        if (!(b <= a[d - 1]))
            if (0 < c)
                for (c = 1; c < d; ++c) {
                    if (a[c] < b)
                        return c - 1;
                }
            else if (0 > c)
                for (c = 1; c < d; ++c) {
                    if (a[c] <= b)
                        return c;
                }
            else
                for (c = 1; c < d; ++c) {
                    if (a[c] == b)
                        return c;
                    if (a[c] < b)
                        return a[c - 1] - b < b - a[c] ? c - 1 : c;
                }
        return d - 1;
    }
    function ga(a, b) {
        var c, d = Array.isArray(b) ? b : [b], e = d.length;
        for (c = 0; c < e; c++)
            a[a.length] = d[c];
    }
    function ha(a, b) {
        for (var c = a.length >>> 0, d, e = 0; e < c; e++)
            if (d = a[e], b(d, e, a))
                return d;
        return null;
    }
    function ia(a, b) {
        var c = a.length;
        if (c !== b.length)
            return !1;
        for (var d = 0; d < c; d++)
            if (a[d] !== b[d])
                return !1;
        return !0;
    }
    function ja(a) {
        var b = ka, c = a.length, d = Array(a.length), e;
        for (e = 0; e < c; e++)
            d[e] = {
                index: e,
                value: a[e]
            };
        d.sort(function (a, c) {
            return b(a.value, c.value) || a.index - c.index;
        });
        for (e = 0; e < a.length; e++)
            a[e] = d[e].value;
    }
    function la(a, b) {
        var c;
        return a.every(function (d, e) {
            c = e;
            return !b(d, e, a);
        }) ? -1 : c;
    }
    function ma(a, b) {
        var c = b || da;
        return a.every(function (b, e) {
            if (!e)
                return !0;
            var d = c(a[e - 1], b);
            return !(0 < d || 0 === d);
        });
    }
    function u(a, b) {
        a.prototype = Object.create(b.prototype);
        a.prototype.constructor = a;
    }
    function na() {
    }
    function w(a) {
        return a.ko || (a.ko = ++oa);
    }
    var oa = 0;
    function pa(a) {
        this.message = 'Assertion failed. See https://openlayers.org/en/v4.0.1/doc/errors/#' + a + ' for details.';
        this.code = a;
        this.name = 'AssertionError';
    }
    u(pa, Error);
    function qa(a, b) {
        if (!a)
            throw new pa(b);
    }
    function sa(a, b, c, d) {
        this.da = a;
        this.ba = b;
        this.fa = c;
        this.ja = d;
    }
    function ta(a, b, c) {
        return a.da <= b && b <= a.ba && a.fa <= c && c <= a.ja;
    }
    function ua(a, b) {
        return a.da == b.da && a.fa == b.fa && a.ba == b.ba && a.ja == b.ja;
    }
    function va(a, b) {
        return a.da <= b.ba && a.ba >= b.da && a.fa <= b.ja && a.ja >= b.fa;
    }
    function wa(a, b, c) {
        return Math.min(Math.max(a, b), c);
    }
    var xa = function () {
        var a;
        'cosh' in Math ? a = Math.cosh : a = function (a) {
            a = Math.exp(a);
            return (a + 1 / a) / 2;
        };
        return a;
    }();
    function ya(a) {
        qa(0 < a, 29);
        return Math.pow(2, Math.ceil(Math.log(a) / Math.LN2));
    }
    function za(a, b, c, d, e, f) {
        var g = e - c, h = f - d;
        if (g || h) {
            var l = ((a - c) * g + (b - d) * h) / (g * g + h * h);
            1 < l ? (c = e, d = f) : 0 < l && (c += g * l, d += h * l);
        }
        return Aa(a, b, c, d);
    }
    function Aa(a, b, c, d) {
        a = c - a;
        b = d - b;
        return a * a + b * b;
    }
    function Ba(a) {
        return a * Math.PI / 180;
    }
    function Ca(a, b) {
        var c = a % b;
        return 0 > c * b ? c + b : c;
    }
    function Da(a, b, c) {
        return a + c * (b - a);
    }
    function Ea(a, b, c) {
        void 0 === c && (c = [
            0,
            0
        ]);
        c[0] = a[0] + 2 * b;
        c[1] = a[1] + 2 * b;
        return c;
    }
    function Fa(a, b, c) {
        void 0 === c && (c = [
            0,
            0
        ]);
        c[0] = a[0] * b + 0.5 | 0;
        c[1] = a[1] * b + 0.5 | 0;
        return c;
    }
    function Ga(a, b) {
        if (Array.isArray(a))
            return a;
        void 0 === b ? b = [
            a,
            a
        ] : b[0] = b[1] = a;
        return b;
    }
    function Ha(a) {
        for (var b = Ia(), c = 0, d = a.length; c < d; ++c)
            Ja(b, a[c]);
        return b;
    }
    function Ka(a, b, c) {
        return c ? (c[0] = a[0] - b, c[1] = a[1] - b, c[2] = a[2] + b, c[3] = a[3] + b, c) : [
            a[0] - b,
            a[1] - b,
            a[2] + b,
            a[3] + b
        ];
    }
    function Na(a, b) {
        return b ? (b[0] = a[0], b[1] = a[1], b[2] = a[2], b[3] = a[3], b) : a.slice();
    }
    function Oa(a, b, c) {
        b = b < a[0] ? a[0] - b : a[2] < b ? b - a[2] : 0;
        a = c < a[1] ? a[1] - c : a[3] < c ? c - a[3] : 0;
        return b * b + a * a;
    }
    function Qa(a, b) {
        return Sa(a, b[0], b[1]);
    }
    function Ta(a, b) {
        return a[0] <= b[0] && b[2] <= a[2] && a[1] <= b[1] && b[3] <= a[3];
    }
    function Sa(a, b, c) {
        return a[0] <= b && b <= a[2] && a[1] <= c && c <= a[3];
    }
    function Ua(a, b) {
        var c = a[1], d = a[2], e = a[3], f = b[0], g = b[1], h = 0;
        f < a[0] ? h |= 16 : f > d && (h |= 4);
        g < c ? h |= 8 : g > e && (h |= 2);
        h || (h = 1);
        return h;
    }
    function Ia() {
        return [
            Infinity,
            Infinity,
            -Infinity,
            -Infinity
        ];
    }
    function Va(a, b, c, d, e) {
        return e ? (e[0] = a, e[1] = b, e[2] = c, e[3] = d, e) : [
            a,
            b,
            c,
            d
        ];
    }
    function Wa(a, b) {
        var c = a[0], d = a[1];
        return Va(c, d, c, d, b);
    }
    function Xa(a, b, c, d, e) {
        e = Va(Infinity, Infinity, -Infinity, -Infinity, e);
        return Ya(e, a, b, c, d);
    }
    function Za(a, b) {
        return a[0] == b[0] && a[2] == b[2] && a[1] == b[1] && a[3] == b[3];
    }
    function $a(a, b) {
        b[0] < a[0] && (a[0] = b[0]);
        b[2] > a[2] && (a[2] = b[2]);
        b[1] < a[1] && (a[1] = b[1]);
        b[3] > a[3] && (a[3] = b[3]);
        return a;
    }
    function Ja(a, b) {
        b[0] < a[0] && (a[0] = b[0]);
        b[0] > a[2] && (a[2] = b[0]);
        b[1] < a[1] && (a[1] = b[1]);
        b[1] > a[3] && (a[3] = b[1]);
    }
    function Ya(a, b, c, d, e) {
        for (; c < d; c += e) {
            var f = a, g = b[c], h = b[c + 1];
            f[0] = Math.min(f[0], g);
            f[1] = Math.min(f[1], h);
            f[2] = Math.max(f[2], g);
            f[3] = Math.max(f[3], h);
        }
        return a;
    }
    function ab(a, b, c) {
        var d;
        return (d = b.call(c, bb(a))) || (d = b.call(c, cb(a))) || (d = b.call(c, db(a))) ? d : (d = b.call(c, eb(a))) ? d : !1;
    }
    function fb(a) {
        var b = 0;
        gb(a) || (b = hb(a) * ib(a));
        return b;
    }
    function bb(a) {
        return [
            a[0],
            a[1]
        ];
    }
    function cb(a) {
        return [
            a[2],
            a[1]
        ];
    }
    function jb(a) {
        return [
            (a[0] + a[2]) / 2,
            (a[1] + a[3]) / 2
        ];
    }
    function kb(a, b, c, d, e) {
        var f = b * d[0] / 2;
        d = b * d[1] / 2;
        b = Math.cos(c);
        var g = Math.sin(c);
        c = f * b;
        f *= g;
        b *= d;
        var h = d * g, l = a[0], m = a[1];
        a = l - c + h;
        d = l - c - h;
        g = l + c - h;
        c = l + c + h;
        var h = m - f - b, l = m - f + b, p = m + f + b, f = m + f - b;
        return Va(Math.min(a, d, g, c), Math.min(h, l, p, f), Math.max(a, d, g, c), Math.max(h, l, p, f), e);
    }
    function ib(a) {
        return a[3] - a[1];
    }
    function lb(a, b, c) {
        c = c ? c : Ia();
        mb(a, b) && (c[0] = a[0] > b[0] ? a[0] : b[0], c[1] = a[1] > b[1] ? a[1] : b[1], c[2] = a[2] < b[2] ? a[2] : b[2], c[3] = a[3] < b[3] ? a[3] : b[3]);
        return c;
    }
    function eb(a) {
        return [
            a[0],
            a[3]
        ];
    }
    function db(a) {
        return [
            a[2],
            a[3]
        ];
    }
    function hb(a) {
        return a[2] - a[0];
    }
    function mb(a, b) {
        return a[0] <= b[2] && a[2] >= b[0] && a[1] <= b[3] && a[3] >= b[1];
    }
    function gb(a) {
        return a[2] < a[0] || a[3] < a[1];
    }
    function nb(a, b) {
        var c = (a[2] - a[0]) / 2 * (b - 1), d = (a[3] - a[1]) / 2 * (b - 1);
        a[0] -= c;
        a[2] += c;
        a[1] -= d;
        a[3] += d;
    }
    function ob(a, b, c) {
        a = [
            a[0],
            a[1],
            a[0],
            a[3],
            a[2],
            a[1],
            a[2],
            a[3]
        ];
        b(a, a, 2);
        var d = [
                a[0],
                a[2],
                a[4],
                a[6]
            ], e = [
                a[1],
                a[3],
                a[5],
                a[7]
            ];
        b = Math.min.apply(null, d);
        a = Math.min.apply(null, e);
        d = Math.max.apply(null, d);
        e = Math.max.apply(null, e);
        return Va(b, a, d, e, c);
    }
    var pb = 'function' === typeof Object.assign ? Object.assign : function (a, b) {
        if (!a || null === a)
            throw new TypeError('Cannot convert undefined or null to object');
        for (var c = Object(a), d = 1, e = arguments.length; d < e; ++d) {
            var f = arguments[d];
            if (void 0 !== f && null !== f)
                for (var g in f)
                    f.hasOwnProperty(g) && (c[g] = f[g]);
        }
        return c;
    };
    function qb(a) {
        for (var b in a)
            delete a[b];
    }
    function rb(a) {
        var b = [], c;
        for (c in a)
            b.push(a[c]);
        return b;
    }
    function sb(a) {
        for (var b in a)
            return !1;
        return !b;
    }
    function tb(a) {
        this.radius = a;
    }
    tb.prototype.a = function (a) {
        for (var b = 0, c = a.length, d = a[c - 1][0], e = a[c - 1][1], f = 0; f < c; f++)
            var g = a[f][0], h = a[f][1], b = b + Ba(g - d) * (2 + Math.sin(Ba(e)) + Math.sin(Ba(h))), d = g, e = h;
        return b * this.radius * this.radius / 2;
    };
    tb.prototype.b = function (a, b) {
        var c = Ba(a[1]), d = Ba(b[1]), e = (d - c) / 2, f = Ba(b[0] - a[0]) / 2, c = Math.sin(e) * Math.sin(e) + Math.sin(f) * Math.sin(f) * Math.cos(c) * Math.cos(d);
        return 2 * this.radius * Math.atan2(Math.sqrt(c), Math.sqrt(1 - c));
    };
    tb.prototype.offset = function (a, b, c) {
        var d = Ba(a[1]);
        b /= this.radius;
        var e = Math.asin(Math.sin(d) * Math.cos(b) + Math.cos(d) * Math.sin(b) * Math.cos(c));
        return [
            180 * (Ba(a[0]) + Math.atan2(Math.sin(c) * Math.sin(b) * Math.cos(d), Math.cos(b) - Math.sin(d) * Math.sin(e))) / Math.PI,
            180 * e / Math.PI
        ];
    };
    var ub = new tb(6370997);
    var vb = {};
    vb.degrees = 2 * Math.PI * ub.radius / 360;
    vb.ft = 0.3048;
    vb.m = 1;
    vb['us-ft'] = 1200 / 3937;
    var wb = null;
    function yb(a) {
        this.nb = a.code;
        this.i = a.units;
        this.c = void 0 !== a.extent ? a.extent : null;
        this.g = void 0 !== a.worldExtent ? a.worldExtent : null;
        this.b = void 0 !== a.axisOrientation ? a.axisOrientation : 'enu';
        this.f = void 0 !== a.global ? a.global : !1;
        this.a = !(!this.f || !this.c);
        this.j = a.getPointResolution;
        this.l = null;
        this.o = a.metersPerUnit;
        var b = a.code, c = wb || window.proj4;
        'function' == typeof c && (b = c.defs(b), void 0 !== b && (void 0 !== b.axis && void 0 === a.axisOrientation && (this.b = b.axis), void 0 === a.metersPerUnit && (this.o = b.to_meter), void 0 === a.units && (this.i = b.units)));
    }
    k = yb.prototype;
    k.nk = function () {
        return this.nb;
    };
    k.D = function () {
        return this.c;
    };
    k.Jb = function () {
        return this.i;
    };
    k.sc = function () {
        return this.o || vb[this.i];
    };
    k.Zk = function () {
        return this.g;
    };
    k.Kl = function () {
        return this.f;
    };
    k.pp = function (a) {
        this.f = a;
        this.a = !(!a || !this.c);
    };
    k.ln = function (a) {
        this.c = a;
        this.a = !(!this.f || !a);
    };
    k.xp = function (a) {
        this.g = a;
    };
    k.op = function (a) {
        this.j = a;
    };
    var zb = {};
    var Ab = {};
    function Bb(a, b, c) {
        a = a.nb;
        b = b.nb;
        a in Ab || (Ab[a] = {});
        Ab[a][b] = c;
    }
    function Db(a, b) {
        var c;
        a in Ab && b in Ab[a] && (c = Ab[a][b]);
        return c;
    }
    function Eb(a, b, c) {
        var d = a.j;
        d ? b = d(b, c) : 'degrees' != a.Jb() && (d = Fb(a, Gb('EPSG:4326')), b = [
            c[0] - b / 2,
            c[1],
            c[0] + b / 2,
            c[1],
            c[0],
            c[1] - b / 2,
            c[0],
            c[1] + b / 2
        ], b = d(b, b, 2), b = (ub.b(b.slice(0, 2), b.slice(2, 4)) + ub.b(b.slice(4, 6), b.slice(6, 8))) / 2, a = a.sc(), void 0 !== a && (b /= a));
        return b;
    }
    function Hb(a) {
        Ib(a);
        a.forEach(function (b) {
            a.forEach(function (a) {
                b !== a && Bb(b, a, Jb);
            });
        });
    }
    function Kb() {
        var a = Lb, b = Mb, c = Nb;
        Ob.forEach(function (d) {
            a.forEach(function (a) {
                Bb(d, a, b);
                Bb(a, d, c);
            });
        });
    }
    function Pb(a) {
        zb[a.nb] = a;
        Bb(a, a, Jb);
    }
    function Ib(a) {
        var b = [];
        a.forEach(function (a) {
            b.push(Pb(a));
        });
    }
    function Qb(a) {
        return a ? 'string' === typeof a ? Gb(a) : a : Gb('EPSG:3857');
    }
    function Rb(a, b, c, d) {
        a = Gb(a);
        b = Gb(b);
        Bb(a, b, Sb(c));
        Bb(b, a, Sb(d));
    }
    function Sb(a) {
        return function (b, c, d) {
            var e = b.length;
            d = void 0 !== d ? d : 2;
            c = void 0 !== c ? c : Array(e);
            var f, g;
            for (g = 0; g < e; g += d)
                for (f = a([
                        b[g],
                        b[g + 1]
                    ]), c[g] = f[0], c[g + 1] = f[1], f = d - 1; 2 <= f; --f)
                    c[g + f] = b[g + f];
            return c;
        };
    }
    function Gb(a) {
        var b = null;
        if (a instanceof yb)
            b = a;
        else if ('string' === typeof a) {
            var b = zb[a] || null, c = wb || window.proj4;
            b || 'function' != typeof c || void 0 === c.defs(a) || (b = new yb({ code: a }), Pb(b));
        }
        return b;
    }
    function Tb(a, b) {
        if (a === b)
            return !0;
        var c = a.Jb() === b.Jb();
        return a.nb === b.nb ? c : Fb(a, b) === Jb && c;
    }
    function Ub(a, b) {
        var c = Gb(a), d = Gb(b);
        return Fb(c, d);
    }
    function Fb(a, b) {
        var c = a.nb, d = b.nb, e = Db(c, d);
        if (!e) {
            var f = wb || window.proj4;
            if ('function' == typeof f) {
                var g = f.defs(c), h = f.defs(d);
                void 0 !== g && void 0 !== h && (g === h ? Hb([
                    b,
                    a
                ]) : (e = f(d, c), Rb(b, a, e.forward, e.inverse)), e = Db(c, d));
            }
        }
        e || (e = Vb);
        return e;
    }
    function Vb(a, b) {
        if (void 0 !== b && a !== b) {
            for (var c = 0, d = a.length; c < d; ++c)
                b[c] = a[c];
            a = b;
        }
        return a;
    }
    function Jb(a, b) {
        var c;
        if (void 0 !== b) {
            c = 0;
            for (var d = a.length; c < d; ++c)
                b[c] = a[c];
            c = b;
        } else
            c = a.slice();
        return c;
    }
    function Wb(a, b, c) {
        return Ub(b, c)(a, void 0, a.length);
    }
    function Xb(a, b, c) {
        b = Ub(b, c);
        return ob(a, b);
    }
    function Yb(a, b, c, d) {
        return void 0 !== d ? (d[0] = a, d[1] = b, d[2] = c, d) : [
            a,
            b,
            c
        ];
    }
    function Zb(a) {
        var b = a[0], c = Array(b), d = 1 << b - 1, e, f;
        for (e = 0; e < b; ++e)
            f = 48, a[1] & d && (f += 1), a[2] & d && (f += 2), c[e] = String.fromCharCode(f), d >>= 1;
        return c.join('');
    }
    function $b(a) {
        this.minZoom = void 0 !== a.minZoom ? a.minZoom : 0;
        this.b = a.resolutions;
        qa(ma(this.b, function (a, b) {
            return b - a;
        }), 17);
        this.maxZoom = this.b.length - 1;
        this.f = void 0 !== a.origin ? a.origin : null;
        this.c = null;
        void 0 !== a.origins && (this.c = a.origins, qa(this.c.length == this.b.length, 20));
        var b = a.extent;
        void 0 === b || this.f || this.c || (this.f = eb(b));
        qa(!this.f && this.c || this.f && !this.c, 18);
        this.i = null;
        void 0 !== a.tileSizes && (this.i = a.tileSizes, qa(this.i.length == this.b.length, 19));
        this.g = void 0 !== a.tileSize ? a.tileSize : this.i ? null : 256;
        qa(!this.g && this.i || this.g && !this.i, 22);
        this.v = void 0 !== b ? b : null;
        this.a = null;
        this.l = [
            0,
            0
        ];
        void 0 !== a.sizes ? this.a = a.sizes.map(function (a) {
            return new sa(Math.min(0, a[0]), Math.max(a[0] - 1, -1), Math.min(0, a[1]), Math.max(a[1] - 1, -1));
        }, this) : b && ac(this, b);
    }
    var bc = [
        0,
        0,
        0
    ];
    k = $b.prototype;
    k.eh = function (a, b, c) {
        a = cc(this, a, b);
        for (var d = a.da, e = a.ba; d <= e; ++d)
            for (var f = a.fa, g = a.ja; f <= g; ++f)
                c([
                    b,
                    d,
                    f
                ]);
    };
    function ec(a, b, c, d, e) {
        e = a.Ta(b, e);
        for (b = b[0] - 1; b >= a.minZoom;) {
            if (c.call(null, b, cc(a, e, b, d)))
                return !0;
            --b;
        }
        return !1;
    }
    k.D = function () {
        return this.v;
    };
    k.oh = function () {
        return this.maxZoom;
    };
    k.ph = function () {
        return this.minZoom;
    };
    k.Qc = function (a) {
        return this.f ? this.f : this.c[a];
    };
    k.La = function (a) {
        return this.b[a];
    };
    k.oi = function () {
        return this.b;
    };
    function fc(a, b, c, d) {
        return b[0] < a.maxZoom ? (d = a.Ta(b, d), cc(a, d, b[0] + 1, c)) : null;
    }
    function gc(a, b, c, d) {
        hc(a, b[0], b[1], c, !1, bc);
        var e = bc[1], f = bc[2];
        hc(a, b[2], b[3], c, !0, bc);
        a = bc[1];
        b = bc[2];
        void 0 !== d ? (d.da = e, d.ba = a, d.fa = f, d.ja = b) : d = new sa(e, a, f, b);
        return d;
    }
    function cc(a, b, c, d) {
        return gc(a, b, a.La(c), d);
    }
    function ic(a, b) {
        var c = a.Qc(b[0]), d = a.La(b[0]), e = Ga(a.fb(b[0]), a.l);
        return [
            c[0] + (b[1] + 0.5) * e[0] * d,
            c[1] + (b[2] + 0.5) * e[1] * d
        ];
    }
    k.Ta = function (a, b) {
        var c = this.Qc(a[0]), d = this.La(a[0]), e = Ga(this.fb(a[0]), this.l), f = c[0] + a[1] * e[0] * d, c = c[1] + a[2] * e[1] * d;
        return Va(f, c, f + e[0] * d, c + e[1] * d, b);
    };
    k.we = function (a, b, c) {
        return hc(this, a[0], a[1], b, !1, c);
    };
    function hc(a, b, c, d, e, f) {
        var g = a.Mc(d), h = d / a.La(g), l = a.Qc(g);
        a = Ga(a.fb(g), a.l);
        b = h * Math.floor((b - l[0]) / d + (e ? 0.5 : 0)) / a[0];
        c = h * Math.floor((c - l[1]) / d + (e ? 0 : 0.5)) / a[1];
        e ? (b = Math.ceil(b) - 1, c = Math.ceil(c) - 1) : (b = Math.floor(b), c = Math.floor(c));
        return Yb(g, b, c, f);
    }
    k.Pf = function (a, b, c) {
        return hc(this, a[0], a[1], this.La(b), !1, c);
    };
    k.fb = function (a) {
        return this.g ? this.g : this.i[a];
    };
    k.Mc = function (a, b) {
        return wa(fa(this.b, a, b || 0), this.minZoom, this.maxZoom);
    };
    function ac(a, b) {
        for (var c = a.b.length, d = Array(c), e = a.minZoom; e < c; ++e)
            d[e] = cc(a, b, e);
        a.a = d;
    }
    function jc(a) {
        var b = a.l;
        if (!b) {
            var b = kc(a), c = lc(b, void 0, void 0), b = new $b({
                    extent: b,
                    origin: eb(b),
                    resolutions: c,
                    tileSize: void 0
                });
            a.l = b;
        }
        return b;
    }
    function mc(a) {
        var b = {};
        pb(b, a ? a : {});
        void 0 === b.extent && (b.extent = Gb('EPSG:3857').D());
        b.resolutions = lc(b.extent, b.maxZoom, b.tileSize);
        delete b.maxZoom;
        return new $b(b);
    }
    function lc(a, b, c) {
        b = void 0 !== b ? b : 42;
        var d = ib(a);
        a = hb(a);
        c = Ga(void 0 !== c ? c : 256);
        c = Math.max(a / c[0], d / c[1]);
        b += 1;
        d = Array(b);
        for (a = 0; a < b; ++a)
            d[a] = c / Math.pow(2, a);
        return d;
    }
    function kc(a) {
        a = Gb(a);
        var b = a.D();
        b || (a = 180 * vb.degrees / a.sc(), b = Va(-a, -a, a, a));
        return b;
    }
    function nc(a) {
        this.b = a.html;
        this.a = a.tileRanges ? a.tileRanges : null;
    }
    nc.prototype.f = function () {
        return this.b;
    };
    function oc(a) {
        return function (b) {
            if (b)
                return [
                    wa(b[0], a[0], a[2]),
                    wa(b[1], a[1], a[3])
                ];
        };
    }
    function pc(a) {
        return a;
    }
    function qc(a) {
        function b(b) {
            var c = a.listener, e = a.Vg || a.target;
            a.Xg && rc(a);
            return c.call(e, b);
        }
        return a.Wg = b;
    }
    function sc(a, b, c, d) {
        for (var e, f = 0, g = a.length; f < g; ++f)
            if (e = a[f], e.listener === b && e.Vg === c)
                return d && (e.deleteIndex = f), e;
    }
    function tc(a, b) {
        var c = a.eb;
        return c ? c[b] : void 0;
    }
    function uc(a) {
        var b = a.eb;
        b || (b = a.eb = {});
        return b;
    }
    function vc(a, b) {
        var c = tc(a, b);
        if (c) {
            for (var d = 0, e = c.length; d < e; ++d)
                a.removeEventListener(b, c[d].Wg), qb(c[d]);
            c.length = 0;
            if (c = a.eb)
                delete c[b], Object.keys(c).length || delete a.eb;
        }
    }
    function B(a, b, c, d, e) {
        var f = uc(a), g = f[b];
        g || (g = f[b] = []);
        (f = sc(g, c, d, !1)) ? e || (f.Xg = !1) : (f = {
            Vg: d,
            Xg: !!e,
            listener: c,
            target: a,
            type: b
        }, a.addEventListener(b, qc(f)), g.push(f));
        return f;
    }
    function wc(a, b, c, d) {
        return B(a, b, c, d, !0);
    }
    function xc(a, b, c, d) {
        (a = tc(a, b)) && (c = sc(a, c, d, !0)) && rc(c);
    }
    function rc(a) {
        if (a && a.target) {
            a.target.removeEventListener(a.type, a.Wg);
            var b = tc(a.target, a.type);
            if (b) {
                var c = 'deleteIndex' in a ? a.deleteIndex : b.indexOf(a);
                -1 !== c && b.splice(c, 1);
                b.length || vc(a.target, a.type);
            }
            qb(a);
        }
    }
    function yc(a) {
        var b = uc(a), c;
        for (c in b)
            vc(a, c);
    }
    function zc() {
    }
    zc.prototype.Zb = !1;
    function Ac(a) {
        a.Zb || (a.Zb = !0, a.ra());
    }
    zc.prototype.ra = na;
    function Bc(a) {
        this.type = a;
        this.target = null;
    }
    Bc.prototype.preventDefault = Bc.prototype.stopPropagation = function () {
        this.Fo = !0;
    };
    function Cc(a) {
        a.stopPropagation();
    }
    function Dc() {
        this.$a = {};
        this.ta = {};
        this.qa = {};
    }
    u(Dc, zc);
    Dc.prototype.addEventListener = function (a, b) {
        var c = this.qa[a];
        c || (c = this.qa[a] = []);
        -1 === c.indexOf(b) && c.push(b);
    };
    Dc.prototype.b = function (a) {
        var b = 'string' === typeof a ? new Bc(a) : a;
        a = b.type;
        b.target = this;
        var c = this.qa[a], d;
        if (c) {
            a in this.ta || (this.ta[a] = 0, this.$a[a] = 0);
            ++this.ta[a];
            for (var e = 0, f = c.length; e < f; ++e)
                if (!1 === c[e].call(this, b) || b.Fo) {
                    d = !1;
                    break;
                }
            --this.ta[a];
            if (!this.ta[a]) {
                b = this.$a[a];
                for (delete this.$a[a]; b--;)
                    this.removeEventListener(a, na);
                delete this.ta[a];
            }
            return d;
        }
    };
    Dc.prototype.ra = function () {
        yc(this);
    };
    function Ec(a, b) {
        return b ? b in a.qa : 0 < Object.keys(a.qa).length;
    }
    Dc.prototype.removeEventListener = function (a, b) {
        var c = this.qa[a];
        if (c) {
            var d = c.indexOf(b);
            a in this.$a ? (c[d] = na, ++this.$a[a]) : (c.splice(d, 1), c.length || delete this.qa[a]);
        }
    };
    function Fc() {
        Dc.call(this);
        this.f = 0;
    }
    u(Fc, Dc);
    k = Fc.prototype;
    k.s = function () {
        ++this.f;
        this.b('change');
    };
    k.L = function () {
        return this.f;
    };
    k.J = function (a, b, c) {
        if (Array.isArray(a)) {
            for (var d = a.length, e = Array(d), f = 0; f < d; ++f)
                e[f] = B(this, a[f], b, c);
            return e;
        }
        return B(this, a, b, c);
    };
    k.once = function (a, b, c) {
        if (Array.isArray(a)) {
            for (var d = a.length, e = Array(d), f = 0; f < d; ++f)
                e[f] = wc(this, a[f], b, c);
            return e;
        }
        return wc(this, a, b, c);
    };
    k.K = function (a, b, c) {
        if (Array.isArray(a))
            for (var d = 0, e = a.length; d < e; ++d)
                xc(this, a[d], b, c);
        else
            xc(this, a, b, c);
    };
    function Gc(a) {
        Fc.call(this);
        w(this);
        this.I = {};
        void 0 !== a && this.H(a);
    }
    u(Gc, Fc);
    var Hc = {};
    function Ic(a) {
        return Hc.hasOwnProperty(a) ? Hc[a] : Hc[a] = 'change:' + a;
    }
    k = Gc.prototype;
    k.get = function (a) {
        var b;
        this.I.hasOwnProperty(a) && (b = this.I[a]);
        return b;
    };
    k.O = function () {
        return Object.keys(this.I);
    };
    k.N = function () {
        return pb({}, this.I);
    };
    function Jc(a, b, c) {
        var d;
        d = Ic(b);
        a.b(new Kc(d, b, c));
        a.b(new Kc('propertychange', b, c));
    }
    k.set = function (a, b, c) {
        c ? this.I[a] = b : (c = this.I[a], this.I[a] = b, c !== b && Jc(this, a, c));
    };
    k.H = function (a, b) {
        for (var c in a)
            this.set(c, a[c], b);
    };
    k.P = function (a, b) {
        if (a in this.I) {
            var c = this.I[a];
            delete this.I[a];
            b || Jc(this, a, c);
        }
    };
    function Kc(a, b, c) {
        Bc.call(this, a);
        this.key = b;
        this.oldValue = c;
    }
    u(Kc, Bc);
    function D(a) {
        Gc.call(this);
        this.a = a ? a : [];
        Lc(this);
    }
    u(D, Gc);
    k = D.prototype;
    k.clear = function () {
        for (; 0 < this.ec();)
            this.pop();
    };
    k.Tf = function (a) {
        var b, c;
        b = 0;
        for (c = a.length; b < c; ++b)
            this.push(a[b]);
        return this;
    };
    k.forEach = function (a, b) {
        this.a.forEach(a, b);
    };
    k.am = function () {
        return this.a;
    };
    k.item = function (a) {
        return this.a[a];
    };
    k.ec = function () {
        return this.get(Mc);
    };
    k.Be = function (a, b) {
        this.a.splice(a, 0, b);
        Lc(this);
        this.b(new Nc('add', b));
    };
    k.pop = function () {
        return this.tg(this.ec() - 1);
    };
    k.push = function (a) {
        var b = this.ec();
        this.Be(b, a);
        return this.ec();
    };
    k.remove = function (a) {
        var b = this.a, c, d;
        c = 0;
        for (d = b.length; c < d; ++c)
            if (b[c] === a)
                return this.tg(c);
    };
    k.tg = function (a) {
        var b = this.a[a];
        this.a.splice(a, 1);
        Lc(this);
        this.b(new Nc('remove', b));
        return b;
    };
    k.mp = function (a, b) {
        var c = this.ec();
        if (a < c)
            c = this.a[a], this.a[a] = b, this.b(new Nc('remove', c)), this.b(new Nc('add', b));
        else {
            for (; c < a; ++c)
                this.Be(c, void 0);
            this.Be(a, b);
        }
    };
    function Lc(a) {
        a.set(Mc, a.a.length);
    }
    var Mc = 'length';
    function Nc(a, b) {
        Bc.call(this, a);
        this.element = b;
    }
    u(Nc, Bc);
    var Oc = /^#(?:[0-9a-f]{3}){1,2}$/i, Pc = /^([a-z]*)$/i;
    function Qc(a) {
        return Array.isArray(a) ? a : Rc(a);
    }
    function Sc(a) {
        if ('string' !== typeof a) {
            var b = a[0];
            b != (b | 0) && (b = b + 0.5 | 0);
            var c = a[1];
            c != (c | 0) && (c = c + 0.5 | 0);
            var d = a[2];
            d != (d | 0) && (d = d + 0.5 | 0);
            a = 'rgba(' + b + ',' + c + ',' + d + ',' + (void 0 === a[3] ? 1 : a[3]) + ')';
        }
        return a;
    }
    var Rc = function () {
        var a = {}, b = 0;
        return function (c) {
            var d;
            if (a.hasOwnProperty(c))
                d = a[c];
            else {
                if (1024 <= b) {
                    d = 0;
                    for (var e in a)
                        d++ & 3 || (delete a[e], --b);
                }
                d = c;
                var f;
                Pc.exec(d) && (e = document.createElement('div'), e.style.color = d, document.body.appendChild(e), d = getComputedStyle(e).color, document.body.removeChild(e));
                if (Oc.exec(d)) {
                    f = d.length - 1;
                    qa(3 == f || 6 == f, 54);
                    var g = 3 == f ? 1 : 2;
                    f = parseInt(d.substr(1 + 0 * g, g), 16);
                    e = parseInt(d.substr(1 + 1 * g, g), 16);
                    d = parseInt(d.substr(1 + 2 * g, g), 16);
                    1 == g && (f = (f << 4) + f, e = (e << 4) + e, d = (d << 4) + d);
                    f = [
                        f,
                        e,
                        d,
                        1
                    ];
                } else
                    d.indexOf('rgba(') ? d.indexOf('rgb(') ? qa(!1, 14) : (d = d.slice(4, -1).split(',').map(Number), d.push(1), f = Uc(d)) : (d = d.slice(5, -1).split(',').map(Number), f = Uc(d));
                d = f;
                a[c] = d;
                ++b;
            }
            return d;
        };
    }();
    function Uc(a) {
        var b = [];
        b[0] = wa(a[0] + 0.5 | 0, 0, 255);
        b[1] = wa(a[1] + 0.5 | 0, 0, 255);
        b[2] = wa(a[2] + 0.5 | 0, 0, 255);
        b[3] = wa(a[3], 0, 1);
        return b;
    }
    function Vc(a) {
        return 'string' === typeof a || a instanceof CanvasPattern || a instanceof CanvasGradient ? a : Sc(a);
    }
    function Wc(a, b, c) {
        this.center = a;
        this.resolution = b;
        this.rotation = c;
    }
    function Xc(a, b) {
        var c = document.createElement('CANVAS');
        a && (c.width = a);
        b && (c.height = b);
        return c.getContext('2d');
    }
    function Yc(a, b) {
        var c = b.parentNode;
        c && c.replaceChild(a, b);
    }
    function Zc(a) {
        a && a.parentNode && a.parentNode.removeChild(a);
    }
    function ad(a) {
        Gc.call(this);
        this.element = a.element ? a.element : null;
        this.a = this.S = null;
        this.v = [];
        this.render = a.render ? a.render : na;
        a.target && this.i(a.target);
    }
    u(ad, Gc);
    ad.prototype.ra = function () {
        Zc(this.element);
        Gc.prototype.ra.call(this);
    };
    ad.prototype.g = function () {
        return this.a;
    };
    ad.prototype.setMap = function (a) {
        this.a && Zc(this.element);
        for (var b = 0, c = this.v.length; b < c; ++b)
            rc(this.v[b]);
        this.v.length = 0;
        if (this.a = a)
            (this.S ? this.S : a.u).appendChild(this.element), this.render !== na && this.v.push(B(a, 'postrender', this.render, this)), a.render();
    };
    ad.prototype.i = function (a) {
        this.S = 'string' === typeof a ? document.getElementById(a) : a;
    };
    function bd(a) {
        a = a ? a : {};
        this.R = document.createElement('UL');
        this.u = document.createElement('LI');
        this.R.appendChild(this.u);
        this.u.style.display = 'none';
        this.c = void 0 !== a.collapsed ? a.collapsed : !0;
        this.j = void 0 !== a.collapsible ? a.collapsible : !0;
        this.j || (this.c = !1);
        var b = void 0 !== a.className ? a.className : 'ol-attribution', c = void 0 !== a.tipLabel ? a.tipLabel : 'Attributions', d = void 0 !== a.collapseLabel ? a.collapseLabel : '\xBB';
        'string' === typeof d ? (this.A = document.createElement('span'), this.A.textContent = d) : this.A = d;
        d = void 0 !== a.label ? a.label : 'i';
        'string' === typeof d ? (this.C = document.createElement('span'), this.C.textContent = d) : this.C = d;
        var e = this.j && !this.c ? this.A : this.C, d = document.createElement('button');
        d.setAttribute('type', 'button');
        d.title = c;
        d.appendChild(e);
        B(d, 'click', this.ym, this);
        c = document.createElement('div');
        c.className = b + ' ol-unselectable ol-control' + (this.c && this.j ? ' ol-collapsed' : '') + (this.j ? '' : ' ol-uncollapsible');
        c.appendChild(this.R);
        c.appendChild(d);
        ad.call(this, {
            element: c,
            render: a.render ? a.render : cd,
            target: a.target
        });
        this.G = !0;
        this.o = {};
        this.l = {};
        this.Y = {};
    }
    u(bd, ad);
    function cd(a) {
        if (a = a.frameState) {
            var b, c, d, e, f, g, h, l, m, p, n, q = a.layerStatesArray, r = pb({}, a.attributions), v = {}, x = {}, y = a.viewState.projection;
            c = 0;
            for (b = q.length; c < b; c++)
                if (g = q[c].layer.la())
                    if (p = w(g).toString(), m = g.l)
                        for (d = 0, e = m.length; d < e; d++)
                            if (h = m[d], l = w(h).toString(), !(l in r)) {
                                if (f = a.usedTiles[p]) {
                                    var z = g.Ib(y);
                                    a: {
                                        n = void 0;
                                        var A, V, Pa = h, ra = z, La = y;
                                        if (Pa.a) {
                                            for (n in f)
                                                if (n in Pa.a) {
                                                    var z = f[n], C;
                                                    V = 0;
                                                    for (A = Pa.a[n].length; V < A; ++V) {
                                                        C = Pa.a[n][V];
                                                        if (va(C, z)) {
                                                            n = !0;
                                                            break a;
                                                        }
                                                        var Ma = cc(ra, kc(La), parseInt(n, 10)), xb = Ma.ba - Ma.da + 1;
                                                        if (z.da < Ma.da || z.ba > Ma.ba)
                                                            if (va(C, new sa(Ca(z.da, xb), Ca(z.ba, xb), z.fa, z.ja)) || z.ba - z.da + 1 > xb && va(C, Ma)) {
                                                                n = !0;
                                                                break a;
                                                            }
                                                    }
                                                }
                                            n = !1;
                                        } else
                                            n = !0;
                                    }
                                } else
                                    n = !1;
                                n ? (l in v && delete v[l], n = h.b, n in x || (x[n] = !0, r[l] = h)) : v[l] = h;
                            }
            b = [
                r,
                v
            ];
            c = b[0];
            b = b[1];
            for (var Z in this.o)
                Z in c ? (this.l[Z] || (this.o[Z].style.display = '', this.l[Z] = !0), delete c[Z]) : Z in b ? (this.l[Z] && (this.o[Z].style.display = 'none', delete this.l[Z]), delete b[Z]) : (Zc(this.o[Z]), delete this.o[Z], delete this.l[Z]);
            for (Z in c)
                d = document.createElement('LI'), d.innerHTML = c[Z].b, this.R.appendChild(d), this.o[Z] = d, this.l[Z] = !0;
            for (Z in b)
                d = document.createElement('LI'), d.innerHTML = b[Z].b, d.style.display = 'none', this.R.appendChild(d), this.o[Z] = d;
            Z = !sb(this.l) || !sb(a.logos);
            this.G != Z && (this.element.style.display = Z ? '' : 'none', this.G = Z);
            Z && sb(this.l) ? this.element.classList.add('ol-logo-only') : this.element.classList.remove('ol-logo-only');
            var Ra;
            a = a.logos;
            Z = this.Y;
            for (Ra in Z)
                Ra in a || (Zc(Z[Ra]), delete Z[Ra]);
            for (var Cb in a)
                b = a[Cb], b instanceof HTMLElement && (this.u.appendChild(b), Z[Cb] = b), Cb in Z || (Ra = new Image(), Ra.src = Cb, '' === b ? c = Ra : (c = document.createElement('a'), c.href = b, c.appendChild(Ra)), this.u.appendChild(c), Z[Cb] = c);
            this.u.style.display = sb(a) ? 'none' : '';
        } else
            this.G && (this.element.style.display = 'none', this.G = !1);
    }
    k = bd.prototype;
    k.ym = function (a) {
        a.preventDefault();
        dd(this);
    };
    function dd(a) {
        a.element.classList.toggle('ol-collapsed');
        a.c ? Yc(a.A, a.C) : Yc(a.C, a.A);
        a.c = !a.c;
    }
    k.xm = function () {
        return this.j;
    };
    k.Am = function (a) {
        this.j !== a && (this.j = a, this.element.classList.toggle('ol-uncollapsible'), !a && this.c && dd(this));
    };
    k.zm = function (a) {
        this.j && this.c !== a && dd(this);
    };
    k.wm = function () {
        return this.c;
    };
    function ed(a) {
        return Math.pow(a, 3);
    }
    function fd(a) {
        return 1 - ed(1 - a);
    }
    function gd(a) {
        return 3 * a * a - 2 * a * a * a;
    }
    function hd(a) {
        return a;
    }
    function id(a) {
        a = a ? a : {};
        var b = void 0 !== a.className ? a.className : 'ol-rotate', c = void 0 !== a.label ? a.label : '\u21E7';
        this.c = null;
        'string' === typeof c ? (this.c = document.createElement('span'), this.c.className = 'ol-compass', this.c.textContent = c) : (this.c = c, this.c.classList.add('ol-compass'));
        var d = a.tipLabel ? a.tipLabel : 'Reset rotation', c = document.createElement('button');
        c.className = b + '-reset';
        c.setAttribute('type', 'button');
        c.title = d;
        c.appendChild(this.c);
        B(c, 'click', id.prototype.A, this);
        d = document.createElement('div');
        d.className = b + ' ol-unselectable ol-control';
        d.appendChild(c);
        b = a.render ? a.render : jd;
        this.j = a.resetNorth ? a.resetNorth : void 0;
        ad.call(this, {
            element: d,
            render: b,
            target: a.target
        });
        this.o = void 0 !== a.duration ? a.duration : 250;
        this.l = void 0 !== a.autoHide ? a.autoHide : !0;
        this.u = void 0;
        this.l && this.element.classList.add('ol-hidden');
    }
    u(id, ad);
    id.prototype.A = function (a) {
        a.preventDefault();
        if (this.j)
            this.j();
        else if (a = this.a.$()) {
            var b = a.Va();
            void 0 !== b && (0 < this.o ? (b %= 2 * Math.PI, a.animate({
                rotation: 0,
                duration: this.o,
                easing: fd
            })) : a.He(0));
        }
    };
    function jd(a) {
        if (a = a.frameState) {
            a = a.viewState.rotation;
            if (a != this.u) {
                var b = 'rotate(' + a + 'rad)';
                if (this.l) {
                    var c = this.element.classList.contains('ol-hidden');
                    c || a ? c && a && this.element.classList.remove('ol-hidden') : this.element.classList.add('ol-hidden');
                }
                this.c.style.msTransform = b;
                this.c.style.webkitTransform = b;
                this.c.style.transform = b;
            }
            this.u = a;
        }
    }
    function kd(a) {
        a = a ? a : {};
        var b = void 0 !== a.className ? a.className : 'ol-zoom', c = void 0 !== a.delta ? a.delta : 1, d = void 0 !== a.zoomInLabel ? a.zoomInLabel : '+', e = void 0 !== a.zoomOutLabel ? a.zoomOutLabel : '\u2212', f = void 0 !== a.zoomInTipLabel ? a.zoomInTipLabel : 'Zoom in', g = void 0 !== a.zoomOutTipLabel ? a.zoomOutTipLabel : 'Zoom out', h = document.createElement('button');
        h.className = b + '-in';
        h.setAttribute('type', 'button');
        h.title = f;
        h.appendChild('string' === typeof d ? document.createTextNode(d) : d);
        B(h, 'click', kd.prototype.l.bind(this, c));
        d = document.createElement('button');
        d.className = b + '-out';
        d.setAttribute('type', 'button');
        d.title = g;
        d.appendChild('string' === typeof e ? document.createTextNode(e) : e);
        B(d, 'click', kd.prototype.l.bind(this, -c));
        c = document.createElement('div');
        c.className = b + ' ol-unselectable ol-control';
        c.appendChild(h);
        c.appendChild(d);
        ad.call(this, {
            element: c,
            target: a.target
        });
        this.c = void 0 !== a.duration ? a.duration : 250;
    }
    u(kd, ad);
    kd.prototype.l = function (a, b) {
        b.preventDefault();
        var c = this.a.$();
        if (c) {
            var d = c.Ua();
            d && (d = c.constrainResolution(d, a), 0 < this.c ? (0 < ld(c)[0] && md(c), c.animate({
                resolution: d,
                duration: this.c,
                easing: fd
            })) : c.Xc(d));
        }
    };
    function nd(a) {
        a = a ? a : {};
        var b = new D();
        (void 0 !== a.zoom ? a.zoom : 1) && b.push(new kd(a.zoomOptions));
        (void 0 !== a.rotate ? a.rotate : 1) && b.push(new id(a.rotateOptions));
        (void 0 !== a.attribution ? a.attribution : 1) && b.push(new bd(a.attributionOptions));
        return b;
    }
    function od(a) {
        a = a ? a : {};
        this.c = void 0 !== a.className ? a.className : 'ol-full-screen';
        var b = void 0 !== a.label ? a.label : '\u2922';
        this.j = 'string' === typeof b ? document.createTextNode(b) : b;
        b = void 0 !== a.labelActive ? a.labelActive : '\xD7';
        this.o = 'string' === typeof b ? document.createTextNode(b) : b;
        var c = a.tipLabel ? a.tipLabel : 'Toggle full-screen', b = document.createElement('button');
        b.className = this.c + '-' + pd();
        b.setAttribute('type', 'button');
        b.title = c;
        b.appendChild(this.j);
        B(b, 'click', this.C, this);
        c = document.createElement('div');
        c.className = this.c + ' ol-unselectable ol-control ' + (qd() ? '' : 'ol-unsupported');
        c.appendChild(b);
        ad.call(this, {
            element: c,
            target: a.target
        });
        this.A = void 0 !== a.keys ? a.keys : !1;
        this.l = a.source;
    }
    u(od, ad);
    od.prototype.C = function (a) {
        a.preventDefault();
        qd() && (a = this.a) && (pd() ? document.exitFullscreen ? document.exitFullscreen() : document.msExitFullscreen ? document.msExitFullscreen() : document.mozCancelFullScreen ? document.mozCancelFullScreen() : document.webkitExitFullscreen && document.webkitExitFullscreen() : (a = this.l ? 'string' === typeof this.l ? document.getElementById(this.l) : this.l : a.Kc(), this.A ? a.mozRequestFullScreenWithKeys ? a.mozRequestFullScreenWithKeys() : a.webkitRequestFullscreen ? a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT) : rd(a) : rd(a)));
    };
    od.prototype.u = function () {
        var a = this.element.firstElementChild, b = this.a;
        pd() ? (a.className = this.c + '-true', Yc(this.o, this.j)) : (a.className = this.c + '-false', Yc(this.j, this.o));
        b && b.xd();
    };
    od.prototype.setMap = function (a) {
        ad.prototype.setMap.call(this, a);
        a && this.v.push(B(document, sd(), this.u, this));
    };
    function qd() {
        var a = document.body;
        return !!(a.webkitRequestFullscreen || a.mozRequestFullScreen && document.mozFullScreenEnabled || a.msRequestFullscreen && document.msFullscreenEnabled || a.requestFullscreen && document.fullscreenEnabled);
    }
    function pd() {
        return !!(document.webkitIsFullScreen || document.mozFullScreen || document.msFullscreenElement || document.fullscreenElement);
    }
    function rd(a) {
        a.requestFullscreen ? a.requestFullscreen() : a.msRequestFullscreen ? a.msRequestFullscreen() : a.mozRequestFullScreen ? a.mozRequestFullScreen() : a.webkitRequestFullscreen && a.webkitRequestFullscreen();
    }
    var sd = function () {
        var a;
        return function () {
            if (!a) {
                var b = document.body;
                b.webkitRequestFullscreen ? a = 'webkitfullscreenchange' : b.mozRequestFullScreen ? a = 'mozfullscreenchange' : b.msRequestFullscreen ? a = 'MSFullscreenChange' : b.requestFullscreen && (a = 'fullscreenchange');
            }
            return a;
        };
    }();
    function td(a) {
        a = a ? a : {};
        var b = document.createElement('DIV');
        b.className = void 0 !== a.className ? a.className : 'ol-mouse-position';
        ad.call(this, {
            element: b,
            render: a.render ? a.render : ud,
            target: a.target
        });
        B(this, Ic(vd), this.Bm, this);
        a.coordinateFormat && this.Fi(a.coordinateFormat);
        a.projection && this.Mh(Gb(a.projection));
        this.u = void 0 !== a.undefinedHTML ? a.undefinedHTML : '';
        this.o = b.innerHTML;
        this.j = this.l = this.c = null;
    }
    u(td, ad);
    function ud(a) {
        a = a.frameState;
        a ? this.c != a.viewState.projection && (this.c = a.viewState.projection, this.l = null) : this.c = null;
        wd(this, this.j);
    }
    k = td.prototype;
    k.Bm = function () {
        this.l = null;
    };
    k.ih = function () {
        return this.get(xd);
    };
    k.Lh = function () {
        return this.get(vd);
    };
    k.rl = function (a) {
        this.j = this.a.te(a);
        wd(this, this.j);
    };
    k.sl = function () {
        wd(this, null);
        this.j = null;
    };
    k.setMap = function (a) {
        ad.prototype.setMap.call(this, a);
        a && (a = a.c, this.v.push(B(a, 'mousemove', this.rl, this), B(a, 'mouseout', this.sl, this)));
    };
    k.Fi = function (a) {
        this.set(xd, a);
    };
    k.Mh = function (a) {
        this.set(vd, a);
    };
    function wd(a, b) {
        var c = a.u;
        if (b && a.c) {
            if (!a.l) {
                var d = a.Lh();
                a.l = d ? Fb(a.c, d) : Vb;
            }
            if (d = a.a.Za(b))
                a.l(d, d), c = (c = a.ih()) ? c(d) : d.toString();
        }
        a.o && c == a.o || (a.element.innerHTML = c, a.o = c);
    }
    var vd = 'projection', xd = 'coordinateFormat';
    function yd(a, b, c) {
        Bc.call(this, a);
        this.map = b;
        this.frameState = void 0 !== c ? c : null;
    }
    u(yd, Bc);
    function zd(a, b, c, d, e) {
        yd.call(this, a, b, e);
        this.originalEvent = c;
        this.pixel = b.te(c);
        this.coordinate = b.Za(this.pixel);
        this.dragging = void 0 !== d ? d : !1;
    }
    u(zd, yd);
    zd.prototype.preventDefault = function () {
        yd.prototype.preventDefault.call(this);
        this.originalEvent.preventDefault();
    };
    zd.prototype.stopPropagation = function () {
        yd.prototype.stopPropagation.call(this);
        this.originalEvent.stopPropagation();
    };
    var Ad = {
        Xp: 'singleclick',
        Mp: 'click',
        Np: 'dblclick',
        Qp: 'pointerdrag',
        Tp: 'pointermove',
        Pp: 'pointerdown',
        Wp: 'pointerup',
        Vp: 'pointerover',
        Up: 'pointerout',
        Rp: 'pointerenter',
        Sp: 'pointerleave',
        Op: 'pointercancel'
    };
    function Bd(a, b, c, d, e) {
        zd.call(this, a, b, c.b, d, e);
        this.b = c;
    }
    u(Bd, zd);
    var Cd = [
        'experimental-webgl',
        'webgl',
        'webkit-3d',
        'moz-webgl'
    ];
    function Dd(a, b) {
        var c, d, e = Cd.length;
        for (d = 0; d < e; ++d)
            try {
                if (c = a.getContext(Cd[d], b))
                    return c;
            } catch (f) {
            }
        return null;
    }
    var Ed, Fd = 'undefined' !== typeof navigator ? navigator.userAgent.toLowerCase() : '', Gd = -1 !== Fd.indexOf('firefox'), Hd = -1 !== Fd.indexOf('safari') && -1 == Fd.indexOf('chrom'), Id = -1 !== Fd.indexOf('webkit') && -1 == Fd.indexOf('edge'), Jd = -1 !== Fd.indexOf('macintosh'), Kd = window.devicePixelRatio || 1, Ld = !1, Md = function () {
            if (!('HTMLCanvasElement' in window))
                return !1;
            try {
                var a = document.createElement('CANVAS').getContext('2d');
                return a ? (void 0 !== a.setLineDash && (Ld = !0), !0) : !1;
            } catch (b) {
                return !1;
            }
        }(), Nd = 'DeviceOrientationEvent' in window, Od = 'geolocation' in navigator, Pd = 'ontouchstart' in window, Qd = 'PointerEvent' in window, Rd = !!navigator.msPointerEnabled, Sd = !1, Td, Ud = [];
    if ('WebGLRenderingContext' in window)
        try {
            var Vd = Dd(document.createElement('CANVAS'), { failIfMajorPerformanceCaveat: !0 });
            Vd && (Sd = !0, Td = Vd.getParameter(Vd.MAX_TEXTURE_SIZE), Ud = Vd.getSupportedExtensions());
        } catch (a) {
        }
    Ed = Sd;
    ca = Ud;
    ba = Td;
    function Wd(a, b) {
        this.b = a;
        this.i = b;
    }
    function Xd(a) {
        Wd.call(this, a, {
            mousedown: this.Ml,
            mousemove: this.Nl,
            mouseup: this.Ql,
            mouseover: this.Pl,
            mouseout: this.Ol
        });
        this.a = a.f;
        this.f = [];
    }
    u(Xd, Wd);
    function Yd(a, b) {
        for (var c = a.f, d = b.clientX, e = b.clientY, f = 0, g = c.length, h; f < g && (h = c[f]); f++) {
            var l = Math.abs(e - h[1]);
            if (25 >= Math.abs(d - h[0]) && 25 >= l)
                return !0;
        }
        return !1;
    }
    function Zd(a) {
        var b = ae(a, a), c = b.preventDefault;
        b.preventDefault = function () {
            a.preventDefault();
            c();
        };
        b.pointerId = 1;
        b.isPrimary = !0;
        b.pointerType = 'mouse';
        return b;
    }
    k = Xd.prototype;
    k.Ml = function (a) {
        if (!Yd(this, a)) {
            1 .toString() in this.a && this.cancel(a);
            var b = Zd(a);
            this.a[1 .toString()] = a;
            be(this.b, 'pointerdown', b, a);
        }
    };
    k.Nl = function (a) {
        if (!Yd(this, a)) {
            var b = Zd(a);
            be(this.b, 'pointermove', b, a);
        }
    };
    k.Ql = function (a) {
        if (!Yd(this, a)) {
            var b = this.a[1 .toString()];
            b && b.button === a.button && (b = Zd(a), be(this.b, 'pointerup', b, a), delete this.a[1 .toString()]);
        }
    };
    k.Pl = function (a) {
        if (!Yd(this, a)) {
            var b = Zd(a);
            ce(this.b, b, a);
        }
    };
    k.Ol = function (a) {
        if (!Yd(this, a)) {
            var b = Zd(a);
            de(this.b, b, a);
        }
    };
    k.cancel = function (a) {
        var b = Zd(a);
        this.b.cancel(b, a);
        delete this.a[1 .toString()];
    };
    function ee(a) {
        Wd.call(this, a, {
            MSPointerDown: this.Vl,
            MSPointerMove: this.Wl,
            MSPointerUp: this.Zl,
            MSPointerOut: this.Xl,
            MSPointerOver: this.Yl,
            MSPointerCancel: this.Ul,
            MSGotPointerCapture: this.Sl,
            MSLostPointerCapture: this.Tl
        });
        this.a = a.f;
        this.f = [
            '',
            'unavailable',
            'touch',
            'pen',
            'mouse'
        ];
    }
    u(ee, Wd);
    function fe(a, b) {
        var c = b;
        'number' === typeof b.pointerType && (c = ae(b, b), c.pointerType = a.f[b.pointerType]);
        return c;
    }
    k = ee.prototype;
    k.Vl = function (a) {
        this.a[a.pointerId.toString()] = a;
        var b = fe(this, a);
        be(this.b, 'pointerdown', b, a);
    };
    k.Wl = function (a) {
        var b = fe(this, a);
        be(this.b, 'pointermove', b, a);
    };
    k.Zl = function (a) {
        var b = fe(this, a);
        be(this.b, 'pointerup', b, a);
        delete this.a[a.pointerId.toString()];
    };
    k.Xl = function (a) {
        var b = fe(this, a);
        de(this.b, b, a);
    };
    k.Yl = function (a) {
        var b = fe(this, a);
        ce(this.b, b, a);
    };
    k.Ul = function (a) {
        var b = fe(this, a);
        this.b.cancel(b, a);
        delete this.a[a.pointerId.toString()];
    };
    k.Tl = function (a) {
        this.b.b(new ge('lostpointercapture', a, a));
    };
    k.Sl = function (a) {
        this.b.b(new ge('gotpointercapture', a, a));
    };
    function he(a) {
        Wd.call(this, a, {
            pointerdown: this.xo,
            pointermove: this.yo,
            pointerup: this.Bo,
            pointerout: this.zo,
            pointerover: this.Ao,
            pointercancel: this.wo,
            gotpointercapture: this.al,
            lostpointercapture: this.Ll
        });
    }
    u(he, Wd);
    k = he.prototype;
    k.xo = function (a) {
        ie(this.b, a);
    };
    k.yo = function (a) {
        ie(this.b, a);
    };
    k.Bo = function (a) {
        ie(this.b, a);
    };
    k.zo = function (a) {
        ie(this.b, a);
    };
    k.Ao = function (a) {
        ie(this.b, a);
    };
    k.wo = function (a) {
        ie(this.b, a);
    };
    k.Ll = function (a) {
        ie(this.b, a);
    };
    k.al = function (a) {
        ie(this.b, a);
    };
    function ge(a, b, c) {
        Bc.call(this, a);
        this.b = b;
        a = c ? c : {};
        this.buttons = je(a);
        this.pressure = ke(a, this.buttons);
        this.bubbles = 'bubbles' in a ? a.bubbles : !1;
        this.cancelable = 'cancelable' in a ? a.cancelable : !1;
        this.view = 'view' in a ? a.view : null;
        this.detail = 'detail' in a ? a.detail : null;
        this.screenX = 'screenX' in a ? a.screenX : 0;
        this.screenY = 'screenY' in a ? a.screenY : 0;
        this.clientX = 'clientX' in a ? a.clientX : 0;
        this.clientY = 'clientY' in a ? a.clientY : 0;
        this.button = 'button' in a ? a.button : 0;
        this.relatedTarget = 'relatedTarget' in a ? a.relatedTarget : null;
        this.pointerId = 'pointerId' in a ? a.pointerId : 0;
        this.width = 'width' in a ? a.width : 0;
        this.height = 'height' in a ? a.height : 0;
        this.pointerType = 'pointerType' in a ? a.pointerType : '';
        this.isPrimary = 'isPrimary' in a ? a.isPrimary : !1;
        b.preventDefault && (this.preventDefault = function () {
            b.preventDefault();
        });
    }
    u(ge, Bc);
    function je(a) {
        if (a.buttons || le)
            a = a.buttons;
        else
            switch (a.which) {
            case 1:
                a = 1;
                break;
            case 2:
                a = 4;
                break;
            case 3:
                a = 2;
                break;
            default:
                a = 0;
            }
        return a;
    }
    function ke(a, b) {
        var c = 0;
        a.pressure ? c = a.pressure : c = b ? 0.5 : 0;
        return c;
    }
    var le = !1;
    try {
        le = 1 === new MouseEvent('click', { buttons: 1 }).buttons;
    } catch (a) {
    }
    function me(a, b) {
        Wd.call(this, a, {
            touchstart: this.Dp,
            touchmove: this.Cp,
            touchend: this.Bp,
            touchcancel: this.Ap
        });
        this.a = a.f;
        this.l = b;
        this.f = void 0;
        this.g = 0;
        this.c = void 0;
    }
    u(me, Wd);
    k = me.prototype;
    k.Di = function () {
        this.g = 0;
        this.c = void 0;
    };
    function ne(a, b, c) {
        b = ae(b, c);
        b.pointerId = c.identifier + 2;
        b.bubbles = !0;
        b.cancelable = !0;
        b.detail = a.g;
        b.button = 0;
        b.buttons = 1;
        b.width = c.webkitRadiusX || c.radiusX || 0;
        b.height = c.webkitRadiusY || c.radiusY || 0;
        b.pressure = c.webkitForce || c.force || 0.5;
        b.isPrimary = a.f === c.identifier;
        b.pointerType = 'touch';
        b.clientX = c.clientX;
        b.clientY = c.clientY;
        b.screenX = c.screenX;
        b.screenY = c.screenY;
        return b;
    }
    function oe(a, b, c) {
        function d() {
            b.preventDefault();
        }
        var e = Array.prototype.slice.call(b.changedTouches), f = e.length, g, h;
        for (g = 0; g < f; ++g)
            h = ne(a, b, e[g]), h.preventDefault = d, c.call(a, b, h);
    }
    k.Dp = function (a) {
        var b = a.touches, c = Object.keys(this.a), d = c.length;
        if (d >= b.length) {
            var e = [], f, g, h;
            for (f = 0; f < d; ++f) {
                g = c[f];
                h = this.a[g];
                var l;
                if (!(l = 1 == g))
                    a: {
                        for (var m = b.length, p = 0; p < m; p++)
                            if (l = b[p], l.identifier === g - 2) {
                                l = !0;
                                break a;
                            }
                        l = !1;
                    }
                l || e.push(h.out);
            }
            for (f = 0; f < e.length; ++f)
                this.zf(a, e[f]);
        }
        b = a.changedTouches[0];
        c = Object.keys(this.a).length;
        if (!c || 1 === c && 1 .toString() in this.a)
            this.f = b.identifier, void 0 !== this.c && clearTimeout(this.c);
        pe(this, a);
        this.g++;
        oe(this, a, this.so);
    };
    k.so = function (a, b) {
        this.a[b.pointerId] = {
            target: b.target,
            out: b,
            pi: b.target
        };
        var c = this.b;
        b.bubbles = !0;
        be(c, 'pointerover', b, a);
        c = this.b;
        b.bubbles = !1;
        be(c, 'pointerenter', b, a);
        be(this.b, 'pointerdown', b, a);
    };
    k.Cp = function (a) {
        a.preventDefault();
        oe(this, a, this.Rl);
    };
    k.Rl = function (a, b) {
        var c = this.a[b.pointerId];
        if (c) {
            var d = c.out, e = c.pi;
            be(this.b, 'pointermove', b, a);
            d && e !== b.target && (d.relatedTarget = b.target, b.relatedTarget = e, d.target = e, b.target ? (de(this.b, d, a), ce(this.b, b, a)) : (b.target = e, b.relatedTarget = null, this.zf(a, b)));
            c.out = b;
            c.pi = b.target;
        }
    };
    k.Bp = function (a) {
        pe(this, a);
        oe(this, a, this.Ep);
    };
    k.Ep = function (a, b) {
        be(this.b, 'pointerup', b, a);
        this.b.out(b, a);
        qe(this.b, b, a);
        delete this.a[b.pointerId];
        b.isPrimary && (this.f = void 0, this.c = setTimeout(this.Di.bind(this), 200));
    };
    k.Ap = function (a) {
        oe(this, a, this.zf);
    };
    k.zf = function (a, b) {
        this.b.cancel(b, a);
        this.b.out(b, a);
        qe(this.b, b, a);
        delete this.a[b.pointerId];
        b.isPrimary && (this.f = void 0, this.c = setTimeout(this.Di.bind(this), 200));
    };
    function pe(a, b) {
        var c = a.l.f, d = b.changedTouches[0];
        if (a.f === d.identifier) {
            var e = [
                d.clientX,
                d.clientY
            ];
            c.push(e);
            setTimeout(function () {
                var a = c.indexOf(e);
                -1 < a && c.splice(a, 1);
            }, 2500);
        }
    }
    function re(a) {
        Dc.call(this);
        this.g = a;
        this.f = {};
        this.i = {};
        this.a = [];
        Qd ? se(this, new he(this)) : Rd ? se(this, new ee(this)) : (a = new Xd(this), se(this, a), Pd && se(this, new me(this, a)));
        a = this.a.length;
        for (var b, c = 0; c < a; c++)
            b = this.a[c], te(this, Object.keys(b.i));
    }
    u(re, Dc);
    function se(a, b) {
        var c = Object.keys(b.i);
        c && (c.forEach(function (a) {
            var c = b.i[a];
            c && (this.i[a] = c.bind(b));
        }, a), a.a.push(b));
    }
    re.prototype.c = function (a) {
        var b = this.i[a.type];
        b && b(a);
    };
    function te(a, b) {
        b.forEach(function (a) {
            B(this.g, a, this.c, this);
        }, a);
    }
    function ve(a, b) {
        b.forEach(function (a) {
            xc(this.g, a, this.c, this);
        }, a);
    }
    function ae(a, b) {
        for (var c = {}, d, e = 0, f = we.length; e < f; e++)
            d = we[e][0], c[d] = a[d] || b[d] || we[e][1];
        return c;
    }
    function qe(a, b, c) {
        b.bubbles = !1;
        be(a, 'pointerleave', b, c);
    }
    re.prototype.out = function (a, b) {
        a.bubbles = !0;
        be(this, 'pointerout', a, b);
    };
    re.prototype.cancel = function (a, b) {
        be(this, 'pointercancel', a, b);
    };
    function de(a, b, c) {
        a.out(b, c);
        var d = b.target, e = b.relatedTarget;
        d && e && d.contains(e) || qe(a, b, c);
    }
    function ce(a, b, c) {
        b.bubbles = !0;
        be(a, 'pointerover', b, c);
        var d = b.target, e = b.relatedTarget;
        d && e && d.contains(e) || (b.bubbles = !1, be(a, 'pointerenter', b, c));
    }
    function be(a, b, c, d) {
        a.b(new ge(b, d, c));
    }
    function ie(a, b) {
        a.b(new ge(b.type, b, b));
    }
    re.prototype.ra = function () {
        for (var a = this.a.length, b, c = 0; c < a; c++)
            b = this.a[c], ve(this, Object.keys(b.i));
        Dc.prototype.ra.call(this);
    };
    var we = [
        [
            'bubbles',
            !1
        ],
        [
            'cancelable',
            !1
        ],
        [
            'view',
            null
        ],
        [
            'detail',
            null
        ],
        [
            'screenX',
            0
        ],
        [
            'screenY',
            0
        ],
        [
            'clientX',
            0
        ],
        [
            'clientY',
            0
        ],
        [
            'ctrlKey',
            !1
        ],
        [
            'altKey',
            !1
        ],
        [
            'shiftKey',
            !1
        ],
        [
            'metaKey',
            !1
        ],
        [
            'button',
            0
        ],
        [
            'relatedTarget',
            null
        ],
        [
            'buttons',
            0
        ],
        [
            'pointerId',
            0
        ],
        [
            'width',
            0
        ],
        [
            'height',
            0
        ],
        [
            'pressure',
            0
        ],
        [
            'tiltX',
            0
        ],
        [
            'tiltY',
            0
        ],
        [
            'pointerType',
            ''
        ],
        [
            'hwTimestamp',
            0
        ],
        [
            'isPrimary',
            !1
        ],
        [
            'type',
            ''
        ],
        [
            'target',
            null
        ],
        [
            'currentTarget',
            null
        ],
        [
            'which',
            0
        ]
    ];
    function xe(a) {
        Dc.call(this);
        this.c = a;
        this.l = 0;
        this.j = !1;
        this.i = [];
        this.f = null;
        a = this.c.c;
        this.u = 0;
        this.I = {};
        this.g = new re(a);
        this.a = null;
        this.o = B(this.g, 'pointerdown', this.ul, this);
        this.v = B(this.g, 'pointermove', this.$o, this);
    }
    u(xe, Dc);
    function ye(a, b) {
        var c = new Bd('click', a.c, b);
        a.b(c);
        a.l ? (clearTimeout(a.l), a.l = 0, c = new Bd('dblclick', a.c, b), a.b(c)) : a.l = setTimeout(function () {
            this.l = 0;
            var a = new Bd('singleclick', this.c, b);
            this.b(a);
        }.bind(a), 250);
    }
    function ze(a, b) {
        'pointerup' == b.type || 'pointercancel' == b.type ? delete a.I[b.pointerId] : 'pointerdown' == b.type && (a.I[b.pointerId] = !0);
        a.u = Object.keys(a.I).length;
    }
    k = xe.prototype;
    k.vh = function (a) {
        ze(this, a);
        var b = new Bd('pointerup', this.c, a);
        this.b(b);
        this.j || a.button || ye(this, this.f);
        this.u || (this.i.forEach(rc), this.i.length = 0, this.j = !1, this.f = null, Ac(this.a), this.a = null);
    };
    k.ul = function (a) {
        ze(this, a);
        var b = new Bd('pointerdown', this.c, a);
        this.b(b);
        this.f = a;
        this.i.length || (this.a = new re(document), this.i.push(B(this.a, 'pointermove', this.om, this), B(this.a, 'pointerup', this.vh, this), B(this.g, 'pointercancel', this.vh, this)));
    };
    k.om = function (a) {
        if (a.clientX != this.f.clientX || a.clientY != this.f.clientY) {
            this.j = !0;
            var b = new Bd('pointerdrag', this.c, a, this.j);
            this.b(b);
        }
        a.preventDefault();
    };
    k.$o = function (a) {
        this.b(new Bd(a.type, this.c, a, !(!this.f || a.clientX == this.f.clientX && a.clientY == this.f.clientY)));
    };
    k.ra = function () {
        this.v && (rc(this.v), this.v = null);
        this.o && (rc(this.o), this.o = null);
        this.i.forEach(rc);
        this.i.length = 0;
        this.a && (Ac(this.a), this.a = null);
        this.g && (Ac(this.g), this.g = null);
        Dc.prototype.ra.call(this);
    };
    function Ae(a, b) {
        this.o = a;
        this.c = b;
        this.b = [];
        this.f = [];
        this.a = {};
    }
    Ae.prototype.clear = function () {
        this.b.length = 0;
        this.f.length = 0;
        qb(this.a);
    };
    function Be(a) {
        var b = a.b, c = a.f, d = b[0];
        1 == b.length ? (b.length = 0, c.length = 0) : (b[0] = b.pop(), c[0] = c.pop(), Ce(a, 0));
        b = a.c(d);
        delete a.a[b];
        return d;
    }
    Ae.prototype.i = function (a) {
        qa(!(this.c(a) in this.a), 31);
        var b = this.o(a);
        return Infinity != b ? (this.b.push(a), this.f.push(b), this.a[this.c(a)] = !0, De(this, 0, this.b.length - 1), !0) : !1;
    };
    function Ce(a, b) {
        for (var c = a.b, d = a.f, e = c.length, f = c[b], g = d[b], h = b; b < e >> 1;) {
            var l = 2 * b + 1, m = 2 * b + 2, l = m < e && d[m] < d[l] ? m : l;
            c[b] = c[l];
            d[b] = d[l];
            b = l;
        }
        c[b] = f;
        d[b] = g;
        De(a, h, b);
    }
    function De(a, b, c) {
        var d = a.b;
        a = a.f;
        for (var e = d[c], f = a[c]; c > b;) {
            var g = c - 1 >> 1;
            if (a[g] > f)
                d[c] = d[g], a[c] = a[g], c = g;
            else
                break;
        }
        d[c] = e;
        a[c] = f;
    }
    function Ee(a) {
        var b = a.o, c = a.b, d = a.f, e = 0, f = c.length, g, h, l;
        for (h = 0; h < f; ++h)
            g = c[h], l = b(g), Infinity == l ? delete a.a[a.c(g)] : (d[e] = l, c[e++] = g);
        c.length = e;
        d.length = e;
        for (b = (a.b.length >> 1) - 1; 0 <= b; b--)
            Ce(a, b);
    }
    function Fe(a, b) {
        Ae.call(this, function (b) {
            return a.apply(null, b);
        }, function (a) {
            return a[0].ib();
        });
        this.v = b;
        this.l = 0;
        this.g = {};
    }
    u(Fe, Ae);
    Fe.prototype.i = function (a) {
        var b = Ae.prototype.i.call(this, a);
        b && B(a[0], 'change', this.j, this);
        return b;
    };
    Fe.prototype.j = function (a) {
        a = a.target;
        var b = a.V();
        if (2 === b || 3 === b || 4 === b || 5 === b)
            xc(a, 'change', this.j, this), a = a.ib(), a in this.g && (delete this.g[a], --this.l), this.v();
    };
    function Ge(a, b, c) {
        for (var d = 0, e, f; a.l < b && d < c && 0 < a.b.length;)
            e = Be(a)[0], f = e.ib(), 0 !== e.V() || f in a.g || (a.g[f] = !0, ++a.l, ++d, e.load());
    }
    function He(a) {
        return function (b, c, d) {
            if (void 0 !== b)
                return b = fa(a, b, d), b = wa(b + c, 0, a.length - 1), c = Math.floor(b), b != c && c < a.length - 1 ? a[c] / Math.pow(a[c] / a[c + 1], b - c) : a[c];
        };
    }
    function Ie(a, b, c) {
        return function (d, e, f) {
            if (void 0 !== d)
                return d = Math.max(Math.floor(Math.log(b / d) / Math.log(a) + (-f / 2 + 0.5)) + e, 0), void 0 !== c && (d = Math.min(d, c)), b / Math.pow(a, d);
        };
    }
    function Ke(a) {
        if (void 0 !== a)
            return 0;
    }
    function Le(a, b) {
        if (void 0 !== a)
            return a + b;
    }
    function Me(a) {
        var b = 2 * Math.PI / a;
        return function (a, d) {
            if (void 0 !== a)
                return a = Math.floor((a + d) / b + 0.5) * b;
        };
    }
    function Ne() {
        var a = Ba(5);
        return function (b, c) {
            if (void 0 !== b)
                return Math.abs(b + c) <= a ? 0 : b + c;
        };
    }
    function Oe(a, b) {
        var c = void 0 !== b ? a.toFixed(b) : '' + a, d = c.indexOf('.'), d = -1 === d ? c.length : d;
        return 2 < d ? c : Array(3 - d).join('0') + c;
    }
    function Pe(a) {
        a = ('' + a).split('.');
        for (var b = [
                    '1',
                    '3'
                ], c = 0; c < Math.max(a.length, b.length); c++) {
            var d = parseInt(a[c] || '0', 10), e = parseInt(b[c] || '0', 10);
            if (d > e)
                return 1;
            if (e > d)
                return -1;
        }
        return 0;
    }
    function Qe(a, b) {
        a[0] += b[0];
        a[1] += b[1];
        return a;
    }
    function Re(a, b) {
        var c = a[0], d = a[1], e = b[0], f = b[1], g = e[0], e = e[1], h = f[0], f = f[1], l = h - g, m = f - e, c = l || m ? (l * (c - g) + m * (d - e)) / (l * l + m * m || 0) : 0;
        0 >= c || (1 <= c ? (g = h, e = f) : (g += c * l, e += c * m));
        return [
            g,
            e
        ];
    }
    function Se(a, b, c) {
        a = Ca(a + 180, 360) - 180;
        var d = Math.abs(3600 * a);
        c = c || 0;
        var e = Math.pow(10, c), f = Math.floor(d / 3600), g = Math.floor((d - 3600 * f) / 60), d = Math.ceil((d - 3600 * f - 60 * g) * e) / e;
        60 <= d && (d = 0, g += 1);
        60 <= g && (g = 0, f += 1);
        return f + '\xB0 ' + Oe(g) + '\u2032 ' + Oe(d, c) + '\u2033 ' + b.charAt(0 > a ? 1 : 0);
    }
    function Te(a, b, c) {
        return a ? b.replace('{x}', a[0].toFixed(c)).replace('{y}', a[1].toFixed(c)) : '';
    }
    function Ue(a, b) {
        for (var c = !0, d = a.length - 1; 0 <= d; --d)
            if (a[d] != b[d]) {
                c = !1;
                break;
            }
        return c;
    }
    function Ve(a, b) {
        var c = Math.cos(b), d = Math.sin(b), e = a[1] * c + a[0] * d;
        a[0] = a[0] * c - a[1] * d;
        a[1] = e;
        return a;
    }
    function We(a, b) {
        a[0] *= b;
        a[1] *= b;
    }
    function Xe(a, b) {
        var c = a[0] - b[0], d = a[1] - b[1];
        return c * c + d * d;
    }
    function Ye(a, b) {
        return Math.sqrt(Xe(a, b));
    }
    function Ze(a, b) {
        return Xe(a, Re(a, b));
    }
    function $e(a, b) {
        return Te(a, '{x}, {y}', b);
    }
    function af() {
        return !0;
    }
    function bf() {
        return !1;
    }
    function cf() {
        Gc.call(this);
        this.o = Ia();
        this.v = -1;
        this.i = {};
        this.j = this.g = 0;
    }
    u(cf, Gc);
    k = cf.prototype;
    k.Ab = function (a, b) {
        var c = b ? b : [
            NaN,
            NaN
        ];
        this.Gb(a[0], a[1], c, Infinity);
        return c;
    };
    k.sb = function (a) {
        return this.Oc(a[0], a[1]);
    };
    k.Oc = bf;
    k.D = function (a) {
        this.v != this.f && (this.o = this.ne(this.o), this.v = this.f);
        var b = this.o;
        a ? (a[0] = b[0], a[1] = b[1], a[2] = b[2], a[3] = b[3]) : a = b;
        return a;
    };
    k.Pb = function (a) {
        return this.Qd(a * a);
    };
    k.tb = function (a, b) {
        this.Dc(Ub(a, b));
        return this;
    };
    function df(a, b, c, d, e, f) {
        for (var g = f ? f : [], h = 0; b < c; b += d) {
            var l = a[b], m = a[b + 1];
            g[h++] = e[0] * l + e[2] * m + e[4];
            g[h++] = e[1] * l + e[3] * m + e[5];
        }
        f && g.length != h && (g.length = h);
        return g;
    }
    function ef(a, b, c, d, e, f) {
        var g = f ? f : [], h = 0, l, m;
        for (l = 0; l < b; l += c)
            for (g[h++] = a[l] + d, g[h++] = a[l + 1] + e, m = l + 2; m < l + c; ++m)
                g[h++] = a[m];
        f && g.length != h && (g.length = h);
        return g;
    }
    function ff() {
        cf.call(this);
        this.ka = 'XY';
        this.a = 2;
        this.B = null;
    }
    u(ff, cf);
    function gf(a) {
        var b;
        'XY' == a ? b = 2 : 'XYZ' == a || 'XYM' == a ? b = 3 : 'XYZM' == a && (b = 4);
        return b;
    }
    k = ff.prototype;
    k.Oc = bf;
    k.ne = function (a) {
        return Xa(this.B, 0, this.B.length, this.a, a);
    };
    k.bc = function () {
        return this.B.slice(0, this.a);
    };
    k.ha = function () {
        return this.B;
    };
    k.cc = function () {
        return this.B.slice(this.B.length - this.a);
    };
    k.dc = function () {
        return this.ka;
    };
    k.Qd = function (a) {
        this.j != this.f && (qb(this.i), this.g = 0, this.j = this.f);
        if (0 > a || this.g && a <= this.g)
            return this;
        var b = a.toString();
        if (this.i.hasOwnProperty(b))
            return this.i[b];
        var c = this.kd(a);
        if (c.ha().length < this.B.length)
            return this.i[b] = c;
        this.g = a;
        return this;
    };
    k.kd = function () {
        return this;
    };
    k.sa = function () {
        return this.a;
    };
    function hf(a, b, c) {
        a.a = gf(b);
        a.ka = b;
        a.B = c;
    }
    function jf(a, b, c, d) {
        if (b)
            c = gf(b);
        else {
            for (b = 0; b < d; ++b)
                if (c.length)
                    c = c[0];
                else {
                    a.ka = 'XY';
                    a.a = 2;
                    return;
                }
            c = c.length;
            var e;
            2 == c ? e = 'XY' : 3 == c ? e = 'XYZ' : 4 == c && (e = 'XYZM');
            b = e;
        }
        a.ka = b;
        a.a = c;
    }
    k.Dc = function (a) {
        this.B && (a(this.B, this.B, this.a), this.s());
    };
    k.rotate = function (a, b) {
        var c = this.ha();
        if (c) {
            for (var d = c.length, e = this.sa(), f = c ? c : [], g = Math.cos(a), h = Math.sin(a), l = b[0], m = b[1], p = 0, n = 0; n < d; n += e) {
                var q = c[n] - l, r = c[n + 1] - m;
                f[p++] = l + q * g - r * h;
                f[p++] = m + q * h + r * g;
                for (q = n + 2; q < n + e; ++q)
                    f[p++] = c[q];
            }
            c && f.length != p && (f.length = p);
            this.s();
        }
    };
    k.scale = function (a, b, c) {
        var d = b;
        void 0 === d && (d = a);
        var e = c;
        e || (e = jb(this.D()));
        if (c = this.ha()) {
            b = c.length;
            for (var f = this.sa(), g = c ? c : [], h = e[0], e = e[1], l = 0, m = 0; m < b; m += f) {
                var p = c[m] - h, n = c[m + 1] - e;
                g[l++] = h + a * p;
                g[l++] = e + d * n;
                for (p = m + 2; p < m + f; ++p)
                    g[l++] = c[p];
            }
            c && g.length != l && (g.length = l);
            this.s();
        }
    };
    k.translate = function (a, b) {
        var c = this.ha();
        c && (ef(c, c.length, this.sa(), a, b, c), this.s());
    };
    function kf(a, b, c, d) {
        for (var e = 0, f = a[c - d], g = a[c - d + 1]; b < c; b += d)
            var h = a[b], l = a[b + 1], e = e + (g * h - f * l), f = h, g = l;
        return e / 2;
    }
    function lf(a, b, c, d) {
        var e = 0, f, g;
        f = 0;
        for (g = c.length; f < g; ++f) {
            var h = c[f], e = e + kf(a, b, h, d);
            b = h;
        }
        return e;
    }
    function mf(a, b, c, d, e, f, g) {
        var h = a[b], l = a[b + 1], m = a[c] - h, p = a[c + 1] - l;
        if (m || p)
            if (f = ((e - h) * m + (f - l) * p) / (m * m + p * p), 1 < f)
                b = c;
            else if (0 < f) {
                for (e = 0; e < d; ++e)
                    g[e] = Da(a[b + e], a[c + e], f);
                g.length = d;
                return;
            }
        for (e = 0; e < d; ++e)
            g[e] = a[b + e];
        g.length = d;
    }
    function nf(a, b, c, d, e) {
        var f = a[b], g = a[b + 1];
        for (b += d; b < c; b += d) {
            var h = a[b], l = a[b + 1], f = Aa(f, g, h, l);
            f > e && (e = f);
            f = h;
            g = l;
        }
        return e;
    }
    function of(a, b, c, d, e) {
        var f, g;
        f = 0;
        for (g = c.length; f < g; ++f) {
            var h = c[f];
            e = nf(a, b, h, d, e);
            b = h;
        }
        return e;
    }
    function pf(a, b, c, d, e, f, g, h, l, m, p) {
        if (b == c)
            return m;
        var n;
        if (!e) {
            n = Aa(g, h, a[b], a[b + 1]);
            if (n < m) {
                for (p = 0; p < d; ++p)
                    l[p] = a[b + p];
                l.length = d;
                return n;
            }
            return m;
        }
        for (var q = p ? p : [
                    NaN,
                    NaN
                ], r = b + d; r < c;)
            if (mf(a, r - d, r, d, g, h, q), n = Aa(g, h, q[0], q[1]), n < m) {
                m = n;
                for (p = 0; p < d; ++p)
                    l[p] = q[p];
                l.length = d;
                r += d;
            } else
                r += d * Math.max((Math.sqrt(n) - Math.sqrt(m)) / e | 0, 1);
        if (f && (mf(a, c - d, b, d, g, h, q), n = Aa(g, h, q[0], q[1]), n < m)) {
            m = n;
            for (p = 0; p < d; ++p)
                l[p] = q[p];
            l.length = d;
        }
        return m;
    }
    function qf(a, b, c, d, e, f, g, h, l, m, p) {
        p = p ? p : [
            NaN,
            NaN
        ];
        var n, q;
        n = 0;
        for (q = c.length; n < q; ++n) {
            var r = c[n];
            m = pf(a, b, r, d, e, f, g, h, l, m, p);
            b = r;
        }
        return m;
    }
    function rf(a, b) {
        var c = 0, d, e;
        d = 0;
        for (e = b.length; d < e; ++d)
            a[c++] = b[d];
        return c;
    }
    function sf(a, b, c, d) {
        var e, f;
        e = 0;
        for (f = c.length; e < f; ++e) {
            var g = c[e], h;
            for (h = 0; h < d; ++h)
                a[b++] = g[h];
        }
        return b;
    }
    function tf(a, b, c, d, e) {
        e = e ? e : [];
        var f = 0, g, h;
        g = 0;
        for (h = c.length; g < h; ++g)
            b = sf(a, b, c[g], d), e[f++] = b;
        e.length = f;
        return e;
    }
    function uf(a, b, c, d, e) {
        e = void 0 !== e ? e : [];
        for (var f = 0; b < c; b += d)
            e[f++] = a.slice(b, b + d);
        e.length = f;
        return e;
    }
    function vf(a, b, c, d, e) {
        e = void 0 !== e ? e : [];
        var f = 0, g, h;
        g = 0;
        for (h = c.length; g < h; ++g) {
            var l = c[g];
            e[f++] = uf(a, b, l, d, e[f]);
            b = l;
        }
        e.length = f;
        return e;
    }
    function wf(a, b, c, d, e, f, g) {
        var h = (c - b) / d;
        if (3 > h) {
            for (; b < c; b += d)
                f[g++] = a[b], f[g++] = a[b + 1];
            return g;
        }
        var l = Array(h);
        l[0] = 1;
        l[h - 1] = 1;
        c = [
            b,
            c - d
        ];
        for (var m = 0, p; 0 < c.length;) {
            var n = c.pop(), q = c.pop(), r = 0, v = a[q], x = a[q + 1], y = a[n], z = a[n + 1];
            for (p = q + d; p < n; p += d) {
                var A = za(a[p], a[p + 1], v, x, y, z);
                A > r && (m = p, r = A);
            }
            r > e && (l[(m - b) / d] = 1, q + d < m && c.push(q, m), m + d < n && c.push(m, n));
        }
        for (p = 0; p < h; ++p)
            l[p] && (f[g++] = a[b + p * d], f[g++] = a[b + p * d + 1]);
        return g;
    }
    function xf(a, b, c, d, e, f, g, h) {
        var l, m;
        l = 0;
        for (m = c.length; l < m; ++l) {
            var p = c[l];
            a: {
                var n, q = a, r = p, v = d, x = e, y = f, z = g;
                if (b != r) {
                    var A = x * Math.round(q[b] / x), V = x * Math.round(q[b + 1] / x);
                    b += v;
                    y[z++] = A;
                    y[z++] = V;
                    do
                        if (n = x * Math.round(q[b] / x), g = x * Math.round(q[b + 1] / x), b += v, b == r) {
                            y[z++] = n;
                            y[z++] = g;
                            g = z;
                            break a;
                        }
                    while (n == A && g == V);
                    for (; b < r;) {
                        var Pa, ra;
                        Pa = x * Math.round(q[b] / x);
                        ra = x * Math.round(q[b + 1] / x);
                        b += v;
                        if (Pa != n || ra != g) {
                            var La = n - A, C = g - V, Ma = Pa - A, xb = ra - V;
                            La * xb == C * Ma && (0 > La && Ma < La || La == Ma || 0 < La && Ma > La) && (0 > C && xb < C || C == xb || 0 < C && xb > C) || (y[z++] = n, y[z++] = g, A = n, V = g);
                            n = Pa;
                            g = ra;
                        }
                    }
                    y[z++] = n;
                    y[z++] = g;
                }
                g = z;
            }
            h.push(g);
            b = p;
        }
        return g;
    }
    function yf(a, b) {
        ff.call(this);
        this.c = this.l = -1;
        this.pa(a, b);
    }
    u(yf, ff);
    k = yf.prototype;
    k.clone = function () {
        var a = new yf(null);
        zf(a, this.ka, this.B.slice());
        return a;
    };
    k.Gb = function (a, b, c, d) {
        if (d < Oa(this.D(), a, b))
            return d;
        this.c != this.f && (this.l = Math.sqrt(nf(this.B, 0, this.B.length, this.a, 0)), this.c = this.f);
        return pf(this.B, 0, this.B.length, this.a, this.l, !0, a, b, c, d);
    };
    k.Km = function () {
        return kf(this.B, 0, this.B.length, this.a);
    };
    k.X = function () {
        return uf(this.B, 0, this.B.length, this.a);
    };
    k.kd = function (a) {
        var b = [];
        b.length = wf(this.B, 0, this.B.length, this.a, a, b, 0);
        a = new yf(null);
        zf(a, 'XY', b);
        return a;
    };
    k.T = function () {
        return 'LinearRing';
    };
    k.Xa = function () {
    };
    k.pa = function (a, b) {
        a ? (jf(this, b, a, 1), this.B || (this.B = []), this.B.length = sf(this.B, 0, a, this.a), this.s()) : zf(this, 'XY', null);
    };
    function zf(a, b, c) {
        hf(a, b, c);
        a.s();
    }
    function E(a, b) {
        ff.call(this);
        this.pa(a, b);
    }
    u(E, ff);
    k = E.prototype;
    k.clone = function () {
        var a = new E(null);
        a.ca(this.ka, this.B.slice());
        return a;
    };
    k.Gb = function (a, b, c, d) {
        var e = this.B;
        a = Aa(a, b, e[0], e[1]);
        if (a < d) {
            d = this.a;
            for (b = 0; b < d; ++b)
                c[b] = e[b];
            c.length = d;
            return a;
        }
        return d;
    };
    k.X = function () {
        return this.B ? this.B.slice() : [];
    };
    k.ne = function (a) {
        return Wa(this.B, a);
    };
    k.T = function () {
        return 'Point';
    };
    k.Xa = function (a) {
        return Sa(a, this.B[0], this.B[1]);
    };
    k.pa = function (a, b) {
        a ? (jf(this, b, a, 0), this.B || (this.B = []), this.B.length = rf(this.B, a), this.s()) : this.ca('XY', null);
    };
    k.ca = function (a, b) {
        hf(this, a, b);
        this.s();
    };
    function Af(a, b, c, d, e) {
        return !ab(e, function (e) {
            return !Bf(a, b, c, d, e[0], e[1]);
        });
    }
    function Bf(a, b, c, d, e, f) {
        for (var g = 0, h = a[c - d], l = a[c - d + 1]; b < c; b += d) {
            var m = a[b], p = a[b + 1];
            l <= f ? p > f && 0 < (m - h) * (f - l) - (e - h) * (p - l) && g++ : p <= f && 0 > (m - h) * (f - l) - (e - h) * (p - l) && g--;
            h = m;
            l = p;
        }
        return !!g;
    }
    function Cf(a, b, c, d, e, f) {
        if (!c.length || !Bf(a, b, c[0], d, e, f))
            return !1;
        var g;
        b = 1;
        for (g = c.length; b < g; ++b)
            if (Bf(a, c[b - 1], c[b], d, e, f))
                return !1;
        return !0;
    }
    function Df(a, b, c, d, e, f, g) {
        var h, l, m, p, n, q = e[f + 1], r = [], v = c[0];
        m = a[v - d];
        n = a[v - d + 1];
        for (h = b; h < v; h += d) {
            p = a[h];
            l = a[h + 1];
            if (q <= n && l <= q || n <= q && q <= l)
                m = (q - n) / (l - n) * (p - m) + m, r.push(m);
            m = p;
            n = l;
        }
        v = NaN;
        n = -Infinity;
        r.sort(da);
        m = r[0];
        h = 1;
        for (l = r.length; h < l; ++h) {
            p = r[h];
            var x = Math.abs(p - m);
            x > n && (m = (m + p) / 2, Cf(a, b, c, d, m, q) && (v = m, n = x));
            m = p;
        }
        isNaN(v) && (v = e[f]);
        return g ? (g.push(v, q), g) : [
            v,
            q
        ];
    }
    function Ef(a, b, c, d, e, f) {
        for (var g = [
                    a[b],
                    a[b + 1]
                ], h = [], l; b + d < c; b += d) {
            h[0] = a[b + d];
            h[1] = a[b + d + 1];
            if (l = e.call(f, g, h))
                return l;
            g[0] = h[0];
            g[1] = h[1];
        }
        return !1;
    }
    function Ff(a, b, c, d, e) {
        var f = Ya(Ia(), a, b, c, d);
        return mb(e, f) ? Ta(e, f) || f[0] >= e[0] && f[2] <= e[2] || f[1] >= e[1] && f[3] <= e[3] ? !0 : Ef(a, b, c, d, function (a, b) {
            var c = !1, d = Ua(e, a), f = Ua(e, b);
            if (1 === d || 1 === f)
                c = !0;
            else {
                var g = e[0], h = e[1], r = e[2], v = e[3], x = b[0], y = b[1], z = (y - a[1]) / (x - a[0]);
                f & 2 && !(d & 2) && (c = x - (y - v) / z, c = c >= g && c <= r);
                c || !(f & 4) || d & 4 || (c = y - (x - r) * z, c = c >= h && c <= v);
                c || !(f & 8) || d & 8 || (c = x - (y - h) / z, c = c >= g && c <= r);
                c || !(f & 16) || d & 16 || (c = y - (x - g) * z, c = c >= h && c <= v);
            }
            return c;
        }) : !1;
    }
    function Gf(a, b, c, d, e) {
        var f = c[0];
        if (!(Ff(a, b, f, d, e) || Bf(a, b, f, d, e[0], e[1]) || Bf(a, b, f, d, e[0], e[3]) || Bf(a, b, f, d, e[2], e[1]) || Bf(a, b, f, d, e[2], e[3])))
            return !1;
        if (1 === c.length)
            return !0;
        b = 1;
        for (f = c.length; b < f; ++b)
            if (Af(a, c[b - 1], c[b], d, e))
                return !1;
        return !0;
    }
    function Hf(a, b, c, d) {
        for (var e = 0, f = a[c - d], g = a[c - d + 1]; b < c; b += d)
            var h = a[b], l = a[b + 1], e = e + (h - f) * (l + g), f = h, g = l;
        return 0 < e;
    }
    function If(a, b, c, d) {
        var e = 0;
        d = void 0 !== d ? d : !1;
        var f, g;
        f = 0;
        for (g = b.length; f < g; ++f) {
            var h = b[f], e = Hf(a, e, h, c);
            if (!f) {
                if (d && e || !d && !e)
                    return !1;
            } else if (d && !e || !d && e)
                return !1;
            e = h;
        }
        return !0;
    }
    function Jf(a, b, c, d, e) {
        e = void 0 !== e ? e : !1;
        var f, g;
        f = 0;
        for (g = c.length; f < g; ++f) {
            var h = c[f], l = Hf(a, b, h, d);
            if (f ? e && !l || !e && l : e && l || !e && !l)
                for (var l = a, m = h, p = d; b < m - p;) {
                    var n;
                    for (n = 0; n < p; ++n) {
                        var q = l[b + n];
                        l[b + n] = l[m - p + n];
                        l[m - p + n] = q;
                    }
                    b += p;
                    m -= p;
                }
            b = h;
        }
        return b;
    }
    function Kf(a, b, c, d) {
        var e = 0, f, g;
        f = 0;
        for (g = b.length; f < g; ++f)
            e = Jf(a, e, b[f], c, d);
        return e;
    }
    function F(a, b) {
        ff.call(this);
        this.c = [];
        this.u = -1;
        this.A = null;
        this.R = this.C = this.G = -1;
        this.l = null;
        this.pa(a, b);
    }
    u(F, ff);
    k = F.prototype;
    k.Vj = function (a) {
        this.B ? ga(this.B, a.ha()) : this.B = a.ha().slice();
        this.c.push(this.B.length);
        this.s();
    };
    k.clone = function () {
        var a = new F(null);
        a.ca(this.ka, this.B.slice(), this.c.slice());
        return a;
    };
    k.Gb = function (a, b, c, d) {
        if (d < Oa(this.D(), a, b))
            return d;
        this.C != this.f && (this.G = Math.sqrt(of(this.B, 0, this.c, this.a, 0)), this.C = this.f);
        return qf(this.B, 0, this.c, this.a, this.G, !0, a, b, c, d);
    };
    k.Oc = function (a, b) {
        return Cf(this.fc(), 0, this.c, this.a, a, b);
    };
    k.Nm = function () {
        return lf(this.fc(), 0, this.c, this.a);
    };
    k.X = function (a) {
        var b;
        void 0 !== a ? (b = this.fc().slice(), Jf(b, 0, this.c, this.a, a)) : b = this.B;
        return vf(b, 0, this.c, this.a);
    };
    k.Rb = function () {
        return this.c;
    };
    function Lf(a) {
        if (a.u != a.f) {
            var b = jb(a.D());
            a.A = Df(a.fc(), 0, a.c, a.a, b, 0);
            a.u = a.f;
        }
        return a.A;
    }
    k.yk = function () {
        return new E(Lf(this));
    };
    k.Ek = function () {
        return this.c.length;
    };
    k.nh = function (a) {
        if (0 > a || this.c.length <= a)
            return null;
        var b = new yf(null);
        zf(b, this.ka, this.B.slice(a ? this.c[a - 1] : 0, this.c[a]));
        return b;
    };
    k.jd = function () {
        var a = this.ka, b = this.B, c = this.c, d = [], e = 0, f, g;
        f = 0;
        for (g = c.length; f < g; ++f) {
            var h = c[f], l = new yf(null);
            zf(l, a, b.slice(e, h));
            d.push(l);
            e = h;
        }
        return d;
    };
    k.fc = function () {
        if (this.R != this.f) {
            var a = this.B;
            If(a, this.c, this.a) ? this.l = a : (this.l = a.slice(), this.l.length = Jf(this.l, 0, this.c, this.a));
            this.R = this.f;
        }
        return this.l;
    };
    k.kd = function (a) {
        var b = [], c = [];
        b.length = xf(this.B, 0, this.c, this.a, Math.sqrt(a), b, 0, c);
        a = new F(null);
        a.ca('XY', b, c);
        return a;
    };
    k.T = function () {
        return 'Polygon';
    };
    k.Xa = function (a) {
        return Gf(this.fc(), 0, this.c, this.a, a);
    };
    k.pa = function (a, b) {
        if (a) {
            jf(this, b, a, 2);
            this.B || (this.B = []);
            var c = tf(this.B, 0, a, this.a, this.c);
            this.B.length = c.length ? c[c.length - 1] : 0;
            this.s();
        } else
            this.ca('XY', null, this.c);
    };
    k.ca = function (a, b, c) {
        hf(this, a, b);
        this.c = c;
        this.s();
    };
    function Mf(a, b, c, d) {
        var e = d ? d : 32;
        d = [];
        var f;
        for (f = 0; f < e; ++f)
            ga(d, a.offset(b, c, 2 * Math.PI * f / e));
        d.push(d[0], d[1]);
        a = new F(null);
        a.ca('XY', d, [d.length]);
        return a;
    }
    function Nf(a) {
        var b = a[0], c = a[1], d = a[2];
        a = a[3];
        b = [
            b,
            c,
            b,
            a,
            d,
            a,
            d,
            c,
            b,
            c
        ];
        c = new F(null);
        c.ca('XY', b, [b.length]);
        return c;
    }
    function Of(a, b, c) {
        var d = b ? b : 32, e = a.sa();
        b = a.ka;
        for (var f = new F(null, b), d = e * (d + 1), e = Array(d), g = 0; g < d; g++)
            e[g] = 0;
        f.ca(b, e, [e.length]);
        Pf(f, a.Ba(), a.Vd(), c);
        return f;
    }
    function Pf(a, b, c, d) {
        var e = a.ha(), f = a.ka, g = a.sa(), h = a.Rb(), l = e.length / g - 1;
        d = d ? d : 0;
        for (var m, p, n = 0; n <= l; ++n)
            p = n * g, m = d + 2 * Ca(n, l) * Math.PI / l, e[p] = b[0] + c * Math.cos(m), e[p + 1] = b[1] + c * Math.sin(m);
        a.ca(f, e, h);
    }
    function Qf(a) {
        Gc.call(this);
        a = a || {};
        this.l = [
            0,
            0
        ];
        this.c = [];
        this.lf = this.lf.bind(this);
        var b = {};
        b.center = void 0 !== a.center ? a.center : null;
        this.o = Qb(a.projection);
        var c, d, e, f = void 0 !== a.minZoom ? a.minZoom : 0;
        c = void 0 !== a.maxZoom ? a.maxZoom : 28;
        var g = void 0 !== a.zoomFactor ? a.zoomFactor : 2;
        if (void 0 !== a.resolutions)
            c = a.resolutions, d = c[0], e = c[c.length - 1], c = He(c);
        else {
            d = Qb(a.projection);
            e = d.D();
            var h = (e ? Math.max(hb(e), ib(e)) : 360 * vb.degrees / d.sc()) / 256 / Math.pow(2, 0), l = h / Math.pow(2, 28);
            d = a.maxResolution;
            void 0 !== d ? f = 0 : d = h / Math.pow(g, f);
            e = a.minResolution;
            void 0 === e && (e = void 0 !== a.maxZoom ? void 0 !== a.maxResolution ? d / Math.pow(g, c) : h / Math.pow(g, c) : l);
            c = f + Math.floor(Math.log(d / e) / Math.log(g));
            e = d / Math.pow(g, c - f);
            c = Ie(g, d, c - f);
        }
        this.a = d;
        this.i = e;
        this.A = g;
        this.g = a.resolutions;
        this.j = f;
        (void 0 !== a.enableRotation ? a.enableRotation : 1) ? (f = a.constrainRotation, f = void 0 === f || !0 === f ? Ne() : !1 === f ? Le : 'number' === typeof f ? Me(f) : Le) : f = Ke;
        this.u = new Wc(void 0 !== a.extent ? oc(a.extent) : pc, c, f);
        void 0 !== a.resolution ? b.resolution = a.resolution : void 0 !== a.zoom && (b.resolution = this.constrainResolution(this.a, a.zoom - this.j));
        b.rotation = void 0 !== a.rotation ? a.rotation : 0;
        this.H(b);
    }
    u(Qf, Gc);
    k = Qf.prototype;
    k.animate = function (a) {
        var b = Date.now(), c = this.Ba().slice(), d = this.Ua(), e = this.Va(), f = arguments.length, g;
        1 < f && 'function' === typeof arguments[f - 1] && (g = arguments[f - 1], --f);
        for (var h = [], l = 0; l < f; ++l) {
            var m = arguments[l], p = {
                    start: b,
                    complete: !1,
                    anchor: m.anchor,
                    duration: void 0 !== m.duration ? m.duration : 1000,
                    easing: m.easing || gd
                };
            m.center && (p.Bg = c, p.Dg = m.center, c = p.Dg);
            void 0 !== m.zoom ? (p.hf = d, p.jf = this.constrainResolution(this.a, m.zoom - this.j, 0), d = p.jf) : m.resolution && (p.hf = d, p.jf = m.resolution, d = p.jf);
            void 0 !== m.rotation && (p.Cg = e, p.Xi = m.rotation, e = p.Xi);
            p.fd = g;
            b += p.duration;
            h.push(p);
        }
        this.c.push(h);
        Rf(this, 0, 1);
        this.lf();
    };
    function md(a) {
        Rf(a, 0, -ld(a)[0]);
        for (var b = 0, c = a.c.length; b < c; ++b) {
            var d = a.c[b];
            d[0].fd && d[0].fd(!1);
        }
        a.c.length = 0;
    }
    k.lf = function () {
        void 0 !== this.v && (cancelAnimationFrame(this.v), this.v = void 0);
        if (0 < ld(this)[0]) {
            for (var a = Date.now(), b = !1, c = this.c.length - 1; 0 <= c; --c) {
                for (var d = this.c[c], e = !0, f = 0, g = d.length; f < g; ++f) {
                    var h = d[f];
                    if (!h.complete) {
                        b = a - h.start;
                        b = 0 < h.duration ? b / h.duration : 1;
                        1 <= b ? (h.complete = !0, b = 1) : e = !1;
                        b = h.easing(b);
                        if (h.Bg) {
                            var l = h.Bg[0], m = h.Bg[1];
                            this.set('center', [
                                l + b * (h.Dg[0] - l),
                                m + b * (h.Dg[1] - m)
                            ]);
                        }
                        h.hf && (l = h.hf + b * (h.jf - h.hf), h.anchor && this.set('center', Sf(this, l, h.anchor)), this.set('resolution', l));
                        void 0 !== h.Cg && (b = h.Cg + b * (h.Xi - h.Cg), h.anchor && this.set('center', Tf(this, b, h.anchor)), this.set('rotation', b));
                        b = !0;
                        if (!h.complete)
                            break;
                    }
                }
                e && (this.c[c] = null, Rf(this, 0, -1), (d = d[0].fd) && d(!0));
            }
            this.c = this.c.filter(Boolean);
            b && void 0 === this.v && (this.v = requestAnimationFrame(this.lf));
        }
    };
    function Tf(a, b, c) {
        var d, e = a.Ba();
        void 0 !== e && (d = [
            e[0] - c[0],
            e[1] - c[1]
        ], Ve(d, b - a.Va()), Qe(d, c));
        return d;
    }
    function Sf(a, b, c) {
        var d, e = a.Ba();
        a = a.Ua();
        void 0 !== e && void 0 !== a && (d = [
            c[0] - b * (c[0] - e[0]) / a,
            c[1] - b * (c[1] - e[1]) / a
        ]);
        return d;
    }
    function Uf(a) {
        var b = [
            100,
            100
        ];
        a = '.ol-viewport[data-view="' + w(a) + '"]';
        if (a = document.querySelector(a))
            a = getComputedStyle(a), b[0] = parseInt(a.width, 10), b[1] = parseInt(a.height, 10);
        return b;
    }
    k.Ec = function (a) {
        return this.u.center(a);
    };
    k.constrainResolution = function (a, b, c) {
        return this.u.resolution(a, b || 0, c || 0);
    };
    k.constrainRotation = function (a, b) {
        return this.u.rotation(a, b || 0);
    };
    k.Ba = function () {
        return this.get('center');
    };
    function ld(a, b) {
        return void 0 !== b ? (b[0] = a.l[0], b[1] = a.l[1], b) : a.l.slice();
    }
    k.ed = function (a) {
        a = a || Uf(this);
        var b = this.Ba();
        qa(b, 1);
        var c = this.Ua();
        qa(void 0 !== c, 2);
        var d = this.Va();
        qa(void 0 !== d, 3);
        return kb(b, c, d, a);
    };
    k.sm = function () {
        return this.a;
    };
    k.tm = function () {
        return this.i;
    };
    k.um = function () {
        return this.o;
    };
    k.Ua = function () {
        return this.get('resolution');
    };
    k.vm = function () {
        return this.g;
    };
    function Vf(a, b) {
        return Math.max(hb(a) / b[0], ib(a) / b[1]);
    }
    function Wf(a) {
        var b = a.a, c = Math.log(b / a.i) / Math.log(2);
        return function (a) {
            return b / Math.pow(2, a * c);
        };
    }
    k.Va = function () {
        return this.get('rotation');
    };
    function Xf(a) {
        var b = a.a, c = Math.log(b / a.i) / Math.log(2);
        return function (a) {
            return Math.log(b / a) / Math.log(2) / c;
        };
    }
    k.V = function () {
        var a = this.Ba(), b = this.o, c = this.Ua(), d = this.Va();
        return {
            center: a.slice(),
            projection: void 0 !== b ? b : null,
            resolution: c,
            rotation: d
        };
    };
    k.$k = function () {
        var a, b = this.Ua();
        if (void 0 !== b && b >= this.i && b <= this.a) {
            a = this.j || 0;
            var c, d;
            if (this.g) {
                d = fa(this.g, b, 1);
                a += d;
                if (d == this.g.length - 1)
                    return a;
                c = this.g[d];
                d = c / this.g[d + 1];
            } else
                c = this.a, d = this.A;
            a += Math.log(c / b) / Math.log(d);
        }
        return a;
    };
    k.Ff = function (a, b) {
        var c = b || {}, d = c.size;
        d || (d = Uf(this));
        var e;
        a instanceof ff ? 'Circle' === a.T() ? (a = a.D(), e = Nf(a), e.rotate(this.Va(), jb(a))) : e = a : (qa(Array.isArray(a), 24), qa(!gb(a), 25), e = Nf(a));
        var f = c.padding ? c.padding : [
                0,
                0,
                0,
                0
            ], g = void 0 !== c.constrainResolution ? c.constrainResolution : !0, h = void 0 !== c.nearest ? c.nearest : !1, l;
        void 0 !== c.minResolution ? l = c.minResolution : void 0 !== c.maxZoom ? l = this.constrainResolution(this.a, c.maxZoom - this.j, 0) : l = 0;
        var m = e.ha(), p = this.Va(), n = Math.cos(-p), p = Math.sin(-p), q = Infinity, r = Infinity, v = -Infinity, x = -Infinity;
        e = e.sa();
        for (var y = 0, z = m.length; y < z; y += e)
            var A = m[y] * n - m[y + 1] * p, V = m[y] * p + m[y + 1] * n, q = Math.min(q, A), r = Math.min(r, V), v = Math.max(v, A), x = Math.max(x, V);
        d = Vf([
            q,
            r,
            v,
            x
        ], [
            d[0] - f[1] - f[3],
            d[1] - f[0] - f[2]
        ]);
        d = isNaN(d) ? l : Math.max(d, l);
        g && (g = this.constrainResolution(d, 0, 0), !h && g < d && (g = this.constrainResolution(g, -1, 0)), d = g);
        p = -p;
        h = (q + v) / 2 + (f[1] - f[3]) / 2 * d;
        f = (r + x) / 2 + (f[0] - f[2]) / 2 * d;
        n = [
            h * n - f * p,
            f * n + h * p
        ];
        void 0 !== c.duration ? this.animate({
            resolution: d,
            center: n,
            duration: c.duration,
            easing: c.easing
        }) : (this.Xc(d), this.wb(n));
    };
    k.$j = function (a, b, c) {
        var d = this.Va(), e = Math.cos(-d), d = Math.sin(-d), f = a[0] * e - a[1] * d;
        a = a[1] * e + a[0] * d;
        var g = this.Ua(), f = f + (b[0] / 2 - c[0]) * g;
        a += (c[1] - b[1] / 2) * g;
        d = -d;
        this.wb([
            f * e - a * d,
            a * e + f * d
        ]);
    };
    function Yf(a) {
        return !!a.Ba() && void 0 !== a.Ua();
    }
    k.rotate = function (a, b) {
        if (void 0 !== b) {
            var c = Tf(this, a, b);
            this.wb(c);
        }
        this.He(a);
    };
    k.wb = function (a) {
        this.set('center', a);
        0 < ld(this)[0] && md(this);
    };
    function Rf(a, b, c) {
        a.l[b] += c;
        a.s();
    }
    k.Xc = function (a) {
        this.set('resolution', a);
        0 < ld(this)[0] && md(this);
    };
    k.He = function (a) {
        this.set('rotation', a);
        0 < ld(this)[0] && md(this);
    };
    k.yp = function (a) {
        a = this.constrainResolution(this.a, a - this.j, 0);
        this.Xc(a);
    };
    function Zf(a, b, c) {
        this.i = a;
        this.c = b;
        this.g = c;
        this.b = [];
        this.a = this.f = 0;
    }
    function $f(a) {
        a.b.length = 0;
        a.f = 0;
        a.a = 0;
    }
    function ag(a) {
        Gc.call(this);
        this.v = null;
        this.Ia(!0);
        this.handleEvent = a.handleEvent;
    }
    u(ag, Gc);
    ag.prototype.c = function () {
        return this.get('active');
    };
    ag.prototype.i = function () {
        return this.v;
    };
    ag.prototype.Ia = function (a) {
        this.set('active', a);
    };
    ag.prototype.setMap = function (a) {
        this.v = a;
    };
    function bg(a, b, c, d) {
        if (void 0 !== b) {
            var e = a.Va(), f = a.Ba();
            void 0 !== e && f && 0 < d ? a.animate({
                rotation: b,
                anchor: c,
                duration: d,
                easing: fd
            }) : a.rotate(b, c);
        }
    }
    function cg(a, b, c, d) {
        var e = a.Ua();
        b = a.constrainResolution(e, b, 0);
        if (c && void 0 !== b && b !== e) {
            var f = a.Ba();
            c = Sf(a, b, c);
            c = a.Ec(c);
            c = [
                (b * f[0] - e * c[0]) / (b - e),
                (b * f[1] - e * c[1]) / (b - e)
            ];
        }
        dg(a, b, c, d);
    }
    function dg(a, b, c, d) {
        if (b) {
            var e = a.Ua(), f = a.Ba();
            void 0 !== e && f && b !== e && d ? a.animate({
                resolution: b,
                anchor: c,
                duration: d,
                easing: fd
            }) : (c && (c = Sf(a, b, c), a.wb(c)), a.Xc(b));
        }
    }
    function eg(a) {
        a = a ? a : {};
        this.a = a.delta ? a.delta : 1;
        ag.call(this, { handleEvent: fg });
        this.g = void 0 !== a.duration ? a.duration : 250;
    }
    u(eg, ag);
    function fg(a) {
        var b = !1, c = a.originalEvent;
        if ('dblclick' == a.type) {
            var b = a.coordinate, c = c.shiftKey ? -this.a : this.a, d = a.map.$();
            cg(d, c, b, this.g);
            a.preventDefault();
            b = !0;
        }
        return !b;
    }
    function gg(a) {
        a = a.originalEvent;
        return a.altKey && !(a.metaKey || a.ctrlKey) && a.shiftKey;
    }
    function hg(a) {
        a = a.originalEvent;
        return !a.button && !(Id && Jd && a.ctrlKey);
    }
    function ig(a) {
        return 'pointermove' == a.type;
    }
    function jg(a) {
        return 'singleclick' == a.type;
    }
    function kg(a) {
        a = a.originalEvent;
        return !a.altKey && !(a.metaKey || a.ctrlKey) && !a.shiftKey;
    }
    function lg(a) {
        a = a.originalEvent;
        return !a.altKey && !(a.metaKey || a.ctrlKey) && a.shiftKey;
    }
    function mg(a) {
        a = a.originalEvent.target.tagName;
        return 'INPUT' !== a && 'SELECT' !== a && 'TEXTAREA' !== a;
    }
    function ng(a) {
        qa(a.b, 56);
        return 'mouse' == a.b.pointerType;
    }
    function og(a) {
        a = a.b;
        return a.isPrimary && 0 === a.button;
    }
    function pg(a) {
        a = a ? a : {};
        ag.call(this, { handleEvent: a.handleEvent ? a.handleEvent : qg });
        this.sf = a.handleDownEvent ? a.handleDownEvent : bf;
        this.pf = a.handleDragEvent ? a.handleDragEvent : na;
        this.xf = a.handleMoveEvent ? a.handleMoveEvent : na;
        this.yf = a.handleUpEvent ? a.handleUpEvent : bf;
        this.A = !1;
        this.Y = {};
        this.l = [];
    }
    u(pg, ag);
    function rg(a) {
        for (var b = a.length, c = 0, d = 0, e = 0; e < b; e++)
            c += a[e].clientX, d += a[e].clientY;
        return [
            c / b,
            d / b
        ];
    }
    function qg(a) {
        if (!(a instanceof Bd))
            return !0;
        var b = !1, c = a.type;
        if ('pointerdown' === c || 'pointerdrag' === c || 'pointerup' === c)
            c = a.b, 'pointerup' == a.type ? delete this.Y[c.pointerId] : 'pointerdown' == a.type ? this.Y[c.pointerId] = c : c.pointerId in this.Y && (this.Y[c.pointerId] = c), this.l = rb(this.Y);
        this.A ? 'pointerdrag' == a.type ? this.pf(a) : 'pointerup' == a.type && (this.A = this.yf(a) && 0 < this.l.length) : 'pointerdown' == a.type ? (this.A = a = this.sf(a), b = this.Zc(a)) : 'pointermove' == a.type && this.xf(a);
        return !b;
    }
    pg.prototype.Zc = function (a) {
        return a;
    };
    function sg(a) {
        pg.call(this, {
            handleDownEvent: tg,
            handleDragEvent: ug,
            handleUpEvent: vg
        });
        a = a ? a : {};
        this.a = a.kinetic;
        this.g = null;
        this.u = a.condition ? a.condition : kg;
        this.j = !1;
    }
    u(sg, pg);
    function ug(a) {
        var b = this.l, c = rg(b);
        if (b.length == this.o) {
            if (this.a && this.a.b.push(c[0], c[1], Date.now()), this.g) {
                var d = this.g[0] - c[0], e = c[1] - this.g[1];
                a = a.map.$();
                var f = a.V(), d = [
                        d,
                        e
                    ];
                We(d, f.resolution);
                Ve(d, f.rotation);
                Qe(d, f.center);
                d = a.Ec(d);
                a.wb(d);
            }
        } else
            this.a && $f(this.a);
        this.g = c;
        this.o = b.length;
    }
    function vg(a) {
        var b = a.map;
        a = b.$();
        if (this.l.length)
            return this.a && $f(this.a), this.g = null, !0;
        var c;
        if (c = !this.j && this.a)
            if (c = this.a, 6 > c.b.length)
                c = !1;
            else {
                var d = Date.now() - c.g, e = c.b.length - 3;
                if (c.b[e + 2] < d)
                    c = !1;
                else {
                    for (var f = e - 3; 0 < f && c.b[f + 2] > d;)
                        f -= 3;
                    var d = c.b[e + 2] - c.b[f + 2], g = c.b[e] - c.b[f], e = c.b[e + 1] - c.b[f + 1];
                    c.f = Math.atan2(e, g);
                    c.a = Math.sqrt(g * g + e * e) / d;
                    c = c.a > c.c;
                }
            }
        c && (c = this.a, c = (c.c - c.a) / c.i, e = this.a.f, f = a.Ba(), f = b.Ka(f), b = b.Za([
            f[0] - c * Math.cos(e),
            f[1] - c * Math.sin(e)
        ]), a.animate({
            center: a.Ec(b),
            duration: 500,
            easing: fd
        }));
        Rf(a, 1, -1);
        return !1;
    }
    function tg(a) {
        if (0 < this.l.length && this.u(a)) {
            var b = a.map.$();
            this.g = null;
            this.A || Rf(b, 1, 1);
            ld(b)[0] && b.wb(a.frameState.viewState.center);
            this.a && $f(this.a);
            this.j = 1 < this.l.length;
            return !0;
        }
        return !1;
    }
    sg.prototype.Zc = bf;
    function wg(a) {
        a = a ? a : {};
        pg.call(this, {
            handleDownEvent: xg,
            handleDragEvent: yg,
            handleUpEvent: zg
        });
        this.g = a.condition ? a.condition : gg;
        this.a = void 0;
        this.j = void 0 !== a.duration ? a.duration : 250;
    }
    u(wg, pg);
    function yg(a) {
        if (ng(a)) {
            var b = a.map, c = b.Mb();
            a = a.pixel;
            c = Math.atan2(c[1] / 2 - a[1], a[0] - c[0] / 2);
            if (void 0 !== this.a) {
                a = c - this.a;
                var b = b.$(), d = b.Va();
                bg(b, d - a);
            }
            this.a = c;
        }
    }
    function zg(a) {
        if (!ng(a))
            return !0;
        a = a.map.$();
        Rf(a, 1, -1);
        var b = a.Va(), c = this.j, b = a.constrainRotation(b, 0);
        bg(a, b, void 0, c);
        return !1;
    }
    function xg(a) {
        return ng(a) && hg(a) && this.g(a) ? (Rf(a.map.$(), 1, 1), this.a = void 0, !0) : !1;
    }
    wg.prototype.Zc = bf;
    function Ag(a) {
        this.Gc = null;
        this.a = document.createElement('div');
        this.a.style.position = 'absolute';
        this.a.className = 'ol-box ' + a;
        this.f = this.c = this.b = null;
    }
    u(Ag, zc);
    Ag.prototype.ra = function () {
        this.setMap(null);
    };
    function Bg(a) {
        var b = a.c, c = a.f;
        a = a.a.style;
        a.left = Math.min(b[0], c[0]) + 'px';
        a.top = Math.min(b[1], c[1]) + 'px';
        a.width = Math.abs(c[0] - b[0]) + 'px';
        a.height = Math.abs(c[1] - b[1]) + 'px';
    }
    Ag.prototype.setMap = function (a) {
        if (this.b) {
            this.b.A.removeChild(this.a);
            var b = this.a.style;
            b.left = b.top = b.width = b.height = 'inherit';
        }
        (this.b = a) && this.b.A.appendChild(this.a);
    };
    function Cg(a) {
        var b = a.c, c = a.f, b = [
                b,
                [
                    b[0],
                    c[1]
                ],
                c,
                [
                    c[0],
                    b[1]
                ]
            ].map(a.b.Za, a.b);
        b[4] = b[0].slice();
        a.Gc ? a.Gc.pa([b]) : a.Gc = new F([b]);
    }
    Ag.prototype.U = function () {
        return this.Gc;
    };
    function Dg(a) {
        pg.call(this, {
            handleDownEvent: Eg,
            handleDragEvent: Fg,
            handleUpEvent: Gg
        });
        a = a ? a : {};
        this.a = new Ag(a.className || 'ol-dragbox');
        this.g = null;
        this.u = a.condition ? a.condition : af;
        this.o = a.boxEndCondition ? a.boxEndCondition : Hg;
    }
    u(Dg, pg);
    function Hg(a, b, c) {
        a = c[0] - b[0];
        b = c[1] - b[1];
        return 64 <= a * a + b * b;
    }
    function Fg(a) {
        if (ng(a)) {
            var b = this.a, c = a.pixel;
            b.c = this.g;
            b.f = c;
            Cg(b);
            Bg(b);
            this.b(new Ig(Jg, a.coordinate, a));
        }
    }
    Dg.prototype.U = function () {
        return this.a.U();
    };
    Dg.prototype.j = na;
    function Gg(a) {
        if (!ng(a))
            return !0;
        this.a.setMap(null);
        this.o(a, this.g, a.pixel) && (this.j(a), this.b(new Ig(Kg, a.coordinate, a)));
        return !1;
    }
    function Eg(a) {
        if (ng(a) && hg(a) && this.u(a)) {
            this.g = a.pixel;
            this.a.setMap(a.map);
            var b = this.a, c = this.g;
            b.c = this.g;
            b.f = c;
            Cg(b);
            Bg(b);
            this.b(new Ig(Lg, a.coordinate, a));
            return !0;
        }
        return !1;
    }
    var Lg = 'boxstart', Jg = 'boxdrag', Kg = 'boxend';
    function Ig(a, b, c) {
        Bc.call(this, a);
        this.coordinate = b;
        this.mapBrowserEvent = c;
    }
    u(Ig, Bc);
    function Mg(a) {
        a = a ? a : {};
        var b = a.condition ? a.condition : lg;
        this.C = void 0 !== a.duration ? a.duration : 200;
        this.G = void 0 !== a.out ? a.out : !1;
        Dg.call(this, {
            condition: b,
            className: a.className || 'ol-dragzoom'
        });
    }
    u(Mg, Dg);
    Mg.prototype.j = function () {
        var a = this.v, b = a.$(), c = a.Mb(), d = this.U().D();
        if (this.G) {
            var e = b.ed(c), d = [
                    a.Ka(bb(d)),
                    a.Ka(db(d))
                ], a = Va(Infinity, Infinity, -Infinity, -Infinity, void 0), f, g;
            f = 0;
            for (g = d.length; f < g; ++f)
                Ja(a, d[f]);
            nb(e, 1 / Vf(a, c));
            d = e;
        }
        c = b.constrainResolution(Vf(d, c));
        e = jb(d);
        e = b.Ec(e);
        b.animate({
            resolution: c,
            center: e,
            duration: this.C,
            easing: fd
        });
    };
    function Ng(a) {
        ag.call(this, { handleEvent: Og });
        a = a || {};
        this.a = function (a) {
            return kg(a) && mg(a);
        };
        this.g = a.condition ? a.condition : this.a;
        this.l = void 0 !== a.duration ? a.duration : 100;
        this.j = void 0 !== a.pixelDelta ? a.pixelDelta : 128;
    }
    u(Ng, ag);
    function Og(a) {
        var b = !1;
        if ('keydown' == a.type) {
            var c = a.originalEvent.keyCode;
            if (this.g(a) && (40 == c || 37 == c || 39 == c || 38 == c)) {
                var b = a.map.$(), d = b.Ua() * this.j, e = 0, f = 0;
                40 == c ? f = -d : 37 == c ? e = -d : 39 == c ? e = d : f = d;
                d = [
                    e,
                    f
                ];
                Ve(d, b.Va());
                c = this.l;
                if (e = b.Ba())
                    d = b.Ec([
                        e[0] + d[0],
                        e[1] + d[1]
                    ]), c ? b.animate({
                        duration: c,
                        easing: hd,
                        center: d
                    }) : b.wb(d);
                a.preventDefault();
                b = !0;
            }
        }
        return !b;
    }
    function Pg(a) {
        ag.call(this, { handleEvent: Qg });
        a = a ? a : {};
        this.g = a.condition ? a.condition : mg;
        this.a = a.delta ? a.delta : 1;
        this.l = void 0 !== a.duration ? a.duration : 100;
    }
    u(Pg, ag);
    function Qg(a) {
        var b = !1;
        if ('keydown' == a.type || 'keypress' == a.type) {
            var c = a.originalEvent.charCode;
            !this.g(a) || 43 != c && 45 != c || (b = 43 == c ? this.a : -this.a, c = a.map.$(), cg(c, b, void 0, this.l), a.preventDefault(), b = !0);
        }
        return !b;
    }
    function Rg(a) {
        ag.call(this, { handleEvent: Sg });
        a = a || {};
        this.l = 0;
        this.R = void 0 !== a.duration ? a.duration : 250;
        this.Y = void 0 !== a.timeout ? a.timeout : 80;
        this.A = void 0 !== a.useAnchor ? a.useAnchor : !0;
        this.a = null;
        this.o = this.j = this.u = this.g = void 0;
    }
    u(Rg, ag);
    function Sg(a) {
        var b = a.type;
        if ('wheel' !== b && 'mousewheel' !== b)
            return !0;
        a.preventDefault();
        var b = a.map, c = a.originalEvent;
        this.A && (this.a = a.coordinate);
        var d;
        'wheel' == a.type ? (d = c.deltaY, Gd && c.deltaMode === WheelEvent.DOM_DELTA_PIXEL && (d /= Kd), c.deltaMode === WheelEvent.DOM_DELTA_LINE && (d *= 40)) : 'mousewheel' == a.type && (d = -c.wheelDeltaY, Hd && (d /= 3));
        if (0 === d)
            return !1;
        a = Date.now();
        void 0 === this.g && (this.g = a);
        if (!this.j || 400 < a - this.g)
            this.j = 4 > Math.abs(d) ? Tg : Ug;
        if (this.j === Tg) {
            b = b.$();
            this.o ? clearTimeout(this.o) : Rf(b, 1, 1);
            this.o = setTimeout(this.C.bind(this), 400);
            d = b.Ua() * Math.pow(2, d / 300);
            var c = b.i, e = b.a, f = 0;
            d < c ? (d = Math.max(d, c / 1.5), f = 1) : d > e && (d = Math.min(d, 1.5 * e), f = -1);
            if (this.a) {
                var g = Sf(b, d, this.a);
                b.wb(b.Ec(g));
            }
            b.Xc(d);
            0 < f ? b.animate({
                resolution: c,
                easing: fd,
                anchor: this.a,
                duration: 500
            }) : 0 > f && b.animate({
                resolution: e,
                easing: fd,
                anchor: this.a,
                duration: 500
            });
            this.g = a;
            return !1;
        }
        this.l += d;
        a = Math.max(this.Y - (a - this.g), 0);
        clearTimeout(this.u);
        this.u = setTimeout(this.G.bind(this, b), a);
        return !1;
    }
    Rg.prototype.C = function () {
        this.o = void 0;
        Rf(this.v.$(), 1, -1);
    };
    Rg.prototype.G = function (a) {
        a = a.$();
        0 < ld(a)[0] && md(a);
        cg(a, -wa(this.l, -1, 1), this.a, this.R);
        this.j = void 0;
        this.l = 0;
        this.a = null;
        this.u = this.g = void 0;
    };
    Rg.prototype.S = function (a) {
        this.A = a;
        a || (this.a = null);
    };
    var Tg = 'trackpad', Ug = 'wheel';
    function Vg(a) {
        pg.call(this, {
            handleDownEvent: Wg,
            handleDragEvent: Xg,
            handleUpEvent: Yg
        });
        a = a || {};
        this.g = null;
        this.j = void 0;
        this.a = !1;
        this.o = 0;
        this.C = void 0 !== a.threshold ? a.threshold : 0.3;
        this.u = void 0 !== a.duration ? a.duration : 250;
    }
    u(Vg, pg);
    function Xg(a) {
        var b = 0, c = this.l[0], d = this.l[1], c = Math.atan2(d.clientY - c.clientY, d.clientX - c.clientX);
        void 0 !== this.j && (b = c - this.j, this.o += b, !this.a && Math.abs(this.o) > this.C && (this.a = !0));
        this.j = c;
        a = a.map;
        c = a.c.getBoundingClientRect();
        d = rg(this.l);
        d[0] -= c.left;
        d[1] -= c.top;
        this.g = a.Za(d);
        this.a && (c = a.$(), d = c.Va(), a.render(), bg(c, d + b, this.g));
    }
    function Yg(a) {
        if (2 > this.l.length) {
            a = a.map.$();
            Rf(a, 1, -1);
            if (this.a) {
                var b = a.Va(), c = this.g, d = this.u, b = a.constrainRotation(b, 0);
                bg(a, b, c, d);
            }
            return !1;
        }
        return !0;
    }
    function Wg(a) {
        return 2 <= this.l.length ? (a = a.map, this.g = null, this.j = void 0, this.a = !1, this.o = 0, this.A || Rf(a.$(), 1, 1), !0) : !1;
    }
    Vg.prototype.Zc = bf;
    function Zg(a) {
        pg.call(this, {
            handleDownEvent: $g,
            handleDragEvent: ah,
            handleUpEvent: bh
        });
        a = a ? a : {};
        this.o = a.constrainResolution || !1;
        this.g = null;
        this.u = void 0 !== a.duration ? a.duration : 400;
        this.a = void 0;
        this.j = 1;
    }
    u(Zg, pg);
    function ah(a) {
        var b = 1, c = this.l[0], d = this.l[1], e = c.clientX - d.clientX, c = c.clientY - d.clientY, e = Math.sqrt(e * e + c * c);
        void 0 !== this.a && (b = this.a / e);
        this.a = e;
        a = a.map;
        var e = a.$(), d = e.Ua(), f = e.a, g = e.i, c = d * b;
        c > f ? (b = f / d, c = f) : c < g && (b = g / d, c = g);
        1 != b && (this.j = b);
        b = a.c.getBoundingClientRect();
        d = rg(this.l);
        d[0] -= b.left;
        d[1] -= b.top;
        this.g = a.Za(d);
        a.render();
        dg(e, c, this.g);
    }
    function bh(a) {
        if (2 > this.l.length) {
            a = a.map.$();
            Rf(a, 1, -1);
            var b = a.Ua();
            if (this.o || b < a.i || b > a.a) {
                var c = this.g, d = this.u, b = a.constrainResolution(b, 0, this.j - 1);
                dg(a, b, c, d);
            }
            return !1;
        }
        return !0;
    }
    function $g(a) {
        return 2 <= this.l.length ? (a = a.map, this.g = null, this.a = void 0, this.j = 1, this.A || Rf(a.$(), 1, 1), !0) : !1;
    }
    Zg.prototype.Zc = bf;
    function ch(a) {
        a = a ? a : {};
        var b = new D(), c = new Zf(-0.005, 0.05, 100);
        (void 0 !== a.altShiftDragRotate ? a.altShiftDragRotate : 1) && b.push(new wg());
        (void 0 !== a.doubleClickZoom ? a.doubleClickZoom : 1) && b.push(new eg({
            delta: a.zoomDelta,
            duration: a.zoomDuration
        }));
        (void 0 !== a.dragPan ? a.dragPan : 1) && b.push(new sg({ kinetic: c }));
        (void 0 !== a.pinchRotate ? a.pinchRotate : 1) && b.push(new Vg());
        (void 0 !== a.pinchZoom ? a.pinchZoom : 1) && b.push(new Zg({ duration: a.zoomDuration }));
        if (void 0 !== a.keyboard ? a.keyboard : 1)
            b.push(new Ng()), b.push(new Pg({
                delta: a.zoomDelta,
                duration: a.zoomDuration
            }));
        (void 0 !== a.mouseWheelZoom ? a.mouseWheelZoom : 1) && b.push(new Rg({ duration: a.zoomDuration }));
        (void 0 !== a.shiftDragZoom ? a.shiftDragZoom : 1) && b.push(new Mg({ duration: a.zoomDuration }));
        return b;
    }
    function dh(a) {
        Gc.call(this);
        var b = pb({}, a);
        b.opacity = void 0 !== a.opacity ? a.opacity : 1;
        b.visible = void 0 !== a.visible ? a.visible : !0;
        b.zIndex = void 0 !== a.zIndex ? a.zIndex : 0;
        b.maxResolution = void 0 !== a.maxResolution ? a.maxResolution : Infinity;
        b.minResolution = void 0 !== a.minResolution ? a.minResolution : 0;
        this.H(b);
        this.a = {
            layer: this,
            De: !0
        };
    }
    u(dh, Gc);
    function eh(a) {
        a.a.opacity = wa(a.ic(), 0, 1);
        a.a.Ui = a.Nf();
        a.a.visible = a.Kb();
        a.a.extent = a.D();
        a.a.zIndex = a.za();
        a.a.maxResolution = a.gc();
        a.a.minResolution = Math.max(a.hc(), 0);
        return a.a;
    }
    k = dh.prototype;
    k.D = function () {
        return this.get('extent');
    };
    k.gc = function () {
        return this.get('maxResolution');
    };
    k.hc = function () {
        return this.get('minResolution');
    };
    k.ic = function () {
        return this.get('opacity');
    };
    k.Kb = function () {
        return this.get('visible');
    };
    k.za = function () {
        return this.get('zIndex');
    };
    k.uc = function (a) {
        this.set('extent', a);
    };
    k.zc = function (a) {
        this.set('maxResolution', a);
    };
    k.Ac = function (a) {
        this.set('minResolution', a);
    };
    k.vc = function (a) {
        this.set('opacity', a);
    };
    k.wc = function (a) {
        this.set('visible', a);
    };
    k.Wb = function (a) {
        this.set('zIndex', a);
    };
    function fh(a) {
        var b = a || {};
        a = pb({}, b);
        delete a.layers;
        b = b.layers;
        dh.call(this, a);
        this.i = [];
        this.c = {};
        B(this, Ic(gh), this.nl, this);
        b ? Array.isArray(b) ? b = new D(b.slice()) : qa(b instanceof D, 43) : b = new D();
        this.Sh(b);
    }
    u(fh, dh);
    k = fh.prototype;
    k.Dd = function () {
    };
    k.ze = function () {
        this.Kb() && this.s();
    };
    k.nl = function () {
        this.i.forEach(rc);
        this.i.length = 0;
        var a = this.od();
        this.i.push(B(a, 'add', this.ml, this), B(a, 'remove', this.ol, this));
        for (var b in this.c)
            this.c[b].forEach(rc);
        qb(this.c);
        var a = a.a, c, d;
        b = 0;
        for (c = a.length; b < c; b++)
            d = a[b], this.c[w(d).toString()] = [
                B(d, 'propertychange', this.ze, this),
                B(d, 'change', this.ze, this)
            ];
        this.s();
    };
    k.ml = function (a) {
        a = a.element;
        var b = w(a).toString();
        this.c[b] = [
            B(a, 'propertychange', this.ze, this),
            B(a, 'change', this.ze, this)
        ];
        this.s();
    };
    k.ol = function (a) {
        a = w(a.element).toString();
        this.c[a].forEach(rc);
        delete this.c[a];
        this.s();
    };
    k.od = function () {
        return this.get(gh);
    };
    k.Sh = function (a) {
        this.set(gh, a);
    };
    k.Lf = function (a) {
        var b = void 0 !== a ? a : [], c = b.length;
        this.od().forEach(function (a) {
            a.Lf(b);
        });
        a = eh(this);
        var d, e;
        for (d = b.length; c < d; c++)
            e = b[c], e.opacity *= a.opacity, e.visible = e.visible && a.visible, e.maxResolution = Math.min(e.maxResolution, a.maxResolution), e.minResolution = Math.max(e.minResolution, a.minResolution), void 0 !== a.extent && (e.extent = void 0 !== e.extent ? lb(e.extent, a.extent) : a.extent);
        return b;
    };
    k.Nf = function () {
        return 'ready';
    };
    var gh = 'layers';
    function hh(a) {
        yb.call(this, {
            code: a,
            units: 'm',
            extent: ih,
            global: !0,
            worldExtent: jh,
            getPointResolution: function (a, c) {
                return a / xa(c[1] / 6378137);
            }
        });
    }
    u(hh, yb);
    var kh = 6378137 * Math.PI, ih = [
            -kh,
            -kh,
            kh,
            kh
        ], jh = [
            -180,
            -85,
            180,
            85
        ], Lb = 'EPSG:3857 EPSG:102100 EPSG:102113 EPSG:900913 urn:ogc:def:crs:EPSG:6.18:3:3857 urn:ogc:def:crs:EPSG::3857 http://www.opengis.net/gml/srs/epsg.xml#3857'.split(' ').map(function (a) {
            return new hh(a);
        });
    function Mb(a, b, c) {
        var d = a.length;
        c = 1 < c ? c : 2;
        void 0 === b && (2 < c ? b = a.slice() : b = Array(d));
        for (var e = 0; e < d; e += c) {
            b[e] = kh * a[e] / 180;
            var f = 6378137 * Math.log(Math.tan(Math.PI * (a[e + 1] + 90) / 360));
            f > kh ? f = kh : f < -kh && (f = -kh);
            b[e + 1] = f;
        }
        return b;
    }
    function Nb(a, b, c) {
        var d = a.length;
        c = 1 < c ? c : 2;
        void 0 === b && (2 < c ? b = a.slice() : b = Array(d));
        for (var e = 0; e < d; e += c)
            b[e] = 180 * a[e] / kh, b[e + 1] = 360 * Math.atan(Math.exp(a[e + 1] / 6378137)) / Math.PI - 90;
        return b;
    }
    var mh = new tb(6378137);
    function nh(a, b) {
        yb.call(this, {
            code: a,
            units: 'degrees',
            extent: oh,
            axisOrientation: b,
            global: !0,
            metersPerUnit: ph,
            worldExtent: oh
        });
    }
    u(nh, yb);
    var oh = [
            -180,
            -90,
            180,
            90
        ], ph = Math.PI * mh.radius / 180, Ob = [
            new nh('CRS:84'),
            new nh('EPSG:4326', 'neu'),
            new nh('urn:ogc:def:crs:EPSG::4326', 'neu'),
            new nh('urn:ogc:def:crs:EPSG:6.6:4326', 'neu'),
            new nh('urn:ogc:def:crs:OGC:1.3:CRS84'),
            new nh('urn:ogc:def:crs:OGC:2:84'),
            new nh('http://www.opengis.net/gml/srs/epsg.xml#4326', 'neu'),
            new nh('urn:x-ogc:def:crs:EPSG:4326', 'neu')
        ];
    function qh() {
        Hb(Lb);
        Hb(Ob);
        Kb();
    }
    function rh(a) {
        var b = pb({}, a);
        delete b.source;
        dh.call(this, b);
        this.u = this.o = this.j = null;
        a.map && this.setMap(a.map);
        B(this, Ic('source'), this.Al, this);
        this.Yc(a.source ? a.source : null);
    }
    u(rh, dh);
    function sh(a, b) {
        return a.visible && b >= a.minResolution && b < a.maxResolution;
    }
    k = rh.prototype;
    k.Lf = function (a) {
        a = a ? a : [];
        a.push(eh(this));
        return a;
    };
    k.la = function () {
        return this.get('source') || null;
    };
    k.Nf = function () {
        var a = this.la();
        return a ? a.V() : 'undefined';
    };
    k.kn = function () {
        this.s();
    };
    k.Al = function () {
        this.u && (rc(this.u), this.u = null);
        var a = this.la();
        a && (this.u = B(a, 'change', this.kn, this));
        this.s();
    };
    k.setMap = function (a) {
        this.j && (rc(this.j), this.j = null);
        a || this.s();
        this.o && (rc(this.o), this.o = null);
        a && (this.j = B(a, 'precompose', function (a) {
            var b = eh(this);
            b.De = !1;
            b.zIndex = Infinity;
            a.frameState.layerStatesArray.push(b);
            a.frameState.layerStates[w(this)] = b;
        }, this), this.o = B(this, 'change', a.render, a), this.s());
    };
    k.Yc = function (a) {
        this.set('source', a);
    };
    function th() {
        this.b = {};
        this.a = 0;
    }
    th.prototype.clear = function () {
        this.b = {};
        this.a = 0;
    };
    th.prototype.get = function (a, b, c) {
        a = b + ':' + a + ':' + (c ? Sc(c) : 'null');
        return a in this.b ? this.b[a] : null;
    };
    th.prototype.set = function (a, b, c, d) {
        this.b[b + ':' + a + ':' + (c ? Sc(c) : 'null')] = d;
        ++this.a;
    };
    var uh = new th();
    var vh = Array(6);
    function wh() {
        return [
            1,
            0,
            0,
            1,
            0,
            0
        ];
    }
    function xh(a) {
        return yh(a, 1, 0, 0, 1, 0, 0);
    }
    function zh(a, b) {
        var c = a[0], d = a[1], e = a[2], f = a[3], g = a[4], h = a[5], l = b[0], m = b[1], p = b[2], n = b[3], q = b[4], r = b[5];
        a[0] = c * l + e * m;
        a[1] = d * l + f * m;
        a[2] = c * p + e * n;
        a[3] = d * p + f * n;
        a[4] = c * q + e * r + g;
        a[5] = d * q + f * r + h;
        return a;
    }
    function yh(a, b, c, d, e, f, g) {
        a[0] = b;
        a[1] = c;
        a[2] = d;
        a[3] = e;
        a[4] = f;
        a[5] = g;
        return a;
    }
    function Ah(a, b) {
        a[0] = b[0];
        a[1] = b[1];
        a[2] = b[2];
        a[3] = b[3];
        a[4] = b[4];
        a[5] = b[5];
        return a;
    }
    function Bh(a, b) {
        var c = b[0], d = b[1];
        b[0] = a[0] * c + a[2] * d + a[4];
        b[1] = a[1] * c + a[3] * d + a[5];
        return b;
    }
    function Ch(a, b) {
        var c = Math.cos(b), d = Math.sin(b);
        zh(a, yh(vh, c, d, -d, c, 0, 0));
    }
    function Dh(a, b, c) {
        return zh(a, yh(vh, b, 0, 0, c, 0, 0));
    }
    function Eh(a, b, c) {
        zh(a, yh(vh, 1, 0, 0, 1, b, c));
    }
    function Fh(a, b, c, d, e, f, g, h) {
        var l = Math.sin(f);
        f = Math.cos(f);
        a[0] = d * f;
        a[1] = e * l;
        a[2] = -d * l;
        a[3] = e * f;
        a[4] = g * d * f - h * d * l + b;
        a[5] = g * e * l + h * e * f + c;
        return a;
    }
    function Gh(a) {
        var b = a[0] * a[3] - a[1] * a[2];
        qa(!!b, 32);
        var c = a[0], d = a[1], e = a[2], f = a[3], g = a[4], h = a[5];
        a[0] = f / b;
        a[1] = -d / b;
        a[2] = -e / b;
        a[3] = c / b;
        a[4] = (e * h - f * g) / b;
        a[5] = -(c * h - d * g) / b;
        return a;
    }
    function Hh(a, b) {
        this.j = b;
        this.c = {};
        this.v = {};
    }
    u(Hh, zc);
    function Ih(a) {
        var b = a.viewState, c = a.coordinateToPixelTransform, d = a.pixelToCoordinateTransform;
        Fh(c, a.size[0] / 2, a.size[1] / 2, 1 / b.resolution, -1 / b.resolution, -b.rotation, -b.center[0], -b.center[1]);
        Gh(Ah(d, c));
    }
    k = Hh.prototype;
    k.ra = function () {
        for (var a in this.c)
            Ac(this.c[a]);
    };
    function Jh() {
        if (32 < uh.a) {
            var a = 0, b, c;
            for (b in uh.b)
                c = uh.b[b], a++ & 3 || Ec(c) || (delete uh.b[b], --uh.a);
        }
    }
    k.Aa = function (a, b, c, d, e, f, g) {
        function h(a, c) {
            var f = w(a).toString(), g = b.layerStates[w(c)].De;
            if (!(f in b.skippedFeatureUids) || g)
                return d.call(e, a, g ? c : null);
        }
        var l, m = b.viewState, p = m.resolution, n = m.projection, m = a;
        if (n.a) {
            var n = n.D(), q = hb(n), r = a[0];
            if (r < n[0] || r > n[2])
                m = [
                    r + q * Math.ceil((n[0] - r) / q),
                    a[1]
                ];
        }
        n = b.layerStatesArray;
        for (q = n.length - 1; 0 <= q; --q) {
            var v = n[q], r = v.layer;
            if (sh(v, p) && f.call(g, r) && (v = Kh(this, r), r.la() && (l = v.Aa(r.la().G ? m : a, b, c, h, e)), l))
                return l;
        }
    };
    k.Zh = function (a, b, c, d, e) {
        return void 0 !== this.Aa(a, b, c, af, this, d, e);
    };
    function Kh(a, b) {
        var c = w(b).toString();
        if (c in a.c)
            return a.c[c];
        var d = b.Dd(a);
        a.c[c] = d;
        a.v[c] = B(d, 'change', a.ll, a);
        return d;
    }
    k.ll = function () {
        this.j.render();
    };
    k.vg = na;
    k.gp = function (a, b) {
        for (var c in this.c)
            if (!(b && c in b.layerStates)) {
                var d = c, e = this.c[d];
                delete this.c[d];
                rc(this.v[d]);
                delete this.v[d];
                Ac(e);
            }
    };
    function Lh(a, b) {
        for (var c in a.c)
            if (!(c in b.layerStates)) {
                b.postRenderFunctions.push(a.gp.bind(a));
                break;
            }
    }
    function ka(a, b) {
        return a.zIndex - b.zIndex;
    }
    function Mh(a, b, c, d, e) {
        Bc.call(this, a);
        this.vectorContext = b;
        this.frameState = c;
        this.context = d;
        this.glContext = e;
    }
    u(Mh, Bc);
    var Nh = [
            0,
            0,
            0,
            1
        ], Oh = [], Ph = [
            0,
            0,
            0,
            1
        ];
    function Qh(a, b, c, d) {
        b && (a.translate(c, d), a.rotate(b), a.translate(-c, -d));
    }
    function Rh() {
    }
    k = Rh.prototype;
    k.mc = function () {
    };
    k.pd = function () {
    };
    k.$b = function () {
    };
    k.oe = function () {
    };
    k.pe = function () {
    };
    k.Qb = function () {
    };
    k.nc = function () {
    };
    k.oc = function () {
    };
    k.pc = function () {
    };
    k.qc = function () {
    };
    k.rc = function () {
    };
    k.xc = function () {
    };
    k.Na = function () {
    };
    k.Vb = function () {
    };
    k.Tb = function () {
    };
    function Sh(a, b, c, d, e) {
        this.f = a;
        this.I = b;
        this.c = c;
        this.u = d;
        this.mb = e;
        this.M = this.b = this.a = this.$a = this.S = this.R = null;
        this.eb = this.Y = this.o = this.G = this.C = this.A = 0;
        this.ea = !1;
        this.i = this.ia = 0;
        this.oa = !1;
        this.qa = 0;
        this.Fa = '';
        this.Ja = this.Zb = 0;
        this.Ha = !1;
        this.l = this.Oa = 0;
        this.ta = this.j = this.g = null;
        this.v = [];
        this.lb = wh();
    }
    u(Sh, Rh);
    function Th(a, b, c) {
        if (a.M) {
            b = df(b, 0, c, 2, a.u, a.v);
            c = a.f;
            var d = a.lb, e = c.globalAlpha;
            1 != a.o && (c.globalAlpha = e * a.o);
            var f = a.ia;
            a.ea && (f += a.mb);
            var g, h;
            g = 0;
            for (h = b.length; g < h; g += 2) {
                var l = b[g] - a.A, m = b[g + 1] - a.C;
                a.oa && (l = Math.round(l), m = Math.round(m));
                if (f || 1 != a.i) {
                    var p = l + a.A, n = m + a.C;
                    Fh(d, p, n, a.i, a.i, f, -p, -n);
                    c.setTransform.apply(c, d);
                }
                c.drawImage(a.M, a.Y, a.eb, a.qa, a.G, l, m, a.qa, a.G);
            }
            (f || 1 != a.i) && c.setTransform(1, 0, 0, 1, 0, 0);
            1 != a.o && (c.globalAlpha = e);
        }
    }
    function Uh(a, b, c, d) {
        var e = 0;
        if (a.ta && '' !== a.Fa) {
            a.g && Vh(a, a.g);
            a.j && Wh(a, a.j);
            var f = a.ta, g = a.f, h = a.$a;
            h ? (h.font != f.font && (h.font = g.font = f.font), h.textAlign != f.textAlign && (h.textAlign = g.textAlign = f.textAlign), h.textBaseline != f.textBaseline && (h.textBaseline = g.textBaseline = f.textBaseline)) : (g.font = f.font, g.textAlign = f.textAlign, g.textBaseline = f.textBaseline, a.$a = {
                font: f.font,
                textAlign: f.textAlign,
                textBaseline: f.textBaseline
            });
            b = df(b, e, c, d, a.u, a.v);
            f = a.f;
            g = a.Oa;
            for (a.Ha && (g += a.mb); e < c; e += d) {
                var h = b[e] + a.Zb, l = b[e + 1] + a.Ja;
                if (g || 1 != a.l) {
                    var m = Fh(a.lb, h, l, a.l, a.l, g, -h, -l);
                    f.setTransform.apply(f, m);
                }
                a.j && f.strokeText(a.Fa, h, l);
                a.g && f.fillText(a.Fa, h, l);
            }
            (g || 1 != a.l) && f.setTransform(1, 0, 0, 1, 0, 0);
        }
    }
    function Xh(a, b, c, d, e, f) {
        var g = a.f;
        a = df(b, c, d, e, a.u, a.v);
        g.moveTo(a[0], a[1]);
        b = a.length;
        f && (b -= 2);
        for (c = 2; c < b; c += 2)
            g.lineTo(a[c], a[c + 1]);
        f && g.closePath();
        return d;
    }
    function Yh(a, b, c, d, e) {
        var f, g;
        f = 0;
        for (g = d.length; f < g; ++f)
            c = Xh(a, b, c, d[f], e, !0);
        return c;
    }
    k = Sh.prototype;
    k.$b = function (a) {
        if (mb(this.c, a.D())) {
            if (this.a || this.b) {
                this.a && Vh(this, this.a);
                this.b && Wh(this, this.b);
                var b;
                b = this.u;
                var c = this.v, d = a.ha();
                b = d ? df(d, 0, d.length, a.sa(), b, c) : null;
                c = b[2] - b[0];
                d = b[3] - b[1];
                c = Math.sqrt(c * c + d * d);
                d = this.f;
                d.beginPath();
                d.arc(b[0], b[1], c, 0, 2 * Math.PI);
                this.a && d.fill();
                this.b && d.stroke();
            }
            '' !== this.Fa && Uh(this, a.Ba(), 2, 2);
        }
    };
    k.pd = function (a) {
        this.Na(a.Ca(), a.Da());
        this.Vb(a.Z());
        this.Tb(a.Pa());
    };
    k.mc = function (a) {
        switch (a.T()) {
        case 'Point':
            this.qc(a);
            break;
        case 'LineString':
            this.Qb(a);
            break;
        case 'Polygon':
            this.rc(a);
            break;
        case 'MultiPoint':
            this.oc(a);
            break;
        case 'MultiLineString':
            this.nc(a);
            break;
        case 'MultiPolygon':
            this.pc(a);
            break;
        case 'GeometryCollection':
            this.pe(a);
            break;
        case 'Circle':
            this.$b(a);
        }
    };
    k.oe = function (a, b) {
        var c = (0, b.Ra)(a);
        c && mb(this.c, c.D()) && (this.pd(b), this.mc(c));
    };
    k.pe = function (a) {
        a = a.a;
        var b, c;
        b = 0;
        for (c = a.length; b < c; ++b)
            this.mc(a[b]);
    };
    k.qc = function (a) {
        var b = a.ha();
        a = a.sa();
        this.M && Th(this, b, b.length);
        '' !== this.Fa && Uh(this, b, b.length, a);
    };
    k.oc = function (a) {
        var b = a.ha();
        a = a.sa();
        this.M && Th(this, b, b.length);
        '' !== this.Fa && Uh(this, b, b.length, a);
    };
    k.Qb = function (a) {
        if (mb(this.c, a.D())) {
            if (this.b) {
                Wh(this, this.b);
                var b = this.f, c = a.ha();
                b.beginPath();
                Xh(this, c, 0, c.length, a.sa(), !1);
                b.stroke();
            }
            '' !== this.Fa && (a = Zh(a), Uh(this, a, 2, 2));
        }
    };
    k.nc = function (a) {
        var b = a.D();
        if (mb(this.c, b)) {
            if (this.b) {
                Wh(this, this.b);
                var b = this.f, c = a.ha(), d = 0, e = a.Rb(), f = a.sa();
                b.beginPath();
                var g, h;
                g = 0;
                for (h = e.length; g < h; ++g)
                    d = Xh(this, c, d, e[g], f, !1);
                b.stroke();
            }
            '' !== this.Fa && (a = $h(a), Uh(this, a, a.length, 2));
        }
    };
    k.rc = function (a) {
        if (mb(this.c, a.D())) {
            if (this.b || this.a) {
                this.a && Vh(this, this.a);
                this.b && Wh(this, this.b);
                var b = this.f;
                b.beginPath();
                Yh(this, a.fc(), 0, a.Rb(), a.sa());
                this.a && b.fill();
                this.b && b.stroke();
            }
            '' !== this.Fa && (a = Lf(a), Uh(this, a, 2, 2));
        }
    };
    k.pc = function (a) {
        if (mb(this.c, a.D())) {
            if (this.b || this.a) {
                this.a && Vh(this, this.a);
                this.b && Wh(this, this.b);
                var b = this.f, c = ai(a), d = 0, e = a.c, f = a.sa(), g, h;
                b.beginPath();
                g = 0;
                for (h = e.length; g < h; ++g)
                    d = Yh(this, c, d, e[g], f);
                this.a && b.fill();
                this.b && b.stroke();
            }
            '' !== this.Fa && (a = bi(a), Uh(this, a, a.length, 2));
        }
    };
    function Vh(a, b) {
        var c = a.f, d = a.R;
        d ? d.fillStyle != b.fillStyle && (d.fillStyle = c.fillStyle = b.fillStyle) : (c.fillStyle = b.fillStyle, a.R = { fillStyle: b.fillStyle });
    }
    function Wh(a, b) {
        var c = a.f, d = a.S;
        d ? (d.lineCap != b.lineCap && (d.lineCap = c.lineCap = b.lineCap), Ld && !ia(d.lineDash, b.lineDash) && c.setLineDash(d.lineDash = b.lineDash), d.lineJoin != b.lineJoin && (d.lineJoin = c.lineJoin = b.lineJoin), d.lineWidth != b.lineWidth && (d.lineWidth = c.lineWidth = b.lineWidth), d.miterLimit != b.miterLimit && (d.miterLimit = c.miterLimit = b.miterLimit), d.strokeStyle != b.strokeStyle && (d.strokeStyle = c.strokeStyle = b.strokeStyle)) : (c.lineCap = b.lineCap, Ld && c.setLineDash(b.lineDash), c.lineJoin = b.lineJoin, c.lineWidth = b.lineWidth, c.miterLimit = b.miterLimit, c.strokeStyle = b.strokeStyle, a.S = {
            lineCap: b.lineCap,
            lineDash: b.lineDash,
            lineJoin: b.lineJoin,
            lineWidth: b.lineWidth,
            miterLimit: b.miterLimit,
            strokeStyle: b.strokeStyle
        });
    }
    k.Na = function (a, b) {
        if (a) {
            var c = a.b;
            this.a = { fillStyle: Vc(c ? c : Nh) };
        } else
            this.a = null;
        if (b) {
            var c = b.a, d = b.i, e = b.f, f = b.g, g = b.l, h = b.c, l = b.j;
            this.b = {
                lineCap: void 0 !== d ? d : 'round',
                lineDash: e ? e : Oh,
                lineDashOffset: f ? f : 0,
                lineJoin: void 0 !== g ? g : 'round',
                lineWidth: this.I * (void 0 !== h ? h : 1),
                miterLimit: void 0 !== l ? l : 10,
                strokeStyle: Vc(c ? c : Ph)
            };
        } else
            this.b = null;
    };
    k.Vb = function (a) {
        if (a) {
            var b = a.Hc(), c = a.Z(1), d = a.Pc(), e = a.jc();
            this.A = b[0];
            this.C = b[1];
            this.G = e[1];
            this.M = c;
            this.o = a.g;
            this.Y = d[0];
            this.eb = d[1];
            this.ea = a.o;
            this.ia = a.l;
            this.i = a.c;
            this.oa = a.v;
            this.qa = e[0];
        } else
            this.M = null;
    };
    k.Tb = function (a) {
        if (a) {
            var b = a.Ca();
            b ? (b = b.b, this.g = { fillStyle: Vc(b ? b : Nh) }) : this.g = null;
            var c = a.Da();
            if (c) {
                var b = c.a, d = c.i, e = c.f, f = c.g, g = c.l, h = c.c, c = c.j;
                this.j = {
                    lineCap: void 0 !== d ? d : 'round',
                    lineDash: e ? e : Oh,
                    lineDashOffset: f ? f : 0,
                    lineJoin: void 0 !== g ? g : 'round',
                    lineWidth: void 0 !== h ? h : 1,
                    miterLimit: void 0 !== c ? c : 10,
                    strokeStyle: Vc(b ? b : Ph)
                };
            } else
                this.j = null;
            var b = a.a, d = a.f, e = a.c, f = a.j, g = a.i, h = a.b, c = a.Pa(), l = a.g;
            a = a.l;
            this.ta = {
                font: void 0 !== b ? b : '10px sans-serif',
                textAlign: void 0 !== l ? l : 'center',
                textBaseline: void 0 !== a ? a : 'middle'
            };
            this.Fa = void 0 !== c ? c : '';
            this.Zb = void 0 !== d ? this.I * d : 0;
            this.Ja = void 0 !== e ? this.I * e : 0;
            this.Ha = void 0 !== f ? f : !1;
            this.Oa = void 0 !== g ? g : 0;
            this.l = this.I * (void 0 !== h ? h : 1);
        } else
            this.Fa = '';
    };
    function ci(a, b) {
        Hh.call(this, 0, b);
        this.f = Xc();
        this.b = this.f.canvas;
        this.b.style.width = '100%';
        this.b.style.height = '100%';
        this.b.style.display = 'block';
        this.b.className = 'ol-unselectable';
        a.insertBefore(this.b, a.childNodes[0] || null);
        this.a = !0;
        this.i = wh();
    }
    u(ci, Hh);
    function di(a, b, c) {
        var d = a.j, e = a.f;
        if (Ec(d, b)) {
            var f = c.extent, g = c.pixelRatio, h = c.viewState.rotation, l = c.viewState, m = c.pixelRatio / l.resolution;
            a = Fh(a.i, a.b.width / 2, a.b.height / 2, m, -m, -l.rotation, -l.center[0], -l.center[1]);
            d.b(new Mh(b, new Sh(e, g, f, a, h), c, e, null));
        }
    }
    ci.prototype.T = function () {
        return 'canvas';
    };
    ci.prototype.vg = function (a) {
        if (a) {
            var b = this.f, c = a.pixelRatio, d = Math.round(a.size[0] * c), e = Math.round(a.size[1] * c);
            this.b.width != d || this.b.height != e ? (this.b.width = d, this.b.height = e) : b.clearRect(0, 0, d, e);
            c = a.viewState.rotation;
            Ih(a);
            di(this, 'precompose', a);
            var f = a.layerStatesArray;
            ja(f);
            c && (b.save(), Qh(b, c, d / 2, e / 2));
            var d = a.viewState.resolution, g, h, l, e = 0;
            for (g = f.length; e < g; ++e)
                l = f[e], h = l.layer, h = Kh(this, h), sh(l, d) && 'ready' == l.Ui && h.qd(a, l) && h.I(a, l, b);
            c && b.restore();
            di(this, 'postcompose', a);
            this.a || (this.b.style.display = '', this.a = !0);
            Lh(this, a);
            a.postRenderFunctions.push(Jh);
        } else
            this.a && (this.b.style.display = 'none', this.a = !1);
    };
    ci.prototype.Yh = function (a, b, c, d, e, f) {
        var g, h = b.viewState.resolution, l = b.layerStatesArray, m = l.length;
        a = Bh(b.pixelToCoordinateTransform, a.slice());
        for (--m; 0 <= m; --m) {
            g = l[m];
            var p = g.layer;
            if (sh(g, h) && e.call(f, p) && (g = Kh(this, p).v(a, b, c, d)))
                return g;
        }
    };
    var ei = [
        'Polygon',
        'Circle',
        'LineString',
        'Image',
        'Text'
    ];
    function fi() {
    }
    function gi(a) {
        this.b = a;
    }
    function hi(a) {
        this.b = a;
    }
    u(hi, gi);
    hi.prototype.T = function () {
        return 35632;
    };
    function ii(a) {
        this.b = a;
    }
    u(ii, gi);
    ii.prototype.T = function () {
        return 35633;
    };
    function ji() {
        this.b = 'precision mediump float;varying vec2 a;varying vec2 b;varying float c;varying float d;uniform float m;uniform vec4 n;uniform vec4 o;uniform vec2 p;void main(void){vec2 windowCenter=vec2((a.x+1.0)/2.0*p.x*d,(a.y+1.0)/2.0*p.y*d);vec2 windowOffset=vec2((b.x+1.0)/2.0*p.x*d,(b.y+1.0)/2.0*p.y*d);float radius=length(windowCenter-windowOffset);float dist=length(windowCenter-gl_FragCoord.xy);if(dist>radius+c){if(o.a==0.0){gl_FragColor=n;}else{gl_FragColor=o;}gl_FragColor.a=gl_FragColor.a-(dist-(radius+c));}else if(n.a==0.0){gl_FragColor=o;if(dist<radius-c){gl_FragColor.a=gl_FragColor.a-(radius-c-dist);}} else{gl_FragColor=n;float strokeDist=radius-c;float antialias=2.0*d;if(dist>strokeDist){gl_FragColor=o;}else if(dist>=strokeDist-antialias){float step=smoothstep(strokeDist-antialias,strokeDist,dist);gl_FragColor=mix(n,o,step);}} gl_FragColor.a=gl_FragColor.a*m;if(gl_FragColor.a<=0.0){discard;}}';
    }
    u(ji, hi);
    var ki = new ji();
    function li() {
        this.b = 'varying vec2 a;varying vec2 b;varying float c;varying float d;attribute vec2 e;attribute float f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;uniform float k;uniform float l;void main(void){mat4 offsetMatrix=i*j;a=vec4(h*vec4(e,0.0,1.0)).xy;d=l;float lineWidth=k*l;c=lineWidth/2.0;if(lineWidth==0.0){lineWidth=2.0*l;}vec2 offset;float radius=g+3.0*l;if(f==0.0){offset=vec2(-1.0,1.0);}else if(f==1.0){offset=vec2(-1.0,-1.0);}else if(f==2.0){offset=vec2(1.0,-1.0);}else{offset=vec2(1.0,1.0);}gl_Position=h*vec4(e+offset*radius,0.0,1.0)+offsetMatrix*vec4(offset*lineWidth,0.0,0.0);b=vec4(h*vec4(e.x+g,e.y,0.0,1.0)).xy;if(distance(a,b)>20000.0){gl_Position=vec4(a,0.0,1.0);}}';
    }
    u(li, ii);
    var mi = new li();
    function ni(a, b) {
        this.G = a.getUniformLocation(b, 'n');
        this.qa = a.getUniformLocation(b, 'k');
        this.c = a.getUniformLocation(b, 'j');
        this.i = a.getUniformLocation(b, 'i');
        this.a = a.getUniformLocation(b, 'm');
        this.ta = a.getUniformLocation(b, 'l');
        this.f = a.getUniformLocation(b, 'h');
        this.R = a.getUniformLocation(b, 'p');
        this.S = a.getUniformLocation(b, 'o');
        this.l = a.getAttribLocation(b, 'f');
        this.b = a.getAttribLocation(b, 'e');
        this.u = a.getAttribLocation(b, 'g');
    }
    function oi() {
        return [
            1,
            0,
            0,
            0,
            0,
            1,
            0,
            0,
            0,
            0,
            1,
            0,
            0,
            0,
            0,
            1
        ];
    }
    function pi(a, b) {
        a[0] = b[0];
        a[1] = b[1];
        a[4] = b[2];
        a[5] = b[3];
        a[12] = b[4];
        a[13] = b[5];
        return a;
    }
    function qi(a, b) {
        this.origin = jb(b);
        this.mb = wh();
        this.Oa = wh();
        this.lb = wh();
        this.Ja = oi();
        this.b = [];
        this.o = null;
        this.f = [];
        this.g = [];
        this.a = [];
        this.v = null;
        this.l = void 0;
    }
    u(qi, Rh);
    qi.prototype.i = function (a, b, c, d, e, f, g, h, l, m, p) {
        var n = a.b, q, r, v, x, y, z, A, V;
        this.l && (q = n.isEnabled(n.STENCIL_TEST), r = n.getParameter(n.STENCIL_FUNC), v = n.getParameter(n.STENCIL_VALUE_MASK), x = n.getParameter(n.STENCIL_REF), y = n.getParameter(n.STENCIL_WRITEMASK), z = n.getParameter(n.STENCIL_FAIL), A = n.getParameter(n.STENCIL_PASS_DEPTH_PASS), V = n.getParameter(n.STENCIL_PASS_DEPTH_FAIL), n.enable(n.STENCIL_TEST), n.clear(n.STENCIL_BUFFER_BIT), n.stencilMask(255), n.stencilFunc(n.ALWAYS, 1, 255), n.stencilOp(n.KEEP, n.KEEP, n.REPLACE), this.l.i(a, b, c, d, e, f, g, h, l, m, p), n.stencilMask(0), n.stencilFunc(n.NOTEQUAL, 1, 255));
        ri(a, 34962, this.v);
        ri(a, 34963, this.o);
        f = this.ff(n, a, e, f);
        var Pa = xh(this.mb);
        Dh(Pa, 2 / (c * e[0]), 2 / (c * e[1]));
        Ch(Pa, -d);
        Eh(Pa, -(b[0] - this.origin[0]), -(b[1] - this.origin[1]));
        b = xh(this.lb);
        Dh(b, 2 / e[0], 2 / e[1]);
        e = xh(this.Oa);
        d && Ch(e, -d);
        n.uniformMatrix4fv(f.f, !1, pi(this.Ja, Pa));
        n.uniformMatrix4fv(f.i, !1, pi(this.Ja, b));
        n.uniformMatrix4fv(f.c, !1, pi(this.Ja, e));
        n.uniform1f(f.a, g);
        var ra;
        l ? (m ? a = this.qe(n, a, h, l, p) : (n.clear(n.COLOR_BUFFER_BIT | n.DEPTH_BUFFER_BIT), this.Md(n, a, h, !0), a = (a = l(null)) ? a : void 0), ra = a) : this.Md(n, a, h, !1);
        this.gf(n, f);
        this.l && (q || n.disable(n.STENCIL_TEST), n.clear(n.STENCIL_BUFFER_BIT), n.stencilFunc(r, x, v), n.stencilMask(y), n.stencilOp(z, V, A));
        return ra;
    };
    function si(a, b, c, d) {
        a.drawElements(4, d - c, b.g ? 5125 : 5123, c * (b.g ? 4 : 2));
    }
    var ti = [
            0,
            0,
            0,
            1
        ], ui = [], vi = [
            0,
            0,
            0,
            1
        ];
    function wi(a, b, c, d, e, f) {
        a = (c - a) * (f - b) - (e - a) * (d - b);
        return a <= xi && a >= -xi ? void 0 : 0 < a;
    }
    var xi = Number.EPSILON || 2.220446049250313e-16;
    function yi(a) {
        this.b = void 0 !== a ? a : [];
        this.a = zi;
    }
    var zi = 35044;
    function Ai(a, b) {
        qi.call(this, 0, b);
        this.I = null;
        this.j = [];
        this.u = [];
        this.A = 0;
        this.c = {
            fillColor: null,
            strokeColor: null,
            lineDash: null,
            lineDashOffset: void 0,
            lineWidth: void 0,
            s: !1
        };
    }
    u(Ai, qi);
    k = Ai.prototype;
    k.$b = function (a, b) {
        var c = a.Vd(), d = a.sa();
        if (c) {
            this.f.push(this.b.length);
            this.g.push(b);
            this.c.s && (this.u.push(this.b.length), this.c.s = !1);
            this.A = c;
            var c = a.ha(), c = ef(c, 2, d, -this.origin[0], -this.origin[1]), e = this.a.length, f = this.b.length, g = e / 4, h;
            for (h = 0; 2 > h; h += d)
                this.a[e++] = c[h], this.a[e++] = c[h + 1], this.a[e++] = 0, this.a[e++] = this.A, this.a[e++] = c[h], this.a[e++] = c[h + 1], this.a[e++] = 1, this.a[e++] = this.A, this.a[e++] = c[h], this.a[e++] = c[h + 1], this.a[e++] = 2, this.a[e++] = this.A, this.a[e++] = c[h], this.a[e++] = c[h + 1], this.a[e++] = 3, this.a[e++] = this.A, this.b[f++] = g, this.b[f++] = g + 1, this.b[f++] = g + 2, this.b[f++] = g + 2, this.b[f++] = g + 3, this.b[f++] = g, g += 4;
        } else
            this.c.s && (this.j.pop(), this.j.length && (d = this.j[this.j.length - 1], this.c.fillColor = d[0], this.c.strokeColor = d[1], this.c.lineWidth = d[2], this.c.s = !1));
    };
    k.Bb = function () {
        this.v = new yi(this.a);
        this.o = new yi(this.b);
        this.f.push(this.b.length);
        !this.u.length && 0 < this.j.length && (this.j = []);
        this.b = this.a = null;
    };
    k.Cb = function (a) {
        var b = this.v, c = this.o;
        return function () {
            Bi(a, b);
            Bi(a, c);
        };
    };
    k.ff = function (a, b, c, d) {
        var e = Ci(b, ki, mi), f;
        this.I ? f = this.I : this.I = f = new ni(a, e);
        b.Rc(e);
        a.enableVertexAttribArray(f.b);
        a.vertexAttribPointer(f.b, 2, 5126, !1, 16, 0);
        a.enableVertexAttribArray(f.l);
        a.vertexAttribPointer(f.l, 1, 5126, !1, 16, 8);
        a.enableVertexAttribArray(f.u);
        a.vertexAttribPointer(f.u, 1, 5126, !1, 16, 12);
        a.uniform2fv(f.R, c);
        a.uniform1f(f.ta, d);
        return f;
    };
    k.gf = function (a, b) {
        a.disableVertexAttribArray(b.b);
        a.disableVertexAttribArray(b.l);
        a.disableVertexAttribArray(b.u);
    };
    k.Md = function (a, b, c) {
        if (sb(c)) {
            var d, e, f;
            e = this.f[this.f.length - 1];
            for (c = this.u.length - 1; 0 <= c; --c)
                d = this.u[c], f = this.j[c], a.uniform4fv(this.I.G, f[0]), Di(this, a, f[1], f[2]), si(a, b, d, e), e = d;
        } else {
            var g, h, l, m;
            l = this.f.length - 2;
            f = e = this.f[l + 1];
            for (d = this.u.length - 1; 0 <= d; --d) {
                g = this.j[d];
                a.uniform4fv(this.I.G, g[0]);
                Di(this, a, g[1], g[2]);
                for (g = this.u[d]; 0 <= l && this.f[l] >= g;)
                    m = this.f[l], h = this.g[l], h = w(h).toString(), c[h] && (e !== f && si(a, b, e, f), f = m), l--, e = m;
                e !== f && si(a, b, e, f);
                e = f = g;
            }
        }
    };
    k.qe = function (a, b, c, d, e) {
        var f, g, h, l, m, p, n;
        n = this.f.length - 2;
        h = this.f[n + 1];
        for (f = this.u.length - 1; 0 <= f; --f)
            for (g = this.j[f], a.uniform4fv(this.I.G, g[0]), Di(this, a, g[1], g[2]), l = this.u[f]; 0 <= n && this.f[n] >= l;) {
                g = this.f[n];
                m = this.g[n];
                p = w(m).toString();
                if (void 0 === c[p] && m.U() && (void 0 === e || mb(e, m.U().D())) && (a.clear(a.COLOR_BUFFER_BIT | a.DEPTH_BUFFER_BIT), si(a, b, g, h), h = d(m)))
                    return h;
                n--;
                h = g;
            }
    };
    function Di(a, b, c, d) {
        b.uniform4fv(a.I.S, c);
        b.uniform1f(a.I.qa, d);
    }
    k.Na = function (a, b) {
        var c, d;
        b ? (c = b.f, this.c.lineDash = c ? c : ui, c = b.g, this.c.lineDashOffset = c ? c : 0, c = b.a, c instanceof CanvasGradient || c instanceof CanvasPattern ? c = vi : c = Qc(c).map(function (a, b) {
            return 3 != b ? a / 255 : a;
        }) || vi, d = b.c, d = void 0 !== d ? d : 1) : (c = [
            0,
            0,
            0,
            0
        ], d = 0);
        var e = a ? a.b : [
            0,
            0,
            0,
            0
        ];
        e instanceof CanvasGradient || e instanceof CanvasPattern ? e = ti : e = Qc(e).map(function (a, b) {
            return 3 != b ? a / 255 : a;
        }) || ti;
        this.c.strokeColor && ia(this.c.strokeColor, c) && this.c.fillColor && ia(this.c.fillColor, e) && this.c.lineWidth === d || (this.c.s = !0, this.c.fillColor = e, this.c.strokeColor = c, this.c.lineWidth = d, this.j.push([
            e,
            c,
            d
        ]));
    };
    function Ei() {
        this.b = 'precision mediump float;varying vec2 a;varying float b;uniform float k;uniform sampler2D l;void main(void){vec4 texColor=texture2D(l,a);gl_FragColor.rgb=texColor.rgb;float alpha=texColor.a*b*k;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}';
    }
    u(Ei, hi);
    var Fi = new Ei();
    function Gi() {
        this.b = 'varying vec2 a;varying float b;attribute vec2 c;attribute vec2 d;attribute vec2 e;attribute float f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;void main(void){mat4 offsetMatrix=i;if(g==1.0){offsetMatrix=i*j;}vec4 offsets=offsetMatrix*vec4(e,0.0,0.0);gl_Position=h*vec4(c,0.0,1.0)+offsets;a=d;b=f;}';
    }
    u(Gi, ii);
    var Hi = new Gi();
    function Ii(a, b) {
        this.c = a.getUniformLocation(b, 'j');
        this.i = a.getUniformLocation(b, 'i');
        this.a = a.getUniformLocation(b, 'k');
        this.f = a.getUniformLocation(b, 'h');
        this.v = a.getAttribLocation(b, 'e');
        this.I = a.getAttribLocation(b, 'f');
        this.b = a.getAttribLocation(b, 'c');
        this.A = a.getAttribLocation(b, 'g');
        this.C = a.getAttribLocation(b, 'd');
    }
    function Ji(a, b) {
        this.l = a;
        this.b = b;
        this.a = {};
        this.c = {};
        this.f = {};
        this.o = this.v = this.i = this.j = null;
        (this.g = ea(ca, 'OES_element_index_uint')) && b.getExtension('OES_element_index_uint');
        B(this.l, 'webglcontextlost', this.mo, this);
        B(this.l, 'webglcontextrestored', this.no, this);
    }
    u(Ji, zc);
    function ri(a, b, c) {
        var d = a.b, e = c.b, f = String(w(c));
        if (f in a.a)
            d.bindBuffer(b, a.a[f].buffer);
        else {
            var g = d.createBuffer();
            d.bindBuffer(b, g);
            var h;
            34962 == b ? h = new Float32Array(e) : 34963 == b && (h = a.g ? new Uint32Array(e) : new Uint16Array(e));
            d.bufferData(b, h, c.a);
            a.a[f] = {
                lc: c,
                buffer: g
            };
        }
    }
    function Bi(a, b) {
        var c = a.b, d = String(w(b)), e = a.a[d];
        c.isContextLost() || c.deleteBuffer(e.buffer);
        delete a.a[d];
    }
    k = Ji.prototype;
    k.ra = function () {
        yc(this.l);
        var a = this.b;
        if (!a.isContextLost()) {
            for (var b in this.a)
                a.deleteBuffer(this.a[b].buffer);
            for (b in this.f)
                a.deleteProgram(this.f[b]);
            for (b in this.c)
                a.deleteShader(this.c[b]);
            a.deleteFramebuffer(this.i);
            a.deleteRenderbuffer(this.o);
            a.deleteTexture(this.v);
        }
    };
    k.lo = function () {
        return this.b;
    };
    function Ki(a) {
        if (!a.i) {
            var b = a.b, c = b.createFramebuffer();
            b.bindFramebuffer(b.FRAMEBUFFER, c);
            var d = Li(b, 1, 1), e = b.createRenderbuffer();
            b.bindRenderbuffer(b.RENDERBUFFER, e);
            b.renderbufferStorage(b.RENDERBUFFER, b.DEPTH_COMPONENT16, 1, 1);
            b.framebufferTexture2D(b.FRAMEBUFFER, b.COLOR_ATTACHMENT0, b.TEXTURE_2D, d, 0);
            b.framebufferRenderbuffer(b.FRAMEBUFFER, b.DEPTH_ATTACHMENT, b.RENDERBUFFER, e);
            b.bindTexture(b.TEXTURE_2D, null);
            b.bindRenderbuffer(b.RENDERBUFFER, null);
            b.bindFramebuffer(b.FRAMEBUFFER, null);
            a.i = c;
            a.v = d;
            a.o = e;
        }
        return a.i;
    }
    function Mi(a, b) {
        var c = String(w(b));
        if (c in a.c)
            return a.c[c];
        var d = a.b, e = d.createShader(b.T());
        d.shaderSource(e, b.b);
        d.compileShader(e);
        return a.c[c] = e;
    }
    function Ci(a, b, c) {
        var d = w(b) + '/' + w(c);
        if (d in a.f)
            return a.f[d];
        var e = a.b, f = e.createProgram();
        e.attachShader(f, Mi(a, b));
        e.attachShader(f, Mi(a, c));
        e.linkProgram(f);
        return a.f[d] = f;
    }
    k.mo = function () {
        qb(this.a);
        qb(this.c);
        qb(this.f);
        this.o = this.v = this.i = this.j = null;
    };
    k.no = function () {
    };
    k.Rc = function (a) {
        if (a == this.j)
            return !1;
        this.b.useProgram(a);
        this.j = a;
        return !0;
    };
    function Ni(a, b, c) {
        var d = a.createTexture();
        a.bindTexture(a.TEXTURE_2D, d);
        a.texParameteri(a.TEXTURE_2D, a.TEXTURE_MAG_FILTER, a.LINEAR);
        a.texParameteri(a.TEXTURE_2D, a.TEXTURE_MIN_FILTER, a.LINEAR);
        void 0 !== b && a.texParameteri(3553, 10242, b);
        void 0 !== c && a.texParameteri(3553, 10243, c);
        return d;
    }
    function Li(a, b, c) {
        var d = Ni(a, void 0, void 0);
        a.texImage2D(a.TEXTURE_2D, 0, a.RGBA, b, c, 0, a.RGBA, a.UNSIGNED_BYTE, null);
        return d;
    }
    function Oi(a, b) {
        var c = Ni(a, 33071, 33071);
        a.texImage2D(a.TEXTURE_2D, 0, a.RGBA, a.RGBA, a.UNSIGNED_BYTE, b);
        return c;
    }
    function Pi(a, b) {
        qi.call(this, 0, b);
        this.G = this.C = void 0;
        this.A = [];
        this.I = [];
        this.ta = void 0;
        this.j = [];
        this.c = [];
        this.S = this.R = void 0;
        this.qa = null;
        this.oa = this.ia = this.ea = this.eb = this.Y = this.$a = void 0;
        this.Ha = [];
        this.u = [];
        this.Zb = void 0;
    }
    u(Pi, qi);
    k = Pi.prototype;
    k.Cb = function (a) {
        var b = this.v, c = this.o, d = this.Ha, e = this.u, f = a.b;
        return function () {
            if (!f.isContextLost()) {
                var g, h;
                g = 0;
                for (h = d.length; g < h; ++g)
                    f.deleteTexture(d[g]);
                g = 0;
                for (h = e.length; g < h; ++g)
                    f.deleteTexture(e[g]);
            }
            Bi(a, b);
            Bi(a, c);
        };
    };
    function Qi(a, b, c, d) {
        var e = a.C, f = a.G, g = a.ta, h = a.R, l = a.S, m = a.$a, p = a.Y, n = a.eb, q = a.ea ? 1 : 0, r = -a.ia, v = a.oa, x = a.Zb, y = Math.cos(r), r = Math.sin(r), z = a.b.length, A = a.a.length, V, Pa, ra, La, C, Ma;
        for (V = 0; V < c; V += d)
            C = b[V] - a.origin[0], Ma = b[V + 1] - a.origin[1], Pa = A / 8, ra = -v * e, La = -v * (g - f), a.a[A++] = C, a.a[A++] = Ma, a.a[A++] = ra * y - La * r, a.a[A++] = ra * r + La * y, a.a[A++] = p / l, a.a[A++] = (n + g) / h, a.a[A++] = m, a.a[A++] = q, ra = v * (x - e), La = -v * (g - f), a.a[A++] = C, a.a[A++] = Ma, a.a[A++] = ra * y - La * r, a.a[A++] = ra * r + La * y, a.a[A++] = (p + x) / l, a.a[A++] = (n + g) / h, a.a[A++] = m, a.a[A++] = q, ra = v * (x - e), La = v * f, a.a[A++] = C, a.a[A++] = Ma, a.a[A++] = ra * y - La * r, a.a[A++] = ra * r + La * y, a.a[A++] = (p + x) / l, a.a[A++] = n / h, a.a[A++] = m, a.a[A++] = q, ra = -v * e, La = v * f, a.a[A++] = C, a.a[A++] = Ma, a.a[A++] = ra * y - La * r, a.a[A++] = ra * r + La * y, a.a[A++] = p / l, a.a[A++] = n / h, a.a[A++] = m, a.a[A++] = q, a.b[z++] = Pa, a.b[z++] = Pa + 1, a.b[z++] = Pa + 2, a.b[z++] = Pa, a.b[z++] = Pa + 2, a.b[z++] = Pa + 3;
    }
    k.oc = function (a, b) {
        this.f.push(this.b.length);
        this.g.push(b);
        var c = a.ha();
        Qi(this, c, c.length, a.sa());
    };
    k.qc = function (a, b) {
        this.f.push(this.b.length);
        this.g.push(b);
        var c = a.ha();
        Qi(this, c, c.length, a.sa());
    };
    k.Bb = function (a) {
        a = a.b;
        this.A.push(this.b.length);
        this.I.push(this.b.length);
        this.v = new yi(this.a);
        this.o = new yi(this.b);
        var b = {};
        Ri(this.Ha, this.j, b, a);
        Ri(this.u, this.c, b, a);
        this.ta = this.G = this.C = void 0;
        this.c = this.j = null;
        this.S = this.R = void 0;
        this.b = null;
        this.oa = this.ia = this.ea = this.eb = this.Y = this.$a = void 0;
        this.a = null;
        this.Zb = void 0;
    };
    function Ri(a, b, c, d) {
        var e, f, g, h = b.length;
        for (g = 0; g < h; ++g)
            e = b[g], f = w(e).toString(), f in c ? e = c[f] : (e = Oi(d, e), c[f] = e), a[g] = e;
    }
    k.ff = function (a, b) {
        var c = Ci(b, Fi, Hi), d;
        this.qa ? d = this.qa : this.qa = d = new Ii(a, c);
        b.Rc(c);
        a.enableVertexAttribArray(d.b);
        a.vertexAttribPointer(d.b, 2, 5126, !1, 32, 0);
        a.enableVertexAttribArray(d.v);
        a.vertexAttribPointer(d.v, 2, 5126, !1, 32, 8);
        a.enableVertexAttribArray(d.C);
        a.vertexAttribPointer(d.C, 2, 5126, !1, 32, 16);
        a.enableVertexAttribArray(d.I);
        a.vertexAttribPointer(d.I, 1, 5126, !1, 32, 24);
        a.enableVertexAttribArray(d.A);
        a.vertexAttribPointer(d.A, 1, 5126, !1, 32, 28);
        return d;
    };
    k.gf = function (a, b) {
        a.disableVertexAttribArray(b.b);
        a.disableVertexAttribArray(b.v);
        a.disableVertexAttribArray(b.C);
        a.disableVertexAttribArray(b.I);
        a.disableVertexAttribArray(b.A);
    };
    k.Md = function (a, b, c, d) {
        var e = d ? this.u : this.Ha;
        d = d ? this.I : this.A;
        if (sb(c)) {
            var f, g;
            c = 0;
            f = e.length;
            for (g = 0; c < f; ++c) {
                a.bindTexture(3553, e[c]);
                var h = d[c];
                si(a, b, g, h);
                g = h;
            }
        } else
            for (g = f = 0, h = e.length; g < h; ++g) {
                a.bindTexture(3553, e[g]);
                for (var l = 0 < g ? d[g - 1] : 0, m = d[g], p = l; f < this.f.length && this.f[f] <= m;) {
                    var n = w(this.g[f]).toString();
                    void 0 !== c[n] ? (p !== l && si(a, b, p, l), l = p = f === this.f.length - 1 ? m : this.f[f + 1]) : l = f === this.f.length - 1 ? m : this.f[f + 1];
                    f++;
                }
                p !== l && si(a, b, p, l);
            }
    };
    k.qe = function (a, b, c, d, e) {
        var f, g, h, l, m, p, n = this.f.length - 1;
        for (f = this.u.length - 1; 0 <= f; --f)
            for (a.bindTexture(3553, this.u[f]), g = 0 < f ? this.I[f - 1] : 0, l = this.I[f]; 0 <= n && this.f[n] >= g;) {
                h = this.f[n];
                m = this.g[n];
                p = w(m).toString();
                if (void 0 === c[p] && m.U() && (void 0 === e || mb(e, m.U().D())) && (a.clear(a.COLOR_BUFFER_BIT | a.DEPTH_BUFFER_BIT), si(a, b, h, l), l = d(m)))
                    return l;
                l = h;
                n--;
            }
    };
    k.Vb = function (a) {
        var b = a.Hc(), c = a.Z(1), d = a.ue(), e = a.cg(1), f = a.g, g = a.Pc(), h = a.o, l = a.l, m = a.jc();
        a = a.c;
        var p;
        this.j.length ? (p = this.j[this.j.length - 1], w(p) != w(c) && (this.A.push(this.b.length), this.j.push(c))) : this.j.push(c);
        this.c.length ? (p = this.c[this.c.length - 1], w(p) != w(e) && (this.I.push(this.b.length), this.c.push(e))) : this.c.push(e);
        this.C = b[0];
        this.G = b[1];
        this.ta = m[1];
        this.R = d[1];
        this.S = d[0];
        this.$a = f;
        this.Y = g[0];
        this.eb = g[1];
        this.ia = l;
        this.ea = h;
        this.oa = a;
        this.Zb = m[0];
    };
    function Si(a, b, c) {
        var d = b - c;
        return a[0] === a[d] && a[1] === a[d + 1] && 3 < (b - 0) / c ? !!kf(a, 0, b, c) : !1;
    }
    function Ti() {
        this.b = 'precision mediump float;varying float a;varying vec2 b;varying float c;uniform float m;uniform vec4 n;uniform vec2 o;uniform float p;void main(void){if(a>0.0){vec2 windowCoords=vec2((b.x+1.0)/2.0*o.x*p,(b.y+1.0)/2.0*o.y*p);if(length(windowCoords-gl_FragCoord.xy)>c*p){discard;}} gl_FragColor=n;float alpha=n.a*m;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}';
    }
    u(Ti, hi);
    var Ui = new Ti();
    function Vi() {
        this.b = 'varying float a;varying vec2 b;varying float c;attribute vec2 d;attribute vec2 e;attribute vec2 f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;uniform float k;uniform float l;bool nearlyEquals(in float value,in float ref){float epsilon=0.000000000001;return value>=ref-epsilon&&value<=ref+epsilon;}void alongNormal(out vec2 offset,in vec2 nextP,in float turnDir,in float direction){vec2 dirVect=nextP-e;vec2 normal=normalize(vec2(-turnDir*dirVect.y,turnDir*dirVect.x));offset=k/2.0*normal*direction;}void miterUp(out vec2 offset,out float round,in bool isRound,in float direction){float halfWidth=k/2.0;vec2 tangent=normalize(normalize(f-e)+normalize(e-d));vec2 normal=vec2(-tangent.y,tangent.x);vec2 dirVect=f-e;vec2 tmpNormal=normalize(vec2(-dirVect.y,dirVect.x));float miterLength=abs(halfWidth/dot(normal,tmpNormal));offset=normal*direction*miterLength;round=0.0;if(isRound){round=1.0;}else if(miterLength>l+k){offset=halfWidth*tmpNormal*direction;}} bool miterDown(out vec2 offset,in vec4 projPos,in mat4 offsetMatrix,in float direction){bool degenerate=false;vec2 tangent=normalize(normalize(f-e)+normalize(e-d));vec2 normal=vec2(-tangent.y,tangent.x);vec2 dirVect=d-e;vec2 tmpNormal=normalize(vec2(-dirVect.y,dirVect.x));vec2 longOffset,shortOffset,longVertex;vec4 shortProjVertex;float halfWidth=k/2.0;if(length(f-e)>length(d-e)){longOffset=tmpNormal*direction*halfWidth;shortOffset=normalize(vec2(dirVect.y,-dirVect.x))*direction*halfWidth;longVertex=f;shortProjVertex=h*vec4(d,0.0,1.0);}else{shortOffset=tmpNormal*direction*halfWidth;longOffset=normalize(vec2(dirVect.y,-dirVect.x))*direction*halfWidth;longVertex=d;shortProjVertex=h*vec4(f,0.0,1.0);}vec4 p1=h*vec4(longVertex,0.0,1.0)+offsetMatrix*vec4(longOffset,0.0,0.0);vec4 p2=projPos+offsetMatrix*vec4(longOffset,0.0,0.0);vec4 p3=shortProjVertex+offsetMatrix*vec4(-shortOffset,0.0,0.0);vec4 p4=shortProjVertex+offsetMatrix*vec4(shortOffset,0.0,0.0);float denom=(p4.y-p3.y)*(p2.x-p1.x)-(p4.x-p3.x)*(p2.y-p1.y);float firstU=((p4.x-p3.x)*(p1.y-p3.y)-(p4.y-p3.y)*(p1.x-p3.x))/denom;float secondU=((p2.x-p1.x)*(p1.y-p3.y)-(p2.y-p1.y)*(p1.x-p3.x))/denom;float epsilon=0.000000000001;if(firstU>epsilon&&firstU<1.0-epsilon&&secondU>epsilon&&secondU<1.0-epsilon){shortProjVertex.x=p1.x+firstU*(p2.x-p1.x);shortProjVertex.y=p1.y+firstU*(p2.y-p1.y);offset=shortProjVertex.xy;degenerate=true;}else{float miterLength=abs(halfWidth/dot(normal,tmpNormal));offset=normal*direction*miterLength;}return degenerate;}void squareCap(out vec2 offset,out float round,in bool isRound,in vec2 nextP,in float turnDir,in float direction){round=0.0;vec2 dirVect=e-nextP;vec2 firstNormal=normalize(dirVect);vec2 secondNormal=vec2(turnDir*firstNormal.y*direction,-turnDir*firstNormal.x*direction);vec2 hypotenuse=normalize(firstNormal-secondNormal);vec2 normal=vec2(turnDir*hypotenuse.y*direction,-turnDir*hypotenuse.x*direction);float length=sqrt(c*c*2.0);offset=normal*length;if(isRound){round=1.0;}} void main(void){bool degenerate=false;float direction=float(sign(g));mat4 offsetMatrix=i*j;vec2 offset;vec4 projPos=h*vec4(e,0.0,1.0);bool round=nearlyEquals(mod(g,2.0),0.0);a=0.0;c=k/2.0;b=projPos.xy;if(nearlyEquals(mod(g,3.0),0.0)||nearlyEquals(mod(g,17.0),0.0)){alongNormal(offset,f,1.0,direction);}else if(nearlyEquals(mod(g,5.0),0.0)||nearlyEquals(mod(g,13.0),0.0)){alongNormal(offset,d,-1.0,direction);}else if(nearlyEquals(mod(g,23.0),0.0)){miterUp(offset,a,round,direction);}else if(nearlyEquals(mod(g,19.0),0.0)){degenerate=miterDown(offset,projPos,offsetMatrix,direction);}else if(nearlyEquals(mod(g,7.0),0.0)){squareCap(offset,a,round,f,1.0,direction);}else if(nearlyEquals(mod(g,11.0),0.0)){squareCap(offset,a,round,d,-1.0,direction);}if(!degenerate){vec4 offsets=offsetMatrix*vec4(offset,0.0,0.0);gl_Position=projPos+offsets;}else{gl_Position=vec4(offset,0.0,1.0);}}';
    }
    u(Vi, ii);
    var Wi = new Vi();
    function Xi(a, b) {
        this.G = a.getUniformLocation(b, 'n');
        this.qa = a.getUniformLocation(b, 'k');
        this.S = a.getUniformLocation(b, 'l');
        this.c = a.getUniformLocation(b, 'j');
        this.i = a.getUniformLocation(b, 'i');
        this.a = a.getUniformLocation(b, 'm');
        this.ta = a.getUniformLocation(b, 'p');
        this.f = a.getUniformLocation(b, 'h');
        this.R = a.getUniformLocation(b, 'o');
        this.g = a.getAttribLocation(b, 'g');
        this.j = a.getAttribLocation(b, 'd');
        this.o = a.getAttribLocation(b, 'f');
        this.b = a.getAttribLocation(b, 'e');
    }
    function Yi(a, b) {
        qi.call(this, 0, b);
        this.I = null;
        this.u = [];
        this.j = [];
        this.c = {
            strokeColor: null,
            lineCap: void 0,
            lineDash: null,
            lineDashOffset: void 0,
            lineJoin: void 0,
            lineWidth: void 0,
            miterLimit: void 0,
            s: !1
        };
    }
    u(Yi, qi);
    function Zi(a, b, c, d) {
        var e, f = a.a.length, g = a.b.length, h = 'bevel' === a.c.lineJoin ? 0 : 'miter' === a.c.lineJoin ? 1 : 2, l = 'butt' === a.c.lineCap ? 0 : 'square' === a.c.lineCap ? 1 : 2, m = Si(b, c, d), p, n, q, r = g, v = 1, x, y, z;
        for (e = 0; e < c; e += d) {
            q = f / 7;
            x = y;
            y = z || [
                b[e],
                b[e + 1]
            ];
            if (e)
                if (e === c - d) {
                    m ? z = p : (x = x || [
                        0,
                        0
                    ], f = $i(a, x, y, [
                        0,
                        0
                    ], v * aj * (l || 1), f), f = $i(a, x, y, [
                        0,
                        0
                    ], -v * aj * (l || 1), f), a.b[g++] = q, a.b[g++] = r - 1, a.b[g++] = r, a.b[g++] = r, a.b[g++] = q + 1, a.b[g++] = q, l && (f = $i(a, x, y, [
                        0,
                        0
                    ], v * bj * l, f), f = $i(a, x, y, [
                        0,
                        0
                    ], -v * bj * l, f), a.b[g++] = q + 2, a.b[g++] = q, a.b[g++] = q + 1, a.b[g++] = q + 1, a.b[g++] = q + 3, a.b[g++] = q + 2));
                    break;
                } else
                    z = [
                        b[e + d],
                        b[e + d + 1]
                    ];
            else {
                z = [
                    b[e + d],
                    b[e + d + 1]
                ];
                if (c - 0 === 2 * d && ia(y, z))
                    break;
                if (m)
                    x = [
                        b[c - 2 * d],
                        b[c - 2 * d + 1]
                    ], p = z;
                else {
                    l && (f = $i(a, [
                        0,
                        0
                    ], y, z, v * cj * l, f), f = $i(a, [
                        0,
                        0
                    ], y, z, -v * cj * l, f), a.b[g++] = q + 2, a.b[g++] = q, a.b[g++] = q + 1, a.b[g++] = q + 1, a.b[g++] = q + 3, a.b[g++] = q + 2);
                    f = $i(a, [
                        0,
                        0
                    ], y, z, v * dj * (l || 1), f);
                    f = $i(a, [
                        0,
                        0
                    ], y, z, -v * dj * (l || 1), f);
                    r = f / 7 - 1;
                    continue;
                }
            }
            n = wi(x[0], x[1], y[0], y[1], z[0], z[1]) ? -1 : 1;
            f = $i(a, x, y, z, n * ej * (h || 1), f);
            f = $i(a, x, y, z, n * fj * (h || 1), f);
            f = $i(a, x, y, z, -n * gj * (h || 1), f);
            0 < e && (a.b[g++] = q, a.b[g++] = r - 1, a.b[g++] = r, a.b[g++] = q + 2, a.b[g++] = q, a.b[g++] = 0 < v * n ? r : r - 1);
            a.b[g++] = q;
            a.b[g++] = q + 2;
            a.b[g++] = q + 1;
            r = q + 2;
            v = n;
            h && (f = $i(a, x, y, z, n * hj * h, f), a.b[g++] = q + 1, a.b[g++] = q + 3, a.b[g++] = q);
        }
        m && (q = q || f / 7, n = Hf([
            x[0],
            x[1],
            y[0],
            y[1],
            z[0],
            z[1]
        ], 0, 6, 2) ? 1 : -1, f = $i(a, x, y, z, n * ej * (h || 1), f), $i(a, x, y, z, -n * gj * (h || 1), f), a.b[g++] = q, a.b[g++] = r - 1, a.b[g++] = r, a.b[g++] = q + 1, a.b[g++] = q, a.b[g++] = 0 < v * n ? r : r - 1);
    }
    function $i(a, b, c, d, e, f) {
        a.a[f++] = b[0];
        a.a[f++] = b[1];
        a.a[f++] = c[0];
        a.a[f++] = c[1];
        a.a[f++] = d[0];
        a.a[f++] = d[1];
        a.a[f++] = e;
        return f;
    }
    function ij(a, b, c) {
        b -= 0;
        return b < 2 * c ? !1 : b === 2 * c ? !ia([
            a[0],
            a[1]
        ], [
            a[0 + c],
            a[c + 1]
        ]) : !0;
    }
    k = Yi.prototype;
    k.Qb = function (a, b) {
        var c = a.ha(), d = a.sa();
        ij(c, c.length, d) && (c = ef(c, c.length, d, -this.origin[0], -this.origin[1]), this.c.s && (this.j.push(this.b.length), this.c.s = !1), this.f.push(this.b.length), this.g.push(b), Zi(this, c, c.length, d));
    };
    k.nc = function (a, b) {
        var c = this.b.length, d = a.hd(), e, f;
        e = 0;
        for (f = d.length; e < f; ++e) {
            var g = d[e].ha(), h = d[e].sa();
            ij(g, g.length, h) && (g = ef(g, g.length, h, -this.origin[0], -this.origin[1]), Zi(this, g, g.length, h));
        }
        this.b.length > c && (this.f.push(c), this.g.push(b), this.c.s && (this.j.push(c), this.c.s = !1));
    };
    function jj(a, b, c, d) {
        Si(b, b.length, d) || (b.push(b[0]), b.push(b[1]));
        Zi(a, b, b.length, d);
        if (c.length) {
            var e;
            b = 0;
            for (e = c.length; b < e; ++b)
                Si(c[b], c[b].length, d) || (c[b].push(c[b][0]), c[b].push(c[b][1])), Zi(a, c[b], c[b].length, d);
        }
    }
    function kj(a, b, c) {
        c = void 0 === c ? a.b.length : c;
        a.f.push(c);
        a.g.push(b);
        a.c.s && (a.j.push(c), a.c.s = !1);
    }
    k.Bb = function () {
        this.v = new yi(this.a);
        this.o = new yi(this.b);
        this.f.push(this.b.length);
        !this.j.length && 0 < this.u.length && (this.u = []);
        this.b = this.a = null;
    };
    k.Cb = function (a) {
        var b = this.v, c = this.o;
        return function () {
            Bi(a, b);
            Bi(a, c);
        };
    };
    k.ff = function (a, b, c, d) {
        var e = Ci(b, Ui, Wi), f;
        this.I ? f = this.I : this.I = f = new Xi(a, e);
        b.Rc(e);
        a.enableVertexAttribArray(f.j);
        a.vertexAttribPointer(f.j, 2, 5126, !1, 28, 0);
        a.enableVertexAttribArray(f.b);
        a.vertexAttribPointer(f.b, 2, 5126, !1, 28, 8);
        a.enableVertexAttribArray(f.o);
        a.vertexAttribPointer(f.o, 2, 5126, !1, 28, 16);
        a.enableVertexAttribArray(f.g);
        a.vertexAttribPointer(f.g, 1, 5126, !1, 28, 24);
        a.uniform2fv(f.R, c);
        a.uniform1f(f.ta, d);
        return f;
    };
    k.gf = function (a, b) {
        a.disableVertexAttribArray(b.j);
        a.disableVertexAttribArray(b.b);
        a.disableVertexAttribArray(b.o);
        a.disableVertexAttribArray(b.g);
    };
    k.Md = function (a, b, c, d) {
        var e = a.getParameter(a.DEPTH_FUNC), f = a.getParameter(a.DEPTH_WRITEMASK);
        d || (a.enable(a.DEPTH_TEST), a.depthMask(!0), a.depthFunc(a.NOTEQUAL));
        if (sb(c)) {
            var g, h, l;
            h = this.f[this.f.length - 1];
            for (c = this.j.length - 1; 0 <= c; --c)
                g = this.j[c], l = this.u[c], lj(this, a, l[0], l[1], l[2]), si(a, b, g, h), a.clear(a.DEPTH_BUFFER_BIT), h = g;
        } else {
            var m, p, n, q;
            n = this.f.length - 2;
            l = h = this.f[n + 1];
            for (g = this.j.length - 1; 0 <= g; --g) {
                m = this.u[g];
                lj(this, a, m[0], m[1], m[2]);
                for (m = this.j[g]; 0 <= n && this.f[n] >= m;)
                    q = this.f[n], p = this.g[n], p = w(p).toString(), c[p] && (h !== l && (si(a, b, h, l), a.clear(a.DEPTH_BUFFER_BIT)), l = q), n--, h = q;
                h !== l && (si(a, b, h, l), a.clear(a.DEPTH_BUFFER_BIT));
                h = l = m;
            }
        }
        d || (a.disable(a.DEPTH_TEST), a.clear(a.DEPTH_BUFFER_BIT), a.depthMask(f), a.depthFunc(e));
    };
    k.qe = function (a, b, c, d, e) {
        var f, g, h, l, m, p, n;
        n = this.f.length - 2;
        h = this.f[n + 1];
        for (f = this.j.length - 1; 0 <= f; --f)
            for (g = this.u[f], lj(this, a, g[0], g[1], g[2]), l = this.j[f]; 0 <= n && this.f[n] >= l;) {
                g = this.f[n];
                m = this.g[n];
                p = w(m).toString();
                if (void 0 === c[p] && m.U() && (void 0 === e || mb(e, m.U().D())) && (a.clear(a.COLOR_BUFFER_BIT | a.DEPTH_BUFFER_BIT), si(a, b, g, h), h = d(m)))
                    return h;
                n--;
                h = g;
            }
    };
    function lj(a, b, c, d, e) {
        b.uniform4fv(a.I.G, c);
        b.uniform1f(a.I.qa, d);
        b.uniform1f(a.I.S, e);
    }
    k.Na = function (a, b) {
        var c = b.i;
        this.c.lineCap = void 0 !== c ? c : 'round';
        c = b.f;
        this.c.lineDash = c ? c : ui;
        c = b.g;
        this.c.lineDashOffset = c ? c : 0;
        c = b.l;
        this.c.lineJoin = void 0 !== c ? c : 'round';
        c = b.a;
        c instanceof CanvasGradient || c instanceof CanvasPattern ? c = vi : c = Qc(c).map(function (a, b) {
            return 3 != b ? a / 255 : a;
        }) || vi;
        var d = b.c, d = void 0 !== d ? d : 1, e = b.j, e = void 0 !== e ? e : 10;
        this.c.strokeColor && ia(this.c.strokeColor, c) && this.c.lineWidth === d && this.c.miterLimit === e || (this.c.s = !0, this.c.strokeColor = c, this.c.lineWidth = d, this.c.miterLimit = e, this.u.push([
            c,
            d,
            e
        ]));
    };
    var dj = 3, aj = 5, cj = 7, bj = 11, ej = 13, fj = 17, gj = 19, hj = 23;
    function mj() {
        this.b = 'precision mediump float;uniform vec4 e;uniform float f;void main(void){gl_FragColor=e;float alpha=e.a*f;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}';
    }
    u(mj, hi);
    var nj = new mj();
    function oj() {
        this.b = 'attribute vec2 a;uniform mat4 b;uniform mat4 c;uniform mat4 d;void main(void){gl_Position=b*vec4(a,0.0,1.0);}';
    }
    u(oj, ii);
    var pj = new oj();
    function qj(a, b) {
        this.G = a.getUniformLocation(b, 'e');
        this.c = a.getUniformLocation(b, 'd');
        this.i = a.getUniformLocation(b, 'c');
        this.a = a.getUniformLocation(b, 'f');
        this.f = a.getUniformLocation(b, 'b');
        this.b = a.getAttribLocation(b, 'a');
    }
    function rj(a) {
        a = a || {};
        this.a = void 0 !== a.color ? a.color : null;
        this.i = a.lineCap;
        this.f = void 0 !== a.lineDash ? a.lineDash : null;
        this.g = a.lineDashOffset;
        this.l = a.lineJoin;
        this.j = a.miterLimit;
        this.c = a.width;
        this.b = void 0;
    }
    k = rj.prototype;
    k.clone = function () {
        var a = this.a;
        return new rj({
            color: a && a.slice ? a.slice() : a || void 0,
            lineCap: this.i,
            lineDash: this.f ? this.f.slice() : void 0,
            lineDashOffset: this.g,
            lineJoin: this.l,
            miterLimit: this.j,
            width: this.c
        });
    };
    k.ao = function () {
        return this.a;
    };
    k.Ak = function () {
        return this.i;
    };
    k.bo = function () {
        return this.f;
    };
    k.Bk = function () {
        return this.g;
    };
    k.Ck = function () {
        return this.l;
    };
    k.Hk = function () {
        return this.j;
    };
    k.co = function () {
        return this.c;
    };
    k.eo = function (a) {
        this.a = a;
        this.b = void 0;
    };
    k.qp = function (a) {
        this.i = a;
        this.b = void 0;
    };
    k.setLineDash = function (a) {
        this.f = a;
        this.b = void 0;
    };
    k.rp = function (a) {
        this.g = a;
        this.b = void 0;
    };
    k.sp = function (a) {
        this.l = a;
        this.b = void 0;
    };
    k.tp = function (a) {
        this.j = a;
        this.b = void 0;
    };
    k.wp = function (a) {
        this.c = a;
        this.b = void 0;
    };
    function sj(a) {
        this.b = this.a = this.f = void 0;
        this.i = void 0 === a ? !0 : a;
        this.c = 0;
    }
    function tj(a) {
        var b = a.b;
        if (b) {
            var c = b.next, d = b.ub;
            c && (c.ub = d);
            d && (d.next = c);
            a.b = c || d;
            a.f === a.a ? (a.b = void 0, a.f = void 0, a.a = void 0) : a.f === b ? a.f = a.b : a.a === b && (a.a = d ? a.b.ub : a.b);
            a.c--;
        }
    }
    function uj(a) {
        a.b = a.f;
        if (a.b)
            return a.b.data;
    }
    function vj(a) {
        if (a.b && a.b.next)
            return a.b = a.b.next, a.b.data;
    }
    function wj(a) {
        if (a.b && a.b.next)
            return a.b.next.data;
    }
    function xj(a) {
        if (a.b && a.b.ub)
            return a.b = a.b.ub, a.b.data;
    }
    function yj(a) {
        if (a.b && a.b.ub)
            return a.b.ub.data;
    }
    function zj(a) {
        if (a.b)
            return a.b.data;
    }
    sj.prototype.concat = function (a) {
        if (a.b) {
            if (this.b) {
                var b = this.b.next;
                this.b.next = a.f;
                a.f.ub = this.b;
                b.ub = a.a;
                a.a.next = b;
                this.c += a.c;
            } else
                this.b = a.b, this.f = a.f, this.a = a.a, this.c = a.c;
            a.b = void 0;
            a.f = void 0;
            a.a = void 0;
            a.c = 0;
        }
    };
    var Aj, Bj, Cj, Dj;
    (function () {
        var a = {}, b = { ma: a };
        (function (c) {
            if ('object' === typeof a && 'undefined' !== typeof b)
                b.ma = c();
            else {
                var d;
                'undefined' !== typeof window ? d = window : 'undefined' !== typeof global ? d = global : 'undefined' !== typeof self ? d = self : d = this;
                d.cq = c();
            }
        }(function () {
            return function d(a, b, g) {
                function e(h, l) {
                    if (!b[h]) {
                        if (!a[h]) {
                            var m = 'function' == typeof require && require;
                            if (!l && m)
                                return m(h, !0);
                            if (f)
                                return f(h, !0);
                            m = Error('Cannot find module \'' + h + '\'');
                            throw m.code = 'MODULE_NOT_FOUND', m;
                        }
                        m = b[h] = { ma: {} };
                        a[h][0].call(m.ma, function (b) {
                            var d = a[h][1][b];
                            return e(d ? d : b);
                        }, m, m.ma, d, a, b, g);
                    }
                    return b[h].ma;
                }
                for (var f = 'function' == typeof require && require, m = 0; m < g.length; m++)
                    e(g[m]);
                return e;
            }({
                1: [
                    function (a, b) {
                        function d(a, b, f, g, q) {
                            f = f || 0;
                            g = g || a.length - 1;
                            for (q = q || h; g > f;) {
                                if (600 < g - f) {
                                    var l = g - f + 1, m = b - f + 1, p = Math.log(l), n = 0.5 * Math.exp(2 * p / 3), p = 0.5 * Math.sqrt(p * n * (l - n) / l) * (0 > m - l / 2 ? -1 : 1);
                                    d(a, b, Math.max(f, Math.floor(b - m * n / l + p)), Math.min(g, Math.floor(b + (l - m) * n / l + p)), q);
                                }
                                l = a[b];
                                m = f;
                                n = g;
                                e(a, f, b);
                                for (0 < q(a[g], l) && e(a, f, g); m < n;) {
                                    e(a, m, n);
                                    m++;
                                    for (n--; 0 > q(a[m], l);)
                                        m++;
                                    for (; 0 < q(a[n], l);)
                                        n--;
                                }
                                0 === q(a[f], l) ? e(a, f, n) : (n++, e(a, n, g));
                                n <= b && (f = n + 1);
                                b <= n && (g = n - 1);
                            }
                        }
                        function e(a, b, d) {
                            var e = a[b];
                            a[b] = a[d];
                            a[d] = e;
                        }
                        function h(a, b) {
                            return a < b ? -1 : a > b ? 1 : 0;
                        }
                        b.ma = d;
                    },
                    {}
                ],
                2: [
                    function (a, b) {
                        function d(a, b) {
                            if (!(this instanceof d))
                                return new d(a, b);
                            this.wf = Math.max(4, a || 9);
                            this.Pg = Math.max(2, Math.ceil(0.4 * this.wf));
                            b && this.Lj(b);
                            this.clear();
                        }
                        function e(a, b) {
                            h(a, 0, a.children.length, b, a);
                        }
                        function h(a, b, d, e, f) {
                            f || (f = x(null));
                            f.da = Infinity;
                            f.fa = Infinity;
                            f.ba = -Infinity;
                            f.ja = -Infinity;
                            for (var g; b < d; b++)
                                g = a.children[b], l(f, a.hb ? e(g) : g);
                            return f;
                        }
                        function l(a, b) {
                            a.da = Math.min(a.da, b.da);
                            a.fa = Math.min(a.fa, b.fa);
                            a.ba = Math.max(a.ba, b.ba);
                            a.ja = Math.max(a.ja, b.ja);
                        }
                        function m(a, b) {
                            return a.da - b.da;
                        }
                        function p(a, b) {
                            return a.fa - b.fa;
                        }
                        function n(a) {
                            return (a.ba - a.da) * (a.ja - a.fa);
                        }
                        function q(a) {
                            return a.ba - a.da + (a.ja - a.fa);
                        }
                        function r(a, b) {
                            return a.da <= b.da && a.fa <= b.fa && b.ba <= a.ba && b.ja <= a.ja;
                        }
                        function v(a, b) {
                            return b.da <= a.ba && b.fa <= a.ja && b.ba >= a.da && b.ja >= a.fa;
                        }
                        function x(a) {
                            return {
                                children: a,
                                height: 1,
                                hb: !0,
                                da: Infinity,
                                fa: Infinity,
                                ba: -Infinity,
                                ja: -Infinity
                            };
                        }
                        function y(a, b, d, e, f) {
                            for (var g = [
                                        b,
                                        d
                                    ], h; g.length;)
                                d = g.pop(), b = g.pop(), d - b <= e || (h = b + Math.ceil((d - b) / e / 2) * e, z(a, h, b, d, f), g.push(b, h, h, d));
                        }
                        b.ma = d;
                        var z = a('quickselect');
                        d.prototype = {
                            all: function () {
                                return this.Kg(this.data, []);
                            },
                            search: function (a) {
                                var b = this.data, d = [], e = this.yb;
                                if (!v(a, b))
                                    return d;
                                for (var f = [], g, h, l, m; b;) {
                                    g = 0;
                                    for (h = b.children.length; g < h; g++)
                                        l = b.children[g], m = b.hb ? e(l) : l, v(a, m) && (b.hb ? d.push(l) : r(a, m) ? this.Kg(l, d) : f.push(l));
                                    b = f.pop();
                                }
                                return d;
                            },
                            load: function (a) {
                                if (!a || !a.length)
                                    return this;
                                if (a.length < this.Pg) {
                                    for (var b = 0, d = a.length; b < d; b++)
                                        this.Ea(a[b]);
                                    return this;
                                }
                                a = this.Mg(a.slice(), 0, a.length - 1, 0);
                                this.data.children.length ? this.data.height === a.height ? this.Rg(this.data, a) : (this.data.height < a.height && (b = this.data, this.data = a, a = b), this.Og(a, this.data.height - a.height - 1, !0)) : this.data = a;
                                return this;
                            },
                            Ea: function (a) {
                                a && this.Og(a, this.data.height - 1);
                                return this;
                            },
                            clear: function () {
                                this.data = x([]);
                                return this;
                            },
                            remove: function (a, b) {
                                if (!a)
                                    return this;
                                for (var d = this.data, e = this.yb(a), f = [], g = [], h, l, m, n; d || f.length;) {
                                    d || (d = f.pop(), l = f[f.length - 1], h = g.pop(), n = !0);
                                    if (d.hb) {
                                        a: {
                                            m = a;
                                            var p = d.children, q = b;
                                            if (q) {
                                                for (var v = 0; v < p.length; v++)
                                                    if (q(m, p[v])) {
                                                        m = v;
                                                        break a;
                                                    }
                                                m = -1;
                                            } else
                                                m = p.indexOf(m);
                                        }
                                        if (-1 !== m) {
                                            d.children.splice(m, 1);
                                            f.push(d);
                                            this.Jj(f);
                                            break;
                                        }
                                    }
                                    n || d.hb || !r(d, e) ? l ? (h++, d = l.children[h], n = !1) : d = null : (f.push(d), g.push(h), h = 0, l = d, d = d.children[0]);
                                }
                                return this;
                            },
                            yb: function (a) {
                                return a;
                            },
                            Af: m,
                            Bf: p,
                            toJSON: function () {
                                return this.data;
                            },
                            Kg: function (a, b) {
                                for (var d = []; a;)
                                    a.hb ? b.push.apply(b, a.children) : d.push.apply(d, a.children), a = d.pop();
                                return b;
                            },
                            Mg: function (a, b, d, f) {
                                var g = d - b + 1, h = this.wf, l;
                                if (g <= h)
                                    return l = x(a.slice(b, d + 1)), e(l, this.yb), l;
                                f || (f = Math.ceil(Math.log(g) / Math.log(h)), h = Math.ceil(g / Math.pow(h, f - 1)));
                                l = x([]);
                                l.hb = !1;
                                l.height = f;
                                var g = Math.ceil(g / h), h = g * Math.ceil(Math.sqrt(h)), m, n, p;
                                for (y(a, b, d, h, this.Af); b <= d; b += h)
                                    for (n = Math.min(b + h - 1, d), y(a, b, n, g, this.Bf), m = b; m <= n; m += g)
                                        p = Math.min(m + g - 1, n), l.children.push(this.Mg(a, m, p, f - 1));
                                e(l, this.yb);
                                return l;
                            },
                            Ij: function (a, b, d, e) {
                                for (var f, g, h, l, m, p, q, r;;) {
                                    e.push(b);
                                    if (b.hb || e.length - 1 === d)
                                        break;
                                    q = r = Infinity;
                                    f = 0;
                                    for (g = b.children.length; f < g; f++)
                                        h = b.children[f], m = n(h), p = (Math.max(h.ba, a.ba) - Math.min(h.da, a.da)) * (Math.max(h.ja, a.ja) - Math.min(h.fa, a.fa)) - m, p < r ? (r = p, q = m < q ? m : q, l = h) : p === r && m < q && (q = m, l = h);
                                    b = l || b.children[0];
                                }
                                return b;
                            },
                            Og: function (a, b, d) {
                                var e = this.yb;
                                d = d ? a : e(a);
                                var e = [], f = this.Ij(d, this.data, b, e);
                                f.children.push(a);
                                for (l(f, d); 0 <= b;)
                                    if (e[b].children.length > this.wf)
                                        this.Qj(e, b), b--;
                                    else
                                        break;
                                this.Fj(d, e, b);
                            },
                            Qj: function (a, b) {
                                var d = a[b], f = d.children.length, g = this.Pg;
                                this.Gj(d, g, f);
                                f = this.Hj(d, g, f);
                                f = x(d.children.splice(f, d.children.length - f));
                                f.height = d.height;
                                f.hb = d.hb;
                                e(d, this.yb);
                                e(f, this.yb);
                                b ? a[b - 1].children.push(f) : this.Rg(d, f);
                            },
                            Rg: function (a, b) {
                                this.data = x([
                                    a,
                                    b
                                ]);
                                this.data.height = a.height + 1;
                                this.data.hb = !1;
                                e(this.data, this.yb);
                            },
                            Hj: function (a, b, d) {
                                var e, f, g, l, m, p, q;
                                m = p = Infinity;
                                for (e = b; e <= d - b; e++)
                                    f = h(a, 0, e, this.yb), g = h(a, e, d, this.yb), l = Math.max(0, Math.min(f.ba, g.ba) - Math.max(f.da, g.da)) * Math.max(0, Math.min(f.ja, g.ja) - Math.max(f.fa, g.fa)), f = n(f) + n(g), l < m ? (m = l, q = e, p = f < p ? f : p) : l === m && f < p && (p = f, q = e);
                                return q;
                            },
                            Gj: function (a, b, d) {
                                var e = a.hb ? this.Af : m, f = a.hb ? this.Bf : p, g = this.Lg(a, b, d, e);
                                b = this.Lg(a, b, d, f);
                                g < b && a.children.sort(e);
                            },
                            Lg: function (a, b, d, e) {
                                a.children.sort(e);
                                e = this.yb;
                                var f = h(a, 0, b, e), g = h(a, d - b, d, e), m = q(f) + q(g), p, n;
                                for (p = b; p < d - b; p++)
                                    n = a.children[p], l(f, a.hb ? e(n) : n), m += q(f);
                                for (p = d - b - 1; p >= b; p--)
                                    n = a.children[p], l(g, a.hb ? e(n) : n), m += q(g);
                                return m;
                            },
                            Fj: function (a, b, d) {
                                for (; 0 <= d; d--)
                                    l(b[d], a);
                            },
                            Jj: function (a) {
                                for (var b = a.length - 1, d; 0 <= b; b--)
                                    0 === a[b].children.length ? 0 < b ? (d = a[b - 1].children, d.splice(d.indexOf(a[b]), 1)) : this.clear() : e(a[b], this.yb);
                            },
                            Lj: function (a) {
                                var b = [
                                    'return a',
                                    ' - b',
                                    ';'
                                ];
                                this.Af = new Function('a', 'b', b.join(a[0]));
                                this.Bf = new Function('a', 'b', b.join(a[1]));
                                this.yb = new Function('a', 'return {minX: a' + a[0] + ', minY: a' + a[1] + ', maxX: a' + a[2] + ', maxY: a' + a[3] + '};');
                            }
                        };
                    },
                    { quickselect: 1 }
                ]
            }, {}, [2])(2);
        }));
        Aj = b.ma;
    }());
    function Ej(a) {
        this.b = Aj(a);
        this.a = {};
    }
    k = Ej.prototype;
    k.Ea = function (a, b) {
        var c = {
            da: a[0],
            fa: a[1],
            ba: a[2],
            ja: a[3],
            value: b
        };
        this.b.Ea(c);
        this.a[w(b)] = c;
    };
    k.load = function (a, b) {
        for (var c = Array(b.length), d = 0, e = b.length; d < e; d++) {
            var f = a[d], g = b[d], f = {
                    da: f[0],
                    fa: f[1],
                    ba: f[2],
                    ja: f[3],
                    value: g
                };
            c[d] = f;
            this.a[w(g)] = f;
        }
        this.b.load(c);
    };
    k.remove = function (a) {
        a = w(a);
        var b = this.a[a];
        delete this.a[a];
        return null !== this.b.remove(b);
    };
    function Fj(a, b, c) {
        var d = a.a[w(c)];
        Za([
            d.da,
            d.fa,
            d.ba,
            d.ja
        ], b) || (a.remove(c), a.Ea(b, c));
    }
    function Gj(a) {
        return a.b.all().map(function (a) {
            return a.value;
        });
    }
    function Hj(a, b) {
        return a.b.search({
            da: b[0],
            fa: b[1],
            ba: b[2],
            ja: b[3]
        }).map(function (a) {
            return a.value;
        });
    }
    k.forEach = function (a, b) {
        return Ij(Gj(this), a, b);
    };
    function Jj(a, b, c, d) {
        return Ij(Hj(a, b), c, d);
    }
    function Ij(a, b, c) {
        for (var d, e = 0, f = a.length; e < f && !(d = b.call(c, a[e])); e++);
        return d;
    }
    k.clear = function () {
        this.b.clear();
        this.a = {};
    };
    k.D = function () {
        var a = this.b.data;
        return [
            a.da,
            a.fa,
            a.ba,
            a.ja
        ];
    };
    function Kj(a, b) {
        qi.call(this, 0, b);
        this.l = new Yi(0, b);
        this.I = null;
        this.u = [];
        this.c = [];
        this.j = {
            fillColor: null,
            s: !1
        };
    }
    u(Kj, qi);
    function Lj(a, b, c, d) {
        var e = new sj(), f = new Ej();
        b = Mj(a, b, d, e, f, !0);
        if (c.length) {
            var g, h, l = [];
            g = 0;
            for (h = c.length; g < h; ++g) {
                var m = {
                    list: new sj(),
                    ba: void 0
                };
                l.push(m);
                m.ba = Mj(a, c[g], d, m.list, f, !1);
            }
            l.sort(function (a, b) {
                return b.ba - a.ba;
            });
            for (g = 0; g < l.length; ++g)
                Nj(l[g].list, l[g].ba, e, b, f);
        }
        Oj(e, f, !1);
        Pj(a, e, f);
    }
    function Mj(a, b, c, d, e, f) {
        var g, h, l = a.a.length / 2, m, p, n, q = [], r = [];
        if (f === Hf(b, 0, b.length, c))
            for (p = m = Qj(a, b[0], b[1], l++), f = b[0], g = c, h = b.length; g < h; g += c)
                n = Qj(a, b[g], b[g + 1], l++), r.push(Rj(p, n, d)), q.push([
                    Math.min(p.x, n.x),
                    Math.min(p.y, n.y),
                    Math.max(p.x, n.x),
                    Math.max(p.y, n.y)
                ]), f = b[g] > f ? b[g] : f, p = n;
        else
            for (g = b.length - c, p = m = Qj(a, b[g], b[g + 1], l++), f = b[g], g -= c, h = 0; g >= h; g -= c)
                n = Qj(a, b[g], b[g + 1], l++), r.push(Rj(p, n, d)), q.push([
                    Math.min(p.x, n.x),
                    Math.min(p.y, n.y),
                    Math.max(p.x, n.x),
                    Math.max(p.y, n.y)
                ]), f = b[g] > f ? b[g] : f, p = n;
        r.push(Rj(n, m, d));
        q.push([
            Math.min(p.x, n.x),
            Math.min(p.y, n.y),
            Math.max(p.x, n.x),
            Math.max(p.y, n.y)
        ]);
        e.load(q, r);
        return f;
    }
    function Oj(a, b, c) {
        var d = uj(a), e = d, f = vj(a), g = !1;
        do {
            var h = c ? wi(f.W.x, f.W.y, e.W.x, e.W.y, e.aa.x, e.aa.y) : wi(e.aa.x, e.aa.y, e.W.x, e.W.y, f.W.x, f.W.y);
            void 0 === h ? (Sj(e, f, a, b), g = !0, f === d && (d = wj(a)), f = e, xj(a)) : e.W.vb !== h && (e.W.vb = h, g = !0);
            e = f;
            f = vj(a);
        } while (e !== d);
        return g;
    }
    function Nj(a, b, c, d, e) {
        Oj(a, e, !0);
        for (var f = uj(a); f.W.x !== b;)
            f = vj(a);
        b = f.W;
        d = {
            x: d,
            y: b.y,
            gb: -1
        };
        var g = Infinity, h, l, m, p;
        m = Tj({
            aa: b,
            W: d
        }, e, !0);
        h = 0;
        for (l = m.length; h < l; ++h) {
            var n = m[h];
            if (void 0 === n.aa.vb) {
                var q = Uj(b, d, n.aa, n.W, !0), r = Math.abs(b.x - q[0]);
                r < g && (g = r, p = {
                    x: q[0],
                    y: q[1],
                    gb: -1
                }, f = n);
            }
        }
        if (Infinity !== g) {
            m = f.W;
            if (0 < g && (f = Vj(b, p, f.W, e), f.length))
                for (p = Infinity, h = 0, l = f.length; h < l; ++h)
                    if (g = f[h], n = Math.atan2(b.y - g.y, d.x - g.x), n < p || n === p && g.x < m.x)
                        p = n, m = g;
            for (f = uj(c); f.W !== m;)
                f = vj(c);
            d = {
                x: b.x,
                y: b.y,
                gb: b.gb,
                vb: void 0
            };
            h = {
                x: f.W.x,
                y: f.W.y,
                gb: f.W.gb,
                vb: void 0
            };
            wj(a).aa = d;
            Rj(b, f.W, a, e);
            Rj(h, d, a, e);
            f.W = h;
            a.i && a.b && (a.f = a.b, a.a = a.b.ub);
            c.concat(a);
        }
    }
    function Pj(a, b, c) {
        for (var d = !1, e = Wj(b, c); 3 < b.c;)
            if (e) {
                if (!Xj(a, b, c, e, d) && !Oj(b, c, d) && !Yj(a, b, c, !0))
                    break;
            } else if (!Xj(a, b, c, e, d) && !Oj(b, c, d) && !Yj(a, b, c))
                if (e = Wj(b, c)) {
                    var d = b, f = 2 * d.c, g = Array(f), h = uj(d), l = h, m = 0;
                    do
                        g[m++] = l.aa.x, g[m++] = l.aa.y, l = vj(d);
                    while (l !== h);
                    d = !Hf(g, 0, f, 2);
                    Oj(b, c, d);
                } else {
                    e = a;
                    d = b;
                    f = g = uj(d);
                    do {
                        h = Tj(f, c);
                        if (h.length) {
                            g = h[0];
                            h = Uj(f.aa, f.W, g.aa, g.W);
                            h = Qj(e, h[0], h[1], e.a.length / 2);
                            l = new sj();
                            m = new Ej();
                            Rj(h, f.W, l, m);
                            f.W = h;
                            Fj(c, [
                                Math.min(f.aa.x, h.x),
                                Math.min(f.aa.y, h.y),
                                Math.max(f.aa.x, h.x),
                                Math.max(f.aa.y, h.y)
                            ], f);
                            for (f = vj(d); f !== g;)
                                Rj(f.aa, f.W, l, m), c.remove(f), tj(d), f = zj(d);
                            Rj(g.aa, h, l, m);
                            g.aa = h;
                            Fj(c, [
                                Math.min(g.W.x, h.x),
                                Math.min(g.W.y, h.y),
                                Math.max(g.W.x, h.x),
                                Math.max(g.W.y, h.y)
                            ], g);
                            Oj(d, c, !1);
                            Pj(e, d, c);
                            Oj(l, m, !1);
                            Pj(e, l, m);
                            break;
                        }
                        f = vj(d);
                    } while (f !== g);
                    break;
                }
        3 === b.c && (e = a.b.length, a.b[e++] = yj(b).aa.gb, a.b[e++] = zj(b).aa.gb, a.b[e++] = wj(b).aa.gb);
    }
    function Xj(a, b, c, d, e) {
        var f = a.b.length, g = uj(b), h = yj(b), l = g, m = vj(b), p = wj(b), n, q, r, v = !1;
        do {
            n = l.aa;
            q = l.W;
            r = m.W;
            if (!1 === q.vb) {
                var x = e ? Zj(p.W, r, q, n, h.aa) : Zj(h.aa, n, q, r, p.W);
                !d && Tj({
                    aa: n,
                    W: r
                }, c).length || !x || Vj(n, q, r, c, !0).length || !d && !1 !== n.vb && !1 !== r.vb && Hf([
                    h.aa.x,
                    h.aa.y,
                    n.x,
                    n.y,
                    q.x,
                    q.y,
                    r.x,
                    r.y,
                    p.W.x,
                    p.W.y
                ], 0, 10, 2) !== !e || (a.b[f++] = n.gb, a.b[f++] = q.gb, a.b[f++] = r.gb, Sj(l, m, b, c), m === g && (g = p), v = !0);
            }
            h = yj(b);
            l = zj(b);
            m = vj(b);
            p = wj(b);
        } while (l !== g && 3 < b.c);
        return v;
    }
    function Yj(a, b, c, d) {
        var e = uj(b);
        vj(b);
        var f = e, g = vj(b), h = !1;
        do {
            var l = Uj(f.aa, f.W, g.aa, g.W, d);
            if (l) {
                var m, h = a.b.length, p = a.a.length / 2, n = xj(b);
                tj(b);
                c.remove(n);
                m = n === e;
                d ? (l[0] === f.aa.x && l[1] === f.aa.y ? (xj(b), l = f.aa, g.aa = l, c.remove(f), m = m || f === e) : (l = g.W, f.W = l, c.remove(g), m = m || g === e), tj(b)) : (l = Qj(a, l[0], l[1], p), f.W = l, g.aa = l, Fj(c, [
                    Math.min(f.aa.x, f.W.x),
                    Math.min(f.aa.y, f.W.y),
                    Math.max(f.aa.x, f.W.x),
                    Math.max(f.aa.y, f.W.y)
                ], f), Fj(c, [
                    Math.min(g.aa.x, g.W.x),
                    Math.min(g.aa.y, g.W.y),
                    Math.max(g.aa.x, g.W.x),
                    Math.max(g.aa.y, g.W.y)
                ], g));
                a.b[h++] = n.aa.gb;
                a.b[h++] = n.W.gb;
                a.b[h++] = l.gb;
                h = !0;
                if (m)
                    break;
            }
            f = yj(b);
            g = vj(b);
        } while (f !== e);
        return h;
    }
    function Wj(a, b) {
        var c = uj(a), d = c;
        do {
            if (Tj(d, b).length)
                return !1;
            d = vj(a);
        } while (d !== c);
        return !0;
    }
    function Qj(a, b, c, d) {
        var e = a.a.length;
        a.a[e++] = b;
        a.a[e++] = c;
        return {
            x: b,
            y: c,
            gb: d,
            vb: void 0
        };
    }
    function Rj(a, b, c, d) {
        var e = {
                aa: a,
                W: b
            }, f = {
                ub: void 0,
                next: void 0,
                data: e
            }, g = c.b;
        if (g) {
            var h = g.next;
            f.ub = g;
            f.next = h;
            g.next = f;
            h && (h.ub = f);
            g === c.a && (c.a = f);
        } else
            c.f = f, c.a = f, c.i && (f.next = f, f.ub = f);
        c.b = f;
        c.c++;
        d && d.Ea([
            Math.min(a.x, b.x),
            Math.min(a.y, b.y),
            Math.max(a.x, b.x),
            Math.max(a.y, b.y)
        ], e);
        return e;
    }
    function Sj(a, b, c, d) {
        zj(c) === b && (tj(c), a.W = b.W, d.remove(b), Fj(d, [
            Math.min(a.aa.x, a.W.x),
            Math.min(a.aa.y, a.W.y),
            Math.max(a.aa.x, a.W.x),
            Math.max(a.aa.y, a.W.y)
        ], a));
    }
    function Vj(a, b, c, d, e) {
        var f, g, h, l = [], m = Hj(d, [
                Math.min(a.x, b.x, c.x),
                Math.min(a.y, b.y, c.y),
                Math.max(a.x, b.x, c.x),
                Math.max(a.y, b.y, c.y)
            ]);
        d = 0;
        for (f = m.length; d < f; ++d)
            for (g in m[d])
                h = m[d][g], 'object' !== typeof h || e && !h.vb || h.x === a.x && h.y === a.y || h.x === b.x && h.y === b.y || h.x === c.x && h.y === c.y || -1 !== l.indexOf(h) || !Bf([
                    a.x,
                    a.y,
                    b.x,
                    b.y,
                    c.x,
                    c.y
                ], 0, 6, 2, h.x, h.y) || l.push(h);
        return l;
    }
    function Tj(a, b, c) {
        var d = a.aa, e = a.W;
        b = Hj(b, [
            Math.min(d.x, e.x),
            Math.min(d.y, e.y),
            Math.max(d.x, e.x),
            Math.max(d.y, e.y)
        ]);
        var f = [], g, h;
        g = 0;
        for (h = b.length; g < h; ++g) {
            var l = b[g];
            a !== l && (c || l.aa !== e || l.W !== d) && Uj(d, e, l.aa, l.W, c) && f.push(l);
        }
        return f;
    }
    function Uj(a, b, c, d, e) {
        var f = (d.y - c.y) * (b.x - a.x) - (d.x - c.x) * (b.y - a.y);
        if (f && (d = ((d.x - c.x) * (a.y - c.y) - (d.y - c.y) * (a.x - c.x)) / f, c = ((b.x - a.x) * (a.y - c.y) - (b.y - a.y) * (a.x - c.x)) / f, !e && d > xi && d < 1 - xi && c > xi && c < 1 - xi || e && 0 <= d && 1 >= d && 0 <= c && 1 >= c))
            return [
                a.x + d * (b.x - a.x),
                a.y + d * (b.y - a.y)
            ];
    }
    function Zj(a, b, c, d, e) {
        if (void 0 === b.vb || void 0 === d.vb)
            return !1;
        var f = (c.x - d.x) * (b.y - d.y) > (c.y - d.y) * (b.x - d.x);
        e = (e.x - d.x) * (b.y - d.y) < (e.y - d.y) * (b.x - d.x);
        a = (a.x - b.x) * (d.y - b.y) > (a.y - b.y) * (d.x - b.x);
        c = (c.x - b.x) * (d.y - b.y) < (c.y - b.y) * (d.x - b.x);
        b = b.vb ? c || a : c && a;
        return (d.vb ? e || f : e && f) && b;
    }
    k = Kj.prototype;
    k.pc = function (a, b) {
        var c = a.Od(), d = a.sa(), e = this.b.length, f = this.l.b.length, g, h, l, m;
        g = 0;
        for (h = c.length; g < h; ++g) {
            var p = c[g].jd();
            if (0 < p.length) {
                var n = p[0].ha(), n = ef(n, n.length, d, -this.origin[0], -this.origin[1]), q = [], r;
                l = 1;
                for (m = p.length; l < m; ++l)
                    r = p[l].ha(), r = ef(r, r.length, d, -this.origin[0], -this.origin[1]), q.push(r);
                jj(this.l, n, q, d);
                Lj(this, n, q, d);
            }
        }
        this.b.length > e && (this.f.push(e), this.g.push(b), this.j.s && (this.c.push(e), this.j.s = !1));
        this.l.b.length > f && kj(this.l, b, f);
    };
    k.rc = function (a, b) {
        var c = a.jd(), d = a.sa();
        if (0 < c.length) {
            this.f.push(this.b.length);
            this.g.push(b);
            this.j.s && (this.c.push(this.b.length), this.j.s = !1);
            kj(this.l, b);
            var e = c[0].ha(), e = ef(e, e.length, d, -this.origin[0], -this.origin[1]), f = [], g, h, l;
            g = 1;
            for (h = c.length; g < h; ++g)
                l = c[g].ha(), l = ef(l, l.length, d, -this.origin[0], -this.origin[1]), f.push(l);
            jj(this.l, e, f, d);
            Lj(this, e, f, d);
        }
    };
    k.Bb = function (a) {
        this.v = new yi(this.a);
        this.o = new yi(this.b);
        this.f.push(this.b.length);
        this.l.Bb(a);
        !this.c.length && 0 < this.u.length && (this.u = []);
        this.b = this.a = null;
    };
    k.Cb = function (a) {
        var b = this.v, c = this.o, d = this.l.Cb(a);
        return function () {
            Bi(a, b);
            Bi(a, c);
            d();
        };
    };
    k.ff = function (a, b) {
        var c = Ci(b, nj, pj), d;
        this.I ? d = this.I : this.I = d = new qj(a, c);
        b.Rc(c);
        a.enableVertexAttribArray(d.b);
        a.vertexAttribPointer(d.b, 2, 5126, !1, 8, 0);
        return d;
    };
    k.gf = function (a, b) {
        a.disableVertexAttribArray(b.b);
    };
    k.Md = function (a, b, c, d) {
        var e = a.getParameter(a.DEPTH_FUNC), f = a.getParameter(a.DEPTH_WRITEMASK);
        d || (a.enable(a.DEPTH_TEST), a.depthMask(!0), a.depthFunc(a.NOTEQUAL));
        if (sb(c)) {
            var g, h, l;
            h = this.f[this.f.length - 1];
            for (c = this.c.length - 1; 0 <= c; --c)
                g = this.c[c], l = this.u[c], a.uniform4fv(this.I.G, l), si(a, b, g, h), h = g;
        } else {
            var m, p, n, q;
            n = this.f.length - 2;
            l = h = this.f[n + 1];
            for (g = this.c.length - 1; 0 <= g; --g) {
                m = this.u[g];
                a.uniform4fv(this.I.G, m);
                for (m = this.c[g]; 0 <= n && this.f[n] >= m;)
                    q = this.f[n], p = this.g[n], p = w(p).toString(), c[p] && (h !== l && (si(a, b, h, l), a.clear(a.DEPTH_BUFFER_BIT)), l = q), n--, h = q;
                h !== l && (si(a, b, h, l), a.clear(a.DEPTH_BUFFER_BIT));
                h = l = m;
            }
        }
        d || (a.disable(a.DEPTH_TEST), a.clear(a.DEPTH_BUFFER_BIT), a.depthMask(f), a.depthFunc(e));
    };
    k.qe = function (a, b, c, d, e) {
        var f, g, h, l, m, p, n;
        n = this.f.length - 2;
        h = this.f[n + 1];
        for (f = this.c.length - 1; 0 <= f; --f)
            for (g = this.u[f], a.uniform4fv(this.I.G, g), l = this.c[f]; 0 <= n && this.f[n] >= l;) {
                g = this.f[n];
                m = this.g[n];
                p = w(m).toString();
                if (void 0 === c[p] && m.U() && (void 0 === e || mb(e, m.U().D())) && (a.clear(a.COLOR_BUFFER_BIT | a.DEPTH_BUFFER_BIT), si(a, b, g, h), h = d(m)))
                    return h;
                n--;
                h = g;
            }
    };
    k.Na = function (a, b) {
        var c = a ? a.b : [
            0,
            0,
            0,
            0
        ];
        c instanceof CanvasGradient || c instanceof CanvasPattern ? c = ti : c = Qc(c).map(function (a, b) {
            return 3 != b ? a / 255 : a;
        }) || ti;
        this.j.fillColor && ia(c, this.j.fillColor) || (this.j.fillColor = c, this.j.s = !0, this.u.push(c));
        b ? this.l.Na(null, b) : this.l.Na(null, new rj({
            color: [
                0,
                0,
                0,
                0
            ],
            lineWidth: 0
        }));
    };
    function ak() {
    }
    ak.prototype.i = function () {
    };
    function bk(a, b, c) {
        this.g = b;
        this.l = a;
        this.c = c;
        this.a = {};
    }
    u(bk, fi);
    function ck(a, b) {
        var c = [], d;
        for (d in a.a) {
            var e = a.a[d], f;
            for (f in e)
                c.push(e[f].Cb(b));
        }
        return function () {
            for (var a = c.length, b, d = 0; d < a; d++)
                b = c[d].apply(this, arguments);
            return b;
        };
    }
    function dk(a, b) {
        for (var c in a.a) {
            var d = a.a[c], e;
            for (e in d)
                d[e].Bb(b);
        }
    }
    bk.prototype.b = function (a, b) {
        var c = void 0 !== a ? a.toString() : '0', d = this.a[c];
        void 0 === d && (d = {}, this.a[c] = d);
        c = d[b];
        void 0 === c && (c = new ek[b](this.l, this.g), d[b] = c);
        return c;
    };
    bk.prototype.f = function () {
        return sb(this.a);
    };
    bk.prototype.i = function (a, b, c, d, e, f, g, h) {
        var l = Object.keys(this.a).map(Number);
        l.sort(da);
        var m, p, n, q, r, v;
        m = 0;
        for (p = l.length; m < p; ++m)
            for (r = this.a[l[m].toString()], n = 0, q = ei.length; n < q; ++n)
                v = r[ei[n]], void 0 !== v && v.i(a, b, c, d, e, f, g, h, void 0, !1);
    };
    function fk(a, b, c, d, e, f, g, h, l, m, p) {
        var n = gk, q = Object.keys(a.a).map(Number);
        q.sort(function (a, b) {
            return b - a;
        });
        var r, v, x, y, z;
        r = 0;
        for (v = q.length; r < v; ++r)
            for (y = a.a[q[r].toString()], x = ei.length - 1; 0 <= x; --x)
                if (z = y[ei[x]], void 0 !== z && (z = z.i(b, c, d, e, n, f, g, h, l, m, p)))
                    return z;
    }
    bk.prototype.Aa = function (a, b, c, d, e, f, g, h, l, m) {
        var p = b.b;
        p.bindFramebuffer(p.FRAMEBUFFER, Ki(b));
        var n;
        void 0 !== this.c && (n = Ka(Wa(a), d * this.c));
        return fk(this, b, a, d, e, g, h, l, function (a) {
            var b = new Uint8Array(4);
            p.readPixels(0, 0, 1, 1, p.RGBA, p.UNSIGNED_BYTE, b);
            if (0 < b[3] && (a = m(a)))
                return a;
        }, !0, n);
    };
    function hk(a, b, c, d, e, f, g, h) {
        var l = c.b;
        l.bindFramebuffer(l.FRAMEBUFFER, Ki(c));
        return void 0 !== fk(a, c, b, d, e, f, g, h, function () {
            var a = new Uint8Array(4);
            l.readPixels(0, 0, 1, 1, l.RGBA, l.UNSIGNED_BYTE, a);
            return 0 < a[3];
        }, !1);
    }
    var gk = [
            1,
            1
        ], ek = {
            Circle: Ai,
            Image: Pi,
            LineString: Yi,
            Polygon: Kj,
            Text: ak
        };
    function ik(a, b, c, d, e, f, g) {
        this.b = a;
        this.f = b;
        this.a = f;
        this.c = g;
        this.l = e;
        this.g = d;
        this.i = c;
        this.j = this.o = this.v = null;
    }
    u(ik, Rh);
    k = ik.prototype;
    k.pd = function (a) {
        this.Na(a.Ca(), a.Da());
        this.Vb(a.Z());
    };
    k.mc = function (a) {
        switch (a.T()) {
        case 'Point':
            this.qc(a, null);
            break;
        case 'LineString':
            this.Qb(a, null);
            break;
        case 'Polygon':
            this.rc(a, null);
            break;
        case 'MultiPoint':
            this.oc(a, null);
            break;
        case 'MultiLineString':
            this.nc(a, null);
            break;
        case 'MultiPolygon':
            this.pc(a, null);
            break;
        case 'GeometryCollection':
            this.pe(a, null);
            break;
        case 'Circle':
            this.$b(a, null);
        }
    };
    k.oe = function (a, b) {
        var c = (0, b.Ra)(a);
        c && mb(this.a, c.D()) && (this.pd(b), this.mc(c));
    };
    k.pe = function (a) {
        a = a.a;
        var b, c;
        b = 0;
        for (c = a.length; b < c; ++b)
            this.mc(a[b]);
    };
    k.qc = function (a, b) {
        var c = this.b, d = new bk(1, this.a).b(0, 'Image');
        d.Vb(this.v);
        d.qc(a, b);
        d.Bb(c);
        d.i(this.b, this.f, this.i, this.g, this.l, this.c, 1, {}, void 0, !1);
        d.Cb(c)();
    };
    k.oc = function (a, b) {
        var c = this.b, d = new bk(1, this.a).b(0, 'Image');
        d.Vb(this.v);
        d.oc(a, b);
        d.Bb(c);
        d.i(this.b, this.f, this.i, this.g, this.l, this.c, 1, {}, void 0, !1);
        d.Cb(c)();
    };
    k.Qb = function (a, b) {
        var c = this.b, d = new bk(1, this.a).b(0, 'LineString');
        d.Na(null, this.j);
        d.Qb(a, b);
        d.Bb(c);
        d.i(this.b, this.f, this.i, this.g, this.l, this.c, 1, {}, void 0, !1);
        d.Cb(c)();
    };
    k.nc = function (a, b) {
        var c = this.b, d = new bk(1, this.a).b(0, 'LineString');
        d.Na(null, this.j);
        d.nc(a, b);
        d.Bb(c);
        d.i(this.b, this.f, this.i, this.g, this.l, this.c, 1, {}, void 0, !1);
        d.Cb(c)();
    };
    k.rc = function (a, b) {
        var c = this.b, d = new bk(1, this.a).b(0, 'Polygon');
        d.Na(this.o, this.j);
        d.rc(a, b);
        d.Bb(c);
        d.i(this.b, this.f, this.i, this.g, this.l, this.c, 1, {}, void 0, !1);
        d.Cb(c)();
    };
    k.pc = function (a, b) {
        var c = this.b, d = new bk(1, this.a).b(0, 'Polygon');
        d.Na(this.o, this.j);
        d.pc(a, b);
        d.Bb(c);
        d.i(this.b, this.f, this.i, this.g, this.l, this.c, 1, {}, void 0, !1);
        d.Cb(c)();
    };
    k.$b = function (a, b) {
        var c = this.b, d = new bk(1, this.a).b(0, 'Circle');
        d.Na(this.o, this.j);
        d.$b(a, b);
        d.Bb(c);
        d.i(this.b, this.f, this.i, this.g, this.l, this.c, 1, {}, void 0, !1);
        d.Cb(c)();
    };
    k.Vb = function (a) {
        this.v = a;
    };
    k.Na = function (a, b) {
        this.o = a;
        this.j = b;
    };
    function jk() {
        this.c = 0;
        this.b = {};
        this.f = this.a = null;
    }
    k = jk.prototype;
    k.clear = function () {
        this.c = 0;
        this.b = {};
        this.f = this.a = null;
    };
    k.forEach = function (a, b) {
        for (var c = this.a; c;)
            a.call(b, c.$c, c.tc, this), c = c.Lb;
    };
    k.get = function (a) {
        a = this.b[a];
        qa(!!a, 15);
        if (a === this.f)
            return a.$c;
        a === this.a ? (this.a = this.a.Lb, this.a.td = null) : (a.Lb.td = a.td, a.td.Lb = a.Lb);
        a.Lb = null;
        a.td = this.f;
        this.f = this.f.Lb = a;
        return a.$c;
    };
    k.pop = function () {
        var a = this.a;
        delete this.b[a.tc];
        a.Lb && (a.Lb.td = null);
        this.a = a.Lb;
        this.a || (this.f = null);
        --this.c;
        return a.$c;
    };
    k.replace = function (a, b) {
        this.get(a);
        this.b[a].$c = b;
    };
    k.set = function (a, b) {
        qa(!(a in this.b), 16);
        var c = {
            tc: a,
            Lb: null,
            td: this.f,
            $c: b
        };
        this.f ? this.f.Lb = c : this.a = c;
        this.f = c;
        this.b[a] = c;
        ++this.c;
    };
    function kk(a, b) {
        Hh.call(this, 0, b);
        this.b = document.createElement('CANVAS');
        this.b.style.width = '100%';
        this.b.style.height = '100%';
        this.b.style.display = 'block';
        this.b.className = 'ol-unselectable';
        a.insertBefore(this.b, a.childNodes[0] || null);
        this.u = this.A = 0;
        this.C = Xc();
        this.o = !0;
        this.f = Dd(this.b, {
            antialias: !0,
            depth: !0,
            failIfMajorPerformanceCaveat: !0,
            preserveDrawingBuffer: !1,
            stencil: !0
        });
        this.i = new Ji(this.b, this.f);
        B(this.b, 'webglcontextlost', this.nn, this);
        B(this.b, 'webglcontextrestored', this.pn, this);
        this.a = new jk();
        this.I = null;
        this.l = new Ae(function (a) {
            var b = a[1];
            a = a[2];
            var c = b[0] - this.I[0], b = b[1] - this.I[1];
            return 65536 * Math.log(a) + Math.sqrt(c * c + b * b) / a;
        }.bind(this), function (a) {
            return a[0].ib();
        });
        this.G = function () {
            if (this.l.b.length) {
                Ee(this.l);
                var a = Be(this.l);
                lk(this, a[0], a[3], a[4]);
            }
            return !1;
        }.bind(this);
        this.g = 0;
        mk(this);
    }
    u(kk, Hh);
    function lk(a, b, c, d) {
        var e = a.f, f = b.ib();
        if (a.a.b.hasOwnProperty(f))
            a = a.a.get(f), e.bindTexture(3553, a.Fb), 9729 != a.Bh && (e.texParameteri(3553, 10240, 9729), a.Bh = 9729), 9729 != a.Dh && (e.texParameteri(3553, 10241, 9729), a.Dh = 9729);
        else {
            var g = e.createTexture();
            e.bindTexture(3553, g);
            if (0 < d) {
                var h = a.C.canvas, l = a.C;
                a.A !== c[0] || a.u !== c[1] ? (h.width = c[0], h.height = c[1], a.A = c[0], a.u = c[1]) : l.clearRect(0, 0, c[0], c[1]);
                l.drawImage(b.Z(), d, d, c[0], c[1], 0, 0, c[0], c[1]);
                e.texImage2D(3553, 0, 6408, 6408, 5121, h);
            } else
                e.texImage2D(3553, 0, 6408, 6408, 5121, b.Z());
            e.texParameteri(3553, 10240, 9729);
            e.texParameteri(3553, 10241, 9729);
            e.texParameteri(3553, 10242, 33071);
            e.texParameteri(3553, 10243, 33071);
            a.a.set(f, {
                Fb: g,
                Bh: 9729,
                Dh: 9729
            });
        }
    }
    function nk(a, b, c) {
        var d = a.j;
        if (Ec(d, b)) {
            a = a.i;
            var e = c.viewState;
            d.b(new Mh(b, new ik(a, e.center, e.resolution, e.rotation, c.size, c.extent, c.pixelRatio), c, null, a));
        }
    }
    k = kk.prototype;
    k.ra = function () {
        var a = this.f;
        a.isContextLost() || this.a.forEach(function (b) {
            b && a.deleteTexture(b.Fb);
        });
        Ac(this.i);
        Hh.prototype.ra.call(this);
    };
    k.bk = function (a, b) {
        for (var c = this.f, d; 1024 < this.a.c - this.g;) {
            if (d = this.a.a.$c)
                c.deleteTexture(d.Fb);
            else if (+this.a.a.tc == b.index)
                break;
            else
                --this.g;
            this.a.pop();
        }
    };
    k.T = function () {
        return 'webgl';
    };
    k.nn = function (a) {
        a.preventDefault();
        this.a.clear();
        this.g = 0;
        a = this.c;
        for (var b in a)
            a[b].$f();
    };
    k.pn = function () {
        mk(this);
        this.j.render();
    };
    function mk(a) {
        a = a.f;
        a.activeTexture(33984);
        a.blendFuncSeparate(770, 771, 1, 771);
        a.disable(2884);
        a.disable(2929);
        a.disable(3089);
        a.disable(2960);
    }
    k.vg = function (a) {
        var b = this.i, c = this.f;
        if (c.isContextLost())
            return !1;
        if (!a)
            return this.o && (this.b.style.display = 'none', this.o = !1), !1;
        this.I = a.focus;
        this.a.set((-a.index).toString(), null);
        ++this.g;
        nk(this, 'precompose', a);
        var d = [], e = a.layerStatesArray;
        ja(e);
        var f = a.viewState.resolution, g, h, l, m;
        g = 0;
        for (h = e.length; g < h; ++g)
            m = e[g], sh(m, f) && 'ready' == m.Ui && (l = Kh(this, m.layer), l.ag(a, m, b) && d.push(m));
        e = a.size[0] * a.pixelRatio;
        f = a.size[1] * a.pixelRatio;
        if (this.b.width != e || this.b.height != f)
            this.b.width = e, this.b.height = f;
        c.bindFramebuffer(36160, null);
        c.clearColor(0, 0, 0, 0);
        c.clear(16384);
        c.enable(3042);
        c.viewport(0, 0, this.b.width, this.b.height);
        g = 0;
        for (h = d.length; g < h; ++g)
            m = d[g], l = Kh(this, m.layer), l.ai(a, m, b);
        this.o || (this.b.style.display = '', this.o = !0);
        Ih(a);
        1024 < this.a.c - this.g && a.postRenderFunctions.push(this.bk.bind(this));
        this.l.b.length && (a.postRenderFunctions.push(this.G), a.animate = !0);
        nk(this, 'postcompose', a);
        Lh(this, a);
        a.postRenderFunctions.push(Jh);
    };
    k.Aa = function (a, b, c, d, e, f, g) {
        var h;
        if (this.f.isContextLost())
            return !1;
        var l = b.viewState, m = b.layerStatesArray, p;
        for (p = m.length - 1; 0 <= p; --p) {
            h = m[p];
            var n = h.layer;
            if (sh(h, l.resolution) && f.call(g, n) && (h = Kh(this, n).Aa(a, b, c, d, e)))
                return h;
        }
    };
    k.Zh = function (a, b, c, d, e) {
        c = !1;
        if (this.f.isContextLost())
            return !1;
        var f = b.viewState, g = b.layerStatesArray, h;
        for (h = g.length - 1; 0 <= h; --h) {
            var l = g[h], m = l.layer;
            if (sh(l, f.resolution) && d.call(e, m) && (c = Kh(this, m).Ke(a, b)))
                return !0;
        }
        return c;
    };
    k.Yh = function (a, b, c, d, e) {
        if (this.f.isContextLost())
            return !1;
        var f = b.viewState, g, h = b.layerStatesArray, l;
        for (l = h.length - 1; 0 <= l; --l) {
            g = h[l];
            var m = g.layer;
            if (sh(g, f.resolution) && e.call(d, m) && (g = Kh(this, m).Zf(a, b, c, d)))
                return g;
        }
    };
    var ok = [
        'canvas',
        'webgl'
    ];
    function G(a) {
        Gc.call(this);
        var b = pk(a);
        this.rf = void 0 !== a.loadTilesWhileAnimating ? a.loadTilesWhileAnimating : !1;
        this.sf = void 0 !== a.loadTilesWhileInteracting ? a.loadTilesWhileInteracting : !1;
        this.xf = void 0 !== a.pixelRatio ? a.pixelRatio : Kd;
        this.pf = b.logos;
        this.ia = function () {
            this.g = void 0;
            this.hp.call(this, Date.now());
        }.bind(this);
        this.mb = wh();
        this.yf = wh();
        this.Bd = 0;
        this.a = null;
        this.lb = Ia();
        this.G = this.R = this.S = null;
        this.c = document.createElement('DIV');
        this.c.className = 'ol-viewport' + (Pd ? ' ol-touch' : '');
        this.c.style.position = 'relative';
        this.c.style.overflow = 'hidden';
        this.c.style.width = '100%';
        this.c.style.height = '100%';
        this.c.style.msTouchAction = 'none';
        this.c.style.touchAction = 'none';
        this.A = document.createElement('DIV');
        this.A.className = 'ol-overlaycontainer';
        this.c.appendChild(this.A);
        this.u = document.createElement('DIV');
        this.u.className = 'ol-overlaycontainer-stopevent';
        a = 'click dblclick mousedown touchstart mspointerdown pointerdown mousewheel wheel'.split(' ');
        for (var c = 0, d = a.length; c < d; ++c)
            B(this.u, a[c], Cc);
        this.c.appendChild(this.u);
        this.Ja = new xe(this);
        for (var e in Ad)
            B(this.Ja, Ad[e], this.uh, this);
        this.oa = b.keyboardEventTarget;
        this.v = null;
        B(this.c, 'wheel', this.ld, this);
        B(this.c, 'mousewheel', this.ld, this);
        this.j = b.controls;
        this.l = b.interactions;
        this.o = b.overlays;
        this.dg = {};
        this.C = new b.jp(this.c, this);
        this.Y = null;
        this.Oa = [];
        this.Ha = new Fe(this.Wk.bind(this), this.Cl.bind(this));
        this.ea = {};
        B(this, Ic('layergroup'), this.kl, this);
        B(this, Ic('view'), this.Dl, this);
        B(this, Ic('size'), this.zl, this);
        B(this, Ic('target'), this.Bl, this);
        this.H(b.values);
        this.j.forEach(function (a) {
            a.setMap(this);
        }, this);
        B(this.j, 'add', function (a) {
            a.element.setMap(this);
        }, this);
        B(this.j, 'remove', function (a) {
            a.element.setMap(null);
        }, this);
        this.l.forEach(function (a) {
            a.setMap(this);
        }, this);
        B(this.l, 'add', function (a) {
            a.element.setMap(this);
        }, this);
        B(this.l, 'remove', function (a) {
            a.element.setMap(null);
        }, this);
        this.o.forEach(this.Ug, this);
        B(this.o, 'add', function (a) {
            this.Ug(a.element);
        }, this);
        B(this.o, 'remove', function (a) {
            var b = a.element.g;
            void 0 !== b && delete this.dg[b.toString()];
            a.element.setMap(null);
        }, this);
    }
    u(G, Gc);
    k = G.prototype;
    k.Rj = function (a) {
        this.j.push(a);
    };
    k.Sj = function (a) {
        this.l.push(a);
    };
    k.Sg = function (a) {
        this.Jc().od().push(a);
    };
    k.Tg = function (a) {
        this.o.push(a);
    };
    k.Ug = function (a) {
        var b = a.g;
        void 0 !== b && (this.dg[b.toString()] = a);
        a.setMap(this);
    };
    k.ra = function () {
        Ac(this.Ja);
        Ac(this.C);
        xc(this.c, 'wheel', this.ld, this);
        xc(this.c, 'mousewheel', this.ld, this);
        this.i && (window.removeEventListener('resize', this.i, !1), this.i = void 0);
        this.g && (cancelAnimationFrame(this.g), this.g = void 0);
        this.Fe(null);
        Gc.prototype.ra.call(this);
    };
    k.re = function (a, b, c) {
        if (this.a)
            return a = this.Za(a), c = c ? c : {}, this.C.Aa(a, this.a, void 0 !== c.hitTolerance ? c.hitTolerance * this.a.pixelRatio : 0, b, null, c.layerFilter ? c.layerFilter : af, null);
    };
    k.pm = function (a, b, c, d, e) {
        if (this.a)
            return this.C.Yh(a, this.a, b, void 0 !== c ? c : null, d ? d : af, void 0 !== e ? e : null);
    };
    k.El = function (a, b) {
        if (!this.a)
            return !1;
        var c = this.Za(a);
        b = b ? b : {};
        return this.C.Zh(c, this.a, void 0 !== b.hitTolerance ? b.hitTolerance * this.a.pixelRatio : 0, b.layerFilter ? b.layerFilter : af, null);
    };
    k.sk = function (a) {
        return this.Za(this.te(a));
    };
    k.te = function (a) {
        var b = this.c.getBoundingClientRect();
        a = a.changedTouches ? a.changedTouches[0] : a;
        return [
            a.clientX - b.left,
            a.clientY - b.top
        ];
    };
    k.Of = function () {
        return this.get('target');
    };
    k.Kc = function () {
        var a = this.Of();
        return void 0 !== a ? 'string' === typeof a ? document.getElementById(a) : a : null;
    };
    k.Za = function (a) {
        var b = this.a;
        return b ? Bh(b.pixelToCoordinateTransform, a.slice()) : null;
    };
    k.qk = function () {
        return this.j;
    };
    k.Lk = function () {
        return this.o;
    };
    k.Kk = function (a) {
        a = this.dg[a.toString()];
        return void 0 !== a ? a : null;
    };
    k.xk = function () {
        return this.l;
    };
    k.Jc = function () {
        return this.get('layergroup');
    };
    k.Jh = function () {
        return this.Jc().od();
    };
    k.Ka = function (a) {
        var b = this.a;
        return b ? Bh(b.coordinateToPixelTransform, a.slice(0, 2)) : null;
    };
    k.Mb = function () {
        return this.get('size');
    };
    k.$ = function () {
        return this.get('view');
    };
    k.Yk = function () {
        return this.c;
    };
    k.Wk = function (a, b, c, d) {
        var e = this.a;
        if (!(e && b in e.wantedTiles && e.wantedTiles[b][a.ib()]))
            return Infinity;
        a = c[0] - e.focus[0];
        c = c[1] - e.focus[1];
        return 65536 * Math.log(d) + Math.sqrt(a * a + c * c) / d;
    };
    k.ld = function (a, b) {
        var c = new zd(b || a.type, this, a);
        this.uh(c);
    };
    k.uh = function (a) {
        if (this.a) {
            this.Y = a.coordinate;
            a.frameState = this.a;
            var b = this.l.a, c;
            if (!1 !== this.b(a))
                for (c = b.length - 1; 0 <= c; c--) {
                    var d = b[c];
                    if (d.c() && !d.handleEvent(a))
                        break;
                }
        }
    };
    k.xl = function () {
        var a = this.a, b = this.Ha;
        if (b.b.length) {
            var c = 16, d = c;
            if (a) {
                var e = a.viewHints;
                e[0] && (c = this.rf ? 8 : 0, d = 2);
                e[1] && (c = this.sf ? 8 : 0, d = 2);
            }
            b.l < c && (Ee(b), Ge(b, c, d));
        }
        b = this.Oa;
        c = 0;
        for (d = b.length; c < d; ++c)
            b[c](this, a);
        b.length = 0;
    };
    k.zl = function () {
        this.render();
    };
    k.Bl = function () {
        var a;
        this.Of() && (a = this.Kc());
        if (this.v) {
            for (var b = 0, c = this.v.length; b < c; ++b)
                rc(this.v[b]);
            this.v = null;
        }
        a ? (a.appendChild(this.c), a = this.oa ? this.oa : a, this.v = [
            B(a, 'keydown', this.ld, this),
            B(a, 'keypress', this.ld, this)
        ], this.i || (this.i = this.xd.bind(this), window.addEventListener('resize', this.i, !1))) : (Zc(this.c), this.i && (window.removeEventListener('resize', this.i, !1), this.i = void 0));
        this.xd();
    };
    k.Cl = function () {
        this.render();
    };
    k.xh = function () {
        this.render();
    };
    k.Dl = function () {
        this.S && (rc(this.S), this.S = null);
        this.R && (rc(this.R), this.R = null);
        var a = this.$();
        a && (this.c.setAttribute('data-view', w(a)), this.S = B(a, 'propertychange', this.xh, this), this.R = B(a, 'change', this.xh, this));
        this.render();
    };
    k.kl = function () {
        this.G && (this.G.forEach(rc), this.G = null);
        var a = this.Jc();
        a && (this.G = [
            B(a, 'propertychange', this.render, this),
            B(a, 'change', this.render, this)
        ]);
        this.render();
    };
    k.ip = function () {
        this.g && cancelAnimationFrame(this.g);
        this.ia();
    };
    k.render = function () {
        void 0 === this.g && (this.g = requestAnimationFrame(this.ia));
    };
    k.ap = function (a) {
        return this.j.remove(a);
    };
    k.bp = function (a) {
        return this.l.remove(a);
    };
    k.ep = function (a) {
        return this.Jc().od().remove(a);
    };
    k.fp = function (a) {
        return this.o.remove(a);
    };
    k.hp = function (a) {
        var b, c, d = this.Mb(), e = this.$(), f = Ia(), g = null;
        if (void 0 !== d && 0 < d[0] && 0 < d[1] && e && Yf(e)) {
            var g = ld(e, this.a ? this.a.viewHints : void 0), h = this.Jc().Lf(), l = {};
            b = 0;
            for (c = h.length; b < c; ++b)
                l[w(h[b].layer)] = h[b];
            b = e.V();
            g = {
                animate: !1,
                attributions: {},
                coordinateToPixelTransform: this.mb,
                extent: f,
                focus: this.Y ? this.Y : b.center,
                index: this.Bd++,
                layerStates: l,
                layerStatesArray: h,
                logos: pb({}, this.pf),
                pixelRatio: this.xf,
                pixelToCoordinateTransform: this.yf,
                postRenderFunctions: [],
                size: d,
                skippedFeatureUids: this.ea,
                tileQueue: this.Ha,
                time: a,
                usedTiles: {},
                viewState: b,
                viewHints: g,
                wantedTiles: {}
            };
        }
        g && (g.extent = kb(b.center, b.resolution, b.rotation, g.size, f));
        this.a = g;
        this.C.vg(g);
        g && (g.animate && this.render(), Array.prototype.push.apply(this.Oa, g.postRenderFunctions), g.viewHints[0] || g.viewHints[1] || Za(g.extent, this.lb) || (this.b(new yd('moveend', this, g)), Na(g.extent, this.lb)));
        this.b(new yd('postrender', this, g));
        setTimeout(this.xl.bind(this), 0);
    };
    k.Li = function (a) {
        this.set('layergroup', a);
    };
    k.Ag = function (a) {
        this.set('size', a);
    };
    k.Fe = function (a) {
        this.set('target', a);
    };
    k.vp = function (a) {
        this.set('view', a);
    };
    k.Ti = function (a) {
        a = w(a).toString();
        this.ea[a] = !0;
        this.render();
    };
    k.xd = function () {
        var a = this.Kc();
        if (a) {
            var b = getComputedStyle(a);
            this.Ag([
                a.offsetWidth - parseFloat(b.borderLeftWidth) - parseFloat(b.paddingLeft) - parseFloat(b.paddingRight) - parseFloat(b.borderRightWidth),
                a.offsetHeight - parseFloat(b.borderTopWidth) - parseFloat(b.paddingTop) - parseFloat(b.paddingBottom) - parseFloat(b.borderBottomWidth)
            ]);
        } else
            this.Ag(void 0);
    };
    k.Zi = function (a) {
        a = w(a).toString();
        delete this.ea[a];
        this.render();
    };
    function pk(a) {
        var b = null;
        void 0 !== a.keyboardEventTarget && (b = 'string' === typeof a.keyboardEventTarget ? document.getElementById(a.keyboardEventTarget) : a.keyboardEventTarget);
        var c = {}, d = {};
        if (void 0 === a.logo || 'boolean' === typeof a.logo && a.logo)
            d['data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAHGAAABxgEXwfpGAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAhNQTFRF////AP//AICAgP//AFVVQECA////K1VVSbbbYL/fJ05idsTYJFtbbcjbJllmZszWWMTOIFhoHlNiZszTa9DdUcHNHlNlV8XRIVdiasrUHlZjIVZjaMnVH1RlIFRkH1RkH1ZlasvYasvXVsPQH1VkacnVa8vWIVZjIFRjVMPQa8rXIVVkXsXRsNveIFVkIFZlIVVj3eDeh6GmbMvXH1ZkIFRka8rWbMvXIFVkIFVjIFVkbMvWH1VjbMvWIFVlbcvWIFVla8vVIFVkbMvWbMvVH1VkbMvWIFVlbcvWIFVkbcvVbMvWjNPbIFVkU8LPwMzNIFVkbczWIFVkbsvWbMvXIFVkRnB8bcvW2+TkW8XRIFVkIlZlJVloJlpoKlxrLl9tMmJwOWd0Omh1RXF8TneCT3iDUHiDU8LPVMLPVcLPVcPQVsPPVsPQV8PQWMTQWsTQW8TQXMXSXsXRX4SNX8bSYMfTYcfTYsfTY8jUZcfSZsnUaIqTacrVasrVa8jTa8rWbI2VbMvWbcvWdJObdcvUdszUd8vVeJaee87Yfc3WgJyjhqGnitDYjaarldPZnrK2oNbborW5o9bbo9fbpLa6q9ndrL3ArtndscDDutzfu8fJwN7gwt7gxc/QyuHhy+HizeHi0NfX0+Pj19zb1+Tj2uXk29/e3uLg3+Lh3+bl4uXj4ufl4+fl5Ofl5ufl5ujm5+jmySDnBAAAAFp0Uk5TAAECAgMEBAYHCA0NDg4UGRogIiMmKSssLzU7PkJJT1JTVFliY2hrdHZ3foSFhYeJjY2QkpugqbG1tre5w8zQ09XY3uXn6+zx8vT09vf4+Pj5+fr6/P39/f3+gz7SsAAAAVVJREFUOMtjYKA7EBDnwCPLrObS1BRiLoJLnte6CQy8FLHLCzs2QUG4FjZ5GbcmBDDjxJBXDWxCBrb8aM4zbkIDzpLYnAcE9VXlJSWlZRU13koIeW57mGx5XjoMZEUqwxWYQaQbSzLSkYGfKFSe0QMsX5WbjgY0YS4MBplemI4BdGBW+DQ11eZiymfqQuXZIjqwyadPNoSZ4L+0FVM6e+oGI6g8a9iKNT3o8kVzNkzRg5lgl7p4wyRUL9Yt2jAxVh6mQCogae6GmflI8p0r13VFWTHBQ0rWPW7ahgWVcPm+9cuLoyy4kCJDzCm6d8PSFoh0zvQNC5OjDJhQopPPJqph1doJBUD5tnkbZiUEqaCnB3bTqLTFG1bPn71kw4b+GFdpLElKIzRxxgYgWNYc5SCENVHKeUaltHdXx0dZ8uBI1hJ2UUDgq82CM2MwKeibqAvSO7MCABq0wXEPiqWEAAAAAElFTkSuQmCC'] = 'https://openlayers.org/';
        else {
            var e = a.logo;
            'string' === typeof e ? d[e] = '' : e instanceof HTMLElement ? d[w(e).toString()] = e : e && (qa('string' == typeof e.href, 44), qa('string' == typeof e.src, 45), d[e.src] = e.href);
        }
        e = a.layers instanceof fh ? a.layers : new fh({ layers: a.layers });
        c.layergroup = e;
        c.target = a.target;
        c.view = void 0 !== a.view ? a.view : new Qf();
        var e = Hh, f;
        void 0 !== a.renderer ? (Array.isArray(a.renderer) ? f = a.renderer : 'string' === typeof a.renderer ? f = [a.renderer] : qa(!1, 46), 0 <= f.indexOf('dom') && (f = f.concat(ok))) : f = ok;
        var g, h;
        g = 0;
        for (h = f.length; g < h; ++g) {
            var l = f[g];
            if ('canvas' == l) {
                if (Md) {
                    e = ci;
                    break;
                }
            } else if ('webgl' == l && Ed) {
                e = kk;
                break;
            }
        }
        void 0 !== a.controls ? Array.isArray(a.controls) ? f = new D(a.controls.slice()) : (qa(a.controls instanceof D, 47), f = a.controls) : f = nd();
        void 0 !== a.interactions ? Array.isArray(a.interactions) ? g = new D(a.interactions.slice()) : (qa(a.interactions instanceof D, 48), g = a.interactions) : g = ch();
        void 0 !== a.overlays ? Array.isArray(a.overlays) ? a = new D(a.overlays.slice()) : (qa(a.overlays instanceof D, 49), a = a.overlays) : a = new D();
        return {
            controls: f,
            interactions: g,
            keyboardEventTarget: b,
            logos: d,
            overlays: a,
            jp: e,
            values: c
        };
    }
    qh();
    function qk(a) {
        Gc.call(this);
        this.g = a.id;
        this.o = void 0 !== a.insertFirst ? a.insertFirst : !0;
        this.v = void 0 !== a.stopEvent ? a.stopEvent : !0;
        this.c = document.createElement('DIV');
        this.c.className = 'ol-overlay-container';
        this.c.style.position = 'absolute';
        this.autoPan = void 0 !== a.autoPan ? a.autoPan : !1;
        this.l = a.autoPanAnimation || {};
        this.j = void 0 !== a.autoPanMargin ? a.autoPanMargin : 20;
        this.a = {
            me: '',
            Ce: '',
            bf: '',
            kf: '',
            visible: !0
        };
        this.i = null;
        B(this, Ic(rk), this.fl, this);
        B(this, Ic(sk), this.pl, this);
        B(this, Ic(tk), this.tl, this);
        B(this, Ic(uk), this.vl, this);
        B(this, Ic(vk), this.wl, this);
        void 0 !== a.element && this.Gi(a.element);
        this.Ni(void 0 !== a.offset ? a.offset : [
            0,
            0
        ]);
        this.Qi(void 0 !== a.positioning ? a.positioning : 'top-left');
        void 0 !== a.position && this.Wf(a.position);
    }
    u(qk, Gc);
    k = qk.prototype;
    k.se = function () {
        return this.get(rk);
    };
    k.qm = function () {
        return this.g;
    };
    k.Ge = function () {
        return this.get(sk);
    };
    k.qh = function () {
        return this.get(tk);
    };
    k.Kh = function () {
        return this.get(uk);
    };
    k.rh = function () {
        return this.get(vk);
    };
    k.fl = function () {
        for (var a = this.c; a.lastChild;)
            a.removeChild(a.lastChild);
        (a = this.se()) && this.c.appendChild(a);
    };
    k.pl = function () {
        this.i && (Zc(this.c), rc(this.i), this.i = null);
        var a = this.Ge();
        a && (this.i = B(a, 'postrender', this.render, this), wk(this), a = this.v ? a.u : a.A, this.o ? a.insertBefore(this.c, a.childNodes[0] || null) : a.appendChild(this.c));
    };
    k.render = function () {
        wk(this);
    };
    k.tl = function () {
        wk(this);
    };
    k.vl = function () {
        wk(this);
        if (this.get(uk) && this.autoPan) {
            var a = this.Ge();
            if (a && a.Kc()) {
                var b = xk(a.Kc(), a.Mb()), c = this.se(), d = c.offsetWidth, e = c.currentStyle || getComputedStyle(c), d = d + (parseInt(e.marginLeft, 10) + parseInt(e.marginRight, 10)), e = c.offsetHeight, f = c.currentStyle || getComputedStyle(c), e = e + (parseInt(f.marginTop, 10) + parseInt(f.marginBottom, 10)), g = xk(c, [
                        d,
                        e
                    ]), c = this.j;
                Ta(b, g) || (d = g[0] - b[0], e = b[2] - g[2], f = g[1] - b[1], g = b[3] - g[3], b = [
                    0,
                    0
                ], 0 > d ? b[0] = d - c : 0 > e && (b[0] = Math.abs(e) + c), 0 > f ? b[1] = f - c : 0 > g && (b[1] = Math.abs(g) + c), 0 === b[0] && 0 === b[1]) || (c = a.$().Ba(), c = a.Ka(c), b = [
                    c[0] + b[0],
                    c[1] + b[1]
                ], a.$().animate({
                    center: a.Za(b),
                    duration: this.l.duration,
                    easing: this.l.easing
                }));
            }
        }
    };
    k.wl = function () {
        wk(this);
    };
    k.Gi = function (a) {
        this.set(rk, a);
    };
    k.setMap = function (a) {
        this.set(sk, a);
    };
    k.Ni = function (a) {
        this.set(tk, a);
    };
    k.Wf = function (a) {
        this.set(uk, a);
    };
    function xk(a, b) {
        var c = a.getBoundingClientRect(), d = c.left + window.pageXOffset, c = c.top + window.pageYOffset;
        return [
            d,
            c,
            d + b[0],
            c + b[1]
        ];
    }
    k.Qi = function (a) {
        this.set(vk, a);
    };
    function yk(a, b) {
        a.a.visible !== b && (a.c.style.display = b ? '' : 'none', a.a.visible = b);
    }
    function wk(a) {
        var b = a.Ge(), c = a.Kh();
        if (b && b.a && c) {
            var c = b.Ka(c), d = b.Mb(), b = a.c.style, e = a.qh(), f = a.rh(), g = e[0], e = e[1];
            if ('bottom-right' == f || 'center-right' == f || 'top-right' == f)
                '' !== a.a.Ce && (a.a.Ce = b.left = ''), g = Math.round(d[0] - c[0] - g) + 'px', a.a.bf != g && (a.a.bf = b.right = g);
            else {
                '' !== a.a.bf && (a.a.bf = b.right = '');
                if ('bottom-center' == f || 'center-center' == f || 'top-center' == f)
                    g -= a.c.offsetWidth / 2;
                g = Math.round(c[0] + g) + 'px';
                a.a.Ce != g && (a.a.Ce = b.left = g);
            }
            if ('bottom-left' == f || 'bottom-center' == f || 'bottom-right' == f)
                '' !== a.a.kf && (a.a.kf = b.top = ''), c = Math.round(d[1] - c[1] - e) + 'px', a.a.me != c && (a.a.me = b.bottom = c);
            else {
                '' !== a.a.me && (a.a.me = b.bottom = '');
                if ('center-left' == f || 'center-center' == f || 'center-right' == f)
                    e -= a.c.offsetHeight / 2;
                c = Math.round(c[1] + e) + 'px';
                a.a.kf != c && (a.a.kf = b.top = c);
            }
            yk(a, !0);
        } else
            yk(a, !1);
    }
    var rk = 'element', sk = 'map', tk = 'offset', uk = 'position', vk = 'positioning';
    function zk(a) {
        a = a ? a : {};
        this.l = void 0 !== a.collapsed ? a.collapsed : !0;
        this.j = void 0 !== a.collapsible ? a.collapsible : !0;
        this.j || (this.l = !1);
        var b = void 0 !== a.className ? a.className : 'ol-overviewmap', c = void 0 !== a.tipLabel ? a.tipLabel : 'Overview map', d = void 0 !== a.collapseLabel ? a.collapseLabel : '\xAB';
        'string' === typeof d ? (this.o = document.createElement('span'), this.o.textContent = d) : this.o = d;
        d = void 0 !== a.label ? a.label : '\xBB';
        'string' === typeof d ? (this.u = document.createElement('span'), this.u.textContent = d) : this.u = d;
        var e = this.j && !this.l ? this.o : this.u, d = document.createElement('button');
        d.setAttribute('type', 'button');
        d.title = c;
        d.appendChild(e);
        B(d, 'click', this.Em, this);
        this.C = document.createElement('DIV');
        this.C.className = 'ol-overviewmap-map';
        var f = this.c = new G({
            controls: new D(),
            interactions: new D(),
            view: a.view
        });
        a.layers && a.layers.forEach(function (a) {
            f.Sg(a);
        }, this);
        c = document.createElement('DIV');
        c.className = 'ol-overviewmap-box';
        c.style.boxSizing = 'border-box';
        this.A = new qk({
            position: [
                0,
                0
            ],
            positioning: 'bottom-left',
            element: c
        });
        this.c.Tg(this.A);
        c = document.createElement('div');
        c.className = b + ' ol-unselectable ol-control' + (this.l && this.j ? ' ol-collapsed' : '') + (this.j ? '' : ' ol-uncollapsible');
        c.appendChild(this.C);
        c.appendChild(d);
        ad.call(this, {
            element: c,
            render: a.render ? a.render : Ak,
            target: a.target
        });
    }
    u(zk, ad);
    k = zk.prototype;
    k.setMap = function (a) {
        var b = this.a;
        a !== b && (b && ((b = b.$()) && xc(b, Ic('rotation'), this.Ae, this), this.c.Fe(null)), ad.prototype.setMap.call(this, a), a && (this.c.Fe(this.C), this.v.push(B(a, 'propertychange', this.ql, this)), this.c.Jh().ec() || this.c.Li(a.Jc()), a = a.$())) && (B(a, Ic('rotation'), this.Ae, this), Yf(a) && (this.c.xd(), Bk(this)));
    };
    k.ql = function (a) {
        'view' === a.key && ((a = a.oldValue) && xc(a, Ic('rotation'), this.Ae, this), a = this.a.$(), B(a, Ic('rotation'), this.Ae, this));
    };
    k.Ae = function () {
        this.c.$().He(this.a.$().Va());
    };
    function Ak() {
        var a = this.a, b = this.c;
        if (a.a && b.a) {
            var c = a.Mb(), a = a.$().ed(c), d = b.Mb(), c = b.$().ed(d), e = b.Ka(eb(a)), f = b.Ka(cb(a)), b = Math.abs(e[0] - f[0]), e = Math.abs(e[1] - f[1]), f = d[0], d = d[1];
            b < 0.1 * f || e < 0.1 * d || b > 0.75 * f || e > 0.75 * d ? Bk(this) : Ta(c, a) || (a = this.c, c = this.a.$(), a.$().wb(c.Ba()));
        }
        Ck(this);
    }
    function Bk(a) {
        var b = a.a;
        a = a.c;
        var c = b.Mb(), b = b.$().ed(c);
        a = a.$();
        nb(b, 1 / (0.1 * Math.pow(2, Math.log(7.5) / Math.LN2 / 2)));
        a.Ff(b);
    }
    function Ck(a) {
        var b = a.a, c = a.c;
        if (b.a && c.a) {
            var d = b.Mb(), e = b.$(), f = c.$(), c = e.Va(), b = a.A, g = a.A.se(), h = e.ed(d), d = f.Ua(), e = bb(h), f = db(h), l;
            if (a = a.a.$().Ba())
                l = [
                    e[0] - a[0],
                    e[1] - a[1]
                ], Ve(l, c), Qe(l, a);
            b.Wf(l);
            g && (g.style.width = Math.abs((e[0] - f[0]) / d) + 'px', g.style.height = Math.abs((f[1] - e[1]) / d) + 'px');
        }
    }
    k.Em = function (a) {
        a.preventDefault();
        Dk(this);
    };
    function Dk(a) {
        a.element.classList.toggle('ol-collapsed');
        a.l ? Yc(a.o, a.u) : Yc(a.u, a.o);
        a.l = !a.l;
        var b = a.c;
        a.l || b.a || (b.xd(), Bk(a), wc(b, 'postrender', function () {
            Ck(this);
        }, a));
    }
    k.Dm = function () {
        return this.j;
    };
    k.Gm = function (a) {
        this.j !== a && (this.j = a, this.element.classList.toggle('ol-uncollapsible'), !a && this.l && Dk(this));
    };
    k.Fm = function (a) {
        this.j && this.l !== a && Dk(this);
    };
    k.Cm = function () {
        return this.l;
    };
    k.Mk = function () {
        return this.c;
    };
    function Ek(a) {
        a = a ? a : {};
        var b = void 0 !== a.className ? a.className : 'ol-scale-line';
        this.j = document.createElement('DIV');
        this.j.className = b + '-inner';
        this.c = document.createElement('DIV');
        this.c.className = b + ' ol-unselectable';
        this.c.appendChild(this.j);
        this.u = null;
        this.o = void 0 !== a.minWidth ? a.minWidth : 64;
        this.l = !1;
        this.C = void 0;
        this.A = '';
        ad.call(this, {
            element: this.c,
            render: a.render ? a.render : Fk,
            target: a.target
        });
        B(this, Ic(Gk), this.R, this);
        this.G(a.units || 'metric');
    }
    u(Ek, ad);
    var Hk = [
        1,
        2,
        5
    ];
    Ek.prototype.Jb = function () {
        return this.get(Gk);
    };
    function Fk(a) {
        (a = a.frameState) ? this.u = a.viewState : this.u = null;
        Ik(this);
    }
    Ek.prototype.R = function () {
        Ik(this);
    };
    Ek.prototype.G = function (a) {
        this.set(Gk, a);
    };
    function Ik(a) {
        var b = a.u;
        if (b) {
            var c = b.projection, d = c.sc(), b = Eb(c, b.resolution, b.center) * d, d = a.o * b, c = '', e = a.Jb();
            'degrees' == e ? (c = vb.degrees, b /= c, d < c / 60 ? (c = '\u2033', b *= 3600) : d < c ? (c = '\u2032', b *= 60) : c = '\xB0') : 'imperial' == e ? 0.9144 > d ? (c = 'in', b /= 0.0254) : 1609.344 > d ? (c = 'ft', b /= 0.3048) : (c = 'mi', b /= 1609.344) : 'nautical' == e ? (b /= 1852, c = 'nm') : 'metric' == e ? 1 > d ? (c = 'mm', b *= 1000) : 1000 > d ? c = 'm' : (c = 'km', b /= 1000) : 'us' == e ? 0.9144 > d ? (c = 'in', b *= 39.37) : 1609.344 > d ? (c = 'ft', b /= 0.30480061) : (c = 'mi', b /= 1609.3472) : qa(!1, 33);
            for (var e = 3 * Math.floor(Math.log(a.o * b) / Math.log(10)), f;;) {
                f = Hk[(e % 3 + 3) % 3] * Math.pow(10, Math.floor(e / 3));
                d = Math.round(f / b);
                if (isNaN(d)) {
                    a.c.style.display = 'none';
                    a.l = !1;
                    return;
                }
                if (d >= a.o)
                    break;
                ++e;
            }
            b = f + ' ' + c;
            a.A != b && (a.j.innerHTML = b, a.A = b);
            a.C != d && (a.j.style.width = d + 'px', a.C = d);
            a.l || (a.c.style.display = '', a.l = !0);
        } else
            a.l && (a.c.style.display = 'none', a.l = !1);
    }
    var Gk = 'units';
    function Jk(a) {
        a = a ? a : {};
        this.c = void 0;
        this.l = Kk;
        this.A = this.o = 0;
        this.R = null;
        this.ea = !1;
        this.Y = void 0 !== a.duration ? a.duration : 200;
        var b = void 0 !== a.className ? a.className : 'ol-zoomslider', c = document.createElement('button');
        c.setAttribute('type', 'button');
        c.className = b + '-thumb ol-unselectable';
        var d = document.createElement('div');
        d.className = b + ' ol-unselectable ol-control';
        d.appendChild(c);
        this.j = new re(d);
        B(this.j, 'pointerdown', this.el, this);
        B(this.j, 'pointermove', this.cl, this);
        B(this.j, 'pointerup', this.dl, this);
        B(d, 'click', this.bl, this);
        B(c, 'click', Cc);
        ad.call(this, {
            element: d,
            render: a.render ? a.render : Lk
        });
    }
    u(Jk, ad);
    Jk.prototype.ra = function () {
        Ac(this.j);
        ad.prototype.ra.call(this);
    };
    var Kk = 0;
    k = Jk.prototype;
    k.setMap = function (a) {
        ad.prototype.setMap.call(this, a);
        a && a.render();
    };
    function Lk(a) {
        if (a.frameState) {
            if (!this.ea) {
                var b = this.element, c = b.offsetWidth, d = b.offsetHeight, e = b.firstElementChild, f = getComputedStyle(e), b = e.offsetWidth + parseFloat(f.marginRight) + parseFloat(f.marginLeft), e = e.offsetHeight + parseFloat(f.marginTop) + parseFloat(f.marginBottom);
                this.R = [
                    b,
                    e
                ];
                c > d ? (this.l = 1, this.A = c - b) : (this.l = Kk, this.o = d - e);
                this.ea = !0;
            }
            a = a.frameState.viewState.resolution;
            a !== this.c && (this.c = a, Mk(this, a));
        }
    }
    k.bl = function (a) {
        var b = this.a.$();
        a = Nk(this, wa(1 === this.l ? (a.offsetX - this.R[0] / 2) / this.A : (a.offsetY - this.R[1] / 2) / this.o, 0, 1));
        b.animate({
            resolution: b.constrainResolution(a),
            duration: this.Y,
            easing: fd
        });
    };
    k.el = function (a) {
        this.u || a.b.target !== this.element.firstElementChild || (Rf(this.a.$(), 1, 1), this.C = a.clientX, this.G = a.clientY, this.u = !0);
    };
    k.cl = function (a) {
        if (this.u) {
            var b = this.element.firstElementChild;
            this.c = Nk(this, wa(1 === this.l ? (a.clientX - this.C + parseInt(b.style.left, 10)) / this.A : (a.clientY - this.G + parseInt(b.style.top, 10)) / this.o, 0, 1));
            this.a.$().Xc(this.c);
            Mk(this, this.c);
            this.C = a.clientX;
            this.G = a.clientY;
        }
    };
    k.dl = function () {
        if (this.u) {
            var a = this.a.$();
            Rf(a, 1, -1);
            a.animate({
                resolution: a.constrainResolution(this.c),
                duration: this.Y,
                easing: fd
            });
            this.u = !1;
            this.G = this.C = void 0;
        }
    };
    function Mk(a, b) {
        var c;
        c = 1 - Xf(a.a.$())(b);
        var d = a.element.firstElementChild;
        1 == a.l ? d.style.left = a.A * c + 'px' : d.style.top = a.o * c + 'px';
    }
    function Nk(a, b) {
        return Wf(a.a.$())(1 - b);
    }
    function Ok(a) {
        a = a ? a : {};
        this.c = a.extent ? a.extent : null;
        var b = void 0 !== a.className ? a.className : 'ol-zoom-extent', c = void 0 !== a.label ? a.label : 'E', d = void 0 !== a.tipLabel ? a.tipLabel : 'Fit to extent', e = document.createElement('button');
        e.setAttribute('type', 'button');
        e.title = d;
        e.appendChild('string' === typeof c ? document.createTextNode(c) : c);
        B(e, 'click', this.l, this);
        c = document.createElement('div');
        c.className = b + ' ol-unselectable ol-control';
        c.appendChild(e);
        ad.call(this, {
            element: c,
            target: a.target
        });
    }
    u(Ok, ad);
    Ok.prototype.l = function (a) {
        a.preventDefault();
        a = this.a.$();
        var b = this.c ? this.c : a.o.D();
        a.Ff(b);
    };
    function Pk(a) {
        Gc.call(this);
        a = a ? a : {};
        this.a = null;
        B(this, Ic(Qk), this.cm, this);
        this.Uf(void 0 !== a.tracking ? a.tracking : !1);
    }
    u(Pk, Gc);
    k = Pk.prototype;
    k.ra = function () {
        this.Uf(!1);
        Gc.prototype.ra.call(this);
    };
    k.qo = function (a) {
        if (null !== a.alpha) {
            var b = Ba(a.alpha);
            this.set(Rk, b);
            'boolean' === typeof a.absolute && a.absolute ? this.set(Sk, b) : 'number' === typeof a.webkitCompassHeading && -1 != a.webkitCompassAccuracy && this.set(Sk, Ba(a.webkitCompassHeading));
        }
        null !== a.beta && this.set(Tk, Ba(a.beta));
        null !== a.gamma && this.set(Uk, Ba(a.gamma));
        this.s();
    };
    k.jk = function () {
        return this.get(Rk);
    };
    k.mk = function () {
        return this.get(Tk);
    };
    k.uk = function () {
        return this.get(Uk);
    };
    k.bm = function () {
        return this.get(Sk);
    };
    k.Fh = function () {
        return this.get(Qk);
    };
    k.cm = function () {
        if (Nd) {
            var a = this.Fh();
            a && !this.a ? this.a = B(window, 'deviceorientation', this.qo, this) : a || null === this.a || (rc(this.a), this.a = null);
        }
    };
    k.Uf = function (a) {
        this.set(Qk, a);
    };
    var Rk = 'alpha', Tk = 'beta', Uk = 'gamma', Sk = 'heading', Qk = 'tracking';
    function Vk(a) {
        this.g = a.opacity;
        this.o = a.rotateWithView;
        this.l = a.rotation;
        this.c = a.scale;
        this.v = a.snapToPixel;
    }
    k = Vk.prototype;
    k.Pe = function () {
        return this.g;
    };
    k.Qe = function () {
        return this.o;
    };
    k.Re = function () {
        return this.l;
    };
    k.Se = function () {
        return this.c;
    };
    k.ve = function () {
        return this.v;
    };
    k.rd = function (a) {
        this.g = a;
    };
    k.Te = function (a) {
        this.l = a;
    };
    k.sd = function (a) {
        this.c = a;
    };
    function Wk(a) {
        this.A = this.I = this.i = null;
        this.Wa = void 0 !== a.fill ? a.fill : null;
        this.qa = [
            0,
            0
        ];
        this.b = a.points;
        this.a = void 0 !== a.radius ? a.radius : a.radius1;
        this.f = void 0 !== a.radius2 ? a.radius2 : this.a;
        this.j = void 0 !== a.angle ? a.angle : 0;
        this.Ya = void 0 !== a.stroke ? a.stroke : null;
        this.G = this.ta = this.C = null;
        this.u = a.atlasManager;
        Xk(this, this.u);
        Vk.call(this, {
            opacity: 1,
            rotateWithView: void 0 !== a.rotateWithView ? a.rotateWithView : !1,
            rotation: void 0 !== a.rotation ? a.rotation : 0,
            scale: 1,
            snapToPixel: void 0 !== a.snapToPixel ? a.snapToPixel : !0
        });
    }
    u(Wk, Vk);
    k = Wk.prototype;
    k.clone = function () {
        var a = new Wk({
            fill: this.Ca() ? this.Ca().clone() : void 0,
            points: this.f !== this.a ? this.b / 2 : this.b,
            radius: this.a,
            radius2: this.f,
            angle: this.j,
            snapToPixel: this.v,
            stroke: this.Da() ? this.Da().clone() : void 0,
            rotation: this.l,
            rotateWithView: this.o,
            atlasManager: this.u
        });
        a.rd(this.g);
        a.sd(this.c);
        return a;
    };
    k.Hc = function () {
        return this.C;
    };
    k.ki = function () {
        return this.j;
    };
    k.Ca = function () {
        return this.Wa;
    };
    k.cg = function () {
        return this.A;
    };
    k.Z = function () {
        return this.I;
    };
    k.ue = function () {
        return this.G;
    };
    k.Oe = function () {
        return 2;
    };
    k.Pc = function () {
        return this.qa;
    };
    k.li = function () {
        return this.b;
    };
    k.mi = function () {
        return this.a;
    };
    k.sh = function () {
        return this.f;
    };
    k.jc = function () {
        return this.ta;
    };
    k.Da = function () {
        return this.Ya;
    };
    k.zh = function () {
    };
    k.load = function () {
    };
    k.Yi = function () {
    };
    function Xk(a, b) {
        var c, d = '', e = '', f = 0, g = null, h, l = 0;
        a.Ya && (h = Vc(a.Ya.a), l = a.Ya.c, void 0 === l && (l = 1), g = a.Ya.f, Ld || (g = null), e = a.Ya.l, void 0 === e && (e = 'round'), d = a.Ya.i, void 0 === d && (d = 'round'), f = a.Ya.j, void 0 === f && (f = 10));
        var m = 2 * (a.a + l) + 1, d = {
                strokeStyle: h,
                Vi: l,
                size: m,
                lineCap: d,
                lineDash: g,
                lineJoin: e,
                miterLimit: f
            };
        void 0 === b ? (e = Xc(m, m), a.I = e.canvas, c = m = a.I.width, a.ah(d, e, 0, 0), a.Wa ? a.A = a.I : (e = Xc(d.size, d.size), a.A = e.canvas, a.$g(d, e, 0, 0))) : (m = Math.round(m), (e = !a.Wa) && (c = a.$g.bind(a, d)), a.Ya ? (f = a.Ya, void 0 === f.b && (f.b = 's', f.b = f.a ? 'string' === typeof f.a ? f.b + f.a : f.b + w(f.a).toString() : f.b + '-', f.b += ',' + (void 0 !== f.i ? f.i.toString() : '-') + ',' + (f.f ? f.f.toString() : '-') + ',' + (void 0 !== f.g ? f.g : '-') + ',' + (void 0 !== f.l ? f.l : '-') + ',' + (void 0 !== f.j ? f.j.toString() : '-') + ',' + (void 0 !== f.c ? f.c.toString() : '-')), f = f.b) : f = '-', a.Wa ? (g = a.Wa, void 0 === g.a && (g.a = g.b instanceof CanvasPattern || g.b instanceof CanvasGradient ? w(g.b).toString() : 'f' + (g.b ? Sc(g.b) : '-')), g = g.a) : g = '-', a.i && f == a.i[1] && g == a.i[2] && a.a == a.i[3] && a.f == a.i[4] && a.j == a.i[5] && a.b == a.i[6] || (a.i = [
            'r' + f + g + (void 0 !== a.a ? a.a.toString() : '-') + (void 0 !== a.f ? a.f.toString() : '-') + (void 0 !== a.j ? a.j.toString() : '-') + (void 0 !== a.b ? a.b.toString() : '-'),
            f,
            g,
            a.a,
            a.f,
            a.j,
            a.b
        ]), d = b.add(a.i[0], m, m, a.ah.bind(a, d), c), a.I = d.image, a.qa = [
            d.offsetX,
            d.offsetY
        ], c = d.image.width, a.A = e ? d.Fl : a.I);
        a.C = [
            m / 2,
            m / 2
        ];
        a.ta = [
            m,
            m
        ];
        a.G = [
            c,
            c
        ];
    }
    k.ah = function (a, b, c, d) {
        var e;
        b.setTransform(1, 0, 0, 1, 0, 0);
        b.translate(c, d);
        b.beginPath();
        if (Infinity === this.b)
            b.arc(a.size / 2, a.size / 2, this.a, 0, 2 * Math.PI, !0);
        else
            for (this.f !== this.a && (this.b *= 2), c = 0; c <= this.b; c++)
                d = 2 * c * Math.PI / this.b - Math.PI / 2 + this.j, e = c % 2 ? this.f : this.a, b.lineTo(a.size / 2 + e * Math.cos(d), a.size / 2 + e * Math.sin(d));
        this.Wa && (b.fillStyle = Vc(this.Wa.b), b.fill());
        this.Ya && (b.strokeStyle = a.strokeStyle, b.lineWidth = a.Vi, a.lineDash && b.setLineDash(a.lineDash), b.lineCap = a.lineCap, b.lineJoin = a.lineJoin, b.miterLimit = a.miterLimit, b.stroke());
        b.closePath();
    };
    k.$g = function (a, b, c, d) {
        b.setTransform(1, 0, 0, 1, 0, 0);
        b.translate(c, d);
        b.beginPath();
        if (Infinity === this.b)
            b.arc(a.size / 2, a.size / 2, this.a, 0, 2 * Math.PI, !0);
        else {
            this.f !== this.a && (this.b *= 2);
            var e;
            for (c = 0; c <= this.b; c++)
                e = 2 * c * Math.PI / this.b - Math.PI / 2 + this.j, d = c % 2 ? this.f : this.a, b.lineTo(a.size / 2 + d * Math.cos(e), a.size / 2 + d * Math.sin(e));
        }
        b.fillStyle = Nh;
        b.fill();
        this.Ya && (b.strokeStyle = a.strokeStyle, b.lineWidth = a.Vi, a.lineDash && b.setLineDash(a.lineDash), b.stroke());
        b.closePath();
    };
    function Yk(a) {
        a = a || {};
        Wk.call(this, {
            points: Infinity,
            fill: a.fill,
            radius: a.radius,
            snapToPixel: a.snapToPixel,
            stroke: a.stroke,
            atlasManager: a.atlasManager
        });
    }
    u(Yk, Wk);
    Yk.prototype.clone = function () {
        var a = new Yk({
            fill: this.Ca() ? this.Ca().clone() : void 0,
            stroke: this.Da() ? this.Da().clone() : void 0,
            radius: this.a,
            snapToPixel: this.v,
            atlasManager: this.u
        });
        a.rd(this.g);
        a.sd(this.c);
        return a;
    };
    Yk.prototype.Wc = function (a) {
        this.a = a;
        Xk(this, this.u);
    };
    function Zk(a) {
        a = a || {};
        this.b = void 0 !== a.color ? a.color : null;
        this.a = void 0;
    }
    Zk.prototype.clone = function () {
        var a = this.b;
        return new Zk({ color: a && a.slice ? a.slice() : a || void 0 });
    };
    Zk.prototype.f = function () {
        return this.b;
    };
    Zk.prototype.c = function (a) {
        this.b = a;
        this.a = void 0;
    };
    function $k(a) {
        a = a || {};
        this.Gc = null;
        this.Ra = al;
        void 0 !== a.geometry && this.Sa(a.geometry);
        this.Wa = void 0 !== a.fill ? a.fill : null;
        this.M = void 0 !== a.image ? a.image : null;
        this.Ya = void 0 !== a.stroke ? a.stroke : null;
        this.Fa = void 0 !== a.text ? a.text : null;
        this.kj = a.zIndex;
    }
    k = $k.prototype;
    k.clone = function () {
        var a = this.U();
        a && a.clone && (a = a.clone());
        return new $k({
            geometry: a,
            fill: this.Ca() ? this.Ca().clone() : void 0,
            image: this.Z() ? this.Z().clone() : void 0,
            stroke: this.Da() ? this.Da().clone() : void 0,
            text: this.Pa() ? this.Pa().clone() : void 0,
            zIndex: this.za()
        });
    };
    k.U = function () {
        return this.Gc;
    };
    k.vk = function () {
        return this.Ra;
    };
    k.Ca = function () {
        return this.Wa;
    };
    k.cf = function (a) {
        this.Wa = a;
    };
    k.Z = function () {
        return this.M;
    };
    k.zg = function (a) {
        this.M = a;
    };
    k.Da = function () {
        return this.Ya;
    };
    k.df = function (a) {
        this.Ya = a;
    };
    k.Pa = function () {
        return this.Fa;
    };
    k.ef = function (a) {
        this.Fa = a;
    };
    k.za = function () {
        return this.kj;
    };
    k.Sa = function (a) {
        'function' === typeof a ? this.Ra = a : 'string' === typeof a ? this.Ra = function (b) {
            return b.get(a);
        } : a ? a && (this.Ra = function () {
            return a;
        }) : this.Ra = al;
        this.Gc = a;
    };
    k.Wb = function (a) {
        this.kj = a;
    };
    function bl(a) {
        if ('function' !== typeof a) {
            var b;
            Array.isArray(a) ? b = a : (qa(a instanceof $k, 41), b = [a]);
            a = function () {
                return b;
            };
        }
        return a;
    }
    var cl = null;
    function dl() {
        if (!cl) {
            var a = new Zk({ color: 'rgba(255,255,255,0.4)' }), b = new rj({
                    color: '#3399CC',
                    width: 1.25
                });
            cl = [new $k({
                    image: new Yk({
                        fill: a,
                        stroke: b,
                        radius: 5
                    }),
                    fill: a,
                    stroke: b
                })];
        }
        return cl;
    }
    function el() {
        var a = {}, b = [
                255,
                255,
                255,
                1
            ], c = [
                0,
                153,
                255,
                1
            ];
        a.Polygon = [new $k({
                fill: new Zk({
                    color: [
                        255,
                        255,
                        255,
                        0.5
                    ]
                })
            })];
        a.MultiPolygon = a.Polygon;
        a.LineString = [
            new $k({
                stroke: new rj({
                    color: b,
                    width: 5
                })
            }),
            new $k({
                stroke: new rj({
                    color: c,
                    width: 3
                })
            })
        ];
        a.MultiLineString = a.LineString;
        a.Circle = a.Polygon.concat(a.LineString);
        a.Point = [new $k({
                image: new Yk({
                    radius: 6,
                    fill: new Zk({ color: c }),
                    stroke: new rj({
                        color: b,
                        width: 1.5
                    })
                }),
                zIndex: Infinity
            })];
        a.MultiPoint = a.Point;
        a.GeometryCollection = a.Polygon.concat(a.LineString, a.Point);
        return a;
    }
    function al(a) {
        return a.U();
    }
    function H(a) {
        Gc.call(this);
        this.a = void 0;
        this.c = 'geometry';
        this.g = null;
        this.l = void 0;
        this.i = null;
        B(this, Ic(this.c), this.ye, this);
        void 0 !== a && (a instanceof cf || !a ? this.Sa(a) : this.H(a));
    }
    u(H, Gc);
    k = H.prototype;
    k.clone = function () {
        var a = new H(this.N());
        a.Vc(this.c);
        var b = this.U();
        b && a.Sa(b.clone());
        (b = this.g) && a.Vf(b);
        return a;
    };
    k.U = function () {
        return this.get(this.c);
    };
    k.dm = function () {
        return this.a;
    };
    k.wk = function () {
        return this.c;
    };
    k.em = function () {
        return this.g;
    };
    k.Nc = function () {
        return this.l;
    };
    k.gl = function () {
        this.s();
    };
    k.ye = function () {
        this.i && (rc(this.i), this.i = null);
        var a = this.U();
        a && (this.i = B(a, 'change', this.gl, this));
        this.s();
    };
    k.Sa = function (a) {
        this.set(this.c, a);
    };
    k.Vf = function (a) {
        this.l = (this.g = a) ? fl(a) : void 0;
        this.s();
    };
    k.kc = function (a) {
        this.a = a;
        this.s();
    };
    k.Vc = function (a) {
        xc(this, Ic(this.c), this.ye, this);
        this.c = a;
        B(this, Ic(this.c), this.ye, this);
        this.ye();
    };
    function fl(a) {
        var b;
        if ('function' === typeof a)
            2 == a.length ? b = function (b) {
                return a(this, b);
            } : b = a;
        else {
            var c;
            Array.isArray(a) ? c = a : (qa(a instanceof $k, 41), c = [a]);
            b = function () {
                return c;
            };
        }
        return b;
    }
    var gl = document.implementation.createDocument('', '', null);
    function il(a, b) {
        return gl.createElementNS(a, b);
    }
    function jl(a, b) {
        return kl(a, b, []).join('');
    }
    function kl(a, b, c) {
        if (a.nodeType == Node.CDATA_SECTION_NODE || a.nodeType == Node.TEXT_NODE)
            b ? c.push(String(a.nodeValue).replace(/(\r\n|\r|\n)/g, '')) : c.push(a.nodeValue);
        else
            for (a = a.firstChild; a; a = a.nextSibling)
                kl(a, b, c);
        return c;
    }
    function ll(a) {
        return a instanceof Document;
    }
    function ml(a) {
        return a instanceof Node;
    }
    function nl(a) {
        return new DOMParser().parseFromString(a, 'application/xml');
    }
    function pl(a, b) {
        return function (c, d) {
            var e = a.call(b, c, d);
            void 0 !== e && ga(d[d.length - 1], e);
        };
    }
    function ql(a, b) {
        return function (c, d) {
            var e = a.call(void 0 !== b ? b : this, c, d);
            void 0 !== e && d[d.length - 1].push(e);
        };
    }
    function rl(a, b) {
        return function (c, d) {
            var e = a.call(void 0 !== b ? b : this, c, d);
            void 0 !== e && (d[d.length - 1] = e);
        };
    }
    function sl(a) {
        return function (b, c) {
            var d = a.call(this, b, c);
            if (void 0 !== d) {
                var e = c[c.length - 1], f = b.localName, g;
                f in e ? g = e[f] : g = e[f] = [];
                g.push(d);
            }
        };
    }
    function I(a, b) {
        return function (c, d) {
            var e = a.call(this, c, d);
            void 0 !== e && (d[d.length - 1][void 0 !== b ? b : c.localName] = e);
        };
    }
    function J(a, b) {
        return function (c, d, e) {
            a.call(void 0 !== b ? b : this, c, d, e);
            e[e.length - 1].node.appendChild(c);
        };
    }
    function tl(a) {
        var b, c;
        return function (d, e, f) {
            if (!b) {
                b = {};
                var g = {};
                g[d.localName] = a;
                b[d.namespaceURI] = g;
                c = ul(d.localName);
            }
            vl(b, c, e, f);
        };
    }
    function ul(a, b) {
        return function (c, d, e) {
            c = d[d.length - 1].node;
            d = a;
            void 0 === d && (d = e);
            e = b;
            void 0 === b && (e = c.namespaceURI);
            return il(e, d);
        };
    }
    var wl = ul();
    function xl(a, b) {
        for (var c = b.length, d = Array(c), e = 0; e < c; ++e)
            d[e] = a[b[e]];
        return d;
    }
    function K(a, b, c) {
        c = void 0 !== c ? c : {};
        var d, e;
        d = 0;
        for (e = a.length; d < e; ++d)
            c[a[d]] = b;
        return c;
    }
    function yl(a, b, c, d) {
        for (b = b.firstElementChild; b; b = b.nextElementSibling) {
            var e = a[b.namespaceURI];
            void 0 !== e && (e = e[b.localName]) && e.call(d, b, c);
        }
    }
    function L(a, b, c, d, e) {
        d.push(a);
        yl(b, c, d, e);
        return d.pop();
    }
    function vl(a, b, c, d, e, f) {
        for (var g = (void 0 !== e ? e : c).length, h, l, m = 0; m < g; ++m)
            h = c[m], void 0 !== h && (l = b.call(f, h, d, void 0 !== e ? e[m] : void 0), void 0 !== l && a[l.namespaceURI][l.localName].call(f, l, h, d));
    }
    function zl(a, b, c, d, e, f, g) {
        e.push(a);
        vl(b, c, d, e, f, g);
        e.pop();
    }
    function Al(a, b, c, d) {
        return function (e, f, g) {
            var h = new XMLHttpRequest();
            h.open('GET', 'function' === typeof a ? a(e, f, g) : a, !0);
            'arraybuffer' == b.T() && (h.responseType = 'arraybuffer');
            h.onload = function () {
                if (!h.status || 200 <= h.status && 300 > h.status) {
                    var a = b.T(), e;
                    'json' == a || 'text' == a ? e = h.responseText : 'xml' == a ? (e = h.responseXML) || (e = nl(h.responseText)) : 'arraybuffer' == a && (e = h.response);
                    e ? c.call(this, b.Qa(e, { featureProjection: g }), b.kb(e)) : d.call(this);
                } else
                    d.call(this);
            }.bind(this);
            h.send();
        };
    }
    function Bl(a, b) {
        return Al(a, b, function (a) {
            this.dd(a);
        }, na);
    }
    function Cl() {
        this.g = this.defaultDataProjection = null;
    }
    function Dl(a, b, c) {
        var d;
        c && (d = {
            dataProjection: c.dataProjection ? c.dataProjection : a.kb(b),
            featureProjection: c.featureProjection
        });
        return El(a, d);
    }
    function El(a, b) {
        return pb({
            dataProjection: a.defaultDataProjection,
            featureProjection: a.g
        }, b);
    }
    function Fl(a, b, c) {
        var d = c ? Gb(c.featureProjection) : null, e = c ? Gb(c.dataProjection) : null, f;
        d && e && !Tb(d, e) ? a instanceof cf ? f = (b ? a.clone() : a).tb(b ? d : e, b ? e : d) : f = Xb(b ? a.slice() : a, b ? d : e, b ? e : d) : f = a;
        if (b && c && c.decimals) {
            var g = Math.pow(10, c.decimals);
            a = function (a) {
                for (var b = 0, c = a.length; b < c; ++b)
                    a[b] = Math.round(a[b] * g) / g;
                return a;
            };
            Array.isArray(f) ? a(f) : f.Dc(a);
        }
        return f;
    }
    function Gl() {
        Cl.call(this);
    }
    u(Gl, Cl);
    function Hl(a) {
        return 'string' === typeof a ? (a = JSON.parse(a)) ? a : null : null !== a ? a : null;
    }
    k = Gl.prototype;
    k.T = function () {
        return 'json';
    };
    k.Ub = function (a, b) {
        return this.Sc(Hl(a), Dl(this, a, b));
    };
    k.Qa = function (a, b) {
        return this.kg(Hl(a), Dl(this, a, b));
    };
    k.Tc = function (a, b) {
        return this.og(Hl(a), Dl(this, a, b));
    };
    k.kb = function (a) {
        return this.rg(Hl(a));
    };
    k.yd = function (a, b) {
        return JSON.stringify(this.ad(a, b));
    };
    k.Xb = function (a, b) {
        return JSON.stringify(this.ce(a, b));
    };
    k.bd = function (a, b) {
        return JSON.stringify(this.ee(a, b));
    };
    function Il(a, b, c, d, e, f) {
        var g = NaN, h = NaN, l = (c - b) / d;
        if (1 === l)
            g = a[b], h = a[b + 1];
        else if (2 == l)
            g = (1 - e) * a[b] + e * a[b + d], h = (1 - e) * a[b + 1] + e * a[b + d + 1];
        else if (l) {
            var h = a[b], l = a[b + 1], m = 0, g = [0], p;
            for (p = b + d; p < c; p += d) {
                var n = a[p], q = a[p + 1], m = m + Math.sqrt((n - h) * (n - h) + (q - l) * (q - l));
                g.push(m);
                h = n;
                l = q;
            }
            c = e * m;
            l = 0;
            m = g.length;
            for (p = !1; l < m;)
                e = l + (m - l >> 1), h = +da(g[e], c), 0 > h ? l = e + 1 : (m = e, p = !h);
            e = p ? l : ~l;
            0 > e ? (c = (c - g[-e - 2]) / (g[-e - 1] - g[-e - 2]), b += (-e - 2) * d, g = Da(a[b], a[b + d], c), h = Da(a[b + 1], a[b + d + 1], c)) : (g = a[b + e * d], h = a[b + e * d + 1]);
        }
        return f ? (f[0] = g, f[1] = h, f) : [
            g,
            h
        ];
    }
    function Jl(a, b, c, d, e, f) {
        if (c == b)
            return null;
        if (e < a[b + d - 1])
            return f ? (c = a.slice(b, b + d), c[d - 1] = e, c) : null;
        if (a[c - 1] < e)
            return f ? (c = a.slice(c - d, c), c[d - 1] = e, c) : null;
        if (e == a[b + d - 1])
            return a.slice(b, b + d);
        b /= d;
        for (c /= d; b < c;)
            f = b + c >> 1, e < a[(f + 1) * d - 1] ? c = f : b = f + 1;
        c = a[b * d - 1];
        if (e == c)
            return a.slice((b - 1) * d, (b - 1) * d + d);
        f = (e - c) / (a[(b + 1) * d - 1] - c);
        c = [];
        var g;
        for (g = 0; g < d - 1; ++g)
            c.push(Da(a[(b - 1) * d + g], a[b * d + g], f));
        c.push(e);
        return c;
    }
    function Kl(a, b, c, d, e, f) {
        var g = 0;
        if (f)
            return Jl(a, g, b[b.length - 1], c, d, e);
        if (d < a[c - 1])
            return e ? (a = a.slice(0, c), a[c - 1] = d, a) : null;
        if (a[a.length - 1] < d)
            return e ? (a = a.slice(a.length - c), a[c - 1] = d, a) : null;
        e = 0;
        for (f = b.length; e < f; ++e) {
            var h = b[e];
            if (g != h) {
                if (d < a[g + c - 1])
                    break;
                else if (d <= a[h - 1])
                    return Jl(a, g, h, c, d, !1);
                g = h;
            }
        }
        return null;
    }
    function M(a, b) {
        ff.call(this);
        this.c = null;
        this.u = this.A = this.l = -1;
        this.pa(a, b);
    }
    u(M, ff);
    k = M.prototype;
    k.Tj = function (a) {
        this.B ? ga(this.B, a) : this.B = a.slice();
        this.s();
    };
    k.clone = function () {
        var a = new M(null);
        a.ca(this.ka, this.B.slice());
        return a;
    };
    k.Gb = function (a, b, c, d) {
        if (d < Oa(this.D(), a, b))
            return d;
        this.u != this.f && (this.A = Math.sqrt(nf(this.B, 0, this.B.length, this.a, 0)), this.u = this.f);
        return pf(this.B, 0, this.B.length, this.a, this.A, !1, a, b, c, d);
    };
    k.gk = function (a, b) {
        return Ef(this.B, 0, this.B.length, this.a, a, b);
    };
    k.Im = function (a, b) {
        return 'XYM' != this.ka && 'XYZM' != this.ka ? null : Jl(this.B, 0, this.B.length, this.a, a, void 0 !== b ? b : !1);
    };
    k.X = function () {
        return uf(this.B, 0, this.B.length, this.a);
    };
    k.hh = function (a, b) {
        return Il(this.B, 0, this.B.length, this.a, a, b);
    };
    k.Jm = function () {
        var a = this.B, b = this.a, c = a[0], d = a[1], e = 0, f;
        for (f = 0 + b; f < this.B.length; f += b)
            var g = a[f], h = a[f + 1], e = e + Math.sqrt((g - c) * (g - c) + (h - d) * (h - d)), c = g, d = h;
        return e;
    };
    function Zh(a) {
        a.l != a.f && (a.c = a.hh(0.5, a.c), a.l = a.f);
        return a.c;
    }
    k.kd = function (a) {
        var b = [];
        b.length = wf(this.B, 0, this.B.length, this.a, a, b, 0);
        a = new M(null);
        a.ca('XY', b);
        return a;
    };
    k.T = function () {
        return 'LineString';
    };
    k.Xa = function (a) {
        return Ff(this.B, 0, this.B.length, this.a, a);
    };
    k.pa = function (a, b) {
        a ? (jf(this, b, a, 1), this.B || (this.B = []), this.B.length = sf(this.B, 0, a, this.a), this.s()) : this.ca('XY', null);
    };
    k.ca = function (a, b) {
        hf(this, a, b);
        this.s();
    };
    function N(a, b) {
        ff.call(this);
        this.c = [];
        this.l = this.u = -1;
        this.pa(a, b);
    }
    u(N, ff);
    k = N.prototype;
    k.Uj = function (a) {
        this.B ? ga(this.B, a.ha().slice()) : this.B = a.ha().slice();
        this.c.push(this.B.length);
        this.s();
    };
    k.clone = function () {
        var a = new N(null);
        a.ca(this.ka, this.B.slice(), this.c.slice());
        return a;
    };
    k.Gb = function (a, b, c, d) {
        if (d < Oa(this.D(), a, b))
            return d;
        this.l != this.f && (this.u = Math.sqrt(of(this.B, 0, this.c, this.a, 0)), this.l = this.f);
        return qf(this.B, 0, this.c, this.a, this.u, !1, a, b, c, d);
    };
    k.Lm = function (a, b, c) {
        return 'XYM' != this.ka && 'XYZM' != this.ka || !this.B.length ? null : Kl(this.B, this.c, this.a, a, void 0 !== b ? b : !1, void 0 !== c ? c : !1);
    };
    k.X = function () {
        return vf(this.B, 0, this.c, this.a);
    };
    k.Rb = function () {
        return this.c;
    };
    k.Dk = function (a) {
        if (0 > a || this.c.length <= a)
            return null;
        var b = new M(null);
        b.ca(this.ka, this.B.slice(a ? this.c[a - 1] : 0, this.c[a]));
        return b;
    };
    k.hd = function () {
        var a = this.B, b = this.c, c = this.ka, d = [], e = 0, f, g;
        f = 0;
        for (g = b.length; f < g; ++f) {
            var h = b[f], l = new M(null);
            l.ca(c, a.slice(e, h));
            d.push(l);
            e = h;
        }
        return d;
    };
    function $h(a) {
        var b = [], c = a.B, d = 0, e = a.c;
        a = a.a;
        var f, g;
        f = 0;
        for (g = e.length; f < g; ++f) {
            var h = e[f], d = Il(c, d, h, a, 0.5);
            ga(b, d);
            d = h;
        }
        return b;
    }
    k.kd = function (a) {
        var b = [], c = [], d = this.B, e = this.c, f = this.a, g = 0, h = 0, l, m;
        l = 0;
        for (m = e.length; l < m; ++l) {
            var p = e[l], h = wf(d, g, p, f, a, b, h);
            c.push(h);
            g = p;
        }
        b.length = h;
        a = new N(null);
        a.ca('XY', b, c);
        return a;
    };
    k.T = function () {
        return 'MultiLineString';
    };
    k.Xa = function (a) {
        a: {
            var b = this.B, c = this.c, d = this.a, e = 0, f, g;
            f = 0;
            for (g = c.length; f < g; ++f) {
                if (Ff(b, e, c[f], d, a)) {
                    a = !0;
                    break a;
                }
                e = c[f];
            }
            a = !1;
        }
        return a;
    };
    k.pa = function (a, b) {
        if (a) {
            jf(this, b, a, 2);
            this.B || (this.B = []);
            var c = tf(this.B, 0, a, this.a, this.c);
            this.B.length = c.length ? c[c.length - 1] : 0;
            this.s();
        } else
            this.ca('XY', null, this.c);
    };
    k.ca = function (a, b, c) {
        hf(this, a, b);
        this.c = c;
        this.s();
    };
    function Ll(a, b) {
        var c = a.ka, d = [], e = [], f, g;
        f = 0;
        for (g = b.length; f < g; ++f) {
            var h = b[f];
            f || (c = h.ka);
            ga(d, h.ha());
            e.push(d.length);
        }
        a.ca(c, d, e);
    }
    function O(a, b) {
        ff.call(this);
        this.pa(a, b);
    }
    u(O, ff);
    k = O.prototype;
    k.Wj = function (a) {
        this.B ? ga(this.B, a.ha()) : this.B = a.ha().slice();
        this.s();
    };
    k.clone = function () {
        var a = new O(null);
        a.ca(this.ka, this.B.slice());
        return a;
    };
    k.Gb = function (a, b, c, d) {
        if (d < Oa(this.D(), a, b))
            return d;
        var e = this.B, f = this.a, g, h, l;
        g = 0;
        for (h = e.length; g < h; g += f)
            if (l = Aa(a, b, e[g], e[g + 1]), l < d) {
                d = l;
                for (l = 0; l < f; ++l)
                    c[l] = e[g + l];
                c.length = f;
            }
        return d;
    };
    k.X = function () {
        return uf(this.B, 0, this.B.length, this.a);
    };
    k.Ok = function (a) {
        var b = this.B ? this.B.length / this.a : 0;
        if (0 > a || b <= a)
            return null;
        b = new E(null);
        b.ca(this.ka, this.B.slice(a * this.a, (a + 1) * this.a));
        return b;
    };
    k.Ie = function () {
        var a = this.B, b = this.ka, c = this.a, d = [], e, f;
        e = 0;
        for (f = a.length; e < f; e += c) {
            var g = new E(null);
            g.ca(b, a.slice(e, e + c));
            d.push(g);
        }
        return d;
    };
    k.T = function () {
        return 'MultiPoint';
    };
    k.Xa = function (a) {
        var b = this.B, c = this.a, d, e, f, g;
        d = 0;
        for (e = b.length; d < e; d += c)
            if (f = b[d], g = b[d + 1], Sa(a, f, g))
                return !0;
        return !1;
    };
    k.pa = function (a, b) {
        a ? (jf(this, b, a, 1), this.B || (this.B = []), this.B.length = sf(this.B, 0, a, this.a), this.s()) : this.ca('XY', null);
    };
    k.ca = function (a, b) {
        hf(this, a, b);
        this.s();
    };
    function P(a, b) {
        ff.call(this);
        this.c = [];
        this.u = -1;
        this.A = null;
        this.R = this.C = this.G = -1;
        this.l = null;
        this.pa(a, b);
    }
    u(P, ff);
    k = P.prototype;
    k.Xj = function (a) {
        if (this.B) {
            var b = this.B.length;
            ga(this.B, a.ha());
            a = a.Rb().slice();
            var c, d;
            c = 0;
            for (d = a.length; c < d; ++c)
                a[c] += b;
        } else
            this.B = a.ha().slice(), a = a.Rb().slice(), this.c.push();
        this.c.push(a);
        this.s();
    };
    k.clone = function () {
        for (var a = new P(null), b = this.c.length, c = Array(b), d = 0; d < b; ++d)
            c[d] = this.c[d].slice();
        Ml(a, this.ka, this.B.slice(), c);
        return a;
    };
    k.Gb = function (a, b, c, d) {
        if (d < Oa(this.D(), a, b))
            return d;
        if (this.C != this.f) {
            var e = this.c, f = 0, g = 0, h, l;
            h = 0;
            for (l = e.length; h < l; ++h)
                var m = e[h], g = of(this.B, f, m, this.a, g), f = m[m.length - 1];
            this.G = Math.sqrt(g);
            this.C = this.f;
        }
        e = ai(this);
        f = this.c;
        g = this.a;
        h = this.G;
        l = 0;
        var m = [
                NaN,
                NaN
            ], p, n;
        p = 0;
        for (n = f.length; p < n; ++p) {
            var q = f[p];
            d = qf(e, l, q, g, h, !0, a, b, c, d, m);
            l = q[q.length - 1];
        }
        return d;
    };
    k.Oc = function (a, b) {
        var c;
        a: {
            c = ai(this);
            var d = this.c, e = 0;
            if (d.length) {
                var f, g;
                f = 0;
                for (g = d.length; f < g; ++f) {
                    var h = d[f];
                    if (Cf(c, e, h, this.a, a, b)) {
                        c = !0;
                        break a;
                    }
                    e = h[h.length - 1];
                }
            }
            c = !1;
        }
        return c;
    };
    k.Mm = function () {
        var a = ai(this), b = this.c, c = 0, d = 0, e, f;
        e = 0;
        for (f = b.length; e < f; ++e)
            var g = b[e], d = d + lf(a, c, g, this.a), c = g[g.length - 1];
        return d;
    };
    k.X = function (a) {
        var b;
        void 0 !== a ? (b = ai(this).slice(), Kf(b, this.c, this.a, a)) : b = this.B;
        a = b;
        b = this.c;
        var c = this.a, d = 0, e = [], f = 0, g, h;
        g = 0;
        for (h = b.length; g < h; ++g) {
            var l = b[g];
            e[f++] = vf(a, d, l, c, e[f]);
            d = l[l.length - 1];
        }
        e.length = f;
        return e;
    };
    function bi(a) {
        if (a.u != a.f) {
            var b = a.B, c = a.c, d = a.a, e = 0, f = [], g, h;
            g = 0;
            for (h = c.length; g < h; ++g) {
                var l = c[g], e = Xa(b, e, l[0], d);
                f.push((e[0] + e[2]) / 2, (e[1] + e[3]) / 2);
                e = l[l.length - 1];
            }
            b = ai(a);
            c = a.c;
            d = a.a;
            g = 0;
            h = [];
            l = 0;
            for (e = c.length; l < e; ++l) {
                var m = c[l];
                h = Df(b, g, m, d, f, 2 * l, h);
                g = m[m.length - 1];
            }
            a.A = h;
            a.u = a.f;
        }
        return a.A;
    }
    k.zk = function () {
        var a = new O(null);
        a.ca('XY', bi(this).slice());
        return a;
    };
    function ai(a) {
        if (a.R != a.f) {
            var b = a.B, c;
            a: {
                c = a.c;
                var d, e;
                d = 0;
                for (e = c.length; d < e; ++d)
                    if (!If(b, c[d], a.a, void 0)) {
                        c = !1;
                        break a;
                    }
                c = !0;
            }
            c ? a.l = b : (a.l = b.slice(), a.l.length = Kf(a.l, a.c, a.a));
            a.R = a.f;
        }
        return a.l;
    }
    k.kd = function (a) {
        var b = [], c = [], d = this.B, e = this.c, f = this.a;
        a = Math.sqrt(a);
        var g = 0, h = 0, l, m;
        l = 0;
        for (m = e.length; l < m; ++l) {
            var p = e[l], n = [], h = xf(d, g, p, f, a, b, h, n);
            c.push(n);
            g = p[p.length - 1];
        }
        b.length = h;
        d = new P(null);
        Ml(d, 'XY', b, c);
        return d;
    };
    k.Pk = function (a) {
        if (0 > a || this.c.length <= a)
            return null;
        var b;
        a ? (b = this.c[a - 1], b = b[b.length - 1]) : b = 0;
        a = this.c[a].slice();
        var c = a[a.length - 1];
        if (b) {
            var d, e;
            d = 0;
            for (e = a.length; d < e; ++d)
                a[d] -= b;
        }
        d = new F(null);
        d.ca(this.ka, this.B.slice(b, c), a);
        return d;
    };
    k.Od = function () {
        var a = this.ka, b = this.B, c = this.c, d = [], e = 0, f, g, h, l;
        f = 0;
        for (g = c.length; f < g; ++f) {
            var m = c[f].slice(), p = m[m.length - 1];
            if (e)
                for (h = 0, l = m.length; h < l; ++h)
                    m[h] -= e;
            h = new F(null);
            h.ca(a, b.slice(e, p), m);
            d.push(h);
            e = p;
        }
        return d;
    };
    k.T = function () {
        return 'MultiPolygon';
    };
    k.Xa = function (a) {
        a: {
            var b = ai(this), c = this.c, d = this.a, e = 0, f, g;
            f = 0;
            for (g = c.length; f < g; ++f) {
                var h = c[f];
                if (Gf(b, e, h, d, a)) {
                    a = !0;
                    break a;
                }
                e = h[h.length - 1];
            }
            a = !1;
        }
        return a;
    };
    k.pa = function (a, b) {
        if (a) {
            jf(this, b, a, 3);
            this.B || (this.B = []);
            var c = this.B, d = this.a, e = this.c, f = 0, e = e ? e : [], g = 0, h, l;
            h = 0;
            for (l = a.length; h < l; ++h)
                f = tf(c, f, a[h], d, e[g]), e[g++] = f, f = f[f.length - 1];
            e.length = g;
            e.length ? (c = e[e.length - 1], this.B.length = c.length ? c[c.length - 1] : 0) : this.B.length = 0;
            this.s();
        } else
            Ml(this, 'XY', null, this.c);
    };
    function Ml(a, b, c, d) {
        hf(a, b, c);
        a.c = d;
        a.s();
    }
    function Nl(a, b) {
        var c = a.ka, d = [], e = [], f, g, h;
        f = 0;
        for (g = b.length; f < g; ++f) {
            var l = b[f];
            f || (c = l.ka);
            var m = d.length;
            h = l.Rb();
            var p, n;
            p = 0;
            for (n = h.length; p < n; ++p)
                h[p] += m;
            ga(d, l.ha());
            e.push(h);
        }
        Ml(a, c, d, e);
    }
    function Ol(a) {
        a = a ? a : {};
        Cl.call(this);
        this.b = a.geometryName;
    }
    u(Ol, Gl);
    function Pl(a, b) {
        if (!a)
            return null;
        var c;
        if ('number' === typeof a.x && 'number' === typeof a.y)
            c = 'Point';
        else if (a.points)
            c = 'MultiPoint';
        else if (a.paths)
            c = 1 === a.paths.length ? 'LineString' : 'MultiLineString';
        else if (a.rings) {
            var d = a.rings, e = Ql(a), f = [], g = [];
            c = [];
            var h, l;
            h = 0;
            for (l = d.length; h < l; ++h)
                f.length = 0, sf(f, 0, d[h], e.length), Hf(f, 0, f.length, e.length) ? g.push([d[h]]) : c.push(d[h]);
            for (; c.length;) {
                d = c.shift();
                e = !1;
                for (h = g.length - 1; 0 <= h; h--)
                    if (Ta(new yf(g[h][0]).D(), new yf(d).D())) {
                        g[h].push(d);
                        e = !0;
                        break;
                    }
                e || g.push([d.reverse()]);
            }
            a = pb({}, a);
            1 === g.length ? (c = 'Polygon', a.rings = g[0]) : (c = 'MultiPolygon', a.rings = g);
        }
        return Fl((0, Rl[c])(a), !1, b);
    }
    function Ql(a) {
        var b = 'XY';
        !0 === a.hasZ && !0 === a.hasM ? b = 'XYZM' : !0 === a.hasZ ? b = 'XYZ' : !0 === a.hasM && (b = 'XYM');
        return b;
    }
    function Sl(a) {
        a = a.ka;
        return {
            hasZ: 'XYZ' === a || 'XYZM' === a,
            hasM: 'XYM' === a || 'XYZM' === a
        };
    }
    var Rl = {
            Point: function (a) {
                return void 0 !== a.m && void 0 !== a.z ? new E([
                    a.x,
                    a.y,
                    a.z,
                    a.m
                ], 'XYZM') : void 0 !== a.z ? new E([
                    a.x,
                    a.y,
                    a.z
                ], 'XYZ') : void 0 !== a.m ? new E([
                    a.x,
                    a.y,
                    a.m
                ], 'XYM') : new E([
                    a.x,
                    a.y
                ]);
            },
            LineString: function (a) {
                return new M(a.paths[0], Ql(a));
            },
            Polygon: function (a) {
                return new F(a.rings, Ql(a));
            },
            MultiPoint: function (a) {
                return new O(a.points, Ql(a));
            },
            MultiLineString: function (a) {
                return new N(a.paths, Ql(a));
            },
            MultiPolygon: function (a) {
                return new P(a.rings, Ql(a));
            }
        }, Tl = {
            Point: function (a) {
                var b = a.X(), c;
                a = a.ka;
                'XYZ' === a ? c = {
                    x: b[0],
                    y: b[1],
                    z: b[2]
                } : 'XYM' === a ? c = {
                    x: b[0],
                    y: b[1],
                    m: b[2]
                } : 'XYZM' === a ? c = {
                    x: b[0],
                    y: b[1],
                    z: b[2],
                    m: b[3]
                } : 'XY' === a ? c = {
                    x: b[0],
                    y: b[1]
                } : qa(!1, 34);
                return c;
            },
            LineString: function (a) {
                var b = Sl(a);
                return {
                    hasZ: b.hasZ,
                    hasM: b.hasM,
                    paths: [a.X()]
                };
            },
            Polygon: function (a) {
                var b = Sl(a);
                return {
                    hasZ: b.hasZ,
                    hasM: b.hasM,
                    rings: a.X(!1)
                };
            },
            MultiPoint: function (a) {
                var b = Sl(a);
                return {
                    hasZ: b.hasZ,
                    hasM: b.hasM,
                    points: a.X()
                };
            },
            MultiLineString: function (a) {
                var b = Sl(a);
                return {
                    hasZ: b.hasZ,
                    hasM: b.hasM,
                    paths: a.X()
                };
            },
            MultiPolygon: function (a) {
                var b = Sl(a);
                a = a.X(!1);
                for (var c = [], d = 0; d < a.length; d++)
                    for (var e = a[d].length - 1; 0 <= e; e--)
                        c.push(a[d][e]);
                return {
                    hasZ: b.hasZ,
                    hasM: b.hasM,
                    rings: c
                };
            }
        };
    k = Ol.prototype;
    k.Sc = function (a, b) {
        var c = Pl(a.geometry, b), d = new H();
        this.b && d.Vc(this.b);
        d.Sa(c);
        b && b.Rf && a.attributes[b.Rf] && d.kc(a.attributes[b.Rf]);
        a.attributes && d.H(a.attributes);
        return d;
    };
    k.kg = function (a, b) {
        var c = b ? b : {};
        if (a.features) {
            var d = [], e = a.features, f, g;
            c.Rf = a.objectIdFieldName;
            f = 0;
            for (g = e.length; f < g; ++f)
                d.push(this.Sc(e[f], c));
            return d;
        }
        return [this.Sc(a, c)];
    };
    k.og = function (a, b) {
        return Pl(a, b);
    };
    k.rg = function (a) {
        return a.spatialReference && a.spatialReference.wkid ? Gb('EPSG:' + a.spatialReference.wkid) : null;
    };
    function Ul(a, b) {
        return (0, Tl[a.T()])(Fl(a, !0, b), b);
    }
    k.ee = function (a, b) {
        return Ul(a, El(this, b));
    };
    k.ad = function (a, b) {
        b = El(this, b);
        var c = {}, d = a.U();
        d && (c.geometry = Ul(d, b));
        d = a.N();
        delete d[a.c];
        c.attributes = sb(d) ? {} : d;
        b && b.featureProjection && (c.spatialReference = { wkid: Gb(b.featureProjection).nb.split(':').pop() });
        return c;
    };
    k.ce = function (a, b) {
        b = El(this, b);
        var c = [], d, e;
        d = 0;
        for (e = a.length; d < e; ++d)
            c.push(this.ad(a[d], b));
        return { features: c };
    };
    function Vl(a) {
        this.Bc = a;
    }
    function Wl(a, b) {
        this.Bc = a;
        this.b = Array.prototype.slice.call(arguments, 1);
        qa(2 <= this.b.length, 57);
    }
    u(Wl, Vl);
    function Xl(a) {
        var b = ['And'].concat(Array.prototype.slice.call(arguments));
        Wl.apply(this, b);
    }
    u(Xl, Wl);
    function Yl(a, b, c) {
        this.Bc = 'BBOX';
        this.geometryName = a;
        this.extent = b;
        this.srsName = c;
    }
    u(Yl, Vl);
    function Zl(a, b) {
        this.Bc = a;
        this.b = b;
    }
    u(Zl, Vl);
    function $l(a, b, c, d) {
        Zl.call(this, a, b);
        this.f = c;
        this.a = d;
    }
    u($l, Zl);
    function am(a, b, c) {
        $l.call(this, 'PropertyIsEqualTo', a, b, c);
    }
    u(am, $l);
    function bm(a, b) {
        $l.call(this, 'PropertyIsGreaterThan', a, b);
    }
    u(bm, $l);
    function cm(a, b) {
        $l.call(this, 'PropertyIsGreaterThanOrEqualTo', a, b);
    }
    u(cm, $l);
    function dm(a, b, c, d) {
        this.Bc = a;
        this.geometryName = b || 'the_geom';
        this.geometry = c;
        this.srsName = d;
    }
    u(dm, Vl);
    function em(a, b, c) {
        dm.call(this, 'Intersects', a, b, c);
    }
    u(em, dm);
    function fm(a, b, c) {
        Zl.call(this, 'PropertyIsBetween', a);
        this.a = b;
        this.f = c;
    }
    u(fm, Zl);
    function gm(a, b, c, d, e, f) {
        Zl.call(this, 'PropertyIsLike', a);
        this.c = b;
        this.g = void 0 !== c ? c : '*';
        this.i = void 0 !== d ? d : '.';
        this.f = void 0 !== e ? e : '!';
        this.a = f;
    }
    u(gm, Zl);
    function hm(a) {
        Zl.call(this, 'PropertyIsNull', a);
    }
    u(hm, Zl);
    function im(a, b) {
        $l.call(this, 'PropertyIsLessThan', a, b);
    }
    u(im, $l);
    function jm(a, b) {
        $l.call(this, 'PropertyIsLessThanOrEqualTo', a, b);
    }
    u(jm, $l);
    function km(a) {
        this.Bc = 'Not';
        this.condition = a;
    }
    u(km, Vl);
    function lm(a, b, c) {
        $l.call(this, 'PropertyIsNotEqualTo', a, b, c);
    }
    u(lm, $l);
    function mm(a) {
        var b = ['Or'].concat(Array.prototype.slice.call(arguments));
        Wl.apply(this, b);
    }
    u(mm, Wl);
    function nm(a, b, c) {
        dm.call(this, 'Within', a, b, c);
    }
    u(nm, dm);
    function om(a) {
        var b = [null].concat(Array.prototype.slice.call(arguments));
        return new (Function.prototype.bind.apply(Xl, b))();
    }
    function pm(a, b, c) {
        return new Yl(a, b, c);
    }
    function qm(a) {
        cf.call(this);
        this.a = a ? a : null;
        rm(this);
    }
    u(qm, cf);
    function sm(a) {
        var b = [], c, d;
        c = 0;
        for (d = a.length; c < d; ++c)
            b.push(a[c].clone());
        return b;
    }
    function tm(a) {
        var b, c;
        if (a.a)
            for (b = 0, c = a.a.length; b < c; ++b)
                xc(a.a[b], 'change', a.s, a);
    }
    function rm(a) {
        var b, c;
        if (a.a)
            for (b = 0, c = a.a.length; b < c; ++b)
                B(a.a[b], 'change', a.s, a);
    }
    k = qm.prototype;
    k.clone = function () {
        var a = new qm(null);
        a.Ji(this.a);
        return a;
    };
    k.Gb = function (a, b, c, d) {
        if (d < Oa(this.D(), a, b))
            return d;
        var e = this.a, f, g;
        f = 0;
        for (g = e.length; f < g; ++f)
            d = e[f].Gb(a, b, c, d);
        return d;
    };
    k.Oc = function (a, b) {
        var c = this.a, d, e;
        d = 0;
        for (e = c.length; d < e; ++d)
            if (c[d].Oc(a, b))
                return !0;
        return !1;
    };
    k.ne = function (a) {
        Va(Infinity, Infinity, -Infinity, -Infinity, a);
        for (var b = this.a, c = 0, d = b.length; c < d; ++c)
            $a(a, b[c].D());
        return a;
    };
    k.If = function () {
        return sm(this.a);
    };
    k.Qd = function (a) {
        this.j != this.f && (qb(this.i), this.g = 0, this.j = this.f);
        if (0 > a || this.g && a < this.g)
            return this;
        var b = a.toString();
        if (this.i.hasOwnProperty(b))
            return this.i[b];
        var c = [], d = this.a, e = !1, f, g;
        f = 0;
        for (g = d.length; f < g; ++f) {
            var h = d[f], l = h.Qd(a);
            c.push(l);
            l !== h && (e = !0);
        }
        if (e)
            return a = new qm(null), tm(a), a.a = c, rm(a), a.s(), this.i[b] = a;
        this.g = a;
        return this;
    };
    k.T = function () {
        return 'GeometryCollection';
    };
    k.Xa = function (a) {
        var b = this.a, c, d;
        c = 0;
        for (d = b.length; c < d; ++c)
            if (b[c].Xa(a))
                return !0;
        return !1;
    };
    k.rotate = function (a, b) {
        for (var c = this.a, d = 0, e = c.length; d < e; ++d)
            c[d].rotate(a, b);
        this.s();
    };
    k.scale = function (a, b, c) {
        c || (c = jb(this.D()));
        for (var d = this.a, e = 0, f = d.length; e < f; ++e)
            d[e].scale(a, b, c);
        this.s();
    };
    k.Ji = function (a) {
        a = sm(a);
        tm(this);
        this.a = a;
        rm(this);
        this.s();
    };
    k.Dc = function (a) {
        var b = this.a, c, d;
        c = 0;
        for (d = b.length; c < d; ++c)
            b[c].Dc(a);
        this.s();
    };
    k.translate = function (a, b) {
        var c = this.a, d, e;
        d = 0;
        for (e = c.length; d < e; ++d)
            c[d].translate(a, b);
        this.s();
    };
    k.ra = function () {
        tm(this);
        cf.prototype.ra.call(this);
    };
    function um(a) {
        a = a ? a : {};
        Cl.call(this);
        this.defaultDataProjection = Gb(a.defaultDataProjection ? a.defaultDataProjection : 'EPSG:4326');
        a.featureProjection && (this.g = Gb(a.featureProjection));
        this.b = a.geometryName;
    }
    u(um, Gl);
    function vm(a, b) {
        return a ? Fl((0, wm[a.type])(a), !1, b) : null;
    }
    function xm(a, b) {
        return (0, ym[a.T()])(Fl(a, !0, b), b);
    }
    var wm = {
            Point: function (a) {
                return new E(a.coordinates);
            },
            LineString: function (a) {
                return new M(a.coordinates);
            },
            Polygon: function (a) {
                return new F(a.coordinates);
            },
            MultiPoint: function (a) {
                return new O(a.coordinates);
            },
            MultiLineString: function (a) {
                return new N(a.coordinates);
            },
            MultiPolygon: function (a) {
                return new P(a.coordinates);
            },
            GeometryCollection: function (a, b) {
                var c = a.geometries.map(function (a) {
                    return vm(a, b);
                });
                return new qm(c);
            }
        }, ym = {
            Point: function (a) {
                return {
                    type: 'Point',
                    coordinates: a.X()
                };
            },
            LineString: function (a) {
                return {
                    type: 'LineString',
                    coordinates: a.X()
                };
            },
            Polygon: function (a, b) {
                var c;
                b && (c = b.rightHanded);
                return {
                    type: 'Polygon',
                    coordinates: a.X(c)
                };
            },
            MultiPoint: function (a) {
                return {
                    type: 'MultiPoint',
                    coordinates: a.X()
                };
            },
            MultiLineString: function (a) {
                return {
                    type: 'MultiLineString',
                    coordinates: a.X()
                };
            },
            MultiPolygon: function (a, b) {
                var c;
                b && (c = b.rightHanded);
                return {
                    type: 'MultiPolygon',
                    coordinates: a.X(c)
                };
            },
            GeometryCollection: function (a, b) {
                return {
                    type: 'GeometryCollection',
                    geometries: a.a.map(function (a) {
                        var c = pb({}, b);
                        delete c.featureProjection;
                        return xm(a, c);
                    })
                };
            },
            Circle: function () {
                return {
                    type: 'GeometryCollection',
                    geometries: []
                };
            }
        };
    k = um.prototype;
    k.Sc = function (a, b) {
        var c;
        c = 'Feature' === a.type ? a : {
            type: 'Feature',
            geometry: a
        };
        var d = vm(c.geometry, b), e = new H();
        this.b && e.Vc(this.b);
        e.Sa(d);
        void 0 !== c.id && e.kc(c.id);
        c.properties && e.H(c.properties);
        return e;
    };
    k.kg = function (a, b) {
        var c;
        if ('FeatureCollection' === a.type) {
            c = [];
            var d = a.features, e, f;
            e = 0;
            for (f = d.length; e < f; ++e)
                c.push(this.Sc(d[e], b));
        } else
            c = [this.Sc(a, b)];
        return c;
    };
    k.og = function (a, b) {
        return vm(a, b);
    };
    k.rg = function (a) {
        a = a.crs;
        var b;
        a ? 'name' == a.type ? b = Gb(a.properties.name) : 'EPSG' == a.type ? b = Gb('EPSG:' + a.properties.code) : qa(!1, 36) : b = this.defaultDataProjection;
        return b;
    };
    k.ad = function (a, b) {
        b = El(this, b);
        var c = { type: 'Feature' }, d = a.a;
        void 0 !== d && (c.id = d);
        (d = a.U()) ? c.geometry = xm(d, b) : c.geometry = null;
        d = a.N();
        delete d[a.c];
        sb(d) ? c.properties = null : c.properties = d;
        return c;
    };
    k.ce = function (a, b) {
        b = El(this, b);
        var c = [], d, e;
        d = 0;
        for (e = a.length; d < e; ++d)
            c.push(this.ad(a[d], b));
        return {
            type: 'FeatureCollection',
            features: c
        };
    };
    k.ee = function (a, b) {
        return xm(a, El(this, b));
    };
    function zm() {
        this.f = new XMLSerializer();
        Cl.call(this);
    }
    u(zm, Cl);
    k = zm.prototype;
    k.T = function () {
        return 'xml';
    };
    k.Ub = function (a, b) {
        if (ll(a))
            return Am(this, a, b);
        if (ml(a))
            return this.jg(a, b);
        if ('string' === typeof a) {
            var c = nl(a);
            return Am(this, c, b);
        }
        return null;
    };
    function Am(a, b, c) {
        a = Bm(a, b, c);
        return 0 < a.length ? a[0] : null;
    }
    k.jg = function () {
        return null;
    };
    k.Qa = function (a, b) {
        if (ll(a))
            return Bm(this, a, b);
        if (ml(a))
            return this.yc(a, b);
        if ('string' === typeof a) {
            var c = nl(a);
            return Bm(this, c, b);
        }
        return [];
    };
    function Bm(a, b, c) {
        var d = [];
        for (b = b.firstChild; b; b = b.nextSibling)
            b.nodeType == Node.ELEMENT_NODE && ga(d, a.yc(b, c));
        return d;
    }
    k.Tc = function (a, b) {
        if (ll(a))
            return null;
        if (ml(a))
            return this.vi(a, b);
        'string' === typeof a && nl(a);
        return null;
    };
    k.vi = function () {
        return null;
    };
    k.kb = function (a) {
        return ll(a) ? this.qg(a) : ml(a) ? this.Ze(a) : 'string' === typeof a ? (a = nl(a), this.qg(a)) : null;
    };
    k.qg = function () {
        return this.defaultDataProjection;
    };
    k.Ze = function () {
        return this.defaultDataProjection;
    };
    k.yd = function (a, b) {
        return this.f.serializeToString(this.Fg(a, b));
    };
    k.Fg = function () {
        return null;
    };
    k.Xb = function (a, b) {
        var c = this.Yb(a, b);
        return this.f.serializeToString(c);
    };
    k.Yb = function () {
        return null;
    };
    k.bd = function (a, b) {
        var c = this.de(a, b);
        return this.f.serializeToString(c);
    };
    k.de = function () {
        return null;
    };
    function Cm(a) {
        a = a ? a : {};
        this.featureType = a.featureType;
        this.featureNS = a.featureNS;
        this.srsName = a.srsName;
        this.schemaLocation = '';
        this.b = {};
        this.b['http://www.opengis.net/gml'] = {
            featureMember: rl(Cm.prototype.Xd),
            featureMembers: rl(Cm.prototype.Xd)
        };
        zm.call(this);
    }
    u(Cm, zm);
    var Dm = /^[\s\xa0]*$/;
    k = Cm.prototype;
    k.Xd = function (a, b) {
        var c = a.localName, d = null;
        if ('FeatureCollection' == c)
            'http://www.opengis.net/wfs' === a.namespaceURI ? d = L([], this.b, a, b, this) : d = L(null, this.b, a, b, this);
        else if ('featureMembers' == c || 'featureMember' == c) {
            var e = b[0], f = e.featureType, g = e.featureNS, h, l;
            if (!f && a.childNodes) {
                f = [];
                g = {};
                h = 0;
                for (l = a.childNodes.length; h < l; ++h) {
                    var m = a.childNodes[h];
                    if (1 === m.nodeType) {
                        var p = m.nodeName.split(':').pop();
                        if (-1 === f.indexOf(p)) {
                            var n = '', q = 0, m = m.namespaceURI, r;
                            for (r in g) {
                                if (g[r] === m) {
                                    n = r;
                                    break;
                                }
                                ++q;
                            }
                            n || (n = 'p' + q, g[n] = m);
                            f.push(n + ':' + p);
                        }
                    }
                }
                'featureMember' != c && (e.featureType = f, e.featureNS = g);
            }
            'string' === typeof g && (h = g, g = {}, g.p0 = h);
            var e = {}, f = Array.isArray(f) ? f : [f], v;
            for (v in g) {
                p = {};
                h = 0;
                for (l = f.length; h < l; ++h)
                    (-1 === f[h].indexOf(':') ? 'p0' : f[h].split(':')[0]) === v && (p[f[h].split(':').pop()] = 'featureMembers' == c ? ql(this.ig, this) : rl(this.ig, this));
                e[g[v]] = p;
            }
            'featureMember' == c ? d = L(void 0, e, a, b) : d = L([], e, a, b);
        }
        null === d && (d = []);
        return d;
    };
    k.We = function (a, b) {
        var c = b[0];
        c.srsName = a.firstElementChild.getAttribute('srsName');
        var d = L(null, this.Jg, a, b, this);
        if (d)
            return Fl(d, !1, c);
    };
    k.ig = function (a, b) {
        var c, d;
        (d = a.getAttribute('fid')) || (d = a.getAttributeNS('http://www.opengis.net/gml', 'id') || '');
        var e = {}, f;
        for (c = a.firstElementChild; c; c = c.nextElementSibling) {
            var g = c.localName;
            if (0 === c.childNodes.length || 1 === c.childNodes.length && (3 === c.firstChild.nodeType || 4 === c.firstChild.nodeType)) {
                var h = jl(c, !1);
                Dm.test(h) && (h = void 0);
                e[g] = h;
            } else
                'boundedBy' !== g && (f = g), e[g] = this.We(c, b);
        }
        c = new H(e);
        f && c.Vc(f);
        d && c.kc(d);
        return c;
    };
    k.Ai = function (a, b) {
        var c = this.Ve(a, b);
        if (c) {
            var d = new E(null);
            d.ca('XYZ', c);
            return d;
        }
    };
    k.yi = function (a, b) {
        var c = L([], this.sj, a, b, this);
        if (c)
            return new O(c);
    };
    k.xi = function (a, b) {
        var c = L([], this.rj, a, b, this);
        if (c) {
            var d = new N(null);
            Ll(d, c);
            return d;
        }
    };
    k.zi = function (a, b) {
        var c = L([], this.tj, a, b, this);
        if (c) {
            var d = new P(null);
            Nl(d, c);
            return d;
        }
    };
    k.ri = function (a, b) {
        yl(this.wj, a, b, this);
    };
    k.yh = function (a, b) {
        yl(this.pj, a, b, this);
    };
    k.si = function (a, b) {
        yl(this.xj, a, b, this);
    };
    k.Xe = function (a, b) {
        var c = this.Ve(a, b);
        if (c) {
            var d = new M(null);
            d.ca('XYZ', c);
            return d;
        }
    };
    k.Lo = function (a, b) {
        var c = L(null, this.fe, a, b, this);
        if (c)
            return c;
    };
    k.wi = function (a, b) {
        var c = this.Ve(a, b);
        if (c) {
            var d = new yf(null);
            zf(d, 'XYZ', c);
            return d;
        }
    };
    k.Ye = function (a, b) {
        var c = L([null], this.qf, a, b, this);
        if (c && c[0]) {
            var d = new F(null), e = c[0], f = [e.length], g, h;
            g = 1;
            for (h = c.length; g < h; ++g)
                ga(e, c[g]), f.push(e.length);
            d.ca('XYZ', e, f);
            return d;
        }
    };
    k.Ve = function (a, b) {
        return L(null, this.fe, a, b, this);
    };
    k.sj = {
        'http://www.opengis.net/gml': {
            pointMember: ql(Cm.prototype.ri),
            pointMembers: ql(Cm.prototype.ri)
        }
    };
    k.rj = {
        'http://www.opengis.net/gml': {
            lineStringMember: ql(Cm.prototype.yh),
            lineStringMembers: ql(Cm.prototype.yh)
        }
    };
    k.tj = {
        'http://www.opengis.net/gml': {
            polygonMember: ql(Cm.prototype.si),
            polygonMembers: ql(Cm.prototype.si)
        }
    };
    k.wj = { 'http://www.opengis.net/gml': { Point: ql(Cm.prototype.Ve) } };
    k.pj = { 'http://www.opengis.net/gml': { LineString: ql(Cm.prototype.Xe) } };
    k.xj = { 'http://www.opengis.net/gml': { Polygon: ql(Cm.prototype.Ye) } };
    k.ge = { 'http://www.opengis.net/gml': { LinearRing: rl(Cm.prototype.Lo) } };
    k.vi = function (a, b) {
        var c = this.We(a, [Dl(this, a, b ? b : {})]);
        return c ? c : null;
    };
    k.yc = function (a, b) {
        var c = {
            featureType: this.featureType,
            featureNS: this.featureNS
        };
        b && pb(c, Dl(this, a, b));
        return this.Xd(a, [c]) || [];
    };
    k.Ze = function (a) {
        return Gb(this.srsName ? this.srsName : a.firstElementChild.getAttribute('srsName'));
    };
    function Em(a) {
        a = jl(a, !1);
        return Fm(a);
    }
    function Fm(a) {
        if (a = /^\s*(true|1)|(false|0)\s*$/.exec(a))
            return void 0 !== a[1] || !1;
    }
    function Gm(a) {
        a = jl(a, !1);
        a = Date.parse(a);
        return isNaN(a) ? void 0 : a / 1000;
    }
    function Hm(a) {
        a = jl(a, !1);
        return Im(a);
    }
    function Im(a) {
        if (a = /^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(a))
            return parseFloat(a[1]);
    }
    function Jm(a) {
        a = jl(a, !1);
        return Km(a);
    }
    function Km(a) {
        if (a = /^\s*(\d+)\s*$/.exec(a))
            return parseInt(a[1], 10);
    }
    function Q(a) {
        return jl(a, !1).trim();
    }
    function Lm(a, b) {
        Mm(a, b ? '1' : '0');
    }
    function Nm(a, b) {
        a.appendChild(gl.createTextNode(b.toPrecision()));
    }
    function Om(a, b) {
        a.appendChild(gl.createTextNode(b.toString()));
    }
    function Mm(a, b) {
        a.appendChild(gl.createTextNode(b));
    }
    function Pm(a) {
        a = a ? a : {};
        Cm.call(this, a);
        this.o = void 0 !== a.surface ? a.surface : !1;
        this.i = void 0 !== a.curve ? a.curve : !1;
        this.l = void 0 !== a.multiCurve ? a.multiCurve : !0;
        this.j = void 0 !== a.multiSurface ? a.multiSurface : !0;
        this.schemaLocation = a.schemaLocation ? a.schemaLocation : 'http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd';
    }
    u(Pm, Cm);
    k = Pm.prototype;
    k.Po = function (a, b) {
        var c = L([], this.qj, a, b, this);
        if (c) {
            var d = new N(null);
            Ll(d, c);
            return d;
        }
    };
    k.Qo = function (a, b) {
        var c = L([], this.uj, a, b, this);
        if (c) {
            var d = new P(null);
            Nl(d, c);
            return d;
        }
    };
    k.Zg = function (a, b) {
        yl(this.mj, a, b, this);
    };
    k.Wi = function (a, b) {
        yl(this.Bj, a, b, this);
    };
    k.To = function (a, b) {
        return L([null], this.vj, a, b, this);
    };
    k.Wo = function (a, b) {
        return L([null], this.Aj, a, b, this);
    };
    k.Uo = function (a, b) {
        return L([null], this.qf, a, b, this);
    };
    k.Oo = function (a, b) {
        return L([null], this.fe, a, b, this);
    };
    k.Jl = function (a, b) {
        var c = L(void 0, this.ge, a, b, this);
        c && b[b.length - 1].push(c);
    };
    k.ck = function (a, b) {
        var c = L(void 0, this.ge, a, b, this);
        c && (b[b.length - 1][0] = c);
    };
    k.Bi = function (a, b) {
        var c = L([null], this.Cj, a, b, this);
        if (c && c[0]) {
            var d = new F(null), e = c[0], f = [e.length], g, h;
            g = 1;
            for (h = c.length; g < h; ++g)
                ga(e, c[g]), f.push(e.length);
            d.ca('XYZ', e, f);
            return d;
        }
    };
    k.ti = function (a, b) {
        var c = L([null], this.nj, a, b, this);
        if (c) {
            var d = new M(null);
            d.ca('XYZ', c);
            return d;
        }
    };
    k.Ko = function (a, b) {
        var c = L([null], this.oj, a, b, this);
        return Va(c[1][0], c[1][1], c[2][0], c[2][1]);
    };
    k.Mo = function (a, b) {
        for (var c = jl(a, !1), d = /^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/, e = [], f; f = d.exec(c);)
            e.push(parseFloat(f[1])), c = c.substr(f[0].length);
        if ('' === c) {
            c = b[0].srsName;
            d = 'enu';
            c && (d = Gb(c).b);
            if ('neu' === d)
                for (c = 0, d = e.length; c < d; c += 3)
                    f = e[c], e[c] = e[c + 1], e[c + 1] = f;
            c = e.length;
            2 == c && e.push(0);
            if (c)
                return e;
        }
    };
    k.ng = function (a, b) {
        var c = jl(a, !1).replace(/^\s*|\s*$/g, ''), d = b[0].srsName, e = a.parentNode.getAttribute('srsDimension'), f = 'enu';
        d && (f = Gb(d).b);
        c = c.split(/\s+/);
        d = 2;
        a.getAttribute('srsDimension') ? d = Km(a.getAttribute('srsDimension')) : a.getAttribute('dimension') ? d = Km(a.getAttribute('dimension')) : e && (d = Km(e));
        for (var g, h, l = [], m = 0, p = c.length; m < p; m += d)
            e = parseFloat(c[m]), g = parseFloat(c[m + 1]), h = 3 === d ? parseFloat(c[m + 2]) : 0, 'en' === f.substr(0, 2) ? l.push(e, g, h) : l.push(g, e, h);
        return l;
    };
    k.fe = {
        'http://www.opengis.net/gml': {
            pos: rl(Pm.prototype.Mo),
            posList: rl(Pm.prototype.ng)
        }
    };
    k.qf = {
        'http://www.opengis.net/gml': {
            interior: Pm.prototype.Jl,
            exterior: Pm.prototype.ck
        }
    };
    k.Jg = {
        'http://www.opengis.net/gml': {
            Point: rl(Cm.prototype.Ai),
            MultiPoint: rl(Cm.prototype.yi),
            LineString: rl(Cm.prototype.Xe),
            MultiLineString: rl(Cm.prototype.xi),
            LinearRing: rl(Cm.prototype.wi),
            Polygon: rl(Cm.prototype.Ye),
            MultiPolygon: rl(Cm.prototype.zi),
            Surface: rl(Pm.prototype.Bi),
            MultiSurface: rl(Pm.prototype.Qo),
            Curve: rl(Pm.prototype.ti),
            MultiCurve: rl(Pm.prototype.Po),
            Envelope: rl(Pm.prototype.Ko)
        }
    };
    k.qj = {
        'http://www.opengis.net/gml': {
            curveMember: ql(Pm.prototype.Zg),
            curveMembers: ql(Pm.prototype.Zg)
        }
    };
    k.uj = {
        'http://www.opengis.net/gml': {
            surfaceMember: ql(Pm.prototype.Wi),
            surfaceMembers: ql(Pm.prototype.Wi)
        }
    };
    k.mj = {
        'http://www.opengis.net/gml': {
            LineString: ql(Cm.prototype.Xe),
            Curve: ql(Pm.prototype.ti)
        }
    };
    k.Bj = {
        'http://www.opengis.net/gml': {
            Polygon: ql(Cm.prototype.Ye),
            Surface: ql(Pm.prototype.Bi)
        }
    };
    k.Cj = { 'http://www.opengis.net/gml': { patches: rl(Pm.prototype.To) } };
    k.nj = { 'http://www.opengis.net/gml': { segments: rl(Pm.prototype.Wo) } };
    k.oj = {
        'http://www.opengis.net/gml': {
            lowerCorner: ql(Pm.prototype.ng),
            upperCorner: ql(Pm.prototype.ng)
        }
    };
    k.vj = { 'http://www.opengis.net/gml': { PolygonPatch: rl(Pm.prototype.Uo) } };
    k.Aj = { 'http://www.opengis.net/gml': { LineStringSegment: rl(Pm.prototype.Oo) } };
    function Qm(a, b, c) {
        c = c[c.length - 1].srsName;
        b = b.X();
        for (var d = b.length, e = Array(d), f, g = 0; g < d; ++g) {
            f = b[g];
            var h = g, l = 'enu';
            c && (l = Gb(c).b);
            e[h] = 'en' === l.substr(0, 2) ? f[0] + ' ' + f[1] : f[1] + ' ' + f[0];
        }
        Mm(a, e.join(' '));
    }
    k.hj = function (a, b, c) {
        var d = c[c.length - 1].srsName;
        d && a.setAttribute('srsName', d);
        d = il(a.namespaceURI, 'pos');
        a.appendChild(d);
        c = c[c.length - 1].srsName;
        a = 'enu';
        c && (a = Gb(c).b);
        b = b.X();
        Mm(d, 'en' === a.substr(0, 2) ? b[0] + ' ' + b[1] : b[1] + ' ' + b[0]);
    };
    var Rm = {
        'http://www.opengis.net/gml': {
            lowerCorner: J(Mm),
            upperCorner: J(Mm)
        }
    };
    k = Pm.prototype;
    k.Jp = function (a, b, c) {
        var d = c[c.length - 1].srsName;
        d && a.setAttribute('srsName', d);
        zl({ node: a }, Rm, wl, [
            b[0] + ' ' + b[1],
            b[2] + ' ' + b[3]
        ], c, [
            'lowerCorner',
            'upperCorner'
        ], this);
    };
    k.ej = function (a, b, c) {
        var d = c[c.length - 1].srsName;
        d && a.setAttribute('srsName', d);
        d = il(a.namespaceURI, 'posList');
        a.appendChild(d);
        Qm(d, b, c);
    };
    k.zj = function (a, b) {
        var c = b[b.length - 1], d = c.node, e = c.exteriorWritten;
        void 0 === e && (c.exteriorWritten = !0);
        return il(d.namespaceURI, void 0 !== e ? 'interior' : 'exterior');
    };
    k.nf = function (a, b, c) {
        var d = c[c.length - 1].srsName;
        'PolygonPatch' !== a.nodeName && d && a.setAttribute('srsName', d);
        'Polygon' === a.nodeName || 'PolygonPatch' === a.nodeName ? (b = b.jd(), zl({
            node: a,
            srsName: d
        }, Sm, this.zj, b, c, void 0, this)) : 'Surface' === a.nodeName && (d = il(a.namespaceURI, 'patches'), a.appendChild(d), a = il(d.namespaceURI, 'PolygonPatch'), d.appendChild(a), this.nf(a, b, c));
    };
    k.mf = function (a, b, c) {
        var d = c[c.length - 1].srsName;
        'LineStringSegment' !== a.nodeName && d && a.setAttribute('srsName', d);
        'LineString' === a.nodeName || 'LineStringSegment' === a.nodeName ? (d = il(a.namespaceURI, 'posList'), a.appendChild(d), Qm(d, b, c)) : 'Curve' === a.nodeName && (d = il(a.namespaceURI, 'segments'), a.appendChild(d), a = il(d.namespaceURI, 'LineStringSegment'), d.appendChild(a), this.mf(a, b, c));
    };
    k.gj = function (a, b, c) {
        var d = c[c.length - 1], e = d.srsName, d = d.surface;
        e && a.setAttribute('srsName', e);
        b = b.Od();
        zl({
            node: a,
            srsName: e,
            surface: d
        }, Tm, this.c, b, c, void 0, this);
    };
    k.Kp = function (a, b, c) {
        var d = c[c.length - 1].srsName;
        d && a.setAttribute('srsName', d);
        b = b.Ie();
        zl({
            node: a,
            srsName: d
        }, Um, ul('pointMember'), b, c, void 0, this);
    };
    k.fj = function (a, b, c) {
        var d = c[c.length - 1], e = d.srsName, d = d.curve;
        e && a.setAttribute('srsName', e);
        b = b.hd();
        zl({
            node: a,
            srsName: e,
            curve: d
        }, Vm, this.c, b, c, void 0, this);
    };
    k.ij = function (a, b, c) {
        var d = il(a.namespaceURI, 'LinearRing');
        a.appendChild(d);
        this.ej(d, b, c);
    };
    k.jj = function (a, b, c) {
        var d = this.a(b, c);
        d && (a.appendChild(d), this.nf(d, b, c));
    };
    k.Lp = function (a, b, c) {
        var d = il(a.namespaceURI, 'Point');
        a.appendChild(d);
        this.hj(d, b, c);
    };
    k.dj = function (a, b, c) {
        var d = this.a(b, c);
        d && (a.appendChild(d), this.mf(d, b, c));
    };
    k.zd = function (a, b, c) {
        var d = c[c.length - 1], e = pb({}, d);
        e.node = a;
        var f;
        Array.isArray(b) ? d.dataProjection ? f = Xb(b, d.featureProjection, d.dataProjection) : f = b : f = Fl(b, !0, d);
        zl(e, Wm, this.a, [f], c, void 0, this);
    };
    k.cj = function (a, b, c) {
        var d = b.a;
        d && a.setAttribute('fid', d);
        var d = c[c.length - 1], e = d.featureNS, f = b.c;
        d.Uc || (d.Uc = {}, d.Uc[e] = {});
        var g = b.N();
        b = [];
        var h = [], l;
        for (l in g) {
            var m = g[l];
            null !== m && (b.push(l), h.push(m), l == f || m instanceof cf ? l in d.Uc[e] || (d.Uc[e][l] = J(this.zd, this)) : l in d.Uc[e] || (d.Uc[e][l] = J(Mm)));
        }
        l = pb({}, d);
        l.node = a;
        zl(l, d.Uc, ul(void 0, e), h, c, b);
    };
    var Tm = {
            'http://www.opengis.net/gml': {
                surfaceMember: J(Pm.prototype.jj),
                polygonMember: J(Pm.prototype.jj)
            }
        }, Um = { 'http://www.opengis.net/gml': { pointMember: J(Pm.prototype.Lp) } }, Vm = {
            'http://www.opengis.net/gml': {
                lineStringMember: J(Pm.prototype.dj),
                curveMember: J(Pm.prototype.dj)
            }
        }, Sm = {
            'http://www.opengis.net/gml': {
                exterior: J(Pm.prototype.ij),
                interior: J(Pm.prototype.ij)
            }
        }, Wm = {
            'http://www.opengis.net/gml': {
                Curve: J(Pm.prototype.mf),
                MultiCurve: J(Pm.prototype.fj),
                Point: J(Pm.prototype.hj),
                MultiPoint: J(Pm.prototype.Kp),
                LineString: J(Pm.prototype.mf),
                MultiLineString: J(Pm.prototype.fj),
                LinearRing: J(Pm.prototype.ej),
                Polygon: J(Pm.prototype.nf),
                MultiPolygon: J(Pm.prototype.gj),
                Surface: J(Pm.prototype.nf),
                MultiSurface: J(Pm.prototype.gj),
                Envelope: J(Pm.prototype.Jp)
            }
        }, Xm = {
            MultiLineString: 'lineStringMember',
            MultiCurve: 'curveMember',
            MultiPolygon: 'polygonMember',
            MultiSurface: 'surfaceMember'
        };
    Pm.prototype.c = function (a, b) {
        return il('http://www.opengis.net/gml', Xm[b[b.length - 1].node.nodeName]);
    };
    Pm.prototype.a = function (a, b) {
        var c = b[b.length - 1], d = c.multiSurface, e = c.surface, f = c.curve, c = c.multiCurve, g;
        Array.isArray(a) ? g = 'Envelope' : (g = a.T(), 'MultiPolygon' === g && !0 === d ? g = 'MultiSurface' : 'Polygon' === g && !0 === e ? g = 'Surface' : 'LineString' === g && !0 === f ? g = 'Curve' : 'MultiLineString' === g && !0 === c && (g = 'MultiCurve'));
        return il('http://www.opengis.net/gml', g);
    };
    Pm.prototype.de = function (a, b) {
        b = El(this, b);
        var c = il('http://www.opengis.net/gml', 'geom'), d = {
                node: c,
                srsName: this.srsName,
                curve: this.i,
                surface: this.o,
                multiSurface: this.j,
                multiCurve: this.l
            };
        b && pb(d, b);
        this.zd(c, a, [d]);
        return c;
    };
    Pm.prototype.Yb = function (a, b) {
        b = El(this, b);
        var c = il('http://www.opengis.net/gml', 'featureMembers');
        c.setAttributeNS('http://www.w3.org/2001/XMLSchema-instance', 'xsi:schemaLocation', this.schemaLocation);
        var d = {
            srsName: this.srsName,
            curve: this.i,
            surface: this.o,
            multiSurface: this.j,
            multiCurve: this.l,
            featureNS: this.featureNS,
            featureType: this.featureType
        };
        b && pb(d, b);
        var d = [d], e = d[d.length - 1], f = e.featureType, g = e.featureNS, h = {};
        h[g] = {};
        h[g][f] = J(this.cj, this);
        e = pb({}, e);
        e.node = c;
        zl(e, h, ul(f, g), a, d);
        return c;
    };
    function Ym(a) {
        a = a ? a : {};
        Cm.call(this, a);
        this.b['http://www.opengis.net/gml'].featureMember = ql(Cm.prototype.Xd);
        this.schemaLocation = a.schemaLocation ? a.schemaLocation : 'http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd';
    }
    u(Ym, Cm);
    k = Ym.prototype;
    k.ui = function (a, b) {
        var c = jl(a, !1).replace(/^\s*|\s*$/g, ''), d = b[0].srsName, e = a.parentNode.getAttribute('srsDimension'), f = 'enu';
        d && (d = Gb(d)) && (f = d.b);
        c = c.split(/[\s,]+/);
        d = 2;
        a.getAttribute('srsDimension') ? d = Km(a.getAttribute('srsDimension')) : a.getAttribute('dimension') ? d = Km(a.getAttribute('dimension')) : e && (d = Km(e));
        for (var g, h, l = [], m = 0, p = c.length; m < p; m += d)
            e = parseFloat(c[m]), g = parseFloat(c[m + 1]), h = 3 === d ? parseFloat(c[m + 2]) : 0, 'en' === f.substr(0, 2) ? l.push(e, g, h) : l.push(g, e, h);
        return l;
    };
    k.Io = function (a, b) {
        var c = L([null], this.lj, a, b, this);
        return Va(c[1][0], c[1][1], c[1][3], c[1][4]);
    };
    k.Hl = function (a, b) {
        var c = L(void 0, this.ge, a, b, this);
        c && b[b.length - 1].push(c);
    };
    k.ro = function (a, b) {
        var c = L(void 0, this.ge, a, b, this);
        c && (b[b.length - 1][0] = c);
    };
    k.fe = { 'http://www.opengis.net/gml': { coordinates: rl(Ym.prototype.ui) } };
    k.qf = {
        'http://www.opengis.net/gml': {
            innerBoundaryIs: Ym.prototype.Hl,
            outerBoundaryIs: Ym.prototype.ro
        }
    };
    k.lj = { 'http://www.opengis.net/gml': { coordinates: ql(Ym.prototype.ui) } };
    k.Jg = {
        'http://www.opengis.net/gml': {
            Point: rl(Cm.prototype.Ai),
            MultiPoint: rl(Cm.prototype.yi),
            LineString: rl(Cm.prototype.Xe),
            MultiLineString: rl(Cm.prototype.xi),
            LinearRing: rl(Cm.prototype.wi),
            Polygon: rl(Cm.prototype.Ye),
            MultiPolygon: rl(Cm.prototype.zi),
            Box: rl(Ym.prototype.Io)
        }
    };
    function Zm(a) {
        a = a ? a : {};
        zm.call(this);
        this.defaultDataProjection = Gb('EPSG:4326');
        this.b = a.readExtensions;
    }
    u(Zm, zm);
    var $m = [
        null,
        'http://www.topografix.com/GPX/1/0',
        'http://www.topografix.com/GPX/1/1'
    ];
    function an(a, b, c, d) {
        a.push(parseFloat(c.getAttribute('lon')), parseFloat(c.getAttribute('lat')));
        'ele' in d ? (a.push(d.ele), delete d.ele, b.hasZ = !0) : a.push(0);
        'time' in d ? (a.push(d.time), delete d.time, b.hasM = !0) : a.push(0);
        return a;
    }
    function bn(a, b, c) {
        var d = 'XY', e = 2;
        a.hasZ && a.hasM ? (d = 'XYZM', e = 4) : a.hasZ ? (d = 'XYZ', e = 3) : a.hasM && (d = 'XYM', e = 3);
        if (4 !== e) {
            var f, g;
            f = 0;
            for (g = b.length / 4; f < g; f++)
                b[f * e] = b[4 * f], b[f * e + 1] = b[4 * f + 1], a.hasZ && (b[f * e + 2] = b[4 * f + 2]), a.hasM && (b[f * e + 2] = b[4 * f + 3]);
            b.length = b.length / 4 * e;
            if (c)
                for (f = 0, g = c.length; f < g; f++)
                    c[f] = c[f] / 4 * e;
        }
        return d;
    }
    function cn(a, b) {
        var c = b[b.length - 1], d = a.getAttribute('href');
        null !== d && (c.link = d);
        yl(dn, a, b);
    }
    function en(a, b) {
        b[b.length - 1].extensionsNode_ = a;
    }
    function fn(a, b) {
        var c = b[0], d = L({
                flatCoordinates: [],
                layoutOptions: {}
            }, gn, a, b);
        if (d) {
            var e = d.flatCoordinates;
            delete d.flatCoordinates;
            var f = d.layoutOptions;
            delete d.layoutOptions;
            var f = bn(f, e), g = new M(null);
            g.ca(f, e);
            Fl(g, !1, c);
            c = new H(g);
            c.H(d);
            return c;
        }
    }
    function hn(a, b) {
        var c = b[0], d = L({
                flatCoordinates: [],
                ends: [],
                layoutOptions: {}
            }, jn, a, b);
        if (d) {
            var e = d.flatCoordinates;
            delete d.flatCoordinates;
            var f = d.ends;
            delete d.ends;
            var g = d.layoutOptions;
            delete d.layoutOptions;
            var g = bn(g, e, f), h = new N(null);
            h.ca(g, e, f);
            Fl(h, !1, c);
            c = new H(h);
            c.H(d);
            return c;
        }
    }
    function kn(a, b) {
        var c = b[0], d = L({}, ln, a, b);
        if (d) {
            var e = {}, f = an([], e, a, d), e = bn(e, f), f = new E(f, e);
            Fl(f, !1, c);
            c = new H(f);
            c.H(d);
            return c;
        }
    }
    var mn = {
            rte: fn,
            trk: hn,
            wpt: kn
        }, nn = K($m, {
            rte: ql(fn),
            trk: ql(hn),
            wpt: ql(kn)
        }), dn = K($m, {
            text: I(Q, 'linkText'),
            type: I(Q, 'linkType')
        }), gn = K($m, {
            name: I(Q),
            cmt: I(Q),
            desc: I(Q),
            src: I(Q),
            link: cn,
            number: I(Jm),
            extensions: en,
            type: I(Q),
            rtept: function (a, b) {
                var c = L({}, on, a, b);
                if (c) {
                    var d = b[b.length - 1];
                    an(d.flatCoordinates, d.layoutOptions, a, c);
                }
            }
        }), on = K($m, {
            ele: I(Hm),
            time: I(Gm)
        }), jn = K($m, {
            name: I(Q),
            cmt: I(Q),
            desc: I(Q),
            src: I(Q),
            link: cn,
            number: I(Jm),
            type: I(Q),
            extensions: en,
            trkseg: function (a, b) {
                var c = b[b.length - 1];
                yl(pn, a, b);
                c.ends.push(c.flatCoordinates.length);
            }
        }), pn = K($m, {
            trkpt: function (a, b) {
                var c = L({}, qn, a, b);
                if (c) {
                    var d = b[b.length - 1];
                    an(d.flatCoordinates, d.layoutOptions, a, c);
                }
            }
        }), qn = K($m, {
            ele: I(Hm),
            time: I(Gm)
        }), ln = K($m, {
            ele: I(Hm),
            time: I(Gm),
            magvar: I(Hm),
            geoidheight: I(Hm),
            name: I(Q),
            cmt: I(Q),
            desc: I(Q),
            src: I(Q),
            link: cn,
            sym: I(Q),
            type: I(Q),
            fix: I(Q),
            sat: I(Jm),
            hdop: I(Hm),
            vdop: I(Hm),
            pdop: I(Hm),
            ageofdgpsdata: I(Hm),
            dgpsid: I(Jm),
            extensions: en
        });
    function rn(a, b) {
        b || (b = []);
        for (var c = 0, d = b.length; c < d; ++c) {
            var e = b[c];
            if (a.b) {
                var f = e.get('extensionsNode_') || null;
                a.b(e, f);
            }
            e.set('extensionsNode_', void 0);
        }
    }
    Zm.prototype.jg = function (a, b) {
        if (!ea($m, a.namespaceURI))
            return null;
        var c = mn[a.localName];
        if (!c)
            return null;
        c = c(a, [Dl(this, a, b)]);
        if (!c)
            return null;
        rn(this, [c]);
        return c;
    };
    Zm.prototype.yc = function (a, b) {
        if (!ea($m, a.namespaceURI))
            return [];
        if ('gpx' == a.localName) {
            var c = L([], nn, a, [Dl(this, a, b)]);
            if (c)
                return rn(this, c), c;
        }
        return [];
    };
    function sn(a, b, c) {
        a.setAttribute('href', b);
        b = c[c.length - 1].properties;
        zl({ node: a }, tn, wl, [
            b.linkText,
            b.linkType
        ], c, un);
    }
    function vn(a, b, c) {
        var d = c[c.length - 1], e = d.node.namespaceURI, f = d.properties;
        a.setAttributeNS(null, 'lat', b[1]);
        a.setAttributeNS(null, 'lon', b[0]);
        switch (d.geometryLayout) {
        case 'XYZM':
            b[3] && (f.time = b[3]);
        case 'XYZ':
            b[2] && (f.ele = b[2]);
            break;
        case 'XYM':
            b[2] && (f.time = b[2]);
        }
        b = 'rtept' == a.nodeName ? wn[e] : xn[e];
        d = xl(f, b);
        zl({
            node: a,
            properties: f
        }, yn, wl, d, c, b);
    }
    var un = [
            'text',
            'type'
        ], tn = K($m, {
            text: J(Mm),
            type: J(Mm)
        }), zn = K($m, 'name cmt desc src link number type rtept'.split(' ')), An = K($m, {
            name: J(Mm),
            cmt: J(Mm),
            desc: J(Mm),
            src: J(Mm),
            link: J(sn),
            number: J(Om),
            type: J(Mm),
            rtept: tl(J(vn))
        }), wn = K($m, [
            'ele',
            'time'
        ]), Bn = K($m, 'name cmt desc src link number type trkseg'.split(' ')), En = K($m, {
            name: J(Mm),
            cmt: J(Mm),
            desc: J(Mm),
            src: J(Mm),
            link: J(sn),
            number: J(Om),
            type: J(Mm),
            trkseg: tl(J(function (a, b, c) {
                zl({
                    node: a,
                    geometryLayout: b.ka,
                    properties: {}
                }, Cn, Dn, b.X(), c);
            }))
        }), Dn = ul('trkpt'), Cn = K($m, { trkpt: J(vn) }), xn = K($m, 'ele time magvar geoidheight name cmt desc src link sym type fix sat hdop vdop pdop ageofdgpsdata dgpsid'.split(' ')), yn = K($m, {
            ele: J(Nm),
            time: J(function (a, b) {
                var c = new Date(1000 * b);
                a.appendChild(gl.createTextNode(c.getUTCFullYear() + '-' + Oe(c.getUTCMonth() + 1) + '-' + Oe(c.getUTCDate()) + 'T' + Oe(c.getUTCHours()) + ':' + Oe(c.getUTCMinutes()) + ':' + Oe(c.getUTCSeconds()) + 'Z'));
            }),
            magvar: J(Nm),
            geoidheight: J(Nm),
            name: J(Mm),
            cmt: J(Mm),
            desc: J(Mm),
            src: J(Mm),
            link: J(sn),
            sym: J(Mm),
            type: J(Mm),
            fix: J(Mm),
            sat: J(Om),
            hdop: J(Nm),
            vdop: J(Nm),
            pdop: J(Nm),
            ageofdgpsdata: J(Nm),
            dgpsid: J(Om)
        }), Fn = {
            Point: 'wpt',
            LineString: 'rte',
            MultiLineString: 'trk'
        };
    function Gn(a, b) {
        var c = a.U();
        if (c && (c = Fn[c.T()]))
            return il(b[b.length - 1].node.namespaceURI, c);
    }
    var Hn = K($m, {
        rte: J(function (a, b, c) {
            var d = c[0], e = b.N();
            a = {
                node: a,
                properties: e
            };
            if (b = b.U())
                b = Fl(b, !0, d), a.geometryLayout = b.ka, e.rtept = b.X();
            d = zn[c[c.length - 1].node.namespaceURI];
            e = xl(e, d);
            zl(a, An, wl, e, c, d);
        }),
        trk: J(function (a, b, c) {
            var d = c[0], e = b.N();
            a = {
                node: a,
                properties: e
            };
            if (b = b.U())
                b = Fl(b, !0, d), e.trkseg = b.hd();
            d = Bn[c[c.length - 1].node.namespaceURI];
            e = xl(e, d);
            zl(a, En, wl, e, c, d);
        }),
        wpt: J(function (a, b, c) {
            var d = c[0], e = c[c.length - 1];
            e.properties = b.N();
            if (b = b.U())
                b = Fl(b, !0, d), e.geometryLayout = b.ka, vn(a, b.X(), c);
        })
    });
    Zm.prototype.Yb = function (a, b) {
        b = El(this, b);
        var c = il('http://www.topografix.com/GPX/1/1', 'gpx');
        c.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns:xsi', 'http://www.w3.org/2001/XMLSchema-instance');
        c.setAttributeNS('http://www.w3.org/2001/XMLSchema-instance', 'xsi:schemaLocation', 'http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd');
        c.setAttribute('version', '1.1');
        c.setAttribute('creator', 'OpenLayers');
        zl({ node: c }, Hn, Gn, a, [b]);
        return c;
    };
    function In() {
        Cl.call(this);
    }
    u(In, Cl);
    function Jn(a) {
        return 'string' === typeof a ? a : '';
    }
    k = In.prototype;
    k.T = function () {
        return 'text';
    };
    k.Ub = function (a, b) {
        return this.Wd(Jn(a), El(this, b));
    };
    k.Qa = function (a, b) {
        return this.lg(Jn(a), El(this, b));
    };
    k.Tc = function (a, b) {
        return this.ud(Jn(a), El(this, b));
    };
    k.kb = function () {
        return this.defaultDataProjection;
    };
    k.yd = function (a, b) {
        return this.be(a, El(this, b));
    };
    k.Xb = function (a, b) {
        return this.Gg(a, El(this, b));
    };
    k.bd = function (a, b) {
        return this.Ad(a, El(this, b));
    };
    function Kn(a) {
        a = a ? a : {};
        Cl.call(this);
        this.defaultDataProjection = Gb('EPSG:4326');
        this.b = a.altitudeMode ? a.altitudeMode : 'none';
    }
    u(Kn, In);
    var Ln = /^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/, Mn = /^H.([A-Z]{3}).*?:(.*)/, Nn = /^HFDTE(\d{2})(\d{2})(\d{2})/, On = /\r\n|\r|\n/;
    k = Kn.prototype;
    k.Wd = function (a, b) {
        var c = this.b, d = a.split(On), e = {}, f = [], g = 2000, h = 0, l = 1, m = -1, p, n;
        p = 0;
        for (n = d.length; p < n; ++p) {
            var q = d[p], r;
            if ('B' == q.charAt(0)) {
                if (r = Ln.exec(q)) {
                    var q = parseInt(r[1], 10), v = parseInt(r[2], 10), x = parseInt(r[3], 10), y = parseInt(r[4], 10) + parseInt(r[5], 10) / 60000;
                    'S' == r[6] && (y = -y);
                    var z = parseInt(r[7], 10) + parseInt(r[8], 10) / 60000;
                    'W' == r[9] && (z = -z);
                    f.push(z, y);
                    'none' != c && f.push('gps' == c ? parseInt(r[11], 10) : 'barometric' == c ? parseInt(r[12], 10) : 0);
                    r = Date.UTC(g, h, l, q, v, x);
                    r < m && (r = Date.UTC(g, h, l + 1, q, v, x));
                    f.push(r / 1000);
                    m = r;
                }
            } else
                'H' == q.charAt(0) && ((r = Nn.exec(q)) ? (l = parseInt(r[1], 10), h = parseInt(r[2], 10) - 1, g = 2000 + parseInt(r[3], 10)) : (r = Mn.exec(q)) && (e[r[1]] = r[2].trim()));
        }
        if (!f.length)
            return null;
        d = new M(null);
        d.ca('none' == c ? 'XYM' : 'XYZM', f);
        c = new H(Fl(d, !1, b));
        c.H(e);
        return c;
    };
    k.lg = function (a, b) {
        var c = this.Wd(a, b);
        return c ? [c] : [];
    };
    k.be = function () {
    };
    k.Gg = function () {
    };
    k.Ad = function () {
    };
    k.ud = function () {
    };
    function Pn(a, b, c, d, e, f) {
        Dc.call(this);
        this.l = null;
        this.M = a ? a : new Image();
        null !== d && (this.M.crossOrigin = d);
        this.c = f ? document.createElement('CANVAS') : null;
        this.g = f;
        this.i = null;
        this.f = e;
        this.a = c;
        this.j = b;
        this.o = !1;
        2 == this.f && Qn(this);
    }
    u(Pn, Dc);
    function Qn(a) {
        var b = Xc(1, 1);
        try {
            b.drawImage(a.M, 0, 0), b.getImageData(0, 0, 1, 1);
        } catch (c) {
            a.o = !0;
        }
    }
    Pn.prototype.v = function () {
        this.f = 3;
        this.i.forEach(rc);
        this.i = null;
        this.b('change');
    };
    Pn.prototype.I = function () {
        this.f = 2;
        this.a && (this.M.width = this.a[0], this.M.height = this.a[1]);
        this.a = [
            this.M.width,
            this.M.height
        ];
        this.i.forEach(rc);
        this.i = null;
        Qn(this);
        if (!this.o && null !== this.g) {
            this.c.width = this.M.width;
            this.c.height = this.M.height;
            var a = this.c.getContext('2d');
            a.drawImage(this.M, 0, 0);
            for (var b = a.getImageData(0, 0, this.M.width, this.M.height), c = b.data, d = this.g[0] / 255, e = this.g[1] / 255, f = this.g[2] / 255, g = 0, h = c.length; g < h; g += 4)
                c[g] *= d, c[g + 1] *= e, c[g + 2] *= f;
            a.putImageData(b, 0, 0);
        }
        this.b('change');
    };
    Pn.prototype.Z = function () {
        return this.c ? this.c : this.M;
    };
    Pn.prototype.load = function () {
        if (0 == this.f) {
            this.f = 1;
            this.i = [
                wc(this.M, 'error', this.v, this),
                wc(this.M, 'load', this.I, this)
            ];
            try {
                this.M.src = this.j;
            } catch (a) {
                this.v();
            }
        }
    };
    function Rn(a) {
        a = a || {};
        this.j = void 0 !== a.anchor ? a.anchor : [
            0.5,
            0.5
        ];
        this.I = null;
        this.a = void 0 !== a.anchorOrigin ? a.anchorOrigin : 'top-left';
        this.C = void 0 !== a.anchorXUnits ? a.anchorXUnits : 'fraction';
        this.G = void 0 !== a.anchorYUnits ? a.anchorYUnits : 'fraction';
        this.ta = void 0 !== a.crossOrigin ? a.crossOrigin : null;
        var b = void 0 !== a.img ? a.img : null, c = void 0 !== a.imgSize ? a.imgSize : null, d = a.src;
        qa(!(void 0 !== d && b), 4);
        qa(!b || b && c, 5);
        void 0 !== d && d.length || !b || (d = b.src || w(b).toString());
        qa(void 0 !== d && 0 < d.length, 6);
        var e = void 0 !== a.src ? 0 : 2;
        this.i = void 0 !== a.color ? Qc(a.color) : null;
        var f = this.ta, g = this.i, h = uh.get(d, f, g);
        h || (h = new Pn(b, d, c, f, e, g), uh.set(d, f, g, h));
        this.b = h;
        this.qa = void 0 !== a.offset ? a.offset : [
            0,
            0
        ];
        this.f = void 0 !== a.offsetOrigin ? a.offsetOrigin : 'top-left';
        this.u = null;
        this.A = void 0 !== a.size ? a.size : null;
        Vk.call(this, {
            opacity: void 0 !== a.opacity ? a.opacity : 1,
            rotation: void 0 !== a.rotation ? a.rotation : 0,
            scale: void 0 !== a.scale ? a.scale : 1,
            snapToPixel: void 0 !== a.snapToPixel ? a.snapToPixel : !0,
            rotateWithView: void 0 !== a.rotateWithView ? a.rotateWithView : !1
        });
    }
    u(Rn, Vk);
    k = Rn.prototype;
    k.clone = function () {
        var a = this.Z(1), b;
        if (2 === this.b.f)
            if ('IMG' === a.tagName.toUpperCase())
                b = a.cloneNode(!0);
            else {
                b = document.createElement('canvas');
                var c = b.getContext('2d');
                b.width = a.width;
                b.height = a.height;
                c.drawImage(a, 0, 0);
            }
        return new Rn({
            anchor: this.j.slice(),
            anchorOrigin: this.a,
            anchorXUnits: this.C,
            anchorYUnits: this.G,
            crossOrigin: this.ta,
            color: this.i && this.i.slice ? this.i.slice() : this.i || void 0,
            img: b ? b : void 0,
            imgSize: b ? this.b.a.slice() : void 0,
            src: b ? void 0 : this.b.j,
            offset: this.qa.slice(),
            offsetOrigin: this.f,
            size: null !== this.A ? this.A.slice() : void 0,
            opacity: this.g,
            scale: this.c,
            snapToPixel: this.v,
            rotation: this.l,
            rotateWithView: this.o
        });
    };
    k.Hc = function () {
        if (this.I)
            return this.I;
        var a = this.j, b = this.jc();
        if ('fraction' == this.C || 'fraction' == this.G) {
            if (!b)
                return null;
            a = this.j.slice();
            'fraction' == this.C && (a[0] *= b[0]);
            'fraction' == this.G && (a[1] *= b[1]);
        }
        if ('top-left' != this.a) {
            if (!b)
                return null;
            a === this.j && (a = this.j.slice());
            if ('top-right' == this.a || 'bottom-right' == this.a)
                a[0] = -a[0] + b[0];
            if ('bottom-left' == this.a || 'bottom-right' == this.a)
                a[1] = -a[1] + b[1];
        }
        return this.I = a;
    };
    k.Zn = function () {
        return this.i;
    };
    k.Z = function (a) {
        return this.b.Z(a);
    };
    k.ue = function () {
        return this.b.a;
    };
    k.Oe = function () {
        return this.b.f;
    };
    k.cg = function () {
        var a = this.b;
        if (!a.l)
            if (a.o) {
                var b = a.a[0], c = a.a[1], d = Xc(b, c);
                d.fillRect(0, 0, b, c);
                a.l = d.canvas;
            } else
                a.l = a.M;
        return a.l;
    };
    k.Pc = function () {
        if (this.u)
            return this.u;
        var a = this.qa;
        if ('top-left' != this.f) {
            var b = this.jc(), c = this.b.a;
            if (!b || !c)
                return null;
            a = a.slice();
            if ('top-right' == this.f || 'bottom-right' == this.f)
                a[0] = c[0] - b[0] - a[0];
            if ('bottom-left' == this.f || 'bottom-right' == this.f)
                a[1] = c[1] - b[1] - a[1];
        }
        return this.u = a;
    };
    k.$n = function () {
        return this.b.j;
    };
    k.jc = function () {
        return this.A ? this.A : this.b.a;
    };
    k.zh = function (a, b) {
        return B(this.b, 'change', a, b);
    };
    k.load = function () {
        this.b.load();
    };
    k.Yi = function (a, b) {
        xc(this.b, 'change', a, b);
    };
    function Sn(a) {
        a = a || {};
        this.a = a.font;
        this.i = a.rotation;
        this.j = a.rotateWithView;
        this.b = a.scale;
        this.Fa = a.text;
        this.g = a.textAlign;
        this.l = a.textBaseline;
        this.Wa = void 0 !== a.fill ? a.fill : new Zk({ color: '#333' });
        this.Ya = void 0 !== a.stroke ? a.stroke : null;
        this.f = void 0 !== a.offsetX ? a.offsetX : 0;
        this.c = void 0 !== a.offsetY ? a.offsetY : 0;
    }
    k = Sn.prototype;
    k.clone = function () {
        return new Sn({
            font: this.a,
            rotation: this.i,
            rotateWithView: this.j,
            scale: this.b,
            text: this.Pa(),
            textAlign: this.g,
            textBaseline: this.l,
            fill: this.Ca() ? this.Ca().clone() : void 0,
            stroke: this.Da() ? this.Da().clone() : void 0,
            offsetX: this.f,
            offsetY: this.c
        });
    };
    k.tk = function () {
        return this.a;
    };
    k.Ik = function () {
        return this.f;
    };
    k.Jk = function () {
        return this.c;
    };
    k.Ca = function () {
        return this.Wa;
    };
    k.fo = function () {
        return this.j;
    };
    k.ho = function () {
        return this.i;
    };
    k.io = function () {
        return this.b;
    };
    k.Da = function () {
        return this.Ya;
    };
    k.Pa = function () {
        return this.Fa;
    };
    k.Tk = function () {
        return this.g;
    };
    k.Uk = function () {
        return this.l;
    };
    k.Ii = function (a) {
        this.a = a;
    };
    k.Oi = function (a) {
        this.f = a;
    };
    k.Pi = function (a) {
        this.c = a;
    };
    k.cf = function (a) {
        this.Wa = a;
    };
    k.jo = function (a) {
        this.i = a;
    };
    k.ni = function (a) {
        this.b = a;
    };
    k.df = function (a) {
        this.Ya = a;
    };
    k.ef = function (a) {
        this.Fa = a;
    };
    k.Ri = function (a) {
        this.g = a;
    };
    k.up = function (a) {
        this.l = a;
    };
    function Tn(a) {
        a = a ? a : {};
        zm.call(this);
        Un || (Vn = [
            255,
            255,
            255,
            1
        ], Wn = new Zk({ color: Vn }), Xn = [
            20,
            2
        ], Yn = Zn = 'pixels', $n = [
            64,
            64
        ], ao = 'https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png', bo = 0.5, co = new Rn({
            anchor: Xn,
            anchorOrigin: 'bottom-left',
            anchorXUnits: Zn,
            anchorYUnits: Yn,
            crossOrigin: 'anonymous',
            rotation: 0,
            scale: bo,
            size: $n,
            src: ao
        }), eo = 'NO_IMAGE', fo = new rj({
            color: Vn,
            width: 1
        }), go = new rj({
            color: [
                51,
                51,
                51,
                1
            ],
            width: 2
        }), ho = new Sn({
            font: 'bold 16px Helvetica',
            fill: Wn,
            stroke: go,
            scale: 0.8
        }), io = new $k({
            fill: Wn,
            image: co,
            text: ho,
            stroke: fo,
            zIndex: 0
        }), Un = [io]);
        this.defaultDataProjection = Gb('EPSG:4326');
        this.a = a.defaultStyle ? a.defaultStyle : Un;
        this.c = void 0 !== a.extractStyles ? a.extractStyles : !0;
        this.l = void 0 !== a.writeStyles ? a.writeStyles : !0;
        this.b = {};
        this.i = void 0 !== a.showPointNames ? a.showPointNames : !0;
    }
    var Un, Vn, Wn, Xn, Zn, Yn, $n, ao, bo, co, eo, fo, go, ho, io;
    u(Tn, zm);
    var jo = ['http://www.google.com/kml/ext/2.2'], ko = [
            null,
            'http://earth.google.com/kml/2.0',
            'http://earth.google.com/kml/2.1',
            'http://earth.google.com/kml/2.2',
            'http://www.opengis.net/kml/2.2'
        ], lo = {
            fraction: 'fraction',
            pixels: 'pixels'
        };
    function mo(a, b) {
        var c, d = [
                0,
                0
            ], e = 'start';
        a.Z() && (c = a.Z().ue(), null === c && (c = $n), 2 == c.length && (e = a.Z().c, d[0] = e * c[0] / 2, d[1] = -e * c[1] / 2, e = 'left'));
        if (null !== a.Pa()) {
            var f = a.Pa();
            c = f.clone();
            c.Ii(f.a || ho.a);
            c.ni(f.b || ho.b);
            c.cf(f.Ca() || ho.Ca());
            c.df(f.Da() || go);
        } else
            c = ho.clone();
        c.ef(b);
        c.Oi(d[0]);
        c.Pi(d[1]);
        c.Ri(e);
        return new $k({ text: c });
    }
    function no(a, b, c, d, e) {
        return function () {
            var f = e, g = '';
            f && this.U() && (f = 'Point' === this.U().T());
            f && (g = this.get('name'), f = f && g);
            if (a)
                return f ? (f = mo(a[0], g), a.concat(f)) : a;
            if (b) {
                var h = oo(b, c, d);
                return f ? (f = mo(h[0], g), h.concat(f)) : h;
            }
            return f ? (f = mo(c[0], g), c.concat(f)) : c;
        };
    }
    function oo(a, b, c) {
        return Array.isArray(a) ? a : 'string' === typeof a ? (!(a in c) && '#' + a in c && (a = '#' + a), oo(c[a], b, c)) : b;
    }
    function po(a) {
        a = jl(a, !1);
        if (a = /^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(a))
            return a = a[1], [
                parseInt(a.substr(6, 2), 16),
                parseInt(a.substr(4, 2), 16),
                parseInt(a.substr(2, 2), 16),
                parseInt(a.substr(0, 2), 16) / 255
            ];
    }
    function qo(a) {
        a = jl(a, !1);
        for (var b = [], c = /^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i, d; d = c.exec(a);)
            b.push(parseFloat(d[1]), parseFloat(d[2]), d[3] ? parseFloat(d[3]) : 0), a = a.substr(d[0].length);
        if ('' === a)
            return b;
    }
    function ro(a) {
        var b = jl(a, !1).trim();
        return a.baseURI ? new URL(b, a.baseURI).href : b;
    }
    function so(a) {
        return Hm(a);
    }
    function to(a, b) {
        return L(null, uo, a, b);
    }
    function vo(a, b) {
        var c = L({
            B: [],
            bj: []
        }, wo, a, b);
        if (c) {
            var d = c.B, c = c.bj, e, f;
            e = 0;
            for (f = Math.min(d.length, c.length); e < f; ++e)
                d[4 * e + 3] = c[e];
            c = new M(null);
            c.ca('XYZM', d);
            return c;
        }
    }
    function xo(a, b) {
        var c = L({}, yo, a, b), d = L(null, zo, a, b);
        if (d) {
            var e = new M(null);
            e.ca('XYZ', d);
            e.H(c);
            return e;
        }
    }
    function Ao(a, b) {
        var c = L({}, yo, a, b), d = L(null, zo, a, b);
        if (d) {
            var e = new F(null);
            e.ca('XYZ', d, [d.length]);
            e.H(c);
            return e;
        }
    }
    function Bo(a, b) {
        var c = L([], Co, a, b);
        if (!c)
            return null;
        if (!c.length)
            return new qm(c);
        var d, e = !0, f = c[0].T(), g, h, l;
        h = 1;
        for (l = c.length; h < l; ++h)
            if (g = c[h], g.T() != f) {
                e = !1;
                break;
            }
        if (e)
            if ('Point' == f) {
                d = c[0];
                e = d.ka;
                f = d.ha();
                h = 1;
                for (l = c.length; h < l; ++h)
                    g = c[h], ga(f, g.ha());
                d = new O(null);
                d.ca(e, f);
                Do(d, c);
            } else
                'LineString' == f ? (d = new N(null), Ll(d, c), Do(d, c)) : 'Polygon' == f ? (d = new P(null), Nl(d, c), Do(d, c)) : 'GeometryCollection' == f ? d = new qm(c) : qa(!1, 37);
        else
            d = new qm(c);
        return d;
    }
    function Eo(a, b) {
        var c = L({}, yo, a, b), d = L(null, zo, a, b);
        if (d) {
            var e = new E(null);
            e.ca('XYZ', d);
            e.H(c);
            return e;
        }
    }
    function Fo(a, b) {
        var c = L({}, yo, a, b), d = L([null], Go, a, b);
        if (d && d[0]) {
            var e = new F(null), f = d[0], g = [f.length], h, l;
            h = 1;
            for (l = d.length; h < l; ++h)
                ga(f, d[h]), g.push(f.length);
            e.ca('XYZ', f, g);
            e.H(c);
            return e;
        }
    }
    function Ho(a, b) {
        var c = L({}, Io, a, b);
        if (!c)
            return null;
        var d = 'fillStyle' in c ? c.fillStyle : Wn, e = c.fill;
        void 0 === e || e || (d = null);
        e = 'imageStyle' in c ? c.imageStyle : co;
        e == eo && (e = void 0);
        var f = 'textStyle' in c ? c.textStyle : ho, g = 'strokeStyle' in c ? c.strokeStyle : fo, c = c.outline;
        void 0 === c || c || (g = null);
        return [new $k({
                fill: d,
                image: e,
                stroke: g,
                text: f,
                zIndex: void 0
            })];
    }
    function Do(a, b) {
        var c = b.length, d = Array(b.length), e = Array(b.length), f, g, h, l;
        h = l = !1;
        for (g = 0; g < c; ++g)
            f = b[g], d[g] = f.get('extrude'), e[g] = f.get('altitudeMode'), h = h || void 0 !== d[g], l = l || e[g];
        h && a.set('extrude', d);
        l && a.set('altitudeMode', e);
    }
    function Jo(a, b) {
        yl(Ko, a, b);
    }
    function Lo(a, b) {
        yl(Mo, a, b);
    }
    var No = K(ko, {
            displayName: I(Q),
            value: I(Q)
        }), Ko = K(ko, {
            Data: function (a, b) {
                var c = a.getAttribute('name');
                yl(No, a, b);
                var d = b[b.length - 1];
                null !== c ? d[c] = d.value : null !== d.displayName && (d[d.displayName] = d.value);
            },
            SchemaData: function (a, b) {
                yl(Oo, a, b);
            }
        }), Mo = K(ko, {
            LatLonAltBox: function (a, b) {
                var c = L({}, Po, a, b);
                if (c) {
                    var d = b[b.length - 1];
                    d.extent = [
                        parseFloat(c.west),
                        parseFloat(c.south),
                        parseFloat(c.east),
                        parseFloat(c.north)
                    ];
                    d.altitudeMode = c.altitudeMode;
                    d.minAltitude = parseFloat(c.minAltitude);
                    d.maxAltitude = parseFloat(c.maxAltitude);
                }
            },
            Lod: function (a, b) {
                var c = L({}, Qo, a, b);
                if (c) {
                    var d = b[b.length - 1];
                    d.minLodPixels = parseFloat(c.minLodPixels);
                    d.maxLodPixels = parseFloat(c.maxLodPixels);
                    d.minFadeExtent = parseFloat(c.minFadeExtent);
                    d.maxFadeExtent = parseFloat(c.maxFadeExtent);
                }
            }
        }), Po = K(ko, {
            altitudeMode: I(Q),
            minAltitude: I(Hm),
            maxAltitude: I(Hm),
            north: I(Hm),
            south: I(Hm),
            east: I(Hm),
            west: I(Hm)
        }), Qo = K(ko, {
            minLodPixels: I(Hm),
            maxLodPixels: I(Hm),
            minFadeExtent: I(Hm),
            maxFadeExtent: I(Hm)
        }), yo = K(ko, {
            extrude: I(Em),
            altitudeMode: I(Q)
        }), uo = K(ko, { coordinates: rl(qo) }), Go = K(ko, {
            innerBoundaryIs: function (a, b) {
                var c = L(void 0, Ro, a, b);
                c && b[b.length - 1].push(c);
            },
            outerBoundaryIs: function (a, b) {
                var c = L(void 0, So, a, b);
                c && (b[b.length - 1][0] = c);
            }
        }), wo = K(ko, {
            when: function (a, b) {
                var c = b[b.length - 1].bj, d = jl(a, !1), d = Date.parse(d);
                c.push(isNaN(d) ? 0 : d);
            }
        }, K(jo, {
            coord: function (a, b) {
                var c = b[b.length - 1].B, d = jl(a, !1);
                (d = /^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(d)) ? c.push(parseFloat(d[1]), parseFloat(d[2]), parseFloat(d[3]), 0) : c.push(0, 0, 0, 0);
            }
        })), zo = K(ko, { coordinates: rl(qo) }), To = K(ko, { href: I(ro) }, K(jo, {
            x: I(Hm),
            y: I(Hm),
            w: I(Hm),
            h: I(Hm)
        })), Uo = K(ko, {
            Icon: I(function (a, b) {
                var c = L({}, To, a, b);
                return c ? c : null;
            }),
            heading: I(Hm),
            hotSpot: I(function (a) {
                var b = a.getAttribute('xunits'), c = a.getAttribute('yunits');
                return {
                    x: parseFloat(a.getAttribute('x')),
                    Hg: lo[b],
                    y: parseFloat(a.getAttribute('y')),
                    Ig: lo[c]
                };
            }),
            scale: I(so)
        }), Ro = K(ko, { LinearRing: rl(to) }), Vo = K(ko, {
            color: I(po),
            scale: I(so)
        }), Wo = K(ko, {
            color: I(po),
            width: I(Hm)
        }), Co = K(ko, {
            LineString: ql(xo),
            LinearRing: ql(Ao),
            MultiGeometry: ql(Bo),
            Point: ql(Eo),
            Polygon: ql(Fo)
        }), Xo = K(jo, { Track: ql(vo) }), Zo = K(ko, {
            ExtendedData: Jo,
            Region: Lo,
            Link: function (a, b) {
                yl(Yo, a, b);
            },
            address: I(Q),
            description: I(Q),
            name: I(Q),
            open: I(Em),
            phoneNumber: I(Q),
            visibility: I(Em)
        }), Yo = K(ko, { href: I(ro) }), So = K(ko, { LinearRing: rl(to) }), $o = K(ko, {
            Style: I(Ho),
            key: I(Q),
            styleUrl: I(ro)
        }), bp = K(ko, {
            ExtendedData: Jo,
            Region: Lo,
            MultiGeometry: I(Bo, 'geometry'),
            LineString: I(xo, 'geometry'),
            LinearRing: I(Ao, 'geometry'),
            Point: I(Eo, 'geometry'),
            Polygon: I(Fo, 'geometry'),
            Style: I(Ho),
            StyleMap: function (a, b) {
                var c = L(void 0, ap, a, b);
                if (c) {
                    var d = b[b.length - 1];
                    Array.isArray(c) ? d.Style = c : 'string' === typeof c ? d.styleUrl = c : qa(!1, 38);
                }
            },
            address: I(Q),
            description: I(Q),
            name: I(Q),
            open: I(Em),
            phoneNumber: I(Q),
            styleUrl: I(ro),
            visibility: I(Em)
        }, K(jo, {
            MultiTrack: I(function (a, b) {
                var c = L([], Xo, a, b);
                if (c) {
                    var d = new N(null);
                    Ll(d, c);
                    return d;
                }
            }, 'geometry'),
            Track: I(vo, 'geometry')
        })), cp = K(ko, {
            color: I(po),
            fill: I(Em),
            outline: I(Em)
        }), Oo = K(ko, {
            SimpleData: function (a, b) {
                var c = a.getAttribute('name');
                if (null !== c) {
                    var d = Q(a);
                    b[b.length - 1][c] = d;
                }
            }
        }), Io = K(ko, {
            IconStyle: function (a, b) {
                var c = L({}, Uo, a, b);
                if (c) {
                    var d = b[b.length - 1], e = 'Icon' in c ? c.Icon : {}, f = !('Icon' in c) || 0 < Object.keys(e).length, g, h = e.href;
                    h ? g = h : f && (g = ao);
                    var l, m, p;
                    (h = c.hotSpot) ? (l = [
                        h.x,
                        h.y
                    ], m = h.Hg, p = h.Ig) : g === ao ? (l = Xn, m = Zn, p = Yn) : /^http:\/\/maps\.(?:google|gstatic)\.com\//.test(g) && (l = [
                        0.5,
                        0
                    ], p = m = 'fraction');
                    var n, h = e.x, q = e.y;
                    void 0 !== h && void 0 !== q && (n = [
                        h,
                        q
                    ]);
                    var r, h = e.w, e = e.h;
                    void 0 !== h && void 0 !== e && (r = [
                        h,
                        e
                    ]);
                    var v, e = c.heading;
                    void 0 !== e && (v = Ba(e));
                    c = c.scale;
                    f ? (g == ao && (r = $n, void 0 === c && (c = bo)), f = new Rn({
                        anchor: l,
                        anchorOrigin: 'bottom-left',
                        anchorXUnits: m,
                        anchorYUnits: p,
                        crossOrigin: 'anonymous',
                        offset: n,
                        offsetOrigin: 'bottom-left',
                        rotation: v,
                        scale: c,
                        size: r,
                        src: g
                    }), d.imageStyle = f) : d.imageStyle = eo;
                }
            },
            LabelStyle: function (a, b) {
                var c = L({}, Vo, a, b);
                c && (b[b.length - 1].textStyle = new Sn({
                    fill: new Zk({ color: 'color' in c ? c.color : Vn }),
                    scale: c.scale
                }));
            },
            LineStyle: function (a, b) {
                var c = L({}, Wo, a, b);
                c && (b[b.length - 1].strokeStyle = new rj({
                    color: 'color' in c ? c.color : Vn,
                    width: 'width' in c ? c.width : 1
                }));
            },
            PolyStyle: function (a, b) {
                var c = L({}, cp, a, b);
                if (c) {
                    var d = b[b.length - 1];
                    d.fillStyle = new Zk({ color: 'color' in c ? c.color : Vn });
                    var e = c.fill;
                    void 0 !== e && (d.fill = e);
                    c = c.outline;
                    void 0 !== c && (d.outline = c);
                }
            }
        }), ap = K(ko, {
            Pair: function (a, b) {
                var c = L({}, $o, a, b);
                if (c) {
                    var d = c.key;
                    d && 'normal' == d && ((d = c.styleUrl) && (b[b.length - 1] = d), (c = c.Style) && (b[b.length - 1] = c));
                }
            }
        });
    k = Tn.prototype;
    k.hg = function (a, b) {
        var c = K(ko, {
            Document: pl(this.hg, this),
            Folder: pl(this.hg, this),
            Placemark: ql(this.pg, this),
            Style: this.Yo.bind(this),
            StyleMap: this.Xo.bind(this)
        });
        if (c = L([], c, a, b, this))
            return c;
    };
    k.pg = function (a, b) {
        var c = L({ geometry: null }, bp, a, b);
        if (c) {
            var d = new H(), e = a.getAttribute('id');
            null !== e && d.kc(e);
            var e = b[0], f = c.geometry;
            f && Fl(f, !1, e);
            d.Sa(f);
            delete c.geometry;
            this.c && d.Vf(no(c.Style, c.styleUrl, this.a, this.b, this.i));
            delete c.Style;
            d.H(c);
            return d;
        }
    };
    k.Yo = function (a, b) {
        var c = a.getAttribute('id');
        if (null !== c) {
            var d = Ho(a, b);
            d && (c = a.baseURI ? new URL('#' + c, a.baseURI).href : '#' + c, this.b[c] = d);
        }
    };
    k.Xo = function (a, b) {
        var c = a.getAttribute('id');
        if (null !== c) {
            var d = L(void 0, ap, a, b);
            d && (c = a.baseURI ? new URL('#' + c, a.baseURI).href : '#' + c, this.b[c] = d);
        }
    };
    k.jg = function (a, b) {
        if (!ea(ko, a.namespaceURI))
            return null;
        var c = this.pg(a, [Dl(this, a, b)]);
        return c ? c : null;
    };
    k.yc = function (a, b) {
        if (!ea(ko, a.namespaceURI))
            return [];
        var c;
        c = a.localName;
        if ('Document' == c || 'Folder' == c)
            return (c = this.hg(a, [Dl(this, a, b)])) ? c : [];
        if ('Placemark' == c)
            return (c = this.pg(a, [Dl(this, a, b)])) ? [c] : [];
        if ('kml' == c) {
            c = [];
            var d;
            for (d = a.firstElementChild; d; d = d.nextElementSibling) {
                var e = this.yc(d, b);
                e && ga(c, e);
            }
            return c;
        }
        return [];
    };
    k.Ro = function (a) {
        if (ll(a))
            return dp(this, a);
        if (ml(a))
            return ep(this, a);
        if ('string' === typeof a)
            return a = nl(a), dp(this, a);
    };
    function dp(a, b) {
        var c;
        for (c = b.firstChild; c; c = c.nextSibling)
            if (c.nodeType == Node.ELEMENT_NODE) {
                var d = ep(a, c);
                if (d)
                    return d;
            }
    }
    function ep(a, b) {
        var c;
        for (c = b.firstElementChild; c; c = c.nextElementSibling)
            if (ea(ko, c.namespaceURI) && 'name' == c.localName)
                return Q(c);
        for (c = b.firstElementChild; c; c = c.nextElementSibling) {
            var d = c.localName;
            if (ea(ko, c.namespaceURI) && ('Document' == d || 'Folder' == d || 'Placemark' == d || 'kml' == d) && (d = ep(a, c)))
                return d;
        }
    }
    k.So = function (a) {
        var b = [];
        ll(a) ? ga(b, fp(this, a)) : ml(a) ? ga(b, gp(this, a)) : 'string' === typeof a && (a = nl(a), ga(b, fp(this, a)));
        return b;
    };
    function fp(a, b) {
        var c, d = [];
        for (c = b.firstChild; c; c = c.nextSibling)
            c.nodeType == Node.ELEMENT_NODE && ga(d, gp(a, c));
        return d;
    }
    function gp(a, b) {
        var c, d = [];
        for (c = b.firstElementChild; c; c = c.nextElementSibling)
            if (ea(ko, c.namespaceURI) && 'NetworkLink' == c.localName) {
                var e = L({}, Zo, c, []);
                d.push(e);
            }
        for (c = b.firstElementChild; c; c = c.nextElementSibling)
            e = c.localName, !ea(ko, c.namespaceURI) || 'Document' != e && 'Folder' != e && 'kml' != e || ga(d, gp(a, c));
        return d;
    }
    k.Vo = function (a) {
        var b = [];
        ll(a) ? ga(b, hp(this, a)) : ml(a) ? ga(b, this.$e(a)) : 'string' === typeof a && (a = nl(a), ga(b, hp(this, a)));
        return b;
    };
    function hp(a, b) {
        var c, d = [];
        for (c = b.firstChild; c; c = c.nextSibling)
            c.nodeType == Node.ELEMENT_NODE && ga(d, a.$e(c));
        return d;
    }
    k.$e = function (a) {
        var b, c = [];
        for (b = a.firstElementChild; b; b = b.nextElementSibling)
            if (ea(ko, b.namespaceURI) && 'Region' == b.localName) {
                var d = L({}, Mo, b, []);
                c.push(d);
            }
        for (b = a.firstElementChild; b; b = b.nextElementSibling)
            a = b.localName, !ea(ko, b.namespaceURI) || 'Document' != a && 'Folder' != a && 'kml' != a || ga(c, this.$e(b));
        return c;
    };
    function ip(a, b) {
        var c = Qc(b), c = [
                255 * (4 == c.length ? c[3] : 1),
                c[2],
                c[1],
                c[0]
            ], d;
        for (d = 0; 4 > d; ++d) {
            var e = parseInt(c[d], 10).toString(16);
            c[d] = 1 == e.length ? '0' + e : e;
        }
        Mm(a, c.join(''));
    }
    function jp(a, b, c) {
        a = { node: a };
        var d = b.T(), e, f;
        'GeometryCollection' == d ? (e = b.If(), f = kp) : 'MultiPoint' == d ? (e = b.Ie(), f = lp) : 'MultiLineString' == d ? (e = b.hd(), f = mp) : 'MultiPolygon' == d ? (e = b.Od(), f = np) : qa(!1, 39);
        zl(a, op, f, e, c);
    }
    function pp(a, b, c) {
        zl({ node: a }, qp, rp, [b], c);
    }
    function sp(a, b, c) {
        var d = { node: a };
        b.a && a.setAttribute('id', b.a);
        a = b.N();
        var e = {
            address: 1,
            description: 1,
            name: 1,
            open: 1,
            phoneNumber: 1,
            styleUrl: 1,
            visibility: 1
        };
        e[b.c] = 1;
        var f = Object.keys(a || {}).sort().filter(function (a) {
            return !e[a];
        });
        if (0 < f.length) {
            var g = xl(a, f);
            zl(d, tp, up, [{
                    names: f,
                    values: g
                }], c);
        }
        if (f = b.Nc())
            if (f = f.call(b, 0))
                f = Array.isArray(f) ? f[0] : f, this.l && (a.Style = f), (f = f.Pa()) && (a.name = f.Pa());
        f = vp[c[c.length - 1].node.namespaceURI];
        a = xl(a, f);
        zl(d, tp, wl, a, c, f);
        a = c[0];
        (b = b.U()) && (b = Fl(b, !0, a));
        zl(d, tp, kp, [b], c);
    }
    function wp(a, b, c) {
        var d = b.ha();
        a = { node: a };
        a.layout = b.ka;
        a.stride = b.sa();
        zl(a, xp, yp, [d], c);
    }
    function zp(a, b, c) {
        b = b.jd();
        var d = b.shift();
        a = { node: a };
        zl(a, Ap, Bp, b, c);
        zl(a, Ap, Cp, [d], c);
    }
    function Dp(a, b) {
        Nm(a, Math.round(1000000 * b) / 1000000);
    }
    var Ep = K(ko, [
            'Document',
            'Placemark'
        ]), Hp = K(ko, {
            Document: J(function (a, b, c) {
                zl({ node: a }, Fp, Gp, b, c, void 0, this);
            }),
            Placemark: J(sp)
        }), Fp = K(ko, { Placemark: J(sp) }), Ip = K(ko, {
            Data: J(function (a, b, c) {
                a.setAttribute('name', b.name);
                a = { node: a };
                b = b.value;
                'object' == typeof b ? (null !== b && b.displayName && zl(a, Ip, wl, [b.displayName], c, ['displayName']), null !== b && b.value && zl(a, Ip, wl, [b.value], c, ['value'])) : zl(a, Ip, wl, [b], c, ['value']);
            }),
            value: J(function (a, b) {
                Mm(a, b);
            }),
            displayName: J(function (a, b) {
                a.appendChild(gl.createCDATASection(b));
            })
        }), Jp = {
            Point: 'Point',
            LineString: 'LineString',
            LinearRing: 'LinearRing',
            Polygon: 'Polygon',
            MultiPoint: 'MultiGeometry',
            MultiLineString: 'MultiGeometry',
            MultiPolygon: 'MultiGeometry',
            GeometryCollection: 'MultiGeometry'
        }, Kp = K(ko, ['href'], K(jo, [
            'x',
            'y',
            'w',
            'h'
        ])), Lp = K(ko, { href: J(Mm) }, K(jo, {
            x: J(Nm),
            y: J(Nm),
            w: J(Nm),
            h: J(Nm)
        })), Mp = K(ko, [
            'scale',
            'heading',
            'Icon',
            'hotSpot'
        ]), Op = K(ko, {
            Icon: J(function (a, b, c) {
                a = { node: a };
                var d = Kp[c[c.length - 1].node.namespaceURI], e = xl(b, d);
                zl(a, Lp, wl, e, c, d);
                d = Kp[jo[0]];
                e = xl(b, d);
                zl(a, Lp, Np, e, c, d);
            }),
            heading: J(Nm),
            hotSpot: J(function (a, b) {
                a.setAttribute('x', b.x);
                a.setAttribute('y', b.y);
                a.setAttribute('xunits', b.Hg);
                a.setAttribute('yunits', b.Ig);
            }),
            scale: J(Dp)
        }), Pp = K(ko, [
            'color',
            'scale'
        ]), Qp = K(ko, {
            color: J(ip),
            scale: J(Dp)
        }), Rp = K(ko, [
            'color',
            'width'
        ]), Sp = K(ko, {
            color: J(ip),
            width: J(Nm)
        }), qp = K(ko, { LinearRing: J(wp) }), op = K(ko, {
            LineString: J(wp),
            Point: J(wp),
            Polygon: J(zp),
            GeometryCollection: J(jp)
        }), vp = K(ko, 'name open visibility address phoneNumber description styleUrl Style'.split(' ')), tp = K(ko, {
            ExtendedData: J(function (a, b, c) {
                a = { node: a };
                var d = b.names;
                b = b.values;
                for (var e = d.length, f = 0; f < e; f++)
                    zl(a, Ip, Tp, [{
                            name: d[f],
                            value: b[f]
                        }], c);
            }),
            MultiGeometry: J(jp),
            LineString: J(wp),
            LinearRing: J(wp),
            Point: J(wp),
            Polygon: J(zp),
            Style: J(function (a, b, c) {
                a = { node: a };
                var d = {}, e = b.Ca(), f = b.Da(), g = b.Z();
                b = b.Pa();
                g instanceof Rn && (d.IconStyle = g);
                b && (d.LabelStyle = b);
                f && (d.LineStyle = f);
                e && (d.PolyStyle = e);
                b = Up[c[c.length - 1].node.namespaceURI];
                d = xl(d, b);
                zl(a, Vp, wl, d, c, b);
            }),
            address: J(Mm),
            description: J(Mm),
            name: J(Mm),
            open: J(Lm),
            phoneNumber: J(Mm),
            styleUrl: J(Mm),
            visibility: J(Lm)
        }), xp = K(ko, {
            coordinates: J(function (a, b, c) {
                c = c[c.length - 1];
                var d = c.layout;
                c = c.stride;
                var e;
                'XY' == d || 'XYM' == d ? e = 2 : 'XYZ' == d || 'XYZM' == d ? e = 3 : qa(!1, 34);
                var f, g = b.length, h = '';
                if (0 < g) {
                    h += b[0];
                    for (d = 1; d < e; ++d)
                        h += ',' + b[d];
                    for (f = c; f < g; f += c)
                        for (h += ' ' + b[f], d = 1; d < e; ++d)
                            h += ',' + b[f + d];
                }
                Mm(a, h);
            })
        }), Ap = K(ko, {
            outerBoundaryIs: J(pp),
            innerBoundaryIs: J(pp)
        }), Wp = K(ko, { color: J(ip) }), Up = K(ko, [
            'IconStyle',
            'LabelStyle',
            'LineStyle',
            'PolyStyle'
        ]), Vp = K(ko, {
            IconStyle: J(function (a, b, c) {
                a = { node: a };
                var d = {}, e = b.jc(), f = b.ue(), g = { href: b.b.j };
                if (e) {
                    g.w = e[0];
                    g.h = e[1];
                    var h = b.Hc(), l = b.Pc();
                    l && f && l[0] && l[1] !== e[1] && (g.x = l[0], g.y = f[1] - (l[1] + e[1]));
                    h && h[0] && h[1] !== e[1] && (d.hotSpot = {
                        x: h[0],
                        Hg: 'pixels',
                        y: e[1] - h[1],
                        Ig: 'pixels'
                    });
                }
                d.Icon = g;
                e = b.c;
                1 !== e && (d.scale = e);
                (b = b.l) && (d.heading = b);
                b = Mp[c[c.length - 1].node.namespaceURI];
                d = xl(d, b);
                zl(a, Op, wl, d, c, b);
            }),
            LabelStyle: J(function (a, b, c) {
                a = { node: a };
                var d = {}, e = b.Ca();
                e && (d.color = e.b);
                (b = b.b) && 1 !== b && (d.scale = b);
                b = Pp[c[c.length - 1].node.namespaceURI];
                d = xl(d, b);
                zl(a, Qp, wl, d, c, b);
            }),
            LineStyle: J(function (a, b, c) {
                a = { node: a };
                var d = Rp[c[c.length - 1].node.namespaceURI];
                b = xl({
                    color: b.a,
                    width: b.c
                }, d);
                zl(a, Sp, wl, b, c, d);
            }),
            PolyStyle: J(function (a, b, c) {
                zl({ node: a }, Wp, Xp, [b.b], c);
            })
        });
    function Np(a, b, c) {
        return il(jo[0], 'gx:' + c);
    }
    function Gp(a, b) {
        return il(b[b.length - 1].node.namespaceURI, 'Placemark');
    }
    function kp(a, b) {
        if (a)
            return il(b[b.length - 1].node.namespaceURI, Jp[a.T()]);
    }
    var Xp = ul('color'), yp = ul('coordinates'), Tp = ul('Data'), up = ul('ExtendedData'), Bp = ul('innerBoundaryIs'), lp = ul('Point'), mp = ul('LineString'), rp = ul('LinearRing'), np = ul('Polygon'), Cp = ul('outerBoundaryIs');
    Tn.prototype.Yb = function (a, b) {
        b = El(this, b);
        var c = il(ko[4], 'kml');
        c.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns:gx', jo[0]);
        c.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns:xsi', 'http://www.w3.org/2001/XMLSchema-instance');
        c.setAttributeNS('http://www.w3.org/2001/XMLSchema-instance', 'xsi:schemaLocation', 'http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd');
        var d = { node: c }, e = {};
        1 < a.length ? e.Document = a : 1 == a.length && (e.Placemark = a[0]);
        var f = Ep[c.namespaceURI], e = xl(e, f);
        zl(d, Hp, wl, e, [b], f, this);
        return c;
    };
    (function () {
        var a = {}, b = { ma: a };
        (function (c) {
            if ('object' === typeof a && 'undefined' !== typeof b)
                b.ma = c();
            else {
                var d;
                'undefined' !== typeof window ? d = window : 'undefined' !== typeof global ? d = global : 'undefined' !== typeof self ? d = self : d = this;
                d.aq = c();
            }
        }(function () {
            return function d(a, b, g) {
                function e(h, l) {
                    if (!b[h]) {
                        if (!a[h]) {
                            var m = 'function' == typeof require && require;
                            if (!l && m)
                                return m(h, !0);
                            if (f)
                                return f(h, !0);
                            m = Error('Cannot find module \'' + h + '\'');
                            throw m.code = 'MODULE_NOT_FOUND', m;
                        }
                        m = b[h] = { ma: {} };
                        a[h][0].call(m.ma, function (b) {
                            var d = a[h][1][b];
                            return e(d ? d : b);
                        }, m, m.ma, d, a, b, g);
                    }
                    return b[h].ma;
                }
                for (var f = 'function' == typeof require && require, m = 0; m < g.length; m++)
                    e(g[m]);
                return e;
            }({
                1: [
                    function (a, b, f) {
                        f.read = function (a, b, d, e, f) {
                            var g;
                            g = 8 * f - e - 1;
                            var h = (1 << g) - 1, l = h >> 1, m = -7;
                            f = d ? f - 1 : 0;
                            var p = d ? -1 : 1, y = a[b + f];
                            f += p;
                            d = y & (1 << -m) - 1;
                            y >>= -m;
                            for (m += g; 0 < m; d = 256 * d + a[b + f], f += p, m -= 8);
                            g = d & (1 << -m) - 1;
                            d >>= -m;
                            for (m += e; 0 < m; g = 256 * g + a[b + f], f += p, m -= 8);
                            if (0 === d)
                                d = 1 - l;
                            else {
                                if (d === h)
                                    return g ? NaN : Infinity * (y ? -1 : 1);
                                g += Math.pow(2, e);
                                d -= l;
                            }
                            return (y ? -1 : 1) * g * Math.pow(2, d - e);
                        };
                        f.write = function (a, b, d, e, f, n) {
                            var g, h = 8 * n - f - 1, l = (1 << h) - 1, m = l >> 1, p = 23 === f ? Math.pow(2, -24) - Math.pow(2, -77) : 0;
                            n = e ? 0 : n - 1;
                            var z = e ? 1 : -1, A = 0 > b || 0 === b && 0 > 1 / b ? 1 : 0;
                            b = Math.abs(b);
                            isNaN(b) || Infinity === b ? (b = isNaN(b) ? 1 : 0, e = l) : (e = Math.floor(Math.log(b) / Math.LN2), 1 > b * (g = Math.pow(2, -e)) && (e--, g *= 2), b = 1 <= e + m ? b + p / g : b + p * Math.pow(2, 1 - m), 2 <= b * g && (e++, g /= 2), e + m >= l ? (b = 0, e = l) : 1 <= e + m ? (b = (b * g - 1) * Math.pow(2, f), e += m) : (b = b * Math.pow(2, m - 1) * Math.pow(2, f), e = 0));
                            for (; 8 <= f; a[d + n] = b & 255, n += z, b /= 256, f -= 8);
                            e = e << f | b;
                            for (h += f; 0 < h; a[d + n] = e & 255, n += z, e /= 256, h -= 8);
                            a[d + n - z] |= 128 * A;
                        };
                    },
                    {}
                ],
                2: [
                    function (a, b) {
                        function d(a) {
                            this.lc = ArrayBuffer.isView && ArrayBuffer.isView(a) ? a : new Uint8Array(a || 0);
                            this.type = this.ga = 0;
                            this.length = this.lc.length;
                        }
                        function e(a, b, d) {
                            var e = d.lc, f, g;
                            g = e[d.ga++];
                            f = (g & 112) >> 4;
                            if (128 > g)
                                return h(a, f, b);
                            g = e[d.ga++];
                            f |= (g & 127) << 3;
                            if (128 > g)
                                return h(a, f, b);
                            g = e[d.ga++];
                            f |= (g & 127) << 10;
                            if (128 > g)
                                return h(a, f, b);
                            g = e[d.ga++];
                            f |= (g & 127) << 17;
                            if (128 > g)
                                return h(a, f, b);
                            g = e[d.ga++];
                            f |= (g & 127) << 24;
                            if (128 > g)
                                return h(a, f, b);
                            g = e[d.ga++];
                            if (128 > g)
                                return h(a, f | (g & 1) << 31, b);
                            throw Error('Expected varint not more than 10 bytes');
                        }
                        function h(a, b, d) {
                            return d ? 4294967296 * b + (a >>> 0) : 4294967296 * (b >>> 0) + (a >>> 0);
                        }
                        b.ma = d;
                        var l = a('ieee754');
                        d.c = 0;
                        d.f = 1;
                        d.b = 2;
                        d.a = 5;
                        d.prototype = {
                            mg: function (a, b, d) {
                                for (d = d || this.length; this.ga < d;) {
                                    var e = this.Ma(), f = e >> 3, g = this.ga;
                                    this.type = e & 7;
                                    a(f, b, this);
                                    this.ga === g && this.zp(e);
                                }
                                return b;
                            },
                            No: function () {
                                var a = l.read(this.lc, this.ga, !0, 23, 4);
                                this.ga += 4;
                                return a;
                            },
                            Jo: function () {
                                var a = l.read(this.lc, this.ga, !0, 52, 8);
                                this.ga += 8;
                                return a;
                            },
                            Ma: function (a) {
                                var b = this.lc, d, f;
                                f = b[this.ga++];
                                d = f & 127;
                                if (128 > f)
                                    return d;
                                f = b[this.ga++];
                                d |= (f & 127) << 7;
                                if (128 > f)
                                    return d;
                                f = b[this.ga++];
                                d |= (f & 127) << 14;
                                if (128 > f)
                                    return d;
                                f = b[this.ga++];
                                d |= (f & 127) << 21;
                                if (128 > f)
                                    return d;
                                f = b[this.ga];
                                return e(d | (f & 15) << 28, a, this);
                            },
                            Zo: function () {
                                return this.Ma(!0);
                            },
                            Yd: function () {
                                var a = this.Ma();
                                return 1 === a % 2 ? (a + 1) / -2 : a / 2;
                            },
                            Ho: function () {
                                return !!this.Ma();
                            },
                            sg: function () {
                                for (var a = this.Ma() + this.ga, b = this.lc, d = '', e = this.ga; e < a;) {
                                    var f = b[e], g = null, h = 239 < f ? 4 : 223 < f ? 3 : 191 < f ? 2 : 1;
                                    if (e + h > a)
                                        break;
                                    var l, z, A;
                                    if (1 === h)
                                        128 > f && (g = f);
                                    else if (2 === h)
                                        l = b[e + 1], 128 === (l & 192) && (g = (f & 31) << 6 | l & 63, 127 >= g && (g = null));
                                    else if (3 === h) {
                                        if (l = b[e + 1], z = b[e + 2], 128 === (l & 192) && 128 === (z & 192) && (g = (f & 15) << 12 | (l & 63) << 6 | z & 63, 2047 >= g || 55296 <= g && 57343 >= g))
                                            g = null;
                                    } else
                                        4 === h && (l = b[e + 1], z = b[e + 2], A = b[e + 3], 128 === (l & 192) && 128 === (z & 192) && 128 === (A & 192) && (g = (f & 15) << 18 | (l & 63) << 12 | (z & 63) << 6 | A & 63, 65535 >= g || 1114112 <= g)) && (g = null);
                                    null === g ? (g = 65533, h = 1) : 65535 < g && (g -= 65536, d += String.fromCharCode(g >>> 10 & 1023 | 55296), g = 56320 | g & 1023);
                                    d += String.fromCharCode(g);
                                    e += h;
                                }
                                this.ga = a;
                                return d;
                            },
                            zp: function (a) {
                                a &= 7;
                                if (a === d.c)
                                    for (; 127 < this.lc[this.ga++];);
                                else if (a === d.b)
                                    this.ga = this.Ma() + this.ga;
                                else if (a === d.a)
                                    this.ga += 4;
                                else if (a === d.f)
                                    this.ga += 8;
                                else
                                    throw Error('Unimplemented type: ' + a);
                            }
                        };
                    },
                    { ieee754: 1 }
                ]
            }, {}, [2])(2);
        }));
        Bj = b.ma;
    }());
    (function () {
        var a = {}, b = { ma: a };
        (function (c) {
            if ('object' === typeof a && 'undefined' !== typeof b)
                b.ma = c();
            else {
                var d;
                'undefined' !== typeof window ? d = window : 'undefined' !== typeof global ? d = global : 'undefined' !== typeof self ? d = self : d = this;
                d.eq = c();
            }
        }(function () {
            return function d(a, b, g) {
                function e(h, l) {
                    if (!b[h]) {
                        if (!a[h]) {
                            var m = 'function' == typeof require && require;
                            if (!l && m)
                                return m(h, !0);
                            if (f)
                                return f(h, !0);
                            m = Error('Cannot find module \'' + h + '\'');
                            throw m.code = 'MODULE_NOT_FOUND', m;
                        }
                        m = b[h] = { ma: {} };
                        a[h][0].call(m.ma, function (b) {
                            var d = a[h][1][b];
                            return e(d ? d : b);
                        }, m, m.ma, d, a, b, g);
                    }
                    return b[h].ma;
                }
                for (var f = 'function' == typeof require && require, m = 0; m < g.length; m++)
                    e(g[m]);
                return e;
            }({
                1: [
                    function (a, b) {
                        function d(a, b) {
                            this.x = a;
                            this.y = b;
                        }
                        b.ma = d;
                        d.prototype = {
                            clone: function () {
                                return new d(this.x, this.y);
                            },
                            add: function (a) {
                                return this.clone().Ej(a);
                            },
                            rotate: function (a) {
                                return this.clone().Oj(a);
                            },
                            round: function () {
                                return this.clone().Pj();
                            },
                            angle: function () {
                                return Math.atan2(this.y, this.x);
                            },
                            Ej: function (a) {
                                this.x += a.x;
                                this.y += a.y;
                                return this;
                            },
                            Oj: function (a) {
                                var b = Math.cos(a);
                                a = Math.sin(a);
                                var d = a * this.x + b * this.y;
                                this.x = b * this.x - a * this.y;
                                this.y = d;
                                return this;
                            },
                            Pj: function () {
                                this.x = Math.round(this.x);
                                this.y = Math.round(this.y);
                                return this;
                            }
                        };
                        d.b = function (a) {
                            return a instanceof d ? a : Array.isArray(a) ? new d(a[0], a[1]) : a;
                        };
                    },
                    {}
                ],
                2: [
                    function (a, b) {
                        b.ma.Dj = a('./lib/vectortile.js');
                        b.ma.Yp = a('./lib/vectortilefeature.js');
                        b.ma.Zp = a('./lib/vectortilelayer.js');
                    },
                    {
                        './lib/vectortile.js': 3,
                        './lib/vectortilefeature.js': 4,
                        './lib/vectortilelayer.js': 5
                    }
                ],
                3: [
                    function (a, b) {
                        function d(a, b, d) {
                            3 === a && (a = new e(d, d.Ma() + d.ga), a.length && (b[a.name] = a));
                        }
                        var e = a('./vectortilelayer');
                        b.ma = function (a, b) {
                            this.layers = a.mg(d, {}, b);
                        };
                    },
                    { './vectortilelayer': 5 }
                ],
                4: [
                    function (a, b) {
                        function d(a, b, d, f, g) {
                            this.properties = {};
                            this.extent = d;
                            this.type = 0;
                            this.Cc = a;
                            this.tf = -1;
                            this.ie = f;
                            this.ke = g;
                            a.mg(e, this, b);
                        }
                        function e(a, b, d) {
                            if (1 == a)
                                b.id = d.Ma();
                            else if (2 == a)
                                for (a = d.Ma() + d.ga; d.ga < a;) {
                                    var e = b.ie[d.Ma()], f = b.ke[d.Ma()];
                                    b.properties[e] = f;
                                }
                            else
                                3 == a ? b.type = d.Ma() : 4 == a && (b.tf = d.ga);
                        }
                        var h = a('point-geometry');
                        b.ma = d;
                        d.b = [
                            'Unknown',
                            'Point',
                            'LineString',
                            'Polygon'
                        ];
                        d.prototype.Ah = function () {
                            var a = this.Cc;
                            a.ga = this.tf;
                            for (var b = a.Ma() + a.ga, d = 1, e = 0, f = 0, g = 0, v = [], x; a.ga < b;)
                                if (e || (e = a.Ma(), d = e & 7, e >>= 3), e--, 1 === d || 2 === d)
                                    f += a.Yd(), g += a.Yd(), 1 === d && (x && v.push(x), x = []), x.push(new h(f, g));
                                else if (7 === d)
                                    x && x.push(x[0].clone());
                                else
                                    throw Error('unknown command ' + d);
                            x && v.push(x);
                            return v;
                        };
                        d.prototype.bbox = function () {
                            var a = this.Cc;
                            a.ga = this.tf;
                            for (var b = a.Ma() + a.ga, d = 1, e = 0, f = 0, g = 0, h = Infinity, x = -Infinity, y = Infinity, z = -Infinity; a.ga < b;)
                                if (e || (e = a.Ma(), d = e & 7, e >>= 3), e--, 1 === d || 2 === d)
                                    f += a.Yd(), g += a.Yd(), f < h && (h = f), f > x && (x = f), g < y && (y = g), g > z && (z = g);
                                else if (7 !== d)
                                    throw Error('unknown command ' + d);
                            return [
                                h,
                                y,
                                x,
                                z
                            ];
                        };
                    },
                    { 'point-geometry': 1 }
                ],
                5: [
                    function (a, b) {
                        function d(a, b) {
                            this.version = 1;
                            this.name = null;
                            this.extent = 4096;
                            this.length = 0;
                            this.Cc = a;
                            this.ie = [];
                            this.ke = [];
                            this.he = [];
                            a.mg(e, this, b);
                            this.length = this.he.length;
                        }
                        function e(a, b, d) {
                            15 === a ? b.version = d.Ma() : 1 === a ? b.name = d.sg() : 5 === a ? b.extent = d.Ma() : 2 === a ? b.he.push(d.ga) : 3 === a ? b.ie.push(d.sg()) : 4 === a && b.ke.push(h(d));
                        }
                        function h(a) {
                            for (var b = null, d = a.Ma() + a.ga; a.ga < d;)
                                b = a.Ma() >> 3, b = 1 === b ? a.sg() : 2 === b ? a.No() : 3 === b ? a.Jo() : 4 === b ? a.Zo() : 5 === b ? a.Ma() : 6 === b ? a.Yd() : 7 === b ? a.Ho() : null;
                            return b;
                        }
                        var l = a('./vectortilefeature.js');
                        b.ma = d;
                        d.prototype.feature = function (a) {
                            if (0 > a || a >= this.he.length)
                                throw Error('feature index out of bounds');
                            this.Cc.ga = this.he[a];
                            a = this.Cc.Ma() + this.Cc.ga;
                            return new l(this.Cc, a, this.extent, this.ie, this.ke);
                        };
                    },
                    { './vectortilefeature.js': 4 }
                ]
            }, {}, [2])(2);
        }));
        Cj = b.ma;
    }());
    function Yp(a, b, c, d) {
        this.f = a;
        this.b = b;
        this.i = c;
        this.c = d;
    }
    k = Yp.prototype;
    k.get = function (a) {
        return this.c[a];
    };
    k.Rb = function () {
        return this.i;
    };
    k.D = function () {
        this.a || (this.a = 'Point' === this.f ? Wa(this.b) : Xa(this.b, 0, this.b.length, 2));
        return this.a;
    };
    k.fc = function () {
        return this.b;
    };
    k.ha = Yp.prototype.fc;
    k.U = function () {
        return this;
    };
    k.mn = function () {
        return this.c;
    };
    k.Qd = Yp.prototype.U;
    k.sa = function () {
        return 2;
    };
    k.Nc = na;
    k.T = function () {
        return this.f;
    };
    function Zp(a) {
        Cl.call(this);
        a = a ? a : {};
        this.defaultDataProjection = new yb({
            code: '',
            units: 'tile-pixels'
        });
        this.b = a.featureClass ? a.featureClass : Yp;
        this.f = a.geometryName;
        this.a = a.layerName ? a.layerName : 'layer';
        this.c = a.layers ? a.layers : null;
    }
    u(Zp, Cl);
    k = Zp.prototype;
    k.T = function () {
        return 'arraybuffer';
    };
    k.Qa = function (a, b) {
        var c = this.c, d = new Bj(a), d = new Cj.Dj(d), e = [], f = this.b, g, h, l;
        for (l in d.layers)
            if (!c || -1 != c.indexOf(l)) {
                g = d.layers[l];
                for (var m = 0, p = g.length; m < p; ++m) {
                    if (f === Yp) {
                        h = void 0;
                        var n = g.feature(m), q = l, r = n.Ah(), v = [], x = [];
                        $p(r, x, v);
                        var y = n.type;
                        1 === y ? h = 1 === r.length ? 'Point' : 'MultiPoint' : 2 === y ? h = 1 === r.length ? 'LineString' : 'MultiLineString' : 3 === y && (h = 'Polygon');
                        n = n.properties;
                        n[this.a] = q;
                        h = new this.b(h, x, v, n);
                    } else {
                        y = g.feature(m);
                        n = l;
                        x = b;
                        h = new this.b();
                        q = y.id;
                        v = y.properties;
                        v[this.a] = n;
                        this.f && h.Vc(this.f);
                        n = void 0;
                        r = y.type;
                        if (0 === r)
                            n = null;
                        else {
                            var y = y.Ah(), z = [], A = [];
                            $p(y, A, z);
                            1 === r ? n = 1 === y.length ? new E(null) : new O(null) : 2 === r ? 1 === y.length ? n = new M(null) : n = new N(null) : 3 === r && (n = new F(null));
                            n.ca('XY', A, z);
                        }
                        x = Fl(n, !1, El(this, x));
                        h.Sa(x);
                        h.kc(q);
                        h.H(v);
                    }
                    e.push(h);
                }
            }
        return e;
    };
    k.kb = function () {
        return this.defaultDataProjection;
    };
    k.Hm = function (a) {
        this.c = a;
    };
    function $p(a, b, c) {
        for (var d = 0, e = 0, f = a.length; e < f; ++e) {
            var g = a[e], h, l;
            h = 0;
            for (l = g.length; h < l; ++h) {
                var m = g[h];
                b.push(m.x, m.y);
            }
            d += 2 * h;
            c.push(d);
        }
    }
    k.Ub = function () {
    };
    k.Tc = function () {
    };
    k.yd = function () {
    };
    k.bd = function () {
    };
    k.Xb = function () {
    };
    function aq() {
        zm.call(this);
        this.defaultDataProjection = Gb('EPSG:4326');
    }
    u(aq, zm);
    function bq(a, b) {
        b[b.length - 1].ae[a.getAttribute('k')] = a.getAttribute('v');
    }
    var cq = [null], dq = K(cq, {
            nd: function (a, b) {
                b[b.length - 1].md.push(a.getAttribute('ref'));
            },
            tag: bq
        }), fq = K(cq, {
            node: function (a, b) {
                var c = b[0], d = b[b.length - 1], e = a.getAttribute('id'), f = [
                        parseFloat(a.getAttribute('lon')),
                        parseFloat(a.getAttribute('lat'))
                    ];
                d.Eh[e] = f;
                var g = L({ ae: {} }, eq, a, b);
                sb(g.ae) || (f = new E(f), Fl(f, !1, c), c = new H(f), c.kc(e), c.H(g.ae), d.features.push(c));
            },
            way: function (a, b) {
                for (var c = b[0], d = a.getAttribute('id'), e = L({
                            md: [],
                            ae: {}
                        }, dq, a, b), f = b[b.length - 1], g = [], h = 0, l = e.md.length; h < l; h++)
                    ga(g, f.Eh[e.md[h]]);
                e.md[0] == e.md[e.md.length - 1] ? (h = new F(null), h.ca('XY', g, [g.length])) : (h = new M(null), h.ca('XY', g));
                Fl(h, !1, c);
                c = new H(h);
                c.kc(d);
                c.H(e.ae);
                f.features.push(c);
            }
        }), eq = K(cq, { tag: bq });
    aq.prototype.yc = function (a, b) {
        var c = Dl(this, a, b);
        return 'osm' == a.localName && (c = L({
            Eh: {},
            features: []
        }, fq, a, [c]), c.features) ? c.features : [];
    };
    aq.prototype.Fg = function () {
    };
    aq.prototype.Yb = function () {
    };
    aq.prototype.de = function () {
    };
    function gq(a) {
        return a.getAttributeNS('http://www.w3.org/1999/xlink', 'href');
    }
    function hq() {
    }
    hq.prototype.read = function (a) {
        return ll(a) ? this.a(a) : ml(a) ? this.b(a) : 'string' === typeof a ? (a = nl(a), this.a(a)) : null;
    };
    function iq() {
    }
    u(iq, hq);
    iq.prototype.a = function (a) {
        for (a = a.firstChild; a; a = a.nextSibling)
            if (a.nodeType == Node.ELEMENT_NODE)
                return this.b(a);
        return null;
    };
    iq.prototype.b = function (a) {
        return (a = L({}, jq, a, [])) ? a : null;
    };
    var kq = [
            null,
            'http://www.opengis.net/ows/1.1'
        ], jq = K(kq, {
            ServiceIdentification: I(function (a, b) {
                return L({}, mq, a, b);
            }),
            ServiceProvider: I(function (a, b) {
                return L({}, nq, a, b);
            }),
            OperationsMetadata: I(function (a, b) {
                return L({}, oq, a, b);
            })
        }), pq = K(kq, {
            DeliveryPoint: I(Q),
            City: I(Q),
            AdministrativeArea: I(Q),
            PostalCode: I(Q),
            Country: I(Q),
            ElectronicMailAddress: I(Q)
        }), qq = K(kq, {
            Value: sl(function (a) {
                return Q(a);
            })
        }), rq = K(kq, {
            AllowedValues: I(function (a, b) {
                return L({}, qq, a, b);
            })
        }), tq = K(kq, {
            Phone: I(function (a, b) {
                return L({}, sq, a, b);
            }),
            Address: I(function (a, b) {
                return L({}, pq, a, b);
            })
        }), vq = K(kq, {
            HTTP: I(function (a, b) {
                return L({}, uq, a, b);
            })
        }), uq = K(kq, {
            Get: sl(function (a, b) {
                var c = gq(a);
                if (c)
                    return L({ href: c }, wq, a, b);
            }),
            Post: void 0
        }), xq = K(kq, {
            DCP: I(function (a, b) {
                return L({}, vq, a, b);
            })
        }), oq = K(kq, {
            Operation: function (a, b) {
                var c = a.getAttribute('name'), d = L({}, xq, a, b);
                d && (b[b.length - 1][c] = d);
            }
        }), sq = K(kq, {
            Voice: I(Q),
            Facsimile: I(Q)
        }), wq = K(kq, {
            Constraint: sl(function (a, b) {
                var c = a.getAttribute('name');
                if (c)
                    return L({ name: c }, rq, a, b);
            })
        }), yq = K(kq, {
            IndividualName: I(Q),
            PositionName: I(Q),
            ContactInfo: I(function (a, b) {
                return L({}, tq, a, b);
            })
        }), mq = K(kq, {
            Title: I(Q),
            ServiceTypeVersion: I(Q),
            ServiceType: I(Q)
        }), nq = K(kq, {
            ProviderName: I(Q),
            ProviderSite: I(gq),
            ServiceContact: I(function (a, b) {
                return L({}, yq, a, b);
            })
        });
    function zq(a, b, c, d) {
        var e;
        void 0 !== d ? e = d : e = [];
        for (var f = d = 0; f < b;) {
            var g = a[f++];
            e[d++] = a[f++];
            e[d++] = g;
            for (g = 2; g < c; ++g)
                e[d++] = a[f++];
        }
        e.length = d;
    }
    function Aq(a) {
        a = a ? a : {};
        Cl.call(this);
        this.defaultDataProjection = Gb('EPSG:4326');
        this.b = a.factor ? a.factor : 100000;
        this.a = a.geometryLayout ? a.geometryLayout : 'XY';
    }
    u(Aq, In);
    function Bq(a, b, c) {
        var d, e = Array(b);
        for (d = 0; d < b; ++d)
            e[d] = 0;
        var f, g;
        f = 0;
        for (g = a.length; f < g;)
            for (d = 0; d < b; ++d, ++f) {
                var h = a[f], l = h - e[d];
                e[d] = h;
                a[f] = l;
            }
        return Cq(a, c ? c : 100000);
    }
    function Dq(a, b, c) {
        var d, e = Array(b);
        for (d = 0; d < b; ++d)
            e[d] = 0;
        a = Eq(a, c ? c : 100000);
        var f;
        c = 0;
        for (f = a.length; c < f;)
            for (d = 0; d < b; ++d, ++c)
                e[d] += a[c], a[c] = e[d];
        return a;
    }
    function Cq(a, b) {
        var c = b ? b : 100000, d, e;
        d = 0;
        for (e = a.length; d < e; ++d)
            a[d] = Math.round(a[d] * c);
        c = 0;
        for (d = a.length; c < d; ++c)
            e = a[c], a[c] = 0 > e ? ~(e << 1) : e << 1;
        c = '';
        d = 0;
        for (e = a.length; d < e; ++d) {
            for (var f, g = a[d], h = ''; 32 <= g;)
                f = (32 | g & 31) + 63, h += String.fromCharCode(f), g >>= 5;
            h += String.fromCharCode(g + 63);
            c += h;
        }
        return c;
    }
    function Eq(a, b) {
        var c = b ? b : 100000, d = [], e = 0, f = 0, g, h;
        g = 0;
        for (h = a.length; g < h; ++g) {
            var l = a.charCodeAt(g) - 63, e = e | (l & 31) << f;
            32 > l ? (d.push(e), f = e = 0) : f += 5;
        }
        e = 0;
        for (f = d.length; e < f; ++e)
            g = d[e], d[e] = g & 1 ? ~(g >> 1) : g >> 1;
        e = 0;
        for (f = d.length; e < f; ++e)
            d[e] /= c;
        return d;
    }
    k = Aq.prototype;
    k.Wd = function (a, b) {
        var c = this.ud(a, b);
        return new H(c);
    };
    k.lg = function (a, b) {
        return [this.Wd(a, b)];
    };
    k.ud = function (a, b) {
        var c = gf(this.a), d = Dq(a, c, this.b);
        zq(d, d.length, c, d);
        c = uf(d, 0, d.length, c);
        return Fl(new M(c, this.a), !1, El(this, b));
    };
    k.be = function (a, b) {
        var c = a.U();
        if (c)
            return this.Ad(c, b);
        qa(!1, 40);
        return '';
    };
    k.Gg = function (a, b) {
        return this.be(a[0], b);
    };
    k.Ad = function (a, b) {
        a = Fl(a, !0, El(this, b));
        var c = a.ha(), d = a.sa();
        zq(c, c.length, d, c);
        return Bq(c, d, this.b);
    };
    function Fq(a) {
        a = a ? a : {};
        Cl.call(this);
        this.defaultDataProjection = Gb(a.defaultDataProjection ? a.defaultDataProjection : 'EPSG:4326');
    }
    u(Fq, Gl);
    function Gq(a, b) {
        var c = [], d, e, f, g;
        f = 0;
        for (g = a.length; f < g; ++f)
            d = a[f], 0 < f && c.pop(), 0 <= d ? e = b[d] : e = b[~d].slice().reverse(), c.push.apply(c, e);
        d = 0;
        for (e = c.length; d < e; ++d)
            c[d] = c[d].slice();
        return c;
    }
    function Hq(a, b, c, d, e) {
        a = a.geometries;
        var f = [], g, h;
        g = 0;
        for (h = a.length; g < h; ++g)
            f[g] = Iq(a[g], b, c, d, e);
        return f;
    }
    function Iq(a, b, c, d, e) {
        var f = a.type, g = Jq[f];
        b = 'Point' === f || 'MultiPoint' === f ? g(a, c, d) : g(a, b);
        c = new H();
        c.Sa(Fl(b, !1, e));
        void 0 !== a.id && c.kc(a.id);
        a.properties && c.H(a.properties);
        return c;
    }
    Fq.prototype.kg = function (a, b) {
        if ('Topology' == a.type) {
            var c, d = null, e = null;
            a.transform && (c = a.transform, d = c.scale, e = c.translate);
            var f = a.arcs;
            if (c) {
                c = d;
                var g = e, h, l;
                h = 0;
                for (l = f.length; h < l; ++h) {
                    var m, p, n, q = f[h], r = c, v = g, x = 0, y = 0;
                    p = 0;
                    for (m = q.length; p < m; ++p)
                        n = q[p], x += n[0], y += n[1], n[0] = x, n[1] = y, Kq(n, r, v);
                }
            }
            c = [];
            g = rb(a.objects);
            h = 0;
            for (l = g.length; h < l; ++h)
                'GeometryCollection' === g[h].type ? (m = g[h], c.push.apply(c, Hq(m, f, d, e, b))) : (m = g[h], c.push(Iq(m, f, d, e, b)));
            return c;
        }
        return [];
    };
    function Kq(a, b, c) {
        a[0] = a[0] * b[0] + c[0];
        a[1] = a[1] * b[1] + c[1];
    }
    Fq.prototype.rg = function () {
        return this.defaultDataProjection;
    };
    var Jq = {
        Point: function (a, b, c) {
            a = a.coordinates;
            b && c && Kq(a, b, c);
            return new E(a);
        },
        LineString: function (a, b) {
            var c = Gq(a.arcs, b);
            return new M(c);
        },
        Polygon: function (a, b) {
            var c = [], d, e;
            d = 0;
            for (e = a.arcs.length; d < e; ++d)
                c[d] = Gq(a.arcs[d], b);
            return new F(c);
        },
        MultiPoint: function (a, b, c) {
            a = a.coordinates;
            var d, e;
            if (b && c)
                for (d = 0, e = a.length; d < e; ++d)
                    Kq(a[d], b, c);
            return new O(a);
        },
        MultiLineString: function (a, b) {
            var c = [], d, e;
            d = 0;
            for (e = a.arcs.length; d < e; ++d)
                c[d] = Gq(a.arcs[d], b);
            return new N(c);
        },
        MultiPolygon: function (a, b) {
            var c = [], d, e, f, g, h, l;
            h = 0;
            for (l = a.arcs.length; h < l; ++h) {
                d = a.arcs[h];
                e = [];
                f = 0;
                for (g = d.length; f < g; ++f)
                    e[f] = Gq(d[f], b);
                c[h] = e;
            }
            return new P(c);
        }
    };
    k = Fq.prototype;
    k.ad = function () {
    };
    k.ce = function () {
    };
    k.ee = function () {
    };
    k.og = function () {
    };
    k.Sc = function () {
    };
    function Lq(a) {
        a = a ? a : {};
        this.i = a.featureType;
        this.a = a.featureNS;
        this.b = a.gmlFormat ? a.gmlFormat : new Pm();
        this.c = a.schemaLocation ? a.schemaLocation : 'http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd';
        zm.call(this);
    }
    u(Lq, zm);
    Lq.prototype.yc = function (a, b) {
        var c = {
            featureType: this.i,
            featureNS: this.a
        };
        pb(c, Dl(this, a, b ? b : {}));
        c = [c];
        this.b.b['http://www.opengis.net/gml'].featureMember = ql(Cm.prototype.Xd);
        (c = L([], this.b.b, a, c, this.b)) || (c = []);
        return c;
    };
    Lq.prototype.j = function (a) {
        if (ll(a))
            return Mq(a);
        if (ml(a))
            return L({}, Nq, a, []);
        if ('string' === typeof a)
            return a = nl(a), Mq(a);
    };
    Lq.prototype.l = function (a) {
        if (ll(a))
            return Oq(this, a);
        if (ml(a))
            return Pq(this, a);
        if ('string' === typeof a)
            return a = nl(a), Oq(this, a);
    };
    function Oq(a, b) {
        for (var c = b.firstChild; c; c = c.nextSibling)
            if (c.nodeType == Node.ELEMENT_NODE)
                return Pq(a, c);
    }
    var Qq = { 'http://www.opengis.net/gml': { boundedBy: I(Cm.prototype.We, 'bounds') } };
    function Pq(a, b) {
        var c = {}, d = Km(b.getAttribute('numberOfFeatures'));
        c.numberOfFeatures = d;
        return L(c, Qq, b, [], a.b);
    }
    var Rq = {
            'http://www.opengis.net/wfs': {
                totalInserted: I(Jm),
                totalUpdated: I(Jm),
                totalDeleted: I(Jm)
            }
        }, Sq = {
            'http://www.opengis.net/ogc': {
                FeatureId: ql(function (a) {
                    return a.getAttribute('fid');
                })
            }
        }, Tq = {
            'http://www.opengis.net/wfs': {
                Feature: function (a, b) {
                    yl(Sq, a, b);
                }
            }
        }, Nq = {
            'http://www.opengis.net/wfs': {
                TransactionSummary: I(function (a, b) {
                    return L({}, Rq, a, b);
                }, 'transactionSummary'),
                InsertResults: I(function (a, b) {
                    return L([], Tq, a, b);
                }, 'insertIds')
            }
        };
    function Mq(a) {
        for (a = a.firstChild; a; a = a.nextSibling)
            if (a.nodeType == Node.ELEMENT_NODE)
                return L({}, Nq, a, []);
    }
    var Uq = { 'http://www.opengis.net/wfs': { PropertyName: J(Mm) } };
    function Vq(a, b) {
        var c = il('http://www.opengis.net/ogc', 'Filter'), d = il('http://www.opengis.net/ogc', 'FeatureId');
        c.appendChild(d);
        d.setAttribute('fid', b);
        a.appendChild(c);
    }
    var Wq = {
        'http://www.opengis.net/wfs': {
            Insert: J(function (a, b, c) {
                var d = c[c.length - 1], d = il(d.featureNS, d.featureType);
                a.appendChild(d);
                Pm.prototype.cj(d, b, c);
            }),
            Update: J(function (a, b, c) {
                var d = c[c.length - 1];
                qa(void 0 !== b.a, 27);
                var e = d.featureType, f = d.featurePrefix, f = f ? f : 'feature', g = d.featureNS;
                a.setAttribute('typeName', f + ':' + e);
                a.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns:' + f, g);
                e = b.a;
                if (void 0 !== e) {
                    for (var f = b.O(), g = [], h = 0, l = f.length; h < l; h++) {
                        var m = b.get(f[h]);
                        void 0 !== m && g.push({
                            name: f[h],
                            value: m
                        });
                    }
                    zl({
                        node: a,
                        srsName: d.srsName
                    }, Wq, ul('Property'), g, c);
                    Vq(a, e);
                }
            }),
            Delete: J(function (a, b, c) {
                var d = c[c.length - 1];
                qa(void 0 !== b.a, 26);
                c = d.featureType;
                var e = d.featurePrefix, e = e ? e : 'feature', d = d.featureNS;
                a.setAttribute('typeName', e + ':' + c);
                a.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns:' + e, d);
                b = b.a;
                void 0 !== b && Vq(a, b);
            }),
            Property: J(function (a, b, c) {
                var d = il('http://www.opengis.net/wfs', 'Name');
                a.appendChild(d);
                Mm(d, b.name);
                void 0 !== b.value && null !== b.value && (d = il('http://www.opengis.net/wfs', 'Value'), a.appendChild(d), b.value instanceof cf ? Pm.prototype.zd(d, b.value, c) : Mm(d, b.value));
            }),
            Native: J(function (a, b) {
                b.Hp && a.setAttribute('vendorId', b.Hp);
                void 0 !== b.lp && a.setAttribute('safeToIgnore', b.lp);
                void 0 !== b.value && Mm(a, b.value);
            })
        }
    };
    function Xq(a, b, c) {
        var d = { node: a };
        b.b.forEach(function (a) {
            zl(d, Yq, ul(a.Bc), [a], c);
        });
    }
    function Zq(a, b) {
        void 0 !== b.a && a.setAttribute('matchCase', b.a.toString());
        $q(a, b.b);
        ar(a, '' + b.f);
    }
    function br(a, b, c) {
        a = il('http://www.opengis.net/ogc', a);
        Mm(a, c);
        b.appendChild(a);
    }
    function $q(a, b) {
        br('PropertyName', a, b);
    }
    function ar(a, b) {
        br('Literal', a, b);
    }
    var Yq = {
        'http://www.opengis.net/wfs': {
            Query: J(function (a, b, c) {
                var d = c[c.length - 1], e = d.featurePrefix, f = d.featureNS, g = d.propertyNames, h = d.srsName;
                a.setAttribute('typeName', (e ? e + ':' : '') + b);
                h && a.setAttribute('srsName', h);
                f && a.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns:' + e, f);
                b = pb({}, d);
                b.node = a;
                zl(b, Uq, ul('PropertyName'), g, c);
                if (d = d.filter)
                    g = il('http://www.opengis.net/ogc', 'Filter'), a.appendChild(g), zl({ node: g }, Yq, ul(d.Bc), [d], c);
            })
        },
        'http://www.opengis.net/ogc': {
            And: J(Xq),
            Or: J(Xq),
            Not: J(function (a, b, c) {
                b = b.condition;
                zl({ node: a }, Yq, ul(b.Bc), [b], c);
            }),
            BBOX: J(function (a, b, c) {
                c[c.length - 1].srsName = b.srsName;
                $q(a, b.geometryName);
                Pm.prototype.zd(a, b.extent, c);
            }),
            Intersects: J(function (a, b, c) {
                c[c.length - 1].srsName = b.srsName;
                $q(a, b.geometryName);
                Pm.prototype.zd(a, b.geometry, c);
            }),
            Within: J(function (a, b, c) {
                c[c.length - 1].srsName = b.srsName;
                $q(a, b.geometryName);
                Pm.prototype.zd(a, b.geometry, c);
            }),
            PropertyIsEqualTo: J(Zq),
            PropertyIsNotEqualTo: J(Zq),
            PropertyIsLessThan: J(Zq),
            PropertyIsLessThanOrEqualTo: J(Zq),
            PropertyIsGreaterThan: J(Zq),
            PropertyIsGreaterThanOrEqualTo: J(Zq),
            PropertyIsNull: J(function (a, b) {
                $q(a, b.b);
            }),
            PropertyIsBetween: J(function (a, b) {
                $q(a, b.b);
                var c = il('http://www.opengis.net/ogc', 'LowerBoundary');
                a.appendChild(c);
                ar(c, '' + b.a);
                c = il('http://www.opengis.net/ogc', 'UpperBoundary');
                a.appendChild(c);
                ar(c, '' + b.f);
            }),
            PropertyIsLike: J(function (a, b) {
                a.setAttribute('wildCard', b.g);
                a.setAttribute('singleChar', b.i);
                a.setAttribute('escapeChar', b.f);
                void 0 !== b.a && a.setAttribute('matchCase', b.a.toString());
                $q(a, b.b);
                ar(a, '' + b.c);
            })
        }
    };
    Lq.prototype.o = function (a) {
        var b = il('http://www.opengis.net/wfs', 'GetFeature');
        b.setAttribute('service', 'WFS');
        b.setAttribute('version', '1.1.0');
        var c;
        if (a && (a.handle && b.setAttribute('handle', a.handle), a.outputFormat && b.setAttribute('outputFormat', a.outputFormat), void 0 !== a.maxFeatures && b.setAttribute('maxFeatures', a.maxFeatures), a.resultType && b.setAttribute('resultType', a.resultType), void 0 !== a.startIndex && b.setAttribute('startIndex', a.startIndex), void 0 !== a.count && b.setAttribute('count', a.count), c = a.filter, a.bbox)) {
            qa(a.geometryName, 12);
            var d = pm(a.geometryName, a.bbox, a.srsName);
            c ? c = om(c, d) : c = d;
        }
        b.setAttributeNS('http://www.w3.org/2001/XMLSchema-instance', 'xsi:schemaLocation', this.c);
        c = {
            node: b,
            srsName: a.srsName,
            featureNS: a.featureNS ? a.featureNS : this.a,
            featurePrefix: a.featurePrefix,
            geometryName: a.geometryName,
            filter: c,
            propertyNames: a.propertyNames ? a.propertyNames : []
        };
        qa(Array.isArray(a.featureTypes), 11);
        a = a.featureTypes;
        c = [c];
        d = pb({}, c[c.length - 1]);
        d.node = b;
        zl(d, Yq, ul('Query'), a, c);
        return b;
    };
    Lq.prototype.v = function (a, b, c, d) {
        var e = [], f = il('http://www.opengis.net/wfs', 'Transaction');
        f.setAttribute('service', 'WFS');
        f.setAttribute('version', '1.1.0');
        var g, h;
        d && (g = d.gmlOptions ? d.gmlOptions : {}, d.handle && f.setAttribute('handle', d.handle));
        f.setAttributeNS('http://www.w3.org/2001/XMLSchema-instance', 'xsi:schemaLocation', this.c);
        a && (h = {
            node: f,
            featureNS: d.featureNS,
            featureType: d.featureType,
            featurePrefix: d.featurePrefix,
            srsName: d.srsName
        }, pb(h, g), zl(h, Wq, ul('Insert'), a, e));
        b && (h = {
            node: f,
            featureNS: d.featureNS,
            featureType: d.featureType,
            featurePrefix: d.featurePrefix,
            srsName: d.srsName
        }, pb(h, g), zl(h, Wq, ul('Update'), b, e));
        c && zl({
            node: f,
            featureNS: d.featureNS,
            featureType: d.featureType,
            featurePrefix: d.featurePrefix,
            srsName: d.srsName
        }, Wq, ul('Delete'), c, e);
        d.nativeElements && zl({
            node: f,
            featureNS: d.featureNS,
            featureType: d.featureType,
            featurePrefix: d.featurePrefix,
            srsName: d.srsName
        }, Wq, ul('Native'), d.nativeElements, e);
        return f;
    };
    Lq.prototype.qg = function (a) {
        for (a = a.firstChild; a; a = a.nextSibling)
            if (a.nodeType == Node.ELEMENT_NODE)
                return this.Ze(a);
        return null;
    };
    Lq.prototype.Ze = function (a) {
        if (a.firstElementChild && a.firstElementChild.firstElementChild)
            for (a = a.firstElementChild.firstElementChild, a = a.firstElementChild; a; a = a.nextElementSibling)
                if (0 !== a.childNodes.length && (1 !== a.childNodes.length || 3 !== a.firstChild.nodeType)) {
                    var b = [{}];
                    this.b.We(a, b);
                    return Gb(b.pop().srsName);
                }
        return null;
    };
    function cr(a) {
        a = a ? a : {};
        Cl.call(this);
        this.b = void 0 !== a.splitCollection ? a.splitCollection : !1;
    }
    u(cr, In);
    function dr(a) {
        a = a.X();
        return a.length ? a.join(' ') : '';
    }
    function er(a) {
        a = a.X();
        for (var b = [], c = 0, d = a.length; c < d; ++c)
            b.push(a[c].join(' '));
        return b.join(',');
    }
    function fr(a) {
        var b = [];
        a = a.jd();
        for (var c = 0, d = a.length; c < d; ++c)
            b.push('(' + er(a[c]) + ')');
        return b.join(',');
    }
    function gr(a) {
        var b = a.T(), c = (0, hr[b])(a), b = b.toUpperCase();
        if (a instanceof ff) {
            a = a.ka;
            var d = '';
            if ('XYZ' === a || 'XYZM' === a)
                d += 'Z';
            if ('XYM' === a || 'XYZM' === a)
                d += 'M';
            a = d;
            0 < a.length && (b += ' ' + a);
        }
        return c.length ? b + '(' + c + ')' : b + ' EMPTY';
    }
    var hr = {
        Point: dr,
        LineString: er,
        Polygon: fr,
        MultiPoint: function (a) {
            var b = [];
            a = a.Ie();
            for (var c = 0, d = a.length; c < d; ++c)
                b.push('(' + dr(a[c]) + ')');
            return b.join(',');
        },
        MultiLineString: function (a) {
            var b = [];
            a = a.hd();
            for (var c = 0, d = a.length; c < d; ++c)
                b.push('(' + er(a[c]) + ')');
            return b.join(',');
        },
        MultiPolygon: function (a) {
            var b = [];
            a = a.Od();
            for (var c = 0, d = a.length; c < d; ++c)
                b.push('(' + fr(a[c]) + ')');
            return b.join(',');
        },
        GeometryCollection: function (a) {
            var b = [];
            a = a.If();
            for (var c = 0, d = a.length; c < d; ++c)
                b.push(gr(a[c]));
            return b.join(',');
        }
    };
    k = cr.prototype;
    k.Wd = function (a, b) {
        var c = this.ud(a, b);
        if (c) {
            var d = new H();
            d.Sa(c);
            return d;
        }
        return null;
    };
    k.lg = function (a, b) {
        var c = [], d = this.ud(a, b);
        this.b && 'GeometryCollection' == d.T() ? c = d.a : c = [d];
        for (var e = [], f = 0, g = c.length; f < g; ++f)
            d = new H(), d.Sa(c[f]), e.push(d);
        return e;
    };
    k.ud = function (a, b) {
        var c;
        c = new ir(new jr(a));
        kr(c);
        return (c = lr(c)) ? Fl(c, !1, b) : null;
    };
    k.be = function (a, b) {
        var c = a.U();
        return c ? this.Ad(c, b) : '';
    };
    k.Gg = function (a, b) {
        if (1 == a.length)
            return this.be(a[0], b);
        for (var c = [], d = 0, e = a.length; d < e; ++d)
            c.push(a[d].U());
        c = new qm(c);
        return this.Ad(c, b);
    };
    k.Ad = function (a, b) {
        return gr(Fl(a, !0, b));
    };
    function jr(a) {
        this.a = a;
        this.b = -1;
    }
    function mr(a) {
        var b = a.a.charAt(++a.b), c = {
                position: a.b,
                value: b
            };
        if ('(' == b)
            c.type = 2;
        else if (',' == b)
            c.type = 5;
        else if (')' == b)
            c.type = 3;
        else if ('0' <= b && '9' >= b || '.' == b || '-' == b) {
            c.type = 4;
            var d, b = a.b, e = !1, f = !1;
            do {
                if ('.' == d)
                    e = !0;
                else if ('e' == d || 'E' == d)
                    f = !0;
                d = a.a.charAt(++a.b);
            } while ('0' <= d && '9' >= d || '.' == d && (void 0 === e || !e) || !f && ('e' == d || 'E' == d) || f && ('-' == d || '+' == d));
            a = parseFloat(a.a.substring(b, a.b--));
            c.value = a;
        } else if ('a' <= b && 'z' >= b || 'A' <= b && 'Z' >= b) {
            c.type = 1;
            b = a.b;
            do
                d = a.a.charAt(++a.b);
            while ('a' <= d && 'z' >= d || 'A' <= d && 'Z' >= d);
            a = a.a.substring(b, a.b--).toUpperCase();
            c.value = a;
        } else {
            if (' ' == b || '\t' == b || '\r' == b || '\n' == b)
                return mr(a);
            if ('' === b)
                c.type = 6;
            else
                throw Error('Unexpected character: ' + b);
        }
        return c;
    }
    function ir(a) {
        this.f = a;
        this.a = 'XY';
    }
    function kr(a) {
        a.b = mr(a.f);
    }
    function nr(a, b) {
        var c = a.b.type == b;
        c && kr(a);
        return c;
    }
    function lr(a) {
        var b = a.b;
        if (nr(a, 1)) {
            var b = b.value, c = 'XY', d = a.b;
            1 == a.b.type && (d = d.value, 'Z' === d ? c = 'XYZ' : 'M' === d ? c = 'XYM' : 'ZM' === d && (c = 'XYZM'), 'XY' !== c && kr(a));
            a.a = c;
            if ('GEOMETRYCOLLECTION' == b) {
                a: {
                    if (nr(a, 2)) {
                        b = [];
                        do
                            b.push(lr(a));
                        while (nr(a, 5));
                        if (nr(a, 3)) {
                            a = b;
                            break a;
                        }
                    } else if (or(a)) {
                        a = [];
                        break a;
                    }
                    throw Error(pr(a));
                }
                return new qm(a);
            }
            d = qr[b];
            c = rr[b];
            if (!d || !c)
                throw Error('Invalid geometry type: ' + b);
            b = d.call(a);
            return new c(b, a.a);
        }
        throw Error(pr(a));
    }
    k = ir.prototype;
    k.fg = function () {
        if (nr(this, 2)) {
            var a = sr(this);
            if (nr(this, 3))
                return a;
        } else if (or(this))
            return null;
        throw Error(pr(this));
    };
    k.eg = function () {
        if (nr(this, 2)) {
            var a = tr(this);
            if (nr(this, 3))
                return a;
        } else if (or(this))
            return [];
        throw Error(pr(this));
    };
    k.gg = function () {
        if (nr(this, 2)) {
            var a = ur(this);
            if (nr(this, 3))
                return a;
        } else if (or(this))
            return [];
        throw Error(pr(this));
    };
    k.uo = function () {
        if (nr(this, 2)) {
            var a;
            if (2 == this.b.type)
                for (a = [this.fg()]; nr(this, 5);)
                    a.push(this.fg());
            else
                a = tr(this);
            if (nr(this, 3))
                return a;
        } else if (or(this))
            return [];
        throw Error(pr(this));
    };
    k.to = function () {
        if (nr(this, 2)) {
            var a = ur(this);
            if (nr(this, 3))
                return a;
        } else if (or(this))
            return [];
        throw Error(pr(this));
    };
    k.vo = function () {
        if (nr(this, 2)) {
            for (var a = [this.gg()]; nr(this, 5);)
                a.push(this.gg());
            if (nr(this, 3))
                return a;
        } else if (or(this))
            return [];
        throw Error(pr(this));
    };
    function sr(a) {
        for (var b = [], c = a.a.length, d = 0; d < c; ++d) {
            var e = a.b;
            if (nr(a, 4))
                b.push(e.value);
            else
                break;
        }
        if (b.length == c)
            return b;
        throw Error(pr(a));
    }
    function tr(a) {
        for (var b = [sr(a)]; nr(a, 5);)
            b.push(sr(a));
        return b;
    }
    function ur(a) {
        for (var b = [a.eg()]; nr(a, 5);)
            b.push(a.eg());
        return b;
    }
    function or(a) {
        var b = 1 == a.b.type && 'EMPTY' == a.b.value;
        b && kr(a);
        return b;
    }
    function pr(a) {
        return 'Unexpected `' + a.b.value + '` at position ' + a.b.position + ' in `' + a.f.a + '`';
    }
    var rr = {
            POINT: E,
            LINESTRING: M,
            POLYGON: F,
            MULTIPOINT: O,
            MULTILINESTRING: N,
            MULTIPOLYGON: P
        }, qr = {
            POINT: ir.prototype.fg,
            LINESTRING: ir.prototype.eg,
            POLYGON: ir.prototype.gg,
            MULTIPOINT: ir.prototype.uo,
            MULTILINESTRING: ir.prototype.to,
            MULTIPOLYGON: ir.prototype.vo
        };
    function vr() {
        this.version = void 0;
    }
    u(vr, hq);
    vr.prototype.a = function (a) {
        for (a = a.firstChild; a; a = a.nextSibling)
            if (a.nodeType == Node.ELEMENT_NODE)
                return this.b(a);
        return null;
    };
    vr.prototype.b = function (a) {
        this.version = a.getAttribute('version').trim();
        return (a = L({ version: this.version }, wr, a, [])) ? a : null;
    };
    function xr(a, b) {
        return L({}, yr, a, b);
    }
    function zr(a, b) {
        return L({}, Ar, a, b);
    }
    function Br(a, b) {
        var c = xr(a, b);
        if (c) {
            var d = [
                Km(a.getAttribute('width')),
                Km(a.getAttribute('height'))
            ];
            c.size = d;
            return c;
        }
    }
    function Cr(a, b) {
        return L([], Dr, a, b);
    }
    var Er = [
            null,
            'http://www.opengis.net/wms'
        ], wr = K(Er, {
            Service: I(function (a, b) {
                return L({}, Fr, a, b);
            }),
            Capability: I(function (a, b) {
                return L({}, Gr, a, b);
            })
        }), Gr = K(Er, {
            Request: I(function (a, b) {
                return L({}, Hr, a, b);
            }),
            Exception: I(function (a, b) {
                return L([], Ir, a, b);
            }),
            Layer: I(function (a, b) {
                return L({}, Jr, a, b);
            })
        }), Fr = K(Er, {
            Name: I(Q),
            Title: I(Q),
            Abstract: I(Q),
            KeywordList: I(Cr),
            OnlineResource: I(gq),
            ContactInformation: I(function (a, b) {
                return L({}, Kr, a, b);
            }),
            Fees: I(Q),
            AccessConstraints: I(Q),
            LayerLimit: I(Jm),
            MaxWidth: I(Jm),
            MaxHeight: I(Jm)
        }), Kr = K(Er, {
            ContactPersonPrimary: I(function (a, b) {
                return L({}, Lr, a, b);
            }),
            ContactPosition: I(Q),
            ContactAddress: I(function (a, b) {
                return L({}, Mr, a, b);
            }),
            ContactVoiceTelephone: I(Q),
            ContactFacsimileTelephone: I(Q),
            ContactElectronicMailAddress: I(Q)
        }), Lr = K(Er, {
            ContactPerson: I(Q),
            ContactOrganization: I(Q)
        }), Mr = K(Er, {
            AddressType: I(Q),
            Address: I(Q),
            City: I(Q),
            StateOrProvince: I(Q),
            PostCode: I(Q),
            Country: I(Q)
        }), Ir = K(Er, { Format: ql(Q) }), Jr = K(Er, {
            Name: I(Q),
            Title: I(Q),
            Abstract: I(Q),
            KeywordList: I(Cr),
            CRS: sl(Q),
            EX_GeographicBoundingBox: I(function (a, b) {
                var c = L({}, Nr, a, b);
                if (c) {
                    var d = c.westBoundLongitude, e = c.southBoundLatitude, f = c.eastBoundLongitude, c = c.northBoundLatitude;
                    if (void 0 !== d && void 0 !== e && void 0 !== f && void 0 !== c)
                        return [
                            d,
                            e,
                            f,
                            c
                        ];
                }
            }),
            BoundingBox: sl(function (a) {
                var b = [
                        Im(a.getAttribute('minx')),
                        Im(a.getAttribute('miny')),
                        Im(a.getAttribute('maxx')),
                        Im(a.getAttribute('maxy'))
                    ], c = [
                        Im(a.getAttribute('resx')),
                        Im(a.getAttribute('resy'))
                    ];
                return {
                    crs: a.getAttribute('CRS'),
                    extent: b,
                    res: c
                };
            }),
            Dimension: sl(function (a) {
                return {
                    name: a.getAttribute('name'),
                    units: a.getAttribute('units'),
                    unitSymbol: a.getAttribute('unitSymbol'),
                    'default': a.getAttribute('default'),
                    multipleValues: Fm(a.getAttribute('multipleValues')),
                    nearestValue: Fm(a.getAttribute('nearestValue')),
                    current: Fm(a.getAttribute('current')),
                    values: Q(a)
                };
            }),
            Attribution: I(function (a, b) {
                return L({}, Or, a, b);
            }),
            AuthorityURL: sl(function (a, b) {
                var c = xr(a, b);
                if (c)
                    return c.name = a.getAttribute('name'), c;
            }),
            Identifier: sl(Q),
            MetadataURL: sl(function (a, b) {
                var c = xr(a, b);
                if (c)
                    return c.type = a.getAttribute('type'), c;
            }),
            DataURL: sl(xr),
            FeatureListURL: sl(xr),
            Style: sl(function (a, b) {
                return L({}, Pr, a, b);
            }),
            MinScaleDenominator: I(Hm),
            MaxScaleDenominator: I(Hm),
            Layer: sl(function (a, b) {
                var c = b[b.length - 1], d = L({}, Jr, a, b);
                if (d) {
                    var e = Fm(a.getAttribute('queryable'));
                    void 0 === e && (e = c.queryable);
                    d.queryable = void 0 !== e ? e : !1;
                    e = Km(a.getAttribute('cascaded'));
                    void 0 === e && (e = c.cascaded);
                    d.cascaded = e;
                    e = Fm(a.getAttribute('opaque'));
                    void 0 === e && (e = c.opaque);
                    d.opaque = void 0 !== e ? e : !1;
                    e = Fm(a.getAttribute('noSubsets'));
                    void 0 === e && (e = c.noSubsets);
                    d.noSubsets = void 0 !== e ? e : !1;
                    (e = Im(a.getAttribute('fixedWidth'))) || (e = c.fixedWidth);
                    d.fixedWidth = e;
                    (e = Im(a.getAttribute('fixedHeight'))) || (e = c.fixedHeight);
                    d.fixedHeight = e;
                    [
                        'Style',
                        'CRS',
                        'AuthorityURL'
                    ].forEach(function (a) {
                        a in c && (d[a] = (d[a] || []).concat(c[a]));
                    });
                    'EX_GeographicBoundingBox BoundingBox Dimension Attribution MinScaleDenominator MaxScaleDenominator'.split(' ').forEach(function (a) {
                        a in d || (d[a] = c[a]);
                    });
                    return d;
                }
            })
        }), Or = K(Er, {
            Title: I(Q),
            OnlineResource: I(gq),
            LogoURL: I(Br)
        }), Nr = K(Er, {
            westBoundLongitude: I(Hm),
            eastBoundLongitude: I(Hm),
            southBoundLatitude: I(Hm),
            northBoundLatitude: I(Hm)
        }), Hr = K(Er, {
            GetCapabilities: I(zr),
            GetMap: I(zr),
            GetFeatureInfo: I(zr)
        }), Ar = K(Er, {
            Format: sl(Q),
            DCPType: sl(function (a, b) {
                return L({}, Qr, a, b);
            })
        }), Qr = K(Er, {
            HTTP: I(function (a, b) {
                return L({}, Rr, a, b);
            })
        }), Rr = K(Er, {
            Get: I(xr),
            Post: I(xr)
        }), Pr = K(Er, {
            Name: I(Q),
            Title: I(Q),
            Abstract: I(Q),
            LegendURL: sl(Br),
            StyleSheetURL: I(xr),
            StyleURL: I(xr)
        }), yr = K(Er, {
            Format: I(Q),
            OnlineResource: I(gq)
        }), Dr = K(Er, { Keyword: ql(Q) });
    function Sr(a) {
        a = a ? a : {};
        this.a = 'http://mapserver.gis.umn.edu/mapserver';
        this.b = new Ym();
        this.c = a.layers ? a.layers : null;
        zm.call(this);
    }
    u(Sr, zm);
    Sr.prototype.yc = function (a, b) {
        var c = {};
        b && pb(c, Dl(this, a, b));
        var d = [c];
        a.setAttribute('namespaceURI', this.a);
        var e = a.localName, c = [];
        if (a.childNodes.length) {
            if ('msGMLOutput' == e)
                for (var f = 0, g = a.childNodes.length; f < g; f++) {
                    var h = a.childNodes[f];
                    if (h.nodeType === Node.ELEMENT_NODE) {
                        var l = d[0], m = h.localName.replace('_layer', '');
                        if (!this.c || ea(this.c, m)) {
                            m += '_feature';
                            l.featureType = m;
                            l.featureNS = this.a;
                            var p = {};
                            p[m] = ql(this.b.ig, this.b);
                            l = K([
                                l.featureNS,
                                null
                            ], p);
                            h.setAttribute('namespaceURI', this.a);
                            (h = L([], l, h, d, this.b)) && ga(c, h);
                        }
                    }
                }
            'FeatureCollection' == e && (d = L([], this.b.b, a, [{}], this.b)) && (c = d);
        }
        return c;
    };
    Sr.prototype.Fg = function () {
    };
    Sr.prototype.Yb = function () {
    };
    Sr.prototype.de = function () {
    };
    function Tr() {
        this.f = new iq();
    }
    u(Tr, hq);
    Tr.prototype.a = function (a) {
        for (a = a.firstChild; a; a = a.nextSibling)
            if (a.nodeType == Node.ELEMENT_NODE)
                return this.b(a);
        return null;
    };
    Tr.prototype.b = function (a) {
        var b = a.getAttribute('version').trim(), c = this.f.b(a);
        if (!c)
            return null;
        c.version = b;
        return (c = L(c, Ur, a, [])) ? c : null;
    };
    function Vr(a) {
        var b = Q(a).split(' ');
        if (b && 2 == b.length && (a = +b[0], b = +b[1], !isNaN(a) && !isNaN(b)))
            return [
                a,
                b
            ];
    }
    var Wr = [
            null,
            'http://www.opengis.net/wmts/1.0'
        ], Xr = [
            null,
            'http://www.opengis.net/ows/1.1'
        ], Ur = K(Wr, {
            Contents: I(function (a, b) {
                return L({}, Yr, a, b);
            })
        }), Yr = K(Wr, {
            Layer: sl(function (a, b) {
                return L({}, Zr, a, b);
            }),
            TileMatrixSet: sl(function (a, b) {
                return L({}, $r, a, b);
            })
        }), Zr = K(Wr, {
            Style: sl(function (a, b) {
                var c = L({}, as, a, b);
                if (c) {
                    var d = 'true' === a.getAttribute('isDefault');
                    c.isDefault = d;
                    return c;
                }
            }),
            Format: sl(Q),
            TileMatrixSetLink: sl(function (a, b) {
                return L({}, bs, a, b);
            }),
            Dimension: sl(function (a, b) {
                return L({}, cs, a, b);
            }),
            ResourceURL: sl(function (a) {
                var b = a.getAttribute('format'), c = a.getAttribute('template');
                a = a.getAttribute('resourceType');
                var d = {};
                b && (d.format = b);
                c && (d.template = c);
                a && (d.resourceType = a);
                return d;
            })
        }, K(Xr, {
            Title: I(Q),
            Abstract: I(Q),
            WGS84BoundingBox: I(function (a, b) {
                var c = L([], ds, a, b);
                if (2 == c.length)
                    return Ha(c);
            }),
            Identifier: I(Q)
        })), as = K(Wr, {
            LegendURL: sl(function (a) {
                var b = {};
                b.format = a.getAttribute('format');
                b.href = gq(a);
                return b;
            })
        }, K(Xr, {
            Title: I(Q),
            Identifier: I(Q)
        })), bs = K(Wr, {
            TileMatrixSet: I(Q),
            TileMatrixSetLimits: I(function (a, b) {
                return L([], es, a, b);
            })
        }), es = K(Wr, {
            TileMatrixLimits: ql(function (a, b) {
                return L({}, fs, a, b);
            })
        }), fs = K(Wr, {
            TileMatrix: I(Q),
            MinTileRow: I(Jm),
            MaxTileRow: I(Jm),
            MinTileCol: I(Jm),
            MaxTileCol: I(Jm)
        }), cs = K(Wr, {
            Default: I(Q),
            Value: sl(Q)
        }, K(Xr, { Identifier: I(Q) })), ds = K(Xr, {
            LowerCorner: ql(Vr),
            UpperCorner: ql(Vr)
        }), $r = K(Wr, {
            WellKnownScaleSet: I(Q),
            TileMatrix: sl(function (a, b) {
                return L({}, gs, a, b);
            })
        }, K(Xr, {
            SupportedCRS: I(Q),
            Identifier: I(Q)
        })), gs = K(Wr, {
            TopLeftCorner: I(Vr),
            ScaleDenominator: I(Hm),
            TileWidth: I(Jm),
            TileHeight: I(Jm),
            MatrixWidth: I(Jm),
            MatrixHeight: I(Jm)
        }, K(Xr, { Identifier: I(Q) }));
    function hs(a) {
        Gc.call(this);
        a = a || {};
        this.a = null;
        this.i = Vb;
        this.c = void 0;
        B(this, Ic('projection'), this.hm, this);
        B(this, Ic('tracking'), this.im, this);
        void 0 !== a.projection && this.Ih(Gb(a.projection));
        void 0 !== a.trackingOptions && this.Si(a.trackingOptions);
        this.Ee(void 0 !== a.tracking ? a.tracking : !1);
    }
    u(hs, Gc);
    k = hs.prototype;
    k.ra = function () {
        this.Ee(!1);
        Gc.prototype.ra.call(this);
    };
    k.hm = function () {
        var a = this.Gh();
        a && (this.i = Fb(Gb('EPSG:4326'), a), this.a && this.set('position', this.i(this.a)));
    };
    k.im = function () {
        if (Od) {
            var a = this.Hh();
            a && void 0 === this.c ? this.c = navigator.geolocation.watchPosition(this.Co.bind(this), this.Do.bind(this), this.th()) : a || void 0 === this.c || (navigator.geolocation.clearWatch(this.c), this.c = void 0);
        }
    };
    k.Co = function (a) {
        a = a.coords;
        this.set('accuracy', a.accuracy);
        this.set('altitude', null === a.altitude ? void 0 : a.altitude);
        this.set('altitudeAccuracy', null === a.altitudeAccuracy ? void 0 : a.altitudeAccuracy);
        this.set('heading', null === a.heading ? void 0 : Ba(a.heading));
        this.a ? (this.a[0] = a.longitude, this.a[1] = a.latitude) : this.a = [
            a.longitude,
            a.latitude
        ];
        var b = this.i(this.a);
        this.set('position', b);
        this.set('speed', null === a.speed ? void 0 : a.speed);
        a = Mf(mh, this.a, a.accuracy);
        a.Dc(this.i);
        this.set('accuracyGeometry', a);
        this.s();
    };
    k.Do = function (a) {
        a.type = 'error';
        this.Ee(!1);
        this.b(a);
    };
    k.hk = function () {
        return this.get('accuracy');
    };
    k.ik = function () {
        return this.get('accuracyGeometry') || null;
    };
    k.kk = function () {
        return this.get('altitude');
    };
    k.lk = function () {
        return this.get('altitudeAccuracy');
    };
    k.fm = function () {
        return this.get('heading');
    };
    k.gm = function () {
        return this.get('position');
    };
    k.Gh = function () {
        return this.get('projection');
    };
    k.Rk = function () {
        return this.get('speed');
    };
    k.Hh = function () {
        return this.get('tracking');
    };
    k.th = function () {
        return this.get('trackingOptions');
    };
    k.Ih = function (a) {
        this.set('projection', a);
    };
    k.Ee = function (a) {
        this.set('tracking', a);
    };
    k.Si = function (a) {
        this.set('trackingOptions', a);
    };
    function is(a, b, c) {
        ff.call(this);
        this.yg(a, b ? b : 0, c);
    }
    u(is, ff);
    k = is.prototype;
    k.clone = function () {
        var a = new is(null);
        hf(a, this.ka, this.B.slice());
        a.s();
        return a;
    };
    k.Gb = function (a, b, c, d) {
        var e = this.B;
        a -= e[0];
        var f = b - e[1];
        b = a * a + f * f;
        if (b < d) {
            if (b)
                for (d = this.Vd() / Math.sqrt(b), c[0] = e[0] + d * a, c[1] = e[1] + d * f, d = 2; d < this.a; ++d)
                    c[d] = e[d];
            else
                for (d = 0; d < this.a; ++d)
                    c[d] = e[d];
            c.length = this.a;
            return b;
        }
        return d;
    };
    k.Oc = function (a, b) {
        var c = this.B, d = a - c[0], c = b - c[1];
        return d * d + c * c <= js(this);
    };
    k.Ba = function () {
        return this.B.slice(0, this.a);
    };
    k.ne = function (a) {
        var b = this.B, c = b[this.a] - b[0];
        return Va(b[0] - c, b[1] - c, b[0] + c, b[1] + c, a);
    };
    k.Vd = function () {
        return Math.sqrt(js(this));
    };
    function js(a) {
        var b = a.B[a.a] - a.B[0];
        a = a.B[a.a + 1] - a.B[1];
        return b * b + a * a;
    }
    k.T = function () {
        return 'Circle';
    };
    k.Xa = function (a) {
        var b = this.D();
        return mb(a, b) ? (b = this.Ba(), a[0] <= b[0] && a[2] >= b[0] || a[1] <= b[1] && a[3] >= b[1] ? !0 : ab(a, this.sb, this)) : !1;
    };
    k.wb = function (a) {
        var b = this.a, c = a.slice();
        c[b] = c[0] + (this.B[b] - this.B[0]);
        var d;
        for (d = 1; d < b; ++d)
            c[b + d] = a[d];
        hf(this, this.ka, c);
        this.s();
    };
    k.yg = function (a, b, c) {
        if (a) {
            jf(this, c, a, 0);
            this.B || (this.B = []);
            c = this.B;
            a = rf(c, a);
            c[a++] = c[0] + b;
            var d;
            b = 1;
            for (d = this.a; b < d; ++b)
                c[a++] = c[b];
            c.length = a;
        } else
            hf(this, 'XY', null);
        this.s();
    };
    k.X = function () {
    };
    k.pa = function () {
    };
    k.Wc = function (a) {
        this.B[this.a] = this.B[0] + a;
        this.s();
    };
    function ks(a, b, c) {
        for (var d = [], e = a(0), f = a(1), g = b(e), h = b(f), l = [
                    f,
                    e
                ], m = [
                    h,
                    g
                ], p = [
                    1,
                    0
                ], n = {}, q = 100000, r, v, x, y, z; 0 < --q && 0 < p.length;)
            x = p.pop(), e = l.pop(), g = m.pop(), f = x.toString(), f in n || (d.push(g[0], g[1]), n[f] = !0), y = p.pop(), f = l.pop(), h = m.pop(), z = (x + y) / 2, r = a(z), v = b(r), za(v[0], v[1], g[0], g[1], h[0], h[1]) < c ? (d.push(h[0], h[1]), f = y.toString(), n[f] = !0) : (p.push(y, z, z, x), m.push(h, v, v, g), l.push(f, r, r, e));
        return d;
    }
    function ls(a, b, c, d, e) {
        var f = Gb('EPSG:4326');
        return ks(function (d) {
            return [
                a,
                b + (c - b) * d
            ];
        }, Ub(f, d), e);
    }
    function ms(a, b, c, d, e) {
        var f = Gb('EPSG:4326');
        return ks(function (d) {
            return [
                b + (c - b) * d,
                a
            ];
        }, Ub(f, d), e);
    }
    function ns(a) {
        a = a || {};
        this.i = this.j = null;
        this.f = this.g = Infinity;
        this.c = this.l = -Infinity;
        this.A = this.u = Infinity;
        this.G = this.C = -Infinity;
        this.R = void 0 !== a.targetSize ? a.targetSize : 100;
        this.qa = void 0 !== a.maxLines ? a.maxLines : 100;
        this.b = [];
        this.a = [];
        this.ta = void 0 !== a.strokeStyle ? a.strokeStyle : os;
        this.I = this.o = void 0;
        this.v = null;
        this.setMap(void 0 !== a.map ? a.map : null);
    }
    var os = new rj({ color: 'rgba(0,0,0,0.2)' }), ps = [
            90,
            45,
            30,
            20,
            10,
            5,
            2,
            1,
            0.5,
            0.2,
            0.1,
            0.05,
            0.01,
            0.005,
            0.002,
            0.001
        ];
    function qs(a, b, c, d, e, f, g) {
        var h = g;
        b = ls(b, c, d, a.i, e);
        h = void 0 !== a.b[h] ? a.b[h] : new M(null);
        h.ca('XY', b);
        mb(h.D(), f) && (a.b[g++] = h);
        return g;
    }
    function rs(a, b, c, d, e) {
        var f = e;
        b = ms(b, a.c, a.f, a.i, c);
        f = void 0 !== a.a[f] ? a.a[f] : new M(null);
        f.ca('XY', b);
        mb(f.D(), d) && (a.a[e++] = f);
        return e;
    }
    k = ns.prototype;
    k.jm = function () {
        return this.j;
    };
    k.Gk = function () {
        return this.b;
    };
    k.Nk = function () {
        return this.a;
    };
    k.wh = function (a) {
        var b = a.vectorContext, c = a.frameState, d = c.extent;
        a = c.viewState;
        var e = a.center, f = a.projection, g = a.resolution;
        a = c.pixelRatio;
        a = g * g / (4 * a * a);
        if (!this.i || !Tb(this.i, f)) {
            var h = Gb('EPSG:4326'), l = f.D(), m = f.g, p = Xb(m, h, f), n = m[2], q = m[1], r = m[0], v = p[3], x = p[2], y = p[1], p = p[0];
            this.g = m[3];
            this.f = n;
            this.l = q;
            this.c = r;
            this.u = v;
            this.A = x;
            this.C = y;
            this.G = p;
            this.o = Ub(h, f);
            this.I = Ub(f, h);
            this.v = this.I(jb(l));
            this.i = f;
        }
        f.a && (f = f.D(), h = hb(f), c = c.focus[0], c < f[0] || c > f[2]) && (c = h * Math.ceil((f[0] - c) / h), d = [
            d[0] + c,
            d[1],
            d[2] + c,
            d[3]
        ]);
        c = this.v[0];
        f = this.v[1];
        h = -1;
        m = Math.pow(this.R * g, 2);
        n = [];
        q = [];
        g = 0;
        for (l = ps.length; g < l; ++g) {
            r = ps[g] / 2;
            n[0] = c - r;
            n[1] = f - r;
            q[0] = c + r;
            q[1] = f + r;
            this.o(n, n);
            this.o(q, q);
            r = Math.pow(q[0] - n[0], 2) + Math.pow(q[1] - n[1], 2);
            if (r <= m)
                break;
            h = ps[g];
        }
        g = h;
        if (-1 == g)
            this.b.length = this.a.length = 0;
        else {
            c = this.I(e);
            e = c[0];
            c = c[1];
            f = this.qa;
            h = [
                Math.max(d[0], this.G),
                Math.max(d[1], this.C),
                Math.min(d[2], this.A),
                Math.min(d[3], this.u)
            ];
            h = Xb(h, this.i, 'EPSG:4326');
            m = h[3];
            q = h[1];
            e = Math.floor(e / g) * g;
            n = wa(e, this.c, this.f);
            l = qs(this, n, q, m, a, d, 0);
            for (h = 0; n != this.c && h++ < f;)
                n = Math.max(n - g, this.c), l = qs(this, n, q, m, a, d, l);
            n = wa(e, this.c, this.f);
            for (h = 0; n != this.f && h++ < f;)
                n = Math.min(n + g, this.f), l = qs(this, n, q, m, a, d, l);
            this.b.length = l;
            c = Math.floor(c / g) * g;
            e = wa(c, this.l, this.g);
            l = rs(this, e, a, d, 0);
            for (h = 0; e != this.l && h++ < f;)
                e = Math.max(e - g, this.l), l = rs(this, e, a, d, l);
            e = wa(c, this.l, this.g);
            for (h = 0; e != this.g && h++ < f;)
                e = Math.min(e + g, this.g), l = rs(this, e, a, d, l);
            this.a.length = l;
        }
        b.Na(null, this.ta);
        a = 0;
        for (e = this.b.length; a < e; ++a)
            g = this.b[a], b.Qb(g, null);
        a = 0;
        for (e = this.a.length; a < e; ++a)
            g = this.a[a], b.Qb(g, null);
    };
    k.setMap = function (a) {
        this.j && (this.j.K('postcompose', this.wh, this), this.j.render());
        a && (a.J('postcompose', this.wh, this), a.render());
        this.j = a;
    };
    function ss(a, b, c, d, e) {
        Dc.call(this);
        this.i = e;
        this.extent = a;
        this.a = c;
        this.resolution = b;
        this.state = d;
    }
    u(ss, Dc);
    ss.prototype.s = function () {
        this.b('change');
    };
    ss.prototype.D = function () {
        return this.extent;
    };
    ss.prototype.V = function () {
        return this.state;
    };
    function ts(a, b, c, d, e, f, g) {
        ss.call(this, a, b, c, 0, d);
        this.l = e;
        this.M = new Image();
        null !== f && (this.M.crossOrigin = f);
        this.c = {};
        this.f = null;
        this.state = 0;
        this.g = g;
    }
    u(ts, ss);
    k = ts.prototype;
    k.Z = function (a) {
        if (void 0 !== a) {
            var b;
            a = w(a);
            if (a in this.c)
                return this.c[a];
            sb(this.c) ? b = this.M : b = this.M.cloneNode(!1);
            return this.c[a] = b;
        }
        return this.M;
    };
    k.mm = function () {
        this.state = 3;
        this.f.forEach(rc);
        this.f = null;
        this.s();
    };
    k.nm = function () {
        void 0 === this.resolution && (this.resolution = ib(this.extent) / this.M.height);
        this.state = 2;
        this.f.forEach(rc);
        this.f = null;
        this.s();
    };
    k.load = function () {
        if (0 == this.state || 3 == this.state)
            this.state = 1, this.s(), this.f = [
                wc(this.M, 'error', this.mm, this),
                wc(this.M, 'load', this.nm, this)
            ], this.g(this, this.l);
    };
    k.zg = function (a) {
        this.M = a;
    };
    function us(a, b, c, d, e, f) {
        this.c = f ? f : null;
        ss.call(this, a, b, c, f ? 0 : 2, d);
        this.f = e;
    }
    u(us, ss);
    us.prototype.g = function (a) {
        this.state = a ? 3 : 2;
        this.s();
    };
    us.prototype.load = function () {
        0 == this.state && (this.state = 1, this.s(), this.c(this.g.bind(this)));
    };
    us.prototype.Z = function () {
        return this.f;
    };
    function vs(a, b) {
        Dc.call(this);
        this.Ga = a;
        this.state = b;
        this.a = null;
        this.key = '';
    }
    u(vs, Dc);
    vs.prototype.s = function () {
        this.b('change');
    };
    vs.prototype.ib = function () {
        return this.key + '/' + this.Ga;
    };
    function ws(a) {
        if (!a.a)
            return a;
        var b = a.a;
        do {
            if (2 == b.V())
                return b;
            b = b.a;
        } while (b);
        return a;
    }
    vs.prototype.i = function () {
        return this.Ga;
    };
    vs.prototype.V = function () {
        return this.state;
    };
    function xs(a, b, c, d, e) {
        vs.call(this, a, b);
        this.g = c;
        this.M = new Image();
        null !== d && (this.M.crossOrigin = d);
        this.c = null;
        this.j = e;
    }
    u(xs, vs);
    k = xs.prototype;
    k.ra = function () {
        1 == this.state && ys(this);
        this.a && Ac(this.a);
        this.state = 5;
        this.s();
        vs.prototype.ra.call(this);
    };
    k.Z = function () {
        return this.M;
    };
    k.ib = function () {
        return this.g;
    };
    k.km = function () {
        this.state = 3;
        ys(this);
        this.s();
    };
    k.lm = function () {
        this.state = this.M.naturalWidth && this.M.naturalHeight ? 2 : 4;
        ys(this);
        this.s();
    };
    k.load = function () {
        if (0 == this.state || 3 == this.state)
            this.state = 1, this.s(), this.c = [
                wc(this.M, 'error', this.km, this),
                wc(this.M, 'load', this.lm, this)
            ], this.j(this, this.g);
    };
    function ys(a) {
        a.c.forEach(rc);
        a.c = null;
    }
    function zs(a) {
        a = a ? a : {};
        ag.call(this, { handleEvent: af });
        this.g = a.formatConstructors ? a.formatConstructors : [];
        this.j = a.projection ? Gb(a.projection) : null;
        this.a = null;
        this.target = a.target ? a.target : null;
    }
    u(zs, ag);
    function As(a) {
        a = a.dataTransfer.files;
        var b, c, d;
        b = 0;
        for (c = a.length; b < c; ++b) {
            d = a.item(b);
            var e = new FileReader();
            e.addEventListener('load', this.l.bind(this, d));
            e.readAsText(d);
        }
    }
    function Bs(a) {
        a.stopPropagation();
        a.preventDefault();
        a.dataTransfer.dropEffect = 'copy';
    }
    zs.prototype.l = function (a, b) {
        var c = b.target.result, d = this.v, e = this.j;
        e || (e = d.$().o);
        var d = this.g, f = [], g, h;
        g = 0;
        for (h = d.length; g < h; ++g) {
            var l = new d[g]();
            var m = { featureProjection: e };
            try {
                f = l.Qa(c, m);
            } catch (p) {
                f = null;
            }
            if (f && 0 < f.length)
                break;
        }
        this.b(new Cs(Ds, a, f, e));
    };
    zs.prototype.setMap = function (a) {
        this.a && (this.a.forEach(rc), this.a = null);
        ag.prototype.setMap.call(this, a);
        a && (a = this.target ? this.target : a.c, this.a = [
            B(a, 'drop', As, this),
            B(a, 'dragenter', Bs, this),
            B(a, 'dragover', Bs, this),
            B(a, 'drop', Bs, this)
        ]);
    };
    var Ds = 'addfeatures';
    function Cs(a, b, c, d) {
        Bc.call(this, a);
        this.features = c;
        this.file = b;
        this.projection = d;
    }
    u(Cs, Bc);
    function Es(a) {
        a = a ? a : {};
        pg.call(this, {
            handleDownEvent: Fs,
            handleDragEvent: Gs,
            handleUpEvent: Hs
        });
        this.o = a.condition ? a.condition : lg;
        this.a = this.g = void 0;
        this.j = 0;
        this.u = void 0 !== a.duration ? a.duration : 400;
    }
    u(Es, pg);
    function Gs(a) {
        if (ng(a)) {
            var b = a.map, c = b.Mb(), d = a.pixel;
            a = d[0] - c[0] / 2;
            d = c[1] / 2 - d[1];
            c = Math.atan2(d, a);
            a = Math.sqrt(a * a + d * d);
            b = b.$();
            void 0 !== this.g && (d = c - this.g, bg(b, b.Va() - d));
            this.g = c;
            void 0 !== this.a && (c = this.a * (b.Ua() / a), dg(b, c));
            void 0 !== this.a && (this.j = this.a / a);
            this.a = a;
        }
    }
    function Hs(a) {
        if (!ng(a))
            return !0;
        a = a.map.$();
        Rf(a, 1, -1);
        var b = this.j - 1, c = a.Va(), c = a.constrainRotation(c, 0);
        bg(a, c, void 0, void 0);
        var c = a.Ua(), d = this.u, c = a.constrainResolution(c, 0, b);
        dg(a, c, void 0, d);
        this.j = 0;
        return !1;
    }
    function Fs(a) {
        return ng(a) && this.o(a) ? (Rf(a.map.$(), 1, 1), this.a = this.g = void 0, !0) : !1;
    }
    function Is(a, b, c, d) {
        this.oa = a;
        this.Y = b;
        this.overlaps = d;
        this.c = 0;
        this.resolution = c;
        this.R = this.ta = null;
        this.a = [];
        this.coordinates = [];
        this.eb = wh();
        this.b = [];
        this.qa = null;
        this.ia = wh();
        this.ea = wh();
    }
    u(Is, Rh);
    function Js(a, b, c, d, e, f, g) {
        var h = a.coordinates.length, l = a.Gf();
        g && (c += e);
        g = [
            b[c],
            b[c + 1]
        ];
        var m = [
                NaN,
                NaN
            ], p = !0, n, q, r;
        for (n = c + e; n < d; n += e)
            m[0] = b[n], m[1] = b[n + 1], r = Ua(l, m), r !== q ? (p && (a.coordinates[h++] = g[0], a.coordinates[h++] = g[1]), a.coordinates[h++] = m[0], a.coordinates[h++] = m[1], p = !1) : 1 === r ? (a.coordinates[h++] = m[0], a.coordinates[h++] = m[1], p = !1) : p = !0, g[0] = m[0], g[1] = m[1], q = r;
        if (f && p || n === c + e)
            a.coordinates[h++] = g[0], a.coordinates[h++] = g[1];
        return h;
    }
    function Ks(a, b) {
        a.ta = [
            0,
            b,
            0
        ];
        a.a.push(a.ta);
        a.R = [
            0,
            b,
            0
        ];
        a.b.push(a.R);
    }
    Is.prototype.Wa = function (a, b) {
        if (this.$a) {
            var c = Bh(this.eb, this.$a.slice());
            a.translate(c[0], c[1]);
            a.rotate(b);
        }
        a.fill();
        this.$a && a.setTransform.apply(a, this.ea);
    };
    function Ls(a, b, c, d, e, f, g, h, l) {
        var m;
        a.qa && ia(d, a.eb) ? m = a.qa : (a.qa || (a.qa = []), m = df(a.coordinates, 0, a.coordinates.length, 2, d, a.qa), Ah(a.eb, d));
        d = !sb(f);
        for (var p = 0, n = g.length, q = 0, r, v = a.ia, x = a.ea, y, z, A, V, Pa = 0, ra = 0, La = a.a != g || a.overlaps ? 0 : 200; p < n;) {
            var C = g[p], Ma, xb, Z, Ra;
            switch (C[0]) {
            case 0:
                q = C[1];
                d && f[w(q).toString()] || !q.U() ? p = C[2] : void 0 === l || mb(l, q.U().D()) ? ++p : p = C[2] + 1;
                break;
            case 1:
                Pa > La && (a.Wa(b, e), Pa = 0);
                ra > La && (b.stroke(), ra = 0);
                Pa || ra || (b.beginPath(), y = z = NaN);
                ++p;
                break;
            case 2:
                q = C[1];
                r = m[q];
                C = m[q + 1];
                A = m[q + 2] - r;
                q = m[q + 3] - C;
                q = Math.sqrt(A * A + q * q);
                b.moveTo(r + q, C);
                b.arc(r, C, q, 0, 2 * Math.PI, !0);
                ++p;
                break;
            case 3:
                b.closePath();
                ++p;
                break;
            case 4:
                q = C[1];
                r = C[2];
                Ma = C[3];
                xb = C[4] * c;
                Z = C[5] * c;
                var Cb = C[6], dc = C[7], $c = C[8], $d = C[9];
                Ra = C[10];
                A = C[11];
                V = C[12];
                var Je = C[13], ue = C[14];
                for (Ra && (A += e); q < r; q += 2) {
                    C = m[q] - xb;
                    Ra = m[q + 1] - Z;
                    Je && (C = Math.round(C), Ra = Math.round(Ra));
                    if (1 != V || A) {
                        var Tc = C + xb, lh = Ra + Z;
                        Fh(v, Tc, lh, V, V, A, -Tc, -lh);
                        b.setTransform.apply(b, v);
                    }
                    Tc = b.globalAlpha;
                    1 != dc && (b.globalAlpha = Tc * dc);
                    var lh = ue + $c > Ma.width ? Ma.width - $c : ue, lq = Cb + $d > Ma.height ? Ma.height - $d : Cb;
                    b.drawImage(Ma, $c, $d, lh, lq, C, Ra, lh * c, lq * c);
                    1 != dc && (b.globalAlpha = Tc);
                    (1 != V || A) && b.setTransform.apply(b, x);
                }
                ++p;
                break;
            case 5:
                q = C[1];
                r = C[2];
                Z = C[3];
                Cb = C[4] * c;
                dc = C[5] * c;
                A = C[6];
                V = C[7] * c;
                Ma = C[8];
                xb = C[9];
                for ((Ra = C[10]) && (A += e); q < r; q += 2) {
                    C = m[q] + Cb;
                    Ra = m[q + 1] + dc;
                    if (1 != V || A)
                        Fh(v, C, Ra, V, V, A, -C, -Ra), b.setTransform.apply(b, v);
                    $c = Z.split('\n');
                    $d = $c.length;
                    1 < $d ? (Je = Math.round(1.5 * b.measureText('M').width), Ra -= ($d - 1) / 2 * Je) : Je = 0;
                    for (ue = 0; ue < $d; ue++)
                        Tc = $c[ue], xb && b.strokeText(Tc, C, Ra), Ma && b.fillText(Tc, C, Ra), Ra += Je;
                    (1 != V || A) && b.setTransform.apply(b, x);
                }
                ++p;
                break;
            case 6:
                if (h && (q = C[1], q = h(q)))
                    return q;
                ++p;
                break;
            case 7:
                La ? Pa++ : a.Wa(b, e);
                ++p;
                break;
            case 8:
                q = C[1];
                r = C[2];
                C = m[q];
                Ra = m[q + 1];
                A = C + 0.5 | 0;
                V = Ra + 0.5 | 0;
                if (A !== y || V !== z)
                    b.moveTo(C, Ra), y = A, z = V;
                for (q += 2; q < r; q += 2)
                    if (C = m[q], Ra = m[q + 1], A = C + 0.5 | 0, V = Ra + 0.5 | 0, q == r - 2 || A !== y || V !== z)
                        b.lineTo(C, Ra), y = A, z = V;
                ++p;
                break;
            case 9:
                a.$a = C[2];
                Pa && (a.Wa(b, e), Pa = 0, ra && (b.stroke(), ra = 0));
                b.fillStyle = C[1];
                ++p;
                break;
            case 10:
                var q = void 0 !== C[8] ? C[8] : !0, hl = C[9];
                r = C[2];
                ra && (b.stroke(), ra = 0);
                b.strokeStyle = C[1];
                b.lineWidth = q ? r * c : r;
                b.lineCap = C[3];
                b.lineJoin = C[4];
                b.miterLimit = C[5];
                Ld && (r = C[6], A = C[7], q && c !== hl && (r = r.map(function (a) {
                    return a * c / hl;
                }), A *= c / hl, C[6] = r, C[7] = A, C[9] = c), b.lineDashOffset = A, b.setLineDash(r));
                ++p;
                break;
            case 11:
                b.font = C[1];
                b.textAlign = C[2];
                b.textBaseline = C[3];
                ++p;
                break;
            case 12:
                La ? ra++ : b.stroke();
                ++p;
                break;
            default:
                ++p;
            }
        }
        Pa && a.Wa(b, e);
        ra && b.stroke();
    }
    Is.prototype.i = function (a, b, c, d, e) {
        Ls(this, a, b, c, d, e, this.a, void 0, void 0);
    };
    function Ms(a) {
        var b = a.b;
        b.reverse();
        var c, d = b.length, e, f, g = -1;
        for (c = 0; c < d; ++c)
            if (e = b[c], f = e[0], 6 == f)
                g = c;
            else if (0 == f) {
                e[2] = c;
                e = a.b;
                for (f = c; g < f;) {
                    var h = e[g];
                    e[g] = e[f];
                    e[f] = h;
                    ++g;
                    --f;
                }
                g = -1;
            }
    }
    function Ns(a, b) {
        a.ta[2] = a.a.length;
        a.ta = null;
        a.R[2] = a.b.length;
        a.R = null;
        var c = [
            6,
            b
        ];
        a.a.push(c);
        a.b.push(c);
    }
    Is.prototype.Je = na;
    Is.prototype.Gf = function () {
        return this.Y;
    };
    function Os(a, b, c, d) {
        Is.call(this, a, b, c, d);
        this.M = this.S = null;
        this.G = this.C = this.A = this.u = this.I = this.v = this.o = this.j = this.l = this.g = this.f = void 0;
    }
    u(Os, Is);
    Os.prototype.qc = function (a, b) {
        if (this.M) {
            Ks(this, b);
            var c = a.ha(), d = this.coordinates.length, c = Js(this, c, 0, c.length, a.sa(), !1, !1);
            this.a.push([
                4,
                d,
                c,
                this.M,
                this.f,
                this.g,
                this.l,
                this.j,
                this.o,
                this.v,
                this.I,
                this.u,
                this.A,
                this.C,
                this.G
            ]);
            this.b.push([
                4,
                d,
                c,
                this.S,
                this.f,
                this.g,
                this.l,
                this.j,
                this.o,
                this.v,
                this.I,
                this.u,
                this.A,
                this.C,
                this.G
            ]);
            Ns(this, b);
        }
    };
    Os.prototype.oc = function (a, b) {
        if (this.M) {
            Ks(this, b);
            var c = a.ha(), d = this.coordinates.length, c = Js(this, c, 0, c.length, a.sa(), !1, !1);
            this.a.push([
                4,
                d,
                c,
                this.M,
                this.f,
                this.g,
                this.l,
                this.j,
                this.o,
                this.v,
                this.I,
                this.u,
                this.A,
                this.C,
                this.G
            ]);
            this.b.push([
                4,
                d,
                c,
                this.S,
                this.f,
                this.g,
                this.l,
                this.j,
                this.o,
                this.v,
                this.I,
                this.u,
                this.A,
                this.C,
                this.G
            ]);
            Ns(this, b);
        }
    };
    Os.prototype.Je = function () {
        Ms(this);
        this.g = this.f = void 0;
        this.M = this.S = null;
        this.G = this.C = this.u = this.I = this.v = this.o = this.j = this.A = this.l = void 0;
    };
    Os.prototype.Vb = function (a) {
        var b = a.Hc(), c = a.jc(), d = a.cg(1), e = a.Z(1), f = a.Pc();
        this.f = b[0];
        this.g = b[1];
        this.S = d;
        this.M = e;
        this.l = c[1];
        this.j = a.g;
        this.o = f[0];
        this.v = f[1];
        this.I = a.o;
        this.u = a.l;
        this.A = a.c;
        this.C = a.v;
        this.G = c[0];
    };
    function Ps(a, b, c, d) {
        Is.call(this, a, b, c, d);
        this.g = null;
        this.f = {
            Kd: void 0,
            Ed: void 0,
            Fd: null,
            Gd: void 0,
            Hd: void 0,
            Id: void 0,
            Jd: void 0,
            Sf: 0,
            strokeStyle: void 0,
            lineCap: void 0,
            lineDash: null,
            lineDashOffset: void 0,
            lineJoin: void 0,
            lineWidth: void 0,
            miterLimit: void 0
        };
    }
    u(Ps, Is);
    function Qs(a, b, c, d, e) {
        var f = a.coordinates.length;
        b = Js(a, b, c, d, e, !1, !1);
        f = [
            8,
            f,
            b
        ];
        a.a.push(f);
        a.b.push(f);
        return d;
    }
    k = Ps.prototype;
    k.Gf = function () {
        this.g || (this.g = Na(this.Y), 0 < this.c && Ka(this.g, this.resolution * (this.c + 1) / 2, this.g));
        return this.g;
    };
    function Rs(a) {
        var b = a.f, c = b.strokeStyle, d = b.lineCap, e = b.lineDash, f = b.lineDashOffset, g = b.lineJoin, h = b.lineWidth, l = b.miterLimit;
        b.Kd == c && b.Ed == d && ia(b.Fd, e) && b.Gd == f && b.Hd == g && b.Id == h && b.Jd == l || (b.Sf != a.coordinates.length && (a.a.push([12]), b.Sf = a.coordinates.length), a.a.push([
            10,
            c,
            h,
            d,
            g,
            l,
            e,
            f,
            !0,
            1
        ], [1]), b.Kd = c, b.Ed = d, b.Fd = e, b.Gd = f, b.Hd = g, b.Id = h, b.Jd = l);
    }
    k.Qb = function (a, b) {
        var c = this.f, d = c.lineWidth;
        void 0 !== c.strokeStyle && void 0 !== d && (Rs(this), Ks(this, b), this.b.push([
            10,
            c.strokeStyle,
            c.lineWidth,
            c.lineCap,
            c.lineJoin,
            c.miterLimit,
            c.lineDash,
            c.lineDashOffset,
            !0,
            1
        ], [1]), c = a.ha(), Qs(this, c, 0, c.length, a.sa()), this.b.push([12]), Ns(this, b));
    };
    k.nc = function (a, b) {
        var c = this.f, d = c.lineWidth;
        if (void 0 !== c.strokeStyle && void 0 !== d) {
            Rs(this);
            Ks(this, b);
            this.b.push([
                10,
                c.strokeStyle,
                c.lineWidth,
                c.lineCap,
                c.lineJoin,
                c.miterLimit,
                c.lineDash,
                c.lineDashOffset,
                !0,
                1
            ], [1]);
            var c = a.Rb(), d = a.ha(), e = a.sa(), f = 0, g, h;
            g = 0;
            for (h = c.length; g < h; ++g)
                f = Qs(this, d, f, c[g], e);
            this.b.push([12]);
            Ns(this, b);
        }
    };
    k.Je = function () {
        this.f.Sf != this.coordinates.length && this.a.push([12]);
        Ms(this);
        this.f = null;
    };
    k.Na = function (a, b) {
        var c = b.a;
        this.f.strokeStyle = Vc(c ? c : Ph);
        c = b.i;
        this.f.lineCap = void 0 !== c ? c : 'round';
        c = b.f;
        this.f.lineDash = c ? c : Oh;
        c = b.g;
        this.f.lineDashOffset = c ? c : 0;
        c = b.l;
        this.f.lineJoin = void 0 !== c ? c : 'round';
        c = b.c;
        this.f.lineWidth = void 0 !== c ? c : 1;
        c = b.j;
        this.f.miterLimit = void 0 !== c ? c : 10;
        this.f.lineWidth > this.c && (this.c = this.f.lineWidth, this.g = null);
    };
    function Ss(a, b, c, d) {
        Is.call(this, a, b, c, d);
        this.g = null;
        this.f = {
            Yg: void 0,
            Kd: void 0,
            Ed: void 0,
            Fd: null,
            Gd: void 0,
            Hd: void 0,
            Id: void 0,
            Jd: void 0,
            fillStyle: void 0,
            strokeStyle: void 0,
            lineCap: void 0,
            lineDash: null,
            lineDashOffset: void 0,
            lineJoin: void 0,
            lineWidth: void 0,
            miterLimit: void 0
        };
    }
    u(Ss, Is);
    function Ts(a, b, c, d, e) {
        var f = a.f, g = void 0 !== f.fillStyle, f = void 0 != f.strokeStyle, h = d.length, l = [1];
        a.a.push(l);
        a.b.push(l);
        for (l = 0; l < h; ++l) {
            var m = d[l], p = a.coordinates.length;
            c = Js(a, b, c, m, e, !0, !f);
            c = [
                8,
                p,
                c
            ];
            a.a.push(c);
            a.b.push(c);
            f && (c = [3], a.a.push(c), a.b.push(c));
            c = m;
        }
        b = [7];
        a.b.push(b);
        g && a.a.push(b);
        f && (g = [12], a.a.push(g), a.b.push(g));
        return c;
    }
    k = Ss.prototype;
    k.$b = function (a, b) {
        var c = this.f, d = c.strokeStyle;
        if (void 0 !== c.fillStyle || void 0 !== d) {
            Us(this, a);
            Ks(this, b);
            this.b.push([
                9,
                Sc(Nh)
            ]);
            void 0 !== c.strokeStyle && this.b.push([
                10,
                c.strokeStyle,
                c.lineWidth,
                c.lineCap,
                c.lineJoin,
                c.miterLimit,
                c.lineDash,
                c.lineDashOffset,
                !0,
                1
            ]);
            var e = a.ha(), d = this.coordinates.length;
            Js(this, e, 0, e.length, a.sa(), !1, !1);
            e = [1];
            d = [
                2,
                d
            ];
            this.a.push(e, d);
            this.b.push(e, d);
            d = [7];
            this.b.push(d);
            void 0 !== c.fillStyle && this.a.push(d);
            void 0 !== c.strokeStyle && (c = [12], this.a.push(c), this.b.push(c));
            Ns(this, b);
        }
    };
    k.rc = function (a, b) {
        var c = this.f;
        Us(this, a);
        Ks(this, b);
        this.b.push([
            9,
            Sc(Nh)
        ]);
        void 0 !== c.strokeStyle && this.b.push([
            10,
            c.strokeStyle,
            c.lineWidth,
            c.lineCap,
            c.lineJoin,
            c.miterLimit,
            c.lineDash,
            c.lineDashOffset,
            !0,
            1
        ]);
        var c = a.Rb(), d = a.fc();
        Ts(this, d, 0, c, a.sa());
        Ns(this, b);
    };
    k.pc = function (a, b) {
        var c = this.f, d = c.strokeStyle;
        if (void 0 !== c.fillStyle || void 0 !== d) {
            Us(this, a);
            Ks(this, b);
            this.b.push([
                9,
                Sc(Nh)
            ]);
            void 0 !== c.strokeStyle && this.b.push([
                10,
                c.strokeStyle,
                c.lineWidth,
                c.lineCap,
                c.lineJoin,
                c.miterLimit,
                c.lineDash,
                c.lineDashOffset,
                !0,
                1
            ]);
            var c = a.c, d = ai(a), e = a.sa(), f = 0, g, h;
            g = 0;
            for (h = c.length; g < h; ++g)
                f = Ts(this, d, f, c[g], e);
            Ns(this, b);
        }
    };
    k.Je = function () {
        Ms(this);
        this.f = null;
        var a = this.oa;
        if (a) {
            var b = this.coordinates, c, d;
            c = 0;
            for (d = b.length; c < d; ++c)
                b[c] = a * Math.round(b[c] / a);
        }
    };
    k.Gf = function () {
        this.g || (this.g = Na(this.Y), 0 < this.c && Ka(this.g, this.resolution * (this.c + 1) / 2, this.g));
        return this.g;
    };
    k.Na = function (a, b) {
        var c = this.f;
        if (a) {
            var d = a.b;
            c.fillStyle = Vc(d ? d : Nh);
        } else
            c.fillStyle = void 0;
        b ? (d = b.a, c.strokeStyle = Vc(d ? d : Ph), d = b.i, c.lineCap = void 0 !== d ? d : 'round', d = b.f, c.lineDash = d ? d.slice() : Oh, d = b.g, c.lineDashOffset = d ? d : 0, d = b.l, c.lineJoin = void 0 !== d ? d : 'round', d = b.c, c.lineWidth = void 0 !== d ? d : 1, d = b.j, c.miterLimit = void 0 !== d ? d : 10, c.lineWidth > this.c && (this.c = c.lineWidth, this.g = null)) : (c.strokeStyle = void 0, c.lineCap = void 0, c.lineDash = null, c.lineDashOffset = void 0, c.lineJoin = void 0, c.lineWidth = void 0, c.miterLimit = void 0);
    };
    function Us(a, b) {
        var c = a.f, d = c.fillStyle, e = c.strokeStyle, f = c.lineCap, g = c.lineDash, h = c.lineDashOffset, l = c.lineJoin, m = c.lineWidth, p = c.miterLimit;
        if (void 0 !== d && ('string' !== typeof d || c.Yg != d)) {
            var n = [
                9,
                d
            ];
            'string' !== typeof d && (d = b.D(), n.push([
                d[0],
                d[3]
            ]));
            a.a.push(n);
            c.Yg = c.fillStyle;
        }
        void 0 === e || c.Kd == e && c.Ed == f && ia(c.Fd, g) && c.Gd == h && c.Hd == l && c.Id == m && c.Jd == p || (a.a.push([
            10,
            e,
            m,
            f,
            l,
            p,
            g,
            h,
            !0,
            1
        ]), c.Kd = e, c.Ed = f, c.Fd = g, c.Gd = h, c.Hd = l, c.Id = m, c.Jd = p);
    }
    function Vs(a, b, c, d) {
        Is.call(this, a, b, c, d);
        this.G = this.C = this.A = null;
        this.Fa = '';
        this.o = this.j = 0;
        this.v = void 0;
        this.u = this.I = 0;
        this.l = this.g = this.f = null;
    }
    u(Vs, Is);
    Vs.prototype.xc = function (a, b, c, d, e, f) {
        if ('' !== this.Fa && this.l && (this.f || this.g)) {
            if (this.f) {
                e = this.f;
                var g = this.A;
                if (!g || g.fillStyle != e.fillStyle) {
                    var h = [
                        9,
                        e.fillStyle
                    ];
                    this.a.push(h);
                    this.b.push(h);
                    g ? g.fillStyle = e.fillStyle : this.A = { fillStyle: e.fillStyle };
                }
            }
            this.g && (e = this.g, g = this.C, g && g.lineCap == e.lineCap && g.lineDash == e.lineDash && g.lineDashOffset == e.lineDashOffset && g.lineJoin == e.lineJoin && g.lineWidth == e.lineWidth && g.miterLimit == e.miterLimit && g.strokeStyle == e.strokeStyle || (h = [
                10,
                e.strokeStyle,
                e.lineWidth,
                e.lineCap,
                e.lineJoin,
                e.miterLimit,
                e.lineDash,
                e.lineDashOffset,
                !1,
                1
            ], this.a.push(h), this.b.push(h), g ? (g.lineCap = e.lineCap, g.lineDash = e.lineDash, g.lineDashOffset = e.lineDashOffset, g.lineJoin = e.lineJoin, g.lineWidth = e.lineWidth, g.miterLimit = e.miterLimit, g.strokeStyle = e.strokeStyle) : this.C = {
                lineCap: e.lineCap,
                lineDash: e.lineDash,
                lineDashOffset: e.lineDashOffset,
                lineJoin: e.lineJoin,
                lineWidth: e.lineWidth,
                miterLimit: e.miterLimit,
                strokeStyle: e.strokeStyle
            }));
            e = this.l;
            g = this.G;
            g && g.font == e.font && g.textAlign == e.textAlign && g.textBaseline == e.textBaseline || (h = [
                11,
                e.font,
                e.textAlign,
                e.textBaseline
            ], this.a.push(h), this.b.push(h), g ? (g.font = e.font, g.textAlign = e.textAlign, g.textBaseline = e.textBaseline) : this.G = {
                font: e.font,
                textAlign: e.textAlign,
                textBaseline: e.textBaseline
            });
            Ks(this, f);
            e = this.coordinates.length;
            a = Js(this, a, b, c, d, !1, !1);
            a = [
                5,
                e,
                a,
                this.Fa,
                this.j,
                this.o,
                this.I,
                this.u,
                !!this.f,
                !!this.g,
                this.v
            ];
            this.a.push(a);
            this.b.push(a);
            Ns(this, f);
        }
    };
    Vs.prototype.Tb = function (a) {
        if (a) {
            var b = a.Ca();
            b ? (b = b.b, b = Vc(b ? b : Nh), this.f ? this.f.fillStyle = b : this.f = { fillStyle: b }) : this.f = null;
            var c = a.Da();
            if (c) {
                var b = c.a, d = c.i, e = c.f, f = c.g, g = c.l, h = c.c, c = c.j, d = void 0 !== d ? d : 'round', e = e ? e.slice() : Oh, f = void 0 !== f ? f : 0, g = void 0 !== g ? g : 'round', h = void 0 !== h ? h : 1, c = void 0 !== c ? c : 10, b = Vc(b ? b : Ph);
                if (this.g) {
                    var l = this.g;
                    l.lineCap = d;
                    l.lineDash = e;
                    l.lineDashOffset = f;
                    l.lineJoin = g;
                    l.lineWidth = h;
                    l.miterLimit = c;
                    l.strokeStyle = b;
                } else
                    this.g = {
                        lineCap: d,
                        lineDash: e,
                        lineDashOffset: f,
                        lineJoin: g,
                        lineWidth: h,
                        miterLimit: c,
                        strokeStyle: b
                    };
            } else
                this.g = null;
            var m = a.a, b = a.f, d = a.c, e = a.j, h = a.i, c = a.b, f = a.Pa(), g = a.g, l = a.l;
            a = void 0 !== m ? m : '10px sans-serif';
            g = void 0 !== g ? g : 'center';
            l = void 0 !== l ? l : 'middle';
            this.l ? (m = this.l, m.font = a, m.textAlign = g, m.textBaseline = l) : this.l = {
                font: a,
                textAlign: g,
                textBaseline: l
            };
            this.Fa = void 0 !== f ? f : '';
            this.j = void 0 !== b ? b : 0;
            this.o = void 0 !== d ? d : 0;
            this.v = void 0 !== e ? e : !1;
            this.I = void 0 !== h ? h : 0;
            this.u = void 0 !== c ? c : 1;
        } else
            this.Fa = '';
    };
    function Ws(a, b, c, d, e) {
        this.I = a;
        this.c = b;
        this.o = d;
        this.v = c;
        this.g = e;
        this.a = {};
        this.l = Xc(1, 1);
        this.j = wh();
    }
    u(Ws, fi);
    var Xs = { 0: [[!0]] };
    function Ys(a, b, c) {
        var d, e = Math.floor(a.length / 2);
        if (b >= e)
            for (d = e; d < b; d++)
                a[d][c] = !0;
        else if (b < e)
            for (d = b + 1; d < e; d++)
                a[d][c] = !0;
    }
    function Zs(a) {
        if (void 0 !== Xs[a])
            return Xs[a];
        for (var b = 2 * a + 1, c = Array(b), d = 0; d < b; d++)
            c[d] = Array(b);
        for (var b = a, e = d = 0; b >= d;)
            Ys(c, a + b, a + d), Ys(c, a + d, a + b), Ys(c, a - d, a + b), Ys(c, a - b, a + d), Ys(c, a - b, a - d), Ys(c, a - d, a - b), Ys(c, a + d, a - b), Ys(c, a + b, a - d), d++, e += 1 + 2 * d, 0 < 2 * (e - b) + 1 && (--b, e += 1 - 2 * b);
        return Xs[a] = c;
    }
    function $s(a) {
        for (var b in a.a) {
            var c = a.a[b], d;
            for (d in c)
                c[d].Je();
        }
    }
    Ws.prototype.Aa = function (a, b, c, d, e, f) {
        d = Math.round(d);
        var g = 2 * d + 1, h = Fh(this.j, d + 0.5, d + 0.5, 1 / b, -1 / b, -c, -a[0], -a[1]), l = this.l;
        l.canvas.width !== g || l.canvas.height !== g ? (l.canvas.width = g, l.canvas.height = g) : l.clearRect(0, 0, g, g);
        var m;
        void 0 !== this.g && (m = Ia(), Ja(m, a), Ka(m, b * (this.g + d), m));
        var p = Zs(d);
        return at(this, l, h, c, e, function (a) {
            for (var b = l.getImageData(0, 0, g, g).data, c = 0; c < g; c++)
                for (var d = 0; d < g; d++)
                    if (p[c][d] && 0 < b[4 * (d * g + c) + 3]) {
                        if (a = f(a))
                            return a;
                        l.clearRect(0, 0, g, g);
                        return;
                    }
        }, m);
    };
    function bt(a, b) {
        var c = a.c, d = c[0], e = c[1], f = c[2], c = c[3], d = [
                d,
                e,
                d,
                c,
                f,
                c,
                f,
                e
            ];
        df(d, 0, 8, 2, b, d);
        return d;
    }
    Ws.prototype.b = function (a, b) {
        var c = void 0 !== a ? a.toString() : '0', d = this.a[c];
        void 0 === d && (d = {}, this.a[c] = d);
        c = d[b];
        void 0 === c && (c = new ct[b](this.I, this.c, this.v, this.o), d[b] = c);
        return c;
    };
    Ws.prototype.f = function () {
        return sb(this.a);
    };
    Ws.prototype.i = function (a, b, c, d, e, f) {
        var g = Object.keys(this.a).map(Number);
        g.sort(da);
        var h = bt(this, c);
        a.save();
        a.beginPath();
        a.moveTo(h[0], h[1]);
        a.lineTo(h[2], h[3]);
        a.lineTo(h[4], h[5]);
        a.lineTo(h[6], h[7]);
        a.clip();
        f = f ? f : ei;
        var l, m, p, n, q, h = 0;
        for (l = g.length; h < l; ++h)
            for (n = this.a[g[h].toString()], m = 0, p = f.length; m < p; ++m)
                q = n[f[m]], void 0 !== q && q.i(a, b, c, d, e);
        a.restore();
    };
    function at(a, b, c, d, e, f, g) {
        var h = Object.keys(a.a).map(Number);
        h.sort(function (a, b) {
            return b - a;
        });
        var l, m, p, n, q;
        l = 0;
        for (m = h.length; l < m; ++l)
            for (n = a.a[h[l].toString()], p = ei.length - 1; 0 <= p; --p)
                if (q = n[ei[p]], void 0 !== q && (q = Ls(q, b, 1, c, d, e, q.b, f, g)))
                    return q;
    }
    var ct = {
        Circle: Ss,
        Image: Os,
        LineString: Ps,
        Polygon: Ss,
        Text: Vs
    };
    function dt(a) {
        Fc.call(this);
        this.a = a;
    }
    u(dt, Fc);
    dt.prototype.Aa = na;
    dt.prototype.Ke = bf;
    dt.prototype.Cf = function (a, b, c) {
        return function (d, e) {
            return et(a, b, d, e, function (a) {
                c[d] || (c[d] = {});
                c[d][a.Ga.toString()] = a;
            });
        };
    };
    dt.prototype.ea = function (a) {
        2 === a.target.V() && ft(this);
    };
    function gt(a, b) {
        var c = b.V();
        2 != c && 3 != c && B(b, 'change', a.ea, a);
        0 == c && (b.load(), c = b.V());
        return 2 == c;
    }
    function ft(a) {
        var b = a.a;
        b.Kb() && 'ready' == b.Nf() && a.s();
    }
    function ht(a, b) {
        b.fi() && a.postRenderFunctions.push(function (a, b, e) {
            b = w(a).toString();
            a.gd(e.viewState.projection, e.usedTiles[b]);
        }.bind(null, b));
    }
    function it(a, b) {
        if (b) {
            var c, d, e;
            d = 0;
            for (e = b.length; d < e; ++d)
                c = b[d], a[w(c).toString()] = c;
        }
    }
    function jt(a, b) {
        var c = b.R;
        void 0 !== c && ('string' === typeof c ? a.logos[c] = '' : c && (qa('string' == typeof c.href, 44), qa('string' == typeof c.src, 45), a.logos[c.src] = c.href));
    }
    function kt(a, b, c, d) {
        b = w(b).toString();
        c = c.toString();
        b in a ? c in a[b] ? (a = a[b][c], d.da < a.da && (a.da = d.da), d.ba > a.ba && (a.ba = d.ba), d.fa < a.fa && (a.fa = d.fa), d.ja > a.ja && (a.ja = d.ja)) : a[b][c] = d : (a[b] = {}, a[b][c] = d);
    }
    function lt(a, b, c, d, e, f, g, h, l, m) {
        var p = w(b).toString();
        p in a.wantedTiles || (a.wantedTiles[p] = {});
        var n = a.wantedTiles[p];
        a = a.tileQueue;
        var q = c.minZoom, r, v, x, y, z, A;
        for (A = g; A >= q; --A)
            for (v = cc(c, f, A, v), x = c.La(A), y = v.da; y <= v.ba; ++y)
                for (z = v.fa; z <= v.ja; ++z)
                    g - A <= h ? (r = b.Lc(A, y, z, d, e), 0 == r.V() && (n[r.ib()] = !0, r.ib() in a.a || a.i([
                        r,
                        p,
                        ic(c, r.Ga),
                        x
                    ])), l && l.call(m, r)) : b.Eg(A, y, z, e);
    }
    function mt(a) {
        dt.call(this, a);
        this.ia = wh();
    }
    u(mt, dt);
    function nt(a, b, c) {
        var d = b.pixelRatio, e = b.size[0] * d, f = b.size[1] * d, g = b.viewState.rotation, h = eb(c), l = db(c), m = cb(c);
        c = bb(c);
        Bh(b.coordinateToPixelTransform, h);
        Bh(b.coordinateToPixelTransform, l);
        Bh(b.coordinateToPixelTransform, m);
        Bh(b.coordinateToPixelTransform, c);
        a.save();
        Qh(a, -g, e / 2, f / 2);
        a.beginPath();
        a.moveTo(h[0] * d, h[1] * d);
        a.lineTo(l[0] * d, l[1] * d);
        a.lineTo(m[0] * d, m[1] * d);
        a.lineTo(c[0] * d, c[1] * d);
        a.clip();
        Qh(a, g, e / 2, f / 2);
    }
    function ot(a, b, c, d, e) {
        var f = a.a;
        if (Ec(f, b)) {
            var g = d.size[0] * d.pixelRatio, h = d.size[1] * d.pixelRatio, l = d.viewState.rotation;
            Qh(c, -l, g / 2, h / 2);
            a = e ? e : pt(a, d, 0);
            f.b(new Mh(b, new Sh(c, d.pixelRatio, d.extent, a, d.viewState.rotation), d, c, null));
            Qh(c, l, g / 2, h / 2);
        }
    }
    mt.prototype.v = function (a, b, c, d) {
        if (this.Aa(a, b, 0, af, this))
            return c.call(d, this.a, null);
    };
    mt.prototype.Ue = function (a, b, c, d) {
        ot(this, 'postcompose', a, b, d);
    };
    function pt(a, b, c) {
        var d = b.viewState, e = b.pixelRatio, f = e / d.resolution;
        return Fh(a.ia, e * b.size[0] / 2, e * b.size[1] / 2, f, -f, -d.rotation, -d.center[0] + c, -d.center[1]);
    }
    function qt(a, b) {
        return w(a) - w(b);
    }
    function rt(a, b) {
        var c = 0.5 * a / b;
        return c * c;
    }
    function st(a, b, c, d, e, f) {
        var g = !1, h, l;
        if (h = c.Z())
            l = h.Oe(), 2 == l || 3 == l ? h.Yi(e, f) : (0 == l && h.load(), h.zh(e, f), g = !0);
        if (e = (0, c.Ra)(b))
            d = e.Qd(d), (0, tt[d.T()])(a, d, c, b);
        return g;
    }
    var tt = {
        Point: function (a, b, c, d) {
            var e = c.Z();
            if (e) {
                if (2 != e.Oe())
                    return;
                var f = a.b(c.za(), 'Image');
                f.Vb(e);
                f.qc(b, d);
            }
            if (e = c.Pa())
                a = a.b(c.za(), 'Text'), a.Tb(e), a.xc(b.ha(), 0, 2, 2, b, d);
        },
        LineString: function (a, b, c, d) {
            var e = c.Da();
            if (e) {
                var f = a.b(c.za(), 'LineString');
                f.Na(null, e);
                f.Qb(b, d);
            }
            if (e = c.Pa())
                a = a.b(c.za(), 'Text'), a.Tb(e), a.xc(Zh(b), 0, 2, 2, b, d);
        },
        Polygon: function (a, b, c, d) {
            var e = c.Ca(), f = c.Da();
            if (e || f) {
                var g = a.b(c.za(), 'Polygon');
                g.Na(e, f);
                g.rc(b, d);
            }
            if (e = c.Pa())
                a = a.b(c.za(), 'Text'), a.Tb(e), a.xc(Lf(b), 0, 2, 2, b, d);
        },
        MultiPoint: function (a, b, c, d) {
            var e = c.Z();
            if (e) {
                if (2 != e.Oe())
                    return;
                var f = a.b(c.za(), 'Image');
                f.Vb(e);
                f.oc(b, d);
            }
            if (e = c.Pa())
                a = a.b(c.za(), 'Text'), a.Tb(e), c = b.ha(), a.xc(c, 0, c.length, b.sa(), b, d);
        },
        MultiLineString: function (a, b, c, d) {
            var e = c.Da();
            if (e) {
                var f = a.b(c.za(), 'LineString');
                f.Na(null, e);
                f.nc(b, d);
            }
            if (e = c.Pa())
                a = a.b(c.za(), 'Text'), a.Tb(e), c = $h(b), a.xc(c, 0, c.length, 2, b, d);
        },
        MultiPolygon: function (a, b, c, d) {
            var e = c.Ca(), f = c.Da();
            if (f || e) {
                var g = a.b(c.za(), 'Polygon');
                g.Na(e, f);
                g.pc(b, d);
            }
            if (e = c.Pa())
                a = a.b(c.za(), 'Text'), a.Tb(e), c = bi(b), a.xc(c, 0, c.length, 2, b, d);
        },
        GeometryCollection: function (a, b, c, d) {
            b = b.a;
            var e, f;
            e = 0;
            for (f = b.length; e < f; ++e)
                (0, tt[b[e].T()])(a, b[e], c, d);
        },
        Circle: function (a, b, c, d) {
            var e = c.Ca(), f = c.Da();
            if (e || f) {
                var g = a.b(c.za(), 'Circle');
                g.Na(e, f);
                g.$b(b, d);
            }
            if (e = c.Pa())
                a = a.b(c.za(), 'Text'), a.Tb(e), a.xc(b.Ba(), 0, 2, 2, b, d);
        }
    };
    function ut(a) {
        mt.call(this, a);
        this.c = !1;
        this.u = -1;
        this.o = NaN;
        this.l = Ia();
        this.i = this.j = null;
        this.g = Xc();
    }
    u(ut, mt);
    ut.prototype.I = function (a, b, c) {
        var d = a.extent, e = a.pixelRatio, f = b.De ? a.skippedFeatureUids : {}, g = a.viewState, h = g.projection, g = g.rotation, l = h.D(), m = this.a.la(), p = pt(this, a, 0);
        ot(this, 'precompose', c, a, p);
        var n = b.extent, q = void 0 !== n;
        q && nt(c, a, n);
        if ((n = this.i) && !n.f()) {
            var r = 0, v = 0, x;
            if (Ec(this.a, 'render')) {
                x = c.canvas.width;
                var y = c.canvas.height;
                if (g) {
                    var z = Math.round(Math.sqrt(x * x + y * y)), r = (z - x) / 2, v = (z - y) / 2;
                    x = y = z;
                }
                this.g.canvas.width = x;
                this.g.canvas.height = y;
                x = this.g;
            } else
                x = c;
            y = x.globalAlpha;
            x.globalAlpha = b.opacity;
            x != c && x.translate(r, v);
            var z = a.size[0] * e, A = a.size[1] * e;
            Qh(x, -g, z / 2, A / 2);
            n.i(x, e, p, g, f);
            if (m.G && h.a && !Ta(l, d)) {
                for (var h = d[0], m = hb(l), V = 0; h < l[0];)
                    --V, p = m * V, p = pt(this, a, p), n.i(x, e, p, g, f), h += m;
                V = 0;
                for (h = d[2]; h > l[2];)
                    ++V, p = m * V, p = pt(this, a, p), n.i(x, e, p, g, f), h -= m;
                p = pt(this, a, 0);
            }
            Qh(x, g, z / 2, A / 2);
            x != c && (ot(this, 'render', x, a, p), c.drawImage(x.canvas, -r, -v), x.translate(-r, -v));
            x.globalAlpha = y;
        }
        q && c.restore();
        this.Ue(c, a, b, p);
    };
    ut.prototype.Aa = function (a, b, c, d, e) {
        if (this.i) {
            var f = this.a, g = {};
            return this.i.Aa(a, b.viewState.resolution, b.viewState.rotation, c, {}, function (a) {
                var b = w(a).toString();
                if (!(b in g))
                    return g[b] = !0, d.call(e, a, f);
            });
        }
    };
    ut.prototype.A = function () {
        ft(this);
    };
    ut.prototype.qd = function (a) {
        function b(a) {
            var b, d = a.Nc();
            d ? b = d.call(a, m) : (d = c.i) && (b = d(a, m));
            if (b) {
                if (b) {
                    d = !1;
                    if (Array.isArray(b))
                        for (var e = 0, f = b.length; e < f; ++e)
                            d = st(q, a, b[e], rt(m, p), this.A, this) || d;
                    else
                        d = st(q, a, b, rt(m, p), this.A, this) || d;
                    a = d;
                } else
                    a = !1;
                this.c = this.c || a;
            }
        }
        var c = this.a, d = c.la();
        it(a.attributions, d.l);
        jt(a, d);
        var e = a.viewHints[0], f = a.viewHints[1], g = c.ea, h = c.ia;
        if (!this.c && !g && e || !h && f)
            return !0;
        var l = a.extent, h = a.viewState, e = h.projection, m = h.resolution, p = a.pixelRatio, f = c.f, n = c.c, g = c.get(vt);
        void 0 === g && (g = qt);
        l = Ka(l, n * m);
        n = h.projection.D();
        d.G && h.projection.a && !Ta(n, a.extent) && (a = Math.max(hb(l) / 2, hb(n)), l[0] = n[0] - a, l[2] = n[2] + a);
        if (!this.c && this.o == m && this.u == f && this.j == g && Ta(this.l, l))
            return !0;
        this.i = null;
        this.c = !1;
        var q = new Ws(0.5 * m / p, l, m, d.Ha, c.c);
        d.Ud(l, m, e);
        if (g) {
            var r = [];
            d.ac(l, function (a) {
                r.push(a);
            }, this);
            r.sort(g);
            r.forEach(b, this);
        } else
            d.ac(l, b, this);
        $s(q);
        this.o = m;
        this.u = f;
        this.j = g;
        this.l = l;
        this.i = q;
        return !0;
    };
    function wt() {
        this.b = 'precision mediump float;varying vec2 a;uniform float f;uniform sampler2D g;void main(void){vec4 texColor=texture2D(g,a);gl_FragColor.rgb=texColor.rgb;gl_FragColor.a=texColor.a*f;}';
    }
    u(wt, hi);
    var xt = new wt();
    function yt() {
        this.b = 'varying vec2 a;attribute vec2 b;attribute vec2 c;uniform mat4 d;uniform mat4 e;void main(void){gl_Position=e*vec4(b,0.,1.);a=(d*vec4(c,0.,1.)).st;}';
    }
    u(yt, ii);
    var zt = new yt();
    function At(a, b) {
        this.f = a.getUniformLocation(b, 'f');
        this.c = a.getUniformLocation(b, 'e');
        this.g = a.getUniformLocation(b, 'd');
        this.i = a.getUniformLocation(b, 'g');
        this.b = a.getAttribLocation(b, 'b');
        this.a = a.getAttribLocation(b, 'c');
    }
    function Bt(a, b) {
        dt.call(this, b);
        this.c = a;
        this.Y = new yi([
            -1,
            -1,
            0,
            0,
            1,
            -1,
            1,
            0,
            -1,
            1,
            0,
            1,
            1,
            1,
            1,
            1
        ]);
        this.g = this.Fb = null;
        this.l = void 0;
        this.v = wh();
        this.u = wh();
        this.C = oi();
        this.I = null;
    }
    u(Bt, dt);
    function Ct(a, b, c) {
        var d = a.c.f;
        if (void 0 === a.l || a.l != c) {
            b.postRenderFunctions.push(function (a, b, c) {
                a.isContextLost() || (a.deleteFramebuffer(b), a.deleteTexture(c));
            }.bind(null, d, a.g, a.Fb));
            b = Li(d, c, c);
            var e = d.createFramebuffer();
            d.bindFramebuffer(36160, e);
            d.framebufferTexture2D(36160, 36064, 3553, b, 0);
            a.Fb = b;
            a.g = e;
            a.l = c;
        } else
            d.bindFramebuffer(36160, a.g);
    }
    Bt.prototype.ai = function (a, b, c) {
        Dt(this, 'precompose', c, a);
        ri(c, 34962, this.Y);
        var d = c.b, e = Ci(c, xt, zt), f;
        this.I ? f = this.I : this.I = f = new At(d, e);
        c.Rc(e) && (d.enableVertexAttribArray(f.b), d.vertexAttribPointer(f.b, 2, 5126, !1, 16, 0), d.enableVertexAttribArray(f.a), d.vertexAttribPointer(f.a, 2, 5126, !1, 16, 8), d.uniform1i(f.i, 0));
        d.uniformMatrix4fv(f.g, !1, pi(this.C, this.v));
        d.uniformMatrix4fv(f.c, !1, pi(this.C, this.u));
        d.uniform1f(f.f, b.opacity);
        d.bindTexture(3553, this.Fb);
        d.drawArrays(5, 0, 4);
        Dt(this, 'postcompose', c, a);
    };
    function Dt(a, b, c, d) {
        a = a.a;
        if (Ec(a, b)) {
            var e = d.viewState;
            a.b(new Mh(b, new ik(c, e.center, e.resolution, e.rotation, d.size, d.extent, d.pixelRatio), d, null, c));
        }
    }
    Bt.prototype.$f = function () {
        this.g = this.Fb = null;
        this.l = void 0;
    };
    function Et(a, b) {
        Bt.call(this, a, b);
        this.o = !1;
        this.S = -1;
        this.R = NaN;
        this.A = Ia();
        this.j = this.i = this.G = null;
    }
    u(Et, Bt);
    k = Et.prototype;
    k.ai = function (a, b, c) {
        this.j = b;
        var d = a.viewState, e = this.i, f = a.size, g = a.pixelRatio, h = this.c.f;
        e && !e.f() && (h.enable(h.SCISSOR_TEST), h.scissor(0, 0, f[0] * g, f[1] * g), e.i(c, d.center, d.resolution, d.rotation, f, g, b.opacity, b.De ? a.skippedFeatureUids : {}), h.disable(h.SCISSOR_TEST));
    };
    k.ra = function () {
        var a = this.i;
        a && (ck(a, this.c.i)(), this.i = null);
        Bt.prototype.ra.call(this);
    };
    k.Aa = function (a, b, c, d, e) {
        if (this.i && this.j) {
            c = b.viewState;
            var f = this.a, g = {};
            return this.i.Aa(a, this.c.i, c.center, c.resolution, c.rotation, b.size, b.pixelRatio, this.j.opacity, {}, function (a) {
                var b = w(a).toString();
                if (!(b in g))
                    return g[b] = !0, d.call(e, a, f);
            });
        }
    };
    k.Ke = function (a, b) {
        if (this.i && this.j) {
            var c = b.viewState;
            return hk(this.i, a, this.c.i, c.resolution, c.rotation, b.pixelRatio, this.j.opacity, b.skippedFeatureUids);
        }
        return !1;
    };
    k.Zf = function (a, b, c, d) {
        a = Bh(b.pixelToCoordinateTransform, a.slice());
        if (this.Ke(a, b))
            return c.call(d, this.a, null);
    };
    k.bi = function () {
        ft(this);
    };
    k.ag = function (a, b, c) {
        function d(a) {
            var b, c = a.Nc();
            c ? b = c.call(a, m) : (c = e.i) && (b = c(a, m));
            if (b) {
                if (b) {
                    c = !1;
                    if (Array.isArray(b))
                        for (var d = b.length - 1; 0 <= d; --d)
                            c = st(q, a, b[d], rt(m, p), this.bi, this) || c;
                    else
                        c = st(q, a, b, rt(m, p), this.bi, this) || c;
                    a = c;
                } else
                    a = !1;
                this.o = this.o || a;
            }
        }
        var e = this.a;
        b = e.la();
        it(a.attributions, b.l);
        jt(a, b);
        var f = a.viewHints[0], g = a.viewHints[1], h = e.ea, l = e.ia;
        if (!this.o && !h && f || !l && g)
            return !0;
        var g = a.extent, h = a.viewState, f = h.projection, m = h.resolution, p = a.pixelRatio, h = e.f, n = e.c, l = e.get(vt);
        void 0 === l && (l = qt);
        g = Ka(g, n * m);
        if (!this.o && this.R == m && this.S == h && this.G == l && Ta(this.A, g))
            return !0;
        this.i && a.postRenderFunctions.push(ck(this.i, c));
        this.o = !1;
        var q = new bk(0.5 * m / p, g, e.c);
        b.Ud(g, m, f);
        if (l) {
            var r = [];
            b.ac(g, function (a) {
                r.push(a);
            }, this);
            r.sort(l);
            r.forEach(d, this);
        } else
            b.ac(g, d, this);
        dk(q, c);
        this.R = m;
        this.S = h;
        this.G = l;
        this.A = g;
        this.i = q;
        return !0;
    };
    function R(a) {
        a = a ? a : {};
        var b = pb({}, a);
        delete b.style;
        delete b.renderBuffer;
        delete b.updateWhileAnimating;
        delete b.updateWhileInteracting;
        rh.call(this, b);
        this.c = void 0 !== a.renderBuffer ? a.renderBuffer : 100;
        this.A = null;
        this.i = void 0;
        this.g(a.style);
        this.ea = void 0 !== a.updateWhileAnimating ? a.updateWhileAnimating : !1;
        this.ia = void 0 !== a.updateWhileInteracting ? a.updateWhileInteracting : !1;
    }
    u(R, rh);
    R.prototype.Dd = function (a) {
        var b = null, c = a.T();
        'canvas' === c ? b = new ut(this) : 'webgl' === c && (b = new Et(a, this));
        return b;
    };
    R.prototype.C = function () {
        return this.A;
    };
    R.prototype.G = function () {
        return this.i;
    };
    R.prototype.g = function (a) {
        this.A = void 0 !== a ? a : dl;
        this.i = null === a ? void 0 : bl(this.A);
        this.s();
    };
    var vt = 'renderOrder';
    function Ft() {
        return [[
                -Infinity,
                -Infinity,
                Infinity,
                Infinity
            ]];
    }
    function Gt(a) {
        Gc.call(this);
        this.c = Gb(a.projection);
        this.l = Ht(a.attributions);
        this.R = a.logo;
        this.Ja = void 0 !== a.state ? a.state : 'ready';
        this.G = void 0 !== a.wrapX ? a.wrapX : !1;
    }
    u(Gt, Gc);
    function Ht(a) {
        if ('string' === typeof a)
            return [new nc({ html: a })];
        if (a instanceof nc)
            return [a];
        if (Array.isArray(a)) {
            for (var b = a.length, c = Array(b), d = 0; d < b; d++) {
                var e = a[d];
                c[d] = 'string' === typeof e ? new nc({ html: e }) : e;
            }
            return c;
        }
        return null;
    }
    k = Gt.prototype;
    k.Aa = na;
    k.xa = function () {
        return this.l;
    };
    k.wa = function () {
        return this.R;
    };
    k.ya = function () {
        return this.c;
    };
    k.V = function () {
        return this.Ja;
    };
    k.va = function () {
        this.s();
    };
    k.ua = function (a) {
        this.l = Ht(a);
        this.s();
    };
    function It(a, b) {
        a.Ja = b;
        a.s();
    }
    function S(a) {
        a = a || {};
        Gt.call(this, {
            attributions: a.attributions,
            logo: a.logo,
            projection: void 0,
            state: 'ready',
            wrapX: void 0 !== a.wrapX ? a.wrapX : !0
        });
        this.Y = na;
        this.S = a.format;
        this.Ha = void 0 == a.overlaps ? !0 : a.overlaps;
        this.ea = a.url;
        a.loader ? this.Y = a.loader : void 0 !== this.ea && (qa(this.S, 7), this.Y = Bl(this.ea, this.S));
        this.Bd = a.strategy ? a.strategy : Ft;
        var b = void 0 !== a.useSpatialIndex ? a.useSpatialIndex : !0;
        this.a = b ? new Ej() : null;
        this.oa = new Ej();
        this.g = {};
        this.j = {};
        this.o = {};
        this.v = {};
        this.i = null;
        var c, d;
        a.features instanceof D ? (c = a.features, d = c.a) : Array.isArray(a.features) && (d = a.features);
        b || c || (c = new D(d));
        d && Jt(this, d);
        c && Kt(this, c);
    }
    u(S, Gt);
    k = S.prototype;
    k.zb = function (a) {
        var b = w(a).toString();
        if (Lt(this, b, a)) {
            Mt(this, b, a);
            var c = a.U();
            c ? (b = c.D(), this.a && this.a.Ea(b, a)) : this.g[b] = a;
            this.b(new Nt('addfeature', a));
        }
        this.s();
    };
    function Mt(a, b, c) {
        a.v[b] = [
            B(c, 'change', a.ji, a),
            B(c, 'propertychange', a.ji, a)
        ];
    }
    function Lt(a, b, c) {
        var d = !0, e = c.a;
        void 0 !== e ? e.toString() in a.j ? d = !1 : a.j[e.toString()] = c : (qa(!(b in a.o), 30), a.o[b] = c);
        return d;
    }
    k.dd = function (a) {
        Jt(this, a);
        this.s();
    };
    function Jt(a, b) {
        var c, d, e, f, g = [], h = [], l = [];
        d = 0;
        for (e = b.length; d < e; d++)
            f = b[d], c = w(f).toString(), Lt(a, c, f) && h.push(f);
        d = 0;
        for (e = h.length; d < e; d++) {
            f = h[d];
            c = w(f).toString();
            Mt(a, c, f);
            var m = f.U();
            m ? (c = m.D(), g.push(c), l.push(f)) : a.g[c] = f;
        }
        a.a && a.a.load(g, l);
        d = 0;
        for (e = h.length; d < e; d++)
            a.b(new Nt('addfeature', h[d]));
    }
    function Kt(a, b) {
        var c = !1;
        B(a, 'addfeature', function (a) {
            c || (c = !0, b.push(a.feature), c = !1);
        });
        B(a, 'removefeature', function (a) {
            c || (c = !0, b.remove(a.feature), c = !1);
        });
        B(b, 'add', function (a) {
            c || (c = !0, this.zb(a.element), c = !1);
        }, a);
        B(b, 'remove', function (a) {
            c || (c = !0, this.Db(a.element), c = !1);
        }, a);
        a.i = b;
    }
    k.clear = function (a) {
        if (a) {
            for (var b in this.v)
                this.v[b].forEach(rc);
            this.i || (this.v = {}, this.j = {}, this.o = {});
        } else if (this.a) {
            this.a.forEach(this.ug, this);
            for (var c in this.g)
                this.ug(this.g[c]);
        }
        this.i && this.i.clear();
        this.a && this.a.clear();
        this.oa.clear();
        this.g = {};
        this.b(new Nt('clear'));
        this.s();
    };
    k.bh = function (a, b) {
        if (this.a)
            return this.a.forEach(a, b);
        if (this.i)
            return this.i.forEach(a, b);
    };
    function Ot(a, b, c) {
        a.ac([
            b[0],
            b[1],
            b[0],
            b[1]
        ], function (a) {
            if (a.U().sb(b))
                return c.call(void 0, a);
        });
    }
    k.ac = function (a, b, c) {
        if (this.a)
            return Jj(this.a, a, b, c);
        if (this.i)
            return this.i.forEach(b, c);
    };
    k.dh = function (a, b, c) {
        return this.ac(a, function (d) {
            if (d.U().Xa(a) && (d = b.call(c, d)))
                return d;
        });
    };
    k.lh = function () {
        return this.i;
    };
    k.Ne = function () {
        var a;
        this.i ? a = this.i.a : this.a && (a = Gj(this.a), sb(this.g) || ga(a, rb(this.g)));
        return a;
    };
    k.kh = function (a) {
        var b = [];
        Ot(this, a, function (a) {
            b.push(a);
        });
        return b;
    };
    k.Hf = function (a) {
        return Hj(this.a, a);
    };
    k.gh = function (a, b) {
        var c = a[0], d = a[1], e = null, f = [
                NaN,
                NaN
            ], g = Infinity, h = [
                -Infinity,
                -Infinity,
                Infinity,
                Infinity
            ], l = b ? b : af;
        Jj(this.a, h, function (a) {
            if (l(a)) {
                var b = a.U(), m = g;
                g = b.Gb(c, d, f, g);
                g < m && (e = a, a = Math.sqrt(g), h[0] = c - a, h[1] = d - a, h[2] = c + a, h[3] = d + a);
            }
        });
        return e;
    };
    k.D = function () {
        return this.a.D();
    };
    k.jh = function (a) {
        a = this.j[a.toString()];
        return void 0 !== a ? a : null;
    };
    k.hi = function () {
        return this.S;
    };
    k.ii = function () {
        return this.ea;
    };
    k.ji = function (a) {
        a = a.target;
        var b = w(a).toString(), c = a.U();
        c ? (c = c.D(), b in this.g ? (delete this.g[b], this.a && this.a.Ea(c, a)) : this.a && Fj(this.a, c, a)) : b in this.g || (this.a && this.a.remove(a), this.g[b] = a);
        c = a.a;
        void 0 !== c ? (c = c.toString(), b in this.o ? (delete this.o[b], this.j[c] = a) : this.j[c] !== a && (Pt(this, a), this.j[c] = a)) : b in this.o || (Pt(this, a), this.o[b] = a);
        this.s();
        this.b(new Nt('changefeature', a));
    };
    k.Ud = function (a, b, c) {
        var d = this.oa;
        a = this.Bd(a, b);
        var e, f;
        e = 0;
        for (f = a.length; e < f; ++e) {
            var g = a[e];
            Jj(d, g, function (a) {
                return Ta(a.extent, g);
            }) || (this.Y.call(this, g, b, c), d.Ea(g, { extent: g.slice() }));
        }
    };
    k.Db = function (a) {
        var b = w(a).toString();
        b in this.g ? delete this.g[b] : this.a && this.a.remove(a);
        this.ug(a);
        this.s();
    };
    k.ug = function (a) {
        var b = w(a).toString();
        this.v[b].forEach(rc);
        delete this.v[b];
        var c = a.a;
        void 0 !== c ? delete this.j[c.toString()] : delete this.o[b];
        this.b(new Nt('removefeature', a));
    };
    function Pt(a, b) {
        for (var c in a.j)
            if (a.j[c] === b) {
                delete a.j[c];
                break;
            }
    }
    function Nt(a, b) {
        Bc.call(this, a);
        this.feature = b;
    }
    u(Nt, Bc);
    function Qt(a) {
        pg.call(this, {
            handleDownEvent: Rt,
            handleEvent: St,
            handleUpEvent: Tt
        });
        this.ea = null;
        this.u = !1;
        this.lb = a.source ? a.source : null;
        this.Ha = a.features ? a.features : null;
        this.ak = a.snapTolerance ? a.snapTolerance : 12;
        this.S = a.type;
        this.g = Ut(this.S);
        this.Ja = a.minPoints ? a.minPoints : this.g === Vt ? 3 : 2;
        this.oa = a.maxPoints ? a.maxPoints : Infinity;
        this.Bd = a.finishCondition ? a.finishCondition : af;
        var b = a.geometryFunction;
        if (!b)
            if ('Circle' === this.S)
                b = function (a, b) {
                    var c = b ? b : new is([
                        NaN,
                        NaN
                    ]);
                    c.yg(a[0], Math.sqrt(Xe(a[0], a[1])));
                    return c;
                };
            else {
                var c, d = this.g;
                d === Wt ? c = E : d === Xt ? c = M : d === Vt && (c = F);
                b = function (a, b) {
                    var e = b;
                    e ? d === Vt ? e.pa([a[0].concat([a[0][0]])]) : e.pa(a) : e = new c(a);
                    return e;
                };
            }
        this.Ra = b;
        this.R = this.C = this.a = this.G = this.j = this.o = null;
        this.mb = a.clickTolerance ? a.clickTolerance * a.clickTolerance : 36;
        this.ia = new R({
            source: new S({
                useSpatialIndex: !1,
                wrapX: a.wrapX ? a.wrapX : !1
            }),
            style: a.style ? a.style : Yt()
        });
        this.Oa = a.geometryName;
        this.Yj = a.condition ? a.condition : kg;
        this.rf = a.freehand ? af : a.freehandCondition ? a.freehandCondition : lg;
        B(this, Ic('active'), this.aj, this);
    }
    u(Qt, pg);
    function Yt() {
        var a = el();
        return function (b) {
            return a[b.U().T()];
        };
    }
    k = Qt.prototype;
    k.setMap = function (a) {
        pg.prototype.setMap.call(this, a);
        this.aj();
    };
    function St(a) {
        this.u = this.g !== Wt && this.rf(a);
        var b = !this.u;
        this.u && 'pointerdrag' === a.type && null !== this.j ? (Zt(this, a), b = !1) : 'pointermove' === a.type ? b = $t(this, a) : 'dblclick' === a.type && (b = !1);
        return qg.call(this, a) && b;
    }
    function Rt(a) {
        return this.u ? (this.ea = a.pixel, this.o || au(this, a), !0) : this.Yj(a) ? (this.ea = a.pixel, !0) : !1;
    }
    function Tt(a) {
        var b = this.ea, c = a.pixel, d = b[0] - c[0], b = b[1] - c[1], d = d * d + b * b, b = !0, c = this.g === bu;
        (this.u ? d > this.mb : d <= this.mb) ? ($t(this, a), this.o ? this.u || c ? this.Nd() : cu(this, a) ? this.Bd(a) && this.Nd() : Zt(this, a) : (au(this, a), this.g === Wt && this.Nd()), b = !1) : c && (this.o = null);
        return b;
    }
    function $t(a, b) {
        if (a.o) {
            var c = b.coordinate, d = a.j.U(), e;
            a.g === Wt ? e = a.a : a.g === Vt ? (e = a.a[0], e = e[e.length - 1], cu(a, b) && (c = a.o.slice())) : (e = a.a, e = e[e.length - 1]);
            e[0] = c[0];
            e[1] = c[1];
            a.Ra(a.a, d);
            a.G && a.G.U().pa(c);
            d instanceof F && a.g !== Vt ? (a.C || (a.C = new H(new M(null))), d = d.nh(0), c = a.C.U(), c.ca(d.ka, d.ha())) : a.R && (c = a.C.U(), c.pa(a.R));
            du(a);
        } else
            c = b.coordinate.slice(), a.G ? a.G.U().pa(c) : (a.G = new H(new E(c)), du(a));
        return !0;
    }
    function cu(a, b) {
        var c = !1;
        if (a.j) {
            var d = !1, e = [a.o];
            a.g === Xt ? d = a.a.length > a.Ja : a.g === Vt && (d = a.a[0].length > a.Ja, e = [
                a.a[0][0],
                a.a[0][a.a[0].length - 2]
            ]);
            if (d)
                for (var d = b.map, f = 0, g = e.length; f < g; f++) {
                    var h = e[f], l = d.Ka(h), m = b.pixel, c = m[0] - l[0], l = m[1] - l[1];
                    if (c = Math.sqrt(c * c + l * l) <= (a.u ? 1 : a.ak)) {
                        a.o = h;
                        break;
                    }
                }
        }
        return c;
    }
    function au(a, b) {
        var c = b.coordinate;
        a.o = c;
        a.g === Wt ? a.a = c.slice() : a.g === Vt ? (a.a = [[
                c.slice(),
                c.slice()
            ]], a.R = a.a[0]) : (a.a = [
            c.slice(),
            c.slice()
        ], a.g === bu && (a.R = a.a));
        a.R && (a.C = new H(new M(a.R)));
        c = a.Ra(a.a);
        a.j = new H();
        a.Oa && a.j.Vc(a.Oa);
        a.j.Sa(c);
        du(a);
        a.b(new eu('drawstart', a.j));
    }
    function Zt(a, b) {
        var c = b.coordinate, d = a.j.U(), e, f;
        a.g === Xt ? (a.o = c.slice(), f = a.a, f.length >= a.oa && (a.u ? f.pop() : e = !0), f.push(c.slice()), a.Ra(f, d)) : a.g === Vt && (f = a.a[0], f.length >= a.oa && (a.u ? f.pop() : e = !0), f.push(c.slice()), e && (a.o = f[0]), a.Ra(a.a, d));
        du(a);
        e && a.Nd();
    }
    k.cp = function () {
        var a = this.j.U(), b, c;
        this.g === Xt ? (b = this.a, b.splice(-2, 1), this.Ra(b, a)) : this.g === Vt && (b = this.a[0], b.splice(-2, 1), c = this.C.U(), c.pa(b), this.Ra(this.a, a));
        0 === b.length && (this.o = null);
        du(this);
    };
    k.Nd = function () {
        var a = fu(this), b = this.a, c = a.U();
        this.g === Xt ? (b.pop(), this.Ra(b, c)) : this.g === Vt && (b[0].pop(), this.Ra(b, c), b = c.X());
        'MultiPoint' === this.S ? a.Sa(new O([b])) : 'MultiLineString' === this.S ? a.Sa(new N([b])) : 'MultiPolygon' === this.S && a.Sa(new P([b]));
        this.b(new eu('drawend', a));
        this.Ha && this.Ha.push(a);
        this.lb && this.lb.zb(a);
    };
    function fu(a) {
        a.o = null;
        var b = a.j;
        b && (a.j = null, a.G = null, a.C = null, a.ia.la().clear(!0));
        return b;
    }
    k.Om = function (a) {
        var b = a.U();
        this.j = a;
        this.a = b.X();
        a = this.a[this.a.length - 1];
        this.o = a.slice();
        this.a.push(a.slice());
        du(this);
        this.b(new eu('drawstart', this.j));
    };
    k.Zc = bf;
    function du(a) {
        var b = [];
        a.j && b.push(a.j);
        a.C && b.push(a.C);
        a.G && b.push(a.G);
        a = a.ia.la();
        a.clear(!0);
        a.dd(b);
    }
    k.aj = function () {
        var a = this.v, b = this.c();
        a && b || fu(this);
        this.ia.setMap(b ? a : null);
    };
    function Ut(a) {
        var b;
        'Point' === a || 'MultiPoint' === a ? b = Wt : 'LineString' === a || 'MultiLineString' === a ? b = Xt : 'Polygon' === a || 'MultiPolygon' === a ? b = Vt : 'Circle' === a && (b = bu);
        return b;
    }
    var Wt = 'Point', Xt = 'LineString', Vt = 'Polygon', bu = 'Circle';
    function eu(a, b) {
        Bc.call(this, a);
        this.feature = b;
    }
    u(eu, Bc);
    function gu(a) {
        this.a = this.j = null;
        this.C = !1;
        this.G = this.o = null;
        a || (a = {});
        a.extent && this.g(a.extent);
        pg.call(this, {
            handleDownEvent: hu,
            handleDragEvent: iu,
            handleEvent: ju,
            handleUpEvent: ku
        });
        this.u = new R({
            source: new S({
                useSpatialIndex: !1,
                wrapX: !!a.wrapX
            }),
            style: a.boxStyle ? a.boxStyle : lu(),
            updateWhileAnimating: !0,
            updateWhileInteracting: !0
        });
        this.R = new R({
            source: new S({
                useSpatialIndex: !1,
                wrapX: !!a.wrapX
            }),
            style: a.pointerStyle ? a.pointerStyle : mu(),
            updateWhileAnimating: !0,
            updateWhileInteracting: !0
        });
    }
    u(gu, pg);
    function ju(a) {
        if (!(a instanceof Bd))
            return !0;
        if ('pointermove' == a.type && !this.A) {
            var b = a.pixel, c = a.map, d = nu(this, b, c);
            d || (d = c.Za(b));
            ou(this, d);
        }
        qg.call(this, a);
        return !1;
    }
    function hu(a) {
        function b(a) {
            var b = null, c = null;
            a[0] == e[0] ? b = e[2] : a[0] == e[2] && (b = e[0]);
            a[1] == e[1] ? c = e[3] : a[1] == e[3] && (c = e[1]);
            return null !== b && null !== c ? [
                b,
                c
            ] : null;
        }
        var c = a.pixel, d = a.map, e = this.D();
        (a = nu(this, c, d)) && e ? (c = a[0] == e[0] || a[0] == e[2] ? a[0] : null, d = a[1] == e[1] || a[1] == e[3] ? a[1] : null, null !== c && null !== d ? this.a = pu(b(a)) : null !== c ? this.a = qu(b([
            c,
            e[1]
        ]), b([
            c,
            e[3]
        ])) : null !== d && (this.a = qu(b([
            e[0],
            d
        ]), b([
            e[2],
            d
        ])))) : (a = d.Za(c), this.g([
            a[0],
            a[1],
            a[0],
            a[1]
        ]), this.a = pu(a));
        return !0;
    }
    function iu(a) {
        this.a && (a = a.coordinate, this.g(this.a(a)), ou(this, a));
        return !0;
    }
    function ku() {
        this.a = null;
        var a = this.D();
        a && fb(a) || this.g(null);
        return !1;
    }
    function lu() {
        var a = el();
        return function () {
            return a.Polygon;
        };
    }
    function mu() {
        var a = el();
        return function () {
            return a.Point;
        };
    }
    function pu(a) {
        return function (b) {
            return Ha([
                a,
                b
            ]);
        };
    }
    function qu(a, b) {
        return a[0] == b[0] ? function (c) {
            return Ha([
                a,
                [
                    c[0],
                    b[1]
                ]
            ]);
        } : a[1] == b[1] ? function (c) {
            return Ha([
                a,
                [
                    b[0],
                    c[1]
                ]
            ]);
        } : null;
    }
    function nu(a, b, c) {
        function d(a, b) {
            return Ze(e, a) - Ze(e, b);
        }
        var e = c.Za(b), f = a.D();
        if (f) {
            f = [
                [
                    [
                        f[0],
                        f[1]
                    ],
                    [
                        f[0],
                        f[3]
                    ]
                ],
                [
                    [
                        f[0],
                        f[3]
                    ],
                    [
                        f[2],
                        f[3]
                    ]
                ],
                [
                    [
                        f[2],
                        f[3]
                    ],
                    [
                        f[2],
                        f[1]
                    ]
                ],
                [
                    [
                        f[2],
                        f[1]
                    ],
                    [
                        f[0],
                        f[1]
                    ]
                ]
            ];
            f.sort(d);
            var f = f[0], g = Re(e, f), h = c.Ka(g);
            if (10 >= Ye(b, h))
                return b = c.Ka(f[0]), c = c.Ka(f[1]), b = Xe(h, b), c = Xe(h, c), a.C = 10 >= Math.sqrt(Math.min(b, c)), a.C && (g = b > c ? f[1] : f[0]), g;
        }
        return null;
    }
    function ou(a, b) {
        var c = a.G;
        c ? c.U().pa(b) : (c = new H(new E(b)), a.G = c, a.R.la().zb(c));
    }
    gu.prototype.setMap = function (a) {
        this.u.setMap(a);
        this.R.setMap(a);
        pg.prototype.setMap.call(this, a);
    };
    gu.prototype.D = function () {
        return this.j;
    };
    gu.prototype.g = function (a) {
        this.j = a ? a : null;
        var b = this.o;
        b ? a ? b.Sa(Nf(a)) : b.Sa(void 0) : (this.o = b = a ? new H(Nf(a)) : new H({}), this.u.la().zb(b));
        this.b(new ru(this.j));
    };
    function ru(a) {
        Bc.call(this, su);
        this.b = a;
    }
    u(ru, Bc);
    var su = 'extentchanged';
    function tu(a) {
        pg.call(this, {
            handleDownEvent: uu,
            handleDragEvent: vu,
            handleEvent: wu,
            handleUpEvent: xu
        });
        this.mb = a.condition ? a.condition : og;
        this.Oa = function (a) {
            return kg(a) && jg(a);
        };
        this.lb = a.deleteCondition ? a.deleteCondition : this.Oa;
        this.Ha = this.g = null;
        this.Ja = [
            0,
            0
        ];
        this.C = this.R = !1;
        this.a = new Ej();
        this.ia = void 0 !== a.pixelTolerance ? a.pixelTolerance : 10;
        this.o = this.oa = !1;
        this.j = [];
        this.G = new R({
            source: new S({
                useSpatialIndex: !1,
                wrapX: !!a.wrapX
            }),
            style: a.style ? a.style : yu(),
            updateWhileAnimating: !0,
            updateWhileInteracting: !0
        });
        this.ea = {
            Point: this.Vm,
            LineString: this.Oh,
            LinearRing: this.Oh,
            Polygon: this.Wm,
            MultiPoint: this.Tm,
            MultiLineString: this.Sm,
            MultiPolygon: this.Um,
            Circle: this.Ip,
            GeometryCollection: this.Rm
        };
        this.u = a.features;
        this.u.forEach(this.Yf, this);
        B(this.u, 'add', this.Pm, this);
        B(this.u, 'remove', this.Qm, this);
        this.S = null;
    }
    u(tu, pg);
    k = tu.prototype;
    k.Yf = function (a) {
        var b = a.U();
        b && b.T() in this.ea && this.ea[b.T()].call(this, a, b);
        (b = this.v) && b.a && this.c() && zu(this, this.Ja, b);
        B(a, 'change', this.Nh, this);
    };
    function Au(a, b) {
        a.C || (a.C = !0, a.b(new Bu('modifystart', a.u, b)));
    }
    function Cu(a, b) {
        Du(a, b);
        a.g && !a.u.ec() && (a.G.la().Db(a.g), a.g = null);
        xc(b, 'change', a.Nh, a);
    }
    function Du(a, b) {
        var c = a.a, d = [];
        c.forEach(function (a) {
            b === a.feature && d.push(a);
        });
        for (var e = d.length - 1; 0 <= e; --e)
            c.remove(d[e]);
    }
    k.Ia = function (a) {
        this.g && !a && (this.G.la().Db(this.g), this.g = null);
        pg.prototype.Ia.call(this, a);
    };
    k.setMap = function (a) {
        this.G.setMap(a);
        pg.prototype.setMap.call(this, a);
    };
    k.Pm = function (a) {
        this.Yf(a.element);
    };
    k.Nh = function (a) {
        this.o || (a = a.target, Cu(this, a), this.Yf(a));
    };
    k.Qm = function (a) {
        Cu(this, a.element);
    };
    k.Vm = function (a, b) {
        var c = b.X(), c = {
                feature: a,
                geometry: b,
                na: [
                    c,
                    c
                ]
            };
        this.a.Ea(b.D(), c);
    };
    k.Tm = function (a, b) {
        var c = b.X(), d, e, f;
        e = 0;
        for (f = c.length; e < f; ++e)
            d = c[e], d = {
                feature: a,
                geometry: b,
                depth: [e],
                index: e,
                na: [
                    d,
                    d
                ]
            }, this.a.Ea(b.D(), d);
    };
    k.Oh = function (a, b) {
        var c = b.X(), d, e, f, g;
        d = 0;
        for (e = c.length - 1; d < e; ++d)
            f = c.slice(d, d + 2), g = {
                feature: a,
                geometry: b,
                index: d,
                na: f
            }, this.a.Ea(Ha(f), g);
    };
    k.Sm = function (a, b) {
        var c = b.X(), d, e, f, g, h, l, m;
        g = 0;
        for (h = c.length; g < h; ++g)
            for (d = c[g], e = 0, f = d.length - 1; e < f; ++e)
                l = d.slice(e, e + 2), m = {
                    feature: a,
                    geometry: b,
                    depth: [g],
                    index: e,
                    na: l
                }, this.a.Ea(Ha(l), m);
    };
    k.Wm = function (a, b) {
        var c = b.X(), d, e, f, g, h, l, m;
        g = 0;
        for (h = c.length; g < h; ++g)
            for (d = c[g], e = 0, f = d.length - 1; e < f; ++e)
                l = d.slice(e, e + 2), m = {
                    feature: a,
                    geometry: b,
                    depth: [g],
                    index: e,
                    na: l
                }, this.a.Ea(Ha(l), m);
    };
    k.Um = function (a, b) {
        var c = b.X(), d, e, f, g, h, l, m, p, n, q;
        l = 0;
        for (m = c.length; l < m; ++l)
            for (p = c[l], g = 0, h = p.length; g < h; ++g)
                for (d = p[g], e = 0, f = d.length - 1; e < f; ++e)
                    n = d.slice(e, e + 2), q = {
                        feature: a,
                        geometry: b,
                        depth: [
                            g,
                            l
                        ],
                        index: e,
                        na: n
                    }, this.a.Ea(Ha(n), q);
    };
    k.Ip = function (a, b) {
        var c = b.Ba(), d = {
                feature: a,
                geometry: b,
                index: 0,
                na: [
                    c,
                    c
                ]
            }, e = {
                feature: a,
                geometry: b,
                index: 1,
                na: [
                    c,
                    c
                ]
            };
        d.Ef = e.Ef = [
            d,
            e
        ];
        this.a.Ea(Wa(c), d);
        this.a.Ea(b.D(), e);
    };
    k.Rm = function (a, b) {
        var c, d = b.a;
        for (c = 0; c < d.length; ++c)
            this.ea[d[c].T()].call(this, a, d[c]);
    };
    function Eu(a, b) {
        var c = a.g;
        c ? c.U().pa(b) : (c = new H(new E(b)), a.g = c, a.G.la().zb(c));
    }
    function Fu(a, b) {
        return a.index - b.index;
    }
    function uu(a) {
        if (!this.mb(a))
            return !1;
        zu(this, a.pixel, a.map);
        this.j.length = 0;
        this.C = !1;
        var b = this.g;
        if (b) {
            var c = [], b = b.U().X(), d = Ha([b]), d = Hj(this.a, d), e = {};
            d.sort(Fu);
            for (var f = 0, g = d.length; f < g; ++f) {
                var h = d[f], l = h.na, m = w(h.feature), p = h.depth;
                p && (m += '-' + p.join('-'));
                e[m] || (e[m] = Array(2));
                if ('Circle' === h.geometry.T() && 1 === h.index)
                    l = Gu(b, h), Ue(l, b) && !e[m][0] && (this.j.push([
                        h,
                        0
                    ]), e[m][0] = h);
                else if (Ue(l[0], b) && !e[m][0])
                    this.j.push([
                        h,
                        0
                    ]), e[m][0] = h;
                else if (Ue(l[1], b) && !e[m][1]) {
                    if ('LineString' !== h.geometry.T() && 'MultiLineString' !== h.geometry.T() || !e[m][0] || 0 !== e[m][0].index)
                        this.j.push([
                            h,
                            1
                        ]), e[m][1] = h;
                } else
                    w(l) in this.Ha && !e[m][0] && !e[m][1] && c.push([
                        h,
                        b
                    ]);
            }
            c.length && Au(this, a);
            for (a = c.length - 1; 0 <= a; --a)
                this.Il.apply(this, c[a]);
        }
        return !!this.g;
    }
    function vu(a) {
        this.R = !1;
        Au(this, a);
        a = a.coordinate;
        for (var b = 0, c = this.j.length; b < c; ++b) {
            for (var d = this.j[b], e = d[0], f = e.depth, g = e.geometry, h, l = e.na, d = d[1]; a.length < g.sa();)
                a.push(l[d][a.length]);
            switch (g.T()) {
            case 'Point':
                h = a;
                l[0] = l[1] = a;
                break;
            case 'MultiPoint':
                h = g.X();
                h[e.index] = a;
                l[0] = l[1] = a;
                break;
            case 'LineString':
                h = g.X();
                h[e.index + d] = a;
                l[d] = a;
                break;
            case 'MultiLineString':
                h = g.X();
                h[f[0]][e.index + d] = a;
                l[d] = a;
                break;
            case 'Polygon':
                h = g.X();
                h[f[0]][e.index + d] = a;
                l[d] = a;
                break;
            case 'MultiPolygon':
                h = g.X();
                h[f[1]][f[0]][e.index + d] = a;
                l[d] = a;
                break;
            case 'Circle':
                l[0] = l[1] = a, 0 === e.index ? (this.o = !0, g.wb(a)) : (this.o = !0, g.Wc(Ye(g.Ba(), a))), this.o = !1;
            }
            h && (e = g, f = h, this.o = !0, e.pa(f), this.o = !1);
        }
        Eu(this, a);
    }
    function xu(a) {
        for (var b, c, d = this.j.length - 1; 0 <= d; --d)
            if (b = this.j[d][0], c = b.geometry, 'Circle' === c.T()) {
                var e = c.Ba(), f = b.Ef[0];
                b = b.Ef[1];
                f.na[0] = f.na[1] = e;
                b.na[0] = b.na[1] = e;
                Fj(this.a, Wa(e), f);
                Fj(this.a, c.D(), b);
            } else
                Fj(this.a, Ha(b.na), b);
        this.C && (this.b(new Bu('modifyend', this.u, a)), this.C = !1);
        return !1;
    }
    function wu(a) {
        if (!(a instanceof Bd))
            return !0;
        this.S = a;
        var b;
        ld(a.map.$())[1] || 'pointermove' != a.type || this.A || (this.Ja = a.pixel, zu(this, a.pixel, a.map));
        this.g && this.lb(a) && (b = 'singleclick' == a.type && this.R ? !0 : this.Ci());
        'singleclick' == a.type && (this.R = !1);
        return qg.call(this, a) && !b;
    }
    function zu(a, b, c) {
        function d(a, b) {
            return Hu(e, a) - Hu(e, b);
        }
        var e = c.Za(b), f = Ka(Wa(e), c.$().Ua() * a.ia), f = Hj(a.a, f);
        if (0 < f.length) {
            f.sort(d);
            var g = f[0], h = g.na, l = Gu(e, g), m = c.Ka(l), p = Ye(b, m);
            if (p <= a.ia) {
                b = {};
                if ('Circle' === g.geometry.T() && 1 === g.index)
                    a.oa = !0, Eu(a, l);
                else
                    for (p = c.Ka(h[0]), g = c.Ka(h[1]), c = Xe(m, p), m = Xe(m, g), p = Math.sqrt(Math.min(c, m)), a.oa = p <= a.ia, a.oa && (l = c > m ? h[1] : h[0]), Eu(a, l), m = 1, c = f.length; m < c; ++m)
                        if (l = f[m].na, Ue(h[0], l[0]) && Ue(h[1], l[1]) || Ue(h[0], l[1]) && Ue(h[1], l[0]))
                            b[w(l)] = !0;
                        else
                            break;
                b[w(h)] = !0;
                a.Ha = b;
                return;
            }
        }
        a.g && (a.G.la().Db(a.g), a.g = null);
    }
    function Hu(a, b) {
        var c = b.geometry;
        if ('Circle' === c.T() && 1 === b.index) {
            var d = Xe(c.Ba(), a), c = Math.sqrt(d) - c.Vd();
            return c * c;
        }
        return Ze(a, b.na);
    }
    function Gu(a, b) {
        var c = b.geometry;
        return 'Circle' === c.T() && 1 === b.index ? c.Ab(a) : Re(a, b.na);
    }
    k.Il = function (a, b) {
        for (var c = a.na, d = a.feature, e = a.geometry, f = a.depth, g = a.index, h; b.length < e.sa();)
            b.push(0);
        switch (e.T()) {
        case 'MultiLineString':
            h = e.X();
            h[f[0]].splice(g + 1, 0, b);
            break;
        case 'Polygon':
            h = e.X();
            h[f[0]].splice(g + 1, 0, b);
            break;
        case 'MultiPolygon':
            h = e.X();
            h[f[1]][f[0]].splice(g + 1, 0, b);
            break;
        case 'LineString':
            h = e.X();
            h.splice(g + 1, 0, b);
            break;
        default:
            return;
        }
        this.o = !0;
        e.pa(h);
        this.o = !1;
        h = this.a;
        h.remove(a);
        Iu(this, e, g, f, 1);
        var l = {
            na: [
                c[0],
                b
            ],
            feature: d,
            geometry: e,
            depth: f,
            index: g
        };
        h.Ea(Ha(l.na), l);
        this.j.push([
            l,
            1
        ]);
        c = {
            na: [
                b,
                c[1]
            ],
            feature: d,
            geometry: e,
            depth: f,
            index: g + 1
        };
        h.Ea(Ha(c.na), c);
        this.j.push([
            c,
            0
        ]);
        this.R = !0;
    };
    k.Ci = function () {
        if (this.S && 'pointerdrag' != this.S.type) {
            var a = this.S;
            Au(this, a);
            var b = this.j, c = {}, d, e, f, g, h, l, m, p, n;
            for (h = b.length - 1; 0 <= h; --h)
                g = b[h], p = g[0], n = w(p.feature), p.depth && (n += '-' + p.depth.join('-')), n in c || (c[n] = {}), 0 === g[1] ? (c[n].right = p, c[n].index = p.index) : 1 == g[1] && (c[n].left = p, c[n].index = p.index + 1);
            for (n in c) {
                m = c[n].right;
                h = c[n].left;
                g = c[n].index;
                l = g - 1;
                p = void 0 !== h ? h : m;
                0 > l && (l = 0);
                b = p.geometry;
                e = f = b.X();
                d = !1;
                switch (b.T()) {
                case 'MultiLineString':
                    2 < f[p.depth[0]].length && (f[p.depth[0]].splice(g, 1), d = !0);
                    break;
                case 'LineString':
                    2 < f.length && (f.splice(g, 1), d = !0);
                    break;
                case 'MultiPolygon':
                    e = e[p.depth[1]];
                case 'Polygon':
                    e = e[p.depth[0]], 4 < e.length && (g == e.length - 1 && (g = 0), e.splice(g, 1), d = !0, 0 === g && (e.pop(), e.push(e[0]), l = e.length - 1));
                }
                d && (d = b, this.o = !0, d.pa(f), this.o = !1, f = [], void 0 !== h && (this.a.remove(h), f.push(h.na[0])), void 0 !== m && (this.a.remove(m), f.push(m.na[1])), void 0 !== h && void 0 !== m && (h = {
                    depth: p.depth,
                    feature: p.feature,
                    geometry: p.geometry,
                    index: l,
                    na: f
                }, this.a.Ea(Ha(h.na), h)), Iu(this, b, g, p.depth, -1), this.g && (this.G.la().Db(this.g), this.g = null));
            }
            this.b(new Bu('modifyend', this.u, a));
            this.C = !1;
            return !0;
        }
        return !1;
    };
    function Iu(a, b, c, d, e) {
        Jj(a.a, b.D(), function (a) {
            a.geometry === b && (void 0 === d || void 0 === a.depth || ia(a.depth, d)) && a.index > c && (a.index += e);
        });
    }
    function yu() {
        var a = el();
        return function () {
            return a.Point;
        };
    }
    function Bu(a, b, c) {
        Bc.call(this, a);
        this.features = b;
        this.mapBrowserEvent = c;
    }
    u(Bu, Bc);
    function Ju(a) {
        ag.call(this, { handleEvent: Ku });
        a = a ? a : {};
        this.C = a.condition ? a.condition : jg;
        this.A = a.addCondition ? a.addCondition : bf;
        this.G = a.removeCondition ? a.removeCondition : bf;
        this.R = a.toggleCondition ? a.toggleCondition : lg;
        this.o = a.multi ? a.multi : !1;
        this.j = a.filter ? a.filter : af;
        this.l = a.hitTolerance ? a.hitTolerance : 0;
        this.g = new R({
            source: new S({
                useSpatialIndex: !1,
                features: a.features,
                wrapX: a.wrapX
            }),
            style: a.style ? a.style : Lu(),
            updateWhileAnimating: !0,
            updateWhileInteracting: !0
        });
        if (a.layers)
            if ('function' === typeof a.layers)
                a = a.layers;
            else {
                var b = a.layers;
                a = function (a) {
                    return ea(b, a);
                };
            }
        else
            a = af;
        this.u = a;
        this.a = {};
        a = this.g.la().i;
        B(a, 'add', this.Xm, this);
        B(a, 'remove', this.an, this);
    }
    u(Ju, ag);
    k = Ju.prototype;
    k.Ym = function () {
        return this.g.la().i;
    };
    k.Zm = function () {
        return this.l;
    };
    k.$m = function (a) {
        a = w(a);
        return this.a[a];
    };
    function Ku(a) {
        if (!this.C(a))
            return !0;
        var b = this.A(a), c = this.G(a), d = this.R(a), e = !b && !c && !d, f = a.map, g = this.g.la().i, h = [], l = [];
        if (e) {
            qb(this.a);
            f.re(a.pixel, function (a, b) {
                if (this.j(a, b)) {
                    l.push(a);
                    var c = w(a);
                    this.a[c] = b;
                    return !this.o;
                }
            }.bind(this), {
                layerFilter: this.u,
                hitTolerance: this.l
            });
            for (e = g.ec() - 1; 0 <= e; --e) {
                var f = g.item(e), m = l.indexOf(f);
                -1 < m ? l.splice(m, 1) : (g.remove(f), h.push(f));
            }
            l.length && g.Tf(l);
        } else {
            f.re(a.pixel, function (a, e) {
                if (this.j(a, e)) {
                    if (!b && !d || ea(g.a, a))
                        (c || d) && ea(g.a, a) && (h.push(a), f = w(a), delete this.a[f]);
                    else {
                        l.push(a);
                        var f = w(a);
                        this.a[f] = e;
                    }
                    return !this.o;
                }
            }.bind(this), {
                layerFilter: this.u,
                hitTolerance: this.l
            });
            for (e = h.length - 1; 0 <= e; --e)
                g.remove(h[e]);
            g.Tf(l);
        }
        (0 < l.length || 0 < h.length) && this.b(new Mu(Nu, l, h, a));
        return ig(a);
    }
    k.bn = function (a) {
        this.l = a;
    };
    k.setMap = function (a) {
        var b = this.v, c = this.g.la().i;
        b && c.forEach(b.Zi, b);
        ag.prototype.setMap.call(this, a);
        this.g.setMap(a);
        a && c.forEach(a.Ti, a);
    };
    function Lu() {
        var a = el();
        ga(a.Polygon, a.LineString);
        ga(a.GeometryCollection, a.LineString);
        return function (b) {
            return b.U() ? a[b.U().T()] : null;
        };
    }
    k.Xm = function (a) {
        var b = this.v;
        b && b.Ti(a.element);
    };
    k.an = function (a) {
        var b = this.v;
        b && b.Zi(a.element);
    };
    function Mu(a, b, c, d) {
        Bc.call(this, a);
        this.selected = b;
        this.deselected = c;
        this.mapBrowserEvent = d;
    }
    u(Mu, Bc);
    var Nu = 'select';
    function Ou(a) {
        pg.call(this, {
            handleEvent: Pu,
            handleDownEvent: af,
            handleUpEvent: Qu
        });
        a = a ? a : {};
        this.o = a.source ? a.source : null;
        this.ia = void 0 !== a.vertex ? a.vertex : !0;
        this.R = void 0 !== a.edge ? a.edge : !0;
        this.j = a.features ? a.features : null;
        this.oa = [];
        this.C = {};
        this.S = {};
        this.u = {};
        this.G = null;
        this.g = void 0 !== a.pixelTolerance ? a.pixelTolerance : 10;
        this.Ja = Ru.bind(this);
        this.a = new Ej();
        this.ea = {
            Point: this.hn,
            LineString: this.Rh,
            LinearRing: this.Rh,
            Polygon: this.jn,
            MultiPoint: this.fn,
            MultiLineString: this.en,
            MultiPolygon: this.gn,
            GeometryCollection: this.dn
        };
    }
    u(Ou, pg);
    k = Ou.prototype;
    k.zb = function (a, b) {
        var c = void 0 !== b ? b : !0, d = w(a), e = a.U();
        if (e) {
            var f = this.ea[e.T()];
            f && (this.S[d] = e.D(Ia()), f.call(this, a, e));
        }
        c && (this.C[d] = B(a, 'change', this.cn, this));
    };
    k.ek = function (a) {
        this.zb(a);
    };
    k.fk = function (a) {
        this.Db(a);
    };
    k.Ph = function (a) {
        var b;
        a instanceof Nt ? b = a.feature : a instanceof Nc && (b = a.element);
        this.zb(b);
    };
    k.Qh = function (a) {
        var b;
        a instanceof Nt ? b = a.feature : a instanceof Nc && (b = a.element);
        this.Db(b);
    };
    k.cn = function (a) {
        a = a.target;
        if (this.A) {
            var b = w(a);
            b in this.u || (this.u[b] = a);
        } else
            this.$i(a);
    };
    k.Db = function (a, b) {
        var c = void 0 !== b ? b : !0, d = w(a), e = this.S[d];
        if (e) {
            var f = this.a, g = [];
            Jj(f, e, function (b) {
                a === b.feature && g.push(b);
            });
            for (e = g.length - 1; 0 <= e; --e)
                f.remove(g[e]);
        }
        c && (rc(this.C[d]), delete this.C[d]);
    };
    k.setMap = function (a) {
        var b = this.v, c = this.oa, d;
        this.j ? d = this.j : this.o && (d = this.o.Ne());
        b && (c.forEach(rc), c.length = 0, d.forEach(this.fk, this));
        pg.prototype.setMap.call(this, a);
        a && (this.j ? c.push(B(this.j, 'add', this.Ph, this), B(this.j, 'remove', this.Qh, this)) : this.o && c.push(B(this.o, 'addfeature', this.Ph, this), B(this.o, 'removefeature', this.Qh, this)), d.forEach(this.ek, this));
    };
    k.Zc = bf;
    k.$i = function (a) {
        this.Db(a, !1);
        this.zb(a, !1);
    };
    k.dn = function (a, b) {
        var c, d = b.a;
        for (c = 0; c < d.length; ++c)
            this.ea[d[c].T()].call(this, a, d[c]);
    };
    k.Rh = function (a, b) {
        var c = b.X(), d, e, f, g;
        d = 0;
        for (e = c.length - 1; d < e; ++d)
            f = c.slice(d, d + 2), g = {
                feature: a,
                na: f
            }, this.a.Ea(Ha(f), g);
    };
    k.en = function (a, b) {
        var c = b.X(), d, e, f, g, h, l, m;
        g = 0;
        for (h = c.length; g < h; ++g)
            for (d = c[g], e = 0, f = d.length - 1; e < f; ++e)
                l = d.slice(e, e + 2), m = {
                    feature: a,
                    na: l
                }, this.a.Ea(Ha(l), m);
    };
    k.fn = function (a, b) {
        var c = b.X(), d, e, f;
        e = 0;
        for (f = c.length; e < f; ++e)
            d = c[e], d = {
                feature: a,
                na: [
                    d,
                    d
                ]
            }, this.a.Ea(b.D(), d);
    };
    k.gn = function (a, b) {
        var c = b.X(), d, e, f, g, h, l, m, p, n, q;
        l = 0;
        for (m = c.length; l < m; ++l)
            for (p = c[l], g = 0, h = p.length; g < h; ++g)
                for (d = p[g], e = 0, f = d.length - 1; e < f; ++e)
                    n = d.slice(e, e + 2), q = {
                        feature: a,
                        na: n
                    }, this.a.Ea(Ha(n), q);
    };
    k.hn = function (a, b) {
        var c = b.X(), c = {
                feature: a,
                na: [
                    c,
                    c
                ]
            };
        this.a.Ea(b.D(), c);
    };
    k.jn = function (a, b) {
        var c = b.X(), d, e, f, g, h, l, m;
        g = 0;
        for (h = c.length; g < h; ++g)
            for (d = c[g], e = 0, f = d.length - 1; e < f; ++e)
                l = d.slice(e, e + 2), m = {
                    feature: a,
                    na: l
                }, this.a.Ea(Ha(l), m);
    };
    function Pu(a) {
        var b, c, d = a.pixel, e = a.coordinate;
        b = a.map;
        var f = b.Za([
            d[0] - this.g,
            d[1] + this.g
        ]);
        c = b.Za([
            d[0] + this.g,
            d[1] - this.g
        ]);
        var f = Ha([
                f,
                c
            ]), g = Hj(this.a, f), h, f = !1, l = null;
        c = null;
        if (0 < g.length) {
            this.G = e;
            g.sort(this.Ja);
            g = g[0].na;
            if (this.ia && !this.R) {
                if (e = b.Ka(g[0]), h = b.Ka(g[1]), e = Xe(d, e), d = Xe(d, h), h = Math.sqrt(Math.min(e, d)), h = h <= this.g)
                    f = !0, l = e > d ? g[1] : g[0], c = b.Ka(l);
            } else
                this.R && (l = Re(e, g), c = b.Ka(l), Ye(d, c) <= this.g && (f = !0, this.ia && (e = b.Ka(g[0]), h = b.Ka(g[1]), e = Xe(c, e), d = Xe(c, h), h = Math.sqrt(Math.min(e, d)), h = h <= this.g))) && (l = e > d ? g[1] : g[0], c = b.Ka(l));
            f && (c = [
                Math.round(c[0]),
                Math.round(c[1])
            ]);
        }
        b = l;
        f && (a.coordinate = b.slice(0, 2), a.pixel = c);
        return qg.call(this, a);
    }
    function Qu() {
        var a = rb(this.u);
        a.length && (a.forEach(this.$i, this), this.u = {});
        return !1;
    }
    function Ru(a, b) {
        return Ze(this.G, a.na) - Ze(this.G, b.na);
    }
    function Su(a) {
        pg.call(this, {
            handleDownEvent: Tu,
            handleDragEvent: Uu,
            handleMoveEvent: Vu,
            handleUpEvent: Wu
        });
        a = a ? a : {};
        this.g = void 0;
        this.a = null;
        this.o = void 0 !== a.features ? a.features : null;
        var b;
        if (a.layers)
            if ('function' === typeof a.layers)
                b = a.layers;
            else {
                var c = a.layers;
                b = function (a) {
                    return ea(c, a);
                };
            }
        else
            b = af;
        this.C = b;
        this.u = a.hitTolerance ? a.hitTolerance : 0;
        this.j = null;
    }
    u(Su, pg);
    function Tu(a) {
        this.j = Xu(this, a.pixel, a.map);
        if (!this.a && this.j) {
            this.a = a.coordinate;
            Vu.call(this, a);
            var b = this.o || new D([this.j]);
            this.b(new Yu('translatestart', b, a.coordinate));
            return !0;
        }
        return !1;
    }
    function Wu(a) {
        if (this.a) {
            this.a = null;
            Vu.call(this, a);
            var b = this.o || new D([this.j]);
            this.b(new Yu('translateend', b, a.coordinate));
            return !0;
        }
        return !1;
    }
    function Uu(a) {
        if (this.a) {
            a = a.coordinate;
            var b = a[0] - this.a[0], c = a[1] - this.a[1], d = this.o || new D([this.j]);
            d.forEach(function (a) {
                var d = a.U();
                d.translate(b, c);
                a.Sa(d);
            });
            this.a = a;
            this.b(new Yu('translating', d, a));
        }
    }
    function Vu(a) {
        var b = a.map.Kc();
        Xu(this, a.pixel, a.map) ? (this.g = void 0 !== this.g ? this.g : b.style.cursor, b.style.cursor = this.a ? '-webkit-grabbing' : '-webkit-grab', b.style.cursor = this.a ? 'grabbing' : 'grab') : void 0 !== this.g && (b.style.cursor = this.g, this.g = void 0);
    }
    function Xu(a, b, c) {
        return c.re(b, function (a) {
            if (!this.o || ea(this.o.a, a))
                return a;
        }.bind(a), {
            layerFilter: a.C,
            hitTolerance: a.u
        });
    }
    Su.prototype.G = function () {
        return this.u;
    };
    Su.prototype.R = function (a) {
        this.u = a;
    };
    function Yu(a, b, c) {
        Bc.call(this, a);
        this.features = b;
        this.coordinate = c;
    }
    u(Yu, Bc);
    function T(a) {
        a = a ? a : {};
        var b = pb({}, a);
        delete b.gradient;
        delete b.radius;
        delete b.blur;
        delete b.shadow;
        delete b.weight;
        R.call(this, b);
        this.l = null;
        this.Y = void 0 !== a.shadow ? a.shadow : 250;
        this.S = void 0;
        this.R = null;
        B(this, Ic(Zu), this.hl, this);
        this.Ki(a.gradient ? a.gradient : $u);
        this.Ei(void 0 !== a.blur ? a.blur : 15);
        this.Wc(void 0 !== a.radius ? a.radius : 8);
        B(this, Ic(av), this.Qf, this);
        B(this, Ic(bv), this.Qf, this);
        this.Qf();
        var c = a.weight ? a.weight : 'weight', d;
        'string' === typeof c ? d = function (a) {
            return a.get(c);
        } : d = c;
        this.g(function (a) {
            a = d(a);
            a = void 0 !== a ? wa(a, 0, 1) : 1;
            var b = 255 * a | 0, c = this.R[b];
            c || (c = [new $k({
                    image: new Rn({
                        opacity: a,
                        src: this.S
                    })
                })], this.R[b] = c);
            return c;
        }.bind(this));
        this.set(vt, null);
        B(this, 'render', this.yl, this);
    }
    u(T, R);
    var $u = [
        '#00f',
        '#0ff',
        '#0f0',
        '#ff0',
        '#f00'
    ];
    k = T.prototype;
    k.fh = function () {
        return this.get(av);
    };
    k.mh = function () {
        return this.get(Zu);
    };
    k.Th = function () {
        return this.get(bv);
    };
    k.hl = function () {
        for (var a = this.mh(), b = Xc(1, 256), c = b.createLinearGradient(0, 0, 1, 256), d = 1 / (a.length - 1), e = 0, f = a.length; e < f; ++e)
            c.addColorStop(e * d, a[e]);
        b.fillStyle = c;
        b.fillRect(0, 0, 1, 256);
        this.l = b.getImageData(0, 0, 1, 256).data;
    };
    k.Qf = function () {
        var a = this.Th(), b = this.fh(), c = a + b + 1, d = 2 * c, d = Xc(d, d);
        d.shadowOffsetX = d.shadowOffsetY = this.Y;
        d.shadowBlur = b;
        d.shadowColor = '#000';
        d.beginPath();
        b = c - this.Y;
        d.arc(b, b, a, 0, 2 * Math.PI, !0);
        d.fill();
        this.S = d.canvas.toDataURL();
        this.R = Array(256);
        this.s();
    };
    k.yl = function (a) {
        a = a.context;
        var b = a.canvas, b = a.getImageData(0, 0, b.width, b.height), c = b.data, d, e, f;
        d = 0;
        for (e = c.length; d < e; d += 4)
            if (f = 4 * c[d + 3])
                c[d] = this.l[f], c[d + 1] = this.l[f + 1], c[d + 2] = this.l[f + 2];
        a.putImageData(b, 0, 0);
    };
    k.Ei = function (a) {
        this.set(av, a);
    };
    k.Ki = function (a) {
        this.set(Zu, a);
    };
    k.Wc = function (a) {
        this.set(bv, a);
    };
    var av = 'blur', Zu = 'gradient', bv = 'radius';
    function cv(a) {
        mt.call(this, a);
        this.o = wh();
        this.g = null;
    }
    u(cv, mt);
    cv.prototype.I = function (a, b, c) {
        ot(this, 'precompose', c, a, void 0);
        var d = this.Z();
        if (d) {
            var e = b.extent, f = void 0 !== e;
            f && nt(c, a, e);
            var e = this.A(), g = c.globalAlpha;
            c.globalAlpha = b.opacity;
            c.drawImage(d, 0, 0, +d.width, +d.height, Math.round(e[4]), Math.round(e[5]), Math.round(d.width * e[0]), Math.round(d.height * e[3]));
            c.globalAlpha = g;
            f && c.restore();
        }
        this.Ue(c, a, b);
    };
    cv.prototype.Aa = function (a, b, c, d, e) {
        var f = this.a;
        return f.la().Aa(a, b.viewState.resolution, b.viewState.rotation, c, b.skippedFeatureUids, function (a) {
            return d.call(e, a, f);
        });
    };
    cv.prototype.v = function (a, b, c, d) {
        if (this.Z()) {
            if (this.a.la().Aa !== na)
                return mt.prototype.v.apply(this, arguments);
            var e = Bh(this.o, a.slice());
            We(e, b.viewState.resolution / this.i);
            this.g || (this.g = Xc(1, 1));
            this.g.clearRect(0, 0, 1, 1);
            this.g.drawImage(this.Z(), e[0], e[1], 1, 1, 0, 0, 1, 1);
            e = this.g.getImageData(0, 0, 1, 1).data;
            if (0 < e[3])
                return c.call(d, this.a, e);
        }
    };
    function dv(a) {
        cv.call(this, a);
        this.M = null;
        this.c = wh();
    }
    u(dv, cv);
    dv.prototype.Z = function () {
        return this.M ? this.M.Z() : null;
    };
    dv.prototype.A = function () {
        return this.c;
    };
    dv.prototype.qd = function (a, b) {
        var c = a.pixelRatio, d = a.size, e = a.viewState, f = e.center, g = e.resolution, h = this.a.la(), l = a.viewHints, m = a.extent;
        void 0 !== b.extent && (m = lb(m, b.extent));
        l[0] || l[1] || gb(m) || (e = h.Z(m, g, c, e.projection)) && gt(this, e) && (this.M = e);
        if (this.M) {
            var e = this.M, m = e.D(), p = e.resolution, l = e.a, n = c * p / (g * l), m = Fh(this.c, c * d[0] / 2, c * d[1] / 2, n, n, 0, l * (m[0] - f[0]) / p, l * (f[1] - m[3]) / p);
            Fh(this.o, c * d[0] / 2 - m[4], c * d[1] / 2 - m[5], c / g, -c / g, 0, -f[0], -f[1]);
            it(a.attributions, e.i);
            jt(a, h);
            this.i = g * c / l;
        }
        return !!this.M;
    };
    function ev(a, b, c, d) {
        var e = Wb(c, b, a);
        c = Eb(b, d, c);
        b = b.sc();
        void 0 !== b && (c *= b);
        b = a.sc();
        void 0 !== b && (c /= b);
        a = Eb(a, c, e) / c;
        isFinite(a) && 0 < a && (c /= a);
        return c;
    }
    function fv(a, b, c, d) {
        a = c - a;
        b = d - b;
        var e = Math.sqrt(a * a + b * b);
        return [
            Math.round(c + a / e),
            Math.round(d + b / e)
        ];
    }
    function gv(a, b, c, d, e, f, g, h, l, m, p) {
        var n = Xc(Math.round(c * a), Math.round(c * b));
        if (!l.length)
            return n.canvas;
        n.scale(c, c);
        var q = Ia();
        l.forEach(function (a) {
            $a(q, a.extent);
        });
        var r = Xc(Math.round(c * hb(q) / d), Math.round(c * ib(q) / d)), v = c / d;
        l.forEach(function (a) {
            r.drawImage(a.image, m, m, a.image.width - 2 * m, a.image.height - 2 * m, (a.extent[0] - q[0]) * v, -(a.extent[3] - q[3]) * v, hb(a.extent) * v, ib(a.extent) * v);
        });
        var x = eb(g);
        h.c.forEach(function (a) {
            var b = a.source, e = a.target, g = b[1][0], h = b[1][1], l = b[2][0], m = b[2][1];
            a = (e[0][0] - x[0]) / f;
            var p = -(e[0][1] - x[1]) / f, v = (e[1][0] - x[0]) / f, y = -(e[1][1] - x[1]) / f, Z = (e[2][0] - x[0]) / f, Ra = -(e[2][1] - x[1]) / f, e = b[0][0], b = b[0][1], g = g - e, h = h - b, l = l - e, m = m - b;
            a: {
                g = [
                    [
                        g,
                        h,
                        0,
                        0,
                        v - a
                    ],
                    [
                        l,
                        m,
                        0,
                        0,
                        Z - a
                    ],
                    [
                        0,
                        0,
                        g,
                        h,
                        y - p
                    ],
                    [
                        0,
                        0,
                        l,
                        m,
                        Ra - p
                    ]
                ];
                h = g.length;
                for (l = 0; l < h; l++) {
                    for (var m = l, Cb = Math.abs(g[l][l]), dc = l + 1; dc < h; dc++) {
                        var $c = Math.abs(g[dc][l]);
                        $c > Cb && (Cb = $c, m = dc);
                    }
                    if (!Cb) {
                        g = null;
                        break a;
                    }
                    Cb = g[m];
                    g[m] = g[l];
                    g[l] = Cb;
                    for (m = l + 1; m < h; m++)
                        for (Cb = -g[m][l] / g[l][l], dc = l; dc < h + 1; dc++)
                            g[m][dc] = l == dc ? 0 : g[m][dc] + Cb * g[l][dc];
                }
                l = Array(h);
                for (m = h - 1; 0 <= m; m--)
                    for (l[m] = g[m][h] / g[m][m], Cb = m - 1; 0 <= Cb; Cb--)
                        g[Cb][h] -= g[Cb][m] * l[m];
                g = l;
            }
            g && (n.save(), n.beginPath(), l = (a + v + Z) / 3, m = (p + y + Ra) / 3, h = fv(l, m, a, p), v = fv(l, m, v, y), Z = fv(l, m, Z, Ra), n.moveTo(v[0], v[1]), n.lineTo(h[0], h[1]), n.lineTo(Z[0], Z[1]), n.clip(), n.transform(g[0], g[2], g[1], g[3], a, p), n.translate(q[0] - e, q[3] - b), n.scale(d / c, -d / c), n.drawImage(r.canvas, 0, 0), n.restore());
        });
        p && (n.save(), n.strokeStyle = 'black', n.lineWidth = 1, h.c.forEach(function (a) {
            var b = a.target;
            a = (b[0][0] - x[0]) / f;
            var c = -(b[0][1] - x[1]) / f, d = (b[1][0] - x[0]) / f, e = -(b[1][1] - x[1]) / f, g = (b[2][0] - x[0]) / f, b = -(b[2][1] - x[1]) / f;
            n.beginPath();
            n.moveTo(d, e);
            n.lineTo(a, c);
            n.lineTo(g, b);
            n.closePath();
            n.stroke();
        }), n.restore());
        return n.canvas;
    }
    function hv(a, b, c, d, e) {
        this.f = a;
        this.i = b;
        var f = {}, g = Ub(this.i, this.f);
        this.a = function (a) {
            var b = a[0] + '/' + a[1];
            f[b] || (f[b] = g(a));
            return f[b];
        };
        this.g = d;
        this.v = e * e;
        this.c = [];
        this.j = !1;
        this.o = this.f.a && !!d && !!this.f.D() && hb(d) == hb(this.f.D());
        this.b = this.f.D() ? hb(this.f.D()) : null;
        this.l = this.i.D() ? hb(this.i.D()) : null;
        a = eb(c);
        b = db(c);
        d = cb(c);
        c = bb(c);
        e = this.a(a);
        var h = this.a(b), l = this.a(d), m = this.a(c);
        iv(this, a, b, d, c, e, h, l, m, 10);
        if (this.j) {
            var p = Infinity;
            this.c.forEach(function (a) {
                p = Math.min(p, a.source[0][0], a.source[1][0], a.source[2][0]);
            });
            this.c.forEach(function (a) {
                if (Math.max(a.source[0][0], a.source[1][0], a.source[2][0]) - p > this.b / 2) {
                    var b = [
                        [
                            a.source[0][0],
                            a.source[0][1]
                        ],
                        [
                            a.source[1][0],
                            a.source[1][1]
                        ],
                        [
                            a.source[2][0],
                            a.source[2][1]
                        ]
                    ];
                    b[0][0] - p > this.b / 2 && (b[0][0] -= this.b);
                    b[1][0] - p > this.b / 2 && (b[1][0] -= this.b);
                    b[2][0] - p > this.b / 2 && (b[2][0] -= this.b);
                    Math.max(b[0][0], b[1][0], b[2][0]) - Math.min(b[0][0], b[1][0], b[2][0]) < this.b / 2 && (a.source = b);
                }
            }, this);
        }
        f = {};
    }
    function iv(a, b, c, d, e, f, g, h, l, m) {
        var p = Ha([
                f,
                g,
                h,
                l
            ]), n = a.b ? hb(p) / a.b : null, q = a.b, r = a.f.a && 0.5 < n && 1 > n, v = !1;
        if (0 < m) {
            if (a.i.f && a.l)
                var x = Ha([
                        b,
                        c,
                        d,
                        e
                    ]), v = v | 0.25 < hb(x) / a.l;
            !r && a.f.f && n && (v |= 0.25 < n);
        }
        if (v || !a.g || mb(p, a.g)) {
            if (!(v || isFinite(f[0]) && isFinite(f[1]) && isFinite(g[0]) && isFinite(g[1]) && isFinite(h[0]) && isFinite(h[1]) && isFinite(l[0]) && isFinite(l[1])))
                if (0 < m)
                    v = !0;
                else
                    return;
            if (0 < m && (v || (p = a.a([
                    (b[0] + d[0]) / 2,
                    (b[1] + d[1]) / 2
                ]), q = r ? (Ca(f[0], q) + Ca(h[0], q)) / 2 - Ca(p[0], q) : (f[0] + h[0]) / 2 - p[0], p = (f[1] + h[1]) / 2 - p[1], v = q * q + p * p > a.v), v)) {
                Math.abs(b[0] - d[0]) <= Math.abs(b[1] - d[1]) ? (r = [
                    (c[0] + d[0]) / 2,
                    (c[1] + d[1]) / 2
                ], q = a.a(r), p = [
                    (e[0] + b[0]) / 2,
                    (e[1] + b[1]) / 2
                ], n = a.a(p), iv(a, b, c, r, p, f, g, q, n, m - 1), iv(a, p, r, d, e, n, q, h, l, m - 1)) : (r = [
                    (b[0] + c[0]) / 2,
                    (b[1] + c[1]) / 2
                ], q = a.a(r), p = [
                    (d[0] + e[0]) / 2,
                    (d[1] + e[1]) / 2
                ], n = a.a(p), iv(a, b, r, p, e, f, q, n, l, m - 1), iv(a, r, c, d, p, q, g, h, n, m - 1));
                return;
            }
            if (r) {
                if (!a.o)
                    return;
                a.j = !0;
            }
            a.c.push({
                source: [
                    f,
                    h,
                    l
                ],
                target: [
                    b,
                    d,
                    e
                ]
            });
            a.c.push({
                source: [
                    f,
                    g,
                    h
                ],
                target: [
                    b,
                    c,
                    d
                ]
            });
        }
    }
    function jv(a) {
        var b = Ia();
        a.c.forEach(function (a) {
            a = a.source;
            Ja(b, a[0]);
            Ja(b, a[1]);
            Ja(b, a[2]);
        });
        return b;
    }
    function kv(a, b, c, d, e, f) {
        this.v = b;
        this.o = a.D();
        var g = b.D(), h = g ? lb(c, g) : c, g = ev(a, b, jb(h), d);
        this.l = new hv(a, b, h, this.o, 0.5 * g);
        this.c = d;
        this.f = c;
        a = jv(this.l);
        this.j = (this.Eb = f(a, g, e)) ? this.Eb.a : 1;
        this.$d = this.g = null;
        e = 2;
        f = [];
        this.Eb && (e = 0, f = this.Eb.i);
        ss.call(this, c, d, this.j, e, f);
    }
    u(kv, ss);
    kv.prototype.ra = function () {
        1 == this.state && (rc(this.$d), this.$d = null);
        ss.prototype.ra.call(this);
    };
    kv.prototype.Z = function () {
        return this.g;
    };
    kv.prototype.Zd = function () {
        var a = this.Eb.V();
        2 == a && (this.g = gv(hb(this.f) / this.c, ib(this.f) / this.c, this.j, this.Eb.resolution, 0, this.c, this.f, this.l, [{
                extent: this.Eb.D(),
                image: this.Eb.Z()
            }], 0));
        this.state = a;
        this.s();
    };
    kv.prototype.load = function () {
        if (0 == this.state) {
            this.state = 1;
            this.s();
            var a = this.Eb.V();
            2 == a || 3 == a ? this.Zd() : (this.$d = B(this.Eb, 'change', function () {
                var a = this.Eb.V();
                if (2 == a || 3 == a)
                    rc(this.$d), this.$d = null, this.Zd();
            }, this), this.Eb.load());
        }
    };
    function lv(a) {
        Gt.call(this, {
            attributions: a.attributions,
            extent: a.extent,
            logo: a.logo,
            projection: a.projection,
            state: a.state
        });
        this.u = void 0 !== a.resolutions ? a.resolutions : null;
        this.a = null;
        this.ea = 0;
    }
    u(lv, Gt);
    function mv(a, b) {
        a.u && (b = a.u[fa(a.u, b, 0)]);
        return b;
    }
    lv.prototype.Z = function (a, b, c, d) {
        var e = this.c;
        if (e && d && !Tb(e, d)) {
            if (this.a) {
                if (this.ea == this.f && Tb(this.a.v, d) && this.a.resolution == b && this.a.a == c && Za(this.a.D(), a))
                    return this.a;
                Ac(this.a);
                this.a = null;
            }
            this.a = new kv(e, d, a, b, c, function (a, b, c) {
                return this.Ic(a, b, c, e);
            }.bind(this));
            this.ea = this.f;
            return this.a;
        }
        e && (d = e);
        return this.Ic(a, b, c, d);
    };
    lv.prototype.j = function (a) {
        a = a.target;
        switch (a.V()) {
        case 1:
            this.b(new nv(ov, a));
            break;
        case 2:
            this.b(new nv(pv, a));
            break;
        case 3:
            this.b(new nv(qv, a));
        }
    };
    function rv(a, b) {
        a.Z().src = b;
    }
    function nv(a, b) {
        Bc.call(this, a);
        this.image = b;
    }
    u(nv, Bc);
    var ov = 'imageloadstart', pv = 'imageloadend', qv = 'imageloaderror';
    function sv(a) {
        lv.call(this, {
            attributions: a.attributions,
            logo: a.logo,
            projection: a.projection,
            resolutions: a.resolutions,
            state: a.state
        });
        this.ia = a.canvasFunction;
        this.S = null;
        this.Y = 0;
        this.oa = void 0 !== a.ratio ? a.ratio : 1.5;
    }
    u(sv, lv);
    sv.prototype.Ic = function (a, b, c, d) {
        b = mv(this, b);
        var e = this.S;
        if (e && this.Y == this.f && e.resolution == b && e.a == c && Ta(e.D(), a))
            return e;
        a = a.slice();
        nb(a, this.oa);
        (d = this.ia(a, b, c, [
            hb(a) / b * c,
            ib(a) / b * c
        ], d)) && (e = new us(a, b, c, this.l, d));
        this.S = e;
        this.Y = this.f;
        return e;
    };
    function tv(a) {
        this.i = a.source;
        this.Oa = wh();
        this.g = Xc();
        this.o = [
            0,
            0
        ];
        this.Ha = void 0 == a.renderBuffer ? 100 : a.renderBuffer;
        this.A = null;
        sv.call(this, {
            attributions: a.attributions,
            canvasFunction: this.Zj.bind(this),
            logo: a.logo,
            projection: a.projection,
            ratio: a.ratio,
            resolutions: a.resolutions,
            state: this.i.V()
        });
        this.C = null;
        this.v = void 0;
        this.ci(a.style);
        B(this.i, 'change', this.Fn, this);
    }
    u(tv, sv);
    k = tv.prototype;
    k.Zj = function (a, b, c, d, e) {
        var f = new Ws(0.5 * b / c, a, b, this.i.Ha, this.Ha);
        this.i.Ud(a, b, e);
        var g = !1;
        this.i.ac(a, function (a) {
            var d;
            if (!(d = g)) {
                var e;
                (d = a.Nc()) ? e = d.call(a, b) : this.v && (e = this.v(a, b));
                if (e) {
                    var h, n = !1;
                    Array.isArray(e) || (e = [e]);
                    d = 0;
                    for (h = e.length; d < h; ++d)
                        n = st(f, a, e[d], rt(b, c), this.En, this) || n;
                    d = n;
                } else
                    d = !1;
            }
            g = d;
        }, this);
        $s(f);
        if (g)
            return null;
        this.o[0] != d[0] || this.o[1] != d[1] ? (this.g.canvas.width = d[0], this.g.canvas.height = d[1], this.o[0] = d[0], this.o[1] = d[1]) : this.g.clearRect(0, 0, d[0], d[1]);
        a = uv(this, jb(a), b, c, d);
        f.i(this.g, c, a, 0, {});
        this.A = f;
        return this.g.canvas;
    };
    k.Aa = function (a, b, c, d, e, f) {
        if (this.A) {
            var g = {};
            return this.A.Aa(a, b, 0, d, e, function (a) {
                var b = w(a).toString();
                if (!(b in g))
                    return g[b] = !0, f(a);
            });
        }
    };
    k.Bn = function () {
        return this.i;
    };
    k.Cn = function () {
        return this.C;
    };
    k.Dn = function () {
        return this.v;
    };
    function uv(a, b, c, d, e) {
        c = d / c;
        return Fh(a.Oa, e[0] / 2, e[1] / 2, c, -c, 0, -b[0], -b[1]);
    }
    k.En = function () {
        this.s();
    };
    k.Fn = function () {
        It(this, this.i.V());
    };
    k.ci = function (a) {
        this.C = void 0 !== a ? a : dl;
        this.v = a ? bl(this.C) : void 0;
        this.s();
    };
    function vv(a, b) {
        Bt.call(this, a, b);
        this.j = this.i = this.M = null;
    }
    u(vv, Bt);
    function wv(a, b) {
        var c = b.Z();
        return Oi(a.c.f, c);
    }
    vv.prototype.Aa = function (a, b, c, d, e) {
        var f = this.a;
        return f.la().Aa(a, b.viewState.resolution, b.viewState.rotation, c, b.skippedFeatureUids, function (a) {
            return d.call(e, a, f);
        });
    };
    vv.prototype.ag = function (a, b) {
        var c = this.c.f, d = a.pixelRatio, e = a.viewState, f = e.center, g = e.resolution, h = e.rotation, l = this.M, m = this.Fb, p = this.a.la(), n = a.viewHints, q = a.extent;
        void 0 !== b.extent && (q = lb(q, b.extent));
        n[0] || n[1] || gb(q) || (e = p.Z(q, g, d, e.projection)) && gt(this, e) && (l = e, m = wv(this, e), this.Fb && a.postRenderFunctions.push(function (a, b) {
            a.isContextLost() || a.deleteTexture(b);
        }.bind(null, c, this.Fb)));
        l && (c = this.c.i.l, xv(this, c.width, c.height, d, f, g, h, l.D()), this.j = null, d = this.v, xh(d), Dh(d, 1, -1), Eh(d, 0, -1), this.M = l, this.Fb = m, it(a.attributions, l.i), jt(a, p));
        return !!l;
    };
    function xv(a, b, c, d, e, f, g, h) {
        b *= f;
        c *= f;
        a = a.u;
        xh(a);
        Dh(a, 2 * d / b, 2 * d / c);
        Ch(a, -g);
        Eh(a, h[0] - e[0], h[1] - e[1]);
        Dh(a, (h[2] - h[0]) / 2, (h[3] - h[1]) / 2);
        Eh(a, 1, 1);
    }
    vv.prototype.Ke = function (a, b) {
        return void 0 !== this.Aa(a, b, 0, af, this);
    };
    vv.prototype.Zf = function (a, b, c, d) {
        if (this.M && this.M.Z())
            if (this.a.la() instanceof tv) {
                var e = Bh(b.pixelToCoordinateTransform, a.slice());
                if (this.Aa(e, b, 0, af, this))
                    return c.call(d, this.a, null);
            } else {
                e = [
                    this.M.Z().width,
                    this.M.Z().height
                ];
                if (!this.j) {
                    var f = b.size;
                    b = wh();
                    Eh(b, -1, -1);
                    Dh(b, 2 / f[0], 2 / f[1]);
                    Eh(b, 0, f[1]);
                    Dh(b, 1, -1);
                    var f = Gh(this.u.slice()), g = wh();
                    Eh(g, 0, e[1]);
                    Dh(g, 1, -1);
                    Dh(g, e[0] / 2, e[1] / 2);
                    Eh(g, 1, 1);
                    zh(g, f);
                    zh(g, b);
                    this.j = g;
                }
                a = Bh(this.j, a.slice());
                if (!(0 > a[0] || a[0] > e[0] || 0 > a[1] || a[1] > e[1]) && (this.i || (this.i = Xc(1, 1)), this.i.clearRect(0, 0, 1, 1), this.i.drawImage(this.M.Z(), a[0], a[1], 1, 1, 0, 0, 1, 1), e = this.i.getImageData(0, 0, 1, 1).data, 0 < e[3]))
                    return c.call(d, this.a, e);
            }
    };
    function yv(a) {
        rh.call(this, a ? a : {});
    }
    u(yv, rh);
    yv.prototype.Dd = function (a) {
        var b = null, c = a.T();
        'canvas' === c ? b = new dv(this) : 'webgl' === c && (b = new vv(a, this));
        return b;
    };
    function zv(a) {
        cv.call(this, a);
        this.u = Xc();
        this.l = null;
        this.c = [];
        this.j = Ia();
        this.Ja = new sa(0, 0, 0, 0);
        this.C = wh();
        this.Y = 0;
    }
    u(zv, cv);
    function Av(a, b) {
        var c = b.V(), d = a.a.Td();
        return 2 == c || 4 == c || 3 == c && !d;
    }
    zv.prototype.qd = function (a, b) {
        var c = a.pixelRatio, d = a.size, e = a.viewState, f = e.projection, g = e.resolution, e = e.center, h = this.a, l = h.la(), m = l.f, p = l.Ib(f), n = p.Mc(g, this.Y), q = p.La(n), r = Math.round(g / q) || 1, v = a.extent;
        void 0 !== b.extent && (v = lb(v, b.extent));
        if (gb(v))
            return !1;
        var x = gc(p, v, q), y;
        y = p.Qc(n);
        var z = p.La(n), A = Ga(p.fb(n), p.l);
        y = Va(y[0] + x.da * A[0] * z, y[1] + x.fa * A[1] * z, y[0] + (x.ba + 1) * A[0] * z, y[1] + (x.ja + 1) * A[1] * z, void 0);
        z = l.pb(c);
        A = {};
        A[n] = {};
        var V = this.Cf(l, f, A), Pa = this.j, ra = this.Ja, La = !1, C, Ma, xb;
        for (Ma = x.da; Ma <= x.ba; ++Ma)
            for (xb = x.fa; xb <= x.ja; ++xb)
                C = l.Lc(n, Ma, xb, c, f), Av(this, C) || (C = ws(C)), Av(this, C) ? 2 == C.V() && (A[n][C.Ga.toString()] = C, La || -1 != this.c.indexOf(C) || (La = !0)) : ec(p, C.Ga, V, ra, Pa) || (C = fc(p, C.Ga, ra, Pa)) && V(n + 1, C);
        V = a.viewHints;
        if (!(this.i && 16 < Date.now() - a.time && (V[0] || V[1]) || !La && this.l && Ta(this.l, v) && this.af == m) || r != this.R) {
            La = l.Sd(n, c, f);
            Ma = Math.round((x.ba - x.da + 1) * La[0] / r);
            C = Math.round((x.ja - x.fa + 1) * La[0] / r);
            La = this.u;
            xb = La.canvas;
            V = l.Mf(f);
            xb.width != Ma || xb.height != C ? (this.R = r, xb.width = Ma, xb.height = C) : (La.clearRect(0, 0, Ma, C), r = this.R);
            this.c.length = 0;
            ra = Object.keys(A).map(Number);
            ra.sort(da);
            var Z, Ra, Cb, dc, $c, $d, Je, ue;
            Cb = 0;
            for (dc = ra.length; Cb < dc; ++Cb) {
                Ma = ra[Cb];
                Ra = l.Sd(Ma, c, f);
                C = p.La(Ma);
                Z = C / q;
                $c = z * l.Jf(f);
                $d = A[Ma];
                for (var Tc in $d)
                    C = $d[Tc], xb = p.Ta(C.Ga, Pa), Ma = (xb[0] - y[0]) / q * z / r, xb = (y[3] - xb[3]) / q * z / r, Je = Ra[0] * Z / r, ue = Ra[1] * Z / r, V || La.clearRect(Ma, xb, Je, ue), this.Df(C, a, b, Ma, xb, Je, ue, $c), this.c.push(C);
            }
            this.af = m;
            this.i = q * c / z * r;
            this.l = y;
        }
        Tc = this.i / g;
        Tc = Fh(this.C, c * d[0] / 2, c * d[1] / 2, Tc, Tc, 0, (this.l[0] - e[0]) / this.i * c, (e[1] - this.l[3]) / this.i * c);
        Fh(this.o, c * d[0] / 2 - Tc[4], c * d[1] / 2 - Tc[5], c / g, -c / g, 0, -e[0], -e[1]);
        kt(a.usedTiles, l, n, x);
        lt(a, l, p, c, f, v, n, h.Pd());
        ht(a, l);
        jt(a, l);
        return 0 < this.c.length;
    };
    zv.prototype.Df = function (a, b, c, d, e, f, g, h) {
        (a = a.Z()) && this.u.drawImage(a, h, h, a.width - 2 * h, a.height - 2 * h, d, e, f, g);
    };
    zv.prototype.Z = function () {
        return this.u.canvas;
    };
    zv.prototype.A = function () {
        return this.C;
    };
    function Bv() {
        this.b = 'precision mediump float;varying vec2 a;uniform sampler2D e;void main(void){gl_FragColor=texture2D(e,a);}';
    }
    u(Bv, hi);
    var Cv = new Bv();
    function Dv() {
        this.b = 'varying vec2 a;attribute vec2 b;attribute vec2 c;uniform vec4 d;void main(void){gl_Position=vec4(b*d.xy+d.zw,0.,1.);a=c;}';
    }
    u(Dv, ii);
    var Ev = new Dv();
    function Fv(a, b) {
        this.f = a.getUniformLocation(b, 'e');
        this.c = a.getUniformLocation(b, 'd');
        this.b = a.getAttribLocation(b, 'b');
        this.a = a.getAttribLocation(b, 'c');
    }
    function Gv(a, b) {
        Bt.call(this, a, b);
        this.R = Cv;
        this.ia = Ev;
        this.i = null;
        this.G = new yi([
            0,
            0,
            0,
            1,
            1,
            0,
            1,
            1,
            0,
            1,
            0,
            0,
            1,
            1,
            1,
            0
        ]);
        this.A = this.j = null;
        this.o = -1;
        this.S = [
            0,
            0
        ];
    }
    u(Gv, Bt);
    k = Gv.prototype;
    k.ra = function () {
        Bi(this.c.i, this.G);
        Bt.prototype.ra.call(this);
    };
    k.Cf = function (a, b, c) {
        var d = this.c;
        return function (e, f) {
            return et(a, b, e, f, function (a) {
                var b = d.a.b.hasOwnProperty(a.ib());
                b && (c[e] || (c[e] = {}), c[e][a.Ga.toString()] = a);
                return b;
            });
        };
    };
    k.$f = function () {
        Bt.prototype.$f.call(this);
        this.i = null;
    };
    k.ag = function (a, b, c) {
        var d = this.c, e = c.b, f = a.viewState, g = f.projection, h = this.a, l = h.la(), m = l.Ib(g), p = m.Mc(f.resolution), n = m.La(p), q = l.Sd(p, a.pixelRatio, g), r = q[0] / Ga(m.fb(p), this.S)[0], v = n / r, x = l.pb(r) * l.Jf(g), y = f.center, z = a.extent, A = gc(m, z, n);
        if (this.j && ua(this.j, A) && this.o == l.f)
            v = this.A;
        else {
            var V = [
                    A.ba - A.da + 1,
                    A.ja - A.fa + 1
                ], Pa = ya(Math.max(V[0] * q[0], V[1] * q[1])), V = v * Pa, ra = m.Qc(p), La = ra[0] + A.da * q[0] * v, v = ra[1] + A.fa * q[1] * v, v = [
                    La,
                    v,
                    La + V,
                    v + V
                ];
            Ct(this, a, Pa);
            e.viewport(0, 0, Pa, Pa);
            e.clearColor(0, 0, 0, 0);
            e.clear(16384);
            e.disable(3042);
            Pa = Ci(c, this.R, this.ia);
            c.Rc(Pa);
            this.i || (this.i = new Fv(e, Pa));
            ri(c, 34962, this.G);
            e.enableVertexAttribArray(this.i.b);
            e.vertexAttribPointer(this.i.b, 2, 5126, !1, 16, 0);
            e.enableVertexAttribArray(this.i.a);
            e.vertexAttribPointer(this.i.a, 2, 5126, !1, 16, 8);
            e.uniform1i(this.i.f, 0);
            c = {};
            c[p] = {};
            var C = this.Cf(l, g, c), Ma = h.Td(), Pa = !0, La = Ia(), xb = new sa(0, 0, 0, 0), Z, Ra, Cb;
            for (Ra = A.da; Ra <= A.ba; ++Ra)
                for (Cb = A.fa; Cb <= A.ja; ++Cb) {
                    ra = l.Lc(p, Ra, Cb, r, g);
                    if (void 0 !== b.extent && (Z = m.Ta(ra.Ga, La), !mb(Z, b.extent)))
                        continue;
                    Z = ra.V();
                    (Z = 2 == Z || 4 == Z || 3 == Z && !Ma) || (ra = ws(ra));
                    Z = ra.V();
                    if (2 == Z) {
                        if (d.a.b.hasOwnProperty(ra.ib())) {
                            c[p][ra.Ga.toString()] = ra;
                            continue;
                        }
                    } else if (4 == Z || 3 == Z && !Ma)
                        continue;
                    Pa = !1;
                    Z = ec(m, ra.Ga, C, xb, La);
                    Z || (ra = fc(m, ra.Ga, xb, La)) && C(p + 1, ra);
                }
            b = Object.keys(c).map(Number);
            b.sort(da);
            for (var C = new Float32Array(4), dc, Ma = 0, xb = b.length; Ma < xb; ++Ma)
                for (dc in Ra = c[b[Ma]], Ra)
                    ra = Ra[dc], Z = m.Ta(ra.Ga, La), C[0] = 2 * (Z[2] - Z[0]) / V, C[1] = 2 * (Z[3] - Z[1]) / V, C[2] = 2 * (Z[0] - v[0]) / V - 1, C[3] = 2 * (Z[1] - v[1]) / V - 1, e.uniform4fv(this.i.c, C), lk(d, ra, q, x * r), e.drawArrays(5, 0, 4);
            Pa ? (this.j = A, this.A = v, this.o = l.f) : (this.A = this.j = null, this.o = -1, a.animate = !0);
        }
        kt(a.usedTiles, l, p, A);
        var $c = d.l;
        lt(a, l, m, r, g, z, p, h.Pd(), function (a) {
            2 != a.V() || d.a.b.hasOwnProperty(a.ib()) || a.ib() in $c.a || $c.i([
                a,
                ic(m, a.Ga),
                m.La(a.Ga[0]),
                q,
                x * r
            ]);
        }, this);
        ht(a, l);
        jt(a, l);
        e = this.v;
        xh(e);
        Eh(e, (Math.round(y[0] / n) * n - v[0]) / (v[2] - v[0]), (Math.round(y[1] / n) * n - v[1]) / (v[3] - v[1]));
        f.rotation && Ch(e, f.rotation);
        Dh(e, a.size[0] * f.resolution / (v[2] - v[0]), a.size[1] * f.resolution / (v[3] - v[1]));
        Eh(e, -0.5, -0.5);
        return !0;
    };
    k.Zf = function (a, b, c, d) {
        if (this.g) {
            a = Bh(this.v, [
                a[0] / b.size[0],
                (b.size[1] - a[1]) / b.size[1]
            ].slice());
            a = [
                a[0] * this.l,
                a[1] * this.l
            ];
            b = this.c.i.b;
            b.bindFramebuffer(b.FRAMEBUFFER, this.g);
            var e = new Uint8Array(4);
            b.readPixels(a[0], a[1], 1, 1, b.RGBA, b.UNSIGNED_BYTE, e);
            if (0 < e[3])
                return c.call(d, this.a, e);
        }
    };
    function Hv(a) {
        a = a ? a : {};
        var b = pb({}, a);
        delete b.preload;
        delete b.useInterimTilesOnError;
        rh.call(this, b);
        this.Uh(void 0 !== a.preload ? a.preload : 0);
        this.Vh(void 0 !== a.useInterimTilesOnError ? a.useInterimTilesOnError : !0);
    }
    u(Hv, rh);
    k = Hv.prototype;
    k.Dd = function (a) {
        var b = null, c = a.T();
        'canvas' === c ? b = new zv(this) : 'webgl' === c && (b = new Gv(a, this));
        return b;
    };
    k.Pd = function () {
        return this.get('preload');
    };
    k.Uh = function (a) {
        this.set('preload', a);
    };
    k.Td = function () {
        return this.get('useInterimTilesOnError');
    };
    k.Vh = function (a) {
        this.set('useInterimTilesOnError', a);
    };
    function Iv(a) {
        zv.call(this, a);
        this.G = !1;
        this.S = wh();
        this.Y = 'vector' == a.v ? 1 : 0;
    }
    u(Iv, zv);
    var Jv = {
            image: ei,
            hybrid: [
                'Polygon',
                'LineString'
            ]
        }, Kv = {
            hybrid: [
                'Image',
                'Text'
            ],
            vector: ei
        };
    k = Iv.prototype;
    k.qd = function (a, b) {
        var c = this.a.f;
        this.oa != c && (this.c.length = 0);
        this.oa = c;
        return zv.prototype.qd.apply(this, arguments);
    };
    function Lv(a, b, c) {
        function d(a) {
            var b, c = a.Nc();
            c ? b = c.call(a, r) : (c = e.i) && (b = c(a, r));
            if (b) {
                Array.isArray(b) || (b = [b]);
                var c = A, d = z;
                if (b) {
                    var f = !1;
                    if (Array.isArray(b))
                        for (var g = 0, h = b.length; g < h; ++g)
                            f = st(d, a, b[g], c, this.$h, this) || f;
                    else
                        f = st(d, a, b, c, this.$h, this) || f;
                    a = f;
                } else
                    a = !1;
                this.G = this.G || a;
                l.Ld = l.Ld || a;
            }
        }
        var e = a.a, f = c.pixelRatio;
        c = c.viewState.projection;
        var g = e.f, h = e.get(vt) || null, l = b.f;
        if (l.Ld || l.af != g || l.wg != h) {
            l.vd = null;
            l.Ld = !1;
            var m = e.la(), p = m.tileGrid, n = b.Ga, q = b.l, r = p.La(n[0]), v, x, y;
            'tile-pixels' == q.Jb() ? (v = y = m.pb(), p = Ga(p.fb(n[0])), v = [
                0,
                0,
                p[0] * v,
                p[1] * v
            ]) : (y = r, v = p.Ta(n), Tb(c, q) || (x = !0, b.Xf(c)));
            l.Ld = !1;
            var z = new Ws(0, v, y, m.g, e.c), A = rt(y, f);
            b = b.g;
            h && h !== l.wg && b.sort(h);
            m = 0;
            for (y = b.length; m < y; ++m)
                f = b[m], x && f.U().tb(q, c), d.call(a, f);
            $s(z);
            l.af = g;
            l.wg = h;
            l.vd = z;
            l.resolution = NaN;
        }
    }
    k.Df = function (a, b, c, d, e, f, g, h) {
        var l = a;
        Lv(this, l, b);
        if ('vector' != this.a.v) {
            var m = l, p = b, n = this.a, l = m.f, q = n.f, r = Jv[n.v];
            if (r && l.xg !== q) {
                l.xg = q;
                var v = m.Ga, x = m.Ga[0], q = p.pixelRatio, y = n.la(), z = y.tileGrid, A = y.pb(), n = xh(this.S);
                'tile-pixels' == m.l.Jb() ? (v = q / A, Dh(n, v, v)) : (A = q / z.La(x), v = z.Ta(v, this.j), Dh(n, A, -A), Eh(n, -v[0], -v[3]));
                m = m.c;
                p = y.Sd(x, q, p.viewState.projection);
                m.canvas.width = p[0];
                m.canvas.height = p[1];
                l.vd.i(m, q, n, 0, {}, r);
            }
        }
        zv.prototype.Df.apply(this, arguments);
    };
    k.Aa = function (a, b, c, d, e) {
        var f = b.viewState.resolution;
        b = b.viewState.rotation;
        c = void 0 == c ? 0 : c;
        var g = this.a, h = {}, l = this.c, m = g.la(), p = m.tileGrid, n, q, r, v, x, y;
        r = 0;
        for (v = l.length; r < v; ++r)
            y = l[r], q = y.Ga, x = m.tileGrid.Ta(q, this.j), Qa(Ka(x, c * f), a) && ('tile-pixels' === y.l.Jb() ? (x = eb(x), f = m.pb(), q = p.La(q[0]) / f, q = [
                (a[0] - x[0]) / q,
                (x[1] - a[1]) / q
            ]) : q = a, y = y.f.vd, n = n || y.Aa(q, f, b, c, {}, function (a) {
                var b = w(a).toString();
                if (!(b in h))
                    return h[b] = !0, d.call(e, a, g);
            }));
        return n;
    };
    k.$h = function () {
        ft(this);
    };
    k.Ue = function (a, b, c) {
        var d = Kv[this.a.v];
        if (d)
            for (var e = b.pixelRatio, f = b.viewState.rotation, g = b.size, h = Math.round(e * g[0] / 2), g = Math.round(e * g[1] / 2), l = this.c, m = [], p = [], n = l.length - 1; 0 <= n; --n) {
                var q = l[n], r;
                var v = q;
                r = b;
                if ('tile-pixels' == v.l.Jb()) {
                    var x = this.a.la(), y = x.tileGrid, z = v.Ga, x = y.La(z[0]) / x.pb(), v = r.viewState, A = r.pixelRatio, V = v.resolution / A, z = y.Ta(z, this.j), y = v.center, z = eb(z);
                    r = r.size;
                    r = Fh(this.S, Math.round(A * r[0] / 2), Math.round(A * r[1] / 2), x / V, x / V, v.rotation, (z[0] - y[0]) / x, (y[1] - z[1]) / x);
                } else
                    r = pt(this, r, 0);
                x = bt(q.f.vd, r);
                v = q.Ga[0];
                a.save();
                a.globalAlpha = c.opacity;
                Qh(a, -f, h, g);
                A = 0;
                for (V = m.length; A < V; ++A)
                    y = m[A], v < p[A] && (a.beginPath(), a.moveTo(x[0], x[1]), a.lineTo(x[2], x[3]), a.lineTo(x[4], x[5]), a.lineTo(x[6], x[7]), a.moveTo(y[6], y[7]), a.lineTo(y[4], y[5]), a.lineTo(y[2], y[3]), a.lineTo(y[0], y[1]), a.clip());
                q.f.vd.i(a, e, r, f, {}, d);
                a.restore();
                m.push(x);
                p.push(v);
            }
        zv.prototype.Ue.apply(this, arguments);
    };
    function U(a) {
        a = a ? a : {};
        var b = pb({}, a);
        delete b.preload;
        delete b.useInterimTilesOnError;
        R.call(this, b);
        this.Wh(a.preload ? a.preload : 0);
        this.Xh(a.useInterimTilesOnError ? a.useInterimTilesOnError : !0);
        qa(void 0 == a.renderMode || 'image' == a.renderMode || 'hybrid' == a.renderMode || 'vector' == a.renderMode, 28);
        this.v = a.renderMode || 'hybrid';
    }
    u(U, R);
    k = U.prototype;
    k.Dd = function (a) {
        var b = null;
        'canvas' === a.T() && (b = new Iv(this));
        return b;
    };
    k.Pd = function () {
        return this.get(Mv);
    };
    k.Td = function () {
        return this.get(Nv);
    };
    k.Wh = function (a) {
        this.set('preload', a);
    };
    k.Xh = function (a) {
        this.set('useInterimTilesOnError', a);
    };
    var Mv = 'preload', Nv = 'useInterimTilesOnError';
    function Ov(a, b, c, d) {
        function e() {
            delete window[g];
            f.parentNode.removeChild(f);
        }
        var f = document.createElement('script'), g = 'olc_' + w(b);
        f.async = !0;
        f.src = a + (-1 == a.indexOf('?') ? '?' : '&') + (d || 'callback') + '=' + g;
        var h = setTimeout(function () {
            e();
            c && c();
        }, 10000);
        window[g] = function (a) {
            clearTimeout(h);
            e();
            b(a);
        };
        document.getElementsByTagName('head')[0].appendChild(f);
    }
    function Pv(a, b, c, d, e, f, g, h, l, m, p) {
        vs.call(this, e, 0);
        this.C = void 0 !== p ? p : !1;
        this.A = g;
        this.u = h;
        this.I = null;
        this.c = b;
        this.j = d;
        this.o = f ? f : e;
        this.f = [];
        this.wd = null;
        this.g = 0;
        f = d.Ta(this.o);
        h = this.j.D();
        e = this.c.D();
        f = h ? lb(f, h) : f;
        if (fb(f))
            if ((h = a.D()) && (e ? e = lb(e, h) : e = h), d = ev(a, c, jb(f), d.La(this.o[0])), !isFinite(d) || 0 >= d)
                this.state = 4;
            else if (this.v = new hv(a, c, f, e, d * (void 0 !== m ? m : 0.5)), this.v.c.length)
                if (this.g = b.Mc(d), c = jv(this.v), e && (a.a ? (c[1] = wa(c[1], e[1], e[3]), c[3] = wa(c[3], e[1], e[3])) : c = lb(c, e)), fb(c)) {
                    a = cc(b, c, this.g);
                    for (b = a.da; b <= a.ba; b++)
                        for (c = a.fa; c <= a.ja; c++)
                            (m = l(this.g, b, c, g)) && this.f.push(m);
                    this.f.length || (this.state = 4);
                } else
                    this.state = 4;
            else
                this.state = 4;
        else
            this.state = 4;
    }
    u(Pv, vs);
    Pv.prototype.ra = function () {
        1 == this.state && (this.wd.forEach(rc), this.wd = null);
        vs.prototype.ra.call(this);
    };
    Pv.prototype.Z = function () {
        return this.I;
    };
    Pv.prototype.Zd = function () {
        var a = [];
        this.f.forEach(function (b) {
            b && 2 == b.V() && a.push({
                extent: this.c.Ta(b.Ga),
                image: b.Z()
            });
        }, this);
        this.f.length = 0;
        if (a.length) {
            var b = this.o[0], c = this.j.fb(b), d = 'number' === typeof c ? c : c[0], c = 'number' === typeof c ? c : c[1], b = this.j.La(b), e = this.c.La(this.g), f = this.j.Ta(this.o);
            this.I = gv(d, c, this.A, e, this.c.D(), b, f, this.v, a, this.u, this.C);
            this.state = 2;
        } else
            this.state = 3;
        this.s();
    };
    Pv.prototype.load = function () {
        if (0 == this.state) {
            this.state = 1;
            this.s();
            var a = 0;
            this.wd = [];
            this.f.forEach(function (b) {
                var c = b.V();
                if (0 == c || 1 == c) {
                    a++;
                    var d;
                    d = B(b, 'change', function () {
                        var c = b.V();
                        if (2 == c || 3 == c || 4 == c)
                            rc(d), a--, a || (this.wd.forEach(rc), this.wd = null, this.Zd());
                    }, this);
                    this.wd.push(d);
                }
            }, this);
            this.f.forEach(function (a) {
                0 == a.V() && a.load();
            });
            a || setTimeout(this.Zd.bind(this), 0);
        }
    };
    function Qv(a, b) {
        var c = /\{z\}/g, d = /\{x\}/g, e = /\{y\}/g, f = /\{-y\}/g;
        return function (g) {
            if (g)
                return a.replace(c, g[0].toString()).replace(d, g[1].toString()).replace(e, function () {
                    return (-g[2] - 1).toString();
                }).replace(f, function () {
                    var a = b.a ? b.a[g[0]] : null;
                    qa(a, 55);
                    return (a.ja - a.fa + 1 + g[2]).toString();
                });
        };
    }
    function Rv(a, b) {
        for (var c = a.length, d = Array(c), e = 0; e < c; ++e)
            d[e] = Qv(a[e], b);
        return Sv(d);
    }
    function Sv(a) {
        return 1 === a.length ? a[0] : function (b, c, d) {
            if (b)
                return a[Ca((b[1] << b[0]) + b[2], a.length)](b, c, d);
        };
    }
    function Tv() {
    }
    function Uv(a) {
        var b = [], c = /\{([a-z])-([a-z])\}/.exec(a);
        if (c) {
            var d = c[2].charCodeAt(0), e;
            for (e = c[1].charCodeAt(0); e <= d; ++e)
                b.push(a.replace(c[0], String.fromCharCode(e)));
            return b;
        }
        if (c = c = /\{(\d+)-(\d+)\}/.exec(a)) {
            d = parseInt(c[2], 10);
            for (e = parseInt(c[1], 10); e <= d; e++)
                b.push(a.replace(c[0], e.toString()));
            return b;
        }
        b.push(a);
        return b;
    }
    function Vv(a) {
        jk.call(this);
        this.i = void 0 !== a ? a : 2048;
    }
    u(Vv, jk);
    function Wv(a) {
        return a.c > a.i;
    }
    Vv.prototype.gd = function (a) {
        for (var b, c; Wv(this);) {
            b = this.a.$c;
            c = b.Ga[0].toString();
            var d;
            if (d = c in a)
                b = b.Ga, d = ta(a[c], b[1], b[2]);
            if (d)
                break;
            else
                Ac(this.pop());
        }
    };
    function Xv(a) {
        Gt.call(this, {
            attributions: a.attributions,
            extent: a.extent,
            logo: a.logo,
            projection: a.projection,
            state: a.state,
            wrapX: a.wrapX
        });
        this.oa = void 0 !== a.opaque ? a.opaque : !1;
        this.Oa = void 0 !== a.tilePixelRatio ? a.tilePixelRatio : 1;
        this.tileGrid = void 0 !== a.tileGrid ? a.tileGrid : null;
        this.a = new Vv(a.cacheSize);
        this.j = [
            0,
            0
        ];
        this.tc = '';
    }
    u(Xv, Gt);
    k = Xv.prototype;
    k.fi = function () {
        return Wv(this.a);
    };
    k.gd = function (a, b) {
        var c = this.Rd(a);
        c && c.gd(b);
    };
    function et(a, b, c, d, e) {
        b = a.Rd(b);
        if (!b)
            return !1;
        for (var f = !0, g, h, l = d.da; l <= d.ba; ++l)
            for (var m = d.fa; m <= d.ja; ++m)
                g = a.Sb(c, l, m), h = !1, b.b.hasOwnProperty(g) && (g = b.get(g), (h = 2 === g.V()) && (h = !1 !== e(g))), h || (f = !1);
        return f;
    }
    k.Jf = function () {
        return 0;
    };
    function Yv(a, b) {
        a.tc !== b && (a.tc = b, a.s());
    }
    k.Sb = function (a, b, c) {
        return a + '/' + b + '/' + c;
    };
    k.Mf = function () {
        return this.oa;
    };
    k.ab = function () {
        return this.tileGrid;
    };
    k.Ib = function (a) {
        return this.tileGrid ? this.tileGrid : jc(a);
    };
    k.Rd = function (a) {
        var b = this.c;
        return b && !Tb(b, a) ? null : this.a;
    };
    k.pb = function () {
        return this.Oa;
    };
    k.Sd = function (a, b, c) {
        c = this.Ib(c);
        b = this.pb(b);
        a = Ga(c.fb(a), this.j);
        return 1 == b ? a : Fa(a, b, this.j);
    };
    function Zv(a, b, c) {
        var d = void 0 !== c ? c : a.c;
        c = a.Ib(d);
        if (a.G && d.f) {
            var e = b;
            b = e[0];
            a = ic(c, e);
            d = kc(d);
            Qa(d, a) ? b = e : (e = hb(d), a[0] += e * Math.ceil((d[0] - a[0]) / e), b = c.Pf(a, b));
        }
        e = b[0];
        d = b[1];
        a = b[2];
        if (c.minZoom > e || e > c.maxZoom)
            c = !1;
        else {
            var f = c.D();
            c = (c = f ? cc(c, f, e) : c.a ? c.a[e] : null) ? ta(c, d, a) : !0;
        }
        return c ? b : null;
    }
    k.va = function () {
        this.a.clear();
        this.s();
    };
    k.Eg = na;
    function $v(a, b) {
        Bc.call(this, a);
        this.tile = b;
    }
    u($v, Bc);
    function aw(a) {
        Xv.call(this, {
            attributions: a.attributions,
            cacheSize: a.cacheSize,
            extent: a.extent,
            logo: a.logo,
            opaque: a.opaque,
            projection: a.projection,
            state: a.state,
            tileGrid: a.tileGrid,
            tilePixelRatio: a.tilePixelRatio,
            wrapX: a.wrapX
        });
        this.tileLoadFunction = a.tileLoadFunction;
        this.tileUrlFunction = this.Fc ? this.Fc.bind(this) : Tv;
        this.urls = null;
        a.urls ? this.cb(a.urls) : a.url && this.jb(a.url);
        a.tileUrlFunction && this.bb(a.tileUrlFunction);
    }
    u(aw, Xv);
    k = aw.prototype;
    k.ob = function () {
        return this.tileLoadFunction;
    };
    k.qb = function () {
        return this.tileUrlFunction;
    };
    k.rb = function () {
        return this.urls;
    };
    k.gi = function (a) {
        a = a.target;
        switch (a.V()) {
        case 1:
            this.b(new $v('tileloadstart', a));
            break;
        case 2:
            this.b(new $v('tileloadend', a));
            break;
        case 3:
            this.b(new $v('tileloaderror', a));
        }
    };
    k.xb = function (a) {
        this.a.clear();
        this.tileLoadFunction = a;
        this.s();
    };
    k.bb = function (a, b) {
        this.tileUrlFunction = a;
        'undefined' !== typeof b ? Yv(this, b) : this.s();
    };
    k.jb = function (a) {
        var b = this.urls = Uv(a);
        this.bb(this.Fc ? this.Fc.bind(this) : Rv(b, this.tileGrid), a);
    };
    k.cb = function (a) {
        this.urls = a;
        var b = a.join('\n');
        this.bb(this.Fc ? this.Fc.bind(this) : Rv(a, this.tileGrid), b);
    };
    k.Eg = function (a, b, c) {
        a = this.Sb(a, b, c);
        this.a.b.hasOwnProperty(a) && this.a.get(a);
    };
    function W(a) {
        aw.call(this, {
            attributions: a.attributions,
            cacheSize: a.cacheSize,
            extent: a.extent,
            logo: a.logo,
            opaque: a.opaque,
            projection: a.projection,
            state: a.state,
            tileGrid: a.tileGrid,
            tileLoadFunction: a.tileLoadFunction ? a.tileLoadFunction : bw,
            tilePixelRatio: a.tilePixelRatio,
            tileUrlFunction: a.tileUrlFunction,
            url: a.url,
            urls: a.urls,
            wrapX: a.wrapX
        });
        this.crossOrigin = void 0 !== a.crossOrigin ? a.crossOrigin : null;
        this.tileClass = a.tileClass ? a.tileClass : xs;
        this.g = {};
        this.v = {};
        this.Ha = a.reprojectionErrorThreshold;
        this.C = !1;
    }
    u(W, aw);
    k = W.prototype;
    k.fi = function () {
        if (Wv(this.a))
            return !0;
        for (var a in this.g)
            if (Wv(this.g[a]))
                return !0;
        return !1;
    };
    k.gd = function (a, b) {
        var c = this.Rd(a);
        this.a.gd(this.a == c ? b : {});
        for (var d in this.g) {
            var e = this.g[d];
            e.gd(e == c ? b : {});
        }
    };
    k.Jf = function (a) {
        return this.c && a && !Tb(this.c, a) ? 0 : this.Kf();
    };
    k.Kf = function () {
        return 0;
    };
    k.Mf = function (a) {
        return this.c && a && !Tb(this.c, a) ? !1 : aw.prototype.Mf.call(this, a);
    };
    k.Ib = function (a) {
        var b = this.c;
        return !this.tileGrid || b && !Tb(b, a) ? (b = w(a).toString(), b in this.v || (this.v[b] = jc(a)), this.v[b]) : this.tileGrid;
    };
    k.Rd = function (a) {
        var b = this.c;
        if (!b || Tb(b, a))
            return this.a;
        a = w(a).toString();
        a in this.g || (this.g[a] = new Vv());
        return this.g[a];
    };
    function cw(a, b, c, d, e, f, g) {
        b = [
            b,
            c,
            d
        ];
        e = (c = Zv(a, b, f)) ? a.tileUrlFunction(c, e, f) : void 0;
        e = new a.tileClass(b, void 0 !== e ? 0 : 4, void 0 !== e ? e : '', a.crossOrigin, a.tileLoadFunction);
        e.key = g;
        B(e, 'change', a.gi, a);
        return e;
    }
    k.Lc = function (a, b, c, d, e) {
        if (this.c && e && !Tb(this.c, e)) {
            var f = this.Rd(e);
            c = [
                a,
                b,
                c
            ];
            var g;
            a = this.Sb.apply(this, c);
            f.b.hasOwnProperty(a) && (g = f.get(a));
            b = this.tc;
            if (g && g.key == b)
                return g;
            var h = this.c, l = this.Ib(h), m = this.Ib(e), p = Zv(this, c, e);
            d = new Pv(h, l, e, m, c, p, this.pb(d), this.Kf(), function (a, b, c, d) {
                return dw(this, a, b, c, d, h);
            }.bind(this), this.Ha, this.C);
            d.key = b;
            g ? (d.a = g, f.replace(a, d)) : f.set(a, d);
            return d;
        }
        return dw(this, a, b, c, d, e);
    };
    function dw(a, b, c, d, e, f) {
        var g, h = a.Sb(b, c, d), l = a.tc;
        if (a.a.b.hasOwnProperty(h)) {
            if (g = a.a.get(h), g.key != l) {
                var m = g;
                g = cw(a, b, c, d, e, f, l);
                0 == m.V() ? g.a = m.a : g.a = m;
                if (g.a) {
                    b = g.a;
                    c = g;
                    do {
                        if (2 == b.V()) {
                            b.a = null;
                            break;
                        } else
                            1 == b.V() ? c = b : 0 == b.V() ? c.a = b.a : c = b;
                        b = c.a;
                    } while (b);
                }
                a.a.replace(h, g);
            }
        } else
            g = cw(a, b, c, d, e, f, l), a.a.set(h, g);
        return g;
    }
    k.Nb = function (a) {
        if (this.C != a) {
            this.C = a;
            for (var b in this.g)
                this.g[b].clear();
            this.s();
        }
    };
    k.Ob = function (a, b) {
        var c = Gb(a);
        c && (c = w(c).toString(), c in this.v || (this.v[c] = b));
    };
    function bw(a, b) {
        a.Z().src = b;
    }
    function ew(a) {
        this.A = void 0 !== a.hidpi ? a.hidpi : !1;
        W.call(this, {
            cacheSize: a.cacheSize,
            crossOrigin: 'anonymous',
            opaque: !0,
            projection: Gb('EPSG:3857'),
            reprojectionErrorThreshold: a.reprojectionErrorThreshold,
            state: 'loading',
            tileLoadFunction: a.tileLoadFunction,
            tilePixelRatio: this.A ? 2 : 1,
            wrapX: void 0 !== a.wrapX ? a.wrapX : !0
        });
        this.S = void 0 !== a.culture ? a.culture : 'en-us';
        this.u = void 0 !== a.maxZoom ? a.maxZoom : -1;
        this.i = a.key;
        this.o = a.imagerySet;
        Ov('https://dev.virtualearth.net/REST/v1/Imagery/Metadata/' + this.o + '?uriScheme=https&include=ImageryProviders&key=' + this.i, this.ia.bind(this), void 0, 'jsonp');
    }
    u(ew, W);
    var fw = new nc({ html: '<a class="ol-attribution-bing-tos" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a>' });
    ew.prototype.Y = function () {
        return this.i;
    };
    ew.prototype.ea = function () {
        return this.o;
    };
    ew.prototype.ia = function (a) {
        if (200 != a.statusCode || 'OK' != a.statusDescription || 'ValidCredentials' != a.authenticationResultCode || 1 != a.resourceSets.length || 1 != a.resourceSets[0].resources.length)
            It(this, 'error');
        else {
            var b = a.brandLogoUri;
            -1 == b.indexOf('https') && (b = b.replace('http', 'https'));
            var c = a.resourceSets[0].resources[0], d = -1 == this.u ? c.zoomMax : this.u;
            a = kc(this.c);
            var e = mc({
                extent: a,
                minZoom: c.zoomMin,
                maxZoom: d,
                tileSize: (c.imageWidth == c.imageHeight ? c.imageWidth : [
                    c.imageWidth,
                    c.imageHeight
                ]) / this.pb()
            });
            this.tileGrid = e;
            var f = this.S, g = this.A;
            this.tileUrlFunction = Sv(c.imageUrlSubdomains.map(function (a) {
                var b = [
                        0,
                        0,
                        0
                    ], d = c.imageUrl.replace('{subdomain}', a).replace('{culture}', f);
                return function (a) {
                    if (a)
                        return Yb(a[0], a[1], -a[2] - 1, b), a = d, g && (a += '&dpi=d1&device=mobile'), a.replace('{quadkey}', Zb(b));
                };
            }));
            if (c.imageryProviders) {
                var h = Fb(Gb('EPSG:4326'), this.c);
                a = c.imageryProviders.map(function (a) {
                    var b = a.attribution, c = {};
                    a.coverageAreas.forEach(function (a) {
                        var b = a.zoomMin, f = Math.min(a.zoomMax, d);
                        a = a.bbox;
                        a = ob([
                            a[1],
                            a[0],
                            a[3],
                            a[2]
                        ], h);
                        var g, l;
                        for (g = b; g <= f; ++g)
                            l = g.toString(), b = cc(e, a, g), l in c ? c[l].push(b) : c[l] = [b];
                    });
                    return new nc({
                        html: b,
                        tileRanges: c
                    });
                });
                a.push(fw);
                this.ua(a);
            }
            this.R = b;
            It(this, 'ready');
        }
    };
    function gw(a) {
        a = a || {};
        var b = void 0 !== a.projection ? a.projection : 'EPSG:3857', c = void 0 !== a.tileGrid ? a.tileGrid : mc({
                extent: kc(b),
                maxZoom: a.maxZoom,
                minZoom: a.minZoom,
                tileSize: a.tileSize
            });
        W.call(this, {
            attributions: a.attributions,
            cacheSize: a.cacheSize,
            crossOrigin: a.crossOrigin,
            logo: a.logo,
            opaque: a.opaque,
            projection: b,
            reprojectionErrorThreshold: a.reprojectionErrorThreshold,
            tileGrid: c,
            tileLoadFunction: a.tileLoadFunction,
            tilePixelRatio: a.tilePixelRatio,
            tileUrlFunction: a.tileUrlFunction,
            url: a.url,
            urls: a.urls,
            wrapX: void 0 !== a.wrapX ? a.wrapX : !0
        });
    }
    u(gw, W);
    function hw(a) {
        this.u = a.account;
        this.A = a.map || '';
        this.i = a.config || {};
        this.o = {};
        gw.call(this, {
            attributions: a.attributions,
            cacheSize: a.cacheSize,
            crossOrigin: a.crossOrigin,
            logo: a.logo,
            maxZoom: void 0 !== a.maxZoom ? a.maxZoom : 18,
            minZoom: a.minZoom,
            projection: a.projection,
            state: 'loading',
            wrapX: a.wrapX
        });
        iw(this);
    }
    u(hw, gw);
    k = hw.prototype;
    k.pk = function () {
        return this.i;
    };
    k.Fp = function (a) {
        pb(this.i, a);
        iw(this);
    };
    k.np = function (a) {
        this.i = a || {};
        iw(this);
    };
    function iw(a) {
        var b = JSON.stringify(a.i);
        if (a.o[b])
            jw(a, a.o[b]);
        else {
            var c = 'https://' + a.u + '.cartodb.com/api/v1/map';
            a.A && (c += '/named/' + a.A);
            var d = new XMLHttpRequest();
            d.addEventListener('load', a.jl.bind(a, b));
            d.addEventListener('error', a.il.bind(a));
            d.open('POST', c);
            d.setRequestHeader('Content-type', 'application/json');
            d.send(JSON.stringify(a.i));
        }
    }
    k.jl = function (a, b) {
        var c = b.target;
        if (!c.status || 200 <= c.status && 300 > c.status) {
            var d;
            try {
                d = JSON.parse(c.responseText);
            } catch (e) {
                It(this, 'error');
                return;
            }
            jw(this, d);
            this.o[a] = d;
            It(this, 'ready');
        } else
            It(this, 'error');
    };
    k.il = function () {
        It(this, 'error');
    };
    function jw(a, b) {
        a.jb('https://' + b.cdn_url.https + '/' + a.u + '/api/v1/map/' + b.layergroupid + '/{z}/{x}/{y}.png');
    }
    function X(a) {
        S.call(this, {
            attributions: a.attributions,
            extent: a.extent,
            logo: a.logo,
            projection: a.projection,
            wrapX: a.wrapX
        });
        this.C = void 0;
        this.ia = void 0 !== a.distance ? a.distance : 20;
        this.A = [];
        this.Ra = a.geometryFunction || function (a) {
            a = a.U();
            qa(a instanceof E, 10);
            return a;
        };
        this.u = a.source;
        this.u.J('change', X.prototype.Oa, this);
    }
    u(X, S);
    X.prototype.lb = function () {
        return this.u;
    };
    X.prototype.Ud = function (a, b, c) {
        this.u.Ud(a, b, c);
        b !== this.C && (this.clear(), this.C = b, kw(this), this.dd(this.A));
    };
    X.prototype.mb = function (a) {
        this.ia = a;
        this.Oa();
    };
    X.prototype.Oa = function () {
        this.clear();
        kw(this);
        this.dd(this.A);
        this.s();
    };
    function kw(a) {
        if (void 0 !== a.C) {
            a.A.length = 0;
            for (var b = Ia(), c = a.ia * a.C, d = a.u.Ne(), e = {}, f = 0, g = d.length; f < g; f++) {
                var h = d[f];
                w(h).toString() in e || !(h = a.Ra(h)) || (h = h.X(), Wa(h, b), Ka(b, c, b), h = a.u.Hf(b), h = h.filter(function (a) {
                    a = w(a).toString();
                    return a in e ? !1 : e[a] = !0;
                }), a.A.push(lw(a, h)));
            }
        }
    }
    function lw(a, b) {
        for (var c = [
                    0,
                    0
                ], d = b.length - 1; 0 <= d; --d) {
            var e = a.Ra(b[d]);
            e ? Qe(c, e.X()) : b.splice(d, 1);
        }
        We(c, 1 / b.length);
        c = new H(new E(c));
        c.set('features', b);
        return c;
    }
    function mw(a, b) {
        var c = [];
        Object.keys(b).forEach(function (a) {
            null !== b[a] && void 0 !== b[a] && c.push(a + '=' + encodeURIComponent(b[a]));
        });
        var d = c.join('&');
        a = a.replace(/[?&]$/, '');
        a = -1 === a.indexOf('?') ? a + '?' : a + '&';
        return a + d;
    }
    function nw(a) {
        a = a || {};
        lv.call(this, {
            attributions: a.attributions,
            logo: a.logo,
            projection: a.projection,
            resolutions: a.resolutions
        });
        this.S = void 0 !== a.crossOrigin ? a.crossOrigin : null;
        this.Y = void 0 !== a.hidpi ? a.hidpi : !0;
        this.i = a.url;
        this.g = a.imageLoadFunction ? a.imageLoadFunction : rv;
        this.v = a.params || {};
        this.M = null;
        this.o = [
            0,
            0
        ];
        this.C = 0;
        this.A = void 0 !== a.ratio ? a.ratio : 1.5;
    }
    u(nw, lv);
    k = nw.prototype;
    k.rn = function () {
        return this.v;
    };
    k.Ic = function (a, b, c, d) {
        if (void 0 === this.i)
            return null;
        b = mv(this, b);
        c = this.Y ? c : 1;
        var e = this.M;
        if (e && this.C == this.f && e.resolution == b && e.a == c && Ta(e.D(), a))
            return e;
        e = {
            F: 'image',
            FORMAT: 'PNG32',
            TRANSPARENT: !0
        };
        pb(e, this.v);
        a = a.slice();
        var f = (a[0] + a[2]) / 2, g = (a[1] + a[3]) / 2;
        if (1 != this.A) {
            var h = this.A * hb(a) / 2, l = this.A * ib(a) / 2;
            a[0] = f - h;
            a[1] = g - l;
            a[2] = f + h;
            a[3] = g + l;
        }
        var h = b / c, l = Math.ceil(hb(a) / h), m = Math.ceil(ib(a) / h);
        a[0] = f - h * l / 2;
        a[2] = f + h * l / 2;
        a[1] = g - h * m / 2;
        a[3] = g + h * m / 2;
        this.o[0] = l;
        this.o[1] = m;
        f = a;
        g = this.o;
        h = c;
        d = d.nb.split(':').pop();
        e.SIZE = g[0] + ',' + g[1];
        e.BBOX = f.join(',');
        e.BBOXSR = d;
        e.IMAGESR = d;
        e.DPI = Math.round(90 * h);
        d = this.i;
        f = d.replace(/MapServer\/?$/, 'MapServer/export').replace(/ImageServer\/?$/, 'ImageServer/exportImage');
        f == d && qa(!1, 50);
        e = mw(f, e);
        this.M = new ts(a, b, c, this.l, e, this.S, this.g);
        this.C = this.f;
        B(this.M, 'change', this.j, this);
        return this.M;
    };
    k.qn = function () {
        return this.g;
    };
    k.sn = function () {
        return this.i;
    };
    k.tn = function (a) {
        this.M = null;
        this.g = a;
        this.s();
    };
    k.vn = function (a) {
        a != this.i && (this.i = a, this.M = null, this.s());
    };
    k.wn = function (a) {
        pb(this.v, a);
        this.M = null;
        this.s();
    };
    function ow(a) {
        lv.call(this, {
            projection: a.projection,
            resolutions: a.resolutions
        });
        this.S = void 0 !== a.crossOrigin ? a.crossOrigin : null;
        this.o = void 0 !== a.displayDpi ? a.displayDpi : 96;
        this.g = a.params || {};
        this.C = a.url;
        this.i = a.imageLoadFunction ? a.imageLoadFunction : rv;
        this.Y = void 0 !== a.hidpi ? a.hidpi : !0;
        this.ia = void 0 !== a.metersPerUnit ? a.metersPerUnit : 1;
        this.v = void 0 !== a.ratio ? a.ratio : 1;
        this.oa = void 0 !== a.useOverlay ? a.useOverlay : !1;
        this.M = null;
        this.A = 0;
    }
    u(ow, lv);
    k = ow.prototype;
    k.yn = function () {
        return this.g;
    };
    k.Ic = function (a, b, c) {
        b = mv(this, b);
        c = this.Y ? c : 1;
        var d = this.M;
        if (d && this.A == this.f && d.resolution == b && d.a == c && Ta(d.D(), a))
            return d;
        1 != this.v && (a = a.slice(), nb(a, this.v));
        var e = [
            hb(a) / b * c,
            ib(a) / b * c
        ];
        if (void 0 !== this.C) {
            var d = this.C, f = jb(a), g = this.ia, h = hb(a), l = ib(a), m = e[0], p = e[1], n = 0.0254 / this.o, e = {
                    OPERATION: this.oa ? 'GETDYNAMICMAPOVERLAYIMAGE' : 'GETMAPIMAGE',
                    VERSION: '2.0.0',
                    LOCALE: 'en',
                    CLIENTAGENT: 'ol.source.ImageMapGuide source',
                    CLIP: '1',
                    SETDISPLAYDPI: this.o,
                    SETDISPLAYWIDTH: Math.round(e[0]),
                    SETDISPLAYHEIGHT: Math.round(e[1]),
                    SETVIEWSCALE: p * h > m * l ? h * g / (m * n) : l * g / (p * n),
                    SETVIEWCENTERX: f[0],
                    SETVIEWCENTERY: f[1]
                };
            pb(e, this.g);
            d = mw(d, e);
            d = new ts(a, b, c, this.l, d, this.S, this.i);
            B(d, 'change', this.j, this);
        } else
            d = null;
        this.M = d;
        this.A = this.f;
        return d;
    };
    k.xn = function () {
        return this.i;
    };
    k.An = function (a) {
        pb(this.g, a);
        this.s();
    };
    k.zn = function (a) {
        this.M = null;
        this.i = a;
        this.s();
    };
    function pw(a) {
        var b = a.imageExtent, c = void 0 !== a.crossOrigin ? a.crossOrigin : null, d = a.imageLoadFunction ? a.imageLoadFunction : rv;
        lv.call(this, {
            attributions: a.attributions,
            logo: a.logo,
            projection: Gb(a.projection)
        });
        this.M = new ts(b, void 0, 1, this.l, a.url, c, d);
        this.i = a.imageSize ? a.imageSize : null;
        B(this.M, 'change', this.j, this);
    }
    u(pw, lv);
    pw.prototype.Ic = function (a) {
        return mb(a, this.M.D()) ? this.M : null;
    };
    pw.prototype.j = function (a) {
        if (2 == this.M.V()) {
            var b = this.M.D(), c = this.M.Z(), d, e;
            this.i ? (d = this.i[0], e = this.i[1]) : (d = c.width, e = c.height);
            b = Math.ceil(hb(b) / (ib(b) / e));
            if (b != d) {
                var b = Xc(b, e), f = b.canvas;
                b.drawImage(c, 0, 0, d, e, 0, 0, f.width, f.height);
                this.M.zg(f);
            }
        }
        lv.prototype.j.call(this, a);
    };
    function qw(a) {
        a = a || {};
        lv.call(this, {
            attributions: a.attributions,
            logo: a.logo,
            projection: a.projection,
            resolutions: a.resolutions
        });
        this.ia = void 0 !== a.crossOrigin ? a.crossOrigin : null;
        this.g = a.url;
        this.v = a.imageLoadFunction ? a.imageLoadFunction : rv;
        this.i = a.params || {};
        this.o = !0;
        rw(this);
        this.Y = a.serverType;
        this.oa = void 0 !== a.hidpi ? a.hidpi : !0;
        this.M = null;
        this.A = [
            0,
            0
        ];
        this.S = 0;
        this.C = void 0 !== a.ratio ? a.ratio : 1.5;
    }
    u(qw, lv);
    var sw = [
        101,
        101
    ];
    k = qw.prototype;
    k.Gn = function (a, b, c, d) {
        if (void 0 !== this.g) {
            var e = kb(a, b, 0, sw), f = {
                    SERVICE: 'WMS',
                    VERSION: '1.3.0',
                    REQUEST: 'GetFeatureInfo',
                    FORMAT: 'image/png',
                    TRANSPARENT: !0,
                    QUERY_LAYERS: this.i.LAYERS
                };
            pb(f, this.i, d);
            d = Math.floor((e[3] - a[1]) / b);
            f[this.o ? 'I' : 'X'] = Math.floor((a[0] - e[0]) / b);
            f[this.o ? 'J' : 'Y'] = d;
            return tw(this, e, sw, 1, Gb(c), f);
        }
    };
    k.In = function () {
        return this.i;
    };
    k.Ic = function (a, b, c, d) {
        if (void 0 === this.g)
            return null;
        b = mv(this, b);
        1 == c || this.oa && void 0 !== this.Y || (c = 1);
        var e = b / c, f = jb(a), g = kb(f, b, 0, [
                Math.ceil(hb(a) / e),
                Math.ceil(ib(a) / e)
            ]);
        a = kb(f, b, 0, [
            Math.ceil(this.C * hb(a) / e),
            Math.ceil(this.C * ib(a) / e)
        ]);
        if ((f = this.M) && this.S == this.f && f.resolution == b && f.a == c && Ta(f.D(), g))
            return f;
        g = {
            SERVICE: 'WMS',
            VERSION: '1.3.0',
            REQUEST: 'GetMap',
            FORMAT: 'image/png',
            TRANSPARENT: !0
        };
        pb(g, this.i);
        this.A[0] = Math.round(hb(a) / e);
        this.A[1] = Math.round(ib(a) / e);
        d = tw(this, a, this.A, c, d, g);
        this.M = new ts(a, b, c, this.l, d, this.ia, this.v);
        this.S = this.f;
        B(this.M, 'change', this.j, this);
        return this.M;
    };
    k.Hn = function () {
        return this.v;
    };
    function tw(a, b, c, d, e, f) {
        qa(void 0 !== a.g, 9);
        f[a.o ? 'CRS' : 'SRS'] = e.nb;
        'STYLES' in a.i || (f.STYLES = '');
        if (1 != d)
            switch (a.Y) {
            case 'geoserver':
                d = 90 * d + 0.5 | 0;
                f.FORMAT_OPTIONS = 'FORMAT_OPTIONS' in f ? f.FORMAT_OPTIONS + (';dpi:' + d) : 'dpi:' + d;
                break;
            case 'mapserver':
                f.MAP_RESOLUTION = 90 * d;
                break;
            case 'carmentaserver':
            case 'qgis':
                f.DPI = 90 * d;
                break;
            default:
                qa(!1, 8);
            }
        f.WIDTH = c[0];
        f.HEIGHT = c[1];
        c = e.b;
        var g;
        a.o && 'ne' == c.substr(0, 2) ? g = [
            b[1],
            b[0],
            b[3],
            b[2]
        ] : g = b;
        f.BBOX = g.join(',');
        return mw(a.g, f);
    }
    k.Jn = function () {
        return this.g;
    };
    k.Kn = function (a) {
        this.M = null;
        this.v = a;
        this.s();
    };
    k.Ln = function (a) {
        a != this.g && (this.g = a, this.M = null, this.s());
    };
    k.Mn = function (a) {
        pb(this.i, a);
        rw(this);
        this.M = null;
        this.s();
    };
    function rw(a) {
        a.o = 0 <= Pe(a.i.VERSION || '1.3.0');
    }
    function uw(a) {
        a = a || {};
        var b;
        void 0 !== a.attributions ? b = a.attributions : b = [vw];
        gw.call(this, {
            attributions: b,
            cacheSize: a.cacheSize,
            crossOrigin: void 0 !== a.crossOrigin ? a.crossOrigin : 'anonymous',
            opaque: void 0 !== a.opaque ? a.opaque : !0,
            maxZoom: void 0 !== a.maxZoom ? a.maxZoom : 19,
            reprojectionErrorThreshold: a.reprojectionErrorThreshold,
            tileLoadFunction: a.tileLoadFunction,
            url: void 0 !== a.url ? a.url : 'https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png',
            wrapX: a.wrapX
        });
    }
    u(uw, gw);
    var vw = new nc({ html: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.' });
    (function () {
        var a = {}, b = { ma: a };
        (function (c) {
            if ('object' === typeof a && 'undefined' !== typeof b)
                b.ma = c();
            else {
                var d;
                'undefined' !== typeof window ? d = window : 'undefined' !== typeof global ? d = global : 'undefined' !== typeof self ? d = self : d = this;
                d.bq = c();
            }
        }(function () {
            return function d(a, b, g) {
                function e(h, l) {
                    if (!b[h]) {
                        if (!a[h]) {
                            var m = 'function' == typeof require && require;
                            if (!l && m)
                                return m(h, !0);
                            if (f)
                                return f(h, !0);
                            m = Error('Cannot find module \'' + h + '\'');
                            throw m.code = 'MODULE_NOT_FOUND', m;
                        }
                        m = b[h] = { ma: {} };
                        a[h][0].call(m.ma, function (b) {
                            var d = a[h][1][b];
                            return e(d ? d : b);
                        }, m, m.ma, d, a, b, g);
                    }
                    return b[h].ma;
                }
                for (var f = 'function' == typeof require && require, m = 0; m < g.length; m++)
                    e(g[m]);
                return e;
            }({
                1: [
                    function (a, b, f) {
                        a = a('./processor');
                        f.yj = a;
                    },
                    { './processor': 2 }
                ],
                2: [
                    function (a, b) {
                        function d(a) {
                            var b = !0;
                            try {
                                new ImageData(10, 10);
                            } catch (q) {
                                b = !1;
                            }
                            return function (d) {
                                var e = d.buffers, f = d.meta, g = d.width, h = d.height, l = e.length, m = e[0].byteLength;
                                if (d.imageOps) {
                                    m = Array(l);
                                    for (d = 0; d < l; ++d) {
                                        var n = m, p = d, q;
                                        q = new Uint8ClampedArray(e[d]);
                                        var La = g, C = h;
                                        q = b ? new ImageData(q, La, C) : {
                                            data: q,
                                            width: La,
                                            height: C
                                        };
                                        n[p] = q;
                                    }
                                    g = a(m, f).data;
                                } else {
                                    g = new Uint8ClampedArray(m);
                                    h = Array(l);
                                    n = Array(l);
                                    for (d = 0; d < l; ++d)
                                        h[d] = new Uint8ClampedArray(e[d]), n[d] = [
                                            0,
                                            0,
                                            0,
                                            0
                                        ];
                                    for (e = 0; e < m; e += 4) {
                                        for (d = 0; d < l; ++d)
                                            p = h[d], n[d][0] = p[e], n[d][1] = p[e + 1], n[d][2] = p[e + 2], n[d][3] = p[e + 3];
                                        d = a(n, f);
                                        g[e] = d[0];
                                        g[e + 1] = d[1];
                                        g[e + 2] = d[2];
                                        g[e + 3] = d[3];
                                    }
                                }
                                return g.buffer;
                            };
                        }
                        function e(a, b) {
                            var e = Object.keys(a.lib || {}).map(function (b) {
                                    return 'var ' + b + ' = ' + a.lib[b].toString() + ';';
                                }).concat([
                                    'var __minion__ = (' + d.toString() + ')(',
                                    a.operation.toString(),
                                    ');',
                                    'self.addEventListener("message", function(event) {',
                                    '  var buffer = __minion__(event.data);',
                                    '  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);',
                                    '});'
                                ]), e = URL.createObjectURL(new Blob(e, { type: 'text/javascript' })), e = new Worker(e);
                            e.addEventListener('message', b);
                            return e;
                        }
                        function h(a, b) {
                            var e = d(a.operation);
                            return {
                                postMessage: function (a) {
                                    setTimeout(function () {
                                        b({
                                            data: {
                                                buffer: e(a),
                                                meta: a.meta
                                            }
                                        });
                                    }, 0);
                                }
                            };
                        }
                        function l(a) {
                            this.uf = !!a.Gl;
                            var b;
                            0 === a.threads ? b = 0 : this.uf ? b = 1 : b = a.threads || 1;
                            var d = [];
                            if (b)
                                for (var f = 0; f < b; ++f)
                                    d[f] = e(a, this.Qg.bind(this, f));
                            else
                                d[0] = h(a, this.Qg.bind(this, 0));
                            this.le = d;
                            this.Cd = [];
                            this.Mj = a.Go || Infinity;
                            this.je = 0;
                            this.cd = {};
                            this.vf = null;
                        }
                        var m = a('./util').$l;
                        l.prototype.Eo = function (a, b, d) {
                            this.Kj({
                                inputs: a,
                                Ch: b,
                                fd: d
                            });
                            this.Ng();
                        };
                        l.prototype.Kj = function (a) {
                            for (this.Cd.push(a); this.Cd.length > this.Mj;)
                                this.Cd.shift().fd(null, null);
                        };
                        l.prototype.Ng = function () {
                            if (0 === this.je && 0 < this.Cd.length) {
                                var a = this.vf = this.Cd.shift(), b = a.inputs[0].width, d = a.inputs[0].height, e = a.inputs.map(function (a) {
                                        return a.data.buffer;
                                    }), f = this.le.length;
                                this.je = f;
                                if (1 === f)
                                    this.le[0].postMessage({
                                        buffers: e,
                                        meta: a.Ch,
                                        imageOps: this.uf,
                                        width: b,
                                        height: d
                                    }, e);
                                else
                                    for (var g = 4 * Math.ceil(a.inputs[0].data.length / 4 / f), h = 0; h < f; ++h) {
                                        for (var l = h * g, m = [], V = 0, Pa = e.length; V < Pa; ++V)
                                            m.push(e[h].slice(l, l + g));
                                        this.le[h].postMessage({
                                            buffers: m,
                                            meta: a.Ch,
                                            imageOps: this.uf,
                                            width: b,
                                            height: d
                                        }, m);
                                    }
                            }
                        };
                        l.prototype.Qg = function (a, b) {
                            this.$p || (this.cd[a] = b.data, --this.je, 0 === this.je && this.Nj());
                        };
                        l.prototype.Nj = function () {
                            var a = this.vf, b = this.le.length, d, e;
                            if (1 === b)
                                d = new Uint8ClampedArray(this.cd[0].buffer), e = this.cd[0].meta;
                            else {
                                var f = a.inputs[0].data.length;
                                d = new Uint8ClampedArray(f);
                                e = Array(f);
                                for (var f = 4 * Math.ceil(f / 4 / b), g = 0; g < b; ++g) {
                                    var h = g * f;
                                    d.set(new Uint8ClampedArray(this.cd[g].buffer), h);
                                    e[g] = this.cd[g].meta;
                                }
                            }
                            this.vf = null;
                            this.cd = {};
                            a.fd(null, m(d, a.inputs[0].width, a.inputs[0].height), e);
                            this.Ng();
                        };
                        b.ma = l;
                    },
                    { './util': 3 }
                ],
                3: [
                    function (a, b, f) {
                        var d = !0;
                        try {
                            new ImageData(10, 10);
                        } catch (l) {
                            d = !1;
                        }
                        var e = document.createElement('canvas').getContext('2d');
                        f.$l = function (a, b, f) {
                            if (d)
                                return new ImageData(a, b, f);
                            b = e.createImageData(b, f);
                            b.data.set(a);
                            return b;
                        };
                    },
                    {}
                ]
            }, {}, [1])(1);
        }));
        Dj = b.ma;
    }());
    function ww(a) {
        this.C = null;
        this.Ha = void 0 !== a.operationType ? a.operationType : 'pixel';
        this.Oa = void 0 !== a.threads ? a.threads : 1;
        this.i = xw(a.sources);
        for (var b = 0, c = this.i.length; b < c; ++b)
            B(this.i[b], 'change', this.s, this);
        this.g = Xc();
        this.ia = new Fe(function () {
            return 1;
        }, this.s.bind(this));
        for (var b = yw(this.i), c = {}, d = 0, e = b.length; d < e; ++d)
            c[w(b[d].layer)] = b[d];
        this.o = this.v = null;
        this.Y = {
            animate: !1,
            attributions: {},
            coordinateToPixelTransform: wh(),
            extent: null,
            focus: null,
            index: 0,
            layerStates: c,
            layerStatesArray: b,
            logos: {},
            pixelRatio: 1,
            pixelToCoordinateTransform: wh(),
            postRenderFunctions: [],
            size: [
                0,
                0
            ],
            skippedFeatureUids: {},
            tileQueue: this.ia,
            time: Date.now(),
            usedTiles: {},
            viewState: { rotation: 0 },
            viewHints: [],
            wantedTiles: {}
        };
        lv.call(this, {});
        a.operation && this.A(a.operation, a.lib);
    }
    u(ww, lv);
    ww.prototype.A = function (a, b) {
        this.C = new Dj.yj({
            operation: a,
            Gl: 'image' === this.Ha,
            Go: 1,
            lib: b,
            threads: this.Oa
        });
        this.s();
    };
    function zw(a, b, c) {
        var d = a.v;
        return !d || a.f !== d.kp || c !== d.resolution || !Za(b, d.extent);
    }
    ww.prototype.Z = function (a, b, c, d) {
        c = !0;
        for (var e, f = 0, g = this.i.length; f < g; ++f)
            if (e = this.i[f].a.la(), 'ready' !== e.V()) {
                c = !1;
                break;
            }
        if (!c)
            return null;
        a = a.slice();
        if (!zw(this, a, b))
            return this.o;
        c = this.g.canvas;
        e = Math.round(hb(a) / b);
        f = Math.round(ib(a) / b);
        if (e !== c.width || f !== c.height)
            c.width = e, c.height = f;
        e = pb({}, this.Y);
        e.viewState = pb({}, e.viewState);
        var f = jb(a), g = Math.round(hb(a) / b), h = Math.round(ib(a) / b);
        e.extent = a;
        e.focus = jb(a);
        e.size[0] = g;
        e.size[1] = h;
        g = e.viewState;
        g.center = f;
        g.projection = d;
        g.resolution = b;
        this.o = d = new us(a, b, 1, this.l, c, this.S.bind(this, e));
        this.v = {
            extent: a,
            resolution: b,
            kp: this.f
        };
        return d;
    };
    ww.prototype.S = function (a, b) {
        for (var c = this.i.length, d = Array(c), e = 0; e < c; ++e) {
            var f;
            f = this.i[e];
            var g = a, h = a.layerStatesArray[e];
            if (f.qd(g, h)) {
                var l = g.size[0], m = g.size[1];
                if (Aw) {
                    var p = Aw.canvas;
                    p.width !== l || p.height !== m ? Aw = Xc(l, m) : Aw.clearRect(0, 0, l, m);
                } else
                    Aw = Xc(l, m);
                f.I(g, h, Aw);
                f = Aw.getImageData(0, 0, l, m);
            } else
                f = null;
            if (f)
                d[e] = f;
            else {
                d = null;
                break;
            }
        }
        d && (c = {}, this.b(new Bw(Cw, a, c)), this.C.Eo(d, c, this.oa.bind(this, a, b)));
        Ge(a.tileQueue, 16, 16);
    };
    ww.prototype.oa = function (a, b, c, d, e) {
        c ? b(c) : d && (this.b(new Bw(Dw, a, e)), zw(this, a.extent, a.viewState.resolution / a.pixelRatio) || this.g.putImageData(d, 0, 0), b(null));
    };
    var Aw = null;
    function yw(a) {
        return a.map(function (a) {
            return eh(a.a);
        });
    }
    function xw(a) {
        for (var b = a.length, c = Array(b), d = 0; d < b; ++d) {
            var e = d, f = a[d], g = null;
            f instanceof Xv ? (f = new Hv({ source: f }), g = new zv(f)) : f instanceof lv && (f = new yv({ source: f }), g = new dv(f));
            c[e] = g;
        }
        return c;
    }
    function Bw(a, b, c) {
        Bc.call(this, a);
        this.extent = b.extent;
        this.resolution = b.viewState.resolution / b.pixelRatio;
        this.data = c;
    }
    u(Bw, Bc);
    ww.prototype.Ic = function () {
        return null;
    };
    var Cw = 'beforeoperations', Dw = 'afteroperations';
    function Ew(a) {
        var b = a.layer.indexOf('-'), b = Fw[-1 == b ? a.layer : a.layer.slice(0, b)], c = Gw[a.layer];
        gw.call(this, {
            attributions: Hw,
            cacheSize: a.cacheSize,
            crossOrigin: 'anonymous',
            maxZoom: void 0 != a.maxZoom ? a.maxZoom : b.maxZoom,
            minZoom: void 0 != a.minZoom ? a.minZoom : b.minZoom,
            opaque: c.opaque,
            reprojectionErrorThreshold: a.reprojectionErrorThreshold,
            tileLoadFunction: a.tileLoadFunction,
            url: void 0 !== a.url ? a.url : 'https://stamen-tiles-{a-d}.a.ssl.fastly.net/' + a.layer + '/{z}/{x}/{y}.' + c.Hb
        });
    }
    u(Ew, gw);
    var Hw = [
            new nc({ html: 'Map tiles by <a href="http://stamen.com/">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.' }),
            vw
        ], Gw = {
            terrain: {
                Hb: 'jpg',
                opaque: !0
            },
            'terrain-background': {
                Hb: 'jpg',
                opaque: !0
            },
            'terrain-labels': {
                Hb: 'png',
                opaque: !1
            },
            'terrain-lines': {
                Hb: 'png',
                opaque: !1
            },
            'toner-background': {
                Hb: 'png',
                opaque: !0
            },
            toner: {
                Hb: 'png',
                opaque: !0
            },
            'toner-hybrid': {
                Hb: 'png',
                opaque: !1
            },
            'toner-labels': {
                Hb: 'png',
                opaque: !1
            },
            'toner-lines': {
                Hb: 'png',
                opaque: !1
            },
            'toner-lite': {
                Hb: 'png',
                opaque: !0
            },
            watercolor: {
                Hb: 'jpg',
                opaque: !0
            }
        }, Fw = {
            terrain: {
                minZoom: 4,
                maxZoom: 18
            },
            toner: {
                minZoom: 0,
                maxZoom: 20
            },
            watercolor: {
                minZoom: 1,
                maxZoom: 16
            }
        };
    function Iw(a) {
        a = a || {};
        W.call(this, {
            attributions: a.attributions,
            cacheSize: a.cacheSize,
            crossOrigin: a.crossOrigin,
            logo: a.logo,
            projection: a.projection,
            reprojectionErrorThreshold: a.reprojectionErrorThreshold,
            tileGrid: a.tileGrid,
            tileLoadFunction: a.tileLoadFunction,
            url: a.url,
            urls: a.urls,
            wrapX: void 0 !== a.wrapX ? a.wrapX : !0
        });
        this.i = a.params || {};
        this.o = Ia();
        Yv(this, Jw(this));
    }
    u(Iw, W);
    function Jw(a) {
        var b = 0, c = [], d;
        for (d in a.i)
            c[b++] = d + '-' + a.i[d];
        return c.join('/');
    }
    Iw.prototype.u = function () {
        return this.i;
    };
    Iw.prototype.pb = function (a) {
        return a;
    };
    Iw.prototype.Fc = function (a, b, c) {
        var d = this.tileGrid;
        d || (d = this.Ib(c));
        if (!(d.b.length <= a[0])) {
            var e = d.Ta(a, this.o), f = Ga(d.fb(a[0]), this.j);
            1 != b && (f = Fa(f, b, this.j));
            d = {
                F: 'image',
                FORMAT: 'PNG32',
                TRANSPARENT: !0
            };
            pb(d, this.i);
            var g = this.urls;
            g ? (c = c.nb.split(':').pop(), d.SIZE = f[0] + ',' + f[1], d.BBOX = e.join(','), d.BBOXSR = c, d.IMAGESR = c, d.DPI = Math.round(d.DPI ? d.DPI * b : 90 * b), a = (1 == g.length ? g[0] : g[Ca((a[1] << a[0]) + a[2], g.length)]).replace(/MapServer\/?$/, 'MapServer/export').replace(/ImageServer\/?$/, 'ImageServer/exportImage'), a = mw(a, d)) : a = void 0;
            return a;
        }
    };
    Iw.prototype.A = function (a) {
        pb(this.i, a);
        Yv(this, Jw(this));
    };
    function Kw(a) {
        Xv.call(this, {
            opaque: !1,
            projection: a.projection,
            tileGrid: a.tileGrid,
            wrapX: void 0 !== a.wrapX ? a.wrapX : !0
        });
    }
    u(Kw, Xv);
    Kw.prototype.Lc = function (a, b, c) {
        var d = this.Sb(a, b, c);
        if (this.a.b.hasOwnProperty(d))
            return this.a.get(d);
        var e = Ga(this.tileGrid.fb(a));
        a = [
            a,
            b,
            c
        ];
        b = (b = Zv(this, a)) ? Zv(this, b).toString() : '';
        e = new Lw(a, e, b);
        this.a.set(d, e);
        return e;
    };
    function Lw(a, b, c) {
        vs.call(this, a, 2);
        this.c = b;
        this.Fa = c;
        this.f = null;
    }
    u(Lw, vs);
    Lw.prototype.Z = function () {
        if (this.f)
            return this.f;
        var a = this.c, b = Xc(a[0], a[1]);
        b.strokeStyle = 'black';
        b.strokeRect(0.5, 0.5, a[0] + 0.5, a[1] + 0.5);
        b.fillStyle = 'black';
        b.textAlign = 'center';
        b.textBaseline = 'middle';
        b.font = '24px sans-serif';
        b.fillText(this.Fa, a[0] / 2, a[1] / 2);
        return this.f = b.canvas;
    };
    Lw.prototype.load = function () {
    };
    function Mw(a) {
        this.i = null;
        W.call(this, {
            attributions: a.attributions,
            cacheSize: a.cacheSize,
            crossOrigin: a.crossOrigin,
            projection: Gb('EPSG:3857'),
            reprojectionErrorThreshold: a.reprojectionErrorThreshold,
            state: 'loading',
            tileLoadFunction: a.tileLoadFunction,
            wrapX: void 0 !== a.wrapX ? a.wrapX : !0
        });
        if (a.jsonp)
            Ov(a.url, this.di.bind(this), this.Le.bind(this));
        else {
            var b = new XMLHttpRequest();
            b.addEventListener('load', this.On.bind(this));
            b.addEventListener('error', this.Nn.bind(this));
            b.open('GET', a.url);
            b.send();
        }
    }
    u(Mw, W);
    k = Mw.prototype;
    k.On = function (a) {
        a = a.target;
        if (!a.status || 200 <= a.status && 300 > a.status) {
            var b;
            try {
                b = JSON.parse(a.responseText);
            } catch (c) {
                this.Le();
                return;
            }
            this.di(b);
        } else
            this.Le();
    };
    k.Nn = function () {
        this.Le();
    };
    k.Vk = function () {
        return this.i;
    };
    k.di = function (a) {
        var b = Gb('EPSG:4326'), c = this.c, d;
        if (a.bounds) {
            var e = Fb(b, c);
            d = ob(a.bounds, e);
        }
        var f = a.minzoom || 0, e = a.maxzoom || 22;
        this.tileGrid = c = mc({
            extent: kc(c),
            maxZoom: e,
            minZoom: f
        });
        this.tileUrlFunction = Rv(a.tiles, c);
        if (void 0 !== a.attribution && !this.l) {
            b = void 0 !== d ? d : b.D();
            d = {};
            for (var g; f <= e; ++f)
                g = f.toString(), d[g] = [cc(c, b, f)];
            this.ua([new nc({
                    html: a.attribution,
                    tileRanges: d
                })]);
        }
        this.i = a;
        It(this, 'ready');
    };
    k.Le = function () {
        It(this, 'error');
    };
    function Nw(a) {
        Xv.call(this, {
            projection: Gb('EPSG:3857'),
            state: 'loading'
        });
        this.v = void 0 !== a.preemptive ? a.preemptive : !0;
        this.o = Tv;
        this.g = void 0;
        this.i = a.jsonp || !1;
        if (a.url)
            if (this.i)
                Ov(a.url, this.bg.bind(this), this.Me.bind(this));
            else {
                var b = new XMLHttpRequest();
                b.addEventListener('load', this.Sn.bind(this));
                b.addEventListener('error', this.Rn.bind(this));
                b.open('GET', a.url);
                b.send();
            }
        else
            a.tileJSON ? this.bg(a.tileJSON) : qa(!1, 51);
    }
    u(Nw, Xv);
    k = Nw.prototype;
    k.Sn = function (a) {
        a = a.target;
        if (!a.status || 200 <= a.status && 300 > a.status) {
            var b;
            try {
                b = JSON.parse(a.responseText);
            } catch (c) {
                this.Me();
                return;
            }
            this.bg(b);
        } else
            this.Me();
    };
    k.Rn = function () {
        this.Me();
    };
    k.Sk = function () {
        return this.g;
    };
    k.dk = function (a, b, c, d, e) {
        this.tileGrid ? (b = this.tileGrid.we(a, b), Ow(this.Lc(b[0], b[1], b[2], 1, this.c), a, c, d, e)) : !0 === e ? setTimeout(function () {
            c.call(d, null);
        }, 0) : c.call(d, null);
    };
    k.Me = function () {
        It(this, 'error');
    };
    k.bg = function (a) {
        var b = Gb('EPSG:4326'), c = this.c, d;
        if (a.bounds) {
            var e = Fb(b, c);
            d = ob(a.bounds, e);
        }
        var f = a.minzoom || 0, e = a.maxzoom || 22;
        this.tileGrid = c = mc({
            extent: kc(c),
            maxZoom: e,
            minZoom: f
        });
        this.g = a.template;
        var g = a.grids;
        if (g) {
            this.o = Rv(g, c);
            if (void 0 !== a.attribution) {
                b = void 0 !== d ? d : b.D();
                for (d = {}; f <= e; ++f)
                    g = f.toString(), d[g] = [cc(c, b, f)];
                this.ua([new nc({
                        html: a.attribution,
                        tileRanges: d
                    })]);
            }
            It(this, 'ready');
        } else
            It(this, 'error');
    };
    k.Lc = function (a, b, c, d, e) {
        var f = this.Sb(a, b, c);
        if (this.a.b.hasOwnProperty(f))
            return this.a.get(f);
        a = [
            a,
            b,
            c
        ];
        b = Zv(this, a, e);
        d = this.o(b, d, e);
        d = new Pw(a, void 0 !== d ? 0 : 4, void 0 !== d ? d : '', this.tileGrid.Ta(a), this.v, this.i);
        this.a.set(f, d);
        return d;
    };
    k.Eg = function (a, b, c) {
        a = this.Sb(a, b, c);
        this.a.b.hasOwnProperty(a) && this.a.get(a);
    };
    function Pw(a, b, c, d, e, f) {
        vs.call(this, a, b);
        this.o = c;
        this.f = d;
        this.I = e;
        this.c = this.j = this.g = null;
        this.v = f;
    }
    u(Pw, vs);
    k = Pw.prototype;
    k.Z = function () {
        return null;
    };
    k.getData = function (a) {
        if (!this.g || !this.j)
            return null;
        var b = this.g[Math.floor((1 - (a[1] - this.f[1]) / (this.f[3] - this.f[1])) * this.g.length)];
        if ('string' !== typeof b)
            return null;
        b = b.charCodeAt(Math.floor((a[0] - this.f[0]) / (this.f[2] - this.f[0]) * b.length));
        93 <= b && b--;
        35 <= b && b--;
        b -= 32;
        a = null;
        b in this.j && (b = this.j[b], this.c && b in this.c ? a = this.c[b] : a = b);
        return a;
    };
    function Ow(a, b, c, d, e) {
        0 == a.state && !0 === e ? (wc(a, 'change', function () {
            c.call(d, this.getData(b));
        }, a), Qw(a)) : !0 === e ? setTimeout(function () {
            c.call(d, this.getData(b));
        }.bind(a), 0) : c.call(d, a.getData(b));
    }
    k.ib = function () {
        return this.o;
    };
    k.xe = function () {
        this.state = 3;
        this.s();
    };
    k.ei = function (a) {
        this.g = a.grid;
        this.j = a.keys;
        this.c = a.data;
        this.state = 4;
        this.s();
    };
    function Qw(a) {
        if (0 == a.state)
            if (a.state = 1, a.v)
                Ov(a.o, a.ei.bind(a), a.xe.bind(a));
            else {
                var b = new XMLHttpRequest();
                b.addEventListener('load', a.Qn.bind(a));
                b.addEventListener('error', a.Pn.bind(a));
                b.open('GET', a.o);
                b.send();
            }
    }
    k.Qn = function (a) {
        a = a.target;
        if (!a.status || 200 <= a.status && 300 > a.status) {
            var b;
            try {
                b = JSON.parse(a.responseText);
            } catch (c) {
                this.xe();
                return;
            }
            this.ei(b);
        } else
            this.xe();
    };
    k.Pn = function () {
        this.xe();
    };
    k.load = function () {
        this.I && Qw(this);
    };
    function Rw(a) {
        a = a || {};
        var b = a.params || {};
        W.call(this, {
            attributions: a.attributions,
            cacheSize: a.cacheSize,
            crossOrigin: a.crossOrigin,
            logo: a.logo,
            opaque: !('TRANSPARENT' in b ? b.TRANSPARENT : 1),
            projection: a.projection,
            reprojectionErrorThreshold: a.reprojectionErrorThreshold,
            tileGrid: a.tileGrid,
            tileLoadFunction: a.tileLoadFunction,
            url: a.url,
            urls: a.urls,
            wrapX: void 0 !== a.wrapX ? a.wrapX : !0
        });
        this.u = void 0 !== a.gutter ? a.gutter : 0;
        this.i = b;
        this.o = !0;
        this.A = a.serverType;
        this.Y = void 0 !== a.hidpi ? a.hidpi : !0;
        this.S = '';
        Sw(this);
        this.ea = Ia();
        Tw(this);
        Yv(this, Uw(this));
    }
    u(Rw, W);
    k = Rw.prototype;
    k.Tn = function (a, b, c, d) {
        c = Gb(c);
        var e = this.tileGrid;
        e || (e = this.Ib(c));
        b = e.we(a, b);
        if (!(e.b.length <= b[0])) {
            var f = e.La(b[0]), g = e.Ta(b, this.ea), e = Ga(e.fb(b[0]), this.j), h = this.u;
            h && (e = Ea(e, h, this.j), g = Ka(g, f * h, g));
            h = {
                SERVICE: 'WMS',
                VERSION: '1.3.0',
                REQUEST: 'GetFeatureInfo',
                FORMAT: 'image/png',
                TRANSPARENT: !0,
                QUERY_LAYERS: this.i.LAYERS
            };
            pb(h, this.i, d);
            d = Math.floor((g[3] - a[1]) / f);
            h[this.o ? 'I' : 'X'] = Math.floor((a[0] - g[0]) / f);
            h[this.o ? 'J' : 'Y'] = d;
            return Vw(this, b, e, g, 1, c, h);
        }
    };
    k.Kf = function () {
        return this.u;
    };
    k.Sb = function (a, b, c) {
        return this.S + W.prototype.Sb.call(this, a, b, c);
    };
    k.Un = function () {
        return this.i;
    };
    function Vw(a, b, c, d, e, f, g) {
        var h = a.urls;
        if (h) {
            g.WIDTH = c[0];
            g.HEIGHT = c[1];
            g[a.o ? 'CRS' : 'SRS'] = f.nb;
            'STYLES' in a.i || (g.STYLES = '');
            if (1 != e)
                switch (a.A) {
                case 'geoserver':
                    c = 90 * e + 0.5 | 0;
                    g.FORMAT_OPTIONS = 'FORMAT_OPTIONS' in g ? g.FORMAT_OPTIONS + (';dpi:' + c) : 'dpi:' + c;
                    break;
                case 'mapserver':
                    g.MAP_RESOLUTION = 90 * e;
                    break;
                case 'carmentaserver':
                case 'qgis':
                    g.DPI = 90 * e;
                    break;
                default:
                    qa(!1, 52);
                }
            f = f.b;
            a.o && 'ne' == f.substr(0, 2) && (a = d[0], d[0] = d[1], d[1] = a, a = d[2], d[2] = d[3], d[3] = a);
            g.BBOX = d.join(',');
            return mw(1 == h.length ? h[0] : h[Ca((b[1] << b[0]) + b[2], h.length)], g);
        }
    }
    k.pb = function (a) {
        return this.Y && void 0 !== this.A ? a : 1;
    };
    function Sw(a) {
        var b = 0, c = [];
        if (a.urls) {
            var d, e;
            d = 0;
            for (e = a.urls.length; d < e; ++d)
                c[b++] = a.urls[d];
        }
        a.S = c.join('#');
    }
    function Uw(a) {
        var b = 0, c = [], d;
        for (d in a.i)
            c[b++] = d + '-' + a.i[d];
        return c.join('/');
    }
    k.Fc = function (a, b, c) {
        var d = this.tileGrid;
        d || (d = this.Ib(c));
        if (!(d.b.length <= a[0])) {
            1 == b || this.Y && void 0 !== this.A || (b = 1);
            var e = d.La(a[0]), f = d.Ta(a, this.ea), d = Ga(d.fb(a[0]), this.j), g = this.u;
            g && (d = Ea(d, g, this.j), f = Ka(f, e * g, f));
            1 != b && (d = Fa(d, b, this.j));
            e = {
                SERVICE: 'WMS',
                VERSION: '1.3.0',
                REQUEST: 'GetMap',
                FORMAT: 'image/png',
                TRANSPARENT: !0
            };
            pb(e, this.i);
            return Vw(this, a, d, f, b, c, e);
        }
    };
    k.cb = function (a) {
        W.prototype.cb.call(this, a);
        Sw(this);
    };
    k.Vn = function (a) {
        pb(this.i, a);
        Sw(this);
        Tw(this);
        Yv(this, Uw(this));
    };
    function Tw(a) {
        a.o = 0 <= Pe(a.i.VERSION || '1.3.0');
    }
    function Ww(a, b, c, d, e) {
        vs.call(this, a, b);
        this.c = Xc();
        this.j = d;
        this.g = null;
        this.f = {
            Ld: !1,
            wg: null,
            af: -1,
            xg: -1,
            vd: null
        };
        this.I = e;
        this.o = c;
    }
    u(Ww, vs);
    k = Ww.prototype;
    k.Z = function () {
        return -1 == this.f.xg ? null : this.c.canvas;
    };
    k.rm = function () {
        return this.j;
    };
    k.ib = function () {
        return this.o;
    };
    k.load = function () {
        0 == this.state && (this.state = 1, this.s(), this.I(this, this.o), this.v(null, NaN, null));
    };
    k.po = function (a, b) {
        this.Xf(b);
        this.Hi(a);
    };
    k.oo = function () {
        this.state = 3;
        this.s();
    };
    k.Hi = function (a) {
        this.g = a;
        this.state = 2;
        this.s();
    };
    k.Xf = function (a) {
        this.l = a;
    };
    k.Mi = function (a) {
        this.v = a;
    };
    function Xw(a, b) {
        a.Mi(Al(b, a.j, a.po.bind(a), a.oo.bind(a)));
    }
    function Yw(a) {
        aw.call(this, {
            attributions: a.attributions,
            cacheSize: void 0 !== a.cacheSize ? a.cacheSize : 128,
            extent: a.extent,
            logo: a.logo,
            opaque: !1,
            projection: a.projection,
            state: a.state,
            tileGrid: a.tileGrid,
            tileLoadFunction: a.tileLoadFunction ? a.tileLoadFunction : Xw,
            tileUrlFunction: a.tileUrlFunction,
            tilePixelRatio: a.tilePixelRatio,
            url: a.url,
            urls: a.urls,
            wrapX: void 0 === a.wrapX ? !0 : a.wrapX
        });
        this.i = a.format ? a.format : null;
        this.g = void 0 == a.overlaps ? !0 : a.overlaps;
        this.tileClass = a.tileClass ? a.tileClass : Ww;
    }
    u(Yw, aw);
    Yw.prototype.Lc = function (a, b, c, d, e) {
        var f = this.Sb(a, b, c);
        if (this.a.b.hasOwnProperty(f))
            return this.a.get(f);
        a = [
            a,
            b,
            c
        ];
        d = (b = Zv(this, a, e)) ? this.tileUrlFunction(b, d, e) : void 0;
        d = new this.tileClass(a, void 0 !== d ? 0 : 4, void 0 !== d ? d : '', this.i, this.tileLoadFunction);
        B(d, 'change', this.gi, this);
        this.a.set(f, d);
        return d;
    };
    Yw.prototype.pb = function (a) {
        return void 0 == a ? aw.prototype.pb.call(this, a) : a;
    };
    Yw.prototype.Sd = function (a, b) {
        var c = Ga(this.tileGrid.fb(a));
        return [
            Math.round(c[0] * b),
            Math.round(c[1] * b)
        ];
    };
    function Zw(a) {
        this.j = a.matrixIds;
        $b.call(this, {
            extent: a.extent,
            origin: a.origin,
            origins: a.origins,
            resolutions: a.resolutions,
            tileSize: a.tileSize,
            tileSizes: a.tileSizes,
            sizes: a.sizes
        });
    }
    u(Zw, $b);
    Zw.prototype.o = function () {
        return this.j;
    };
    function $w(a, b, c) {
        var d = [], e = [], f = [], g = [], h = [], l = void 0 !== c ? c : [];
        c = Gb(a.SupportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/, '$1:$3'));
        var m = c.sc(), p = 'ne' == c.b.substr(0, 2);
        a.TileMatrix.sort(function (a, b) {
            return b.ScaleDenominator - a.ScaleDenominator;
        });
        a.TileMatrix.forEach(function (a) {
            var b;
            0 < l.length ? b = ha(l, function (b) {
                return a.Identifier == b.TileMatrix;
            }) : b = !0;
            if (b) {
                e.push(a.Identifier);
                b = 0.00028 * a.ScaleDenominator / m;
                var c = a.TileWidth, n = a.TileHeight;
                p ? f.push([
                    a.TopLeftCorner[1],
                    a.TopLeftCorner[0]
                ]) : f.push(a.TopLeftCorner);
                d.push(b);
                g.push(c == n ? c : [
                    c,
                    n
                ]);
                h.push([
                    a.MatrixWidth,
                    -a.MatrixHeight
                ]);
            }
        });
        return new Zw({
            extent: b,
            origins: f,
            resolutions: d,
            matrixIds: e,
            tileSizes: g,
            sizes: h
        });
    }
    function Y(a) {
        function b(a) {
            a = 'KVP' == d ? mw(a, f) : a.replace(/\{(\w+?)\}/g, function (a, b) {
                return b.toLowerCase() in f ? f[b.toLowerCase()] : a;
            });
            return function (b) {
                if (b) {
                    var c = {
                        TileMatrix: e.j[b[0]],
                        TileCol: b[1],
                        TileRow: -b[2] - 1
                    };
                    pb(c, g);
                    b = a;
                    return b = 'KVP' == d ? mw(b, c) : b.replace(/\{(\w+?)\}/g, function (a, b) {
                        return c[b];
                    });
                }
            };
        }
        this.ea = void 0 !== a.version ? a.version : '1.0.0';
        this.u = void 0 !== a.format ? a.format : 'image/jpeg';
        this.i = a.dimensions ? a.dimensions : {};
        this.A = a.layer;
        this.o = a.matrixSet;
        this.S = a.style;
        var c = a.urls;
        void 0 === c && void 0 !== a.url && (c = Uv(a.url));
        var d = this.Y = void 0 !== a.requestEncoding ? a.requestEncoding : 'KVP', e = a.tileGrid, f = {
                layer: this.A,
                style: this.S,
                tilematrixset: this.o
            };
        'KVP' == d && pb(f, {
            Service: 'WMTS',
            Request: 'GetTile',
            Version: this.ea,
            Format: this.u
        });
        var g = this.i, h = c && 0 < c.length ? Sv(c.map(b)) : Tv;
        W.call(this, {
            attributions: a.attributions,
            cacheSize: a.cacheSize,
            crossOrigin: a.crossOrigin,
            logo: a.logo,
            projection: a.projection,
            reprojectionErrorThreshold: a.reprojectionErrorThreshold,
            tileClass: a.tileClass,
            tileGrid: e,
            tileLoadFunction: a.tileLoadFunction,
            tilePixelRatio: a.tilePixelRatio,
            tileUrlFunction: h,
            urls: c,
            wrapX: void 0 !== a.wrapX ? a.wrapX : !1
        });
        Yv(this, ax(this));
    }
    u(Y, W);
    k = Y.prototype;
    k.rk = function () {
        return this.i;
    };
    k.Wn = function () {
        return this.u;
    };
    k.Xn = function () {
        return this.A;
    };
    k.Fk = function () {
        return this.o;
    };
    k.Qk = function () {
        return this.Y;
    };
    k.Yn = function () {
        return this.S;
    };
    k.Xk = function () {
        return this.ea;
    };
    function ax(a) {
        var b = 0, c = [], d;
        for (d in a.i)
            c[b++] = d + '-' + a.i[d];
        return c.join('/');
    }
    k.Gp = function (a) {
        pb(this.i, a);
        Yv(this, ax(this));
    };
    function bx(a) {
        a = a || {};
        var b = a.size, c = b[0], d = b[1], e = [], f = 256;
        switch (void 0 !== a.tierSizeCalculation ? a.tierSizeCalculation : cx) {
        case cx:
            for (; c > f || d > f;)
                e.push([
                    Math.ceil(c / f),
                    Math.ceil(d / f)
                ]), f += f;
            break;
        case dx:
            for (; c > f || d > f;)
                e.push([
                    Math.ceil(c / f),
                    Math.ceil(d / f)
                ]), c >>= 1, d >>= 1;
            break;
        default:
            qa(!1, 53);
        }
        e.push([
            1,
            1
        ]);
        e.reverse();
        for (var f = [1], g = [0], d = 1, c = e.length; d < c; d++)
            f.push(1 << d), g.push(e[d - 1][0] * e[d - 1][1] + g[d - 1]);
        f.reverse();
        b = [
            0,
            -b[1],
            b[0],
            0
        ];
        b = new $b({
            extent: b,
            origin: eb(b),
            resolutions: f
        });
        (f = a.url) && -1 == f.indexOf('{TileGroup}') && (f += '{TileGroup}/{z}-{x}-{y}.jpg');
        f = Uv(f);
        f = Sv(f.map(function (a) {
            return function (b) {
                if (b) {
                    var c = b[0], d = b[1];
                    b = -b[2] - 1;
                    var f = {
                        z: c,
                        x: d,
                        y: b,
                        TileGroup: 'TileGroup' + ((d + b * e[c][0] + g[c]) / 256 | 0)
                    };
                    return a.replace(/\{(\w+?)\}/g, function (a, b) {
                        return f[b];
                    });
                }
            };
        }));
        W.call(this, {
            attributions: a.attributions,
            cacheSize: a.cacheSize,
            crossOrigin: a.crossOrigin,
            logo: a.logo,
            projection: a.projection,
            reprojectionErrorThreshold: a.reprojectionErrorThreshold,
            tileClass: ex,
            tileGrid: b,
            tileUrlFunction: f
        });
    }
    u(bx, W);
    function ex(a, b, c, d, e) {
        xs.call(this, a, b, c, d, e);
        this.f = null;
    }
    u(ex, xs);
    ex.prototype.Z = function () {
        if (this.f)
            return this.f;
        var a = xs.prototype.Z.call(this);
        if (2 == this.state) {
            if (256 == a.width && 256 == a.height)
                return this.f = a;
            var b = Xc(256, 256);
            b.drawImage(a, 0, 0);
            return this.f = b.canvas;
        }
        return a;
    };
    var cx = 'default', dx = 'truncated';
    function fx(a, b) {
        this.b = b;
        this.a = [{
                x: 0,
                y: 0,
                width: a,
                height: a
            }];
        this.c = {};
        this.f = Xc(a, a);
        this.i = this.f.canvas;
    }
    fx.prototype.get = function (a) {
        return this.c[a] || null;
    };
    fx.prototype.add = function (a, b, c, d, e) {
        var f, g, h;
        g = 0;
        for (h = this.a.length; g < h; ++g)
            if (f = this.a[g], f.width >= b + this.b && f.height >= c + this.b)
                return h = {
                    offsetX: f.x + this.b,
                    offsetY: f.y + this.b,
                    image: this.i
                }, this.c[a] = h, d.call(e, this.f, f.x + this.b, f.y + this.b), a = g, b += this.b, d = c + this.b, f.width - b > f.height - d ? (c = {
                    x: f.x + b,
                    y: f.y,
                    width: f.width - b,
                    height: f.height
                }, b = {
                    x: f.x,
                    y: f.y + d,
                    width: b,
                    height: f.height - d
                }, gx(this, a, c, b)) : (c = {
                    x: f.x + b,
                    y: f.y,
                    width: f.width - b,
                    height: d
                }, b = {
                    x: f.x,
                    y: f.y + d,
                    width: f.width,
                    height: f.height - d
                }, gx(this, a, c, b)), h;
        return null;
    };
    function gx(a, b, c, d) {
        b = [
            b,
            1
        ];
        0 < c.width && 0 < c.height && b.push(c);
        0 < d.width && 0 < d.height && b.push(d);
        a.a.splice.apply(a.a, b);
    }
    function hx(a) {
        a = a || {};
        this.a = void 0 !== a.initialSize ? a.initialSize : 256;
        this.f = void 0 !== a.maxSize ? a.maxSize : void 0 !== ba ? ba : 2048;
        this.b = void 0 !== a.space ? a.space : 1;
        this.i = [new fx(this.a, this.b)];
        this.c = this.a;
        this.g = [new fx(this.c, this.b)];
    }
    hx.prototype.add = function (a, b, c, d, e, f) {
        if (b + this.b > this.f || c + this.b > this.f)
            return null;
        d = ix(this, !1, a, b, c, d, f);
        if (!d)
            return null;
        a = ix(this, !0, a, b, c, e ? e : na, f);
        return {
            offsetX: d.offsetX,
            offsetY: d.offsetY,
            image: d.image,
            Fl: a.image
        };
    };
    function ix(a, b, c, d, e, f, g) {
        var h = b ? a.g : a.i, l, m, p;
        m = 0;
        for (p = h.length; m < p; ++m) {
            l = h[m];
            if (l = l.add(c, d, e, f, g))
                return l;
            l || m !== p - 1 || (b ? (l = Math.min(2 * a.c, a.f), a.c = l) : (l = Math.min(2 * a.a, a.f), a.a = l), l = new fx(l, a.b), h.push(l), ++p);
        }
        return null;
    }
    pa.prototype.code = pa.prototype.code;
    t('ol.Attribution', nc);
    nc.prototype.getHTML = nc.prototype.f;
    t('ol.Collection', D);
    D.prototype.clear = D.prototype.clear;
    D.prototype.extend = D.prototype.Tf;
    D.prototype.forEach = D.prototype.forEach;
    D.prototype.getArray = D.prototype.am;
    D.prototype.item = D.prototype.item;
    D.prototype.getLength = D.prototype.ec;
    D.prototype.insertAt = D.prototype.Be;
    D.prototype.pop = D.prototype.pop;
    D.prototype.push = D.prototype.push;
    D.prototype.remove = D.prototype.remove;
    D.prototype.removeAt = D.prototype.tg;
    D.prototype.setAt = D.prototype.mp;
    Nc.prototype.element = Nc.prototype.element;
    t('ol.color.asArray', Qc);
    t('ol.color.asString', Sc);
    t('ol.colorlike.asColorLike', Vc);
    t('ol.control.defaults', nd);
    t('ol.coordinate.add', Qe);
    t('ol.coordinate.createStringXY', function (a) {
        return function (b) {
            return $e(b, a);
        };
    });
    t('ol.coordinate.format', Te);
    t('ol.coordinate.rotate', Ve);
    t('ol.coordinate.toStringHDMS', function (a, b) {
        return a ? Se(a[1], 'NS', b) + ' ' + Se(a[0], 'EW', b) : '';
    });
    t('ol.coordinate.toStringXY', $e);
    t('ol.DeviceOrientation', Pk);
    Pk.prototype.getAlpha = Pk.prototype.jk;
    Pk.prototype.getBeta = Pk.prototype.mk;
    Pk.prototype.getGamma = Pk.prototype.uk;
    Pk.prototype.getHeading = Pk.prototype.bm;
    Pk.prototype.getTracking = Pk.prototype.Fh;
    Pk.prototype.setTracking = Pk.prototype.Uf;
    t('ol.easing.easeIn', ed);
    t('ol.easing.easeOut', fd);
    t('ol.easing.inAndOut', gd);
    t('ol.easing.linear', hd);
    t('ol.easing.upAndDown', function (a) {
        return 0.5 > a ? gd(2 * a) : 1 - gd(2 * (a - 0.5));
    });
    t('ol.extent.boundingExtent', Ha);
    t('ol.extent.buffer', Ka);
    t('ol.extent.containsCoordinate', Qa);
    t('ol.extent.containsExtent', Ta);
    t('ol.extent.containsXY', Sa);
    t('ol.extent.createEmpty', Ia);
    t('ol.extent.equals', Za);
    t('ol.extent.extend', $a);
    t('ol.extent.getBottomLeft', bb);
    t('ol.extent.getBottomRight', cb);
    t('ol.extent.getCenter', jb);
    t('ol.extent.getHeight', ib);
    t('ol.extent.getIntersection', lb);
    t('ol.extent.getSize', function (a) {
        return [
            a[2] - a[0],
            a[3] - a[1]
        ];
    });
    t('ol.extent.getTopLeft', eb);
    t('ol.extent.getTopRight', db);
    t('ol.extent.getWidth', hb);
    t('ol.extent.intersects', mb);
    t('ol.extent.isEmpty', gb);
    t('ol.extent.applyTransform', ob);
    t('ol.Feature', H);
    H.prototype.clone = H.prototype.clone;
    H.prototype.getGeometry = H.prototype.U;
    H.prototype.getId = H.prototype.dm;
    H.prototype.getGeometryName = H.prototype.wk;
    H.prototype.getStyle = H.prototype.em;
    H.prototype.getStyleFunction = H.prototype.Nc;
    H.prototype.setGeometry = H.prototype.Sa;
    H.prototype.setStyle = H.prototype.Vf;
    H.prototype.setId = H.prototype.kc;
    H.prototype.setGeometryName = H.prototype.Vc;
    t('ol.featureloader.xhr', Bl);
    t('ol.Geolocation', hs);
    hs.prototype.getAccuracy = hs.prototype.hk;
    hs.prototype.getAccuracyGeometry = hs.prototype.ik;
    hs.prototype.getAltitude = hs.prototype.kk;
    hs.prototype.getAltitudeAccuracy = hs.prototype.lk;
    hs.prototype.getHeading = hs.prototype.fm;
    hs.prototype.getPosition = hs.prototype.gm;
    hs.prototype.getProjection = hs.prototype.Gh;
    hs.prototype.getSpeed = hs.prototype.Rk;
    hs.prototype.getTracking = hs.prototype.Hh;
    hs.prototype.getTrackingOptions = hs.prototype.th;
    hs.prototype.setProjection = hs.prototype.Ih;
    hs.prototype.setTracking = hs.prototype.Ee;
    hs.prototype.setTrackingOptions = hs.prototype.Si;
    t('ol.Graticule', ns);
    ns.prototype.getMap = ns.prototype.jm;
    ns.prototype.getMeridians = ns.prototype.Gk;
    ns.prototype.getParallels = ns.prototype.Nk;
    ns.prototype.setMap = ns.prototype.setMap;
    t('ol.has.DEVICE_PIXEL_RATIO', Kd);
    t('ol.has.CANVAS', Md);
    t('ol.has.DEVICE_ORIENTATION', Nd);
    t('ol.has.GEOLOCATION', Od);
    t('ol.has.TOUCH', Pd);
    t('ol.has.WEBGL', Ed);
    ts.prototype.getImage = ts.prototype.Z;
    ts.prototype.load = ts.prototype.load;
    xs.prototype.getImage = xs.prototype.Z;
    t('ol.inherits', u);
    t('ol.interaction.defaults', ch);
    t('ol.Kinetic', Zf);
    t('ol.loadingstrategy.all', Ft);
    t('ol.loadingstrategy.bbox', function (a) {
        return [a];
    });
    t('ol.loadingstrategy.tile', function (a) {
        return function (b, c) {
            var d = a.Mc(c), e = cc(a, b, d), f = [], d = [
                    d,
                    0,
                    0
                ];
            for (d[1] = e.da; d[1] <= e.ba; ++d[1])
                for (d[2] = e.fa; d[2] <= e.ja; ++d[2])
                    f.push(a.Ta(d));
            return f;
        };
    });
    t('ol.Map', G);
    G.prototype.addControl = G.prototype.Rj;
    G.prototype.addInteraction = G.prototype.Sj;
    G.prototype.addLayer = G.prototype.Sg;
    G.prototype.addOverlay = G.prototype.Tg;
    G.prototype.forEachFeatureAtPixel = G.prototype.re;
    G.prototype.forEachLayerAtPixel = G.prototype.pm;
    G.prototype.hasFeatureAtPixel = G.prototype.El;
    G.prototype.getEventCoordinate = G.prototype.sk;
    G.prototype.getEventPixel = G.prototype.te;
    G.prototype.getTarget = G.prototype.Of;
    G.prototype.getTargetElement = G.prototype.Kc;
    G.prototype.getCoordinateFromPixel = G.prototype.Za;
    G.prototype.getControls = G.prototype.qk;
    G.prototype.getOverlays = G.prototype.Lk;
    G.prototype.getOverlayById = G.prototype.Kk;
    G.prototype.getInteractions = G.prototype.xk;
    G.prototype.getLayerGroup = G.prototype.Jc;
    G.prototype.getLayers = G.prototype.Jh;
    G.prototype.getPixelFromCoordinate = G.prototype.Ka;
    G.prototype.getSize = G.prototype.Mb;
    G.prototype.getView = G.prototype.$;
    G.prototype.getViewport = G.prototype.Yk;
    G.prototype.renderSync = G.prototype.ip;
    G.prototype.render = G.prototype.render;
    G.prototype.removeControl = G.prototype.ap;
    G.prototype.removeInteraction = G.prototype.bp;
    G.prototype.removeLayer = G.prototype.ep;
    G.prototype.removeOverlay = G.prototype.fp;
    G.prototype.setLayerGroup = G.prototype.Li;
    G.prototype.setSize = G.prototype.Ag;
    G.prototype.setTarget = G.prototype.Fe;
    G.prototype.setView = G.prototype.vp;
    G.prototype.updateSize = G.prototype.xd;
    zd.prototype.originalEvent = zd.prototype.originalEvent;
    zd.prototype.pixel = zd.prototype.pixel;
    zd.prototype.coordinate = zd.prototype.coordinate;
    zd.prototype.dragging = zd.prototype.dragging;
    yd.prototype.map = yd.prototype.map;
    yd.prototype.frameState = yd.prototype.frameState;
    t('ol.Object', Gc);
    Gc.prototype.get = Gc.prototype.get;
    Gc.prototype.getKeys = Gc.prototype.O;
    Gc.prototype.getProperties = Gc.prototype.N;
    Gc.prototype.set = Gc.prototype.set;
    Gc.prototype.setProperties = Gc.prototype.H;
    Gc.prototype.unset = Gc.prototype.P;
    Kc.prototype.key = Kc.prototype.key;
    Kc.prototype.oldValue = Kc.prototype.oldValue;
    t('ol.Observable', Fc);
    t('ol.Observable.unByKey', function (a) {
        if (Array.isArray(a))
            for (var b = 0, c = a.length; b < c; ++b)
                rc(a[b]);
        else
            rc(a);
    });
    Fc.prototype.changed = Fc.prototype.s;
    Fc.prototype.dispatchEvent = Fc.prototype.b;
    Fc.prototype.getRevision = Fc.prototype.L;
    Fc.prototype.on = Fc.prototype.J;
    Fc.prototype.once = Fc.prototype.once;
    Fc.prototype.un = Fc.prototype.K;
    t('ol.Overlay', qk);
    qk.prototype.getElement = qk.prototype.se;
    qk.prototype.getId = qk.prototype.qm;
    qk.prototype.getMap = qk.prototype.Ge;
    qk.prototype.getOffset = qk.prototype.qh;
    qk.prototype.getPosition = qk.prototype.Kh;
    qk.prototype.getPositioning = qk.prototype.rh;
    qk.prototype.setElement = qk.prototype.Gi;
    qk.prototype.setMap = qk.prototype.setMap;
    qk.prototype.setOffset = qk.prototype.Ni;
    qk.prototype.setPosition = qk.prototype.Wf;
    qk.prototype.setPositioning = qk.prototype.Qi;
    t('ol.proj.METERS_PER_UNIT', vb);
    t('ol.proj.setProj4', function (a) {
        wb = a;
    });
    t('ol.proj.getPointResolution', Eb);
    t('ol.proj.addEquivalentProjections', Hb);
    t('ol.proj.addProjection', Pb);
    t('ol.proj.addCoordinateTransforms', Rb);
    t('ol.proj.fromLonLat', function (a, b) {
        return Wb(a, 'EPSG:4326', void 0 !== b ? b : 'EPSG:3857');
    });
    t('ol.proj.toLonLat', function (a, b) {
        return Wb(a, void 0 !== b ? b : 'EPSG:3857', 'EPSG:4326');
    });
    t('ol.proj.get', Gb);
    t('ol.proj.equivalent', Tb);
    t('ol.proj.getTransform', Ub);
    t('ol.proj.transform', Wb);
    t('ol.proj.transformExtent', Xb);
    t('ol.render.toContext', function (a, b) {
        var c = a.canvas, d = b ? b : {}, e = d.pixelRatio || Kd;
        if (d = d.size)
            c.width = d[0] * e, c.height = d[1] * e, c.style.width = d[0] + 'px', c.style.height = d[1] + 'px';
        c = [
            0,
            0,
            c.width,
            c.height
        ];
        d = Dh(wh(), e, e);
        return new Sh(a, e, c, d, 0);
    });
    t('ol.size.toSize', Ga);
    t('ol.Sphere', tb);
    tb.prototype.geodesicArea = tb.prototype.a;
    tb.prototype.haversineDistance = tb.prototype.b;
    vs.prototype.getTileCoord = vs.prototype.i;
    vs.prototype.load = vs.prototype.load;
    t('ol.tilegrid.createXYZ', mc);
    Ww.prototype.getFormat = Ww.prototype.rm;
    Ww.prototype.setFeatures = Ww.prototype.Hi;
    Ww.prototype.setProjection = Ww.prototype.Xf;
    Ww.prototype.setLoader = Ww.prototype.Mi;
    t('ol.View', Qf);
    Qf.prototype.animate = Qf.prototype.animate;
    Qf.prototype.constrainCenter = Qf.prototype.Ec;
    Qf.prototype.constrainResolution = Qf.prototype.constrainResolution;
    Qf.prototype.constrainRotation = Qf.prototype.constrainRotation;
    Qf.prototype.getCenter = Qf.prototype.Ba;
    Qf.prototype.calculateExtent = Qf.prototype.ed;
    Qf.prototype.getMaxResolution = Qf.prototype.sm;
    Qf.prototype.getMinResolution = Qf.prototype.tm;
    Qf.prototype.getProjection = Qf.prototype.um;
    Qf.prototype.getResolution = Qf.prototype.Ua;
    Qf.prototype.getResolutions = Qf.prototype.vm;
    Qf.prototype.getRotation = Qf.prototype.Va;
    Qf.prototype.getZoom = Qf.prototype.$k;
    Qf.prototype.fit = Qf.prototype.Ff;
    Qf.prototype.centerOn = Qf.prototype.$j;
    Qf.prototype.rotate = Qf.prototype.rotate;
    Qf.prototype.setCenter = Qf.prototype.wb;
    Qf.prototype.setResolution = Qf.prototype.Xc;
    Qf.prototype.setRotation = Qf.prototype.He;
    Qf.prototype.setZoom = Qf.prototype.yp;
    t('ol.xml.getAllTextContent', jl);
    t('ol.xml.parse', nl);
    Ji.prototype.getGL = Ji.prototype.lo;
    Ji.prototype.useProgram = Ji.prototype.Rc;
    t('ol.tilegrid.TileGrid', $b);
    $b.prototype.forEachTileCoord = $b.prototype.eh;
    $b.prototype.getMaxZoom = $b.prototype.oh;
    $b.prototype.getMinZoom = $b.prototype.ph;
    $b.prototype.getOrigin = $b.prototype.Qc;
    $b.prototype.getResolution = $b.prototype.La;
    $b.prototype.getResolutions = $b.prototype.oi;
    $b.prototype.getTileCoordExtent = $b.prototype.Ta;
    $b.prototype.getTileCoordForCoordAndResolution = $b.prototype.we;
    $b.prototype.getTileCoordForCoordAndZ = $b.prototype.Pf;
    $b.prototype.getTileSize = $b.prototype.fb;
    $b.prototype.getZForResolution = $b.prototype.Mc;
    t('ol.tilegrid.WMTS', Zw);
    Zw.prototype.getMatrixIds = Zw.prototype.o;
    t('ol.tilegrid.WMTS.createFromCapabilitiesMatrixSet', $w);
    t('ol.style.AtlasManager', hx);
    t('ol.style.Circle', Yk);
    Yk.prototype.setRadius = Yk.prototype.Wc;
    t('ol.style.Fill', Zk);
    Zk.prototype.clone = Zk.prototype.clone;
    Zk.prototype.getColor = Zk.prototype.f;
    Zk.prototype.setColor = Zk.prototype.c;
    t('ol.style.Icon', Rn);
    Rn.prototype.clone = Rn.prototype.clone;
    Rn.prototype.getAnchor = Rn.prototype.Hc;
    Rn.prototype.getColor = Rn.prototype.Zn;
    Rn.prototype.getImage = Rn.prototype.Z;
    Rn.prototype.getOrigin = Rn.prototype.Pc;
    Rn.prototype.getSrc = Rn.prototype.$n;
    Rn.prototype.getSize = Rn.prototype.jc;
    Rn.prototype.load = Rn.prototype.load;
    t('ol.style.Image', Vk);
    Vk.prototype.getOpacity = Vk.prototype.Pe;
    Vk.prototype.getRotateWithView = Vk.prototype.Qe;
    Vk.prototype.getRotation = Vk.prototype.Re;
    Vk.prototype.getScale = Vk.prototype.Se;
    Vk.prototype.getSnapToPixel = Vk.prototype.ve;
    Vk.prototype.setOpacity = Vk.prototype.rd;
    Vk.prototype.setRotation = Vk.prototype.Te;
    Vk.prototype.setScale = Vk.prototype.sd;
    t('ol.style.RegularShape', Wk);
    Wk.prototype.clone = Wk.prototype.clone;
    Wk.prototype.getAnchor = Wk.prototype.Hc;
    Wk.prototype.getAngle = Wk.prototype.ki;
    Wk.prototype.getFill = Wk.prototype.Ca;
    Wk.prototype.getImage = Wk.prototype.Z;
    Wk.prototype.getOrigin = Wk.prototype.Pc;
    Wk.prototype.getPoints = Wk.prototype.li;
    Wk.prototype.getRadius = Wk.prototype.mi;
    Wk.prototype.getRadius2 = Wk.prototype.sh;
    Wk.prototype.getSize = Wk.prototype.jc;
    Wk.prototype.getStroke = Wk.prototype.Da;
    t('ol.style.Stroke', rj);
    rj.prototype.clone = rj.prototype.clone;
    rj.prototype.getColor = rj.prototype.ao;
    rj.prototype.getLineCap = rj.prototype.Ak;
    rj.prototype.getLineDash = rj.prototype.bo;
    rj.prototype.getLineDashOffset = rj.prototype.Bk;
    rj.prototype.getLineJoin = rj.prototype.Ck;
    rj.prototype.getMiterLimit = rj.prototype.Hk;
    rj.prototype.getWidth = rj.prototype.co;
    rj.prototype.setColor = rj.prototype.eo;
    rj.prototype.setLineCap = rj.prototype.qp;
    rj.prototype.setLineDash = rj.prototype.setLineDash;
    rj.prototype.setLineDashOffset = rj.prototype.rp;
    rj.prototype.setLineJoin = rj.prototype.sp;
    rj.prototype.setMiterLimit = rj.prototype.tp;
    rj.prototype.setWidth = rj.prototype.wp;
    t('ol.style.Style', $k);
    $k.prototype.clone = $k.prototype.clone;
    $k.prototype.getGeometry = $k.prototype.U;
    $k.prototype.getGeometryFunction = $k.prototype.vk;
    $k.prototype.getFill = $k.prototype.Ca;
    $k.prototype.setFill = $k.prototype.cf;
    $k.prototype.getImage = $k.prototype.Z;
    $k.prototype.setImage = $k.prototype.zg;
    $k.prototype.getStroke = $k.prototype.Da;
    $k.prototype.setStroke = $k.prototype.df;
    $k.prototype.getText = $k.prototype.Pa;
    $k.prototype.setText = $k.prototype.ef;
    $k.prototype.getZIndex = $k.prototype.za;
    $k.prototype.setGeometry = $k.prototype.Sa;
    $k.prototype.setZIndex = $k.prototype.Wb;
    t('ol.style.Text', Sn);
    Sn.prototype.clone = Sn.prototype.clone;
    Sn.prototype.getFont = Sn.prototype.tk;
    Sn.prototype.getOffsetX = Sn.prototype.Ik;
    Sn.prototype.getOffsetY = Sn.prototype.Jk;
    Sn.prototype.getFill = Sn.prototype.Ca;
    Sn.prototype.getRotateWithView = Sn.prototype.fo;
    Sn.prototype.getRotation = Sn.prototype.ho;
    Sn.prototype.getScale = Sn.prototype.io;
    Sn.prototype.getStroke = Sn.prototype.Da;
    Sn.prototype.getText = Sn.prototype.Pa;
    Sn.prototype.getTextAlign = Sn.prototype.Tk;
    Sn.prototype.getTextBaseline = Sn.prototype.Uk;
    Sn.prototype.setFont = Sn.prototype.Ii;
    Sn.prototype.setOffsetX = Sn.prototype.Oi;
    Sn.prototype.setOffsetY = Sn.prototype.Pi;
    Sn.prototype.setFill = Sn.prototype.cf;
    Sn.prototype.setRotation = Sn.prototype.jo;
    Sn.prototype.setScale = Sn.prototype.ni;
    Sn.prototype.setStroke = Sn.prototype.df;
    Sn.prototype.setText = Sn.prototype.ef;
    Sn.prototype.setTextAlign = Sn.prototype.Ri;
    Sn.prototype.setTextBaseline = Sn.prototype.up;
    t('ol.source.BingMaps', ew);
    t('ol.source.BingMaps.TOS_ATTRIBUTION', fw);
    ew.prototype.getApiKey = ew.prototype.Y;
    ew.prototype.getImagerySet = ew.prototype.ea;
    t('ol.source.CartoDB', hw);
    hw.prototype.getConfig = hw.prototype.pk;
    hw.prototype.updateConfig = hw.prototype.Fp;
    hw.prototype.setConfig = hw.prototype.np;
    t('ol.source.Cluster', X);
    X.prototype.getSource = X.prototype.lb;
    X.prototype.setDistance = X.prototype.mb;
    t('ol.source.Image', lv);
    nv.prototype.image = nv.prototype.image;
    t('ol.source.ImageArcGISRest', nw);
    nw.prototype.getParams = nw.prototype.rn;
    nw.prototype.getImageLoadFunction = nw.prototype.qn;
    nw.prototype.getUrl = nw.prototype.sn;
    nw.prototype.setImageLoadFunction = nw.prototype.tn;
    nw.prototype.setUrl = nw.prototype.vn;
    nw.prototype.updateParams = nw.prototype.wn;
    t('ol.source.ImageCanvas', sv);
    t('ol.source.ImageMapGuide', ow);
    ow.prototype.getParams = ow.prototype.yn;
    ow.prototype.getImageLoadFunction = ow.prototype.xn;
    ow.prototype.updateParams = ow.prototype.An;
    ow.prototype.setImageLoadFunction = ow.prototype.zn;
    t('ol.source.ImageStatic', pw);
    t('ol.source.ImageVector', tv);
    tv.prototype.getSource = tv.prototype.Bn;
    tv.prototype.getStyle = tv.prototype.Cn;
    tv.prototype.getStyleFunction = tv.prototype.Dn;
    tv.prototype.setStyle = tv.prototype.ci;
    t('ol.source.ImageWMS', qw);
    qw.prototype.getGetFeatureInfoUrl = qw.prototype.Gn;
    qw.prototype.getParams = qw.prototype.In;
    qw.prototype.getImageLoadFunction = qw.prototype.Hn;
    qw.prototype.getUrl = qw.prototype.Jn;
    qw.prototype.setImageLoadFunction = qw.prototype.Kn;
    qw.prototype.setUrl = qw.prototype.Ln;
    qw.prototype.updateParams = qw.prototype.Mn;
    t('ol.source.OSM', uw);
    t('ol.source.OSM.ATTRIBUTION', vw);
    t('ol.source.Raster', ww);
    ww.prototype.setOperation = ww.prototype.A;
    Bw.prototype.extent = Bw.prototype.extent;
    Bw.prototype.resolution = Bw.prototype.resolution;
    Bw.prototype.data = Bw.prototype.data;
    t('ol.source.Source', Gt);
    Gt.prototype.getAttributions = Gt.prototype.xa;
    Gt.prototype.getLogo = Gt.prototype.wa;
    Gt.prototype.getProjection = Gt.prototype.ya;
    Gt.prototype.getState = Gt.prototype.V;
    Gt.prototype.refresh = Gt.prototype.va;
    Gt.prototype.setAttributions = Gt.prototype.ua;
    t('ol.source.Stamen', Ew);
    t('ol.source.Tile', Xv);
    Xv.prototype.getTileGrid = Xv.prototype.ab;
    $v.prototype.tile = $v.prototype.tile;
    t('ol.source.TileArcGISRest', Iw);
    Iw.prototype.getParams = Iw.prototype.u;
    Iw.prototype.updateParams = Iw.prototype.A;
    t('ol.source.TileDebug', Kw);
    t('ol.source.TileImage', W);
    W.prototype.setRenderReprojectionEdges = W.prototype.Nb;
    W.prototype.setTileGridForProjection = W.prototype.Ob;
    t('ol.source.TileJSON', Mw);
    Mw.prototype.getTileJSON = Mw.prototype.Vk;
    t('ol.source.TileUTFGrid', Nw);
    Nw.prototype.getTemplate = Nw.prototype.Sk;
    Nw.prototype.forDataAtCoordinateAndResolution = Nw.prototype.dk;
    t('ol.source.TileWMS', Rw);
    Rw.prototype.getGetFeatureInfoUrl = Rw.prototype.Tn;
    Rw.prototype.getParams = Rw.prototype.Un;
    Rw.prototype.updateParams = Rw.prototype.Vn;
    aw.prototype.getTileLoadFunction = aw.prototype.ob;
    aw.prototype.getTileUrlFunction = aw.prototype.qb;
    aw.prototype.getUrls = aw.prototype.rb;
    aw.prototype.setTileLoadFunction = aw.prototype.xb;
    aw.prototype.setTileUrlFunction = aw.prototype.bb;
    aw.prototype.setUrl = aw.prototype.jb;
    aw.prototype.setUrls = aw.prototype.cb;
    t('ol.source.Vector', S);
    S.prototype.addFeature = S.prototype.zb;
    S.prototype.addFeatures = S.prototype.dd;
    S.prototype.clear = S.prototype.clear;
    S.prototype.forEachFeature = S.prototype.bh;
    S.prototype.forEachFeatureInExtent = S.prototype.ac;
    S.prototype.forEachFeatureIntersectingExtent = S.prototype.dh;
    S.prototype.getFeaturesCollection = S.prototype.lh;
    S.prototype.getFeatures = S.prototype.Ne;
    S.prototype.getFeaturesAtCoordinate = S.prototype.kh;
    S.prototype.getFeaturesInExtent = S.prototype.Hf;
    S.prototype.getClosestFeatureToCoordinate = S.prototype.gh;
    S.prototype.getExtent = S.prototype.D;
    S.prototype.getFeatureById = S.prototype.jh;
    S.prototype.getFormat = S.prototype.hi;
    S.prototype.getUrl = S.prototype.ii;
    S.prototype.removeFeature = S.prototype.Db;
    Nt.prototype.feature = Nt.prototype.feature;
    t('ol.source.VectorTile', Yw);
    t('ol.source.WMTS', Y);
    Y.prototype.getDimensions = Y.prototype.rk;
    Y.prototype.getFormat = Y.prototype.Wn;
    Y.prototype.getLayer = Y.prototype.Xn;
    Y.prototype.getMatrixSet = Y.prototype.Fk;
    Y.prototype.getRequestEncoding = Y.prototype.Qk;
    Y.prototype.getStyle = Y.prototype.Yn;
    Y.prototype.getVersion = Y.prototype.Xk;
    Y.prototype.updateDimensions = Y.prototype.Gp;
    t('ol.source.WMTS.optionsFromCapabilities', function (a, b) {
        var c = ha(a.Contents.Layer, function (a) {
                return a.Identifier == b.layer;
            }), d = a.Contents.TileMatrixSet, e, f, g;
        e = 1 < c.TileMatrixSetLink.length ? 'projection' in b ? la(c.TileMatrixSetLink, function (a) {
            var c = ha(d, function (b) {
                    return b.Identifier == a.TileMatrixSet;
                }).SupportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/, '$1:$3'), e = Gb(c), f = Gb(b.projection);
            return e && f ? Tb(e, f) : c == b.projection;
        }) : la(c.TileMatrixSetLink, function (a) {
            return a.TileMatrixSet == b.matrixSet;
        }) : 0;
        0 > e && (e = 0);
        f = c.TileMatrixSetLink[e].TileMatrixSet;
        g = c.TileMatrixSetLink[e].TileMatrixSetLimits;
        var h = c.Format[0];
        'format' in b && (h = b.format);
        e = la(c.Style, function (a) {
            return 'style' in b ? a.Title == b.style : a.isDefault;
        });
        0 > e && (e = 0);
        e = c.Style[e].Identifier;
        var l = {};
        'Dimension' in c && c.Dimension.forEach(function (a) {
            var b = a.Identifier, c = a.Default;
            void 0 === c && (c = a.Value[0]);
            l[b] = c;
        });
        var m = ha(a.Contents.TileMatrixSet, function (a) {
                return a.Identifier == f;
            }), p;
        p = 'projection' in b ? Gb(b.projection) : Gb(m.SupportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/, '$1:$3'));
        var n = c.WGS84BoundingBox, q, r;
        void 0 !== n && (r = Gb('EPSG:4326').D(), r = n[0] == r[0] && n[2] == r[2], q = Xb(n, 'EPSG:4326', p), (n = p.D()) && (Ta(n, q) || (q = void 0)));
        g = $w(m, q, g);
        var v = [], m = b.requestEncoding, m = void 0 !== m ? m : '';
        if ('OperationsMetadata' in a && 'GetTile' in a.OperationsMetadata) {
            q = a.OperationsMetadata.GetTile.DCP.HTTP.Get;
            for (var n = 0, x = q.length; n < x; ++n) {
                var y = ha(q[n].Constraint, function (a) {
                    return 'GetEncoding' == a.name;
                }).AllowedValues.Value;
                '' === m && (m = y[0]);
                if ('KVP' === m)
                    ea(y, 'KVP') && v.push(q[n].href);
                else
                    break;
            }
        }
        v.length || (m = 'REST', c.ResourceURL.forEach(function (a) {
            'tile' === a.resourceType && (h = a.format, v.push(a.template));
        }));
        return {
            urls: v,
            layer: b.layer,
            matrixSet: f,
            format: h,
            projection: p,
            requestEncoding: m,
            tileGrid: g,
            style: e,
            dimensions: l,
            wrapX: r
        };
    });
    t('ol.source.XYZ', gw);
    t('ol.source.Zoomify', bx);
    Mh.prototype.vectorContext = Mh.prototype.vectorContext;
    Mh.prototype.frameState = Mh.prototype.frameState;
    Mh.prototype.context = Mh.prototype.context;
    Mh.prototype.glContext = Mh.prototype.glContext;
    Yp.prototype.get = Yp.prototype.get;
    Yp.prototype.getExtent = Yp.prototype.D;
    Yp.prototype.getGeometry = Yp.prototype.U;
    Yp.prototype.getProperties = Yp.prototype.mn;
    Yp.prototype.getType = Yp.prototype.T;
    t('ol.render.VectorContext', Rh);
    ik.prototype.setStyle = ik.prototype.pd;
    ik.prototype.drawGeometry = ik.prototype.mc;
    ik.prototype.drawFeature = ik.prototype.oe;
    Sh.prototype.drawCircle = Sh.prototype.$b;
    Sh.prototype.setStyle = Sh.prototype.pd;
    Sh.prototype.drawGeometry = Sh.prototype.mc;
    Sh.prototype.drawFeature = Sh.prototype.oe;
    t('ol.proj.common.add', qh);
    t('ol.proj.Projection', yb);
    yb.prototype.getCode = yb.prototype.nk;
    yb.prototype.getExtent = yb.prototype.D;
    yb.prototype.getUnits = yb.prototype.Jb;
    yb.prototype.getMetersPerUnit = yb.prototype.sc;
    yb.prototype.getWorldExtent = yb.prototype.Zk;
    yb.prototype.isGlobal = yb.prototype.Kl;
    yb.prototype.setGlobal = yb.prototype.pp;
    yb.prototype.setExtent = yb.prototype.ln;
    yb.prototype.setWorldExtent = yb.prototype.xp;
    yb.prototype.setGetPointResolution = yb.prototype.op;
    t('ol.proj.Units.METERS_PER_UNIT', vb);
    t('ol.layer.Base', dh);
    dh.prototype.getExtent = dh.prototype.D;
    dh.prototype.getMaxResolution = dh.prototype.gc;
    dh.prototype.getMinResolution = dh.prototype.hc;
    dh.prototype.getOpacity = dh.prototype.ic;
    dh.prototype.getVisible = dh.prototype.Kb;
    dh.prototype.getZIndex = dh.prototype.za;
    dh.prototype.setExtent = dh.prototype.uc;
    dh.prototype.setMaxResolution = dh.prototype.zc;
    dh.prototype.setMinResolution = dh.prototype.Ac;
    dh.prototype.setOpacity = dh.prototype.vc;
    dh.prototype.setVisible = dh.prototype.wc;
    dh.prototype.setZIndex = dh.prototype.Wb;
    t('ol.layer.Group', fh);
    fh.prototype.getLayers = fh.prototype.od;
    fh.prototype.setLayers = fh.prototype.Sh;
    t('ol.layer.Heatmap', T);
    T.prototype.getBlur = T.prototype.fh;
    T.prototype.getGradient = T.prototype.mh;
    T.prototype.getRadius = T.prototype.Th;
    T.prototype.setBlur = T.prototype.Ei;
    T.prototype.setGradient = T.prototype.Ki;
    T.prototype.setRadius = T.prototype.Wc;
    t('ol.layer.Image', yv);
    yv.prototype.getSource = yv.prototype.la;
    t('ol.layer.Layer', rh);
    rh.prototype.getSource = rh.prototype.la;
    rh.prototype.setMap = rh.prototype.setMap;
    rh.prototype.setSource = rh.prototype.Yc;
    t('ol.layer.Tile', Hv);
    Hv.prototype.getPreload = Hv.prototype.Pd;
    Hv.prototype.getSource = Hv.prototype.la;
    Hv.prototype.setPreload = Hv.prototype.Uh;
    Hv.prototype.getUseInterimTilesOnError = Hv.prototype.Td;
    Hv.prototype.setUseInterimTilesOnError = Hv.prototype.Vh;
    t('ol.layer.Vector', R);
    R.prototype.getSource = R.prototype.la;
    R.prototype.getStyle = R.prototype.C;
    R.prototype.getStyleFunction = R.prototype.G;
    R.prototype.setStyle = R.prototype.g;
    t('ol.layer.VectorTile', U);
    U.prototype.getPreload = U.prototype.Pd;
    U.prototype.getUseInterimTilesOnError = U.prototype.Td;
    U.prototype.setPreload = U.prototype.Wh;
    U.prototype.setUseInterimTilesOnError = U.prototype.Xh;
    t('ol.interaction.DoubleClickZoom', eg);
    t('ol.interaction.DoubleClickZoom.handleEvent', fg);
    t('ol.interaction.DragAndDrop', zs);
    t('ol.interaction.DragAndDrop.handleEvent', af);
    Cs.prototype.features = Cs.prototype.features;
    Cs.prototype.file = Cs.prototype.file;
    Cs.prototype.projection = Cs.prototype.projection;
    t('ol.interaction.DragBox', Dg);
    Dg.prototype.getGeometry = Dg.prototype.U;
    Ig.prototype.coordinate = Ig.prototype.coordinate;
    Ig.prototype.mapBrowserEvent = Ig.prototype.mapBrowserEvent;
    t('ol.interaction.DragPan', sg);
    t('ol.interaction.DragRotate', wg);
    t('ol.interaction.DragRotateAndZoom', Es);
    t('ol.interaction.DragZoom', Mg);
    t('ol.interaction.Draw', Qt);
    t('ol.interaction.Draw.handleEvent', St);
    Qt.prototype.removeLastPoint = Qt.prototype.cp;
    Qt.prototype.finishDrawing = Qt.prototype.Nd;
    Qt.prototype.extend = Qt.prototype.Om;
    t('ol.interaction.Draw.createRegularPolygon', function (a, b) {
        return function (c, d) {
            var e = c[0], f = c[1], g = Math.sqrt(Xe(e, f)), h = d ? d : Of(new is(e), a);
            Pf(h, e, g, b ? b : Math.atan((f[1] - e[1]) / (f[0] - e[0])));
            return h;
        };
    });
    t('ol.interaction.Draw.createBox', function () {
        return function (a, b) {
            var c = Ha(a), d = b || new F(null);
            d.pa([[
                    bb(c),
                    cb(c),
                    db(c),
                    eb(c),
                    bb(c)
                ]]);
            return d;
        };
    });
    eu.prototype.feature = eu.prototype.feature;
    t('ol.interaction.Extent', gu);
    gu.prototype.getExtent = gu.prototype.D;
    gu.prototype.setExtent = gu.prototype.g;
    ru.prototype.extent_ = ru.prototype.b;
    t('ol.interaction.Interaction', ag);
    ag.prototype.getActive = ag.prototype.c;
    ag.prototype.getMap = ag.prototype.i;
    ag.prototype.setActive = ag.prototype.Ia;
    t('ol.interaction.KeyboardPan', Ng);
    t('ol.interaction.KeyboardPan.handleEvent', Og);
    t('ol.interaction.KeyboardZoom', Pg);
    t('ol.interaction.KeyboardZoom.handleEvent', Qg);
    t('ol.interaction.Modify', tu);
    t('ol.interaction.Modify.handleEvent', wu);
    tu.prototype.removePoint = tu.prototype.Ci;
    Bu.prototype.features = Bu.prototype.features;
    Bu.prototype.mapBrowserEvent = Bu.prototype.mapBrowserEvent;
    t('ol.interaction.MouseWheelZoom', Rg);
    t('ol.interaction.MouseWheelZoom.handleEvent', Sg);
    Rg.prototype.setMouseAnchor = Rg.prototype.S;
    t('ol.interaction.PinchRotate', Vg);
    t('ol.interaction.PinchZoom', Zg);
    t('ol.interaction.Pointer', pg);
    t('ol.interaction.Pointer.handleEvent', qg);
    t('ol.interaction.Select', Ju);
    Ju.prototype.getFeatures = Ju.prototype.Ym;
    Ju.prototype.getHitTolerance = Ju.prototype.Zm;
    Ju.prototype.getLayer = Ju.prototype.$m;
    t('ol.interaction.Select.handleEvent', Ku);
    Ju.prototype.setHitTolerance = Ju.prototype.bn;
    Ju.prototype.setMap = Ju.prototype.setMap;
    Mu.prototype.selected = Mu.prototype.selected;
    Mu.prototype.deselected = Mu.prototype.deselected;
    Mu.prototype.mapBrowserEvent = Mu.prototype.mapBrowserEvent;
    t('ol.interaction.Snap', Ou);
    Ou.prototype.addFeature = Ou.prototype.zb;
    Ou.prototype.removeFeature = Ou.prototype.Db;
    t('ol.interaction.Translate', Su);
    Su.prototype.getHitTolerance = Su.prototype.G;
    Su.prototype.setHitTolerance = Su.prototype.R;
    Yu.prototype.features = Yu.prototype.features;
    Yu.prototype.coordinate = Yu.prototype.coordinate;
    t('ol.geom.Circle', is);
    is.prototype.clone = is.prototype.clone;
    is.prototype.getCenter = is.prototype.Ba;
    is.prototype.getRadius = is.prototype.Vd;
    is.prototype.getType = is.prototype.T;
    is.prototype.intersectsExtent = is.prototype.Xa;
    is.prototype.setCenter = is.prototype.wb;
    is.prototype.setCenterAndRadius = is.prototype.yg;
    is.prototype.setRadius = is.prototype.Wc;
    is.prototype.transform = is.prototype.tb;
    t('ol.geom.Geometry', cf);
    cf.prototype.getClosestPoint = cf.prototype.Ab;
    cf.prototype.intersectsCoordinate = cf.prototype.sb;
    cf.prototype.getExtent = cf.prototype.D;
    cf.prototype.rotate = cf.prototype.rotate;
    cf.prototype.scale = cf.prototype.scale;
    cf.prototype.simplify = cf.prototype.Pb;
    cf.prototype.transform = cf.prototype.tb;
    t('ol.geom.GeometryCollection', qm);
    qm.prototype.clone = qm.prototype.clone;
    qm.prototype.getGeometries = qm.prototype.If;
    qm.prototype.getType = qm.prototype.T;
    qm.prototype.intersectsExtent = qm.prototype.Xa;
    qm.prototype.setGeometries = qm.prototype.Ji;
    qm.prototype.applyTransform = qm.prototype.Dc;
    qm.prototype.translate = qm.prototype.translate;
    t('ol.geom.LinearRing', yf);
    yf.prototype.clone = yf.prototype.clone;
    yf.prototype.getArea = yf.prototype.Km;
    yf.prototype.getCoordinates = yf.prototype.X;
    yf.prototype.getType = yf.prototype.T;
    yf.prototype.setCoordinates = yf.prototype.pa;
    t('ol.geom.LineString', M);
    M.prototype.appendCoordinate = M.prototype.Tj;
    M.prototype.clone = M.prototype.clone;
    M.prototype.forEachSegment = M.prototype.gk;
    M.prototype.getCoordinateAtM = M.prototype.Im;
    M.prototype.getCoordinates = M.prototype.X;
    M.prototype.getCoordinateAt = M.prototype.hh;
    M.prototype.getLength = M.prototype.Jm;
    M.prototype.getType = M.prototype.T;
    M.prototype.intersectsExtent = M.prototype.Xa;
    M.prototype.setCoordinates = M.prototype.pa;
    t('ol.geom.MultiLineString', N);
    N.prototype.appendLineString = N.prototype.Uj;
    N.prototype.clone = N.prototype.clone;
    N.prototype.getCoordinateAtM = N.prototype.Lm;
    N.prototype.getCoordinates = N.prototype.X;
    N.prototype.getLineString = N.prototype.Dk;
    N.prototype.getLineStrings = N.prototype.hd;
    N.prototype.getType = N.prototype.T;
    N.prototype.intersectsExtent = N.prototype.Xa;
    N.prototype.setCoordinates = N.prototype.pa;
    t('ol.geom.MultiPoint', O);
    O.prototype.appendPoint = O.prototype.Wj;
    O.prototype.clone = O.prototype.clone;
    O.prototype.getCoordinates = O.prototype.X;
    O.prototype.getPoint = O.prototype.Ok;
    O.prototype.getPoints = O.prototype.Ie;
    O.prototype.getType = O.prototype.T;
    O.prototype.intersectsExtent = O.prototype.Xa;
    O.prototype.setCoordinates = O.prototype.pa;
    t('ol.geom.MultiPolygon', P);
    P.prototype.appendPolygon = P.prototype.Xj;
    P.prototype.clone = P.prototype.clone;
    P.prototype.getArea = P.prototype.Mm;
    P.prototype.getCoordinates = P.prototype.X;
    P.prototype.getInteriorPoints = P.prototype.zk;
    P.prototype.getPolygon = P.prototype.Pk;
    P.prototype.getPolygons = P.prototype.Od;
    P.prototype.getType = P.prototype.T;
    P.prototype.intersectsExtent = P.prototype.Xa;
    P.prototype.setCoordinates = P.prototype.pa;
    t('ol.geom.Point', E);
    E.prototype.clone = E.prototype.clone;
    E.prototype.getCoordinates = E.prototype.X;
    E.prototype.getType = E.prototype.T;
    E.prototype.intersectsExtent = E.prototype.Xa;
    E.prototype.setCoordinates = E.prototype.pa;
    t('ol.geom.Polygon', F);
    F.prototype.appendLinearRing = F.prototype.Vj;
    F.prototype.clone = F.prototype.clone;
    F.prototype.getArea = F.prototype.Nm;
    F.prototype.getCoordinates = F.prototype.X;
    F.prototype.getInteriorPoint = F.prototype.yk;
    F.prototype.getLinearRingCount = F.prototype.Ek;
    F.prototype.getLinearRing = F.prototype.nh;
    F.prototype.getLinearRings = F.prototype.jd;
    F.prototype.getType = F.prototype.T;
    F.prototype.intersectsExtent = F.prototype.Xa;
    F.prototype.setCoordinates = F.prototype.pa;
    t('ol.geom.Polygon.circular', Mf);
    t('ol.geom.Polygon.fromExtent', Nf);
    t('ol.geom.Polygon.fromCircle', Of);
    t('ol.geom.SimpleGeometry', ff);
    ff.prototype.getFirstCoordinate = ff.prototype.bc;
    ff.prototype.getLastCoordinate = ff.prototype.cc;
    ff.prototype.getLayout = ff.prototype.dc;
    ff.prototype.applyTransform = ff.prototype.Dc;
    ff.prototype.translate = ff.prototype.translate;
    t('ol.format.EsriJSON', Ol);
    Ol.prototype.readFeature = Ol.prototype.Ub;
    Ol.prototype.readFeatures = Ol.prototype.Qa;
    Ol.prototype.readGeometry = Ol.prototype.Tc;
    Ol.prototype.readProjection = Ol.prototype.kb;
    Ol.prototype.writeGeometry = Ol.prototype.bd;
    Ol.prototype.writeGeometryObject = Ol.prototype.ee;
    Ol.prototype.writeFeature = Ol.prototype.yd;
    Ol.prototype.writeFeatureObject = Ol.prototype.ad;
    Ol.prototype.writeFeatures = Ol.prototype.Xb;
    Ol.prototype.writeFeaturesObject = Ol.prototype.ce;
    t('ol.format.Feature', Cl);
    t('ol.format.filter.and', om);
    t('ol.format.filter.or', function (a) {
        var b = [null].concat(Array.prototype.slice.call(arguments));
        return new (Function.prototype.bind.apply(mm, b))();
    });
    t('ol.format.filter.not', function (a) {
        return new km(a);
    });
    t('ol.format.filter.bbox', pm);
    t('ol.format.filter.intersects', function (a, b, c) {
        return new em(a, b, c);
    });
    t('ol.format.filter.within', function (a, b, c) {
        return new nm(a, b, c);
    });
    t('ol.format.filter.equalTo', function (a, b, c) {
        return new am(a, b, c);
    });
    t('ol.format.filter.notEqualTo', function (a, b, c) {
        return new lm(a, b, c);
    });
    t('ol.format.filter.lessThan', function (a, b) {
        return new im(a, b);
    });
    t('ol.format.filter.lessThanOrEqualTo', function (a, b) {
        return new jm(a, b);
    });
    t('ol.format.filter.greaterThan', function (a, b) {
        return new bm(a, b);
    });
    t('ol.format.filter.greaterThanOrEqualTo', function (a, b) {
        return new cm(a, b);
    });
    t('ol.format.filter.isNull', function (a) {
        return new hm(a);
    });
    t('ol.format.filter.between', function (a, b, c) {
        return new fm(a, b, c);
    });
    t('ol.format.filter.like', function (a, b, c, d, e, f) {
        return new gm(a, b, c, d, e, f);
    });
    t('ol.format.GeoJSON', um);
    um.prototype.readFeature = um.prototype.Ub;
    um.prototype.readFeatures = um.prototype.Qa;
    um.prototype.readGeometry = um.prototype.Tc;
    um.prototype.readProjection = um.prototype.kb;
    um.prototype.writeFeature = um.prototype.yd;
    um.prototype.writeFeatureObject = um.prototype.ad;
    um.prototype.writeFeatures = um.prototype.Xb;
    um.prototype.writeFeaturesObject = um.prototype.ce;
    um.prototype.writeGeometry = um.prototype.bd;
    um.prototype.writeGeometryObject = um.prototype.ee;
    t('ol.format.GML', Pm);
    Pm.prototype.writeFeatures = Pm.prototype.Xb;
    Pm.prototype.writeFeaturesNode = Pm.prototype.Yb;
    t('ol.format.GML2', Ym);
    t('ol.format.GML3', Pm);
    Pm.prototype.writeGeometryNode = Pm.prototype.de;
    Pm.prototype.writeFeatures = Pm.prototype.Xb;
    Pm.prototype.writeFeaturesNode = Pm.prototype.Yb;
    Cm.prototype.readFeatures = Cm.prototype.Qa;
    t('ol.format.GPX', Zm);
    Zm.prototype.readFeature = Zm.prototype.Ub;
    Zm.prototype.readFeatures = Zm.prototype.Qa;
    Zm.prototype.readProjection = Zm.prototype.kb;
    Zm.prototype.writeFeatures = Zm.prototype.Xb;
    Zm.prototype.writeFeaturesNode = Zm.prototype.Yb;
    t('ol.format.IGC', Kn);
    Kn.prototype.readFeature = Kn.prototype.Ub;
    Kn.prototype.readFeatures = Kn.prototype.Qa;
    Kn.prototype.readProjection = Kn.prototype.kb;
    t('ol.format.KML', Tn);
    Tn.prototype.readFeature = Tn.prototype.Ub;
    Tn.prototype.readFeatures = Tn.prototype.Qa;
    Tn.prototype.readName = Tn.prototype.Ro;
    Tn.prototype.readNetworkLinks = Tn.prototype.So;
    Tn.prototype.readRegion = Tn.prototype.Vo;
    Tn.prototype.readRegionFromNode = Tn.prototype.$e;
    Tn.prototype.readProjection = Tn.prototype.kb;
    Tn.prototype.writeFeatures = Tn.prototype.Xb;
    Tn.prototype.writeFeaturesNode = Tn.prototype.Yb;
    t('ol.format.MVT', Zp);
    Zp.prototype.readFeatures = Zp.prototype.Qa;
    Zp.prototype.readProjection = Zp.prototype.kb;
    Zp.prototype.setLayers = Zp.prototype.Hm;
    t('ol.format.OSMXML', aq);
    aq.prototype.readFeatures = aq.prototype.Qa;
    aq.prototype.readProjection = aq.prototype.kb;
    t('ol.format.Polyline', Aq);
    t('ol.format.Polyline.encodeDeltas', Bq);
    t('ol.format.Polyline.decodeDeltas', Dq);
    t('ol.format.Polyline.encodeFloats', Cq);
    t('ol.format.Polyline.decodeFloats', Eq);
    Aq.prototype.readFeature = Aq.prototype.Ub;
    Aq.prototype.readFeatures = Aq.prototype.Qa;
    Aq.prototype.readGeometry = Aq.prototype.Tc;
    Aq.prototype.readProjection = Aq.prototype.kb;
    Aq.prototype.writeGeometry = Aq.prototype.bd;
    t('ol.format.TopoJSON', Fq);
    Fq.prototype.readFeatures = Fq.prototype.Qa;
    Fq.prototype.readProjection = Fq.prototype.kb;
    t('ol.format.WFS', Lq);
    Lq.prototype.readFeatures = Lq.prototype.Qa;
    Lq.prototype.readTransactionResponse = Lq.prototype.j;
    Lq.prototype.readFeatureCollectionMetadata = Lq.prototype.l;
    Lq.prototype.writeGetFeature = Lq.prototype.o;
    Lq.prototype.writeTransaction = Lq.prototype.v;
    Lq.prototype.readProjection = Lq.prototype.kb;
    t('ol.format.WKT', cr);
    cr.prototype.readFeature = cr.prototype.Ub;
    cr.prototype.readFeatures = cr.prototype.Qa;
    cr.prototype.readGeometry = cr.prototype.Tc;
    cr.prototype.writeFeature = cr.prototype.yd;
    cr.prototype.writeFeatures = cr.prototype.Xb;
    cr.prototype.writeGeometry = cr.prototype.bd;
    t('ol.format.WMSCapabilities', vr);
    vr.prototype.read = vr.prototype.read;
    t('ol.format.WMSGetFeatureInfo', Sr);
    Sr.prototype.readFeatures = Sr.prototype.Qa;
    t('ol.format.WMTSCapabilities', Tr);
    Tr.prototype.read = Tr.prototype.read;
    t('ol.format.filter.And', Xl);
    t('ol.format.filter.Bbox', Yl);
    t('ol.format.filter.Comparison', Zl);
    t('ol.format.filter.ComparisonBinary', $l);
    t('ol.format.filter.EqualTo', am);
    t('ol.format.filter.Filter', Vl);
    t('ol.format.filter.GreaterThan', bm);
    t('ol.format.filter.GreaterThanOrEqualTo', cm);
    t('ol.format.filter.Intersects', em);
    t('ol.format.filter.IsBetween', fm);
    t('ol.format.filter.IsLike', gm);
    t('ol.format.filter.IsNull', hm);
    t('ol.format.filter.LessThan', im);
    t('ol.format.filter.LessThanOrEqualTo', jm);
    t('ol.format.filter.Not', km);
    t('ol.format.filter.NotEqualTo', lm);
    t('ol.format.filter.Or', mm);
    t('ol.format.filter.Spatial', dm);
    t('ol.format.filter.Within', nm);
    t('ol.events.condition.altKeyOnly', function (a) {
        a = a.originalEvent;
        return a.altKey && !(a.metaKey || a.ctrlKey) && !a.shiftKey;
    });
    t('ol.events.condition.altShiftKeysOnly', gg);
    t('ol.events.condition.always', af);
    t('ol.events.condition.click', function (a) {
        return 'click' == a.type;
    });
    t('ol.events.condition.never', bf);
    t('ol.events.condition.pointerMove', ig);
    t('ol.events.condition.singleClick', jg);
    t('ol.events.condition.doubleClick', function (a) {
        return 'dblclick' == a.type;
    });
    t('ol.events.condition.noModifierKeys', kg);
    t('ol.events.condition.platformModifierKeyOnly', function (a) {
        a = a.originalEvent;
        return !a.altKey && (Jd ? a.metaKey : a.ctrlKey) && !a.shiftKey;
    });
    t('ol.events.condition.shiftKeyOnly', lg);
    t('ol.events.condition.targetNotEditable', mg);
    t('ol.events.condition.mouseOnly', ng);
    t('ol.events.condition.primaryAction', og);
    Bc.prototype.type = Bc.prototype.type;
    Bc.prototype.target = Bc.prototype.target;
    Bc.prototype.preventDefault = Bc.prototype.preventDefault;
    Bc.prototype.stopPropagation = Bc.prototype.stopPropagation;
    t('ol.control.Attribution', bd);
    t('ol.control.Attribution.render', cd);
    bd.prototype.getCollapsible = bd.prototype.xm;
    bd.prototype.setCollapsible = bd.prototype.Am;
    bd.prototype.setCollapsed = bd.prototype.zm;
    bd.prototype.getCollapsed = bd.prototype.wm;
    t('ol.control.Control', ad);
    ad.prototype.getMap = ad.prototype.g;
    ad.prototype.setMap = ad.prototype.setMap;
    ad.prototype.setTarget = ad.prototype.i;
    t('ol.control.FullScreen', od);
    t('ol.control.MousePosition', td);
    t('ol.control.MousePosition.render', ud);
    td.prototype.getCoordinateFormat = td.prototype.ih;
    td.prototype.getProjection = td.prototype.Lh;
    td.prototype.setCoordinateFormat = td.prototype.Fi;
    td.prototype.setProjection = td.prototype.Mh;
    t('ol.control.OverviewMap', zk);
    t('ol.control.OverviewMap.render', Ak);
    zk.prototype.getCollapsible = zk.prototype.Dm;
    zk.prototype.setCollapsible = zk.prototype.Gm;
    zk.prototype.setCollapsed = zk.prototype.Fm;
    zk.prototype.getCollapsed = zk.prototype.Cm;
    zk.prototype.getOverviewMap = zk.prototype.Mk;
    t('ol.control.Rotate', id);
    t('ol.control.Rotate.render', jd);
    t('ol.control.ScaleLine', Ek);
    Ek.prototype.getUnits = Ek.prototype.Jb;
    t('ol.control.ScaleLine.render', Fk);
    Ek.prototype.setUnits = Ek.prototype.G;
    t('ol.control.Zoom', kd);
    t('ol.control.ZoomSlider', Jk);
    t('ol.control.ZoomSlider.render', Lk);
    t('ol.control.ZoomToExtent', Ok);
    Gc.prototype.changed = Gc.prototype.s;
    Gc.prototype.dispatchEvent = Gc.prototype.b;
    Gc.prototype.getRevision = Gc.prototype.L;
    Gc.prototype.on = Gc.prototype.J;
    Gc.prototype.once = Gc.prototype.once;
    Gc.prototype.un = Gc.prototype.K;
    D.prototype.get = D.prototype.get;
    D.prototype.getKeys = D.prototype.O;
    D.prototype.getProperties = D.prototype.N;
    D.prototype.set = D.prototype.set;
    D.prototype.setProperties = D.prototype.H;
    D.prototype.unset = D.prototype.P;
    D.prototype.changed = D.prototype.s;
    D.prototype.dispatchEvent = D.prototype.b;
    D.prototype.getRevision = D.prototype.L;
    D.prototype.on = D.prototype.J;
    D.prototype.once = D.prototype.once;
    D.prototype.un = D.prototype.K;
    Nc.prototype.type = Nc.prototype.type;
    Nc.prototype.target = Nc.prototype.target;
    Nc.prototype.preventDefault = Nc.prototype.preventDefault;
    Nc.prototype.stopPropagation = Nc.prototype.stopPropagation;
    Pk.prototype.get = Pk.prototype.get;
    Pk.prototype.getKeys = Pk.prototype.O;
    Pk.prototype.getProperties = Pk.prototype.N;
    Pk.prototype.set = Pk.prototype.set;
    Pk.prototype.setProperties = Pk.prototype.H;
    Pk.prototype.unset = Pk.prototype.P;
    Pk.prototype.changed = Pk.prototype.s;
    Pk.prototype.dispatchEvent = Pk.prototype.b;
    Pk.prototype.getRevision = Pk.prototype.L;
    Pk.prototype.on = Pk.prototype.J;
    Pk.prototype.once = Pk.prototype.once;
    Pk.prototype.un = Pk.prototype.K;
    H.prototype.get = H.prototype.get;
    H.prototype.getKeys = H.prototype.O;
    H.prototype.getProperties = H.prototype.N;
    H.prototype.set = H.prototype.set;
    H.prototype.setProperties = H.prototype.H;
    H.prototype.unset = H.prototype.P;
    H.prototype.changed = H.prototype.s;
    H.prototype.dispatchEvent = H.prototype.b;
    H.prototype.getRevision = H.prototype.L;
    H.prototype.on = H.prototype.J;
    H.prototype.once = H.prototype.once;
    H.prototype.un = H.prototype.K;
    hs.prototype.get = hs.prototype.get;
    hs.prototype.getKeys = hs.prototype.O;
    hs.prototype.getProperties = hs.prototype.N;
    hs.prototype.set = hs.prototype.set;
    hs.prototype.setProperties = hs.prototype.H;
    hs.prototype.unset = hs.prototype.P;
    hs.prototype.changed = hs.prototype.s;
    hs.prototype.dispatchEvent = hs.prototype.b;
    hs.prototype.getRevision = hs.prototype.L;
    hs.prototype.on = hs.prototype.J;
    hs.prototype.once = hs.prototype.once;
    hs.prototype.un = hs.prototype.K;
    xs.prototype.getTileCoord = xs.prototype.i;
    xs.prototype.load = xs.prototype.load;
    G.prototype.get = G.prototype.get;
    G.prototype.getKeys = G.prototype.O;
    G.prototype.getProperties = G.prototype.N;
    G.prototype.set = G.prototype.set;
    G.prototype.setProperties = G.prototype.H;
    G.prototype.unset = G.prototype.P;
    G.prototype.changed = G.prototype.s;
    G.prototype.dispatchEvent = G.prototype.b;
    G.prototype.getRevision = G.prototype.L;
    G.prototype.on = G.prototype.J;
    G.prototype.once = G.prototype.once;
    G.prototype.un = G.prototype.K;
    yd.prototype.type = yd.prototype.type;
    yd.prototype.target = yd.prototype.target;
    yd.prototype.preventDefault = yd.prototype.preventDefault;
    yd.prototype.stopPropagation = yd.prototype.stopPropagation;
    zd.prototype.map = zd.prototype.map;
    zd.prototype.frameState = zd.prototype.frameState;
    zd.prototype.type = zd.prototype.type;
    zd.prototype.target = zd.prototype.target;
    zd.prototype.preventDefault = zd.prototype.preventDefault;
    zd.prototype.stopPropagation = zd.prototype.stopPropagation;
    Bd.prototype.originalEvent = Bd.prototype.originalEvent;
    Bd.prototype.pixel = Bd.prototype.pixel;
    Bd.prototype.coordinate = Bd.prototype.coordinate;
    Bd.prototype.dragging = Bd.prototype.dragging;
    Bd.prototype.preventDefault = Bd.prototype.preventDefault;
    Bd.prototype.stopPropagation = Bd.prototype.stopPropagation;
    Bd.prototype.map = Bd.prototype.map;
    Bd.prototype.frameState = Bd.prototype.frameState;
    Bd.prototype.type = Bd.prototype.type;
    Bd.prototype.target = Bd.prototype.target;
    Kc.prototype.type = Kc.prototype.type;
    Kc.prototype.target = Kc.prototype.target;
    Kc.prototype.preventDefault = Kc.prototype.preventDefault;
    Kc.prototype.stopPropagation = Kc.prototype.stopPropagation;
    qk.prototype.get = qk.prototype.get;
    qk.prototype.getKeys = qk.prototype.O;
    qk.prototype.getProperties = qk.prototype.N;
    qk.prototype.set = qk.prototype.set;
    qk.prototype.setProperties = qk.prototype.H;
    qk.prototype.unset = qk.prototype.P;
    qk.prototype.changed = qk.prototype.s;
    qk.prototype.dispatchEvent = qk.prototype.b;
    qk.prototype.getRevision = qk.prototype.L;
    qk.prototype.on = qk.prototype.J;
    qk.prototype.once = qk.prototype.once;
    qk.prototype.un = qk.prototype.K;
    Ww.prototype.getTileCoord = Ww.prototype.i;
    Ww.prototype.load = Ww.prototype.load;
    Qf.prototype.get = Qf.prototype.get;
    Qf.prototype.getKeys = Qf.prototype.O;
    Qf.prototype.getProperties = Qf.prototype.N;
    Qf.prototype.set = Qf.prototype.set;
    Qf.prototype.setProperties = Qf.prototype.H;
    Qf.prototype.unset = Qf.prototype.P;
    Qf.prototype.changed = Qf.prototype.s;
    Qf.prototype.dispatchEvent = Qf.prototype.b;
    Qf.prototype.getRevision = Qf.prototype.L;
    Qf.prototype.on = Qf.prototype.J;
    Qf.prototype.once = Qf.prototype.once;
    Qf.prototype.un = Qf.prototype.K;
    Zw.prototype.forEachTileCoord = Zw.prototype.eh;
    Zw.prototype.getMaxZoom = Zw.prototype.oh;
    Zw.prototype.getMinZoom = Zw.prototype.ph;
    Zw.prototype.getOrigin = Zw.prototype.Qc;
    Zw.prototype.getResolution = Zw.prototype.La;
    Zw.prototype.getResolutions = Zw.prototype.oi;
    Zw.prototype.getTileCoordExtent = Zw.prototype.Ta;
    Zw.prototype.getTileCoordForCoordAndResolution = Zw.prototype.we;
    Zw.prototype.getTileCoordForCoordAndZ = Zw.prototype.Pf;
    Zw.prototype.getTileSize = Zw.prototype.fb;
    Zw.prototype.getZForResolution = Zw.prototype.Mc;
    Wk.prototype.getOpacity = Wk.prototype.Pe;
    Wk.prototype.getRotateWithView = Wk.prototype.Qe;
    Wk.prototype.getRotation = Wk.prototype.Re;
    Wk.prototype.getScale = Wk.prototype.Se;
    Wk.prototype.getSnapToPixel = Wk.prototype.ve;
    Wk.prototype.setOpacity = Wk.prototype.rd;
    Wk.prototype.setRotation = Wk.prototype.Te;
    Wk.prototype.setScale = Wk.prototype.sd;
    Yk.prototype.clone = Yk.prototype.clone;
    Yk.prototype.getAngle = Yk.prototype.ki;
    Yk.prototype.getFill = Yk.prototype.Ca;
    Yk.prototype.getPoints = Yk.prototype.li;
    Yk.prototype.getRadius = Yk.prototype.mi;
    Yk.prototype.getRadius2 = Yk.prototype.sh;
    Yk.prototype.getStroke = Yk.prototype.Da;
    Yk.prototype.getOpacity = Yk.prototype.Pe;
    Yk.prototype.getRotateWithView = Yk.prototype.Qe;
    Yk.prototype.getRotation = Yk.prototype.Re;
    Yk.prototype.getScale = Yk.prototype.Se;
    Yk.prototype.getSnapToPixel = Yk.prototype.ve;
    Yk.prototype.setOpacity = Yk.prototype.rd;
    Yk.prototype.setRotation = Yk.prototype.Te;
    Yk.prototype.setScale = Yk.prototype.sd;
    Rn.prototype.getOpacity = Rn.prototype.Pe;
    Rn.prototype.getRotateWithView = Rn.prototype.Qe;
    Rn.prototype.getRotation = Rn.prototype.Re;
    Rn.prototype.getScale = Rn.prototype.Se;
    Rn.prototype.getSnapToPixel = Rn.prototype.ve;
    Rn.prototype.setOpacity = Rn.prototype.rd;
    Rn.prototype.setRotation = Rn.prototype.Te;
    Rn.prototype.setScale = Rn.prototype.sd;
    Gt.prototype.get = Gt.prototype.get;
    Gt.prototype.getKeys = Gt.prototype.O;
    Gt.prototype.getProperties = Gt.prototype.N;
    Gt.prototype.set = Gt.prototype.set;
    Gt.prototype.setProperties = Gt.prototype.H;
    Gt.prototype.unset = Gt.prototype.P;
    Gt.prototype.changed = Gt.prototype.s;
    Gt.prototype.dispatchEvent = Gt.prototype.b;
    Gt.prototype.getRevision = Gt.prototype.L;
    Gt.prototype.on = Gt.prototype.J;
    Gt.prototype.once = Gt.prototype.once;
    Gt.prototype.un = Gt.prototype.K;
    Xv.prototype.getAttributions = Xv.prototype.xa;
    Xv.prototype.getLogo = Xv.prototype.wa;
    Xv.prototype.getProjection = Xv.prototype.ya;
    Xv.prototype.getState = Xv.prototype.V;
    Xv.prototype.refresh = Xv.prototype.va;
    Xv.prototype.setAttributions = Xv.prototype.ua;
    Xv.prototype.get = Xv.prototype.get;
    Xv.prototype.getKeys = Xv.prototype.O;
    Xv.prototype.getProperties = Xv.prototype.N;
    Xv.prototype.set = Xv.prototype.set;
    Xv.prototype.setProperties = Xv.prototype.H;
    Xv.prototype.unset = Xv.prototype.P;
    Xv.prototype.changed = Xv.prototype.s;
    Xv.prototype.dispatchEvent = Xv.prototype.b;
    Xv.prototype.getRevision = Xv.prototype.L;
    Xv.prototype.on = Xv.prototype.J;
    Xv.prototype.once = Xv.prototype.once;
    Xv.prototype.un = Xv.prototype.K;
    aw.prototype.getTileGrid = aw.prototype.ab;
    aw.prototype.refresh = aw.prototype.va;
    aw.prototype.getAttributions = aw.prototype.xa;
    aw.prototype.getLogo = aw.prototype.wa;
    aw.prototype.getProjection = aw.prototype.ya;
    aw.prototype.getState = aw.prototype.V;
    aw.prototype.setAttributions = aw.prototype.ua;
    aw.prototype.get = aw.prototype.get;
    aw.prototype.getKeys = aw.prototype.O;
    aw.prototype.getProperties = aw.prototype.N;
    aw.prototype.set = aw.prototype.set;
    aw.prototype.setProperties = aw.prototype.H;
    aw.prototype.unset = aw.prototype.P;
    aw.prototype.changed = aw.prototype.s;
    aw.prototype.dispatchEvent = aw.prototype.b;
    aw.prototype.getRevision = aw.prototype.L;
    aw.prototype.on = aw.prototype.J;
    aw.prototype.once = aw.prototype.once;
    aw.prototype.un = aw.prototype.K;
    W.prototype.getTileLoadFunction = W.prototype.ob;
    W.prototype.getTileUrlFunction = W.prototype.qb;
    W.prototype.getUrls = W.prototype.rb;
    W.prototype.setTileLoadFunction = W.prototype.xb;
    W.prototype.setTileUrlFunction = W.prototype.bb;
    W.prototype.setUrl = W.prototype.jb;
    W.prototype.setUrls = W.prototype.cb;
    W.prototype.getTileGrid = W.prototype.ab;
    W.prototype.refresh = W.prototype.va;
    W.prototype.getAttributions = W.prototype.xa;
    W.prototype.getLogo = W.prototype.wa;
    W.prototype.getProjection = W.prototype.ya;
    W.prototype.getState = W.prototype.V;
    W.prototype.setAttributions = W.prototype.ua;
    W.prototype.get = W.prototype.get;
    W.prototype.getKeys = W.prototype.O;
    W.prototype.getProperties = W.prototype.N;
    W.prototype.set = W.prototype.set;
    W.prototype.setProperties = W.prototype.H;
    W.prototype.unset = W.prototype.P;
    W.prototype.changed = W.prototype.s;
    W.prototype.dispatchEvent = W.prototype.b;
    W.prototype.getRevision = W.prototype.L;
    W.prototype.on = W.prototype.J;
    W.prototype.once = W.prototype.once;
    W.prototype.un = W.prototype.K;
    ew.prototype.setRenderReprojectionEdges = ew.prototype.Nb;
    ew.prototype.setTileGridForProjection = ew.prototype.Ob;
    ew.prototype.getTileLoadFunction = ew.prototype.ob;
    ew.prototype.getTileUrlFunction = ew.prototype.qb;
    ew.prototype.getUrls = ew.prototype.rb;
    ew.prototype.setTileLoadFunction = ew.prototype.xb;
    ew.prototype.setTileUrlFunction = ew.prototype.bb;
    ew.prototype.setUrl = ew.prototype.jb;
    ew.prototype.setUrls = ew.prototype.cb;
    ew.prototype.getTileGrid = ew.prototype.ab;
    ew.prototype.refresh = ew.prototype.va;
    ew.prototype.getAttributions = ew.prototype.xa;
    ew.prototype.getLogo = ew.prototype.wa;
    ew.prototype.getProjection = ew.prototype.ya;
    ew.prototype.getState = ew.prototype.V;
    ew.prototype.setAttributions = ew.prototype.ua;
    ew.prototype.get = ew.prototype.get;
    ew.prototype.getKeys = ew.prototype.O;
    ew.prototype.getProperties = ew.prototype.N;
    ew.prototype.set = ew.prototype.set;
    ew.prototype.setProperties = ew.prototype.H;
    ew.prototype.unset = ew.prototype.P;
    ew.prototype.changed = ew.prototype.s;
    ew.prototype.dispatchEvent = ew.prototype.b;
    ew.prototype.getRevision = ew.prototype.L;
    ew.prototype.on = ew.prototype.J;
    ew.prototype.once = ew.prototype.once;
    ew.prototype.un = ew.prototype.K;
    gw.prototype.setRenderReprojectionEdges = gw.prototype.Nb;
    gw.prototype.setTileGridForProjection = gw.prototype.Ob;
    gw.prototype.getTileLoadFunction = gw.prototype.ob;
    gw.prototype.getTileUrlFunction = gw.prototype.qb;
    gw.prototype.getUrls = gw.prototype.rb;
    gw.prototype.setTileLoadFunction = gw.prototype.xb;
    gw.prototype.setTileUrlFunction = gw.prototype.bb;
    gw.prototype.setUrl = gw.prototype.jb;
    gw.prototype.setUrls = gw.prototype.cb;
    gw.prototype.getTileGrid = gw.prototype.ab;
    gw.prototype.refresh = gw.prototype.va;
    gw.prototype.getAttributions = gw.prototype.xa;
    gw.prototype.getLogo = gw.prototype.wa;
    gw.prototype.getProjection = gw.prototype.ya;
    gw.prototype.getState = gw.prototype.V;
    gw.prototype.setAttributions = gw.prototype.ua;
    gw.prototype.get = gw.prototype.get;
    gw.prototype.getKeys = gw.prototype.O;
    gw.prototype.getProperties = gw.prototype.N;
    gw.prototype.set = gw.prototype.set;
    gw.prototype.setProperties = gw.prototype.H;
    gw.prototype.unset = gw.prototype.P;
    gw.prototype.changed = gw.prototype.s;
    gw.prototype.dispatchEvent = gw.prototype.b;
    gw.prototype.getRevision = gw.prototype.L;
    gw.prototype.on = gw.prototype.J;
    gw.prototype.once = gw.prototype.once;
    gw.prototype.un = gw.prototype.K;
    hw.prototype.setRenderReprojectionEdges = hw.prototype.Nb;
    hw.prototype.setTileGridForProjection = hw.prototype.Ob;
    hw.prototype.getTileLoadFunction = hw.prototype.ob;
    hw.prototype.getTileUrlFunction = hw.prototype.qb;
    hw.prototype.getUrls = hw.prototype.rb;
    hw.prototype.setTileLoadFunction = hw.prototype.xb;
    hw.prototype.setTileUrlFunction = hw.prototype.bb;
    hw.prototype.setUrl = hw.prototype.jb;
    hw.prototype.setUrls = hw.prototype.cb;
    hw.prototype.getTileGrid = hw.prototype.ab;
    hw.prototype.refresh = hw.prototype.va;
    hw.prototype.getAttributions = hw.prototype.xa;
    hw.prototype.getLogo = hw.prototype.wa;
    hw.prototype.getProjection = hw.prototype.ya;
    hw.prototype.getState = hw.prototype.V;
    hw.prototype.setAttributions = hw.prototype.ua;
    hw.prototype.get = hw.prototype.get;
    hw.prototype.getKeys = hw.prototype.O;
    hw.prototype.getProperties = hw.prototype.N;
    hw.prototype.set = hw.prototype.set;
    hw.prototype.setProperties = hw.prototype.H;
    hw.prototype.unset = hw.prototype.P;
    hw.prototype.changed = hw.prototype.s;
    hw.prototype.dispatchEvent = hw.prototype.b;
    hw.prototype.getRevision = hw.prototype.L;
    hw.prototype.on = hw.prototype.J;
    hw.prototype.once = hw.prototype.once;
    hw.prototype.un = hw.prototype.K;
    S.prototype.getAttributions = S.prototype.xa;
    S.prototype.getLogo = S.prototype.wa;
    S.prototype.getProjection = S.prototype.ya;
    S.prototype.getState = S.prototype.V;
    S.prototype.refresh = S.prototype.va;
    S.prototype.setAttributions = S.prototype.ua;
    S.prototype.get = S.prototype.get;
    S.prototype.getKeys = S.prototype.O;
    S.prototype.getProperties = S.prototype.N;
    S.prototype.set = S.prototype.set;
    S.prototype.setProperties = S.prototype.H;
    S.prototype.unset = S.prototype.P;
    S.prototype.changed = S.prototype.s;
    S.prototype.dispatchEvent = S.prototype.b;
    S.prototype.getRevision = S.prototype.L;
    S.prototype.on = S.prototype.J;
    S.prototype.once = S.prototype.once;
    S.prototype.un = S.prototype.K;
    X.prototype.addFeature = X.prototype.zb;
    X.prototype.addFeatures = X.prototype.dd;
    X.prototype.clear = X.prototype.clear;
    X.prototype.forEachFeature = X.prototype.bh;
    X.prototype.forEachFeatureInExtent = X.prototype.ac;
    X.prototype.forEachFeatureIntersectingExtent = X.prototype.dh;
    X.prototype.getFeaturesCollection = X.prototype.lh;
    X.prototype.getFeatures = X.prototype.Ne;
    X.prototype.getFeaturesAtCoordinate = X.prototype.kh;
    X.prototype.getFeaturesInExtent = X.prototype.Hf;
    X.prototype.getClosestFeatureToCoordinate = X.prototype.gh;
    X.prototype.getExtent = X.prototype.D;
    X.prototype.getFeatureById = X.prototype.jh;
    X.prototype.getFormat = X.prototype.hi;
    X.prototype.getUrl = X.prototype.ii;
    X.prototype.removeFeature = X.prototype.Db;
    X.prototype.getAttributions = X.prototype.xa;
    X.prototype.getLogo = X.prototype.wa;
    X.prototype.getProjection = X.prototype.ya;
    X.prototype.getState = X.prototype.V;
    X.prototype.refresh = X.prototype.va;
    X.prototype.setAttributions = X.prototype.ua;
    X.prototype.get = X.prototype.get;
    X.prototype.getKeys = X.prototype.O;
    X.prototype.getProperties = X.prototype.N;
    X.prototype.set = X.prototype.set;
    X.prototype.setProperties = X.prototype.H;
    X.prototype.unset = X.prototype.P;
    X.prototype.changed = X.prototype.s;
    X.prototype.dispatchEvent = X.prototype.b;
    X.prototype.getRevision = X.prototype.L;
    X.prototype.on = X.prototype.J;
    X.prototype.once = X.prototype.once;
    X.prototype.un = X.prototype.K;
    lv.prototype.getAttributions = lv.prototype.xa;
    lv.prototype.getLogo = lv.prototype.wa;
    lv.prototype.getProjection = lv.prototype.ya;
    lv.prototype.getState = lv.prototype.V;
    lv.prototype.refresh = lv.prototype.va;
    lv.prototype.setAttributions = lv.prototype.ua;
    lv.prototype.get = lv.prototype.get;
    lv.prototype.getKeys = lv.prototype.O;
    lv.prototype.getProperties = lv.prototype.N;
    lv.prototype.set = lv.prototype.set;
    lv.prototype.setProperties = lv.prototype.H;
    lv.prototype.unset = lv.prototype.P;
    lv.prototype.changed = lv.prototype.s;
    lv.prototype.dispatchEvent = lv.prototype.b;
    lv.prototype.getRevision = lv.prototype.L;
    lv.prototype.on = lv.prototype.J;
    lv.prototype.once = lv.prototype.once;
    lv.prototype.un = lv.prototype.K;
    nv.prototype.type = nv.prototype.type;
    nv.prototype.target = nv.prototype.target;
    nv.prototype.preventDefault = nv.prototype.preventDefault;
    nv.prototype.stopPropagation = nv.prototype.stopPropagation;
    nw.prototype.getAttributions = nw.prototype.xa;
    nw.prototype.getLogo = nw.prototype.wa;
    nw.prototype.getProjection = nw.prototype.ya;
    nw.prototype.getState = nw.prototype.V;
    nw.prototype.refresh = nw.prototype.va;
    nw.prototype.setAttributions = nw.prototype.ua;
    nw.prototype.get = nw.prototype.get;
    nw.prototype.getKeys = nw.prototype.O;
    nw.prototype.getProperties = nw.prototype.N;
    nw.prototype.set = nw.prototype.set;
    nw.prototype.setProperties = nw.prototype.H;
    nw.prototype.unset = nw.prototype.P;
    nw.prototype.changed = nw.prototype.s;
    nw.prototype.dispatchEvent = nw.prototype.b;
    nw.prototype.getRevision = nw.prototype.L;
    nw.prototype.on = nw.prototype.J;
    nw.prototype.once = nw.prototype.once;
    nw.prototype.un = nw.prototype.K;
    sv.prototype.getAttributions = sv.prototype.xa;
    sv.prototype.getLogo = sv.prototype.wa;
    sv.prototype.getProjection = sv.prototype.ya;
    sv.prototype.getState = sv.prototype.V;
    sv.prototype.refresh = sv.prototype.va;
    sv.prototype.setAttributions = sv.prototype.ua;
    sv.prototype.get = sv.prototype.get;
    sv.prototype.getKeys = sv.prototype.O;
    sv.prototype.getProperties = sv.prototype.N;
    sv.prototype.set = sv.prototype.set;
    sv.prototype.setProperties = sv.prototype.H;
    sv.prototype.unset = sv.prototype.P;
    sv.prototype.changed = sv.prototype.s;
    sv.prototype.dispatchEvent = sv.prototype.b;
    sv.prototype.getRevision = sv.prototype.L;
    sv.prototype.on = sv.prototype.J;
    sv.prototype.once = sv.prototype.once;
    sv.prototype.un = sv.prototype.K;
    ow.prototype.getAttributions = ow.prototype.xa;
    ow.prototype.getLogo = ow.prototype.wa;
    ow.prototype.getProjection = ow.prototype.ya;
    ow.prototype.getState = ow.prototype.V;
    ow.prototype.refresh = ow.prototype.va;
    ow.prototype.setAttributions = ow.prototype.ua;
    ow.prototype.get = ow.prototype.get;
    ow.prototype.getKeys = ow.prototype.O;
    ow.prototype.getProperties = ow.prototype.N;
    ow.prototype.set = ow.prototype.set;
    ow.prototype.setProperties = ow.prototype.H;
    ow.prototype.unset = ow.prototype.P;
    ow.prototype.changed = ow.prototype.s;
    ow.prototype.dispatchEvent = ow.prototype.b;
    ow.prototype.getRevision = ow.prototype.L;
    ow.prototype.on = ow.prototype.J;
    ow.prototype.once = ow.prototype.once;
    ow.prototype.un = ow.prototype.K;
    pw.prototype.getAttributions = pw.prototype.xa;
    pw.prototype.getLogo = pw.prototype.wa;
    pw.prototype.getProjection = pw.prototype.ya;
    pw.prototype.getState = pw.prototype.V;
    pw.prototype.refresh = pw.prototype.va;
    pw.prototype.setAttributions = pw.prototype.ua;
    pw.prototype.get = pw.prototype.get;
    pw.prototype.getKeys = pw.prototype.O;
    pw.prototype.getProperties = pw.prototype.N;
    pw.prototype.set = pw.prototype.set;
    pw.prototype.setProperties = pw.prototype.H;
    pw.prototype.unset = pw.prototype.P;
    pw.prototype.changed = pw.prototype.s;
    pw.prototype.dispatchEvent = pw.prototype.b;
    pw.prototype.getRevision = pw.prototype.L;
    pw.prototype.on = pw.prototype.J;
    pw.prototype.once = pw.prototype.once;
    pw.prototype.un = pw.prototype.K;
    tv.prototype.getAttributions = tv.prototype.xa;
    tv.prototype.getLogo = tv.prototype.wa;
    tv.prototype.getProjection = tv.prototype.ya;
    tv.prototype.getState = tv.prototype.V;
    tv.prototype.refresh = tv.prototype.va;
    tv.prototype.setAttributions = tv.prototype.ua;
    tv.prototype.get = tv.prototype.get;
    tv.prototype.getKeys = tv.prototype.O;
    tv.prototype.getProperties = tv.prototype.N;
    tv.prototype.set = tv.prototype.set;
    tv.prototype.setProperties = tv.prototype.H;
    tv.prototype.unset = tv.prototype.P;
    tv.prototype.changed = tv.prototype.s;
    tv.prototype.dispatchEvent = tv.prototype.b;
    tv.prototype.getRevision = tv.prototype.L;
    tv.prototype.on = tv.prototype.J;
    tv.prototype.once = tv.prototype.once;
    tv.prototype.un = tv.prototype.K;
    qw.prototype.getAttributions = qw.prototype.xa;
    qw.prototype.getLogo = qw.prototype.wa;
    qw.prototype.getProjection = qw.prototype.ya;
    qw.prototype.getState = qw.prototype.V;
    qw.prototype.refresh = qw.prototype.va;
    qw.prototype.setAttributions = qw.prototype.ua;
    qw.prototype.get = qw.prototype.get;
    qw.prototype.getKeys = qw.prototype.O;
    qw.prototype.getProperties = qw.prototype.N;
    qw.prototype.set = qw.prototype.set;
    qw.prototype.setProperties = qw.prototype.H;
    qw.prototype.unset = qw.prototype.P;
    qw.prototype.changed = qw.prototype.s;
    qw.prototype.dispatchEvent = qw.prototype.b;
    qw.prototype.getRevision = qw.prototype.L;
    qw.prototype.on = qw.prototype.J;
    qw.prototype.once = qw.prototype.once;
    qw.prototype.un = qw.prototype.K;
    uw.prototype.setRenderReprojectionEdges = uw.prototype.Nb;
    uw.prototype.setTileGridForProjection = uw.prototype.Ob;
    uw.prototype.getTileLoadFunction = uw.prototype.ob;
    uw.prototype.getTileUrlFunction = uw.prototype.qb;
    uw.prototype.getUrls = uw.prototype.rb;
    uw.prototype.setTileLoadFunction = uw.prototype.xb;
    uw.prototype.setTileUrlFunction = uw.prototype.bb;
    uw.prototype.setUrl = uw.prototype.jb;
    uw.prototype.setUrls = uw.prototype.cb;
    uw.prototype.getTileGrid = uw.prototype.ab;
    uw.prototype.refresh = uw.prototype.va;
    uw.prototype.getAttributions = uw.prototype.xa;
    uw.prototype.getLogo = uw.prototype.wa;
    uw.prototype.getProjection = uw.prototype.ya;
    uw.prototype.getState = uw.prototype.V;
    uw.prototype.setAttributions = uw.prototype.ua;
    uw.prototype.get = uw.prototype.get;
    uw.prototype.getKeys = uw.prototype.O;
    uw.prototype.getProperties = uw.prototype.N;
    uw.prototype.set = uw.prototype.set;
    uw.prototype.setProperties = uw.prototype.H;
    uw.prototype.unset = uw.prototype.P;
    uw.prototype.changed = uw.prototype.s;
    uw.prototype.dispatchEvent = uw.prototype.b;
    uw.prototype.getRevision = uw.prototype.L;
    uw.prototype.on = uw.prototype.J;
    uw.prototype.once = uw.prototype.once;
    uw.prototype.un = uw.prototype.K;
    ww.prototype.getAttributions = ww.prototype.xa;
    ww.prototype.getLogo = ww.prototype.wa;
    ww.prototype.getProjection = ww.prototype.ya;
    ww.prototype.getState = ww.prototype.V;
    ww.prototype.refresh = ww.prototype.va;
    ww.prototype.setAttributions = ww.prototype.ua;
    ww.prototype.get = ww.prototype.get;
    ww.prototype.getKeys = ww.prototype.O;
    ww.prototype.getProperties = ww.prototype.N;
    ww.prototype.set = ww.prototype.set;
    ww.prototype.setProperties = ww.prototype.H;
    ww.prototype.unset = ww.prototype.P;
    ww.prototype.changed = ww.prototype.s;
    ww.prototype.dispatchEvent = ww.prototype.b;
    ww.prototype.getRevision = ww.prototype.L;
    ww.prototype.on = ww.prototype.J;
    ww.prototype.once = ww.prototype.once;
    ww.prototype.un = ww.prototype.K;
    Bw.prototype.type = Bw.prototype.type;
    Bw.prototype.target = Bw.prototype.target;
    Bw.prototype.preventDefault = Bw.prototype.preventDefault;
    Bw.prototype.stopPropagation = Bw.prototype.stopPropagation;
    Ew.prototype.setRenderReprojectionEdges = Ew.prototype.Nb;
    Ew.prototype.setTileGridForProjection = Ew.prototype.Ob;
    Ew.prototype.getTileLoadFunction = Ew.prototype.ob;
    Ew.prototype.getTileUrlFunction = Ew.prototype.qb;
    Ew.prototype.getUrls = Ew.prototype.rb;
    Ew.prototype.setTileLoadFunction = Ew.prototype.xb;
    Ew.prototype.setTileUrlFunction = Ew.prototype.bb;
    Ew.prototype.setUrl = Ew.prototype.jb;
    Ew.prototype.setUrls = Ew.prototype.cb;
    Ew.prototype.getTileGrid = Ew.prototype.ab;
    Ew.prototype.refresh = Ew.prototype.va;
    Ew.prototype.getAttributions = Ew.prototype.xa;
    Ew.prototype.getLogo = Ew.prototype.wa;
    Ew.prototype.getProjection = Ew.prototype.ya;
    Ew.prototype.getState = Ew.prototype.V;
    Ew.prototype.setAttributions = Ew.prototype.ua;
    Ew.prototype.get = Ew.prototype.get;
    Ew.prototype.getKeys = Ew.prototype.O;
    Ew.prototype.getProperties = Ew.prototype.N;
    Ew.prototype.set = Ew.prototype.set;
    Ew.prototype.setProperties = Ew.prototype.H;
    Ew.prototype.unset = Ew.prototype.P;
    Ew.prototype.changed = Ew.prototype.s;
    Ew.prototype.dispatchEvent = Ew.prototype.b;
    Ew.prototype.getRevision = Ew.prototype.L;
    Ew.prototype.on = Ew.prototype.J;
    Ew.prototype.once = Ew.prototype.once;
    Ew.prototype.un = Ew.prototype.K;
    $v.prototype.type = $v.prototype.type;
    $v.prototype.target = $v.prototype.target;
    $v.prototype.preventDefault = $v.prototype.preventDefault;
    $v.prototype.stopPropagation = $v.prototype.stopPropagation;
    Iw.prototype.setRenderReprojectionEdges = Iw.prototype.Nb;
    Iw.prototype.setTileGridForProjection = Iw.prototype.Ob;
    Iw.prototype.getTileLoadFunction = Iw.prototype.ob;
    Iw.prototype.getTileUrlFunction = Iw.prototype.qb;
    Iw.prototype.getUrls = Iw.prototype.rb;
    Iw.prototype.setTileLoadFunction = Iw.prototype.xb;
    Iw.prototype.setTileUrlFunction = Iw.prototype.bb;
    Iw.prototype.setUrl = Iw.prototype.jb;
    Iw.prototype.setUrls = Iw.prototype.cb;
    Iw.prototype.getTileGrid = Iw.prototype.ab;
    Iw.prototype.refresh = Iw.prototype.va;
    Iw.prototype.getAttributions = Iw.prototype.xa;
    Iw.prototype.getLogo = Iw.prototype.wa;
    Iw.prototype.getProjection = Iw.prototype.ya;
    Iw.prototype.getState = Iw.prototype.V;
    Iw.prototype.setAttributions = Iw.prototype.ua;
    Iw.prototype.get = Iw.prototype.get;
    Iw.prototype.getKeys = Iw.prototype.O;
    Iw.prototype.getProperties = Iw.prototype.N;
    Iw.prototype.set = Iw.prototype.set;
    Iw.prototype.setProperties = Iw.prototype.H;
    Iw.prototype.unset = Iw.prototype.P;
    Iw.prototype.changed = Iw.prototype.s;
    Iw.prototype.dispatchEvent = Iw.prototype.b;
    Iw.prototype.getRevision = Iw.prototype.L;
    Iw.prototype.on = Iw.prototype.J;
    Iw.prototype.once = Iw.prototype.once;
    Iw.prototype.un = Iw.prototype.K;
    Kw.prototype.getTileGrid = Kw.prototype.ab;
    Kw.prototype.refresh = Kw.prototype.va;
    Kw.prototype.getAttributions = Kw.prototype.xa;
    Kw.prototype.getLogo = Kw.prototype.wa;
    Kw.prototype.getProjection = Kw.prototype.ya;
    Kw.prototype.getState = Kw.prototype.V;
    Kw.prototype.setAttributions = Kw.prototype.ua;
    Kw.prototype.get = Kw.prototype.get;
    Kw.prototype.getKeys = Kw.prototype.O;
    Kw.prototype.getProperties = Kw.prototype.N;
    Kw.prototype.set = Kw.prototype.set;
    Kw.prototype.setProperties = Kw.prototype.H;
    Kw.prototype.unset = Kw.prototype.P;
    Kw.prototype.changed = Kw.prototype.s;
    Kw.prototype.dispatchEvent = Kw.prototype.b;
    Kw.prototype.getRevision = Kw.prototype.L;
    Kw.prototype.on = Kw.prototype.J;
    Kw.prototype.once = Kw.prototype.once;
    Kw.prototype.un = Kw.prototype.K;
    Mw.prototype.setRenderReprojectionEdges = Mw.prototype.Nb;
    Mw.prototype.setTileGridForProjection = Mw.prototype.Ob;
    Mw.prototype.getTileLoadFunction = Mw.prototype.ob;
    Mw.prototype.getTileUrlFunction = Mw.prototype.qb;
    Mw.prototype.getUrls = Mw.prototype.rb;
    Mw.prototype.setTileLoadFunction = Mw.prototype.xb;
    Mw.prototype.setTileUrlFunction = Mw.prototype.bb;
    Mw.prototype.setUrl = Mw.prototype.jb;
    Mw.prototype.setUrls = Mw.prototype.cb;
    Mw.prototype.getTileGrid = Mw.prototype.ab;
    Mw.prototype.refresh = Mw.prototype.va;
    Mw.prototype.getAttributions = Mw.prototype.xa;
    Mw.prototype.getLogo = Mw.prototype.wa;
    Mw.prototype.getProjection = Mw.prototype.ya;
    Mw.prototype.getState = Mw.prototype.V;
    Mw.prototype.setAttributions = Mw.prototype.ua;
    Mw.prototype.get = Mw.prototype.get;
    Mw.prototype.getKeys = Mw.prototype.O;
    Mw.prototype.getProperties = Mw.prototype.N;
    Mw.prototype.set = Mw.prototype.set;
    Mw.prototype.setProperties = Mw.prototype.H;
    Mw.prototype.unset = Mw.prototype.P;
    Mw.prototype.changed = Mw.prototype.s;
    Mw.prototype.dispatchEvent = Mw.prototype.b;
    Mw.prototype.getRevision = Mw.prototype.L;
    Mw.prototype.on = Mw.prototype.J;
    Mw.prototype.once = Mw.prototype.once;
    Mw.prototype.un = Mw.prototype.K;
    Nw.prototype.getTileGrid = Nw.prototype.ab;
    Nw.prototype.refresh = Nw.prototype.va;
    Nw.prototype.getAttributions = Nw.prototype.xa;
    Nw.prototype.getLogo = Nw.prototype.wa;
    Nw.prototype.getProjection = Nw.prototype.ya;
    Nw.prototype.getState = Nw.prototype.V;
    Nw.prototype.setAttributions = Nw.prototype.ua;
    Nw.prototype.get = Nw.prototype.get;
    Nw.prototype.getKeys = Nw.prototype.O;
    Nw.prototype.getProperties = Nw.prototype.N;
    Nw.prototype.set = Nw.prototype.set;
    Nw.prototype.setProperties = Nw.prototype.H;
    Nw.prototype.unset = Nw.prototype.P;
    Nw.prototype.changed = Nw.prototype.s;
    Nw.prototype.dispatchEvent = Nw.prototype.b;
    Nw.prototype.getRevision = Nw.prototype.L;
    Nw.prototype.on = Nw.prototype.J;
    Nw.prototype.once = Nw.prototype.once;
    Nw.prototype.un = Nw.prototype.K;
    Rw.prototype.setRenderReprojectionEdges = Rw.prototype.Nb;
    Rw.prototype.setTileGridForProjection = Rw.prototype.Ob;
    Rw.prototype.getTileLoadFunction = Rw.prototype.ob;
    Rw.prototype.getTileUrlFunction = Rw.prototype.qb;
    Rw.prototype.getUrls = Rw.prototype.rb;
    Rw.prototype.setTileLoadFunction = Rw.prototype.xb;
    Rw.prototype.setTileUrlFunction = Rw.prototype.bb;
    Rw.prototype.setUrl = Rw.prototype.jb;
    Rw.prototype.setUrls = Rw.prototype.cb;
    Rw.prototype.getTileGrid = Rw.prototype.ab;
    Rw.prototype.refresh = Rw.prototype.va;
    Rw.prototype.getAttributions = Rw.prototype.xa;
    Rw.prototype.getLogo = Rw.prototype.wa;
    Rw.prototype.getProjection = Rw.prototype.ya;
    Rw.prototype.getState = Rw.prototype.V;
    Rw.prototype.setAttributions = Rw.prototype.ua;
    Rw.prototype.get = Rw.prototype.get;
    Rw.prototype.getKeys = Rw.prototype.O;
    Rw.prototype.getProperties = Rw.prototype.N;
    Rw.prototype.set = Rw.prototype.set;
    Rw.prototype.setProperties = Rw.prototype.H;
    Rw.prototype.unset = Rw.prototype.P;
    Rw.prototype.changed = Rw.prototype.s;
    Rw.prototype.dispatchEvent = Rw.prototype.b;
    Rw.prototype.getRevision = Rw.prototype.L;
    Rw.prototype.on = Rw.prototype.J;
    Rw.prototype.once = Rw.prototype.once;
    Rw.prototype.un = Rw.prototype.K;
    Nt.prototype.type = Nt.prototype.type;
    Nt.prototype.target = Nt.prototype.target;
    Nt.prototype.preventDefault = Nt.prototype.preventDefault;
    Nt.prototype.stopPropagation = Nt.prototype.stopPropagation;
    Yw.prototype.getTileLoadFunction = Yw.prototype.ob;
    Yw.prototype.getTileUrlFunction = Yw.prototype.qb;
    Yw.prototype.getUrls = Yw.prototype.rb;
    Yw.prototype.setTileLoadFunction = Yw.prototype.xb;
    Yw.prototype.setTileUrlFunction = Yw.prototype.bb;
    Yw.prototype.setUrl = Yw.prototype.jb;
    Yw.prototype.setUrls = Yw.prototype.cb;
    Yw.prototype.getTileGrid = Yw.prototype.ab;
    Yw.prototype.refresh = Yw.prototype.va;
    Yw.prototype.getAttributions = Yw.prototype.xa;
    Yw.prototype.getLogo = Yw.prototype.wa;
    Yw.prototype.getProjection = Yw.prototype.ya;
    Yw.prototype.getState = Yw.prototype.V;
    Yw.prototype.setAttributions = Yw.prototype.ua;
    Yw.prototype.get = Yw.prototype.get;
    Yw.prototype.getKeys = Yw.prototype.O;
    Yw.prototype.getProperties = Yw.prototype.N;
    Yw.prototype.set = Yw.prototype.set;
    Yw.prototype.setProperties = Yw.prototype.H;
    Yw.prototype.unset = Yw.prototype.P;
    Yw.prototype.changed = Yw.prototype.s;
    Yw.prototype.dispatchEvent = Yw.prototype.b;
    Yw.prototype.getRevision = Yw.prototype.L;
    Yw.prototype.on = Yw.prototype.J;
    Yw.prototype.once = Yw.prototype.once;
    Yw.prototype.un = Yw.prototype.K;
    Y.prototype.setRenderReprojectionEdges = Y.prototype.Nb;
    Y.prototype.setTileGridForProjection = Y.prototype.Ob;
    Y.prototype.getTileLoadFunction = Y.prototype.ob;
    Y.prototype.getTileUrlFunction = Y.prototype.qb;
    Y.prototype.getUrls = Y.prototype.rb;
    Y.prototype.setTileLoadFunction = Y.prototype.xb;
    Y.prototype.setTileUrlFunction = Y.prototype.bb;
    Y.prototype.setUrl = Y.prototype.jb;
    Y.prototype.setUrls = Y.prototype.cb;
    Y.prototype.getTileGrid = Y.prototype.ab;
    Y.prototype.refresh = Y.prototype.va;
    Y.prototype.getAttributions = Y.prototype.xa;
    Y.prototype.getLogo = Y.prototype.wa;
    Y.prototype.getProjection = Y.prototype.ya;
    Y.prototype.getState = Y.prototype.V;
    Y.prototype.setAttributions = Y.prototype.ua;
    Y.prototype.get = Y.prototype.get;
    Y.prototype.getKeys = Y.prototype.O;
    Y.prototype.getProperties = Y.prototype.N;
    Y.prototype.set = Y.prototype.set;
    Y.prototype.setProperties = Y.prototype.H;
    Y.prototype.unset = Y.prototype.P;
    Y.prototype.changed = Y.prototype.s;
    Y.prototype.dispatchEvent = Y.prototype.b;
    Y.prototype.getRevision = Y.prototype.L;
    Y.prototype.on = Y.prototype.J;
    Y.prototype.once = Y.prototype.once;
    Y.prototype.un = Y.prototype.K;
    bx.prototype.setRenderReprojectionEdges = bx.prototype.Nb;
    bx.prototype.setTileGridForProjection = bx.prototype.Ob;
    bx.prototype.getTileLoadFunction = bx.prototype.ob;
    bx.prototype.getTileUrlFunction = bx.prototype.qb;
    bx.prototype.getUrls = bx.prototype.rb;
    bx.prototype.setTileLoadFunction = bx.prototype.xb;
    bx.prototype.setTileUrlFunction = bx.prototype.bb;
    bx.prototype.setUrl = bx.prototype.jb;
    bx.prototype.setUrls = bx.prototype.cb;
    bx.prototype.getTileGrid = bx.prototype.ab;
    bx.prototype.refresh = bx.prototype.va;
    bx.prototype.getAttributions = bx.prototype.xa;
    bx.prototype.getLogo = bx.prototype.wa;
    bx.prototype.getProjection = bx.prototype.ya;
    bx.prototype.getState = bx.prototype.V;
    bx.prototype.setAttributions = bx.prototype.ua;
    bx.prototype.get = bx.prototype.get;
    bx.prototype.getKeys = bx.prototype.O;
    bx.prototype.getProperties = bx.prototype.N;
    bx.prototype.set = bx.prototype.set;
    bx.prototype.setProperties = bx.prototype.H;
    bx.prototype.unset = bx.prototype.P;
    bx.prototype.changed = bx.prototype.s;
    bx.prototype.dispatchEvent = bx.prototype.b;
    bx.prototype.getRevision = bx.prototype.L;
    bx.prototype.on = bx.prototype.J;
    bx.prototype.once = bx.prototype.once;
    bx.prototype.un = bx.prototype.K;
    Pv.prototype.getTileCoord = Pv.prototype.i;
    Pv.prototype.load = Pv.prototype.load;
    dt.prototype.changed = dt.prototype.s;
    dt.prototype.dispatchEvent = dt.prototype.b;
    dt.prototype.getRevision = dt.prototype.L;
    dt.prototype.on = dt.prototype.J;
    dt.prototype.once = dt.prototype.once;
    dt.prototype.un = dt.prototype.K;
    Bt.prototype.changed = Bt.prototype.s;
    Bt.prototype.dispatchEvent = Bt.prototype.b;
    Bt.prototype.getRevision = Bt.prototype.L;
    Bt.prototype.on = Bt.prototype.J;
    Bt.prototype.once = Bt.prototype.once;
    Bt.prototype.un = Bt.prototype.K;
    vv.prototype.changed = vv.prototype.s;
    vv.prototype.dispatchEvent = vv.prototype.b;
    vv.prototype.getRevision = vv.prototype.L;
    vv.prototype.on = vv.prototype.J;
    vv.prototype.once = vv.prototype.once;
    vv.prototype.un = vv.prototype.K;
    Gv.prototype.changed = Gv.prototype.s;
    Gv.prototype.dispatchEvent = Gv.prototype.b;
    Gv.prototype.getRevision = Gv.prototype.L;
    Gv.prototype.on = Gv.prototype.J;
    Gv.prototype.once = Gv.prototype.once;
    Gv.prototype.un = Gv.prototype.K;
    Et.prototype.changed = Et.prototype.s;
    Et.prototype.dispatchEvent = Et.prototype.b;
    Et.prototype.getRevision = Et.prototype.L;
    Et.prototype.on = Et.prototype.J;
    Et.prototype.once = Et.prototype.once;
    Et.prototype.un = Et.prototype.K;
    mt.prototype.changed = mt.prototype.s;
    mt.prototype.dispatchEvent = mt.prototype.b;
    mt.prototype.getRevision = mt.prototype.L;
    mt.prototype.on = mt.prototype.J;
    mt.prototype.once = mt.prototype.once;
    mt.prototype.un = mt.prototype.K;
    cv.prototype.changed = cv.prototype.s;
    cv.prototype.dispatchEvent = cv.prototype.b;
    cv.prototype.getRevision = cv.prototype.L;
    cv.prototype.on = cv.prototype.J;
    cv.prototype.once = cv.prototype.once;
    cv.prototype.un = cv.prototype.K;
    dv.prototype.changed = dv.prototype.s;
    dv.prototype.dispatchEvent = dv.prototype.b;
    dv.prototype.getRevision = dv.prototype.L;
    dv.prototype.on = dv.prototype.J;
    dv.prototype.once = dv.prototype.once;
    dv.prototype.un = dv.prototype.K;
    zv.prototype.changed = zv.prototype.s;
    zv.prototype.dispatchEvent = zv.prototype.b;
    zv.prototype.getRevision = zv.prototype.L;
    zv.prototype.on = zv.prototype.J;
    zv.prototype.once = zv.prototype.once;
    zv.prototype.un = zv.prototype.K;
    ut.prototype.changed = ut.prototype.s;
    ut.prototype.dispatchEvent = ut.prototype.b;
    ut.prototype.getRevision = ut.prototype.L;
    ut.prototype.on = ut.prototype.J;
    ut.prototype.once = ut.prototype.once;
    ut.prototype.un = ut.prototype.K;
    Iv.prototype.changed = Iv.prototype.s;
    Iv.prototype.dispatchEvent = Iv.prototype.b;
    Iv.prototype.getRevision = Iv.prototype.L;
    Iv.prototype.on = Iv.prototype.J;
    Iv.prototype.once = Iv.prototype.once;
    Iv.prototype.un = Iv.prototype.K;
    Mh.prototype.type = Mh.prototype.type;
    Mh.prototype.target = Mh.prototype.target;
    Mh.prototype.preventDefault = Mh.prototype.preventDefault;
    Mh.prototype.stopPropagation = Mh.prototype.stopPropagation;
    ge.prototype.type = ge.prototype.type;
    ge.prototype.target = ge.prototype.target;
    ge.prototype.preventDefault = ge.prototype.preventDefault;
    ge.prototype.stopPropagation = ge.prototype.stopPropagation;
    dh.prototype.get = dh.prototype.get;
    dh.prototype.getKeys = dh.prototype.O;
    dh.prototype.getProperties = dh.prototype.N;
    dh.prototype.set = dh.prototype.set;
    dh.prototype.setProperties = dh.prototype.H;
    dh.prototype.unset = dh.prototype.P;
    dh.prototype.changed = dh.prototype.s;
    dh.prototype.dispatchEvent = dh.prototype.b;
    dh.prototype.getRevision = dh.prototype.L;
    dh.prototype.on = dh.prototype.J;
    dh.prototype.once = dh.prototype.once;
    dh.prototype.un = dh.prototype.K;
    fh.prototype.getExtent = fh.prototype.D;
    fh.prototype.getMaxResolution = fh.prototype.gc;
    fh.prototype.getMinResolution = fh.prototype.hc;
    fh.prototype.getOpacity = fh.prototype.ic;
    fh.prototype.getVisible = fh.prototype.Kb;
    fh.prototype.getZIndex = fh.prototype.za;
    fh.prototype.setExtent = fh.prototype.uc;
    fh.prototype.setMaxResolution = fh.prototype.zc;
    fh.prototype.setMinResolution = fh.prototype.Ac;
    fh.prototype.setOpacity = fh.prototype.vc;
    fh.prototype.setVisible = fh.prototype.wc;
    fh.prototype.setZIndex = fh.prototype.Wb;
    fh.prototype.get = fh.prototype.get;
    fh.prototype.getKeys = fh.prototype.O;
    fh.prototype.getProperties = fh.prototype.N;
    fh.prototype.set = fh.prototype.set;
    fh.prototype.setProperties = fh.prototype.H;
    fh.prototype.unset = fh.prototype.P;
    fh.prototype.changed = fh.prototype.s;
    fh.prototype.dispatchEvent = fh.prototype.b;
    fh.prototype.getRevision = fh.prototype.L;
    fh.prototype.on = fh.prototype.J;
    fh.prototype.once = fh.prototype.once;
    fh.prototype.un = fh.prototype.K;
    rh.prototype.getExtent = rh.prototype.D;
    rh.prototype.getMaxResolution = rh.prototype.gc;
    rh.prototype.getMinResolution = rh.prototype.hc;
    rh.prototype.getOpacity = rh.prototype.ic;
    rh.prototype.getVisible = rh.prototype.Kb;
    rh.prototype.getZIndex = rh.prototype.za;
    rh.prototype.setExtent = rh.prototype.uc;
    rh.prototype.setMaxResolution = rh.prototype.zc;
    rh.prototype.setMinResolution = rh.prototype.Ac;
    rh.prototype.setOpacity = rh.prototype.vc;
    rh.prototype.setVisible = rh.prototype.wc;
    rh.prototype.setZIndex = rh.prototype.Wb;
    rh.prototype.get = rh.prototype.get;
    rh.prototype.getKeys = rh.prototype.O;
    rh.prototype.getProperties = rh.prototype.N;
    rh.prototype.set = rh.prototype.set;
    rh.prototype.setProperties = rh.prototype.H;
    rh.prototype.unset = rh.prototype.P;
    rh.prototype.changed = rh.prototype.s;
    rh.prototype.dispatchEvent = rh.prototype.b;
    rh.prototype.getRevision = rh.prototype.L;
    rh.prototype.on = rh.prototype.J;
    rh.prototype.once = rh.prototype.once;
    rh.prototype.un = rh.prototype.K;
    R.prototype.setMap = R.prototype.setMap;
    R.prototype.setSource = R.prototype.Yc;
    R.prototype.getExtent = R.prototype.D;
    R.prototype.getMaxResolution = R.prototype.gc;
    R.prototype.getMinResolution = R.prototype.hc;
    R.prototype.getOpacity = R.prototype.ic;
    R.prototype.getVisible = R.prototype.Kb;
    R.prototype.getZIndex = R.prototype.za;
    R.prototype.setExtent = R.prototype.uc;
    R.prototype.setMaxResolution = R.prototype.zc;
    R.prototype.setMinResolution = R.prototype.Ac;
    R.prototype.setOpacity = R.prototype.vc;
    R.prototype.setVisible = R.prototype.wc;
    R.prototype.setZIndex = R.prototype.Wb;
    R.prototype.get = R.prototype.get;
    R.prototype.getKeys = R.prototype.O;
    R.prototype.getProperties = R.prototype.N;
    R.prototype.set = R.prototype.set;
    R.prototype.setProperties = R.prototype.H;
    R.prototype.unset = R.prototype.P;
    R.prototype.changed = R.prototype.s;
    R.prototype.dispatchEvent = R.prototype.b;
    R.prototype.getRevision = R.prototype.L;
    R.prototype.on = R.prototype.J;
    R.prototype.once = R.prototype.once;
    R.prototype.un = R.prototype.K;
    T.prototype.getSource = T.prototype.la;
    T.prototype.getStyle = T.prototype.C;
    T.prototype.getStyleFunction = T.prototype.G;
    T.prototype.setStyle = T.prototype.g;
    T.prototype.setMap = T.prototype.setMap;
    T.prototype.setSource = T.prototype.Yc;
    T.prototype.getExtent = T.prototype.D;
    T.prototype.getMaxResolution = T.prototype.gc;
    T.prototype.getMinResolution = T.prototype.hc;
    T.prototype.getOpacity = T.prototype.ic;
    T.prototype.getVisible = T.prototype.Kb;
    T.prototype.getZIndex = T.prototype.za;
    T.prototype.setExtent = T.prototype.uc;
    T.prototype.setMaxResolution = T.prototype.zc;
    T.prototype.setMinResolution = T.prototype.Ac;
    T.prototype.setOpacity = T.prototype.vc;
    T.prototype.setVisible = T.prototype.wc;
    T.prototype.setZIndex = T.prototype.Wb;
    T.prototype.get = T.prototype.get;
    T.prototype.getKeys = T.prototype.O;
    T.prototype.getProperties = T.prototype.N;
    T.prototype.set = T.prototype.set;
    T.prototype.setProperties = T.prototype.H;
    T.prototype.unset = T.prototype.P;
    T.prototype.changed = T.prototype.s;
    T.prototype.dispatchEvent = T.prototype.b;
    T.prototype.getRevision = T.prototype.L;
    T.prototype.on = T.prototype.J;
    T.prototype.once = T.prototype.once;
    T.prototype.un = T.prototype.K;
    yv.prototype.setMap = yv.prototype.setMap;
    yv.prototype.setSource = yv.prototype.Yc;
    yv.prototype.getExtent = yv.prototype.D;
    yv.prototype.getMaxResolution = yv.prototype.gc;
    yv.prototype.getMinResolution = yv.prototype.hc;
    yv.prototype.getOpacity = yv.prototype.ic;
    yv.prototype.getVisible = yv.prototype.Kb;
    yv.prototype.getZIndex = yv.prototype.za;
    yv.prototype.setExtent = yv.prototype.uc;
    yv.prototype.setMaxResolution = yv.prototype.zc;
    yv.prototype.setMinResolution = yv.prototype.Ac;
    yv.prototype.setOpacity = yv.prototype.vc;
    yv.prototype.setVisible = yv.prototype.wc;
    yv.prototype.setZIndex = yv.prototype.Wb;
    yv.prototype.get = yv.prototype.get;
    yv.prototype.getKeys = yv.prototype.O;
    yv.prototype.getProperties = yv.prototype.N;
    yv.prototype.set = yv.prototype.set;
    yv.prototype.setProperties = yv.prototype.H;
    yv.prototype.unset = yv.prototype.P;
    yv.prototype.changed = yv.prototype.s;
    yv.prototype.dispatchEvent = yv.prototype.b;
    yv.prototype.getRevision = yv.prototype.L;
    yv.prototype.on = yv.prototype.J;
    yv.prototype.once = yv.prototype.once;
    yv.prototype.un = yv.prototype.K;
    Hv.prototype.setMap = Hv.prototype.setMap;
    Hv.prototype.setSource = Hv.prototype.Yc;
    Hv.prototype.getExtent = Hv.prototype.D;
    Hv.prototype.getMaxResolution = Hv.prototype.gc;
    Hv.prototype.getMinResolution = Hv.prototype.hc;
    Hv.prototype.getOpacity = Hv.prototype.ic;
    Hv.prototype.getVisible = Hv.prototype.Kb;
    Hv.prototype.getZIndex = Hv.prototype.za;
    Hv.prototype.setExtent = Hv.prototype.uc;
    Hv.prototype.setMaxResolution = Hv.prototype.zc;
    Hv.prototype.setMinResolution = Hv.prototype.Ac;
    Hv.prototype.setOpacity = Hv.prototype.vc;
    Hv.prototype.setVisible = Hv.prototype.wc;
    Hv.prototype.setZIndex = Hv.prototype.Wb;
    Hv.prototype.get = Hv.prototype.get;
    Hv.prototype.getKeys = Hv.prototype.O;
    Hv.prototype.getProperties = Hv.prototype.N;
    Hv.prototype.set = Hv.prototype.set;
    Hv.prototype.setProperties = Hv.prototype.H;
    Hv.prototype.unset = Hv.prototype.P;
    Hv.prototype.changed = Hv.prototype.s;
    Hv.prototype.dispatchEvent = Hv.prototype.b;
    Hv.prototype.getRevision = Hv.prototype.L;
    Hv.prototype.on = Hv.prototype.J;
    Hv.prototype.once = Hv.prototype.once;
    Hv.prototype.un = Hv.prototype.K;
    U.prototype.getSource = U.prototype.la;
    U.prototype.getStyle = U.prototype.C;
    U.prototype.getStyleFunction = U.prototype.G;
    U.prototype.setStyle = U.prototype.g;
    U.prototype.setMap = U.prototype.setMap;
    U.prototype.setSource = U.prototype.Yc;
    U.prototype.getExtent = U.prototype.D;
    U.prototype.getMaxResolution = U.prototype.gc;
    U.prototype.getMinResolution = U.prototype.hc;
    U.prototype.getOpacity = U.prototype.ic;
    U.prototype.getVisible = U.prototype.Kb;
    U.prototype.getZIndex = U.prototype.za;
    U.prototype.setExtent = U.prototype.uc;
    U.prototype.setMaxResolution = U.prototype.zc;
    U.prototype.setMinResolution = U.prototype.Ac;
    U.prototype.setOpacity = U.prototype.vc;
    U.prototype.setVisible = U.prototype.wc;
    U.prototype.setZIndex = U.prototype.Wb;
    U.prototype.get = U.prototype.get;
    U.prototype.getKeys = U.prototype.O;
    U.prototype.getProperties = U.prototype.N;
    U.prototype.set = U.prototype.set;
    U.prototype.setProperties = U.prototype.H;
    U.prototype.unset = U.prototype.P;
    U.prototype.changed = U.prototype.s;
    U.prototype.dispatchEvent = U.prototype.b;
    U.prototype.getRevision = U.prototype.L;
    U.prototype.on = U.prototype.J;
    U.prototype.once = U.prototype.once;
    U.prototype.un = U.prototype.K;
    ag.prototype.get = ag.prototype.get;
    ag.prototype.getKeys = ag.prototype.O;
    ag.prototype.getProperties = ag.prototype.N;
    ag.prototype.set = ag.prototype.set;
    ag.prototype.setProperties = ag.prototype.H;
    ag.prototype.unset = ag.prototype.P;
    ag.prototype.changed = ag.prototype.s;
    ag.prototype.dispatchEvent = ag.prototype.b;
    ag.prototype.getRevision = ag.prototype.L;
    ag.prototype.on = ag.prototype.J;
    ag.prototype.once = ag.prototype.once;
    ag.prototype.un = ag.prototype.K;
    eg.prototype.getActive = eg.prototype.c;
    eg.prototype.getMap = eg.prototype.i;
    eg.prototype.setActive = eg.prototype.Ia;
    eg.prototype.get = eg.prototype.get;
    eg.prototype.getKeys = eg.prototype.O;
    eg.prototype.getProperties = eg.prototype.N;
    eg.prototype.set = eg.prototype.set;
    eg.prototype.setProperties = eg.prototype.H;
    eg.prototype.unset = eg.prototype.P;
    eg.prototype.changed = eg.prototype.s;
    eg.prototype.dispatchEvent = eg.prototype.b;
    eg.prototype.getRevision = eg.prototype.L;
    eg.prototype.on = eg.prototype.J;
    eg.prototype.once = eg.prototype.once;
    eg.prototype.un = eg.prototype.K;
    zs.prototype.getActive = zs.prototype.c;
    zs.prototype.getMap = zs.prototype.i;
    zs.prototype.setActive = zs.prototype.Ia;
    zs.prototype.get = zs.prototype.get;
    zs.prototype.getKeys = zs.prototype.O;
    zs.prototype.getProperties = zs.prototype.N;
    zs.prototype.set = zs.prototype.set;
    zs.prototype.setProperties = zs.prototype.H;
    zs.prototype.unset = zs.prototype.P;
    zs.prototype.changed = zs.prototype.s;
    zs.prototype.dispatchEvent = zs.prototype.b;
    zs.prototype.getRevision = zs.prototype.L;
    zs.prototype.on = zs.prototype.J;
    zs.prototype.once = zs.prototype.once;
    zs.prototype.un = zs.prototype.K;
    Cs.prototype.type = Cs.prototype.type;
    Cs.prototype.target = Cs.prototype.target;
    Cs.prototype.preventDefault = Cs.prototype.preventDefault;
    Cs.prototype.stopPropagation = Cs.prototype.stopPropagation;
    pg.prototype.getActive = pg.prototype.c;
    pg.prototype.getMap = pg.prototype.i;
    pg.prototype.setActive = pg.prototype.Ia;
    pg.prototype.get = pg.prototype.get;
    pg.prototype.getKeys = pg.prototype.O;
    pg.prototype.getProperties = pg.prototype.N;
    pg.prototype.set = pg.prototype.set;
    pg.prototype.setProperties = pg.prototype.H;
    pg.prototype.unset = pg.prototype.P;
    pg.prototype.changed = pg.prototype.s;
    pg.prototype.dispatchEvent = pg.prototype.b;
    pg.prototype.getRevision = pg.prototype.L;
    pg.prototype.on = pg.prototype.J;
    pg.prototype.once = pg.prototype.once;
    pg.prototype.un = pg.prototype.K;
    Dg.prototype.getActive = Dg.prototype.c;
    Dg.prototype.getMap = Dg.prototype.i;
    Dg.prototype.setActive = Dg.prototype.Ia;
    Dg.prototype.get = Dg.prototype.get;
    Dg.prototype.getKeys = Dg.prototype.O;
    Dg.prototype.getProperties = Dg.prototype.N;
    Dg.prototype.set = Dg.prototype.set;
    Dg.prototype.setProperties = Dg.prototype.H;
    Dg.prototype.unset = Dg.prototype.P;
    Dg.prototype.changed = Dg.prototype.s;
    Dg.prototype.dispatchEvent = Dg.prototype.b;
    Dg.prototype.getRevision = Dg.prototype.L;
    Dg.prototype.on = Dg.prototype.J;
    Dg.prototype.once = Dg.prototype.once;
    Dg.prototype.un = Dg.prototype.K;
    Ig.prototype.type = Ig.prototype.type;
    Ig.prototype.target = Ig.prototype.target;
    Ig.prototype.preventDefault = Ig.prototype.preventDefault;
    Ig.prototype.stopPropagation = Ig.prototype.stopPropagation;
    sg.prototype.getActive = sg.prototype.c;
    sg.prototype.getMap = sg.prototype.i;
    sg.prototype.setActive = sg.prototype.Ia;
    sg.prototype.get = sg.prototype.get;
    sg.prototype.getKeys = sg.prototype.O;
    sg.prototype.getProperties = sg.prototype.N;
    sg.prototype.set = sg.prototype.set;
    sg.prototype.setProperties = sg.prototype.H;
    sg.prototype.unset = sg.prototype.P;
    sg.prototype.changed = sg.prototype.s;
    sg.prototype.dispatchEvent = sg.prototype.b;
    sg.prototype.getRevision = sg.prototype.L;
    sg.prototype.on = sg.prototype.J;
    sg.prototype.once = sg.prototype.once;
    sg.prototype.un = sg.prototype.K;
    wg.prototype.getActive = wg.prototype.c;
    wg.prototype.getMap = wg.prototype.i;
    wg.prototype.setActive = wg.prototype.Ia;
    wg.prototype.get = wg.prototype.get;
    wg.prototype.getKeys = wg.prototype.O;
    wg.prototype.getProperties = wg.prototype.N;
    wg.prototype.set = wg.prototype.set;
    wg.prototype.setProperties = wg.prototype.H;
    wg.prototype.unset = wg.prototype.P;
    wg.prototype.changed = wg.prototype.s;
    wg.prototype.dispatchEvent = wg.prototype.b;
    wg.prototype.getRevision = wg.prototype.L;
    wg.prototype.on = wg.prototype.J;
    wg.prototype.once = wg.prototype.once;
    wg.prototype.un = wg.prototype.K;
    Es.prototype.getActive = Es.prototype.c;
    Es.prototype.getMap = Es.prototype.i;
    Es.prototype.setActive = Es.prototype.Ia;
    Es.prototype.get = Es.prototype.get;
    Es.prototype.getKeys = Es.prototype.O;
    Es.prototype.getProperties = Es.prototype.N;
    Es.prototype.set = Es.prototype.set;
    Es.prototype.setProperties = Es.prototype.H;
    Es.prototype.unset = Es.prototype.P;
    Es.prototype.changed = Es.prototype.s;
    Es.prototype.dispatchEvent = Es.prototype.b;
    Es.prototype.getRevision = Es.prototype.L;
    Es.prototype.on = Es.prototype.J;
    Es.prototype.once = Es.prototype.once;
    Es.prototype.un = Es.prototype.K;
    Mg.prototype.getGeometry = Mg.prototype.U;
    Mg.prototype.getActive = Mg.prototype.c;
    Mg.prototype.getMap = Mg.prototype.i;
    Mg.prototype.setActive = Mg.prototype.Ia;
    Mg.prototype.get = Mg.prototype.get;
    Mg.prototype.getKeys = Mg.prototype.O;
    Mg.prototype.getProperties = Mg.prototype.N;
    Mg.prototype.set = Mg.prototype.set;
    Mg.prototype.setProperties = Mg.prototype.H;
    Mg.prototype.unset = Mg.prototype.P;
    Mg.prototype.changed = Mg.prototype.s;
    Mg.prototype.dispatchEvent = Mg.prototype.b;
    Mg.prototype.getRevision = Mg.prototype.L;
    Mg.prototype.on = Mg.prototype.J;
    Mg.prototype.once = Mg.prototype.once;
    Mg.prototype.un = Mg.prototype.K;
    Qt.prototype.getActive = Qt.prototype.c;
    Qt.prototype.getMap = Qt.prototype.i;
    Qt.prototype.setActive = Qt.prototype.Ia;
    Qt.prototype.get = Qt.prototype.get;
    Qt.prototype.getKeys = Qt.prototype.O;
    Qt.prototype.getProperties = Qt.prototype.N;
    Qt.prototype.set = Qt.prototype.set;
    Qt.prototype.setProperties = Qt.prototype.H;
    Qt.prototype.unset = Qt.prototype.P;
    Qt.prototype.changed = Qt.prototype.s;
    Qt.prototype.dispatchEvent = Qt.prototype.b;
    Qt.prototype.getRevision = Qt.prototype.L;
    Qt.prototype.on = Qt.prototype.J;
    Qt.prototype.once = Qt.prototype.once;
    Qt.prototype.un = Qt.prototype.K;
    eu.prototype.type = eu.prototype.type;
    eu.prototype.target = eu.prototype.target;
    eu.prototype.preventDefault = eu.prototype.preventDefault;
    eu.prototype.stopPropagation = eu.prototype.stopPropagation;
    gu.prototype.getActive = gu.prototype.c;
    gu.prototype.getMap = gu.prototype.i;
    gu.prototype.setActive = gu.prototype.Ia;
    gu.prototype.get = gu.prototype.get;
    gu.prototype.getKeys = gu.prototype.O;
    gu.prototype.getProperties = gu.prototype.N;
    gu.prototype.set = gu.prototype.set;
    gu.prototype.setProperties = gu.prototype.H;
    gu.prototype.unset = gu.prototype.P;
    gu.prototype.changed = gu.prototype.s;
    gu.prototype.dispatchEvent = gu.prototype.b;
    gu.prototype.getRevision = gu.prototype.L;
    gu.prototype.on = gu.prototype.J;
    gu.prototype.once = gu.prototype.once;
    gu.prototype.un = gu.prototype.K;
    ru.prototype.type = ru.prototype.type;
    ru.prototype.target = ru.prototype.target;
    ru.prototype.preventDefault = ru.prototype.preventDefault;
    ru.prototype.stopPropagation = ru.prototype.stopPropagation;
    Ng.prototype.getActive = Ng.prototype.c;
    Ng.prototype.getMap = Ng.prototype.i;
    Ng.prototype.setActive = Ng.prototype.Ia;
    Ng.prototype.get = Ng.prototype.get;
    Ng.prototype.getKeys = Ng.prototype.O;
    Ng.prototype.getProperties = Ng.prototype.N;
    Ng.prototype.set = Ng.prototype.set;
    Ng.prototype.setProperties = Ng.prototype.H;
    Ng.prototype.unset = Ng.prototype.P;
    Ng.prototype.changed = Ng.prototype.s;
    Ng.prototype.dispatchEvent = Ng.prototype.b;
    Ng.prototype.getRevision = Ng.prototype.L;
    Ng.prototype.on = Ng.prototype.J;
    Ng.prototype.once = Ng.prototype.once;
    Ng.prototype.un = Ng.prototype.K;
    Pg.prototype.getActive = Pg.prototype.c;
    Pg.prototype.getMap = Pg.prototype.i;
    Pg.prototype.setActive = Pg.prototype.Ia;
    Pg.prototype.get = Pg.prototype.get;
    Pg.prototype.getKeys = Pg.prototype.O;
    Pg.prototype.getProperties = Pg.prototype.N;
    Pg.prototype.set = Pg.prototype.set;
    Pg.prototype.setProperties = Pg.prototype.H;
    Pg.prototype.unset = Pg.prototype.P;
    Pg.prototype.changed = Pg.prototype.s;
    Pg.prototype.dispatchEvent = Pg.prototype.b;
    Pg.prototype.getRevision = Pg.prototype.L;
    Pg.prototype.on = Pg.prototype.J;
    Pg.prototype.once = Pg.prototype.once;
    Pg.prototype.un = Pg.prototype.K;
    tu.prototype.getActive = tu.prototype.c;
    tu.prototype.getMap = tu.prototype.i;
    tu.prototype.setActive = tu.prototype.Ia;
    tu.prototype.get = tu.prototype.get;
    tu.prototype.getKeys = tu.prototype.O;
    tu.prototype.getProperties = tu.prototype.N;
    tu.prototype.set = tu.prototype.set;
    tu.prototype.setProperties = tu.prototype.H;
    tu.prototype.unset = tu.prototype.P;
    tu.prototype.changed = tu.prototype.s;
    tu.prototype.dispatchEvent = tu.prototype.b;
    tu.prototype.getRevision = tu.prototype.L;
    tu.prototype.on = tu.prototype.J;
    tu.prototype.once = tu.prototype.once;
    tu.prototype.un = tu.prototype.K;
    Bu.prototype.type = Bu.prototype.type;
    Bu.prototype.target = Bu.prototype.target;
    Bu.prototype.preventDefault = Bu.prototype.preventDefault;
    Bu.prototype.stopPropagation = Bu.prototype.stopPropagation;
    Rg.prototype.getActive = Rg.prototype.c;
    Rg.prototype.getMap = Rg.prototype.i;
    Rg.prototype.setActive = Rg.prototype.Ia;
    Rg.prototype.get = Rg.prototype.get;
    Rg.prototype.getKeys = Rg.prototype.O;
    Rg.prototype.getProperties = Rg.prototype.N;
    Rg.prototype.set = Rg.prototype.set;
    Rg.prototype.setProperties = Rg.prototype.H;
    Rg.prototype.unset = Rg.prototype.P;
    Rg.prototype.changed = Rg.prototype.s;
    Rg.prototype.dispatchEvent = Rg.prototype.b;
    Rg.prototype.getRevision = Rg.prototype.L;
    Rg.prototype.on = Rg.prototype.J;
    Rg.prototype.once = Rg.prototype.once;
    Rg.prototype.un = Rg.prototype.K;
    Vg.prototype.getActive = Vg.prototype.c;
    Vg.prototype.getMap = Vg.prototype.i;
    Vg.prototype.setActive = Vg.prototype.Ia;
    Vg.prototype.get = Vg.prototype.get;
    Vg.prototype.getKeys = Vg.prototype.O;
    Vg.prototype.getProperties = Vg.prototype.N;
    Vg.prototype.set = Vg.prototype.set;
    Vg.prototype.setProperties = Vg.prototype.H;
    Vg.prototype.unset = Vg.prototype.P;
    Vg.prototype.changed = Vg.prototype.s;
    Vg.prototype.dispatchEvent = Vg.prototype.b;
    Vg.prototype.getRevision = Vg.prototype.L;
    Vg.prototype.on = Vg.prototype.J;
    Vg.prototype.once = Vg.prototype.once;
    Vg.prototype.un = Vg.prototype.K;
    Zg.prototype.getActive = Zg.prototype.c;
    Zg.prototype.getMap = Zg.prototype.i;
    Zg.prototype.setActive = Zg.prototype.Ia;
    Zg.prototype.get = Zg.prototype.get;
    Zg.prototype.getKeys = Zg.prototype.O;
    Zg.prototype.getProperties = Zg.prototype.N;
    Zg.prototype.set = Zg.prototype.set;
    Zg.prototype.setProperties = Zg.prototype.H;
    Zg.prototype.unset = Zg.prototype.P;
    Zg.prototype.changed = Zg.prototype.s;
    Zg.prototype.dispatchEvent = Zg.prototype.b;
    Zg.prototype.getRevision = Zg.prototype.L;
    Zg.prototype.on = Zg.prototype.J;
    Zg.prototype.once = Zg.prototype.once;
    Zg.prototype.un = Zg.prototype.K;
    Ju.prototype.getActive = Ju.prototype.c;
    Ju.prototype.getMap = Ju.prototype.i;
    Ju.prototype.setActive = Ju.prototype.Ia;
    Ju.prototype.get = Ju.prototype.get;
    Ju.prototype.getKeys = Ju.prototype.O;
    Ju.prototype.getProperties = Ju.prototype.N;
    Ju.prototype.set = Ju.prototype.set;
    Ju.prototype.setProperties = Ju.prototype.H;
    Ju.prototype.unset = Ju.prototype.P;
    Ju.prototype.changed = Ju.prototype.s;
    Ju.prototype.dispatchEvent = Ju.prototype.b;
    Ju.prototype.getRevision = Ju.prototype.L;
    Ju.prototype.on = Ju.prototype.J;
    Ju.prototype.once = Ju.prototype.once;
    Ju.prototype.un = Ju.prototype.K;
    Mu.prototype.type = Mu.prototype.type;
    Mu.prototype.target = Mu.prototype.target;
    Mu.prototype.preventDefault = Mu.prototype.preventDefault;
    Mu.prototype.stopPropagation = Mu.prototype.stopPropagation;
    Ou.prototype.getActive = Ou.prototype.c;
    Ou.prototype.getMap = Ou.prototype.i;
    Ou.prototype.setActive = Ou.prototype.Ia;
    Ou.prototype.get = Ou.prototype.get;
    Ou.prototype.getKeys = Ou.prototype.O;
    Ou.prototype.getProperties = Ou.prototype.N;
    Ou.prototype.set = Ou.prototype.set;
    Ou.prototype.setProperties = Ou.prototype.H;
    Ou.prototype.unset = Ou.prototype.P;
    Ou.prototype.changed = Ou.prototype.s;
    Ou.prototype.dispatchEvent = Ou.prototype.b;
    Ou.prototype.getRevision = Ou.prototype.L;
    Ou.prototype.on = Ou.prototype.J;
    Ou.prototype.once = Ou.prototype.once;
    Ou.prototype.un = Ou.prototype.K;
    Su.prototype.getActive = Su.prototype.c;
    Su.prototype.getMap = Su.prototype.i;
    Su.prototype.setActive = Su.prototype.Ia;
    Su.prototype.get = Su.prototype.get;
    Su.prototype.getKeys = Su.prototype.O;
    Su.prototype.getProperties = Su.prototype.N;
    Su.prototype.set = Su.prototype.set;
    Su.prototype.setProperties = Su.prototype.H;
    Su.prototype.unset = Su.prototype.P;
    Su.prototype.changed = Su.prototype.s;
    Su.prototype.dispatchEvent = Su.prototype.b;
    Su.prototype.getRevision = Su.prototype.L;
    Su.prototype.on = Su.prototype.J;
    Su.prototype.once = Su.prototype.once;
    Su.prototype.un = Su.prototype.K;
    Yu.prototype.type = Yu.prototype.type;
    Yu.prototype.target = Yu.prototype.target;
    Yu.prototype.preventDefault = Yu.prototype.preventDefault;
    Yu.prototype.stopPropagation = Yu.prototype.stopPropagation;
    cf.prototype.get = cf.prototype.get;
    cf.prototype.getKeys = cf.prototype.O;
    cf.prototype.getProperties = cf.prototype.N;
    cf.prototype.set = cf.prototype.set;
    cf.prototype.setProperties = cf.prototype.H;
    cf.prototype.unset = cf.prototype.P;
    cf.prototype.changed = cf.prototype.s;
    cf.prototype.dispatchEvent = cf.prototype.b;
    cf.prototype.getRevision = cf.prototype.L;
    cf.prototype.on = cf.prototype.J;
    cf.prototype.once = cf.prototype.once;
    cf.prototype.un = cf.prototype.K;
    ff.prototype.getClosestPoint = ff.prototype.Ab;
    ff.prototype.intersectsCoordinate = ff.prototype.sb;
    ff.prototype.getExtent = ff.prototype.D;
    ff.prototype.rotate = ff.prototype.rotate;
    ff.prototype.scale = ff.prototype.scale;
    ff.prototype.simplify = ff.prototype.Pb;
    ff.prototype.transform = ff.prototype.tb;
    ff.prototype.get = ff.prototype.get;
    ff.prototype.getKeys = ff.prototype.O;
    ff.prototype.getProperties = ff.prototype.N;
    ff.prototype.set = ff.prototype.set;
    ff.prototype.setProperties = ff.prototype.H;
    ff.prototype.unset = ff.prototype.P;
    ff.prototype.changed = ff.prototype.s;
    ff.prototype.dispatchEvent = ff.prototype.b;
    ff.prototype.getRevision = ff.prototype.L;
    ff.prototype.on = ff.prototype.J;
    ff.prototype.once = ff.prototype.once;
    ff.prototype.un = ff.prototype.K;
    is.prototype.getFirstCoordinate = is.prototype.bc;
    is.prototype.getLastCoordinate = is.prototype.cc;
    is.prototype.getLayout = is.prototype.dc;
    is.prototype.rotate = is.prototype.rotate;
    is.prototype.scale = is.prototype.scale;
    is.prototype.getClosestPoint = is.prototype.Ab;
    is.prototype.intersectsCoordinate = is.prototype.sb;
    is.prototype.getExtent = is.prototype.D;
    is.prototype.simplify = is.prototype.Pb;
    is.prototype.get = is.prototype.get;
    is.prototype.getKeys = is.prototype.O;
    is.prototype.getProperties = is.prototype.N;
    is.prototype.set = is.prototype.set;
    is.prototype.setProperties = is.prototype.H;
    is.prototype.unset = is.prototype.P;
    is.prototype.changed = is.prototype.s;
    is.prototype.dispatchEvent = is.prototype.b;
    is.prototype.getRevision = is.prototype.L;
    is.prototype.on = is.prototype.J;
    is.prototype.once = is.prototype.once;
    is.prototype.un = is.prototype.K;
    qm.prototype.getClosestPoint = qm.prototype.Ab;
    qm.prototype.intersectsCoordinate = qm.prototype.sb;
    qm.prototype.getExtent = qm.prototype.D;
    qm.prototype.rotate = qm.prototype.rotate;
    qm.prototype.scale = qm.prototype.scale;
    qm.prototype.simplify = qm.prototype.Pb;
    qm.prototype.transform = qm.prototype.tb;
    qm.prototype.get = qm.prototype.get;
    qm.prototype.getKeys = qm.prototype.O;
    qm.prototype.getProperties = qm.prototype.N;
    qm.prototype.set = qm.prototype.set;
    qm.prototype.setProperties = qm.prototype.H;
    qm.prototype.unset = qm.prototype.P;
    qm.prototype.changed = qm.prototype.s;
    qm.prototype.dispatchEvent = qm.prototype.b;
    qm.prototype.getRevision = qm.prototype.L;
    qm.prototype.on = qm.prototype.J;
    qm.prototype.once = qm.prototype.once;
    qm.prototype.un = qm.prototype.K;
    yf.prototype.getFirstCoordinate = yf.prototype.bc;
    yf.prototype.getLastCoordinate = yf.prototype.cc;
    yf.prototype.getLayout = yf.prototype.dc;
    yf.prototype.rotate = yf.prototype.rotate;
    yf.prototype.scale = yf.prototype.scale;
    yf.prototype.getClosestPoint = yf.prototype.Ab;
    yf.prototype.intersectsCoordinate = yf.prototype.sb;
    yf.prototype.getExtent = yf.prototype.D;
    yf.prototype.simplify = yf.prototype.Pb;
    yf.prototype.transform = yf.prototype.tb;
    yf.prototype.get = yf.prototype.get;
    yf.prototype.getKeys = yf.prototype.O;
    yf.prototype.getProperties = yf.prototype.N;
    yf.prototype.set = yf.prototype.set;
    yf.prototype.setProperties = yf.prototype.H;
    yf.prototype.unset = yf.prototype.P;
    yf.prototype.changed = yf.prototype.s;
    yf.prototype.dispatchEvent = yf.prototype.b;
    yf.prototype.getRevision = yf.prototype.L;
    yf.prototype.on = yf.prototype.J;
    yf.prototype.once = yf.prototype.once;
    yf.prototype.un = yf.prototype.K;
    M.prototype.getFirstCoordinate = M.prototype.bc;
    M.prototype.getLastCoordinate = M.prototype.cc;
    M.prototype.getLayout = M.prototype.dc;
    M.prototype.rotate = M.prototype.rotate;
    M.prototype.scale = M.prototype.scale;
    M.prototype.getClosestPoint = M.prototype.Ab;
    M.prototype.intersectsCoordinate = M.prototype.sb;
    M.prototype.getExtent = M.prototype.D;
    M.prototype.simplify = M.prototype.Pb;
    M.prototype.transform = M.prototype.tb;
    M.prototype.get = M.prototype.get;
    M.prototype.getKeys = M.prototype.O;
    M.prototype.getProperties = M.prototype.N;
    M.prototype.set = M.prototype.set;
    M.prototype.setProperties = M.prototype.H;
    M.prototype.unset = M.prototype.P;
    M.prototype.changed = M.prototype.s;
    M.prototype.dispatchEvent = M.prototype.b;
    M.prototype.getRevision = M.prototype.L;
    M.prototype.on = M.prototype.J;
    M.prototype.once = M.prototype.once;
    M.prototype.un = M.prototype.K;
    N.prototype.getFirstCoordinate = N.prototype.bc;
    N.prototype.getLastCoordinate = N.prototype.cc;
    N.prototype.getLayout = N.prototype.dc;
    N.prototype.rotate = N.prototype.rotate;
    N.prototype.scale = N.prototype.scale;
    N.prototype.getClosestPoint = N.prototype.Ab;
    N.prototype.intersectsCoordinate = N.prototype.sb;
    N.prototype.getExtent = N.prototype.D;
    N.prototype.simplify = N.prototype.Pb;
    N.prototype.transform = N.prototype.tb;
    N.prototype.get = N.prototype.get;
    N.prototype.getKeys = N.prototype.O;
    N.prototype.getProperties = N.prototype.N;
    N.prototype.set = N.prototype.set;
    N.prototype.setProperties = N.prototype.H;
    N.prototype.unset = N.prototype.P;
    N.prototype.changed = N.prototype.s;
    N.prototype.dispatchEvent = N.prototype.b;
    N.prototype.getRevision = N.prototype.L;
    N.prototype.on = N.prototype.J;
    N.prototype.once = N.prototype.once;
    N.prototype.un = N.prototype.K;
    O.prototype.getFirstCoordinate = O.prototype.bc;
    O.prototype.getLastCoordinate = O.prototype.cc;
    O.prototype.getLayout = O.prototype.dc;
    O.prototype.rotate = O.prototype.rotate;
    O.prototype.scale = O.prototype.scale;
    O.prototype.getClosestPoint = O.prototype.Ab;
    O.prototype.intersectsCoordinate = O.prototype.sb;
    O.prototype.getExtent = O.prototype.D;
    O.prototype.simplify = O.prototype.Pb;
    O.prototype.transform = O.prototype.tb;
    O.prototype.get = O.prototype.get;
    O.prototype.getKeys = O.prototype.O;
    O.prototype.getProperties = O.prototype.N;
    O.prototype.set = O.prototype.set;
    O.prototype.setProperties = O.prototype.H;
    O.prototype.unset = O.prototype.P;
    O.prototype.changed = O.prototype.s;
    O.prototype.dispatchEvent = O.prototype.b;
    O.prototype.getRevision = O.prototype.L;
    O.prototype.on = O.prototype.J;
    O.prototype.once = O.prototype.once;
    O.prototype.un = O.prototype.K;
    P.prototype.getFirstCoordinate = P.prototype.bc;
    P.prototype.getLastCoordinate = P.prototype.cc;
    P.prototype.getLayout = P.prototype.dc;
    P.prototype.rotate = P.prototype.rotate;
    P.prototype.scale = P.prototype.scale;
    P.prototype.getClosestPoint = P.prototype.Ab;
    P.prototype.intersectsCoordinate = P.prototype.sb;
    P.prototype.getExtent = P.prototype.D;
    P.prototype.simplify = P.prototype.Pb;
    P.prototype.transform = P.prototype.tb;
    P.prototype.get = P.prototype.get;
    P.prototype.getKeys = P.prototype.O;
    P.prototype.getProperties = P.prototype.N;
    P.prototype.set = P.prototype.set;
    P.prototype.setProperties = P.prototype.H;
    P.prototype.unset = P.prototype.P;
    P.prototype.changed = P.prototype.s;
    P.prototype.dispatchEvent = P.prototype.b;
    P.prototype.getRevision = P.prototype.L;
    P.prototype.on = P.prototype.J;
    P.prototype.once = P.prototype.once;
    P.prototype.un = P.prototype.K;
    E.prototype.getFirstCoordinate = E.prototype.bc;
    E.prototype.getLastCoordinate = E.prototype.cc;
    E.prototype.getLayout = E.prototype.dc;
    E.prototype.rotate = E.prototype.rotate;
    E.prototype.scale = E.prototype.scale;
    E.prototype.getClosestPoint = E.prototype.Ab;
    E.prototype.intersectsCoordinate = E.prototype.sb;
    E.prototype.getExtent = E.prototype.D;
    E.prototype.simplify = E.prototype.Pb;
    E.prototype.transform = E.prototype.tb;
    E.prototype.get = E.prototype.get;
    E.prototype.getKeys = E.prototype.O;
    E.prototype.getProperties = E.prototype.N;
    E.prototype.set = E.prototype.set;
    E.prototype.setProperties = E.prototype.H;
    E.prototype.unset = E.prototype.P;
    E.prototype.changed = E.prototype.s;
    E.prototype.dispatchEvent = E.prototype.b;
    E.prototype.getRevision = E.prototype.L;
    E.prototype.on = E.prototype.J;
    E.prototype.once = E.prototype.once;
    E.prototype.un = E.prototype.K;
    F.prototype.getFirstCoordinate = F.prototype.bc;
    F.prototype.getLastCoordinate = F.prototype.cc;
    F.prototype.getLayout = F.prototype.dc;
    F.prototype.rotate = F.prototype.rotate;
    F.prototype.scale = F.prototype.scale;
    F.prototype.getClosestPoint = F.prototype.Ab;
    F.prototype.intersectsCoordinate = F.prototype.sb;
    F.prototype.getExtent = F.prototype.D;
    F.prototype.simplify = F.prototype.Pb;
    F.prototype.transform = F.prototype.tb;
    F.prototype.get = F.prototype.get;
    F.prototype.getKeys = F.prototype.O;
    F.prototype.getProperties = F.prototype.N;
    F.prototype.set = F.prototype.set;
    F.prototype.setProperties = F.prototype.H;
    F.prototype.unset = F.prototype.P;
    F.prototype.changed = F.prototype.s;
    F.prototype.dispatchEvent = F.prototype.b;
    F.prototype.getRevision = F.prototype.L;
    F.prototype.on = F.prototype.J;
    F.prototype.once = F.prototype.once;
    F.prototype.un = F.prototype.K;
    Pm.prototype.readFeatures = Pm.prototype.Qa;
    Ym.prototype.readFeatures = Ym.prototype.Qa;
    Pm.prototype.readFeatures = Pm.prototype.Qa;
    ad.prototype.get = ad.prototype.get;
    ad.prototype.getKeys = ad.prototype.O;
    ad.prototype.getProperties = ad.prototype.N;
    ad.prototype.set = ad.prototype.set;
    ad.prototype.setProperties = ad.prototype.H;
    ad.prototype.unset = ad.prototype.P;
    ad.prototype.changed = ad.prototype.s;
    ad.prototype.dispatchEvent = ad.prototype.b;
    ad.prototype.getRevision = ad.prototype.L;
    ad.prototype.on = ad.prototype.J;
    ad.prototype.once = ad.prototype.once;
    ad.prototype.un = ad.prototype.K;
    bd.prototype.getMap = bd.prototype.g;
    bd.prototype.setMap = bd.prototype.setMap;
    bd.prototype.setTarget = bd.prototype.i;
    bd.prototype.get = bd.prototype.get;
    bd.prototype.getKeys = bd.prototype.O;
    bd.prototype.getProperties = bd.prototype.N;
    bd.prototype.set = bd.prototype.set;
    bd.prototype.setProperties = bd.prototype.H;
    bd.prototype.unset = bd.prototype.P;
    bd.prototype.changed = bd.prototype.s;
    bd.prototype.dispatchEvent = bd.prototype.b;
    bd.prototype.getRevision = bd.prototype.L;
    bd.prototype.on = bd.prototype.J;
    bd.prototype.once = bd.prototype.once;
    bd.prototype.un = bd.prototype.K;
    od.prototype.getMap = od.prototype.g;
    od.prototype.setMap = od.prototype.setMap;
    od.prototype.setTarget = od.prototype.i;
    od.prototype.get = od.prototype.get;
    od.prototype.getKeys = od.prototype.O;
    od.prototype.getProperties = od.prototype.N;
    od.prototype.set = od.prototype.set;
    od.prototype.setProperties = od.prototype.H;
    od.prototype.unset = od.prototype.P;
    od.prototype.changed = od.prototype.s;
    od.prototype.dispatchEvent = od.prototype.b;
    od.prototype.getRevision = od.prototype.L;
    od.prototype.on = od.prototype.J;
    od.prototype.once = od.prototype.once;
    od.prototype.un = od.prototype.K;
    td.prototype.getMap = td.prototype.g;
    td.prototype.setMap = td.prototype.setMap;
    td.prototype.setTarget = td.prototype.i;
    td.prototype.get = td.prototype.get;
    td.prototype.getKeys = td.prototype.O;
    td.prototype.getProperties = td.prototype.N;
    td.prototype.set = td.prototype.set;
    td.prototype.setProperties = td.prototype.H;
    td.prototype.unset = td.prototype.P;
    td.prototype.changed = td.prototype.s;
    td.prototype.dispatchEvent = td.prototype.b;
    td.prototype.getRevision = td.prototype.L;
    td.prototype.on = td.prototype.J;
    td.prototype.once = td.prototype.once;
    td.prototype.un = td.prototype.K;
    zk.prototype.getMap = zk.prototype.g;
    zk.prototype.setMap = zk.prototype.setMap;
    zk.prototype.setTarget = zk.prototype.i;
    zk.prototype.get = zk.prototype.get;
    zk.prototype.getKeys = zk.prototype.O;
    zk.prototype.getProperties = zk.prototype.N;
    zk.prototype.set = zk.prototype.set;
    zk.prototype.setProperties = zk.prototype.H;
    zk.prototype.unset = zk.prototype.P;
    zk.prototype.changed = zk.prototype.s;
    zk.prototype.dispatchEvent = zk.prototype.b;
    zk.prototype.getRevision = zk.prototype.L;
    zk.prototype.on = zk.prototype.J;
    zk.prototype.once = zk.prototype.once;
    zk.prototype.un = zk.prototype.K;
    id.prototype.getMap = id.prototype.g;
    id.prototype.setMap = id.prototype.setMap;
    id.prototype.setTarget = id.prototype.i;
    id.prototype.get = id.prototype.get;
    id.prototype.getKeys = id.prototype.O;
    id.prototype.getProperties = id.prototype.N;
    id.prototype.set = id.prototype.set;
    id.prototype.setProperties = id.prototype.H;
    id.prototype.unset = id.prototype.P;
    id.prototype.changed = id.prototype.s;
    id.prototype.dispatchEvent = id.prototype.b;
    id.prototype.getRevision = id.prototype.L;
    id.prototype.on = id.prototype.J;
    id.prototype.once = id.prototype.once;
    id.prototype.un = id.prototype.K;
    Ek.prototype.getMap = Ek.prototype.g;
    Ek.prototype.setMap = Ek.prototype.setMap;
    Ek.prototype.setTarget = Ek.prototype.i;
    Ek.prototype.get = Ek.prototype.get;
    Ek.prototype.getKeys = Ek.prototype.O;
    Ek.prototype.getProperties = Ek.prototype.N;
    Ek.prototype.set = Ek.prototype.set;
    Ek.prototype.setProperties = Ek.prototype.H;
    Ek.prototype.unset = Ek.prototype.P;
    Ek.prototype.changed = Ek.prototype.s;
    Ek.prototype.dispatchEvent = Ek.prototype.b;
    Ek.prototype.getRevision = Ek.prototype.L;
    Ek.prototype.on = Ek.prototype.J;
    Ek.prototype.once = Ek.prototype.once;
    Ek.prototype.un = Ek.prototype.K;
    kd.prototype.getMap = kd.prototype.g;
    kd.prototype.setMap = kd.prototype.setMap;
    kd.prototype.setTarget = kd.prototype.i;
    kd.prototype.get = kd.prototype.get;
    kd.prototype.getKeys = kd.prototype.O;
    kd.prototype.getProperties = kd.prototype.N;
    kd.prototype.set = kd.prototype.set;
    kd.prototype.setProperties = kd.prototype.H;
    kd.prototype.unset = kd.prototype.P;
    kd.prototype.changed = kd.prototype.s;
    kd.prototype.dispatchEvent = kd.prototype.b;
    kd.prototype.getRevision = kd.prototype.L;
    kd.prototype.on = kd.prototype.J;
    kd.prototype.once = kd.prototype.once;
    kd.prototype.un = kd.prototype.K;
    Jk.prototype.getMap = Jk.prototype.g;
    Jk.prototype.setMap = Jk.prototype.setMap;
    Jk.prototype.setTarget = Jk.prototype.i;
    Jk.prototype.get = Jk.prototype.get;
    Jk.prototype.getKeys = Jk.prototype.O;
    Jk.prototype.getProperties = Jk.prototype.N;
    Jk.prototype.set = Jk.prototype.set;
    Jk.prototype.setProperties = Jk.prototype.H;
    Jk.prototype.unset = Jk.prototype.P;
    Jk.prototype.changed = Jk.prototype.s;
    Jk.prototype.dispatchEvent = Jk.prototype.b;
    Jk.prototype.getRevision = Jk.prototype.L;
    Jk.prototype.on = Jk.prototype.J;
    Jk.prototype.once = Jk.prototype.once;
    Jk.prototype.un = Jk.prototype.K;
    Ok.prototype.getMap = Ok.prototype.g;
    Ok.prototype.setMap = Ok.prototype.setMap;
    Ok.prototype.setTarget = Ok.prototype.i;
    Ok.prototype.get = Ok.prototype.get;
    Ok.prototype.getKeys = Ok.prototype.O;
    Ok.prototype.getProperties = Ok.prototype.N;
    Ok.prototype.set = Ok.prototype.set;
    Ok.prototype.setProperties = Ok.prototype.H;
    Ok.prototype.unset = Ok.prototype.P;
    Ok.prototype.changed = Ok.prototype.s;
    Ok.prototype.dispatchEvent = Ok.prototype.b;
    Ok.prototype.getRevision = Ok.prototype.L;
    Ok.prototype.on = Ok.prototype.J;
    Ok.prototype.once = Ok.prototype.once;
    Ok.prototype.un = Ok.prototype.K;
    return OPENLAYERS.ol;
}));
(function (root, factory) {
    if (true) {
        gp = function (ol) {
            return typeof factory === 'function' ? factory(ol) : factory;
        }(ol);
    } else if (typeof exports === 'object') {
        module.exports = factory(ol);
    } else {
        root.Gp = factory(root.ol);
    }
}(this, function (ol) {
    var request, xmldom;
    var gp, CommonUtilsAutoLoadConfig, CommonUtilsLayerUtils, CommonUtilsRegister, CommonUtilsProxyUtils, Ol3GfiUtils, CommonUtils, Ol3FormatsKML, Ol3SourcesWMTS, Ol3CRSCRS, CommonUtilsConfig, Ol3LayersSourceWMTS, Ol3LayersSourceWMS, Ol3LayersLayerWMTS, Ol3LayersLayerWMS, CommonUtilsSelectorID, sortable, CommonControlsLayerSwitcherDOM, Ol3ControlsLayerSwitcher, CommonControlsGetFeatureInfoDOM, Ol3ControlsGetFeatureInfo, Ol3ControlsUtilsMarkers, CommonUtilsCheckRightManagement, CommonControlsSearchEngineDOM, CommonControlsSearchEngineUtils, Ol3ControlsSearchEngine, CommonUtilsMathUtils, CommonControlsMousePositionDOM, Ol3ControlsMousePosition, Ol3ControlsUtilsInteractions, CommonControlsDrawingDOM, Ol3ControlsDrawing, CommonControlsLocationSelectorDOM, Ol3ControlsLocationSelector, CommonControlsRouteDOM, Ol3ControlsRoute, CommonControlsIsoDOM, Ol3ControlsIsocurve, CommonControlsReverseGeocodingDOM, Ol3ControlsReverseGeocode, CommonControlsLayerImportDOM, Ol3ControlsLayerImport, Ol3ControlsGeoportalAttribution, Ol3ControlsMeasuresMeasures, CommonControlsMeasureToolBoxDOM, Ol3ControlsMeasureToolBox, CommonControlsElevationPathDOM, Ol3ControlsElevationPath, CommonControlsMeasureLengthDOM, Ol3ControlsMeasuresMeasureLength, CommonControlsMeasureAreaDOM, Ol3ControlsMeasuresMeasureArea, CommonControlsMeasureAzimuthDOM, Ol3ControlsMeasuresMeasureAzimuth, Ol3GpPluginOl3;
    (function (root, factory) {
        if (true) {
            gp = function (require, require) {
                return typeof factory === 'function' ? factory(require, require) : factory;
            }({}, {});
        } else if (typeof exports === 'object') {
            module.exports = factory(request, xmldom);
        } else {
            root.Gp = factory(root.request, root.xmldom);
        }
    }(this, function (request, xmldom) {
        var log4js, loggerCfg, UtilsLoggerByDefault, UtilsHelper, es6Promise, ProtocolsXHR, UtilsMessagesResources, ExceptionsErrorService, ProtocolsJSONP, ProtocolsProtocol, ServicesDefaultUrlService, ServicesCommonService, ServicesAltiRequestModelAltiRequest, ServicesAltiRequestModelAltiElevationRequest, ServicesAltiRequestModelAltiProfilRequest, ServicesAltiRequestAltiRequestREST, FormatsWPS, ServicesAltiRequestAltiRequestWPS, ServicesAltiRequestAltiRequestFactory, FormatsXML, ServicesAltiResponseModelAltiResponse, ServicesAltiResponseModelElevation, ServicesAltiFormatsAltiResponseReader, ServicesAltiResponseAltiResponseFactory, ServicesAltiAlti, ServicesAutoConfResponseModelAutoConfResponse, ServicesAutoConfResponseModelConstraint, ServicesAutoConfResponseModelFormat, ServicesAutoConfResponseModelLayer, ServicesAutoConfResponseModelLegend, ServicesAutoConfResponseModelMetadata, ServicesAutoConfResponseModelOriginator, ServicesAutoConfResponseModelService, ServicesAutoConfResponseModelStyle, ServicesAutoConfResponseModelTerritory, ServicesAutoConfResponseModelThematic, ServicesAutoConfResponseModelTileMatrixSet, ServicesAutoConfResponseModelTileMatrix, ServicesAutoConfResponseModelTileMatrixLimit, ServicesAutoConfFormatsAutoConfResponseReader, ServicesAutoConfResponseAutoConfResponseFactory, ServicesAutoConfAutoConf, FormatsXLSRequestHeader, FormatsXLSRequest, FormatsXLSAbstractService, FormatsXLS, FormatsXLSLocationUtilityServiceModelAddress, FormatsXLSLocationUtilityServiceGeocodeFilterExtension, FormatsXLSLocationUtilityServiceGeocodeRequest, FormatsXLSLocationUtilityServiceModelPosition, FormatsXLSLocationUtilityServiceModelPreference, FormatsXLSLocationUtilityServiceReverseGeocodeRequest, FormatsXLSLocationUtilityService, ServicesGeocodeRequestGeocodeLocation, ServicesGeocodeRequestModelStreetAddress, ServicesGeocodeRequestModelPositionOfInterest, ServicesGeocodeRequestModelCadastralParcel, ServicesGeocodeRequestModelAdministratif, ServicesGeocodeRequestDirectGeocodeRequestFactory, ServicesGeocodeResponseModelGeocodeResponse, ServicesGeocodeResponseModelGeocodedLocation, ServicesGeocodeResponseModelDirectGeocodedLocation, ServicesGeocodeFormatsDirectGeocodeResponseReader, ServicesGeocodeResponseDirectGeocodeResponseFactory, ServicesGeocodeGeocode, ServicesGeocodeRequestReverseGeocodeRequestFactory, ServicesGeocodeResponseModelReverseGeocodedLocation, ServicesGeocodeFormatsReverseGeocodeResponseReader, ServicesGeocodeResponseReverseGeocodeResponseFactory, ServicesGeocodeReverseGeocode, ServicesAutoCompleteResponseModelAutoCompleteResponse, ServicesAutoCompleteResponseModelSuggestedLocation, ServicesAutoCompleteResponseAutoCompleteResponseFactory, ServicesAutoCompleteAutoComplete, FormatsXLSRouteServiceModelRoutePlan, FormatsXLSRouteServiceDetermineRouteRequest, FormatsXLSRouteServiceRouteRequestExtension, FormatsXLSRouteService, ServicesRouteRequestRouteRequestOLS, ServicesRouteRequestModelRouteParamREST, ServicesRouteRequestRouteRequestREST, ServicesRouteRequestRouteRequestFactory, FormatsWKT, ServicesRouteResponseModelRouteResponse, ServicesRouteResponseModelRouteInstruction, ServicesRouteFormatsRouteResponseRESTReader, ServicesRouteFormatsRouteResponseOLSReader, ServicesRouteResponseRouteResponseFactory, ServicesRouteRoute, ServicesProcessIsoCurveRequestModelProcessIsoCurveParam, ServicesProcessIsoCurveRequestProcessIsoCurveRequest, ServicesProcessIsoCurveResponseModelProcessIsoCurveResponse, ServicesProcessIsoCurveFormatsProcessIsoCurveResponseReader, ServicesProcessIsoCurveResponseProcessIsoCurveResponseFactory, ServicesProcessIsoCurveProcessIsoCurve, ServicesServices, Gp;
        log4js = undefined;
        loggerCfg = {
            loggers: [{
                    root: true,
                    level: 'all',
                    appenders: [{
                            type: 'Console',
                            layout: {
                                type: 'PatternLayout',
                                pattern: '%d{yyyy-MM-dd HH:mm:ss} [%p] %c - %m%n'
                            }
                        }]
                }]
        };
        UtilsLoggerByDefault = function (Log4js, Config) {
            var LoggerByDefault = {
                getLogger: function (name) {
                    Log4js.load(Config, function (error) {
                        if (error) {
                            throw error;
                        }
                    });
                    var logname = name || 'default';
                    return Log4js.getLogger(logname);
                }
            };
            return LoggerByDefault;
        }(log4js, loggerCfg);
        UtilsHelper = function () {
            var Helper = {
                normalyzeParameters: function (params) {
                    var myParams = null;
                    if (params) {
                        var tabParams = [];
                        for (var key in params) {
                            if (params.hasOwnProperty(key)) {
                                var value = params[key];
                                if (!value) {
                                    value = '';
                                }
                                tabParams.push(key + '=' + value);
                            }
                        }
                        myParams = tabParams.join('&');
                    }
                    return myParams;
                },
                normalyzeUrl: function (url, params, encode) {
                    var myUrl = url;
                    if (url) {
                        var k = url.indexOf('?');
                        if (k === -1) {
                            myUrl += '?';
                        }
                        if (k !== -1 && k !== url.length - 1) {
                            myUrl += '&';
                        }
                    }
                    if (params) {
                        if (typeof params === 'string') {
                            myUrl += params;
                        } else {
                            myUrl += this.normalyzeParameters(params);
                        }
                    }
                    if (encode) {
                        myUrl = encodeURIComponent(myUrl);
                    }
                    return myUrl;
                },
                indent: function (n, msg) {
                    var num = n || 0;
                    return new Array(num + 1).join('\t') + msg;
                }
            };
            return Helper;
        }();
        (function (global, factory) {
            if (true) {
                es6Promise = function () {
                    return typeof factory === 'function' ? factory() : factory;
                }();
            } else if (typeof exports === 'object') {
                module.exports = factory();
            } else {
                global.ES6Promise = factory();
            }
        }(this, function () {
            'use strict';
            function objectOrFunction(x) {
                return typeof x === 'function' || typeof x === 'object' && x !== null;
            }
            function isFunction(x) {
                return typeof x === 'function';
            }
            var _isArray = undefined;
            if (!Array.isArray) {
                _isArray = function (x) {
                    return Object.prototype.toString.call(x) === '[object Array]';
                };
            } else {
                _isArray = Array.isArray;
            }
            var isArray = _isArray;
            var len = 0;
            var vertxNext = undefined;
            var customSchedulerFn = undefined;
            var asap = function asap(callback, arg) {
                queue[len] = callback;
                queue[len + 1] = arg;
                len += 2;
                if (len === 2) {
                    if (customSchedulerFn) {
                        customSchedulerFn(flush);
                    } else {
                        scheduleFlush();
                    }
                }
            };
            function setScheduler(scheduleFn) {
                customSchedulerFn = scheduleFn;
            }
            function setAsap(asapFn) {
                asap = asapFn;
            }
            var browserWindow = typeof window !== 'undefined' ? window : undefined;
            var browserGlobal = browserWindow || {};
            var BrowserMutationObserver = browserGlobal.MutationObserver || browserGlobal.WebKitMutationObserver;
            var isNode = typeof self === 'undefined' && typeof process !== 'undefined' && {}.toString.call(process) === '[object process]';
            var isWorker = typeof Uint8ClampedArray !== 'undefined' && typeof importScripts !== 'undefined' && typeof MessageChannel !== 'undefined';
            function useNextTick() {
                return function () {
                    return process.nextTick(flush);
                };
            }
            function useVertxTimer() {
                if (typeof vertxNext !== 'undefined') {
                    return function () {
                        vertxNext(flush);
                    };
                }
                return useSetTimeout();
            }
            function useMutationObserver() {
                var iterations = 0;
                var observer = new BrowserMutationObserver(flush);
                var node = document.createTextNode('');
                observer.observe(node, { characterData: true });
                return function () {
                    node.data = iterations = ++iterations % 2;
                };
            }
            function useMessageChannel() {
                var channel = new MessageChannel();
                channel.port1.onmessage = flush;
                return function () {
                    return channel.port2.postMessage(0);
                };
            }
            function useSetTimeout() {
                var globalSetTimeout = setTimeout;
                return function () {
                    return globalSetTimeout(flush, 1);
                };
            }
            var queue = new Array(1000);
            function flush() {
                for (var i = 0; i < len; i += 2) {
                    var callback = queue[i];
                    var arg = queue[i + 1];
                    callback(arg);
                    queue[i] = undefined;
                    queue[i + 1] = undefined;
                }
                len = 0;
            }
            function attemptVertx() {
                try {
                    var r = require;
                    var vertx = r('vertx');
                    vertxNext = vertx.runOnLoop || vertx.runOnContext;
                    return useVertxTimer();
                } catch (e) {
                    return useSetTimeout();
                }
            }
            var scheduleFlush = undefined;
            if (isNode) {
                scheduleFlush = useNextTick();
            } else if (BrowserMutationObserver) {
                scheduleFlush = useMutationObserver();
            } else if (isWorker) {
                scheduleFlush = useMessageChannel();
            } else if (browserWindow === undefined && typeof require === 'function') {
                scheduleFlush = attemptVertx();
            } else {
                scheduleFlush = useSetTimeout();
            }
            function then(onFulfillment, onRejection) {
                var _arguments = arguments;
                var parent = this;
                var child = new this.constructor(noop);
                if (child[PROMISE_ID] === undefined) {
                    makePromise(child);
                }
                var _state = parent._state;
                if (_state) {
                    (function () {
                        var callback = _arguments[_state - 1];
                        asap(function () {
                            return invokeCallback(_state, child, callback, parent._result);
                        });
                    }());
                } else {
                    subscribe(parent, child, onFulfillment, onRejection);
                }
                return child;
            }
            function resolve(object) {
                var Constructor = this;
                if (object && typeof object === 'object' && object.constructor === Constructor) {
                    return object;
                }
                var promise = new Constructor(noop);
                _resolve(promise, object);
                return promise;
            }
            var PROMISE_ID = Math.random().toString(36).substring(16);
            function noop() {
            }
            var PENDING = void 0;
            var FULFILLED = 1;
            var REJECTED = 2;
            var GET_THEN_ERROR = new ErrorObject();
            function selfFulfillment() {
                return new TypeError('You cannot resolve a promise with itself');
            }
            function cannotReturnOwn() {
                return new TypeError('A promises callback cannot return that same promise.');
            }
            function getThen(promise) {
                try {
                    return promise.then;
                } catch (error) {
                    GET_THEN_ERROR.error = error;
                    return GET_THEN_ERROR;
                }
            }
            function tryThen(then, value, fulfillmentHandler, rejectionHandler) {
                try {
                    then.call(value, fulfillmentHandler, rejectionHandler);
                } catch (e) {
                    return e;
                }
            }
            function handleForeignThenable(promise, thenable, then) {
                asap(function (promise) {
                    var sealed = false;
                    var error = tryThen(then, thenable, function (value) {
                        if (sealed) {
                            return;
                        }
                        sealed = true;
                        if (thenable !== value) {
                            _resolve(promise, value);
                        } else {
                            fulfill(promise, value);
                        }
                    }, function (reason) {
                        if (sealed) {
                            return;
                        }
                        sealed = true;
                        _reject(promise, reason);
                    }, 'Settle: ' + (promise._label || ' unknown promise'));
                    if (!sealed && error) {
                        sealed = true;
                        _reject(promise, error);
                    }
                }, promise);
            }
            function handleOwnThenable(promise, thenable) {
                if (thenable._state === FULFILLED) {
                    fulfill(promise, thenable._result);
                } else if (thenable._state === REJECTED) {
                    _reject(promise, thenable._result);
                } else {
                    subscribe(thenable, undefined, function (value) {
                        return _resolve(promise, value);
                    }, function (reason) {
                        return _reject(promise, reason);
                    });
                }
            }
            function handleMaybeThenable(promise, maybeThenable, then$$) {
                if (maybeThenable.constructor === promise.constructor && then$$ === then && maybeThenable.constructor.resolve === resolve) {
                    handleOwnThenable(promise, maybeThenable);
                } else {
                    if (then$$ === GET_THEN_ERROR) {
                        _reject(promise, GET_THEN_ERROR.error);
                        GET_THEN_ERROR.error = null;
                    } else if (then$$ === undefined) {
                        fulfill(promise, maybeThenable);
                    } else if (isFunction(then$$)) {
                        handleForeignThenable(promise, maybeThenable, then$$);
                    } else {
                        fulfill(promise, maybeThenable);
                    }
                }
            }
            function _resolve(promise, value) {
                if (promise === value) {
                    _reject(promise, selfFulfillment());
                } else if (objectOrFunction(value)) {
                    handleMaybeThenable(promise, value, getThen(value));
                } else {
                    fulfill(promise, value);
                }
            }
            function publishRejection(promise) {
                if (promise._onerror) {
                    promise._onerror(promise._result);
                }
                publish(promise);
            }
            function fulfill(promise, value) {
                if (promise._state !== PENDING) {
                    return;
                }
                promise._result = value;
                promise._state = FULFILLED;
                if (promise._subscribers.length !== 0) {
                    asap(publish, promise);
                }
            }
            function _reject(promise, reason) {
                if (promise._state !== PENDING) {
                    return;
                }
                promise._state = REJECTED;
                promise._result = reason;
                asap(publishRejection, promise);
            }
            function subscribe(parent, child, onFulfillment, onRejection) {
                var _subscribers = parent._subscribers;
                var length = _subscribers.length;
                parent._onerror = null;
                _subscribers[length] = child;
                _subscribers[length + FULFILLED] = onFulfillment;
                _subscribers[length + REJECTED] = onRejection;
                if (length === 0 && parent._state) {
                    asap(publish, parent);
                }
            }
            function publish(promise) {
                var subscribers = promise._subscribers;
                var settled = promise._state;
                if (subscribers.length === 0) {
                    return;
                }
                var child = undefined, callback = undefined, detail = promise._result;
                for (var i = 0; i < subscribers.length; i += 3) {
                    child = subscribers[i];
                    callback = subscribers[i + settled];
                    if (child) {
                        invokeCallback(settled, child, callback, detail);
                    } else {
                        callback(detail);
                    }
                }
                promise._subscribers.length = 0;
            }
            function ErrorObject() {
                this.error = null;
            }
            var TRY_CATCH_ERROR = new ErrorObject();
            function tryCatch(callback, detail) {
                try {
                    return callback(detail);
                } catch (e) {
                    TRY_CATCH_ERROR.error = e;
                    return TRY_CATCH_ERROR;
                }
            }
            function invokeCallback(settled, promise, callback, detail) {
                var hasCallback = isFunction(callback), value = undefined, error = undefined, succeeded = undefined, failed = undefined;
                if (hasCallback) {
                    value = tryCatch(callback, detail);
                    if (value === TRY_CATCH_ERROR) {
                        failed = true;
                        error = value.error;
                        value.error = null;
                    } else {
                        succeeded = true;
                    }
                    if (promise === value) {
                        _reject(promise, cannotReturnOwn());
                        return;
                    }
                } else {
                    value = detail;
                    succeeded = true;
                }
                if (promise._state !== PENDING) {
                } else if (hasCallback && succeeded) {
                    _resolve(promise, value);
                } else if (failed) {
                    _reject(promise, error);
                } else if (settled === FULFILLED) {
                    fulfill(promise, value);
                } else if (settled === REJECTED) {
                    _reject(promise, value);
                }
            }
            function initializePromise(promise, resolver) {
                try {
                    resolver(function resolvePromise(value) {
                        _resolve(promise, value);
                    }, function rejectPromise(reason) {
                        _reject(promise, reason);
                    });
                } catch (e) {
                    _reject(promise, e);
                }
            }
            var id = 0;
            function nextId() {
                return id++;
            }
            function makePromise(promise) {
                promise[PROMISE_ID] = id++;
                promise._state = undefined;
                promise._result = undefined;
                promise._subscribers = [];
            }
            function Enumerator(Constructor, input) {
                this._instanceConstructor = Constructor;
                this.promise = new Constructor(noop);
                if (!this.promise[PROMISE_ID]) {
                    makePromise(this.promise);
                }
                if (isArray(input)) {
                    this._input = input;
                    this.length = input.length;
                    this._remaining = input.length;
                    this._result = new Array(this.length);
                    if (this.length === 0) {
                        fulfill(this.promise, this._result);
                    } else {
                        this.length = this.length || 0;
                        this._enumerate();
                        if (this._remaining === 0) {
                            fulfill(this.promise, this._result);
                        }
                    }
                } else {
                    _reject(this.promise, validationError());
                }
            }
            function validationError() {
                return new Error('Array Methods must be provided an Array');
            }
            Enumerator.prototype._enumerate = function () {
                var length = this.length;
                var _input = this._input;
                for (var i = 0; this._state === PENDING && i < length; i++) {
                    this._eachEntry(_input[i], i);
                }
            };
            Enumerator.prototype._eachEntry = function (entry, i) {
                var c = this._instanceConstructor;
                var resolve$$ = c.resolve;
                if (resolve$$ === resolve) {
                    var _then = getThen(entry);
                    if (_then === then && entry._state !== PENDING) {
                        this._settledAt(entry._state, i, entry._result);
                    } else if (typeof _then !== 'function') {
                        this._remaining--;
                        this._result[i] = entry;
                    } else if (c === Promise) {
                        var promise = new c(noop);
                        handleMaybeThenable(promise, entry, _then);
                        this._willSettleAt(promise, i);
                    } else {
                        this._willSettleAt(new c(function (resolve$$) {
                            return resolve$$(entry);
                        }), i);
                    }
                } else {
                    this._willSettleAt(resolve$$(entry), i);
                }
            };
            Enumerator.prototype._settledAt = function (state, i, value) {
                var promise = this.promise;
                if (promise._state === PENDING) {
                    this._remaining--;
                    if (state === REJECTED) {
                        _reject(promise, value);
                    } else {
                        this._result[i] = value;
                    }
                }
                if (this._remaining === 0) {
                    fulfill(promise, this._result);
                }
            };
            Enumerator.prototype._willSettleAt = function (promise, i) {
                var enumerator = this;
                subscribe(promise, undefined, function (value) {
                    return enumerator._settledAt(FULFILLED, i, value);
                }, function (reason) {
                    return enumerator._settledAt(REJECTED, i, reason);
                });
            };
            function all(entries) {
                return new Enumerator(this, entries).promise;
            }
            function race(entries) {
                var Constructor = this;
                if (!isArray(entries)) {
                    return new Constructor(function (_, reject) {
                        return reject(new TypeError('You must pass an array to race.'));
                    });
                } else {
                    return new Constructor(function (resolve, reject) {
                        var length = entries.length;
                        for (var i = 0; i < length; i++) {
                            Constructor.resolve(entries[i]).then(resolve, reject);
                        }
                    });
                }
            }
            function reject(reason) {
                var Constructor = this;
                var promise = new Constructor(noop);
                _reject(promise, reason);
                return promise;
            }
            function needsResolver() {
                throw new TypeError('You must pass a resolver function as the first argument to the promise constructor');
            }
            function needsNew() {
                throw new TypeError('Failed to construct \'Promise\': Please use the \'new\' operator, this object constructor cannot be called as a function.');
            }
            function Promise(resolver) {
                this[PROMISE_ID] = nextId();
                this._result = this._state = undefined;
                this._subscribers = [];
                if (noop !== resolver) {
                    typeof resolver !== 'function' && needsResolver();
                    this instanceof Promise ? initializePromise(this, resolver) : needsNew();
                }
            }
            Promise.all = all;
            Promise.race = race;
            Promise.resolve = resolve;
            Promise.reject = reject;
            Promise._setScheduler = setScheduler;
            Promise._setAsap = setAsap;
            Promise._asap = asap;
            Promise.prototype = {
                constructor: Promise,
                then: then,
                'catch': function _catch(onRejection) {
                    return this.then(null, onRejection);
                }
            };
            function polyfill() {
                var local = undefined;
                if (typeof global !== 'undefined') {
                    local = global;
                } else if (typeof self !== 'undefined') {
                    local = self;
                } else {
                    try {
                        local = Function('return this')();
                    } catch (e) {
                        throw new Error('polyfill failed because global object is unavailable in this environment');
                    }
                }
                var P = local.Promise;
                if (P) {
                    var promiseToString = null;
                    try {
                        promiseToString = Object.prototype.toString.call(P.resolve());
                    } catch (e) {
                    }
                    if (promiseToString === '[object Promise]' && !P.cast) {
                        return;
                    }
                }
                local.Promise = Promise;
            }
            Promise.polyfill = polyfill;
            Promise.Promise = Promise;
            return Promise;
        }));
        ProtocolsXHR = function (Logger, Helper, ES6Promise, require) {
            var XHR = {
                call: function (settings) {
                    ES6Promise.polyfill();
                    if (!settings.url) {
                        throw new Error('missing parameter : url is not defined !');
                    }
                    if (!settings.method) {
                        throw new Error('missing parameter : method is not defined !');
                    }
                    if (!settings.format) {
                        settings.format = 'text';
                    }
                    var options = {};
                    options.url = settings.url;
                    options.data = settings.data ? settings.data : null;
                    options.method = settings.method;
                    options.timeOut = settings.timeOut || 0;
                    options.scope = settings.scope || this;
                    options.proxy = settings.proxy || null;
                    options.content = settings.content || null;
                    options.headers = settings.headers || { referer: 'http://localhost' };
                    switch (settings.method) {
                    case 'DELETE':
                    case 'GET':
                        break;
                    case 'PUT':
                    case 'POST':
                        options.content = settings.content ? settings.content : 'application/x-www-form-urlencoded';
                        options.headers = settings.headers ? settings.headers : { referer: 'http://localhost' };
                        break;
                    case 'HEAD':
                    case 'OPTIONS':
                        throw new Error('HTTP method not yet supported !');
                    default:
                        throw new Error('HTTP method unknown !');
                    }
                    switch (settings.format) {
                    case 'text':
                        this.__call(options).then(function (response) {
                            settings.onResponse.call(this, response);
                        }).catch(function (error) {
                            settings.onFailure.call(this, error);
                        });
                        break;
                    case 'json':
                        this.__callJSON(options).then(function (response) {
                            settings.onResponse.call(this, response);
                        }).catch(function (error) {
                            settings.onFailure.call(this, error);
                        });
                        break;
                    case 'xml':
                        this.__callXML(options).then(function (response) {
                            settings.onResponse.call(this, response);
                        }).catch(function (error) {
                            settings.onFailure.call(this, error);
                        });
                        break;
                    default:
                        throw new Error('This output Format is not yet supported !');
                    }
                },
                __call: function (options) {
                    var promise = new Promise(function (resolve, reject) {
                        var corps = options.method === 'POST' || options.method === 'PUT' ? true : false;
                        if (options.data && (typeof options.data === 'object' && Object.keys(options.data).length || typeof options.data === 'string' && options.data.length) && !corps) {
                            options.url = Helper.normalyzeUrl(options.url, options.data);
                        }
                        var hXHR = null;
                        if (typeof window === 'undefined') {
                            var req = request;
                            if (options.data && typeof options.data === 'string' && corps) {
                                options.body = options.data;
                            }
                            req(options, function (error, response, body) {
                                if (!error && response.statusCode == 200 && body) {
                                    resolve(body);
                                } else {
                                    reject('Errors Occured on Http Request (nodejs) : ' + body);
                                }
                            });
                        } else {
                            if (window.XMLHttpRequest) {
                                hXHR = new XMLHttpRequest();
                                hXHR.open(options.method, options.url, true);
                                hXHR.overrideMimeType = options.content;
                                var onTimeOutTrigger = null;
                                if (options.timeOut > 0) {
                                    onTimeOutTrigger = window.setTimeout(function () {
                                        var message = 'TimeOut Occured on Http Request with XMLHttpRequest !';
                                        reject({
                                            message: message,
                                            status: -1
                                        });
                                    }, options.timeOut);
                                }
                                if (corps) {
                                    hXHR.setRequestHeader('Content-type', options.content);
                                }
                                hXHR.onerror = function (e) {
                                    console.log(e);
                                    reject(new Error('Errors Occured on Http Request with XMLHttpRequest !'));
                                };
                                hXHR.ontimeout = function () {
                                    reject(new Error('TimeOut Occured on Http Request with XMLHttpRequest !'));
                                };
                                hXHR.onreadystatechange = function () {
                                    if (hXHR.readyState == 4) {
                                        if (hXHR.status == 200) {
                                            window.clearTimeout(onTimeOutTrigger);
                                            resolve(hXHR.response);
                                        } else {
                                            var message = 'Errors Occured on Http Request (status : \'' + hXHR.status + '\' | response : \'' + hXHR.response + '\')';
                                            var status = hXHR.status;
                                            reject({
                                                message: message,
                                                status: status
                                            });
                                        }
                                    }
                                };
                                var data4xhr = options.data && corps ? options.data : null;
                                hXHR.send(data4xhr);
                            } else if (window.XDomainRequest) {
                                hXHR = new XDomainRequest();
                                hXHR.open(options.method, options.url);
                                hXHR.overrideMimeType = options.content;
                                if (options.timeOut > 0) {
                                    hXHR.timeout = options.timeout;
                                }
                                if (corps) {
                                    hXHR.setRequestHeader('Content-type', options.content);
                                }
                                hXHR.onerror = function () {
                                    reject(new Error('Errors Occured on Http Request with XMLHttpRequest !'));
                                };
                                hXHR.ontimeout = function () {
                                    reject(new Error('TimeOut Occured on Http Request with XMLHttpRequest !'));
                                };
                                hXHR.onload = function () {
                                    if (hXHR.status == 200) {
                                        resolve(hXHR.responseText);
                                    } else {
                                        var message = 'Errors Occured on Http Request (status : \'' + hXHR.status + '\' | response : \'' + hXHR.responseText + '\')';
                                        var status = hXHR.status;
                                        reject({
                                            message: message,
                                            status: status
                                        });
                                    }
                                };
                                var data4xdr = options.data && corps ? options.data : null;
                                hXHR.send(data4xdr);
                            } else {
                                throw new Error('CORS not supported');
                            }
                        }
                    });
                    return promise;
                },
                __callJSON: function (options) {
                    return this.__call(options).then(JSON.parse).catch(function (error) {
                        console.log('_callJSON failed on : ', options.url, error);
                        throw error;
                    });
                },
                __callXML: function (options) {
                    return this.__call(options).then(function (response) {
                        var xmlDoc;
                        if (typeof window === 'undefined') {
                            var DOMParser = xmldom.DOMParser;
                            xmlDoc = new DOMParser().parseFromString(response, 'text/xml');
                        } else {
                            if (window.DOMParser) {
                                var parser = new window.DOMParser();
                                xmlDoc = parser.parseFromString(response, 'text/xml');
                            } else {
                                xmlDoc = new window.ActiveXObject('Microsoft.XMLDOM');
                                xmlDoc.async = false;
                                xmlDoc.loadXML(response);
                            }
                        }
                        return xmlDoc;
                    }).catch(function (error) {
                        console.log('__callXML failed on : ', options.url, error);
                        throw error;
                    });
                }
            };
            return XHR;
        }(UtilsLoggerByDefault, UtilsHelper, es6Promise, {});
        UtilsMessagesResources = function () {
            var MessagesResources = {
                PARAM_MISSING: 'Parameter(s) \'%var%\' missing',
                PARAM_EMPTY: 'Parameter(s) \'%var%\' empty',
                PARAM_TYPE: 'Wrong type(s) for parameter(s) \'%var%\'',
                PARAM_FORMAT: 'Parameter(s) \'%var%\' not correctly formatted',
                PARAM_NOT_SUPPORT: 'Value(s) for parameter(s) \'%var%\' not supported',
                PARAM_NOT_SUPPORT_NODEJS: 'Value(s) for parameter(s) \'%var%\' not supported to NodeJS',
                PARAM_UNKNOWN: 'Value(s) for parameter(s) \'%var%\' unknown',
                SERVICE_REQUEST_BUILD: 'An error occurred during the request building of the service',
                SERVICE_REQUEST_EMPTY: 'The request sent to the service is empty',
                SERVICE_RESPONSE_EXCEPTION: 'The service returned an exception : \'%var%\'',
                SERVICE_RESPONSE_EXCEPTION_2: 'The service returned an exception',
                SERVICE_RESPONSE_ANALYSE: 'An error occurred while parsing the response \'%var%\' of the service',
                SERVICE_RESPONSE_ANALYSE_2: 'An unknown error occurred while parsing the response',
                SERVICE_RESPONSE_EMPTY: 'The response of the service is empty',
                SERVICE_RESPONSE_EMPTY_2: 'The response from the service could not be analyzed or is empty',
                SERVICE_RESPONSE_FORMAT: 'The format of the service response is not supported (handled format(s) : \'%var%\')',
                SERVICE_RESPONSE_FORMAT_2: 'The format of the service response is not supported',
                SERVICE_RESPONSE_FORMAT_3: 'No suggestion matching the search',
                CLASS_CONSTRUCTOR: '\'%var%\' constructor cannot be called as a function.',
                getMessage: function (clef, parametres) {
                    if (!arguments) {
                        return 'Message indefined !';
                    }
                    var params = Array.prototype.slice.call(arguments);
                    var key = params.shift();
                    var args = params;
                    var message = this[key];
                    try {
                        if (Array.isArray(args) && args.length > 0) {
                            message = message.replace('%var%', args.join(' - '));
                        } else {
                            message = message.replace('%var%', '%var% (not specified)');
                        }
                    } catch (e) {
                    }
                    return message;
                }
            };
            return MessagesResources;
        }();
        ExceptionsErrorService = function () {
            function ErrorService(error) {
                if (!(this instanceof ErrorService)) {
                    throw new TypeError('ErrorService constructor cannot be called as a function.');
                }
                var e = error;
                if (typeof error === 'string' || error instanceof String) {
                    this.message = error;
                    this.status = -1;
                    this.type = ErrorService.TYPE_UNKERR;
                } else {
                    this.message = e.message || 'undefined!?';
                    this.type = e.type;
                    this.status = e.status || -1;
                }
                this.name = 'ErrorService';
                this.stack = new Error().stack;
            }
            ErrorService.TYPE_SRVERR = 'SERVICE_ERROR';
            ErrorService.TYPE_USEERR = 'USAGE_ERROR';
            ErrorService.TYPE_UNKERR = 'UNKNOWN_ERROR';
            ErrorService.prototype = Object.create(Error.prototype, {
                constructor: {
                    value: ErrorService,
                    writable: true,
                    configurable: true
                }
            });
            return ErrorService;
        }();
        ProtocolsJSONP = function (Logger) {
            var JSONP = {
                uuid: function () {
                    var id = Math.floor(Date.now());
                    return function () {
                        return id++;
                    };
                }(),
                call: function (options) {
                    if (!options) {
                        throw new Error('missing parameter : options !');
                    }
                    if (!options.url) {
                        throw new Error('missing parameter : options.url !');
                    }
                    if (!options.timeOut) {
                        options.timeOut = 0;
                    }
                    if (!options.onResponse) {
                        throw new Error('missing parameter : options.onResponse !');
                    }
                    var callbackId = typeof options.callbackSuffix === 'string' ? options.callbackSuffix : this.uuid();
                    var urlHasCallbackKey = false;
                    var urlHasCallbackName = false;
                    var idx = options.url.indexOf('callback=');
                    if (idx != -1) {
                        urlHasCallbackKey = true;
                        var j = options.url.indexOf('&', idx);
                        if (j === -1) {
                            j = options.url.length;
                        }
                        var callbackName = options.url.substring(idx + 9, j);
                        if (callbackName) {
                            urlHasCallbackName = true;
                            options.callbackName = callbackName;
                        }
                    }
                    if (!urlHasCallbackKey) {
                        var k = options.url.indexOf('?');
                        if (k === -1) {
                            options.url = options.url + '?' + 'callback=';
                        } else if (k === options.url.length) {
                            options.url = options.url + 'callback=';
                        } else {
                            options.url = options.url + '&' + 'callback=';
                        }
                    }
                    var HasCallbackName = options.callbackName ? true : urlHasCallbackName;
                    if (!urlHasCallbackName) {
                        if (!options.callbackName) {
                            options.callbackName = 'callback';
                            if (callbackId || callbackId === '') {
                                options.callbackName += callbackId;
                            }
                        }
                        options.url = options.url.replace('callback=', 'callback=' + options.callbackName);
                    }
                    if (!options.onTimeOut) {
                        options.onTimeOut = function () {
                            console.log('TimeOut while invoking url : ' + options.url);
                        };
                    }
                    if (!HasCallbackName) {
                        var self = this;
                        var onTimeOutTrigger = null;
                        if (options.timeOut > 0) {
                            onTimeOutTrigger = window.setTimeout(function () {
                                window[options.callbackName] = function () {
                                };
                                options.onTimeOut();
                                self._deleteScript(callbackId);
                            }, options.timeOut);
                        }
                        window[options.callbackName] = function (data) {
                            window.clearTimeout(onTimeOutTrigger);
                            options.onResponse(data);
                            self._deleteScript(callbackId);
                        };
                    }
                    this._createScript(callbackId, options.url);
                },
                _createScript: function (callbackId, url) {
                    var scriptu;
                    var scripto = document.getElementById('results' + callbackId);
                    scriptu = document.createElement('script');
                    scriptu.setAttribute('type', 'text/javascript');
                    scriptu.setAttribute('src', url);
                    scriptu.setAttribute('charset', 'UTF-8');
                    scriptu.setAttribute('id', 'results' + callbackId);
                    scriptu.setAttribute('async', 'true');
                    var node = document.documentElement || document.getElementsByTagName('head')[0];
                    if (scripto === null) {
                        node.appendChild(scriptu);
                    } else {
                        node.replaceChild(scriptu, scripto);
                    }
                },
                _deleteScript: function (callbackId) {
                    var script = document.getElementById('results' + callbackId);
                    if (script) {
                        var node = script.parentNode || document.documentElement;
                        if (!node) {
                            return;
                        }
                        node.removeChild(script);
                    }
                }
            };
            return JSONP;
        }(UtilsLoggerByDefault);
        ProtocolsProtocol = function (Helper, XHR, JSONP) {
            var Protocol = {
                send: function (options) {
                    var settings = options || {
                        method: 'GET',
                        protocol: 'XHR',
                        timeOut: 0,
                        format: null,
                        wrap: true,
                        nocache: true,
                        output: 'json',
                        callback: null,
                        callbackSuffix: null
                    };
                    if (typeof window === 'undefined' && options.protocol === 'JSONP') {
                        console.log('Value(s) for parameter(s) \'protocol=JSONP (instead use XHR)\' not supported to NodeJS');
                        return;
                    }
                    if (options.protocol === 'XHR' || options.format === 'json') {
                        settings.wrap = false;
                    } else if (options.protocol === 'JSONP' && options.format === 'xml') {
                        settings.wrap = true;
                    }
                    settings.callback = options.protocol == 'JSONP' ? null : null;
                    settings.output = settings.wrap ? 'json' : null;
                    if (settings.wrap) {
                        var params = {};
                        params.output = settings.output;
                        params.callback = settings.callback;
                        delete params.callback;
                        settings.url = Helper.normalyzeUrl(options.url, params);
                    }
                    switch (settings.protocol) {
                    case 'XHR':
                        if (options.method === 'GET' && options.nocache) {
                            settings.url = Helper.normalyzeUrl(settings.url, { t: new Date().getTime() });
                        }
                        XHR.call(settings);
                        break;
                    case 'JSONP':
                        if (settings.data) {
                            settings.url = Helper.normalyzeUrl(settings.url, settings.data);
                        }
                        JSONP.call(settings);
                        break;
                    default:
                        throw new Error('protocol not supported (XHR|JSONP) !');
                    }
                }
            };
            return Protocol;
        }(UtilsHelper, ProtocolsXHR, ProtocolsJSONP);
        ServicesDefaultUrlService = function () {
            var isBrowser = typeof window !== 'undefined' ? true : false;
            var protocol = isBrowser ? location && location.protocol && location.protocol.indexOf('https:') === 0 ? 'https://' : 'http://' : 'http://';
            var hostname = 'wxs.ign.fr';
            var keyname = '%KEY%';
            var url = protocol + hostname.concat('/', keyname);
            var fkey = function (key) {
                return this._key.replace(key ? keyname : null, key);
            };
            var DefaultUrlService = {
                Alti: {
                    _key: {
                        'elevation-json': url + '/alti/rest/elevation.json',
                        'elevation-xml': url + '/alti/rest/elevation.xml',
                        'profil-json': url + '/alti/rest/elevationLine.json',
                        'profil-xml': url + '/alti/rest/elevationLine.xml',
                        wps: url + '/alti/wps'
                    },
                    url: function (key) {
                        return {
                            'elevation-json': this._key['elevation-json'].replace(key ? keyname : null, key),
                            'elevation-xml': this._key['elevation-xml'].replace(key ? keyname : null, key),
                            'profil-json': this._key['profil-json'].replace(key ? keyname : null, key),
                            'profil-xml': this._key['profil-xml'].replace(key ? keyname : null, key),
                            wps: this._key.wps.replace(key ? keyname : null, key)
                        };
                    }
                },
                ProcessIsoCurve: {
                    _key: {
                        'iso-json': url + '/isochrone/isochrone.json',
                        'iso-xml': url + '/isochrone/isochrone.xml'
                    },
                    url: function (key) {
                        return {
                            'iso-json': this._key['iso-json'].replace(key ? keyname : null, key),
                            'iso-xml': this._key['iso-xml'].replace(key ? keyname : null, key)
                        };
                    }
                },
                AutoComplete: {
                    _key: url + '/ols/apis/completion',
                    url: fkey
                },
                ReverseGeocode: {
                    _key: url + '/geoportail/ols',
                    url: fkey
                },
                AutoConf: {
                    _key: {
                        apiKey: url + '/autoconf',
                        apiKeys: url + '/autoconf?keys=%KEYS%'
                    },
                    url: function (key) {
                        var keys = '';
                        if (Array.isArray(key) && key.length > 0) {
                            keys = key[0];
                            for (var i = 1; i < key.length; i++) {
                                keys += ',' + key[i];
                            }
                        }
                        return {
                            apiKey: this._key['apiKey'].replace(key ? keyname : null, key),
                            apiKeys: this._key['apiKeys'].replace(keyname, key[0]).replace('%KEYS%', keys),
                            aggregate: protocol + hostname.concat('/') + key + '/autoconf/id/'
                        };
                    }
                },
                Geocode: {
                    _key: url + '/geoportail/ols',
                    url: fkey
                },
                Route: {
                    _key: {
                        ols: url + '/itineraire/ols',
                        'route-json': url + '/itineraire/rest/route.json',
                        'route-xml': url + '/itineraire/rest/route.xml'
                    },
                    url: function (key) {
                        return {
                            ols: this._key.ols.replace(key ? keyname : null, key),
                            'route-json': this._key['route-json'].replace(key ? keyname : null, key),
                            'route-xml': this._key['route-xml'].replace(key ? keyname : null, key)
                        };
                    }
                }
            };
            return DefaultUrlService;
        }();
        ServicesCommonService = function (Logger, Helper, _, Protocol, ErrorService, DefaultUrlService) {
            function CommonService(options) {
                if (!(this instanceof CommonService)) {
                    throw new TypeError(_.getMessage('CLASS_CONSTRUCTOR'));
                }
                this.options = {
                    protocol: 'XHR',
                    proxyURL: '',
                    callbackSuffix: null,
                    httpMethod: 'GET',
                    timeOut: 0,
                    rawResponse: false,
                    scope: this,
                    onSuccess: function (response) {
                        console.log('onSuccess - la reponse est la suivante : ', response);
                    },
                    onFailure: function (error) {
                        if (error.status === 200 || !error.status) {
                            console.log('onFailure : ', error.message);
                        } else {
                            console.log('onFailure - Erreur (', error.status, ') : ', error.message);
                        }
                    }
                };
                for (var opt in options) {
                    if (options.hasOwnProperty(opt)) {
                        this.options[opt] = options[opt];
                    }
                }
                if (!this.options.apiKey && !this.options.serverUrl) {
                    throw new Error(_.getMessage('PARAM_MISSING', 'apiKey', 'serverUrl'));
                }
                if (this.options.rawResponse && !this.options.onSuccess) {
                    this.options.onSuccess = function (response) {
                        console.log('onSuccess - la réponse brute du service est la suivante : ', response);
                    };
                }
                var bOnSuccess = this.options.onSuccess !== null && typeof this.options.onSuccess === 'function' ? true : false;
                if (!bOnSuccess) {
                    throw new Error(_.getMessage('PARAM_MISSING', 'onSuccess()'));
                }
                if (!this.options.serverUrl) {
                    var urlByDefault = DefaultUrlService[this.CLASSNAME].url(this.options.apiKey);
                    if (typeof urlByDefault === 'string') {
                        this.options.serverUrl = urlByDefault;
                    } else {
                    }
                }
                this.options.httpMethod = typeof options.httpMethod === 'string' ? options.httpMethod.toUpperCase() : 'GET';
                switch (this.options.httpMethod) {
                case 'POST':
                case 'GET':
                    break;
                case 'PUT':
                case 'DELETE':
                case 'HEAD':
                case 'OPTIONS':
                    throw new Error(_.getMessage('PARAM_NOT_SUPPORT', 'httpMethod'));
                default:
                    throw new Error(_.getMessage('PARAM_UNKNOWN', 'httpMethod'));
                }
                this.options.protocol = typeof options.protocol === 'string' ? options.protocol.toUpperCase() : 'XHR';
                switch (this.options.protocol) {
                case 'JSONP':
                case 'XHR':
                    break;
                default:
                    throw new Error(_.getMessage('PARAM_UNKNOWN', 'protocol'));
                }
                if (typeof window === 'undefined' && this.options.protocol === 'JSONP') {
                    throw new Error(_.getMessage('PARAM_NOT_SUPPORT_NODEJS', 'protocol=JSONP (instead use XHR)'));
                }
                if (this.options.protocol === 'JSONP') {
                    this.options.httpMethod = 'GET';
                }
                this.options.nocache = options.nocache || false;
                this.options.outputFormat = null;
                this.request = null;
                this.response = null;
            }
            CommonService.prototype = {
                constructor: CommonService,
                call: function () {
                    function run() {
                        this.buildRequest.call(this, onError, onBuildRequest);
                    }
                    run.call(this);
                    function onBuildRequest(result) {
                        this.callService.call(this, onError, onCallService);
                    }
                    function onCallService(result) {
                        this.analyzeResponse.call(this, onError, onAnalyzeResponse);
                    }
                    function onAnalyzeResponse(result) {
                        if (result) {
                            this.options.onSuccess.call(this, result);
                        } else {
                            return onError.call(this, new ErrorService('Analyse de la reponse en échec !?'));
                        }
                    }
                    function onError(error) {
                        var e = error;
                        if (!(e instanceof ErrorService)) {
                            e = new ErrorService(error.message);
                        }
                        this.options.onFailure.call(this, e);
                    }
                },
                buildRequest: function (error, success) {
                },
                callService: function (error, success) {
                    var strUrlProxified = null;
                    var strData = this.request;
                    var bUrlProxified = this.options.proxyURL && this.options.protocol === 'XHR' ? true : false;
                    this.options.serverUrl = Helper.normalyzeUrl(this.options.serverUrl, { 'gp-access-lib': '1.1.0' }, false);
                    if (bUrlProxified) {
                        if (this.options.httpMethod === 'GET') {
                            strUrlProxified = this.options.proxyURL + Helper.normalyzeUrl(this.options.serverUrl, this.request, true);
                            strData = null;
                        }
                        if (this.options.httpMethod === 'POST') {
                            strUrlProxified = this.options.proxyURL + Helper.normalyzeUrl(this.options.serverUrl, null, true);
                            strData = this.request;
                        }
                    }
                    var self = this;
                    var options = {
                        url: strUrlProxified || this.options.serverUrl,
                        method: this.options.httpMethod,
                        protocol: this.options.protocol,
                        timeOut: this.options.timeOut || 0,
                        format: this.options.outputFormat,
                        nocache: this.options.nocache || false,
                        wrap: this.options.protocol === 'XHR' ? false : true,
                        callbackSuffix: this.options.callbackSuffix,
                        data: strData,
                        headers: null,
                        content: this.options.contentType || 'application/xml',
                        scope: this.options.scope || this,
                        onResponse: function (response) {
                            var content = null;
                            if (self.options.protocol == 'XHR') {
                                content = response;
                            }
                            if (self.options.protocol == 'JSONP') {
                                if (response) {
                                    if (response.http) {
                                        if (response.http.status !== 200) {
                                            error.call(self, new ErrorService({
                                                status: response.http.status,
                                                message: response.http.error,
                                                type: ErrorService.TYPE_SRVERR
                                            }));
                                            return;
                                        } else {
                                            content = response.xml;
                                            if (self.options.rawResponse) {
                                                content = response;
                                            }
                                            if (typeof self.options.onBeforeParse === 'function') {
                                                var newResponse = self.options.onBeforeParse(content);
                                                if (typeof newResponse === 'string') {
                                                    content = newResponse;
                                                }
                                            }
                                        }
                                    } else {
                                        content = response;
                                    }
                                } else {
                                    error.call(self, new ErrorService('Le contenu de la reponse est vide !?'));
                                    return;
                                }
                            }
                            self.response = content;
                            success.call(self, content);
                        },
                        onFailure: function (e) {
                            e.type = ErrorService.TYPE_SRVERR;
                            error.call(self, new ErrorService(e));
                        },
                        onTimeOut: function () {
                            error.call(self, new ErrorService('TimeOut!'));
                        }
                    };
                    Protocol.send(options);
                },
                analyzeResponse: function (error, success) {
                }
            };
            return CommonService;
        }(UtilsLoggerByDefault, UtilsHelper, UtilsMessagesResources, ProtocolsProtocol, ExceptionsErrorService, ServicesDefaultUrlService);
        ServicesAltiRequestModelAltiRequest = function (Logger) {
            function AltiRequest(options) {
                if (!(this instanceof AltiRequest)) {
                    throw new TypeError('AltiRequest constructor cannot be called as a function.');
                }
                this.options = options || {};
                this.positions = this.options.positions || [];
                this.delimiter = this.options.delimiter || '|';
                this.indent = this.options.indent || false;
                this.crs = this.options.crs || 'CRS:84';
                this.format = this.options.format || 'json';
            }
            AltiRequest.CLASSNAME = 'AltiRequest';
            AltiRequest.prototype = {
                constructor: AltiRequest,
                setPositions: function (lstPosition) {
                    var positions = [];
                    for (var i = 0; i < lstPosition.length; i++) {
                        var o = lstPosition[i];
                        if (o.lon && o.lat) {
                            positions.push(o);
                        }
                    }
                    this.positions = positions;
                },
                getPositions: function (pos) {
                    if (!pos) {
                        return this.positions;
                    }
                    var index = this.positions.length - 1;
                    if (pos > index || pos < index) {
                        return this.positions;
                    }
                    return this.positions[pos];
                },
                addPositions: function (lstPosition) {
                    for (var i = 0; i < lstPosition.length; i++) {
                        var o = lstPosition[i];
                        if (o.lon && o.lat) {
                            this.positions.push(lstPosition[i]);
                        }
                    }
                },
                getLon: function () {
                    var lstLon = [];
                    for (var i = 0; i < this.positions.length; i++) {
                        lstLon.push(this.positions[i].lon);
                    }
                    return lstLon.join(this.delimiter);
                },
                getLat: function () {
                    var lstLat = [];
                    for (var i = 0; i < this.positions.length; i++) {
                        lstLat.push(this.positions[i].lat);
                    }
                    return lstLat.join(this.delimiter);
                }
            };
            AltiRequest.prototype.getData = function () {
                var map = [];
                map.push({
                    k: 'lon',
                    v: this.getLon()
                });
                map.push({
                    k: 'lat',
                    v: this.getLat()
                });
                map.push({
                    k: 'delimiter',
                    v: this.delimiter
                });
                map.push({
                    k: 'indent',
                    v: this.indent
                });
                map.push({
                    k: 'crs',
                    v: this.crs
                });
                map.push({
                    k: 'format',
                    v: this.format
                });
                return map;
            };
            return AltiRequest;
        }(UtilsLoggerByDefault);
        ServicesAltiRequestModelAltiElevationRequest = function (Logger, AltiRequest) {
            function AltiElevationRequest(options) {
                if (!(this instanceof AltiElevationRequest)) {
                    throw new TypeError('AltiElevationRequest constructor cannot be called as a function.');
                }
                this.CLASSNAME = 'AltiElevationRequest';
                AltiRequest.apply(this, arguments);
                this.zonly = this.options.zonly || false;
            }
            AltiElevationRequest.prototype = Object.create(AltiRequest.prototype, {
                zonly: {
                    get: function () {
                        return this._zonly;
                    },
                    set: function (z) {
                        this._zonly = z;
                    }
                }
            });
            AltiElevationRequest.prototype.constructor = AltiElevationRequest;
            AltiElevationRequest.prototype.getData = function () {
                var map = [];
                map.push({
                    k: 'lon',
                    v: this.getLon()
                });
                map.push({
                    k: 'lat',
                    v: this.getLat()
                });
                map.push({
                    k: 'indent',
                    v: this.indent
                });
                map.push({
                    k: 'crs',
                    v: this.crs
                });
                map.push({
                    k: 'zonly',
                    v: this.zonly
                });
                map.push({
                    k: 'format',
                    v: this.format
                });
                return map;
            };
            return AltiElevationRequest;
        }(UtilsLoggerByDefault, ServicesAltiRequestModelAltiRequest);
        ServicesAltiRequestModelAltiProfilRequest = function (Logger, AltiRequest) {
            function AltiProfilRequest(options) {
                if (!(this instanceof AltiProfilRequest)) {
                    throw new TypeError('AltiProfilRequest constructor cannot be called as a function.');
                }
                this.CLASSNAME = 'AltiProfilRequest';
                AltiRequest.apply(this, arguments);
                this.sampling = this.options.sampling || 3;
            }
            AltiProfilRequest.prototype = Object.create(AltiRequest.prototype, {
                sampling: {
                    get: function () {
                        return this._sampling;
                    },
                    set: function (value) {
                        this._sampling = value;
                    }
                }
            });
            AltiProfilRequest.prototype.constructor = AltiProfilRequest;
            AltiProfilRequest.prototype.getData = function () {
                var map = [];
                map.push({
                    k: 'lon',
                    v: this.getLon()
                });
                map.push({
                    k: 'lat',
                    v: this.getLat()
                });
                map.push({
                    k: 'indent',
                    v: this.indent
                });
                map.push({
                    k: 'crs',
                    v: this.crs
                });
                map.push({
                    k: 'sampling',
                    v: this.sampling
                });
                map.push({
                    k: 'format',
                    v: this.format
                });
                return map;
            };
            return AltiProfilRequest;
        }(UtilsLoggerByDefault, ServicesAltiRequestModelAltiRequest);
        ServicesAltiRequestAltiRequestREST = function (Logger, _, AltiElevationRequest, AltiProfilRequest) {
            function AltiRequestREST(options) {
                if (!(this instanceof AltiRequestREST)) {
                    throw new TypeError('AltiRequestREST constructor cannot be called as a function.');
                }
                this.options = options || {};
                if (!this.options) {
                    throw new Error(_.getMessage('PARAM_EMPTY', 'options'));
                }
                if (!this.options.type) {
                    throw new Error(_.getMessage('PARAM_EMPTY', 'type (Elevation or Profil)'));
                }
                this.DataObject = null;
                switch (this.options.type) {
                case 'Elevation':
                    this.DataObject = new AltiElevationRequest(this.options.param);
                    break;
                case 'Profil':
                    this.DataObject = new AltiProfilRequest(this.options.param);
                    break;
                default:
                    throw new Error(_.getMessage('PARAM_TYPE', 'type (Elevation or Profil)'));
                }
                this.method = this.options.method || 'GET';
            }
            AltiRequestREST.prototype = {
                requestString: null,
                constructor: AltiRequestREST,
                template: {
                    get: {
                        value: 'lon=__LON__&lat=__LAT__&indent=__INDENT__&crs=\'__CRS__\'',
                        input: {
                            point: '&zonly=__ZONLY__',
                            profil: '&sampling=__SAMPLING__'
                        }
                    },
                    post: {
                        value: 'lon=__LON__\n' + 'lat=__LAT__\n' + 'indent=__INDENT__\n' + 'crs=\'__CRS__\'\n',
                        input: {
                            point: 'zonly=__ZONLY__',
                            profil: 'sampling=__SAMPLING__'
                        }
                    }
                },
                processRequestString: function () {
                    var template = '';
                    if (this.method == 'POST') {
                        template = this.template.post.value;
                    } else if (this.method == 'GET') {
                        template = this.template.get.value;
                    }
                    template = template.replace(/__LON__/g, this.DataObject.getLon());
                    template = template.replace(/__LAT__/g, this.DataObject.getLat());
                    template = template.replace(/__INDENT__/g, this.DataObject.indent);
                    template = template.replace(/__CRS__/g, this.DataObject.crs);
                    template = template + this.__addDataInputs();
                    this.requestString = template;
                    return this.requestString;
                },
                __addDataInputs: function () {
                    var myTemplate;
                    if (this.method == 'POST') {
                        myTemplate = this.template.post;
                    } else if (this.method == 'GET') {
                        myTemplate = this.template.get;
                    } else {
                        throw new Error('No other HTTP method supported by the service !');
                    }
                    var tmpl = null;
                    if (this.DataObject.CLASSNAME == 'AltiElevationRequest') {
                        tmpl = myTemplate.input.point;
                        return tmpl.replace(/__ZONLY__/g, this.DataObject.zonly);
                    } else if (this.DataObject.CLASSNAME == 'AltiProfilRequest') {
                        tmpl = myTemplate.input.profil;
                        return tmpl.replace(/__SAMPLING__/g, this.DataObject.sampling);
                    } else {
                        throw new Error('No other object supported than elevation or profil !?');
                    }
                }
            };
            return AltiRequestREST;
        }(UtilsLoggerByDefault, UtilsMessagesResources, ServicesAltiRequestModelAltiElevationRequest, ServicesAltiRequestModelAltiProfilRequest);
        FormatsWPS = function (Logger) {
            function WPS(options) {
                if (!(this instanceof WPS)) {
                    throw new TypeError('WPS constructor cannot be called as a function.');
                }
                this.options = options || {};
                this.DataObject = this.options.data;
                if (!this.DataObject) {
                    throw new TypeError('This data object is not defined !');
                }
                this.paramservice = this.options.param.service || 'WPS';
                this.paramversion = this.options.param.version || '1.0.0';
                this.paramidentifier = this.options.param.identifier || 'gs:WPS';
                this.paramrawdataoutput = this.options.param.rawdataoutput || 'result';
                this.paramrequest = this.options.param.request || 'Execute';
                this.method = this.options.method || 'GET';
            }
            WPS.prototype = {
                requestString: null,
                constructor: WPS,
                template: {
                    get: {
                        value: 'service=__SERVICE__' + '&version=__VERSION__' + '&rawdataoutput=__RAWDATAOUTPUT__' + '&identifier=__IDENTIFIER__' + '&request=__REQUEST__' + '&datainputs=<!-- __DATAINPUTS__ -->',
                        input: '__KEY__=__DATA__'
                    },
                    post: {
                        value: '<?xml version="1.0" encoding="UTF-8"?>' + '<wps:__REQUEST__ version="__VERSION__" service="__SERVICE__" ' + '__NAMESPACE__ __SCHEMALOCATION__>' + '<ows:Identifier>__IDENTIFIER__</ows:Identifier>' + '<wps:DataInputs>' + '<!-- __DATAINPUTS__ -->' + '</wps:DataInputs>' + '<wps:ResponseForm>' + '<wps:RawDataOutput>' + '<ows:Identifier>__RAWDATAOUTPUT__</ows:Identifier>' + '</wps:RawDataOutput>' + '</wps:ResponseForm>' + '</wps:__REQUEST__>',
                        input: '<wps:Input>' + '<ows:Identifier>__KEY__</ows:Identifier>' + '<wps:Data>' + '<wps:LiteralData>__DATA__</wps:LiteralData>' + '</wps:Data>' + '</wps:Input>'
                    }
                },
                namespaceByDefault: function () {
                    var ns = [
                        'xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"',
                        'xmlns="http://www.opengis.net/wps/1.0.0"',
                        'xmlns:wfs="http://www.opengis.net/wfs"',
                        'xmlns:wps="http://www.opengis.net/wps/1.0.0"',
                        'xmlns:ows="http://www.opengis.net/ows/1.1"',
                        'xmlns:gml="http://www.opengis.net/gml"',
                        'xmlns:ogc="http://www.opengis.net/ogc"',
                        'xmlns:wcs="http://www.opengis.net/wcs/1.1.1"',
                        'xmlns:xlink="http://www.w3.org/1999/xlink"'
                    ];
                    return ns.join(' ');
                },
                schemaLocationByDefault: function () {
                    return 'xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd"';
                },
                processRequestString: function () {
                    var template = '';
                    if (this.method == 'POST') {
                        template = this.template.post.value;
                    } else if (this.method == 'GET') {
                        template = this.template.get.value;
                    } else {
                        return false;
                    }
                    template = template.replace(/__SERVICE__/g, this.paramservice);
                    template = template.replace(/__VERSION__/g, this.paramversion);
                    template = template.replace(/__RAWDATAOUTPUT__/g, this.paramrawdataoutput);
                    template = template.replace(/__IDENTIFIER__/g, this.paramidentifier);
                    template = template.replace(/__REQUEST__/g, this.paramrequest);
                    if (this.method == 'POST') {
                        template = template.replace(/__NAMESPACE__/g, this.namespaceByDefault);
                        template = template.replace(/__SCHEMALOCATION__/g, this.schemaLocationByDefault);
                    }
                    template = template.replace(/<!-- __DATAINPUTS__ -->/g, this.__addDataInputs());
                    if (!template) {
                        return false;
                    }
                    this.requestString = template;
                    return true;
                },
                __addDataInputs: function () {
                    var tmpl = this.method == 'GET' ? this.template.get.input : this.template.post.input;
                    var sep = this.method == 'GET' ? ';' : '';
                    var result = '';
                    var that = this;
                    var map = this.DataObject.getData();
                    for (var i = 0; i < map.length; i++) {
                        (function (j) {
                            if (sep) {
                                sep = j == map.length - 1 ? '' : ';';
                            }
                            result = result.concat(that.__addDataInput(tmpl, map[j].k, map[j].v), sep);
                        }(i));
                    }
                    return result;
                },
                __addDataInput: function (tmpl, key, data) {
                    var tmp = tmpl;
                    tmp = tmp.replace(/__KEY__/g, key);
                    tmp = tmp.replace(/__DATA__/g, data);
                    return tmp;
                },
                setMethod: function (method) {
                    if (method == 'GET' || method == 'POST') {
                        this.method = method;
                    } else {
                    }
                },
                getMethod: function () {
                    return this.method;
                }
            };
            return WPS;
        }(UtilsLoggerByDefault);
        ServicesAltiRequestAltiRequestWPS = function (Logger, _, WPS, AltiElevationRequest, AltiProfilRequest) {
            var AltiRequestWPS = {
                build: function (options) {
                    if (!options) {
                        throw new Error(_.getMessage('PARAM_EMPTY', 'options'));
                    }
                    if (!options.type) {
                        throw new Error(_.getMessage('PARAM_EMPTY', 'type (Elevation or Profil)'));
                    }
                    var DataObject = null;
                    switch (options.type) {
                    case 'Elevation':
                        options.wps.identifier = 'gs:WPSElevation';
                        DataObject = new AltiElevationRequest(options.param);
                        break;
                    case 'Profil':
                        options.wps.identifier = 'gs:WPSLineElevation';
                        DataObject = new AltiProfilRequest(options.param);
                        break;
                    default:
                        throw new Error(_.getMessage('PARAM_TYPE', 'type (Elevation or Profil)'));
                    }
                    var settings = {
                        data: DataObject,
                        method: options.method,
                        param: options.wps
                    };
                    var rqstWPS = new WPS(settings);
                    if (!rqstWPS.processRequestString()) {
                        throw new Error('Enable to process request !');
                    }
                    return rqstWPS.requestString;
                }
            };
            return AltiRequestWPS;
        }(UtilsLoggerByDefault, UtilsMessagesResources, FormatsWPS, ServicesAltiRequestModelAltiElevationRequest, ServicesAltiRequestModelAltiProfilRequest);
        ServicesAltiRequestAltiRequestFactory = function (Logger, ErrorService, AltiRequestREST, AltiRequestWPS) {
            var AltiRequestFactory = {
                build: function (options) {
                    var request = null;
                    var settings = {
                        type: options.sampling ? 'Profil' : 'Elevation',
                        method: options.httpMethod,
                        param: {
                            positions: null,
                            delimiter: null,
                            indent: null,
                            crs: null,
                            format: null,
                            sampling: null,
                            zonly: null
                        }
                    };
                    settings.param.positions = options.positions;
                    settings.param.format = options.outputFormat;
                    settings.param.sampling = options.sampling;
                    settings.param.zonly = options.zonly;
                    var bOnError = options.onError !== null && typeof options.onError === 'function' ? true : false;
                    var bOnSuccess = options.onSuccess !== null && typeof options.onSuccess === 'function' ? true : false;
                    var message = null;
                    switch (options.api) {
                    case 'REST':
                        var myReq = new AltiRequestREST(settings);
                        if (!myReq.processRequestString()) {
                            message = 'Error in process request (rest) !';
                            if (bOnError) {
                                options.onError.call(options.scope, new ErrorService(message));
                                return;
                            }
                            throw new Error(message);
                        }
                        request = myReq.requestString;
                        break;
                    case 'WPS':
                        settings.wps = {
                            service: null,
                            version: null,
                            identifier: null,
                            rawdataoutput: null,
                            request: null
                        };
                        request = AltiRequestWPS.build(settings);
                        if (!request) {
                            message = 'Error in process request (wps) !';
                            if (bOnError) {
                                options.onError.call(options.scope, new ErrorService(message));
                                return;
                            }
                            throw new Error(message);
                        }
                        break;
                    default:
                        message = 'Type of API is not supported by service (REST or WPS) !';
                        if (bOnError) {
                            options.onError.call(options.scope, new ErrorService(message));
                            return;
                        }
                        throw new Error(message);
                    }
                    if (bOnSuccess) {
                        options.onSuccess.call(options.scope, request);
                    }
                    return request;
                }
            };
            return AltiRequestFactory;
        }(UtilsLoggerByDefault, ExceptionsErrorService, ServicesAltiRequestAltiRequestREST, ServicesAltiRequestAltiRequestWPS);
        FormatsXML = function (Logger, require) {
            function XML(options) {
                if (!(this instanceof XML)) {
                    throw new TypeError('XML constructor cannot be called as a function.');
                }
                this.xmlString = null;
                this.xmlDoc = null;
                this.reader = null;
                if (options) {
                    if (options.xmlString && typeof options.xmlString === 'string') {
                        this.xmlString = options.xmlString;
                        this.xmlDoc = __getXMLDOC(options.xmlString);
                    }
                    if (options.reader) {
                        this.setReader(options.reader);
                    }
                }
            }
            XML.prototype = {
                constructor: XML,
                getXMLString: function () {
                    return this.xmlString;
                },
                setXMLString: function (xmlString) {
                    if (xmlString && typeof xmlString === 'string') {
                        this.xmlString = xmlString;
                        this.xmlDoc = __getXMLDOC(xmlString);
                    }
                },
                getReader: function () {
                    return this.reader;
                },
                setReader: function (reader) {
                    if (reader && reader.read && typeof reader.read === 'function') {
                        this.reader = reader;
                    }
                },
                getXMLDoc: function () {
                    return this.xmlDoc;
                },
                setXMLDoc: function (doc) {
                    this.xmlDoc = doc;
                },
                parse: function () {
                    if (!this.xmlDoc && this.xmlString) {
                        this.xmlDoc = __getXMLDOC(this.xmlString);
                    }
                    if (this.xmlDoc) {
                        var root = __getRootNode(this.xmlDoc);
                        if (root) {
                            var parserOutput;
                            if (this.reader && this.reader.read) {
                                parserOutput = this.reader.read(root);
                            } else {
                                parserOutput = {};
                                parserOutput[root.nodeName] = __readDefault(root);
                            }
                            return parserOutput;
                        } else {
                            return {};
                        }
                    }
                }
            };
            function __getXMLDOC(xmlString) {
                if (typeof exports === 'object') {
                    var DOMParser = xmldom.DOMParser;
                    return new DOMParser().parseFromString(xmlString, 'text/xml');
                } else {
                    var parser;
                    var xmlDoc;
                    var errorMsg = 'Erreur lors du parsing de la réponse du service : XML non conforme';
                    if (window.ActiveXObject) {
                        xmlDoc = new window.ActiveXObject('Microsoft.XMLDOM');
                        xmlDoc.async = false;
                        xmlDoc.loadXML(xmlString);
                        var parseError = xmlDoc.parseError;
                        if (parseError.errorCode) {
                            if (parseError.line && parseError.linepos) {
                                errorMsg += '( ligne ' + parseError.line + ', colonne ' + parseError.linepos;
                            }
                            if (parseError.reason) {
                                errorMsg += ':  ' + parseError.reason + ')';
                            }
                            throw new Error(errorMsg);
                        }
                        return xmlDoc;
                    } else if (window.DOMParser) {
                        parser = new window.DOMParser();
                        try {
                            xmlDoc = parser.parseFromString(xmlString, 'text/xml');
                        } catch (e) {
                            if (e.message === 'SyntaxError') {
                                throw new Error(errorMsg);
                            } else {
                                throw new Error('Erreur lors du parsing de la réponse du service : ' + e.message);
                            }
                        }
                        if (xmlDoc.getElementsByTagName('parsererror').length > 0) {
                            var parsererror = xmlDoc.getElementsByTagName('parsererror');
                            for (var i = 0; i < parsererror.length; i++) {
                                var content = parsererror[i].innerHTML;
                                if (content.indexOf('Huge input lookup') == -1) {
                                    errorMsg += '(' + content + ')';
                                    throw new Error(errorMsg);
                                }
                            }
                        } else if (!xmlDoc.documentElement) {
                            throw new Error(errorMsg);
                        }
                        return xmlDoc;
                    } else {
                        throw new Error('Incompatible DOM Parser pour ce navigateur !');
                    }
                }
            }
            function __getRootNode(xmlDoc) {
                var root;
                if (xmlDoc.nodeType === 9) {
                    root = xmlDoc.documentElement;
                } else if (xmlDoc.nodeType === 1) {
                    root = xmlDoc;
                }
                return root;
            }
            function __readDefault(node) {
                var data = {};
                if (node.attributes.length > 0) {
                    var dataAttributes = __getAttributes(node);
                    data['attributes'] = dataAttributes;
                }
                if (node.hasChildNodes()) {
                    var childData = {};
                    var child;
                    var children = node.childNodes;
                    for (var i = 0; i < children.length; i++) {
                        child = children[i];
                        if (child.nodeType === 3) {
                            data['textContent'] = child.nodeValue;
                        } else if (child.nodeType === 1) {
                            childData = __readDefault(child);
                            if (!data[child.nodeName]) {
                                data[child.nodeName] = childData;
                            } else {
                                if (!Array.isArray(data[child.nodeName])) {
                                    var old = data[child.nodeName];
                                    data[child.nodeName] = [];
                                    data[child.nodeName].push(old);
                                }
                                data[child.nodeName].push(childData);
                            }
                        }
                    }
                }
                return data;
            }
            function __getAttributes(node) {
                if (node.attributes.length > 0) {
                    var nodeAttributes = {};
                    var attributes = node.attributes;
                    for (var i = 0; i < attributes.length; i++) {
                        var attribute = attributes[i];
                        nodeAttributes[attribute.nodeName] = attribute.nodeValue;
                    }
                    return nodeAttributes;
                }
            }
            return XML;
        }(UtilsLoggerByDefault, {});
        ServicesAltiResponseModelAltiResponse = function () {
            function AltiResponse() {
                if (!(this instanceof AltiResponse)) {
                    throw new TypeError('AltiResponse constructor cannot be called as a function.');
                }
                this.elevations = [];
            }
            AltiResponse.prototype = { constructor: AltiResponse };
            return AltiResponse;
        }();
        ServicesAltiResponseModelElevation = function () {
            function Elevation() {
                if (!(this instanceof Elevation)) {
                    throw new TypeError('Elevation constructor cannot be called as a function.');
                }
                this.z = null;
            }
            Elevation.prototype = { constructor: Elevation };
            return Elevation;
        }();
        ServicesAltiFormatsAltiResponseReader = function (Logger, AltiResponse, Elevation) {
            var AltiResponseReader = {};
            AltiResponseReader.READERS = {
                elevations: function (root) {
                    var altiResponse = new AltiResponse();
                    if (root.hasChildNodes()) {
                        var children = root.childNodes;
                        var child;
                        var elevation;
                        for (var i = 0; i < children.length; i++) {
                            child = children[i];
                            if (AltiResponseReader.READERS[child.nodeName]) {
                                elevation = AltiResponseReader.READERS[child.nodeName](child);
                                altiResponse.elevations.push(elevation);
                            }
                        }
                    }
                    return altiResponse;
                },
                elevation: function (node) {
                    var elevation = new Elevation();
                    if (node.hasChildNodes()) {
                        var children = node.childNodes;
                        var child;
                        for (var i = 0; i < children.length; i++) {
                            child = children[i];
                            if (AltiResponseReader.READERS[child.nodeName]) {
                                AltiResponseReader.READERS[child.nodeName](child, elevation);
                            }
                        }
                    }
                    return elevation;
                },
                lat: function (node, elevation) {
                    var textNode = node.firstChild;
                    if (textNode && textNode.nodeType === 3) {
                        elevation.lat = parseFloat(textNode.nodeValue);
                    } else {
                        throw new Error('Erreur dans la lecture de la réponse du service: latitude attendue mais absente');
                    }
                },
                lon: function (node, elevation) {
                    var textNode = node.firstChild;
                    if (textNode && textNode.nodeType === 3) {
                        elevation.lon = parseFloat(textNode.nodeValue);
                    } else {
                        throw new Error('Erreur dans la lecture de la réponse du service: longitude attendue mais absente');
                    }
                },
                z: function (node, elevation) {
                    var textNode = node.firstChild;
                    if (textNode && textNode.nodeType === 3) {
                        if (elevation) {
                            elevation.z = parseFloat(textNode.nodeValue);
                        } else {
                            elevation = new Elevation();
                            elevation.z = parseFloat(textNode.nodeValue);
                            return elevation;
                        }
                    } else {
                        throw new Error('Erreur dans la lecture de la réponse du service: altitude attendue mais absente');
                    }
                },
                acc: function (node, elevation) {
                    var textNode = node.firstChild;
                    if (textNode && textNode.nodeType === 3) {
                        elevation.acc = parseFloat(textNode.nodeValue);
                    } else {
                        throw new Error('Erreur dans la lecture de la réponse du service: précision (acc) attendue mais absente');
                    }
                },
                exceptionreport: function (node) {
                    var response = {};
                    if (node.hasChildNodes()) {
                        var children = node.childNodes;
                        var child;
                        for (var i = 0; i < children.length; i++) {
                            child = children[i];
                            if (child.nodeName === 'Exception') {
                                response.exceptionReport = AltiResponseReader.READERS.exception(child);
                            }
                        }
                    }
                    return response;
                },
                exception: function (node) {
                    var exceptionReport = {};
                    var exceptionCode = node.getAttribute('exceptionCode');
                    if (exceptionCode) {
                        exceptionReport.exceptionCode = exceptionCode;
                    }
                    var textNode = node.firstChild;
                    if (textNode && textNode.nodeType === 3) {
                        exceptionReport.exception = textNode.nodeValue;
                    }
                    return exceptionReport;
                },
                error: function (node) {
                    var response = { error: {} };
                    if (node.hasChildNodes()) {
                        var children = node.childNodes;
                        var child;
                        for (var i = 0; i < children.length; i++) {
                            child = children[i];
                            var textNode;
                            if (child.nodeType === 1 && child.nodeName === 'code') {
                                textNode = child.firstChild;
                                if (textNode && textNode.nodeType === 3) {
                                    response.error.code = textNode.nodeValue;
                                }
                            }
                            if (child.nodeType === 1 && child.nodeName === 'description') {
                                textNode = child.firstChild;
                                if (textNode && textNode.nodeType === 3) {
                                    response.error.description = textNode.nodeValue;
                                }
                            }
                        }
                    }
                    return response;
                }
            };
            AltiResponseReader.read = function (root) {
                if (root.nodeName === 'elevations') {
                    var altiResponse = AltiResponseReader.READERS.elevations(root);
                    return altiResponse;
                } else if (root.nodeName === 'ExceptionReport') {
                    var exceptionReport = AltiResponseReader.READERS.exceptionreport(root);
                    return exceptionReport;
                } else if (root.nodeName === 'error') {
                    var error = AltiResponseReader.READERS.error(root);
                    return error;
                } else {
                    throw new Error('Erreur lors de la lecture de la réponse : elle n\'est pas au format attendu.');
                }
            };
            return AltiResponseReader;
        }(UtilsLoggerByDefault, ServicesAltiResponseModelAltiResponse, ServicesAltiResponseModelElevation);
        ServicesAltiResponseAltiResponseFactory = function (Logger, ErrorService, MRes, XML, AltiResponseReader, AltiResponse, Elevation) {
            var AltiResponseFactory = {
                build: function (options) {
                    var data = null;
                    if (options.response) {
                        if (options.rawResponse) {
                            data = options.response;
                        } else {
                            switch (options.outputFormat) {
                            case 'xml':
                                try {
                                    var p = new XML({ reader: AltiResponseReader });
                                    if (typeof options.response === 'string') {
                                        p.setXMLString(options.response);
                                    } else {
                                        p.setXMLDoc(options.response);
                                    }
                                    data = p.parse();
                                    if (!data) {
                                        throw new Error(MRes.getMessage('SERVICE_RESPONSE_EXCEPTION_2'));
                                    }
                                } catch (e) {
                                    var message = e.message;
                                    options.onError.call(options.scope, new ErrorService({
                                        message: MRes.getMessage('SERVICE_RESPONSE_EXCEPTION', message),
                                        status: 200,
                                        type: ErrorService.TYPE_SRVERR
                                    }));
                                    return;
                                }
                                break;
                            case 'json':
                                var JSONResponse;
                                if (typeof options.response === 'string') {
                                    JSONResponse = window.JSON.parse(options.response);
                                } else {
                                    JSONResponse = options.response;
                                }
                                if (JSONResponse.error) {
                                    options.onError.call(options.scope, new ErrorService({
                                        message: MRes.getMessage('SERVICE_RESPONSE_EXCEPTION', JSONResponse.error.description),
                                        status: 200,
                                        type: ErrorService.TYPE_SRVERR
                                    }));
                                    return;
                                }
                                if (JSONResponse) {
                                    var elevations = JSONResponse.elevations;
                                    var altiResponse = new AltiResponse();
                                    var elevation;
                                    if (Array.isArray(elevations) && elevations.length) {
                                        for (var i = 0; i < elevations.length; i++) {
                                            elevation = new Elevation();
                                            if (typeof elevations[i] === 'object') {
                                                if (elevations[i].lon) {
                                                    elevation.lon = elevations[i].lon;
                                                }
                                                if (elevations[i].lat) {
                                                    elevation.lat = elevations[i].lat;
                                                }
                                                if (elevations[i].z) {
                                                    elevation.z = elevations[i].z;
                                                }
                                                if (elevations[i].acc) {
                                                    elevation.acc = elevations[i].acc;
                                                }
                                            } else if (typeof elevations[i] === 'number') {
                                                elevation.z = elevations[i];
                                            }
                                            if (Array.isArray(altiResponse.elevations)) {
                                                altiResponse.elevations.push(elevation);
                                            }
                                        }
                                    }
                                    data = altiResponse;
                                }
                                if (!data) {
                                    options.onError.call(options.scope, new ErrorService({
                                        message: MRes.getMessage('SERVICE_RESPONSE_ANALYSE_2'),
                                        type: ErrorService.TYPE_UNKERR,
                                        status: -1
                                    }));
                                    return;
                                }
                                break;
                            default:
                                options.onError.call(options.scope, new ErrorService({
                                    message: MRes.getMessage('SERVICE_RESPONSE_FORMAT_2'),
                                    type: ErrorService.TYPE_UNKERR,
                                    status: -1
                                }));
                                return;
                            }
                            if (data.exceptionReport) {
                                options.onError.call(options.scope, new ErrorService({
                                    message: MRes.getMessage('SERVICE_RESPONSE_EXCEPTION', data.exceptionReport),
                                    type: ErrorService.TYPE_SRVERR,
                                    status: 200
                                }));
                                return;
                            } else if (data.error) {
                                var errorMess = data.error.description;
                                options.onError.call(options.scope, new ErrorService({
                                    message: MRes.getMessage('SERVICE_RESPONSE_EXCEPTION', errorMess),
                                    type: ErrorService.TYPE_SRVERR,
                                    status: 200
                                }));
                                return;
                            }
                        }
                    } else {
                        options.onError.call(options.scope, new ErrorService(MRes.getMessage('SERVICE_RESPONSE_EMPTY')));
                        return;
                    }
                    options.onSuccess.call(options.scope, data);
                    return;
                }
            };
            return AltiResponseFactory;
        }(UtilsLoggerByDefault, ExceptionsErrorService, UtilsMessagesResources, FormatsXML, ServicesAltiFormatsAltiResponseReader, ServicesAltiResponseModelAltiResponse, ServicesAltiResponseModelElevation);
        ServicesAltiAlti = function (Logger, _, ErrorService, CommonService, DefaultUrlService, AltiRequestFactory, AltiResponseFactory) {
            function Alti(options) {
                if (!(this instanceof Alti)) {
                    throw new TypeError(_.getMessage('CLASS_CONSTRUCTOR', 'Alti'));
                }
                this.CLASSNAME = 'Alti';
                CommonService.apply(this, arguments);
                if (!options.positions) {
                    throw new Error(_.getMessage('PARAM_MISSING', 'positions'));
                }
                if (options.positions.length === 0) {
                    throw new Error(_.getMessage('PARAM_EMPTY', 'positions'));
                }
                this.options.positions = options.positions;
                this.options.outputFormat = typeof options.outputFormat === 'string' ? options.outputFormat.toLowerCase() : 'xml';
                this.options.sampling = options.sampling || null;
                this.options.api = typeof options.api === 'string' ? options.api.toUpperCase() : 'REST';
                if (this.options.api === 'REST') {
                    this.options.httpMethod = 'GET';
                }
                this.options.zonly = options.zonly || false;
                if (!this.options.serverUrl) {
                    var lstUrlByDefault = DefaultUrlService.Alti.url(this.options.apiKey);
                    var urlFound = null;
                    switch (this.options.api) {
                    case 'WPS':
                        urlFound = lstUrlByDefault.wps;
                        break;
                    case 'REST':
                        var key = (options.sampling ? 'profil' : 'elevation') + '-' + this.options.outputFormat;
                        urlFound = lstUrlByDefault[key];
                        break;
                    default:
                        throw new Error(_.getMessage('PARAM_UNKNOWN', 'api'));
                    }
                    if (!urlFound) {
                        throw new Error('Url by default not found !');
                    }
                    this.options.serverUrl = urlFound;
                }
                var idx = this.options.serverUrl.lastIndexOf('.');
                if (idx !== -1) {
                    var extension = this.options.serverUrl.substring(idx + 1);
                    if (extension && extension.length < 5) {
                        switch (extension.toLowerCase()) {
                        case 'json':
                        case 'xml':
                            this.options.outputFormat = extension.toLowerCase();
                            break;
                        default:
                            throw new Error('type of service : unknown or unsupported (json or xml) !');
                        }
                    }
                }
            }
            Alti.prototype = Object.create(CommonService.prototype, {});
            Alti.prototype.constructor = Alti;
            Alti.prototype.buildRequest = function (error, success) {
                var options = {
                    httpMethod: this.options.httpMethod,
                    onSuccess: function (result) {
                        this.request = result;
                        success.call(this, this.request);
                    },
                    onError: error,
                    scope: this,
                    positions: this.options.positions,
                    outputFormat: this.options.outputFormat,
                    sampling: this.options.sampling,
                    api: this.options.api,
                    zonly: this.options.zonly
                };
                AltiRequestFactory.build(options);
            };
            Alti.prototype.analyzeResponse = function (error, success) {
                if (this.response) {
                    var options = {
                        response: this.response,
                        outputFormat: this.options.outputFormat,
                        rawResponse: this.options.rawResponse,
                        onError: error,
                        onSuccess: success,
                        scope: this
                    };
                    AltiResponseFactory.build(options);
                } else {
                    error.call(this, new ErrorService(_.getMessage('SERVICE_RESPONSE_EMPTY')));
                }
            };
            return Alti;
        }(UtilsLoggerByDefault, UtilsMessagesResources, ExceptionsErrorService, ServicesCommonService, ServicesDefaultUrlService, ServicesAltiRequestAltiRequestFactory, ServicesAltiResponseAltiResponseFactory);
        ServicesAutoConfResponseModelAutoConfResponse = function () {
            function AutoConfResponse() {
                if (!(this instanceof AutoConfResponse)) {
                    throw new TypeError('AutoConfResponse constructor cannot be called as a function.');
                }
                this.generalOptions = {
                    apiKeys: {},
                    title: null,
                    defaultGMLGFIStyle: null,
                    theme: null,
                    wgs84Resolutions: []
                };
                this.layers = {};
                this.territories = {};
                this.tileMatrixSets = {};
                this.services = {};
            }
            AutoConfResponse.prototype = {
                constructor: AutoConfResponse,
                isConfLoaded: function (apiKey) {
                    if (!apiKey) {
                        return;
                    }
                    if (this.generalOptions.apiKeys[apiKey]) {
                        return true;
                    }
                    return false;
                },
                getLayersId: function (apiKey) {
                    return this.generalOptions.apiKeys[apiKey];
                },
                getLayersConf: function (apiKey) {
                    var layers = {};
                    var layersIdArray = this.getLayersId(apiKey);
                    if (layersIdArray) {
                        for (var i = 0; i < layersIdArray.length; i++) {
                            var lyrId = layersIdArray[i];
                            layers[lyrId] = this.layers[lyrId];
                        }
                    }
                    return layers;
                },
                getLayerConf: function (layerId) {
                    if (!this.layers) {
                        return;
                    }
                    return this.layers[layerId];
                },
                getTileMatrixSets: function () {
                    return this.tileMatrixSets;
                },
                getTMSConf: function (tmsID) {
                    if (!this.tileMatrixSets) {
                        return;
                    }
                    return this.tileMatrixSets[tmsID];
                },
                getTerritories: function () {
                    return this.territories;
                },
                getTerritoryConf: function (territoryID) {
                    if (!this.territories) {
                        return;
                    }
                    return this.territories[territoryID];
                },
                getServices: function () {
                    return this.services;
                },
                getServiceConf: function (serviceID) {
                    if (!this.services) {
                        return;
                    }
                    return this.services[serviceID];
                }
            };
            return AutoConfResponse;
        }();
        ServicesAutoConfResponseModelConstraint = function () {
            function Constraint() {
                if (!(this instanceof Constraint)) {
                    throw new TypeError('Constraint constructor cannot be called as a function.');
                }
                this.crs = null;
                this.bbox = {
                    left: null,
                    right: null,
                    top: null,
                    bottom: null
                };
                this.minScaleDenominator = null;
                this.maxScaleDenominator = null;
                this.temporalExtent = [
                    null,
                    null
                ];
            }
            Constraint.prototype = { constructor: Constraint };
            return Constraint;
        }();
        ServicesAutoConfResponseModelFormat = function () {
            function Format() {
                if (!(this instanceof Format)) {
                    throw new TypeError('Format constructor cannot be called as a function.');
                }
                this.current = null;
                this.name = null;
            }
            Format.prototype = { constructor: Format };
            return Format;
        }();
        ServicesAutoConfResponseModelLayer = function () {
            function Layer() {
                if (!(this instanceof Layer)) {
                    throw new TypeError('Layer constructor cannot be called as a function.');
                }
            }
            Layer.prototype = {
                constructor: Layer,
                getName: function () {
                    return this.name;
                },
                getTitle: function () {
                    return this.title;
                },
                getDescription: function () {
                    return this.description;
                },
                getLayerId: function () {
                    return this.layerId;
                },
                getQuicklookUrl: function () {
                    return this.quicklookUrl;
                },
                getDefaultProjection: function () {
                    return this.defaultProjection;
                },
                getProjections: function () {
                    var projections = [];
                    projections.push(this.defaultProjection);
                    var proj = projections.concat(this.additionalProjections);
                    return proj;
                },
                getBBOX: function () {
                    if (!this.globalConstraint) {
                        return;
                    }
                    return this.globalConstraint.bbox;
                },
                getMinScaleDenominator: function () {
                    if (!this.globalConstraint) {
                        return;
                    }
                    return this.globalConstraint.minScaleDenominator;
                },
                getMaxScaleDenominator: function () {
                    if (!this.globalConstraint) {
                        return;
                    }
                    return this.globalConstraint.maxScaleDenominator;
                },
                getTMSID: function () {
                    if (this.wmtsOptions) {
                        return this.wmtsOptions.tileMatrixSetLink;
                    }
                    return;
                },
                getServiceParams: function () {
                    return this.serviceParams;
                },
                getServerUrl: function (apiKey) {
                    if (!apiKey || !this.serviceParams || !this.serviceParams.serverUrl) {
                        return;
                    }
                    return this.serviceParams.serverUrl[apiKey];
                },
                getLegends: function () {
                    return this.legends;
                },
                getMetadata: function () {
                    return this.metadata;
                },
                getStyles: function () {
                    return this.styles;
                },
                getDefaultStyle: function () {
                    if (!this.styles) {
                        return;
                    }
                    var style;
                    var s = this.styles;
                    for (var i = 0; i < s.length; i++) {
                        if (s[i].current === true) {
                            style = s[i].name;
                            break;
                        }
                    }
                    return style;
                },
                getThematics: function () {
                    return this.thematics;
                },
                getDefaultFormat: function () {
                    if (!this.formats) {
                        return;
                    }
                    var format;
                    var f = this.formats;
                    for (var i = 0; i < f.length; i++) {
                        if (f[i].current === true) {
                            format = f[i].name;
                            break;
                        }
                    }
                    return format;
                },
                getConstraints: function () {
                    return this.constraints;
                },
                getOriginators: function () {
                    return this.originators;
                },
                getDimensions: function () {
                    return this.dimensions;
                },
                getAggregatedLayers: function () {
                    if (this.isAggregate) {
                        return this.aggregatedLayers;
                    } else {
                        return;
                    }
                }
            };
            return Layer;
        }();
        ServicesAutoConfResponseModelLegend = function () {
            function Legend() {
                if (!(this instanceof Legend)) {
                    throw new TypeError('Legend constructor cannot be called as a function.');
                }
                this.format = null;
                this.url = null;
                this.minScaleDenominator = null;
            }
            Legend.prototype = { constructor: Legend };
            return Legend;
        }();
        ServicesAutoConfResponseModelMetadata = function () {
            function Metadata() {
                if (!(this instanceof Metadata)) {
                    throw new TypeError('Metadata constructor cannot be called as a function.');
                }
                this.format = null;
                this.url = null;
            }
            Metadata.prototype = { constructor: Metadata };
            return Metadata;
        }();
        ServicesAutoConfResponseModelOriginator = function () {
            function Originator() {
                if (!(this instanceof Originator)) {
                    throw new TypeError('Originator constructor cannot be called as a function.');
                }
                this.name = null;
                this.attribution = null;
                this.logo = null;
                this.url = null;
                this.constraints = [];
            }
            Originator.prototype = { constructor: Originator };
            return Originator;
        }();
        ServicesAutoConfResponseModelService = function () {
            function Service() {
                if (!(this instanceof Service)) {
                    throw new TypeError('Service constructor cannot be called as a function.');
                }
                this.title = null;
                this.serverUrl = null;
                this.version = null;
            }
            Service.prototype = { constructor: Service };
            return Service;
        }();
        ServicesAutoConfResponseModelStyle = function () {
            function Style() {
                if (!(this instanceof Style)) {
                    throw new TypeError('Style constructor cannot be called as a function.');
                }
                this.name = null;
                this.title = null;
                this.current = null;
            }
            Style.prototype = { constructor: Style };
            return Style;
        }();
        ServicesAutoConfResponseModelTerritory = function () {
            function Territory() {
                if (!(this instanceof Territory)) {
                    throw new TypeError('Territory constructor cannot be called as a function.');
                }
                this.isDefault = null;
                this.defaultCRS = null;
                this.additionalCRS = [];
                this.geoBBOX = {
                    left: null,
                    right: null,
                    top: null,
                    bottom: null
                };
                this.geoCenter = {
                    lon: null,
                    lat: null
                };
                this.defaultOptions = {
                    resolution: null,
                    minScaleDenominator: null,
                    maxScaleDenominator: null
                };
                this.defaultLayers = [];
            }
            Territory.prototype = { constructor: Territory };
            return Territory;
        }();
        ServicesAutoConfResponseModelThematic = function () {
            function Thematic() {
                if (!(this instanceof Thematic)) {
                    throw new TypeError('Thematic constructor cannot be called as a function.');
                }
                this.inspire = null;
                this.name = null;
            }
            Thematic.prototype = { constructor: Thematic };
            return Thematic;
        }();
        ServicesAutoConfResponseModelTileMatrixSet = function () {
            function TileMatrixSet() {
                if (!(this instanceof TileMatrixSet)) {
                    throw new TypeError('TileMatrixSet constructor cannot be called as a function.');
                }
                this.projection = null;
                this.nativeResolutions = [];
                this.matrixIds = [];
                this.tileMatrices = {};
            }
            TileMatrixSet.prototype = {
                constructor: TileMatrixSet,
                getResolutions: function () {
                    return this.nativeResolutions;
                },
                getMatrixIds: function () {
                    return this.matrixIds;
                },
                getProjection: function () {
                    return this.projection;
                },
                getTileMatrices: function () {
                    return this.tileMatrices;
                },
                getTopLeftCorner: function () {
                    var topLeftCorner;
                    var matrices = this.getTileMatrices();
                    if (matrices) {
                        for (var id in matrices) {
                            if (matrices.hasOwnProperty(id)) {
                                topLeftCorner = matrices[id].topLeftCorner;
                                break;
                            }
                        }
                    }
                    return topLeftCorner;
                }
            };
            return TileMatrixSet;
        }();
        ServicesAutoConfResponseModelTileMatrix = function () {
            function TileMatrix() {
                if (!(this instanceof TileMatrix)) {
                    throw new TypeError('TileMatrix constructor cannot be called as a function.');
                }
                this.matrixId = null;
                this.matrixHeight = null;
                this.matrixWidth = null;
                this.scaleDenominator = null;
                this.tileHeight = null;
                this.tileWidth = null;
                this.topLeftCorner = null;
            }
            TileMatrix.prototype = {
                constructor: TileMatrix,
                getTopLeftCorner: function () {
                    return this.topLeftCorner;
                },
                getScaleDenominator: function () {
                    return this.scaleDenominator;
                },
                getTileHeight: function () {
                    return this.tileHeight;
                },
                getTileWidth: function () {
                    return this.tileWidth;
                },
                getMatrixHeight: function () {
                    return this.matrixHeight;
                },
                getMatrixWidth: function () {
                    return this.matrixWidth;
                }
            };
            return TileMatrix;
        }();
        ServicesAutoConfResponseModelTileMatrixLimit = function () {
            function TileMatrixLimit() {
                if (!(this instanceof TileMatrixLimit)) {
                    throw new TypeError('TileMatrixLimit constructor cannot be called as a function.');
                }
                this.minTileRow = null;
                this.maxTileRow = null;
                this.minTileCol = null;
                this.maxTileCol = null;
            }
            TileMatrixLimit.prototype = { constructor: TileMatrixLimit };
            return TileMatrixLimit;
        }();
        ServicesAutoConfFormatsAutoConfResponseReader = function (Logger, AutoConfResponse, Constraint, Format, Layer, Legend, Metadata, Originator, Service, Style, Territory, Thematic, TileMatrixSet, TileMatrix, TileMatrixLimit) {
            var AutoConfResponseReader = {};
            AutoConfResponseReader.VERSION = '1.1.0';
            AutoConfResponseReader.NAMESPACES = {
                xmlns: 'http://www.opengis.net/context',
                gpp: 'http://api.ign.fr/geoportail',
                ows: 'http://www.opengis.net/ows/1.1',
                sld: 'http://www.opengis.net/sld',
                wmts: 'http://www.opengis.net/wmts/1.0',
                xlink: 'http://www.w3.org/1999/xlink',
                xsi: 'http://www.w3.org/2001/XMLSchema-instance'
            };
            AutoConfResponseReader.SCHEMALOCATION = [
                'http://www.opengis.net/context http://gpp3-wxs.ign.fr/schemas/extContext.xsd http://api.ign.fr/geoportail http://wxs.ign.fr/schemas/autoconf/autoconf.xsd',
                'http://www.opengis.net/context http://gpp3-wxs.ign.fr/schemas/extContext.xsd http://api.ign.fr/geoportail http://gpp3-wxs.ign.fr/schemas/autoconf.xsd'
            ];
            AutoConfResponseReader.DEFAULTPREFIX = 'context';
            AutoConfResponseReader.READERS = {
                context: {
                    ViewContext: function (viewContextNode) {
                        __checkServiceAttributes(viewContextNode);
                        var config = new AutoConfResponse();
                        __getChildNodes(viewContextNode, config);
                        return config;
                    },
                    Title: function (titleNode, data) {
                        if (data && data.generalOptions) {
                            data.generalOptions.title = __getChildValue(titleNode);
                        } else if (data && data.lyr) {
                            data.lyr.title = __getChildValue(titleNode);
                        }
                    },
                    Abstract: function (node, data) {
                        if (data && data.lyr) {
                            data.lyr.description = __getChildValue(node);
                        }
                    },
                    Server: function (node, data) {
                        var serverId = node.getAttribute('service');
                        var title = node.getAttribute('title');
                        var version = node.getAttribute('version');
                        if (serverId) {
                            if (data && data.services && typeof data.services === 'object' && !data.services[serverId]) {
                                var s = new Service();
                                s.title = title;
                                s.version = version;
                                __getChildNodes(node, s);
                                data.services[serverId] = s;
                            } else if (data && data.lyr) {
                                if (!data.lyr.serviceParams) {
                                    data.lyr.serviceParams = {};
                                }
                                data.lyr.serviceParams.id = serverId;
                                data.lyr.serviceParams.version = version;
                            }
                        }
                    },
                    OnlineResource: function (node, service) {
                        if (service && service.hasOwnProperty('serverUrl')) {
                            service.serverUrl = node.getAttribute('xlink:href');
                        }
                    },
                    LayerList: function (layerListNode, config) {
                        __getChildNodes(layerListNode, config);
                        if (config && config.layers && config.generalOptions && config.services) {
                            for (var lyr in config.layers) {
                                if (config.layers.hasOwnProperty(lyr)) {
                                    var layerConfig = config.layers[lyr];
                                    var apiKeys = layerConfig.apiKeys;
                                    if (apiKeys && Array.isArray(apiKeys)) {
                                        for (var i = 0; i < apiKeys.length; i++) {
                                            var key = apiKeys[i];
                                            if (config.generalOptions.apiKeys) {
                                                if (!config.generalOptions.apiKeys[key] || !Array.isArray(config.generalOptions.apiKeys[key])) {
                                                    config.generalOptions.apiKeys[key] = [];
                                                }
                                                config.generalOptions.apiKeys[key].push(lyr);
                                            }
                                        }
                                    }
                                    var serviceParams = layerConfig.serviceParams;
                                    if (serviceParams && serviceParams.id) {
                                        if (!config.services[serviceParams.id]) {
                                            var s = new Service();
                                            if (serviceParams.serverUrl) {
                                                s.serverUrl = serviceParams.serverUrl;
                                            }
                                            if (serviceParams.version) {
                                                s.version = serviceParams.version;
                                            }
                                            config.services[serviceParams.id] = s;
                                        }
                                    }
                                    if (layerConfig.wmtsOptions && layerConfig.wmtsOptions.tileMatrixSetLink && config.tileMatrixSets) {
                                        var tmsLink = layerConfig.wmtsOptions.tileMatrixSetLink;
                                        var tileMatrixSets = config.tileMatrixSets;
                                        for (var tms in tileMatrixSets) {
                                            if (tileMatrixSets.hasOwnProperty(tms) && tms === tmsLink) {
                                                layerConfig.defaultProjection = tileMatrixSets[tms].projection;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    Layer: function (layerNode, config) {
                        if (config && config.layers) {
                            var lyrData = {
                                lyr: new Layer(),
                                lyrId: null
                            };
                            var hidden = layerNode.getAttribute('hidden');
                            if (hidden === '1') {
                                lyrData.lyr.hidden = true;
                            } else {
                                lyrData.lyr.hidden = false;
                            }
                            var queryable = layerNode.getAttribute('queryable');
                            if (queryable === '1') {
                                lyrData.lyr.queryable = true;
                            } else {
                                lyrData.lyr.queryable = false;
                            }
                            __getChildNodes(layerNode, lyrData);
                            if (lyrData.lyrId) {
                                if (lyrData.lyr.serviceParams && lyrData.lyr.serviceParams.id) {
                                    var serviceid = lyrData.lyr.serviceParams.id;
                                    if (serviceid.toUpperCase().indexOf('OPENLS') !== -1 || serviceid.toUpperCase().indexOf('ELEVATION') !== -1) {
                                        var resourceId = lyrData.lyrId.split('$')[0];
                                        lyrData.lyrId = resourceId + '$' + serviceid;
                                    }
                                }
                                lyrData.lyr.layerId = lyrData.lyrId;
                                config.layers[lyrData.lyrId] = lyrData.lyr;
                            }
                        }
                    },
                    Name: function (node, lyrData) {
                        if (lyrData && lyrData.lyr) {
                            lyrData.lyr.name = __getChildValue(node);
                        }
                    },
                    SRS: function (node, lyrData) {
                        if (lyrData && lyrData.lyr) {
                            lyrData.lyr.defaultProjection = __getChildValue(node);
                        }
                    },
                    Format: function (node, lyrData) {
                        if (lyrData && lyrData.lyr) {
                            var f = new Format();
                            var current = node.getAttribute('current');
                            if (current === '1') {
                                f.current = true;
                            } else {
                                f.current = false;
                            }
                            f.name = __getChildValue(node);
                            if (!lyrData.lyr.formats || !Array.isArray(lyrData.lyr.formats)) {
                                lyrData.lyr.formats = [];
                            }
                            lyrData.lyr.formats.push(f);
                        }
                    },
                    Style: function (node, lyrData) {
                        if (lyrData && lyrData.lyr) {
                            var s = new Style();
                            var current = node.getAttribute('current');
                            if (current === '1' || current === 1) {
                                s.current = true;
                            } else {
                                s.current = false;
                            }
                            if (node.hasChildNodes) {
                                var children = node.childNodes;
                                var child;
                                var childName;
                                for (var i = 0; i < children.length; i++) {
                                    child = children[i];
                                    if (child.nodeType === 1) {
                                        childName = child.localName || child.baseName || child.nodeName;
                                        if (childName === 'Name') {
                                            s.name = __getChildValue(child);
                                        } else if (childName === 'Title') {
                                            s.title = __getChildValue(child);
                                        }
                                    }
                                }
                            }
                            if (!lyrData.lyr.styles || !Array.isArray(lyrData.lyr.styles)) {
                                lyrData.lyr.styles = [];
                            }
                            lyrData.lyr.styles.push(s);
                        }
                    },
                    Dimension: function (node, lyrData) {
                        var name = node.getAttribute('name');
                        var dim = __getChildValue(node);
                        if (lyrData && lyrData.lyr) {
                            if (!lyrData.lyr.dimensions) {
                                lyrData.lyr.dimensions = {};
                            }
                            if (name === 'Type') {
                                lyrData.lyr.dimensions.type = dim;
                            } else if (name === 'VisibilityRange') {
                                lyrData.lyr.dimensions.visibilityRange = dim;
                            } else if (name === 'VisibilityMode ') {
                                lyrData.lyr.dimensions.visibilityMode = dim;
                            } else if (name === 'GeometricType') {
                                lyrData.lyr.dimensions.geometricType = dim;
                            } else if (name === 'NoDataValue') {
                                lyrData.lyr.dimensions.noDataValue = dim;
                            }
                        }
                    }
                },
                gpp: {
                    Theme: function (themeNode, config) {
                        if (config && config.generalOptions && config.generalOptions.hasOwnProperty('theme')) {
                            config.generalOptions.theme = __getChildValue(themeNode);
                        }
                    },
                    defaultGMLGFIStyleUrl: function (node, config) {
                        if (config && config.generalOptions && config.generalOptions.hasOwnProperty('defaultGMLGFIStyle')) {
                            config.generalOptions.defaultGMLGFIStyle = __getChildValue(node);
                        }
                    },
                    Territory: function (territoryNode, config) {
                        var tid = territoryNode.getAttribute('id');
                        if (tid) {
                            var t = new Territory();
                            var isDefault = territoryNode.getAttribute('default');
                            if (isDefault === '1') {
                                t.isDefault = true;
                            } else {
                                t.isDefault = false;
                            }
                            __getChildNodes(territoryNode, t);
                            if (config && config.territories && typeof config.territories === 'object') {
                                config.territories[tid] = t;
                            }
                        }
                    },
                    defaultCRS: function (node, territory) {
                        if (territory && territory.hasOwnProperty('defaultCRS')) {
                            territory.defaultCRS = __getChildValue(node);
                        }
                    },
                    AdditionalCRS: function (node, data) {
                        var addCRS = __getChildValue(node);
                        if (addCRS && data) {
                            if (Array.isArray(data.additionalCRS)) {
                                data.additionalCRS.push(addCRS);
                            } else {
                                if (!data.additionalProjections || !Array.isArray(data.additionalProjections)) {
                                    data.additionalProjections = [];
                                }
                                data.additionalProjections.push(addCRS);
                            }
                        }
                    },
                    DefaultLayer: function (node, territory) {
                        var lyr = node.getAttribute('layerId');
                        if (lyr && territory && Array.isArray(territory.defaultLayers)) {
                            territory.defaultLayers.push(lyr);
                        }
                    },
                    BoundingBox: function (node, data) {
                        if (data) {
                            var values = __getChildValue(node).split(',');
                            if (values.length === 4) {
                                var bbox = {
                                    left: parseFloat(values[0]),
                                    right: parseFloat(values[2]),
                                    top: parseFloat(values[3]),
                                    bottom: parseFloat(values[1])
                                };
                                var minT = node.getAttribute('minT');
                                var maxT = node.getAttribute('maxT');
                                if (data.hasOwnProperty('geoBBOX')) {
                                    data.geoBBOX = bbox;
                                } else if (data.hasOwnProperty('bbox')) {
                                    if (data.bbox.left || data.bbox.right || data.bbox.top || data.bbox.bottom) {
                                        if (!data.multiConstraints) {
                                            data.multiConstraints = [];
                                        }
                                        var newConstraint = new Constraint();
                                        newConstraint.bbox = bbox;
                                        newConstraint.temporalExtent = [
                                            minT,
                                            maxT
                                        ];
                                        data.multiConstraints.push(newConstraint);
                                    } else {
                                        data.bbox = bbox;
                                        data.temporalExtent = [
                                            minT,
                                            maxT
                                        ];
                                    }
                                } else {
                                    if (!data.globalConstraint) {
                                        data.globalConstraint = new Constraint();
                                    }
                                    data.globalConstraint.bbox = bbox;
                                    data.globalConstraint.temporalExtent = [
                                        minT,
                                        maxT
                                    ];
                                }
                            }
                        }
                    },
                    Resolution: function (node, territory) {
                        var res = __getChildValue(node);
                        if (res && territory && territory.defaultOptions && territory.defaultOptions.hasOwnProperty('resolution')) {
                            territory.defaultOptions.resolution = parseFloat(res);
                        }
                    },
                    x: function (node, territory) {
                        var lon = __getChildValue(node);
                        if (lon && territory && territory.geoCenter && territory.geoCenter.hasOwnProperty('lon')) {
                            territory.geoCenter.lon = parseFloat(lon);
                        }
                    },
                    y: function (node, territory) {
                        var lat = __getChildValue(node);
                        if (lat && territory && territory.geoCenter && territory.geoCenter.hasOwnProperty('lat')) {
                            territory.geoCenter.lat = parseFloat(lat);
                        }
                    },
                    Resolutions: function (resNode, config) {
                        if (config && config.generalOptions && config.generalOptions.hasOwnProperty('wgs84Resolutions')) {
                            config.generalOptions.wgs84Resolutions = __getChildValue(resNode).split(',');
                        }
                    },
                    Layer: function (node, lyrData) {
                        if (lyrData && lyrData.hasOwnProperty('lyrId') && lyrData.lyr) {
                            lyrData.lyrId = node.getAttribute('id');
                            var aggregate = node.getAttribute('aggregate');
                            var more = node.getAttribute('more');
                            if (aggregate || more) {
                                lyrData.lyr.isAggregate = true;
                            }
                            __getChildNodes(node, lyrData.lyr);
                        }
                    },
                    Constraint: function (node, data) {
                        var c = new Constraint();
                        __getChildNodes(node, c);
                        if (data) {
                            if (!data.constraints || !Array.isArray(data.constraints)) {
                                data.constraints = [];
                            }
                            if (c.multiConstraints && Array.isArray(c.multiConstraints)) {
                                var constraint = new Constraint();
                                constraint.crs = c.crs;
                                constraint.bbox = c.bbox;
                                constraint.minScaleDenominator = c.minScaleDenominator;
                                constraint.maxScaleDenominator = c.maxScaleDenominator;
                                constraint.temporalExtent = c.temporalExtent;
                                data.constraints.push(constraint);
                                for (var i = 0; i < c.multiConstraints.length; i++) {
                                    constraint = new Constraint();
                                    constraint.crs = c.crs;
                                    constraint.minScaleDenominator = c.minScaleDenominator;
                                    constraint.maxScaleDenominator = c.maxScaleDenominator;
                                    constraint.bbox = c.multiConstraints[i].bbox;
                                    constraint.temporalExtent = c.multiConstraints[i].temporalExtent;
                                    data.constraints.push(constraint);
                                }
                            } else {
                                data.constraints.push(c);
                            }
                        }
                    },
                    CRS: function (node, data) {
                        if (data && data.hasOwnProperty('crs')) {
                            data.crs = __getChildValue(node);
                        }
                    },
                    Thematic: function (node, lyr) {
                        if (lyr) {
                            var t = new Thematic();
                            t.inspire = false;
                            t.name = __getChildValue(node);
                            if (!lyr.thematics || !Array.isArray(lyr.thematics)) {
                                lyr.thematics = [];
                            }
                            lyr.thematics.push(t);
                        }
                    },
                    InspireThematic: function (node, lyr) {
                        if (lyr) {
                            var t = new Thematic();
                            t.inspire = true;
                            t.name = __getChildValue(node);
                            if (!lyr.thematics || !Array.isArray(lyr.thematics)) {
                                lyr.thematics = [];
                            }
                            lyr.thematics.push(t);
                        }
                    },
                    Originator: function (node, lyr) {
                        if (lyr) {
                            var o = new Originator();
                            o.name = node.getAttribute('name');
                            __getChildNodes(node, o);
                            if (!lyr.originators || !Array.isArray(lyr.originators)) {
                                lyr.originators = [];
                            }
                            lyr.originators.push(o);
                        }
                    },
                    Attribution: function (node, originator) {
                        if (originator && originator.hasOwnProperty('attribution')) {
                            originator.attribution = __getChildValue(node);
                        }
                    },
                    Logo: function (node, originator) {
                        if (originator && originator.hasOwnProperty('logo')) {
                            originator.logo = __getChildValue(node);
                        }
                    },
                    URL: function (node, originator) {
                        if (originator && originator.hasOwnProperty('url')) {
                            originator.url = __getChildValue(node);
                        }
                    },
                    Legend: function (node, lyr) {
                        var l = new Legend();
                        __getChildNodes(node, l);
                        if (lyr) {
                            if (!lyr.legends || !Array.isArray(lyr.legends)) {
                                lyr.legends = [];
                            }
                            lyr.legends.push(l);
                        }
                    },
                    LegendURL: function (node, legend) {
                        if (legend && legend.hasOwnProperty('format')) {
                            legend.format = node.getAttribute('format');
                            if (node.hasChildNodes) {
                                var child = node.childNodes[0];
                                var childName = child.localName || child.baseName || child.nodeName;
                                if (childName === 'OnlineResource' && legend.hasOwnProperty('url')) {
                                    legend.url = child.getAttribute('xlink:href');
                                }
                            }
                        }
                    },
                    QuickLook: function (node, lyr) {
                        if (node.hasChildNodes) {
                            var child = node.childNodes[0];
                            var childName = child.localName || child.baseName || child.nodeName;
                            if (childName === 'OnlineResource' && lyr) {
                                lyr.quicklookUrl = child.getAttribute('xlink:href');
                            }
                        }
                    },
                    MetadataURL: function (node, lyr) {
                        if (lyr) {
                            var m = new Metadata();
                            m.format = node.getAttribute('format');
                            if (node.hasChildNodes) {
                                var child = node.childNodes[0];
                                var childName = child.localName || child.baseName || child.nodeName;
                                if (childName === 'OnlineResource') {
                                    m.url = child.getAttribute('xlink:href');
                                }
                            }
                            if (!lyr.metadata && !Array.isArray(lyr.metadata)) {
                                lyr.metadata = [];
                            }
                            lyr.metadata.push(m);
                        }
                    },
                    Key: function (node, lyr) {
                        if (lyr) {
                            var key = node.getAttribute('id');
                            if (!lyr.apiKeys || !Array.isArray(lyr.apiKeys)) {
                                lyr.apiKeys = [];
                            }
                            lyr.apiKeys.push(key);
                            var serverUrl = __getChildValue(node);
                            if (!lyr.serviceParams) {
                                lyr.serviceParams = {};
                            }
                            if (!lyr.serviceParams.serverUrl) {
                                lyr.serviceParams.serverUrl = {};
                            }
                            if (!lyr.serviceParams.serverUrl[key]) {
                                lyr.serviceParams.serverUrl[key] = serverUrl;
                            }
                        }
                    }
                },
                ows: {
                    Identifier: function (node, data) {
                        if (data && data.hasOwnProperty('TMS')) {
                            data.identifier = __getChildValue(node);
                        } else if (data && data.hasOwnProperty('matrixId')) {
                            data.matrixId = __getChildValue(node);
                        }
                    },
                    SupportedCRS: function (node, tmsData) {
                        if (tmsData && tmsData.TMS && tmsData.TMS.hasOwnProperty('projection')) {
                            tmsData.TMS.projection = __getChildValue(node);
                        }
                    }
                },
                sld: {
                    MinScaleDenominator: function (node, data) {
                        var minScale = __getChildValue(node);
                        if (minScale && data) {
                            if (data.hasOwnProperty('defaultOptions')) {
                                data.defaultOptions.minScaleDenominator = parseFloat(minScale);
                            } else if (data.lyr) {
                                if (!data.lyr.globalConstraint) {
                                    data.lyr.globalConstraint = new Constraint();
                                }
                                data.lyr.globalConstraint.minScaleDenominator = parseFloat(minScale);
                            } else if (data.hasOwnProperty('minScaleDenominator')) {
                                data.minScaleDenominator = parseFloat(minScale);
                            }
                        }
                    },
                    MaxScaleDenominator: function (node, data) {
                        var maxScale = __getChildValue(node);
                        if (maxScale && data) {
                            if (data.hasOwnProperty('defaultOptions')) {
                                data.defaultOptions.maxScaleDenominator = parseFloat(maxScale);
                            } else if (data.lyr) {
                                if (!data.lyr.globalConstraint) {
                                    data.lyr.globalConstraint = new Constraint();
                                }
                                data.lyr.globalConstraint.maxScaleDenominator = parseFloat(maxScale);
                            } else if (data.hasOwnProperty('maxScaleDenominator')) {
                                data.maxScaleDenominator = parseFloat(maxScale);
                            }
                        }
                    }
                },
                wmts: {
                    TileMatrixSetLimits: function (node, lyr) {
                        if (lyr) {
                            var limits = {};
                            __getChildNodes(node, limits);
                            if (!lyr.wmtsOptions) {
                                lyr.wmtsOptions = {};
                            }
                            lyr.wmtsOptions.tileMatrixSetLimits = limits;
                        }
                    },
                    TileMatrixLimits: function (node, limits) {
                        var limit = new TileMatrixLimit();
                        var limitId;
                        if (node.hasChildNodes) {
                            var children = node.childNodes;
                            for (var i = 0; i < children.length; i++) {
                                var child = children[i];
                                var childName = child.localName || child.baseName || child.nodeName;
                                if (childName === 'TileMatrix') {
                                    limitId = __getChildValue(child);
                                } else if (childName === 'MinTileRow') {
                                    limit.minTileRow = __getChildValue(child);
                                } else if (childName === 'MaxTileRow') {
                                    limit.maxTileRow = __getChildValue(child);
                                } else if (childName === 'MinTileCol') {
                                    limit.minTileCol = __getChildValue(child);
                                } else if (childName === 'MaxTileCol') {
                                    limit.maxTileCol = __getChildValue(child);
                                }
                            }
                            if (limitId && limits && !limits[limitId]) {
                                limits[limitId] = limit;
                            }
                        }
                    },
                    TileMatrixSet: function (node, data) {
                        if (data && data.tileMatrixSets) {
                            var tmsData = {};
                            tmsData.TMS = new TileMatrixSet();
                            tmsData.resolutions = [];
                            __getChildNodes(node, tmsData);
                            var tileMatrices = tmsData.TMS.tileMatrices;
                            for (var tm in tileMatrices) {
                                if (tileMatrices.hasOwnProperty(tm)) {
                                    tmsData.TMS.matrixIds.push(tm);
                                }
                            }
                            if (tmsData.TMS.getProjection() === 'IGNF:WGS84G' || tmsData.TMS.getProjection() === 'EPSG:4326') {
                                if (data.generalOptions && Array.isArray(data.generalOptions.wgs84Resolutions)) {
                                    var wgs84Resolutions = data.generalOptions.wgs84Resolutions;
                                    for (var i = 0; i < wgs84Resolutions.length; i++) {
                                        tmsData.resolutions[i] = parseFloat(wgs84Resolutions[i]);
                                    }
                                }
                            }
                            if (Array.isArray(tmsData.resolutions) && tmsData.resolutions.sort !== undefined) {
                                tmsData.resolutions.sort(function (x, y) {
                                    return y - x;
                                });
                            }
                            tmsData.TMS.nativeResolutions = tmsData.resolutions;
                            data.tileMatrixSets[tmsData.identifier] = tmsData.TMS;
                        } else {
                            if (data && !data.wmtsOptions) {
                                data.wmtsOptions = {};
                            }
                            data.wmtsOptions.tileMatrixSetLink = __getChildValue(node);
                        }
                    },
                    TileMatrix: function (node, tmsData) {
                        if (tmsData) {
                            var tileMatrix = new TileMatrix();
                            __getChildNodes(node, tileMatrix);
                            if (tmsData.TMS && tmsData.TMS.getProjection()) {
                                var proj = tmsData.TMS.getProjection();
                                if (proj === 'EPSG:3857' || proj === 'EPSG:2154') {
                                    var r = tileMatrix.scaleDenominator * 0.00028;
                                    if (tmsData.resolutions && Array.isArray(tmsData.resolutions)) {
                                        tmsData.resolutions.push(r);
                                    }
                                }
                            }
                            if (tmsData.TMS && tmsData.TMS.tileMatrices) {
                                tmsData.TMS.tileMatrices[tileMatrix.matrixId] = tileMatrix;
                            }
                        }
                    },
                    ScaleDenominator: function (node, tileMatrix) {
                        var scale = __getChildValue(node);
                        if (scale && tileMatrix && tileMatrix.hasOwnProperty('scaleDenominator')) {
                            tileMatrix.scaleDenominator = parseFloat(scale);
                        }
                    },
                    TopLeftCorner: function (node, tileMatrix) {
                        var values = __getChildValue(node).split(' ');
                        if (values && tileMatrix) {
                            tileMatrix.topLeftCorner = {};
                            tileMatrix.topLeftCorner.x = parseFloat(values[0]);
                            tileMatrix.topLeftCorner.y = parseFloat(values[1]);
                        }
                    },
                    TileWidth: function (node, tileMatrix) {
                        var value = __getChildValue(node);
                        if (value && tileMatrix && tileMatrix.hasOwnProperty('tileWidth')) {
                            tileMatrix.tileWidth = parseInt(value, 10);
                        }
                    },
                    TileHeight: function (node, tileMatrix) {
                        var value = __getChildValue(node);
                        if (value && tileMatrix && tileMatrix.hasOwnProperty('tileHeight')) {
                            tileMatrix.tileHeight = parseInt(value, 10);
                        }
                    },
                    MatrixWidth: function (node, tileMatrix) {
                        var value = __getChildValue(node);
                        if (value && tileMatrix && tileMatrix.hasOwnProperty('matrixWidth')) {
                            tileMatrix.matrixWidth = parseInt(value, 10);
                        }
                    },
                    MatrixHeight: function (node, tileMatrix) {
                        var value = __getChildValue(node);
                        if (value && tileMatrix && tileMatrix.hasOwnProperty('matrixHeight')) {
                            tileMatrix.matrixHeight = parseInt(value, 10);
                        }
                    }
                },
                serviceException: function (node) {
                    var response = {};
                    if (node.hasChildNodes()) {
                        var children = node.childNodes;
                        var child;
                        for (var i = 0; i < children.length; i++) {
                            child = children[i];
                            if (child.nodeName === 'exception') {
                                response.exceptionReport = AutoConfResponseReader.READERS['exception'](child);
                            }
                        }
                    }
                    return response;
                },
                exception: function (node) {
                    var exceptionReport = {};
                    var exceptionCode = node.getAttribute('code');
                    if (exceptionCode) {
                        exceptionReport.exceptionCode = exceptionCode;
                    }
                    var textNode = node.firstChild;
                    if (textNode && textNode.nodeType === 3) {
                        exceptionReport.exception = textNode.nodeValue;
                    }
                    return exceptionReport;
                }
            };
            AutoConfResponseReader.read = function (root) {
                if (root.nodeName === 'ViewContext') {
                    var nsPrefix = root.prefix || AutoConfResponseReader.DEFAULTPREFIX;
                    var config = AutoConfResponseReader.READERS[nsPrefix][root.nodeName](root);
                    return config;
                } else if (root.nodeName === 'serviceException') {
                    var exceptionReport = AutoConfResponseReader.READERS[root.nodeName](root);
                    return exceptionReport;
                } else {
                    throw new Error('Erreur lors de la lecture de la réponse : elle n\'est pas au format attendu.');
                }
            };
            function __getAttributes(node) {
                if (node.attributes.length > 0) {
                    var nodeAttributes = {};
                    var attributes = node.attributes;
                    for (var i = 0; i < attributes.length; i++) {
                        var attribute = attributes[i];
                        nodeAttributes[attribute.nodeName] = attribute.nodeValue;
                    }
                    return nodeAttributes;
                }
            }
            function __getChildNodes(node, data) {
                if (node.hasChildNodes()) {
                    var children = node.childNodes;
                    var child;
                    var childName;
                    var childPrefix;
                    for (var i = 0; i < children.length; i++) {
                        child = children[i];
                        if (child.nodeType === 1) {
                            childName = child.localName || child.baseName || child.nodeName;
                            childPrefix = child.prefix || AutoConfResponseReader.DEFAULTPREFIX;
                            if (AutoConfResponseReader.READERS[childPrefix][childName]) {
                                var reader = AutoConfResponseReader.READERS[childPrefix][childName];
                                reader(child, data);
                            } else {
                                __getChildNodes(child, data);
                            }
                        }
                    }
                }
            }
            function __getChildValue(node) {
                var textNode;
                var value = '';
                if (node.hasChildNodes()) {
                    textNode = node.firstChild;
                    if (textNode.nodeType === 3 || textNode.nodeType === 4) {
                        value = textNode.nodeValue;
                    }
                }
                return value;
            }
            function __checkServiceAttributes(viewContextNode) {
                if (viewContextNode.attributes.length > 0) {
                    var xlsAttributes = __getAttributes(viewContextNode);
                    for (var att in xlsAttributes) {
                        if (xlsAttributes.hasOwnProperty(att)) {
                            if (att === 'version') {
                                if (xlsAttributes['version'] !== AutoConfResponseReader.VERSION) {
                                    console.log('[AutoConfResponseReader] autoconf version is not the expected one : there may be errors in parsing');
                                    return;
                                }
                            }
                            if (att === 'xmlns') {
                                if (xlsAttributes[att] !== AutoConfResponseReader.NAMESPACES.xmlns) {
                                    console.log('[AutoConfResponseReader] autoconf response default namespace is not the expected one');
                                    return;
                                }
                                continue;
                            }
                            var prefix = att.split(':')[0];
                            var ns = att.split(':')[1];
                            if (prefix === 'xmlns' && ns) {
                                if (AutoConfResponseReader.NAMESPACES[ns]) {
                                    if (AutoConfResponseReader.NAMESPACES[ns] !== xlsAttributes[att]) {
                                        console.log('[AutoConfResponseReader] autoconf response ' + att + ' namespace is not the expected one');
                                        return;
                                    }
                                }
                            }
                            if (ns === 'schemaLocation') {
                                if (xlsAttributes[att] !== AutoConfResponseReader.SCHEMALOCATION[0] && xlsAttributes[att] !== AutoConfResponseReader.SCHEMALOCATION[1]) {
                                    console.log('[AutoConfResponseReader] autoconf response schema location is not the expected one');
                                    return;
                                }
                            }
                        }
                    }
                }
            }
            return AutoConfResponseReader;
        }(UtilsLoggerByDefault, ServicesAutoConfResponseModelAutoConfResponse, ServicesAutoConfResponseModelConstraint, ServicesAutoConfResponseModelFormat, ServicesAutoConfResponseModelLayer, ServicesAutoConfResponseModelLegend, ServicesAutoConfResponseModelMetadata, ServicesAutoConfResponseModelOriginator, ServicesAutoConfResponseModelService, ServicesAutoConfResponseModelStyle, ServicesAutoConfResponseModelTerritory, ServicesAutoConfResponseModelThematic, ServicesAutoConfResponseModelTileMatrixSet, ServicesAutoConfResponseModelTileMatrix, ServicesAutoConfResponseModelTileMatrixLimit);
        ServicesAutoConfResponseAutoConfResponseFactory = function (Logger, ErrorService, MRes, XML, AutoConfResponseReader) {
            var AutoConfReponseFactory = {
                build: function (options) {
                    var data = null;
                    if (options.response) {
                        if (options.rawResponse) {
                            data = options.response;
                        } else {
                            try {
                                var p = new XML({ reader: AutoConfResponseReader });
                                if (typeof options.response === 'string') {
                                    p.setXMLString(options.response);
                                } else {
                                    p.setXMLDoc(options.response);
                                }
                                data = p.parse();
                            } catch (e) {
                                var message = e.message;
                                if (typeof options.response === 'string') {
                                    message += '\n(raw response service\'' + options.response + '\')';
                                } else {
                                    message += '\n(raw response service\'' + options.response.documentElement.innerHTML + '\')';
                                }
                                options.onError.call(options.scope, new ErrorService({
                                    message: MRes.getMessage('SERVICE_RESPONSE_EXCEPTION', message),
                                    status: 200,
                                    type: ErrorService.TYPE_SRVERR
                                }));
                                return;
                            }
                            var isEmpty = true;
                            for (var key in data) {
                                if (data.hasOwnProperty(key)) {
                                    isEmpty = false;
                                }
                            }
                            if (isEmpty) {
                                options.onError.call(options.scope, new ErrorService(MRes.getMessage('SERVICE_RESPONSE_EMPTY_2')));
                                return;
                            }
                            if (data.exceptionReport) {
                                options.onError.call(options.scope, new ErrorService({
                                    message: MRes.getMessage('SERVICE_RESPONSE_EXCEPTION', data.exceptionReport),
                                    type: ErrorService.TYPE_SRVERR,
                                    status: 200
                                }));
                                return;
                            }
                        }
                    } else {
                        options.onError.call(options.scope, new ErrorService(MRes.getMessage('SERVICE_RESPONSE_EMPTY')));
                        return;
                    }
                    var scope = typeof window !== 'undefined' ? window : {};
                    if (!scope.Gp) {
                        scope.Gp = {};
                    }
                    if (!scope.Gp.Config) {
                        scope.Gp.Config = data;
                    } else {
                        this.mergeConfig(scope.Gp.Config, data, options.layerId);
                    }
                    options.onSuccess.call(options.scope, scope.Gp.Config);
                    return;
                },
                mergeConfig: function (GpConfig, data, layerId) {
                    if (data && GpConfig) {
                        for (var prop in data) {
                            if (data.hasOwnProperty(prop)) {
                                if (prop == 'generalOptions') {
                                    for (var key in data[prop].apiKeys) {
                                        if (data[prop].apiKeys.hasOwnProperty(key) && !GpConfig.generalOptions.apiKeys[key]) {
                                            GpConfig.generalOptions.apiKeys[key] = data[prop].apiKeys[key];
                                        }
                                    }
                                } else {
                                    if (GpConfig[prop]) {
                                        for (var obj in data[prop]) {
                                            if (data[prop].hasOwnProperty(obj) && !GpConfig[prop][obj]) {
                                                GpConfig[prop][obj] = data[prop][obj];
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        if (layerId) {
                            var aggregatedLayers = [];
                            for (var lyr in data.layers) {
                                if (data.layers.hasOwnProperty(lyr)) {
                                    aggregatedLayers.push(lyr);
                                }
                            }
                            if (GpConfig.layers[layerId]) {
                                GpConfig.layers[layerId].aggregatedLayers = aggregatedLayers;
                            }
                        }
                    }
                }
            };
            return AutoConfReponseFactory;
        }(UtilsLoggerByDefault, ExceptionsErrorService, UtilsMessagesResources, FormatsXML, ServicesAutoConfFormatsAutoConfResponseReader);
        ServicesAutoConfAutoConf = function (Logger, _, ErrorService, Helper, DefaultUrlService, CommonService, AutoConfResponseFactory) {
            function AutoConf(options) {
                if (!(this instanceof AutoConf)) {
                    throw new TypeError(_.getMessage('CLASS_CONSTRUCTOR', 'AutoConf'));
                }
                this.CLASSNAME = 'AutoConf';
                if (!options) {
                    options = {};
                }
                options.protocol = options.protocol || 'JSONP';
                CommonService.apply(this, arguments);
                if (!this.options.serverUrl) {
                    if (!this.options.serverUrl) {
                        var lstUrlByDefault = DefaultUrlService.AutoConf.url(this.options.apiKey);
                        if (!this.options.layerId) {
                            if (Array.isArray(this.options.apiKey) && this.options.apiKey.length > 0) {
                                this.options.serverUrl = lstUrlByDefault.apiKeys;
                            } else {
                                this.options.serverUrl = lstUrlByDefault.apiKey;
                            }
                        } else {
                            this.options.serverUrl = lstUrlByDefault.aggregate + this.options.layerId;
                        }
                    }
                }
                if (this.options.protocol === 'XHR' && this.options.httpMethod === 'POST') {
                    this.options.httpMethod = 'GET';
                }
                this.options.outputFormat = this.options.rawResponse ? '' : 'xml';
            }
            AutoConf.prototype = Object.create(CommonService.prototype, {});
            AutoConf.prototype.constructor = AutoConf;
            AutoConf.prototype.buildRequest = function (error, success) {
                var scope = typeof window !== 'undefined' ? window : {};
                if (scope.Gp && scope.Gp.Config && scope.Gp.Config.generalOptions && scope.Gp.Config.layers) {
                    if (scope.Gp.Config.generalOptions.apiKeys[this.options.apiKey]) {
                        if (this.options.layerId) {
                            if (scope.Gp.Config.layers[this.options.layerId] && scope.Gp.Config.layers[this.options.layerId].aggregatedLayers) {
                                this.options.onSuccess.call(this, scope.Gp.Config);
                                return;
                            }
                        } else {
                            this.options.onSuccess.call(this, scope.Gp.Config);
                            return;
                        }
                    }
                }
                this.request = '';
                var bLocal;
                if (this.options.serverUrl.indexOf('http://') === -1) {
                    bLocal = true;
                } else {
                    bLocal = false;
                }
                if (!bLocal && this.layerId) {
                    this.request = Helper.normalyzeParameters({ layerId: this.layerId });
                }
                success.call(this, this.request);
            };
            AutoConf.prototype.analyzeResponse = function (error, success) {
                if (this.response) {
                    var options = {
                        layerId: this.options.layerId,
                        response: this.response,
                        rawResponse: this.options.rawResponse,
                        onSuccess: success,
                        onError: error,
                        scope: this
                    };
                    AutoConfResponseFactory.build(options);
                } else {
                    error.call(this, new ErrorService(_.getMessage('SERVICE_RESPONSE_EMPTY')));
                }
            };
            return AutoConf;
        }(UtilsLoggerByDefault, UtilsMessagesResources, ExceptionsErrorService, UtilsHelper, ServicesDefaultUrlService, ServicesCommonService, ServicesAutoConfResponseAutoConfResponseFactory);
        FormatsXLSRequestHeader = function (Logger) {
            function RequestHeader(options) {
                if (!(this instanceof RequestHeader)) {
                    throw new TypeError('RequestHeader constructor cannot be called as a function.');
                }
                this.options = options || { srsName: 'EPSG:4326' };
                for (var opt in options) {
                    if (options.hasOwnProperty(opt)) {
                        this.options[opt] = options[opt];
                    }
                }
            }
            RequestHeader.prototype = {
                requestString: null,
                template: '<RequestHeader srsName="__SRSNAME__"/>',
                constructor: RequestHeader,
                toString: function () {
                    var template = null;
                    template = this.template;
                    template = template.replace(/__SRSNAME__/g, this.options.srsName);
                    this.requestString = template;
                    return this.requestString;
                }
            };
            return RequestHeader;
        }(UtilsLoggerByDefault);
        FormatsXLSRequest = function (Logger) {
            function Request(options) {
                if (!(this instanceof Request)) {
                    throw new TypeError('Request constructor cannot be called as a function.');
                }
                this.options = options || {
                    maximumResponses: 25,
                    methodName: null,
                    version: '1.2'
                };
                for (var opt in options) {
                    if (options.hasOwnProperty(opt)) {
                        this.options[opt] = options[opt];
                    }
                }
            }
            Request.prototype = {
                requestString: null,
                template: '<Request maximumResponses="__MAXRESPONSES__" methodName="__METHODNAME__" requestID="__UUID__" version="__VERSION__">' + '<!-- __REQUESTSERVICE__ -->' + '</Request>',
                constructor: Request,
                guid: function () {
                    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                        var r = Math.random() * 16 | 0;
                        var v = c === 'x' ? r : r & 3 | 8;
                        return v.toString(16);
                    });
                },
                toString: function () {
                    var template = null;
                    template = this.template;
                    template = template.replace(/__MAXRESPONSES__/g, this.options.maximumResponses);
                    template = template.replace(/__METHODNAME__/g, this.options.methodName);
                    template = template.replace(/__UUID__/g, this.guid());
                    template = template.replace(/__VERSION__/g, this.options.version);
                    this.requestString = template;
                    return this.requestString;
                }
            };
            return Request;
        }(UtilsLoggerByDefault);
        FormatsXLSAbstractService = function (Logger) {
            function AbstractService(options) {
                if (!(this instanceof AbstractService)) {
                    throw new TypeError('AbstractService constructor cannot be called as a function.');
                }
                this.options = options || {};
                for (var opt in options) {
                    if (options.hasOwnProperty(opt)) {
                        this.options[opt] = options[opt];
                    }
                }
            }
            AbstractService.prototype = {
                strRequest: null,
                oRequest: null,
                oFilter: null,
                constructor: AbstractService,
                addRequest: function (oRequest) {
                },
                addFilter: function (oFilter) {
                },
                toString: function () {
                }
            };
            return AbstractService;
        }(UtilsLoggerByDefault);
        FormatsXLS = function (Logger, RequestHeader, Request, AbstractService) {
            function XLS(options) {
                if (!(this instanceof XLS)) {
                    throw new TypeError('XLS constructor cannot be called as a function.');
                }
                this.options = {
                    srsName: 'EPSG:4326',
                    maximumResponses: 25
                };
                for (var opt in options) {
                    if (options.hasOwnProperty(opt)) {
                        if (options[opt]) {
                            this.options[opt] = options[opt];
                        }
                    }
                }
            }
            XLS.VERSION = '1.2';
            XLS.prototype = {
                requestString: null,
                namespace: false,
                oService: null,
                constructor: XLS,
                template: '<?xml version="1.0" encoding="UTF-8"?>\n' + '<XLS version="__VERSION__"\n' + '__NAMESPACE__ \n' + '__SCHEMALOCATION__>\n' + '__REQUESTHEADER__\n' + '__REQUEST__\n' + '</XLS>\n',
                namespaceByDefault: function () {
                    var ns = [
                        'xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"',
                        'xmlns:xls="http://www.opengis.net/xls"',
                        'xmlns:gml="http://www.opengis.net/gml"'
                    ];
                    return ns.join(' ');
                },
                schemaLocationByDefault: function () {
                    return 'xsi:schemaLocation="http://www.opengis.net/xls http://schemas.opengis.net/ols/1.2/olsAll.xsd"';
                },
                setService: function (oService) {
                    if (!oService) {
                        return;
                    }
                    if (oService instanceof AbstractService) {
                        this.oService = oService;
                    } else {
                    }
                },
                getService: function () {
                    return this.oService;
                }
            };
            XLS.prototype.addNamespace = function (ns, request) {
                var keyNS = ns.key;
                var bFound = false;
                var allNS = this.namespaceByDefault().split(' ');
                for (var index = 0; index < allNS.length; index++) {
                    var element = allNS[index];
                    var map = element.split('=');
                    var key = map[0];
                    if (key === 'xmlns:' + keyNS) {
                        bFound = true;
                        break;
                    }
                }
                if (!bFound) {
                    return request;
                }
                var regex;
                var subst;
                regex = /<(\w+[\s>])/g;
                subst = '<' + keyNS + ':$1';
                request = request.replace(regex, subst);
                regex = /<\/(\w+[\s>])/g;
                subst = '</' + keyNS + ':$1';
                request = request.replace(regex, subst);
                return request;
            };
            XLS.prototype.build = function () {
                var bService = this.getService() ? true : false;
                var template = '';
                template = this.template;
                template = template.replace(/__VERSION__/g, XLS.VERSION);
                template = template.replace(/__NAMESPACE__/g, this.namespaceByDefault);
                template = template.replace(/__SCHEMALOCATION__/g, this.schemaLocationByDefault);
                var oHeader = new RequestHeader({ srsName: this.options.srsName });
                template = template.replace(/__REQUESTHEADER__/g, oHeader.toString());
                var oRequest = new Request({
                    maximumResponses: this.options.maximumResponses,
                    version: XLS.VERSION,
                    methodName: bService ? this.getService().CLASSTYPE : null
                });
                template = template.replace(/__REQUEST__/g, oRequest.toString());
                if (bService) {
                    template = template.replace(/<!-- __REQUESTSERVICE__ -->/g, this.getService().toString());
                }
                if (!template) {
                    return;
                }
                if (this.namespace) {
                    template = this.addNamespace({
                        key: 'xls',
                        url: 'http://www.opengis.net/xls'
                    }, template);
                }
                this.requestString = template;
                return this.requestString;
            };
            return XLS;
        }(UtilsLoggerByDefault, FormatsXLSRequestHeader, FormatsXLSRequest, FormatsXLSAbstractService);
        FormatsXLSLocationUtilityServiceModelAddress = function (Gp, Logger) {
            function Address(options) {
                if (!(this instanceof Address)) {
                    throw new TypeError('Address constructor cannot be called as a function.');
                }
                this.options = options || {
                    location: {},
                    type: ['StreetAddress'],
                    filter: {}
                };
                if (!options.location) {
                    throw new Error('l\'option \'location\' n\'est pas renseignée !');
                }
                for (var opt in options) {
                    if (options.hasOwnProperty(opt)) {
                        this.options[opt] = options[opt];
                    }
                }
            }
            Address.prototype = {
                constructor: Address,
                requestString: null,
                template: {
                    address: '<Address countryCode="__COUNTRYCODE__">' + '__LOCATION__' + '__PLACE__' + '__POSTALCODE__' + '__ENVELOPE__' + '</Address>',
                    location: {
                        freeFormAddress: '<freeFormAddress>__FREEFORMADDRESSVALUE__</freeFormAddress>',
                        streetAddress: {
                            container: '<StreetAddress>' + '__STREET__' + '__BUILDING__' + '</StreetAddress>',
                            building: '<Building number="__BUILDINGVALUE__"/>',
                            street: '<Street>__STREETVALUE__</Street>'
                        }
                    },
                    place: '<Place type="__PLACETYPE__">__PLACEVALUE__</Place>',
                    postalCode: '<PostalCode>__POSTALCODEVALUE__</PostalCode>',
                    envelope: '<gml:Envelope>' + '<gml:lowerCorner>__LEFT__ __BOTTOM__</gml:lowerCorner>' + '<gml:upperCorner>__RIGHT__ __TOP__</gml:upperCorner>' + '</gml:Envelope>'
                }
            };
            Address.prototype.toString = function () {
                var template = null;
                template = this.template.address;
                template = template.replace(/__COUNTRYCODE__/g, this.options.type);
                if (typeof this.options.location === 'string') {
                    var tmplFreeFormAddress = this.template.location.freeFormAddress;
                    tmplFreeFormAddress = tmplFreeFormAddress.replace(/__FREEFORMADDRESSVALUE__/g, this.options.location);
                    template = template.replace(/__LOCATION__/g, tmplFreeFormAddress);
                } else {
                    var tmplBuilding = '';
                    var tmplStreet = '';
                    if (this.options.location.number) {
                        tmplBuilding = this.template.location.streetAddress.building;
                        tmplBuilding = tmplBuilding.replace(/__BUILDINGVALUE__/g, this.options.location.number);
                    }
                    if (this.options.location.street) {
                        tmplStreet = this.template.location.streetAddress.street;
                        tmplStreet = tmplStreet.replace(/__STREETVALUE__/g, this.options.location.street);
                    }
                    var tmplStreetAddress = this.template.location.streetAddress.container;
                    tmplStreetAddress = tmplStreetAddress.replace(/__STREET__/g, tmplStreet);
                    tmplStreetAddress = tmplStreetAddress.replace(/__BUILDING__/g, tmplBuilding);
                    template = template.replace(/__LOCATION__/g, tmplStreetAddress);
                }
                var tmplPostalCode = '';
                if (this.options.location.postalCode) {
                    tmplPostalCode = this.template.postalCode;
                    tmplPostalCode = tmplPostalCode.replace(/__POSTALCODEVALUE__/g, this.options.location.postalCode);
                }
                var tmplEnvelope = '';
                if (this.options.filter) {
                    var bbox = this.options.filter.bbox;
                    if (bbox) {
                        tmplEnvelope = this.template.envelope;
                        tmplEnvelope = tmplEnvelope.replace(/__LEFT__/g, bbox.left);
                        tmplEnvelope = tmplEnvelope.replace(/__BOTTOM__/g, bbox.bottom);
                        tmplEnvelope = tmplEnvelope.replace(/__RIGHT__/g, bbox.right);
                        tmplEnvelope = tmplEnvelope.replace(/__TOP__/g, bbox.top);
                    }
                }
                var Places = [];
                var tmplPlace = '';
                if (this.options.filter) {
                    var filters = this.options.filter;
                    for (var filter in filters) {
                        if (filter === 'bbox') {
                            continue;
                        }
                        tmplPlace = this.template.place;
                        tmplPlace = tmplPlace.replace(/__PLACETYPE__/g, filter);
                        tmplPlace = tmplPlace.replace(/__PLACEVALUE__/g, filters[filter]);
                        Places.push(tmplPlace);
                    }
                }
                var tmplPlaceCity = '';
                if (this.options.location.city) {
                    tmplPlaceCity = this.template.place;
                    tmplPlaceCity = tmplPlaceCity.replace(/__PLACETYPE__/g, 'Municipality');
                    tmplPlaceCity = tmplPlaceCity.replace(/__PLACEVALUE__/g, this.options.location.city);
                    Places.push(tmplPlaceCity);
                }
                template = template.replace(/__POSTALCODE__/g, tmplPostalCode);
                template = template.replace(/__PLACE__/g, Places.join('\n'));
                template = template.replace(/__ENVELOPE__/g, tmplEnvelope);
                this.requestString = template;
                return this.requestString;
            };
            return Address;
        }(Gp, UtilsLoggerByDefault);
        FormatsXLSLocationUtilityServiceGeocodeFilterExtension = function (Logger) {
            function GeocodeFilterExtension() {
                if (!(this instanceof GeocodeFilterExtension)) {
                    throw new TypeError('GeocodeFilterExtension constructor cannot be called as a function.');
                }
                this.filters = [];
            }
            GeocodeFilterExtension.prototype = {
                constructor: GeocodeFilterExtension,
                addFilterExtensions: function (oGeocodeLocation) {
                    if (oGeocodeLocation) {
                        this.filters.push(oGeocodeLocation);
                    }
                },
                getNames: function () {
                    var names = [];
                    for (var idx in this.filters) {
                        names.push(this.filters[idx].CLASSNAME);
                    }
                    return names;
                },
                getFilter: function (name) {
                    var filter = null;
                    for (var idx in this.filters) {
                        if (this.filters[idx].CLASSNAME == name) {
                            filter = this.filters[idx];
                        }
                    }
                    return filter;
                },
                getFilters: function () {
                    return this.filters;
                },
                getAttributs: function (name) {
                    var attributs = [];
                    for (var idx in this.filters) {
                        if (this.filters[idx].CLASSNAME == name) {
                            attributs = this.filters[idx].attributesList;
                        }
                    }
                    return attributs;
                },
                setPlaceAttributs: function (name, options) {
                    var filter = this.getFilter(name);
                    var attributs = this.getAttributs(name);
                    for (var idx in attributs) {
                        var value = attributs[idx];
                        if (options[value]) {
                            filter.placeAttributes[value] = options[value];
                        }
                    }
                },
                getPlaceAttributs: function (name) {
                    var places = {};
                    for (var idx in this.filters) {
                        if (this.filters[idx].CLASSNAME == name) {
                            places = this.filters[idx].placeAttributes;
                        }
                    }
                    return places;
                }
            };
            return GeocodeFilterExtension;
        }(UtilsLoggerByDefault);
        FormatsXLSLocationUtilityServiceGeocodeRequest = function (Logger, Address, GeocodeFilterExtension) {
            function GeocodeRequest(options) {
                if (!(this instanceof GeocodeRequest)) {
                    throw new TypeError('GeocodeRequest constructor cannot be called as a function.');
                }
                this.options = options || {};
                for (var opt in options) {
                    if (options.hasOwnProperty(opt)) {
                        this.options[opt] = options[opt];
                    }
                }
                this.CLASSNAME = 'GeocodeRequest';
            }
            GeocodeRequest.prototype = {
                strRequest: null,
                oAddress: null,
                oFilter: null,
                template: '<GeocodeRequest returnFreeForm="__RETURNFREEFORM__">' + '__ADDRESS__' + '</GeocodeRequest>',
                addAddress: function (oAddress) {
                    if (oAddress instanceof Address) {
                        this.oAddress = oAddress;
                    }
                },
                addFilter: function (oFilter) {
                    if (oFilter instanceof GeocodeFilterExtension) {
                        this.oFilter = oFilter;
                    }
                },
                constructor: GeocodeRequest,
                toString: function () {
                    var template = '';
                    template = this.template;
                    if (!this.oAddress) {
                        var settings = {};
                        settings.location = this.options.location;
                        settings.type = this.options.filterOptions.type || ['StreetAddress'];
                        settings.filter = this.options.filterOptions;
                        delete settings.filter.type;
                        if (this.oFilter) {
                            settings.filter = {};
                            for (var idx in settings.type) {
                                var filter = settings.type[idx];
                                var oFilter = this.oFilter.getFilter(filter);
                                if (!oFilter) {
                                    continue;
                                }
                                var mFilter = this.options.filterOptions;
                                var attributs = oFilter.attributesList;
                                for (var idxe = 0; idxe < attributs.length; idxe++) {
                                    var key = attributs[idxe];
                                    if (mFilter[key]) {
                                        var matchingKey = oFilter.serviceAttributes[idxe];
                                        oFilter.placeAttributes[matchingKey] = mFilter[key];
                                    }
                                }
                                var places = oFilter.placeAttributes;
                                for (var kplace in places) {
                                    if (places.hasOwnProperty(kplace)) {
                                        settings.filter[kplace] = places[kplace];
                                    }
                                }
                            }
                        }
                        this.oAddress = new Address(settings);
                        if (!this.oAddress) {
                            throw new Error('La construction de l\'adresse n\'est pas correctement definie !?');
                        }
                    }
                    template = template.replace(/__ADDRESS__/g, this.oAddress.toString());
                    template = template.replace(/__RETURNFREEFORM__/g, this.options.returnFreeForm ? 'true' : 'false');
                    this.strRequest = template;
                    return this.strRequest;
                }
            };
            return GeocodeRequest;
        }(UtilsLoggerByDefault, FormatsXLSLocationUtilityServiceModelAddress, FormatsXLSLocationUtilityServiceGeocodeFilterExtension);
        FormatsXLSLocationUtilityServiceModelPosition = function (Logger) {
            function Position(options) {
                if (!(this instanceof Position)) {
                    throw new TypeError('Position constructor cannot be called as a function.');
                }
                this.options = options || {};
                if (!options.position) {
                    throw new Error('l\'option \'position\' n\'est pas renseignée !');
                }
                for (var opt in options) {
                    if (options.hasOwnProperty(opt)) {
                        this.options[opt] = options[opt];
                    }
                }
            }
            Position.prototype = {
                constructor: Position,
                requestString: null,
                template: {
                    position: '<Position>' + '__GMLPOINT__' + '__GMLFILTER__' + '</Position>',
                    gml: {
                        point: '<gml:Point xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos></gml:Point>',
                        pos: null,
                        filter: {
                            bbox: '<gml:Envelope xmlns:gml="http://www.opengis.net/gml">' + '<gml:lowerCorner>__LEFT__ __BOTTOM__</gml:lowerCorner>' + '<gml:upperCorner>__RIGHT__ __TOP__</gml:upperCorner>' + '</gml:Envelope>',
                            circle: '<gml:CircleByCenterPoint xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos><gml:radius>__RADIUS__</gml:radius></gml:CircleByCenterPoint>',
                            polygon: '<gml:Polygon xmlns:gml="http://www.opengis.net/gml"><gml:exterior><gml:LinearRing><gml:posList>__XY__</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>',
                            multipolygon: null
                        }
                    }
                }
            };
            Position.prototype.toString = function () {
                var template = this.template.position;
                var tmplGmlPoint = this.template.gml.point;
                tmplGmlPoint = tmplGmlPoint.replace(/__X__/g, this.options.position.x);
                tmplGmlPoint = tmplGmlPoint.replace(/__Y__/g, this.options.position.y);
                var tmplGmlFilter = '';
                if (this.options.filter) {
                    var filter = this.options.filter;
                    for (var name in filter) {
                        switch (name) {
                        case 'circle':
                            tmplGmlFilter = this.template.gml.filter[name];
                            tmplGmlFilter = tmplGmlFilter.replace(/__X__/g, filter[name].x);
                            tmplGmlFilter = tmplGmlFilter.replace(/__Y__/g, filter[name].y);
                            tmplGmlFilter = tmplGmlFilter.replace(/__RADIUS__/g, filter[name].radius);
                            break;
                        case 'bbox':
                            tmplGmlFilter = this.template.gml.filter[name];
                            tmplGmlFilter = tmplGmlFilter.replace(/__LEFT__/g, filter[name].left);
                            tmplGmlFilter = tmplGmlFilter.replace(/__BOTTOM__/g, filter[name].bottom);
                            tmplGmlFilter = tmplGmlFilter.replace(/__RIGHT__/g, filter[name].right);
                            tmplGmlFilter = tmplGmlFilter.replace(/__TOP__/g, filter[name].top);
                            break;
                        case 'polygon':
                            tmplGmlFilter = this.template.gml.filter[name];
                            var strPoints = '';
                            var lstPoints = filter[name];
                            for (var i = 0; i < lstPoints.length; i++) {
                                var coord = lstPoints[i];
                                if (Array.isArray(coord)) {
                                    break;
                                }
                                if (coord.x && coord.y || (coord.x === 0 || coord.y === 0)) {
                                    strPoints += coord.x + ' ' + coord.y;
                                }
                                if (lstPoints.length !== i + 1) {
                                    strPoints += ' ';
                                }
                            }
                            tmplGmlFilter = tmplGmlFilter.replace(/__XY__/g, strPoints);
                            break;
                        case 'multipolygon':
                            break;
                        default:
                        }
                    }
                }
                template = template.replace(/__GMLPOINT__/g, tmplGmlPoint);
                template = template.replace(/__GMLFILTER__/g, tmplGmlFilter);
                this.requestString = template;
                return this.requestString;
            };
            return Position;
        }(UtilsLoggerByDefault);
        FormatsXLSLocationUtilityServiceModelPreference = function (Logger) {
            function Preference(type) {
                if (!(this instanceof Preference)) {
                    throw new TypeError('Preference constructor cannot be called as a function.');
                }
                this.type = type;
            }
            Preference.prototype = {
                constructor: Preference,
                requestString: null,
                template: '<ReverseGeocodePreference>__TYPE__</ReverseGeocodePreference>'
            };
            Preference.prototype.toString = function () {
                var Preferences = [];
                var tmplPreference = '';
                for (var idx = 0; idx < this.type.length; idx++) {
                    tmplPreference = this.template;
                    tmplPreference = tmplPreference.replace(/__TYPE__/g, this.type[idx]);
                    Preferences.push(tmplPreference);
                }
                this.strRequest = Preferences.join('\n');
                return this.strRequest;
            };
            return Preference;
        }(UtilsLoggerByDefault);
        FormatsXLSLocationUtilityServiceReverseGeocodeRequest = function (Logger, Position, Preference) {
            function ReverseGeocodeRequest(options) {
                if (!(this instanceof ReverseGeocodeRequest)) {
                    throw new TypeError('ReverseGeocodeRequest constructor cannot be called as a function.');
                }
                this.options = options || {};
                for (var opt in options) {
                    if (options.hasOwnProperty(opt)) {
                        this.options[opt] = options[opt];
                    }
                }
                this.CLASSNAME = 'ReverseGeocodeRequest';
            }
            ReverseGeocodeRequest.prototype = {
                strRequest: null,
                oPosition: null,
                oPreference: null,
                constructor: ReverseGeocodeRequest,
                template: '<ReverseGeocodeRequest returnFreeForm="__RETURNFREEFORM__">' + '__POSITION__' + '__PREFERENCE__' + '</ReverseGeocodeRequest>',
                addPosition: function (oPosition) {
                    if (oPosition instanceof Position) {
                        this.oPosition = oPosition;
                    }
                },
                addPreferences: function (oPreference) {
                    if (oPreference instanceof Preference) {
                        this.oPreference = oPreference;
                    }
                },
                toString: function () {
                    var template = '';
                    template = this.template;
                    if (!this.oPreference) {
                        this.oPreference = new Preference(this.options.filterOptions.type || ['StreetAddress']);
                        if (!this.oPreference) {
                            throw new Error('Les preferences ne sont pas definies !?');
                        }
                    }
                    template = template.replace(/__PREFERENCE__/g, this.oPreference.toString());
                    if (!this.oPosition) {
                        var settings = {
                            position: this.options.position,
                            filter: {}
                        };
                        if (this.options.filterOptions) {
                            settings.filter = this.options.filterOptions;
                            delete settings.filter.type;
                        }
                        this.oPosition = new Position(settings);
                        if (!this.oPosition) {
                            throw new Error('La position et ses filtres ne sont pas definis !?');
                        }
                    }
                    template = template.replace(/__POSITION__/g, this.oPosition.toString());
                    template = template.replace(/__RETURNFREEFORM__/g, this.options.returnFreeForm ? 'true' : 'false');
                    this.strRequest = template;
                    return this.strRequest;
                }
            };
            return ReverseGeocodeRequest;
        }(UtilsLoggerByDefault, FormatsXLSLocationUtilityServiceModelPosition, FormatsXLSLocationUtilityServiceModelPreference);
        FormatsXLSLocationUtilityService = function (Logger, AbstractService, GeocodeRequest, ReverseGeocodeRequest, GeocodeFilterExtension) {
            function LocationUtilityService(options) {
                if (!(this instanceof LocationUtilityService)) {
                    throw new TypeError('LocationUtilityService constructor cannot be called as a function.');
                }
                this.CLASSNAME = 'LocationUtilityService';
                this.CLASSTYPE = null;
                AbstractService.apply(this, arguments);
                if (this.options) {
                    this.CLASSTYPE = this.options.location ? 'GeocodeRequest' : this.options.position ? 'ReverseGeocodeRequest' : null;
                }
            }
            LocationUtilityService.prototype = Object.create(AbstractService.prototype, {});
            LocationUtilityService.prototype.constructor = LocationUtilityService;
            LocationUtilityService.prototype.addRequest = function (oLUSRequest) {
                this.CLASSTYPE = oLUSRequest.CLASSNAME;
                switch (this.CLASSTYPE) {
                case 'GeocodeRequest':
                case 'ReverseGeocodeRequest':
                    this.oRequest = oLUSRequest;
                    break;
                default:
                    throw new Error('Ce n\'est pas un objet de type \'LUS Request\' !?');
                }
            };
            LocationUtilityService.prototype.addFilter = function (oFilter) {
                if (oFilter instanceof GeocodeFilterExtension) {
                    this.oFilter = oFilter;
                }
            };
            LocationUtilityService.prototype.toString = function () {
                if (!this.oRequest) {
                    if (!this.options) {
                        throw new Error('Les options ne sont pas renseignées, impossible de construire la requête !');
                    }
                    if (this.CLASSTYPE === 'GeocodeRequest') {
                        var settingsDirect = {
                            location: this.options.location,
                            returnFreeForm: this.options.returnFreeForm,
                            filterOptions: this.options.filterOptions || {}
                        };
                        this.oRequest = new GeocodeRequest(settingsDirect);
                        if (this.oFilter) {
                            this.oRequest.addFilter(this.oFilter);
                        }
                    } else if (this.CLASSTYPE === 'ReverseGeocodeRequest') {
                        var settingsInv = {
                            position: this.options.position,
                            returnFreeForm: this.options.returnFreeForm,
                            filterOptions: this.options.filterOptions || {}
                        };
                        this.oRequest = new ReverseGeocodeRequest(settingsInv);
                    } else {
                    }
                }
                if (!this.oRequest) {
                    throw new Error('Type de Geocodage indefini !');
                }
                this.strRequest = this.oRequest.toString();
                return this.strRequest;
            };
            return LocationUtilityService;
        }(UtilsLoggerByDefault, FormatsXLSAbstractService, FormatsXLSLocationUtilityServiceGeocodeRequest, FormatsXLSLocationUtilityServiceReverseGeocodeRequest, FormatsXLSLocationUtilityServiceGeocodeFilterExtension);
        ServicesGeocodeRequestGeocodeLocation = function () {
            function GeocodeLocation() {
                if (!(this instanceof GeocodeLocation)) {
                    throw new TypeError('GeocodeLocation constructor cannot be called as a function.');
                }
                this.placeAttributes = {};
                this.attributesList = [];
                this.serviceAttributes = [];
            }
            GeocodeLocation.prototype = { constructor: GeocodeLocation };
            return GeocodeLocation;
        }();
        ServicesGeocodeRequestModelStreetAddress = function (GeocodeLocation) {
            function StreetAddress() {
                if (!(this instanceof StreetAddress)) {
                    throw new TypeError('StreetAddress constructor cannot be called as a function.');
                }
                GeocodeLocation.apply(this, arguments);
                this.CLASSNAME = 'StreetAddress';
                this.attributesList = [
                    'bbox',
                    'ID',
                    'IDTR',
                    'quality',
                    'territory',
                    'commune',
                    'department',
                    'insee',
                    'municipality'
                ];
                this.serviceAttributes = [
                    'bbox',
                    'ID',
                    'IDTR',
                    'Qualite',
                    'Territoire',
                    'Commune',
                    'Departement',
                    'INSEE',
                    'Municipality'
                ];
            }
            StreetAddress.prototype = Object.create(GeocodeLocation.prototype);
            StreetAddress.prototype.constructor = StreetAddress;
            return StreetAddress;
        }(ServicesGeocodeRequestGeocodeLocation);
        ServicesGeocodeRequestModelPositionOfInterest = function (GeocodeLocation) {
            function PositionOfInterest() {
                if (!(this instanceof PositionOfInterest)) {
                    throw new TypeError('PositionOfInterest constructor cannot be called as a function.');
                }
                GeocodeLocation.apply(this, arguments);
                this.CLASSNAME = 'PositionOfInterest';
                this.attributesList = [
                    'bbox',
                    'importance',
                    'nature',
                    'territory',
                    'commune',
                    'department',
                    'insee',
                    'municipality'
                ];
                this.serviceAttributes = [
                    'bbox',
                    'Importance',
                    'Nature',
                    'Territoire',
                    'Commune',
                    'Departement',
                    'INSEE',
                    'Municipality'
                ];
            }
            PositionOfInterest.prototype = Object.create(GeocodeLocation.prototype);
            PositionOfInterest.prototype.constructor = PositionOfInterest;
            return PositionOfInterest;
        }(ServicesGeocodeRequestGeocodeLocation);
        ServicesGeocodeRequestModelCadastralParcel = function (GeocodeLocation) {
            function CadastralParcel() {
                if (!(this instanceof CadastralParcel)) {
                    throw new TypeError('CadastralParcel constructor cannot be called as a function.');
                }
                GeocodeLocation.apply(this, arguments);
                this.CLASSNAME = 'CadastralParcel';
                this.attributesList = [
                    'absorbedCity',
                    'sheet',
                    'number',
                    'section',
                    'commune',
                    'department',
                    'insee',
                    'municipality',
                    'origin'
                ];
                this.serviceAttributes = [
                    'CommuneAbsorbee',
                    'Feuille',
                    'Numero',
                    'Section',
                    'Commune',
                    'Departement',
                    'INSEE',
                    'Municipality',
                    'Type'
                ];
            }
            CadastralParcel.prototype = Object.create(GeocodeLocation.prototype);
            CadastralParcel.prototype.constructor = CadastralParcel;
            return CadastralParcel;
        }(ServicesGeocodeRequestGeocodeLocation);
        ServicesGeocodeRequestModelAdministratif = function (GeocodeLocation) {
            function Administratif() {
                if (!(this instanceof Administratif)) {
                    throw new TypeError('Administratif constructor cannot be called as a function.');
                }
                GeocodeLocation.apply(this, arguments);
                this.CLASSNAME = 'Administratif';
                this.attributesList = [
                    'bbox',
                    'prefecture',
                    'inseeRegion',
                    'inseeDepartment',
                    'municipality'
                ];
                this.serviceAttributes = [
                    'bbox',
                    'Prefecture',
                    'InseeRegion',
                    'InseeDepartement',
                    'Municipality'
                ];
            }
            Administratif.prototype = Object.create(GeocodeLocation.prototype);
            Administratif.prototype.constructor = Administratif;
            return Administratif;
        }(ServicesGeocodeRequestGeocodeLocation);
        ServicesGeocodeRequestDirectGeocodeRequestFactory = function (Logger, XLS, LocationUtilityService, GeocodeFilterExtension, StreetAddress, PositionOfInterest, CadastralParcel, Administratif) {
            var DirectGeocodeRequestFactory = {
                build: function (options) {
                    var request = null;
                    var oFilter = new GeocodeFilterExtension();
                    oFilter.addFilterExtensions(new Administratif());
                    oFilter.addFilterExtensions(new StreetAddress());
                    oFilter.addFilterExtensions(new PositionOfInterest());
                    oFilter.addFilterExtensions(new CadastralParcel());
                    var oLUS = new LocationUtilityService({
                        location: options.location,
                        returnFreeForm: options.returnFreeForm,
                        filterOptions: options.filterOptions
                    });
                    oLUS.addFilter(oFilter);
                    var oXLS = new XLS({
                        srsName: options.srs,
                        maximumResponses: options.maximumResponses
                    });
                    oXLS.namespace = true;
                    oXLS.setService(oLUS);
                    request = oXLS.build();
                    if (options.httpMethod == 'GET') {
                        var myRequest = 'qxml=' + encodeURIComponent(request).replace(/\-/g, '%2D').replace(/\_/g, '%5F').replace(/\./g, '%2E').replace(/\!/g, '%21').replace(/\~/g, '%7E').replace(/\*/g, '%2A').replace(/\'/g, '%27').replace(/\(/g, '%28').replace(/\)/g, '%29');
                        request = myRequest;
                    }
                    return request;
                }
            };
            return DirectGeocodeRequestFactory;
        }(UtilsLoggerByDefault, FormatsXLS, FormatsXLSLocationUtilityService, FormatsXLSLocationUtilityServiceGeocodeFilterExtension, ServicesGeocodeRequestModelStreetAddress, ServicesGeocodeRequestModelPositionOfInterest, ServicesGeocodeRequestModelCadastralParcel, ServicesGeocodeRequestModelAdministratif);
        ServicesGeocodeResponseModelGeocodeResponse = function () {
            function GeocodeResponse() {
                if (!(this instanceof GeocodeResponse)) {
                    throw new TypeError('GeocodeResponse constructor cannot be called as a function.');
                }
                this.locations = [];
            }
            GeocodeResponse.prototype = { constructor: GeocodeResponse };
            return GeocodeResponse;
        }();
        ServicesGeocodeResponseModelGeocodedLocation = function () {
            function GeocodedLocation() {
                if (!(this instanceof GeocodedLocation)) {
                    throw new TypeError('GeocodedLocation constructor cannot be called as a function.');
                }
                this.position = {
                    x: null,
                    y: null
                };
                this.matchType = null;
                this.placeAttributes = {};
                this.type = null;
            }
            GeocodedLocation.prototype = { constructor: GeocodedLocation };
            return GeocodedLocation;
        }();
        ServicesGeocodeResponseModelDirectGeocodedLocation = function (GeocodedLocation) {
            function DirectGeocodedLocation() {
                if (!(this instanceof DirectGeocodedLocation)) {
                    throw new TypeError('DirectGeocodedLocation constructor cannot be called as a function.');
                }
                GeocodedLocation.apply(this, arguments);
                this.CLASSNAME = 'DirectGeocodedLocation';
                this.accuracy = null;
            }
            DirectGeocodedLocation.prototype = Object.create(GeocodedLocation.prototype);
            DirectGeocodedLocation.prototype.constructor = DirectGeocodedLocation;
            return DirectGeocodedLocation;
        }(ServicesGeocodeResponseModelGeocodedLocation);
        ServicesGeocodeFormatsDirectGeocodeResponseReader = function (Logger, MR, ErrSrv, GeocodeResponse, DirectGeocodedLocation) {
            var DirectGeocodeResponseReader = {};
            DirectGeocodeResponseReader.VERSION = '1.2';
            DirectGeocodeResponseReader.NAMESPACES = {
                xmlns: 'http://www.opengis.net/xls',
                gml: 'http://www.opengis.net/gml',
                xls: 'http://www.opengis.net/xls',
                xlsext: 'http://www.opengis.net/xlsext',
                xsi: 'http://www.w3.org/2001/XMLSchema-instance'
            };
            DirectGeocodeResponseReader.SCHEMALOCATION = 'http://wxs.ign.fr/schemas/olsAll.xsd';
            DirectGeocodeResponseReader.DEFAULTPREFIX = 'xls';
            DirectGeocodeResponseReader.READERS = {
                xls: {
                    XLS: function (root) {
                        var geocodeResponse = new GeocodeResponse();
                        __checkServiceAttributes(root);
                        __getChildNodes(root, geocodeResponse);
                        return geocodeResponse;
                    },
                    GeocodedAddress: function (node, geocodeResponse) {
                        var geocodedLocation = new DirectGeocodedLocation();
                        __getChildNodes(node, geocodedLocation);
                        if (geocodeResponse && Array.isArray(geocodeResponse.locations)) {
                            geocodeResponse.locations.push(geocodedLocation);
                        }
                    },
                    GeocodeMatchCode: function (node, geocodedLocation) {
                        var acc = node.getAttribute('accuracy');
                        if (acc && geocodedLocation) {
                            geocodedLocation.accuracy = parseFloat(acc);
                        }
                        var matchType = node.getAttribute('matchType');
                        if (matchType && geocodedLocation) {
                            geocodedLocation.matchType = matchType;
                        }
                    },
                    Address: function (node, geocodedLocation) {
                        var countrycode = node.getAttribute('countryCode');
                        if (geocodedLocation && countrycode) {
                            geocodedLocation.type = countrycode;
                        }
                        __getChildNodes(node, geocodedLocation);
                    },
                    freeFormAddress: function (node, geocodedLocation) {
                        if (geocodedLocation && geocodedLocation.hasOwnProperty('placeAttributes')) {
                            geocodedLocation.placeAttributes.freeform = __getChildValue(node);
                        }
                    },
                    Building: function (node, geocodedLocation) {
                        var num = node.getAttribute('number');
                        if (geocodedLocation && geocodedLocation.hasOwnProperty('placeAttributes')) {
                            if (num) {
                                geocodedLocation.placeAttributes.number = num;
                            } else if (node.getAttribute('buildingName')) {
                                geocodedLocation.placeAttributes.number = node.getAttribute('buildingName');
                            } else if (node.getAttribute('subdivision')) {
                                geocodedLocation.placeAttributes.number = node.getAttribute('subdivision');
                            }
                        }
                    },
                    Street: function (node, geocodedLocation) {
                        if (geocodedLocation && geocodedLocation.hasOwnProperty('placeAttributes')) {
                            if (geocodedLocation.type === 'StreetAddress') {
                                geocodedLocation.placeAttributes.street = __getChildValue(node);
                            } else if (geocodedLocation.type === 'CadastralParcel') {
                                geocodedLocation.placeAttributes.cadastralParcel = __getChildValue(node);
                            }
                        }
                    },
                    Place: function (node, geocodedLocation) {
                        var placeType = node.getAttribute('type');
                        var placeName = __getChildValue(node);
                        if (geocodedLocation && geocodedLocation.hasOwnProperty('placeAttributes')) {
                            if (placeType === 'Municipality') {
                                geocodedLocation.placeAttributes.municipality = placeName;
                            } else if (placeType === 'Bbox') {
                                var values = placeName.split(';');
                                if (values.length === 4) {
                                    geocodedLocation.placeAttributes.bbox = {
                                        left: parseFloat(values[0]),
                                        right: parseFloat(values[2]),
                                        top: parseFloat(values[1]),
                                        bottom: parseFloat(values[3])
                                    };
                                }
                            } else if (placeType === 'Commune') {
                                geocodedLocation.placeAttributes.commune = placeName;
                            } else if (placeType === 'Departement') {
                                geocodedLocation.placeAttributes.department = placeName;
                            } else if (placeType === 'INSEE') {
                                geocodedLocation.placeAttributes.insee = placeName;
                            } else if (placeType === 'Qualite') {
                                geocodedLocation.placeAttributes.quality = placeName;
                            } else if (placeType === 'Territoire') {
                                geocodedLocation.placeAttributes.territory = placeName;
                            } else if (placeType === 'ID') {
                                geocodedLocation.placeAttributes.ID = placeName;
                            } else if (placeType === 'ID_TR') {
                                geocodedLocation.placeAttributes.IDTR = placeName;
                            } else if (placeType === 'Importance') {
                                geocodedLocation.placeAttributes.importance = parseInt(placeName, 10);
                            } else if (placeType === 'Nature') {
                                geocodedLocation.placeAttributes.nature = placeName;
                            } else if (placeType === 'Numero') {
                                geocodedLocation.placeAttributes.number = placeName;
                            } else if (placeType === 'Feuille') {
                                geocodedLocation.placeAttributes.sheet = placeName;
                            } else if (placeType === 'Section') {
                                geocodedLocation.placeAttributes.section = placeName;
                            } else if (placeType === 'CommuneAbsorbee') {
                                geocodedLocation.placeAttributes.absorbedCity = placeName;
                            } else if (placeType === 'Arrondissement') {
                                if (placeName) {
                                    geocodedLocation.placeAttributes.arrondissement = placeName;
                                }
                            } else if (placeType === 'Type') {
                                geocodedLocation.placeAttributes.origin = placeName;
                            } else if (placeType === 'Prefecture') {
                                geocodedLocation.placeAttributes.prefecture = placeName;
                            } else if (placeType === 'InseeRegion') {
                                geocodedLocation.placeAttributes.inseeRegion = placeName;
                            } else if (placeType === 'InseeDepartment') {
                                geocodedLocation.placeAttributes.inseeDepartment = placeName;
                            }
                        }
                    },
                    PostalCode: function (node, geocodedLocation) {
                        if (geocodedLocation && geocodedLocation.hasOwnProperty('placeAttributes')) {
                            geocodedLocation.placeAttributes.postalCode = __getChildValue(node);
                        }
                    },
                    Error: function (node) {
                        var srvMess = node.getAttribute('message');
                        var errorCode = node.getAttribute('errorCode');
                        var message = MR.getMessage('SERVICE_RESPONSE_EXCEPTION', '(' + errorCode + ') : ' + srvMess);
                        throw new ErrSrv({
                            message: message,
                            type: ErrSrv.TYPE_SRVERR
                        });
                    }
                },
                gml: {
                    pos: function (node, geocodedLocation) {
                        var pos = __getChildValue(node);
                        if (geocodedLocation && pos) {
                            geocodedLocation.position = {
                                x: parseFloat(pos.split(' ')[0]),
                                y: parseFloat(pos.split(' ')[1])
                            };
                        }
                    }
                },
                ExceptionReport: function (node) {
                    var response = {};
                    if (node.hasChildNodes()) {
                        var children = node.childNodes;
                        var child;
                        for (var i = 0; i < children.length; i++) {
                            child = children[i];
                            if (child.nodeName === 'Exception') {
                                response.exceptionReport = DirectGeocodeResponseReader.READERS['Exception'](child);
                            }
                        }
                    }
                    return response;
                },
                Exception: function (node) {
                    var exceptionReport = {};
                    var exceptionCode = node.getAttribute('exceptionCode');
                    if (exceptionCode) {
                        exceptionReport.exceptionCode = exceptionCode;
                    }
                    var textNode = node.firstChild;
                    if (textNode && textNode.nodeType === 3) {
                        exceptionReport.exception = textNode.nodeValue;
                    }
                    return exceptionReport;
                }
            };
            DirectGeocodeResponseReader.read = function (root) {
                if (root.nodeName === 'XLS') {
                    var nsPrefix = root.prefix;
                    if (!nsPrefix) {
                        nsPrefix = DirectGeocodeResponseReader.DEFAULTPREFIX;
                    }
                    var geocodeResponse = DirectGeocodeResponseReader.READERS[nsPrefix][root.nodeName](root);
                    return geocodeResponse;
                } else if (root.nodeName === 'ExceptionReport') {
                    var exceptionReport = DirectGeocodeResponseReader.READERS[root.nodeName](root);
                    return exceptionReport;
                } else {
                    var mess = MR.getMessage('SERVICE_RESPONSE_ANALYSE', root.nodeName);
                    throw new ErrSrv({
                        message: mess,
                        type: ErrSrv.TYPE_UNKERR,
                        status: 200
                    });
                }
            };
            function __getAttributes(node) {
                if (node.attributes.length > 0) {
                    var nodeAttributes = {};
                    var attributes = node.attributes;
                    for (var i = 0; i < attributes.length; i++) {
                        var attribute = attributes[i];
                        nodeAttributes[attribute.nodeName] = attribute.nodeValue;
                    }
                    return nodeAttributes;
                }
            }
            function __getChildNodes(node, data) {
                if (node.hasChildNodes()) {
                    var children = node.childNodes;
                    var child;
                    var childName;
                    var childPrefix;
                    for (var i = 0; i < children.length; i++) {
                        child = children[i];
                        if (child.nodeType === 1) {
                            childName = child.localName || child.baseName || child.nodeName;
                            childPrefix = child.prefix || DirectGeocodeResponseReader.DEFAULTPREFIX;
                            if (DirectGeocodeResponseReader.READERS[childPrefix][childName]) {
                                var reader = DirectGeocodeResponseReader.READERS[childPrefix][childName];
                                reader(child, data);
                            } else {
                                __getChildNodes(child, data);
                            }
                        }
                    }
                }
            }
            function __getChildValue(node) {
                var textNode;
                var value = '';
                if (node.hasChildNodes()) {
                    textNode = node.firstChild;
                    if (textNode.nodeType === 3) {
                        value = textNode.nodeValue;
                    }
                }
                return value;
            }
            function __checkServiceAttributes(XLSNode) {
                if (XLSNode.attributes.length > 0) {
                    var xlsAttributes = __getAttributes(XLSNode);
                    for (var att in xlsAttributes) {
                        if (xlsAttributes.hasOwnProperty(att)) {
                            if (att === 'version') {
                                if (xlsAttributes['version'] !== DirectGeocodeResponseReader.VERSION) {
                                    console.log('[DirectGeocodeResponseReader] geocode version is not the expected one : there may be errors in parsing');
                                    return;
                                }
                            }
                            if (att === 'xmlns') {
                                if (xlsAttributes[att] !== DirectGeocodeResponseReader.NAMESPACES[DirectGeocodeResponseReader.DEFAULTPREFIX]) {
                                    console.log('[DirectGeocodeResponseReader] geocode response default namespace is not the expected one');
                                    return;
                                }
                                continue;
                            }
                            var prefix = att.split(':')[0];
                            var ns = att.split(':')[1];
                            if (prefix === 'xmlns' && ns) {
                                if (DirectGeocodeResponseReader.NAMESPACES[ns]) {
                                    if (DirectGeocodeResponseReader.NAMESPACES[ns] !== xlsAttributes[att]) {
                                        console.log('[DirectGeocodeResponseReader] geocode response ' + att + ' namespace is not the expected one');
                                        return;
                                    }
                                }
                            }
                            if (ns === 'schemaLocation') {
                                if (DirectGeocodeResponseReader.SCHEMALOCATION !== xlsAttributes[att]) {
                                    console.log('[DirectGeocodeResponseReader] geocode response schema location is not the expected one');
                                    return;
                                }
                            }
                        }
                    }
                }
            }
            return DirectGeocodeResponseReader;
        }(UtilsLoggerByDefault, UtilsMessagesResources, ExceptionsErrorService, ServicesGeocodeResponseModelGeocodeResponse, ServicesGeocodeResponseModelDirectGeocodedLocation);
        ServicesGeocodeResponseDirectGeocodeResponseFactory = function (Logger, ErrorService, MRes, XML, DirectGeocodeResponseReader) {
            var DirectGeocodeReponseFactory = {
                build: function (options) {
                    var data = null;
                    if (options.response) {
                        if (options.rawResponse) {
                            data = options.response;
                        } else {
                            try {
                                var p = new XML({ reader: DirectGeocodeResponseReader });
                                if (typeof options.response === 'string') {
                                    p.setXMLString(options.response);
                                } else {
                                    p.setXMLDoc(options.response);
                                }
                                data = p.parse();
                                if (!data) {
                                    throw new Error('L\'analyse de la réponse du service !?');
                                }
                            } catch (e) {
                                var message = e.message;
                                if (typeof options.response === 'string') {
                                    message += '(\'' + options.response + '\')';
                                } else {
                                    message += '(\'' + options.response.documentElement.innerHTML + '\')';
                                }
                                options.onError.call(options.scope, new ErrorService({
                                    message: MRes.getMessage('SERVICE_RESPONSE_ANALYSE', message),
                                    type: ErrorService.TYPE_UNKERR,
                                    status: -1
                                }));
                                return;
                            }
                            if (data.exceptionReport) {
                                options.onError.call(options.scope, new ErrorService({
                                    message: MRes.getMessage('SERVICE_RESPONSE_EXCEPTION', data.exceptionReport),
                                    type: ErrorService.TYPE_SRVERR,
                                    status: 200
                                }));
                                return;
                            }
                        }
                    } else {
                        options.onError.call(options.scope, new ErrorService({
                            message: MRes.getMessage('SERVICE_RESPONSE_EMPTY'),
                            type: ErrorService.TYPE_SRVERR,
                            status: -1
                        }));
                        return;
                    }
                    options.onSuccess.call(options.scope, data);
                    return;
                }
            };
            return DirectGeocodeReponseFactory;
        }(UtilsLoggerByDefault, ExceptionsErrorService, UtilsMessagesResources, FormatsXML, ServicesGeocodeFormatsDirectGeocodeResponseReader);
        ServicesGeocodeGeocode = function (Logger, _, ErrorService, CommonService, DirectGeocodeRequestFactory, DirectGeocodeResponseFactory) {
            function Geocode(options) {
                if (!(this instanceof Geocode)) {
                    throw new TypeError(_.getMessage('CLASS_CONSTRUCTOR', 'Geocode'));
                }
                this.CLASSNAME = 'Geocode';
                CommonService.apply(this, arguments);
                if (!options.location) {
                    throw new Error(_.getMessage('PARAM_MISSING', 'location'));
                }
                if (typeof options.location === 'object' && Object.keys(options.location).length === 0) {
                    throw new Error(_.getMessage('PARAM_EMPTY', 'location'));
                } else if (typeof options.location === 'string' && options.location.length === 0) {
                    throw new Error(_.getMessage('PARAM_EMPTY', 'location'));
                }
                this.options.location = options.location;
                if (!options.filterOptions || typeof options.filterOptions !== 'object') {
                    this.options.filterOptions = options.filterOptions = { type: ['StreetAddress'] };
                }
                if (Object.keys(options.filterOptions).length === 0) {
                    this.options.filterOptions = { type: ['StreetAddress'] };
                }
                var filter = Object.keys(options.filterOptions);
                for (var i = 0; i < filter.length; i++) {
                    var key = filter[i];
                    var filtersCouldBeNumberList = [
                        'department',
                        'number',
                        'postalCode',
                        'insee',
                        'importance',
                        'ID',
                        'IDTR',
                        'absorbedCity',
                        'sheet',
                        'section',
                        'inseeRegion',
                        'inseeDepartment'
                    ];
                    if (filtersCouldBeNumberList.indexOf(key) !== -1 && typeof options.filterOptions[key] !== 'string') {
                        options.filterOptions[key] = options.filterOptions[key].toString();
                    }
                    if (!options.filterOptions[key]) {
                        delete this.options.filterOptions[key];
                    }
                }
                this.options.filterOptions.type = options.filterOptions.type || ['StreetAddress'];
                this.options.maximumResponses = options.maximumResponses || 25;
                this.options.returnFreeForm = options.returnFreeForm || false;
                this.options.srs = options.srs || 'EPSG:4326';
                this.options.outputFormat = this.options.rawResponse ? '' : 'xml';
            }
            Geocode.prototype = Object.create(CommonService.prototype, {});
            Geocode.prototype.constructor = Geocode;
            Geocode.prototype.buildRequest = function (error, success) {
                var options = {
                    httpMethod: this.options.httpMethod,
                    location: this.options.location,
                    returnFreeForm: this.options.returnFreeForm,
                    filterOptions: this.options.filterOptions,
                    srs: this.options.srs,
                    maximumResponses: this.options.maximumResponses
                };
                this.request = DirectGeocodeRequestFactory.build(options);
                if (!this.request) {
                    error.call(this, new ErrorService(_.getMessage('SERVICE_REQUEST_BUILD')));
                } else {
                    success.call(this, this.request);
                }
            };
            Geocode.prototype.analyzeResponse = function (error, success) {
                if (this.response) {
                    var options = {
                        response: this.response,
                        rawResponse: this.options.rawResponse,
                        onError: error,
                        onSuccess: success,
                        scope: this
                    };
                    DirectGeocodeResponseFactory.build(options);
                } else {
                    error.call(this, new ErrorService(_.getMessage('SERVICE_RESPONSE_EMPTY')));
                }
            };
            return Geocode;
        }(UtilsLoggerByDefault, UtilsMessagesResources, ExceptionsErrorService, ServicesCommonService, ServicesGeocodeRequestDirectGeocodeRequestFactory, ServicesGeocodeResponseDirectGeocodeResponseFactory);
        ServicesGeocodeRequestReverseGeocodeRequestFactory = function (Logger, XLS, LocationUtilityService) {
            var ReverseGeocodeRequestFactory = {
                build: function (options) {
                    var settings = options || {};
                    var request = null;
                    var oLUS = new LocationUtilityService({
                        position: settings.position,
                        returnFreeForm: settings.returnFreeForm,
                        filterOptions: settings.filterOptions
                    });
                    var oXLS = new XLS({
                        srsName: settings.srs,
                        maximumResponses: settings.maximumResponses
                    });
                    oXLS.namespace = true;
                    oXLS.setService(oLUS);
                    request = oXLS.build();
                    if (settings.httpMethod == 'GET') {
                        var myRequest = 'qxml=' + encodeURIComponent(request).replace(/\-/g, '%2D').replace(/\_/g, '%5F').replace(/\./g, '%2E').replace(/\!/g, '%21').replace(/\~/g, '%7E').replace(/\*/g, '%2A').replace(/\'/g, '%27').replace(/\(/g, '%28').replace(/\)/g, '%29');
                        request = myRequest;
                    }
                    return request;
                }
            };
            return ReverseGeocodeRequestFactory;
        }(UtilsLoggerByDefault, FormatsXLS, FormatsXLSLocationUtilityService);
        ServicesGeocodeResponseModelReverseGeocodedLocation = function (GeocodedLocation) {
            function ReverseGeocodedLocation() {
                if (!(this instanceof ReverseGeocodedLocation)) {
                    throw new TypeError('ReverseGeocodedLocation constructor cannot be called as a function.');
                }
                GeocodedLocation.apply(this, arguments);
                this.CLASSNAME = 'ReverseGeocodedLocation';
                this.searchCenterDistance = null;
            }
            ReverseGeocodedLocation.prototype = Object.create(GeocodedLocation.prototype);
            ReverseGeocodedLocation.prototype.constructor = ReverseGeocodedLocation;
            return ReverseGeocodedLocation;
        }(ServicesGeocodeResponseModelGeocodedLocation);
        ServicesGeocodeFormatsReverseGeocodeResponseReader = function (Logger, MR, ErrSrv, ReverseGeocodeResponse, ReverseGeocodedLocation) {
            var ReverseGeocodeResponseReader = {};
            ReverseGeocodeResponseReader.VERSION = '1.2';
            ReverseGeocodeResponseReader.NAMESPACES = {
                xmlns: 'http://www.opengis.net/xls',
                gml: 'http://www.opengis.net/gml',
                xls: 'http://www.opengis.net/xls',
                xlsext: 'http://www.opengis.net/xlsext',
                xsi: 'http://www.w3.org/2001/XMLSchema-instance'
            };
            ReverseGeocodeResponseReader.SCHEMALOCATION = 'http://wxs.ign.fr/schemas/olsAll.xsd';
            ReverseGeocodeResponseReader.DEFAULTPREFIX = 'xls';
            ReverseGeocodeResponseReader.READERS = {
                xls: {
                    XLS: function (root) {
                        var reverseGeocodeResponse = new ReverseGeocodeResponse();
                        __checkServiceAttributes(root);
                        __getChildNodes(root, reverseGeocodeResponse);
                        return reverseGeocodeResponse;
                    },
                    ReverseGeocodedLocation: function (node, reverseGeocodeResponse) {
                        var reverseGeocodedLocation = new ReverseGeocodedLocation();
                        __getChildNodes(node, reverseGeocodedLocation);
                        if (reverseGeocodeResponse && Array.isArray(reverseGeocodeResponse.locations)) {
                            reverseGeocodeResponse.locations.push(reverseGeocodedLocation);
                        }
                    },
                    Address: function (node, reverseGeocodedLocation) {
                        var countrycode = node.getAttribute('countryCode');
                        if (reverseGeocodedLocation && countrycode) {
                            reverseGeocodedLocation.type = countrycode;
                        }
                        __getChildNodes(node, reverseGeocodedLocation);
                    },
                    Building: function (node, reverseGeocodedLocation) {
                        var num = node.getAttribute('number');
                        if (reverseGeocodedLocation && reverseGeocodedLocation.hasOwnProperty('placeAttributes')) {
                            if (num) {
                                reverseGeocodedLocation.placeAttributes.number = num;
                            } else if (node.getAttribute('buildingName')) {
                                reverseGeocodedLocation.placeAttributes.number = node.getAttribute('buildingName');
                            } else if (node.getAttribute('subdivision')) {
                                reverseGeocodedLocation.placeAttributes.number = node.getAttribute('subdivision');
                            }
                        }
                    },
                    Street: function (node, reverseGeocodedLocation) {
                        if (reverseGeocodedLocation.type === 'StreetAddress') {
                            reverseGeocodedLocation.placeAttributes.street = __getChildValue(node);
                        } else if (reverseGeocodedLocation.type === 'CadastralParcel') {
                            reverseGeocodedLocation.placeAttributes.cadastralParcel = __getChildValue(node);
                        }
                    },
                    Place: function (node, reverseGeocodedLocation) {
                        var placeType = node.getAttribute('type');
                        var placeName = __getChildValue(node);
                        if (reverseGeocodedLocation && reverseGeocodedLocation.hasOwnProperty('placeAttributes')) {
                            if (placeType === 'Municipality') {
                                reverseGeocodedLocation.placeAttributes.municipality = placeName;
                            } else if (placeType === 'Bbox') {
                                var values = placeName.split(';');
                                if (values.length === 4) {
                                    reverseGeocodedLocation.placeAttributes.bbox = {
                                        left: parseFloat(values[0]),
                                        right: parseFloat(values[2]),
                                        top: parseFloat(values[1]),
                                        bottom: parseFloat(values[3])
                                    };
                                }
                            } else if (placeType === 'Commune') {
                                reverseGeocodedLocation.placeAttributes.commune = placeName;
                            } else if (placeType === 'Departement') {
                                reverseGeocodedLocation.placeAttributes.department = placeName;
                            } else if (placeType === 'INSEE') {
                                reverseGeocodedLocation.placeAttributes.insee = placeName;
                            } else if (placeType === 'Qualite') {
                                reverseGeocodedLocation.placeAttributes.quality = placeName;
                            } else if (placeType === 'Territoire') {
                                reverseGeocodedLocation.placeAttributes.territory = placeName;
                            } else if (placeType === 'ID') {
                                reverseGeocodedLocation.placeAttributes.ID = placeName;
                            } else if (placeType === 'ID_TR') {
                                reverseGeocodedLocation.placeAttributes.IDTR = placeName;
                            } else if (placeType === 'Importance') {
                                reverseGeocodedLocation.placeAttributes.importance = parseInt(placeName, 10);
                            } else if (placeType === 'Nature') {
                                reverseGeocodedLocation.placeAttributes.nature = placeName;
                            } else if (placeType === 'Numero') {
                                reverseGeocodedLocation.placeAttributes.number = placeName;
                            } else if (placeType === 'Feuille') {
                                reverseGeocodedLocation.placeAttributes.sheet = placeName;
                            } else if (placeType === 'Section') {
                                reverseGeocodedLocation.placeAttributes.section = placeName;
                            } else if (placeType === 'CommuneAbsorbee') {
                                reverseGeocodedLocation.placeAttributes.absorbedCity = placeName;
                            } else if (placeType === 'Arrondissement') {
                                if (placeName) {
                                    reverseGeocodedLocation.placeAttributes.arrondissement = placeName;
                                }
                            } else if (placeType === 'Type') {
                                reverseGeocodedLocation.placeAttributes.origin = placeName;
                            } else if (placeType === 'Prefecture') {
                                reverseGeocodedLocation.placeAttributes.prefecture = placeName;
                            } else if (placeType === 'InseeRegion') {
                                reverseGeocodedLocation.placeAttributes.inseeRegion = placeName;
                            } else if (placeType === 'InseeDepartment') {
                                reverseGeocodedLocation.placeAttributes.inseeDepartment = placeName;
                            }
                        }
                    },
                    PostalCode: function (node, reverseGeocodedLocation) {
                        if (reverseGeocodedLocation && reverseGeocodedLocation.hasOwnProperty('placeAttributes')) {
                            reverseGeocodedLocation.placeAttributes.postalCode = __getChildValue(node);
                        }
                    },
                    SearchCentreDistance: function (node, reverseGeocodedLocation) {
                        if (reverseGeocodedLocation) {
                            reverseGeocodedLocation.searchCenterDistance = parseFloat(node.getAttribute('value'));
                        }
                    },
                    Error: function (node) {
                        var srvMess = node.getAttribute('message');
                        var errorCode = node.getAttribute('errorCode');
                        var message = MR.getMessage('SERVICE_RESPONSE_EXCEPTION', '(' + errorCode + ') : ' + srvMess);
                        throw new ErrSrv({
                            message: message,
                            type: ErrSrv.TYPE_SRVERR
                        });
                    }
                },
                gml: {
                    pos: function (node, reverseGeocodedLocation) {
                        var pos = __getChildValue(node);
                        if (reverseGeocodedLocation && pos) {
                            reverseGeocodedLocation.position = {
                                x: parseFloat(pos.split(' ')[0]),
                                y: parseFloat(pos.split(' ')[1])
                            };
                        }
                    }
                },
                xlsext: {
                    ExtendedGeocodeMatchCode: function (node, reverseGeocodedLocation) {
                        if (reverseGeocodedLocation) {
                            reverseGeocodedLocation.matchType = __getChildValue(node);
                        }
                    }
                },
                ExceptionReport: function (node) {
                    var response = {};
                    if (node.hasChildNodes()) {
                        var children = node.childNodes;
                        var child;
                        for (var i = 0; i < children.length; i++) {
                            child = children[i];
                            if (child.nodeName === 'Exception') {
                                response.exceptionReport = ReverseGeocodeResponseReader.READERS['Exception'](child);
                            }
                        }
                    }
                    return response;
                },
                Exception: function (node) {
                    var exceptionReport = {};
                    var exceptionCode = node.getAttribute('exceptionCode');
                    if (exceptionCode) {
                        exceptionReport.exceptionCode = exceptionCode;
                    }
                    var textNode = node.firstChild;
                    if (textNode && textNode.nodeType === 3) {
                        exceptionReport.exception = textNode.nodeValue;
                    }
                    return exceptionReport;
                }
            };
            ReverseGeocodeResponseReader.read = function (root) {
                if (root.nodeName === 'XLS') {
                    var nsPrefix = root.prefix;
                    if (!nsPrefix) {
                        nsPrefix = ReverseGeocodeResponseReader.DEFAULTPREFIX;
                    }
                    var geocodeResponse = ReverseGeocodeResponseReader.READERS[nsPrefix][root.nodeName](root);
                    return geocodeResponse;
                } else if (root.nodeName === 'ExceptionReport') {
                    var exceptionReport = ReverseGeocodeResponseReader.READERS[root.nodeName](root);
                    return exceptionReport;
                } else {
                    throw new Error('Erreur lors de la lecture de la réponse : elle n\'est pas au format attendu.');
                }
            };
            function __getAttributes(node) {
                if (node.attributes.length > 0) {
                    var nodeAttributes = {};
                    var attributes = node.attributes;
                    for (var i = 0; i < attributes.length; i++) {
                        var attribute = attributes[i];
                        nodeAttributes[attribute.nodeName] = attribute.nodeValue;
                    }
                    return nodeAttributes;
                }
            }
            function __getChildNodes(node, data) {
                if (node.hasChildNodes()) {
                    var children = node.childNodes;
                    var child;
                    var childName;
                    var childPrefix;
                    for (var i = 0; i < children.length; i++) {
                        child = children[i];
                        if (child.nodeType === 1) {
                            childName = child.localName || child.baseName || child.nodeName;
                            childPrefix = child.prefix || ReverseGeocodeResponseReader.DEFAULTPREFIX;
                            if (ReverseGeocodeResponseReader.READERS[childPrefix][childName]) {
                                var reader = ReverseGeocodeResponseReader.READERS[childPrefix][childName];
                                reader(child, data);
                            } else {
                                __getChildNodes(child, data);
                            }
                        }
                    }
                }
            }
            function __getChildValue(node) {
                var textNode;
                var value = '';
                if (node.hasChildNodes()) {
                    textNode = node.firstChild;
                    if (textNode.nodeType === 3) {
                        value = textNode.nodeValue;
                    }
                }
                return value;
            }
            function __checkServiceAttributes(XLSNode) {
                if (XLSNode.attributes.length > 0) {
                    var xlsAttributes = __getAttributes(XLSNode);
                    for (var att in xlsAttributes) {
                        if (xlsAttributes.hasOwnProperty(att)) {
                            if (att === 'version') {
                                if (xlsAttributes['version'] !== ReverseGeocodeResponseReader.VERSION) {
                                    console.log('[ReverseGeocodeResponseReader] geocode version is not the expected one : there may be errors in parsing');
                                    return;
                                }
                            }
                            if (att === 'xmlns') {
                                if (xlsAttributes[att] !== ReverseGeocodeResponseReader.NAMESPACES[ReverseGeocodeResponseReader.DEFAULTPREFIX]) {
                                    console.log('[ReverseGeocodeResponseReader] geocode response default namespace is not the expected one');
                                    return;
                                }
                                continue;
                            }
                            var prefix = att.split(':')[0];
                            var ns = att.split(':')[1];
                            if (prefix === 'xmlns' && ns) {
                                if (ReverseGeocodeResponseReader.NAMESPACES[ns]) {
                                    if (ReverseGeocodeResponseReader.NAMESPACES[ns] !== xlsAttributes[att]) {
                                        console.log('[ReverseGeocodeResponseReader] geocode response ' + att + ' namespace is not the expected one');
                                        return;
                                    }
                                }
                            }
                            if (ns === 'schemaLocation') {
                                if (ReverseGeocodeResponseReader.SCHEMALOCATION !== xlsAttributes[att]) {
                                    console.log('[ReverseGeocodeResponseReader] geocode response schema location is not the expected one');
                                    return;
                                }
                            }
                        }
                    }
                }
            }
            return ReverseGeocodeResponseReader;
        }(UtilsLoggerByDefault, UtilsMessagesResources, ExceptionsErrorService, ServicesGeocodeResponseModelGeocodeResponse, ServicesGeocodeResponseModelReverseGeocodedLocation);
        ServicesGeocodeResponseReverseGeocodeResponseFactory = function (Logger, MRes, ErrorService, XML, ReverseGeocodeResponseReader) {
            var ReverseGeocodeReponseFactory = {
                build: function (options) {
                    var data = null;
                    if (options.response) {
                        if (options.rawResponse) {
                            data = options.response;
                        } else {
                            try {
                                var p = new XML({ reader: ReverseGeocodeResponseReader });
                                if (typeof options.response === 'string') {
                                    p.setXMLString(options.response);
                                } else {
                                    p.setXMLDoc(options.response);
                                }
                                data = p.parse();
                                if (!data) {
                                    throw new Error('L\'analyse de la réponse du service !?');
                                }
                            } catch (e) {
                                e.status = 200;
                                options.onError.call(options.scope, e);
                                return;
                            }
                            if (data.exceptionReport) {
                                options.onError.call(options.scope, new ErrorService({
                                    message: MRes.getMessage('SERVICE_RESPONSE_EXCEPTION', data.exceptionReport),
                                    type: ErrorService.TYPE_SRVERR,
                                    status: 200
                                }));
                                return;
                            }
                            if (options.scope && options.scope.options && options.scope.options.srs && options.scope.options.srs !== 'EPSG:4326') {
                                var location;
                                var pos;
                                if (data || data.locations || data.locations.length) {
                                    for (var i = 0; i < data.locations.length; i++) {
                                        location = data.locations[i];
                                        if (location) {
                                            pos = location.position;
                                            if (pos) {
                                                location.position = {
                                                    x: pos.y,
                                                    y: pos.x
                                                };
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    } else {
                        options.onError.call(options.scope, new ErrorService({
                            message: MRes.getMessage('SERVICE_RESPONSE_EMPTY'),
                            type: ErrorService.TYPE_SRVERR,
                            status: -1
                        }));
                        return;
                    }
                    options.onSuccess.call(options.scope, data);
                    return;
                }
            };
            return ReverseGeocodeReponseFactory;
        }(UtilsLoggerByDefault, UtilsMessagesResources, ExceptionsErrorService, FormatsXML, ServicesGeocodeFormatsReverseGeocodeResponseReader);
        ServicesGeocodeReverseGeocode = function (Logger, _, ErrorService, CommonService, ReverseGeocodeRequestFactory, ReverseGeocodeResponseFactory) {
            function ReverseGeocode(options) {
                if (!(this instanceof ReverseGeocode)) {
                    throw new TypeError(_.getMessage('CLASS_CONSTRUCTOR', 'ReverseGeocode'));
                }
                this.CLASSNAME = 'ReverseGeocode';
                CommonService.apply(this, arguments);
                if (!options.position) {
                    throw new Error(_.getMessage('PARAM_MISSING', 'position'));
                }
                if (options.position.x == null) {
                    throw new Error(_.getMessage('PARAM_MISSING', 'position.x'));
                }
                if (options.position.y == null) {
                    throw new Error(_.getMessage('PARAM_MISSING', 'position.y'));
                }
                this.options.position = options.position;
                if (!options.filterOptions || typeof options.filterOptions !== 'object') {
                    this.options.filterOptions = options.filterOptions = { type: ['StreetAddress'] };
                }
                if (Object.keys(options.filterOptions).length === 0) {
                    this.options.filterOptions = { type: ['StreetAddress'] };
                }
                var filter = Object.keys(options.filterOptions);
                for (var i = 0; i < filter.length; i++) {
                    var key = filter[i];
                    if (!options.filterOptions[key] || Object.keys(options.filterOptions[key]).length === 0) {
                        delete this.options.filterOptions[key];
                    }
                }
                this.options.filterOptions.type = options.filterOptions.type || ['StreetAddress'];
                if (!Array.isArray(this.options.filterOptions.type)) {
                    throw new Error(_.getMessage('PARAM_TYPE', 'filterOptions.type'));
                }
                this.options.maximumResponses = options.maximumResponses || 25;
                this.options.returnFreeForm = options.returnFreeForm || false;
                this.options.srs = options.srs || 'CRS:84';
                if (ReverseGeocode.geoEPSG.indexOf(this.options.srs) === -1) {
                    this.options.position = {
                        x: this.options.position.y,
                        y: this.options.position.x
                    };
                    if (this.options.filterOptions && this.options.filterOptions.circle) {
                        var circle = this.options.filterOptions.circle;
                        this.options.filterOptions.circle = {
                            x: circle.y,
                            y: circle.x,
                            radius: circle.radius
                        };
                    }
                    if (this.options.filterOptions && this.options.filterOptions.polygon) {
                        var polygon = this.options.filterOptions.polygon;
                        for (i = 0; i < polygon.length; i++) {
                            var coords = polygon[i];
                            this.options.filterOptions.polygon[i] = {
                                x: coords.y,
                                y: coords.x
                            };
                        }
                    }
                }
                this.options.outputFormat = this.options.rawResponse ? '' : 'xml';
            }
            ReverseGeocode.prototype = Object.create(CommonService.prototype, {});
            ReverseGeocode.prototype.constructor = ReverseGeocode;
            ReverseGeocode.prototype.buildRequest = function (error, success) {
                var options = {
                    httpMethod: this.options.httpMethod,
                    position: this.options.position,
                    returnFreeForm: this.options.returnFreeForm,
                    filterOptions: this.options.filterOptions,
                    srs: 'EPSG:4326',
                    maximumResponses: this.options.maximumResponses
                };
                this.request = ReverseGeocodeRequestFactory.build(options);
                if (!this.request) {
                    error.call(this, new ErrorService(_.getMessage('SERVICE_REQUEST_BUILD')));
                } else {
                    success.call(this, this.request);
                }
            };
            ReverseGeocode.prototype.analyzeResponse = function (error, success) {
                if (this.response) {
                    var options = {
                        response: this.response,
                        rawResponse: this.options.rawResponse,
                        onError: error,
                        onSuccess: success,
                        scope: this
                    };
                    ReverseGeocodeResponseFactory.build(options);
                } else {
                    error.call(this, new ErrorService(_.getMessage('SERVICE_RESPONSE_EMPTY')));
                }
            };
            ReverseGeocode.geoEPSG = ['EPSG:4326'];
            return ReverseGeocode;
        }(UtilsLoggerByDefault, UtilsMessagesResources, ExceptionsErrorService, ServicesCommonService, ServicesGeocodeRequestReverseGeocodeRequestFactory, ServicesGeocodeResponseReverseGeocodeResponseFactory);
        ServicesAutoCompleteResponseModelAutoCompleteResponse = function () {
            function AutoCompleteResponse() {
                if (!(this instanceof AutoCompleteResponse)) {
                    throw new TypeError('AutoCompleteResponse constructor cannot be called as a function.');
                }
                this.suggestedLocations = [];
            }
            AutoCompleteResponse.prototype = { constructor: AutoCompleteResponse };
            return AutoCompleteResponse;
        }();
        ServicesAutoCompleteResponseModelSuggestedLocation = function () {
            function SuggestedLocation() {
                if (!(this instanceof SuggestedLocation)) {
                    throw new TypeError('SuggestedLocation constructor cannot be called as a function.');
                }
                this.type = null;
                this.position = {
                    x: null,
                    y: null
                };
                this.commune = null;
                this.fullText = null;
                this.postalCode = null;
                this.classification = null;
                this.street = null;
                this.poi = null;
                this.kind = null;
            }
            SuggestedLocation.prototype = { constructor: SuggestedLocation };
            return SuggestedLocation;
        }();
        ServicesAutoCompleteResponseAutoCompleteResponseFactory = function (Logger, ErrorService, MRes, XML, AutoCompleteResponse, SuggestedLocation) {
            var AutoCompleteResponseFactory = {
                build: function (options) {
                    var data = null;
                    if (options.response) {
                        if (options.rawResponse) {
                            data = options.response;
                        } else {
                            var JSONResponse;
                            if (typeof options.response === 'string') {
                                JSONResponse = window.JSON.parse(options.response);
                            } else {
                                JSONResponse = options.response;
                            }
                            if (JSONResponse) {
                                if (JSONResponse.error) {
                                    options.onError.call(options.scope, new ErrorService({
                                        message: MRes.getMessage('SERVICE_RESPONSE_EXCEPTION', JSONResponse.error.description),
                                        status: JSONResponse.error.code,
                                        type: ErrorService.TYPE_SRVERR
                                    }));
                                    return;
                                }
                                data = new AutoCompleteResponse();
                                if (JSONResponse.results && Array.isArray(JSONResponse.results)) {
                                    var suggestedLocation;
                                    for (var i = 0; i < JSONResponse.results.length; i++) {
                                        var result = JSONResponse.results[i];
                                        suggestedLocation = new SuggestedLocation();
                                        if (suggestedLocation) {
                                            if (result && result.country === 'StreetAddress') {
                                                suggestedLocation.street = result.street;
                                                suggestedLocation.type = 'StreetAddress';
                                            } else if (result && result.country === 'PositionOfInterest') {
                                                suggestedLocation.poi = result.street;
                                                suggestedLocation.kind = result.kind;
                                                suggestedLocation.type = 'PositionOfInterest';
                                            }
                                            if (suggestedLocation.position) {
                                                suggestedLocation.position.x = result.x;
                                                suggestedLocation.position.y = result.y;
                                            }
                                            suggestedLocation.commune = result.city;
                                            suggestedLocation.fullText = result.fulltext;
                                            suggestedLocation.postalCode = result.zipcode;
                                            suggestedLocation.classification = result.classification;
                                        }
                                        data.suggestedLocations.push(suggestedLocation);
                                    }
                                } else {
                                    options.onError.call(options.scope, new ErrorService(MRes.getMessage('SERVICE_RESPONSE_FORMAT_3')));
                                    return;
                                }
                                if (!data.suggestedLocations.length) {
                                    options.onError.call(options.scope, new ErrorService(MRes.getMessage('SERVICE_RESPONSE_FORMAT_3')));
                                    return;
                                }
                            }
                            if (!data) {
                                options.onError.call(options.scope, new ErrorService({
                                    message: MRes.getMessage('SERVICE_RESPONSE_ANALYSE_2'),
                                    type: ErrorService.TYPE_UNKERR,
                                    status: -1
                                }));
                                return;
                            }
                            if (data.exceptionReport) {
                                options.onError.call(options.scope, new ErrorService({
                                    message: MRes.getMessage('SERVICE_RESPONSE_EXCEPTION', data.exceptionReport),
                                    type: ErrorService.TYPE_SRVERR,
                                    status: 200
                                }));
                                return;
                            }
                        }
                    } else {
                        options.onError.call(options.scope, new ErrorService(MRes.getMessage('SERVICE_RESPONSE_EMPTY')));
                        return;
                    }
                    options.onSuccess.call(options.scope, data);
                    return;
                }
            };
            return AutoCompleteResponseFactory;
        }(UtilsLoggerByDefault, ExceptionsErrorService, UtilsMessagesResources, FormatsXML, ServicesAutoCompleteResponseModelAutoCompleteResponse, ServicesAutoCompleteResponseModelSuggestedLocation);
        ServicesAutoCompleteAutoComplete = function (CommonService, AutoCompleteResponseFactory, Logger, MR, ErrorService, Helper) {
            function AutoComplete(options) {
                if (!(this instanceof AutoComplete)) {
                    throw new TypeError(MR.getMessage('CLASS_CONSTRUCTOR', 'AutoComplete'));
                }
                this.CLASSNAME = 'AutoComplete';
                CommonService.apply(this, arguments);
                if (!options.text) {
                    throw new Error(MR.getMessage('PARAM_MISSING', 'text'));
                }
                this.options.text = options.text;
                if (!options.filterOptions || typeof options.filterOptions !== 'object') {
                    this.options.filterOptions = options.filterOptions = {
                        territory: [],
                        type: ['StreetAddress']
                    };
                }
                if (Object.keys(options.filterOptions).length === 0) {
                    this.options.filterOptions = {
                        territory: [],
                        type: ['StreetAddress']
                    };
                }
                this.options.filterOptions.type = options.filterOptions.type || ['StreetAddress'];
                this.options.filterOptions.territory = options.filterOptions.territory || [];
                this.options.maximumResponses = options.maximumResponses || 10;
                if (this.options.protocol === 'XHR' && this.options.httpMethod === 'POST') {
                    this.options.httpMethod = 'GET';
                }
                this.options.outputFormat = this.options.rawResponse ? '' : 'json';
            }
            AutoComplete.prototype = Object.create(CommonService.prototype, {});
            AutoComplete.prototype.constructor = AutoComplete;
            AutoComplete.prototype.buildRequest = function (error, success) {
                var territories = '';
                if (this.options.filterOptions.territory) {
                    territories = this.options.filterOptions.territory.join(';');
                }
                var types = '';
                if (this.options.filterOptions.type) {
                    types = this.options.filterOptions.type.join(',');
                }
                this.request = Helper.normalyzeParameters({
                    text: encodeURIComponent(this.options.text),
                    type: types,
                    terr: territories,
                    maximumResponses: this.options.maximumResponses
                });
                success.call(this, this.request);
            };
            AutoComplete.prototype.analyzeResponse = function (error, success) {
                if (this.response) {
                    var options = {
                        response: this.response,
                        rawResponse: this.options.rawResponse,
                        onSuccess: success,
                        onError: error,
                        scope: this
                    };
                    AutoCompleteResponseFactory.build(options);
                } else {
                    error.call(this, new ErrorService(MR.getMessage('SERVICE_RESPONSE_EMPTY')));
                }
            };
            return AutoComplete;
        }(ServicesCommonService, ServicesAutoCompleteResponseAutoCompleteResponseFactory, UtilsLoggerByDefault, UtilsMessagesResources, ExceptionsErrorService, UtilsHelper);
        FormatsXLSRouteServiceModelRoutePlan = function (Logger) {
            function RoutePlan(options) {
                if (!(this instanceof RoutePlan)) {
                    throw new TypeError('RoutePlan constructor cannot be called as a function.');
                }
                this.options = options || {};
                if (!options.startPoint) {
                    throw new Error('l\'option \'startPoint\' n\'est pas renseignée !');
                }
                if (!options.endPoint) {
                    throw new Error('l\'option \'endPoint\' n\'est pas renseignée !');
                }
                for (var opt in options) {
                    if (options.hasOwnProperty(opt)) {
                        this.options[opt] = options[opt];
                    }
                }
            }
            RoutePlan.prototype = {
                constructor: RoutePlan,
                requestString: null,
                template: {
                    routePlan: '<RoutePlan>' + '__ROUTEPREFERENCE__' + '__GRAPH__' + '__WAYPOINTLIST__' + '__AVOIDLIST__' + '</RoutePlan>',
                    routePreference: '<RoutePreference>__VALUEROUTEPREFERENCE__</RoutePreference>',
                    graph: '<xlsext:graphName xmlns:xlsext="http://www.opengis.net/xlsext" name="__VALUEGRAPH__"/>',
                    wayPointList: {
                        container: '<WayPointList>' + '__STARTPOINT__' + '__VIAPOINT__' + '__ENDPOINT__' + '</WayPointList>',
                        point: '<Position><gml:Point xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos></gml:Point></Position>',
                        startPoint: '<StartPoint>' + '__POINT__' + '</StartPoint>',
                        endPoint: '<EndPoint>' + '__POINT__' + '</EndPoint>',
                        viaPoint: '<ViaPoint>' + '__POINT__' + '</ViaPoint>'
                    },
                    avoidList: {
                        container: '<AvoidList>' + '__AVOIDFEATURE__' + '</AvoidList>',
                        avoidFeature: '<AvoidFeature>__VALUEAVOIDFEATURE__</AvoidFeature>'
                    }
                },
                toString: function () {
                    var template = '';
                    template = this.template.routePlan;
                    if (this.options.routePreference) {
                        var tmplPreference = this.template.routePreference;
                        tmplPreference = tmplPreference.replace(/__VALUEROUTEPREFERENCE__/, this.options.routePreference);
                        template = template.replace(/__ROUTEPREFERENCE__/g, tmplPreference);
                    }
                    template = template.replace(/__ROUTEPREFERENCE__/g, '');
                    if (this.options.avoidFeature) {
                        var tmplAvoidList = this.template.avoidList.container;
                        var avoidFeatures = [];
                        for (var i = 0; i < this.options.avoidFeature.length; i++) {
                            var tmplAvoidFeature = this.template.avoidList.avoidFeature;
                            tmplAvoidFeature = tmplAvoidFeature.replace(/__VALUEAVOIDFEATURE__/, this.options.avoidFeature[i]);
                            avoidFeatures.push(tmplAvoidFeature);
                        }
                        tmplAvoidList = tmplAvoidList.replace(/__AVOIDFEATURE__/, avoidFeatures.join('\n'));
                        template = template.replace(/__AVOIDLIST__/g, tmplAvoidList);
                    }
                    template = template.replace(/__AVOIDLIST__/g, '');
                    if (this.options.graph) {
                        var tmplVehicle = this.template.graph;
                        tmplVehicle = tmplVehicle.replace(/__VALUEGRAPH__/, this.options.graph);
                        template = template.replace(/__GRAPH__/g, tmplVehicle);
                    }
                    template = template.replace(/__GRAPH__/g, '');
                    var tmplWayPointList = this.template.wayPointList.container;
                    var tmplPoint = '';
                    tmplPoint = this.template.wayPointList.point;
                    tmplPoint = tmplPoint.replace(/__X__/, this.options.startPoint.x);
                    tmplPoint = tmplPoint.replace(/__Y__/, this.options.startPoint.y);
                    tmplWayPointList = tmplWayPointList.replace(/__STARTPOINT__/, this.template.wayPointList.startPoint.replace(/__POINT__/, tmplPoint));
                    tmplPoint = this.template.wayPointList.point;
                    tmplPoint = tmplPoint.replace(/__X__/, this.options.endPoint.x);
                    tmplPoint = tmplPoint.replace(/__Y__/, this.options.endPoint.y);
                    tmplWayPointList = tmplWayPointList.replace(/__ENDPOINT__/, this.template.wayPointList.endPoint.replace(/__POINT__/, tmplPoint));
                    if (this.options.viaPoint) {
                        var points = [];
                        for (var j = 0; j < this.options.viaPoint.length; j++) {
                            var p = this.options.viaPoint[j];
                            tmplPoint = this.template.wayPointList.point;
                            tmplPoint = tmplPoint.replace(/__X__/, p.x);
                            tmplPoint = tmplPoint.replace(/__Y__/, p.y);
                            points.push(tmplPoint);
                        }
                        tmplWayPointList = tmplWayPointList.replace(/__VIAPOINT__/, this.template.wayPointList.viaPoint.replace(/__POINT__/, points.join('\n')));
                    } else {
                        tmplWayPointList = tmplWayPointList.replace(/__VIAPOINT__/, '');
                    }
                    template = template.replace(/__WAYPOINTLIST__/g, tmplWayPointList);
                    this.requestString = template;
                    return this.requestString;
                }
            };
            return RoutePlan;
        }(UtilsLoggerByDefault);
        FormatsXLSRouteServiceDetermineRouteRequest = function (Logger, RoutePlan) {
            function DetermineRouteRequest(options) {
                if (!(this instanceof DetermineRouteRequest)) {
                    throw new TypeError('DetermineRouteRequest constructor cannot be called as a function.');
                }
                this.options = options || {};
                for (var opt in options) {
                    if (options.hasOwnProperty(opt)) {
                        this.options[opt] = options[opt];
                    }
                }
                this.CLASSNAME = 'DetermineRouteRequest';
            }
            DetermineRouteRequest.prototype = {
                strRequest: null,
                oRoutePlan: null,
                template: {
                    determineRouteRequest: '<DetermineRouteRequest distanceUnit="__DISTANCEUNIT__">' + '__ROUTEPLAN__' + '__ROUTEINSTRUCTIONREQUEST__' + '__ROUTEGEOMETRYREQUEST__' + '__ROUTEMAPREQUEST__' + '</DetermineRouteRequest>',
                    routeInstructionRequest: '<RouteInstructionsRequest ' + 'provideGeometry="__PROVIDEGEOMETRY__" ' + 'provideBoundingBox="__PROVIDEBBOX__" />',
                    routeGeometryRequest: '<RouteGeometryRequest />',
                    routeMapRequest: ''
                },
                addRoute: function (oRoutePlan) {
                    if (oRoutePlan instanceof RoutePlan) {
                        this.oRoutePlan = oRoutePlan;
                    }
                },
                constructor: DetermineRouteRequest,
                toString: function () {
                    var template = '';
                    template = this.template.determineRouteRequest;
                    template = template.replace(/__DISTANCEUNIT__/g, this.options.distanceUnit || 'KM');
                    if (!this.oRoutePlan) {
                        var settings = this.options.route;
                        this.oRoutePlan = new RoutePlan(settings);
                        if (!this.oRoutePlan) {
                            throw new Error('La construction du calcul d\'initineraire n\'est pas correctement definie !?');
                        }
                    }
                    template = template.replace(/__ROUTEPLAN__/g, this.oRoutePlan.toString());
                    var tmplInstruction = this.template.routeInstructionRequest;
                    tmplInstruction = tmplInstruction.replace(/__PROVIDEGEOMETRY__/g, this.options.provideGeometry || false);
                    tmplInstruction = tmplInstruction.replace(/__PROVIDEBBOX__/g, this.options.provideBoundingBox || false);
                    template = template.replace(/__ROUTEINSTRUCTIONREQUEST__/g, tmplInstruction);
                    var tmplGeometry = this.template.routeGeometryRequest;
                    template = template.replace(/__ROUTEGEOMETRYREQUEST__/g, tmplGeometry);
                    var tmplMap = this.template.routeMapRequest;
                    template = template.replace(/__ROUTEMAPREQUEST__/g, tmplMap);
                    this.strRequest = template;
                    return this.strRequest;
                }
            };
            return DetermineRouteRequest;
        }(UtilsLoggerByDefault, FormatsXLSRouteServiceModelRoutePlan);
        FormatsXLSRouteServiceRouteRequestExtension = undefined;
        FormatsXLSRouteService = function (Logger, AbstractService, DetermineRouteRequest, RouteRequestExtension) {
            function RouteService(options) {
                if (!(this instanceof RouteService)) {
                    throw new TypeError('RouteService constructor cannot be called as a function.');
                }
                this.CLASSNAME = 'RouteService';
                this.CLASSTYPE = 'RouteRequest';
                AbstractService.apply(this, arguments);
            }
            RouteService.prototype = Object.create(AbstractService.prototype, {});
            RouteService.prototype.constructor = RouteService;
            RouteService.prototype.addRequest = function (oRequest) {
                if (oRequest.CLASSNAME === 'DetermineRouteRequest') {
                    this.oRequest = oRequest;
                } else {
                    throw new Error('Ce n\'est pas un objet de type \'Route Request\' !?');
                }
            };
            RouteService.prototype.addFilter = function (oFilter) {
                if (oFilter instanceof RouteRequestExtension) {
                    this.oFilter = oFilter;
                }
            };
            RouteService.prototype.toString = function () {
                if (!this.oRequest) {
                    if (!this.options) {
                        throw new Error('Les options ne sont pas renseignées, impossible de construire la requête !');
                    }
                    if (this.CLASSTYPE === 'RouteRequest') {
                        var settings = {
                            distanceUnit: this.options.distanceUnit || null,
                            provideGeometry: this.options.provideGeometry || null,
                            provideBoundingBox: this.options.provideBoundingBox || null,
                            route: {
                                routePreference: this.options.routePreference || null,
                                startPoint: this.options.startPoint,
                                viaPoint: this.options.viaPoint || null,
                                endPoint: this.options.endPoint,
                                avoidFeature: this.options.avoidFeature || null,
                                graph: this.options.graph || null,
                                expectedStartTime: this.options.expectedStartTime || null
                            }
                        };
                        this.oRequest = new DetermineRouteRequest(settings);
                        if (this.oFilter) {
                            this.oRequest.addFilter(this.oFilter);
                        }
                    }
                }
                if (!this.oRequest) {
                    throw new Error('Type de requête indefini !');
                }
                this.strRequest = this.oRequest.toString();
                return this.strRequest;
            };
            return RouteService;
        }(UtilsLoggerByDefault, FormatsXLSAbstractService, FormatsXLSRouteServiceDetermineRouteRequest, FormatsXLSRouteServiceRouteRequestExtension);
        ServicesRouteRequestRouteRequestOLS = function (Logger, XLS, RouteService) {
            var RouteRequestOLS = {
                build: function (options) {
                    var request = null;
                    var settings = {
                        startPoint: options.startPoint,
                        endPoint: options.endPoint,
                        viaPoint: options.viaPoints,
                        provideBoundingBox: options.provideBbox,
                        avoidFeature: options.exclusions,
                        expectedStartTime: options.expectedStartTime,
                        distanceUnit: options.distanceUnit,
                        graph: options.graph,
                        provideGeometry: options.geometryInInstructions,
                        routePreference: options.routePreference
                    };
                    var oRS = new RouteService(settings);
                    var oXLS = new XLS({
                        srsName: options.srs,
                        maximumResponses: options.maximumResponses
                    });
                    oXLS.namespace = true;
                    oXLS.setService(oRS);
                    request = oXLS.build();
                    if (options.httpMethod == 'GET') {
                        var myRequest = 'qxml=' + encodeURIComponent(request).replace(/\-/g, '%2D').replace(/\_/g, '%5F').replace(/\./g, '%2E').replace(/\!/g, '%21').replace(/\~/g, '%7E').replace(/\*/g, '%2A').replace(/\'/g, '%27').replace(/\(/g, '%28').replace(/\)/g, '%29');
                        request = myRequest;
                    }
                    return request;
                }
            };
            return RouteRequestOLS;
        }(UtilsLoggerByDefault, FormatsXLS, FormatsXLSRouteService);
        ServicesRouteRequestModelRouteParamREST = function (Logger) {
            function RouteParamREST(options) {
                if (!(this instanceof RouteParamREST)) {
                    throw new TypeError('RouteParamREST constructor cannot be called as a function.');
                }
                this.options = options || {};
                this.origin = this.options.startPoint.x + ',' + this.options.startPoint.y;
                this.destination = this.options.endPoint.x + ',' + this.options.endPoint.y;
                this.waypoints = this.options.viaPoints || null;
                this.startDateTime = this.options.expectedStartTime || null;
                this.graphName = this.options.graph;
                this.srs = this.options.srs;
                this.exclusions = this.options.exclusions;
                this.method = 'TIME';
                if (this.options.routePreference) {
                    var value = this.options.routePreference;
                    switch (value) {
                    case 'fastest':
                        this.method = 'TIME';
                        break;
                    case 'shortest':
                        this.method = 'DISTANCE';
                        break;
                    default:
                        this.method = 'TIME';
                    }
                }
                this.format = this.options.geometryInInstructions ? 'STANDARDEXT' : 'STANDARD';
                this.tolerance = 10;
                this.profileId = null;
                this.profileName = null;
            }
            RouteParamREST.CLASSNAME = 'RouteParamREST';
            RouteParamREST.prototype = {
                constructor: RouteParamREST,
                getWaypoints: function () {
                    if (!this.waypoints) {
                        return;
                    }
                    var array = [];
                    for (var i = 0; i < this.waypoints.length; i++) {
                        var obj = this.waypoints[i];
                        array.push(obj.x + ',' + obj.y);
                    }
                    return array.join(';');
                },
                getExclusions: function () {
                    return this.exclusions.join(';');
                }
            };
            RouteParamREST.prototype.getParams = function () {
                var map = [];
                map.push({
                    k: 'origin',
                    v: this.origin
                });
                map.push({
                    k: 'destination',
                    v: this.destination
                });
                map.push({
                    k: 'method',
                    v: this.method
                });
                if (this.waypoints) {
                    map.push({
                        k: 'waypoints',
                        v: this.getWaypoints()
                    });
                }
                if (this.startDateTime) {
                    map.push({
                        k: 'startDateTime',
                        v: this.startDateTime
                    });
                }
                if (this.graphName) {
                    map.push({
                        k: 'graphName',
                        v: this.graphName
                    });
                }
                if (this.exclusions) {
                    map.push({
                        k: 'exclusions',
                        v: this.getExclusions()
                    });
                }
                if (this.srs) {
                    map.push({
                        k: 'srs',
                        v: this.srs
                    });
                }
                if (this.format) {
                    map.push({
                        k: 'format',
                        v: this.format
                    });
                }
                return map;
            };
            return RouteParamREST;
        }(UtilsLoggerByDefault);
        ServicesRouteRequestRouteRequestREST = function (Logger, _, RouteParamREST) {
            function RouteRequestREST(options) {
                if (!(this instanceof RouteRequestREST)) {
                    throw new TypeError('RouteRequestREST constructor cannot be called as a function.');
                }
                if (!options) {
                    throw new Error(_.getMessage('PARAM_EMPTY', 'options'));
                }
                this.settings = options;
            }
            RouteRequestREST.prototype = {
                requestString: null,
                constructor: RouteRequestREST,
                processRequestString: function () {
                    var oParams = new RouteParamREST(this.settings);
                    var params = oParams.getParams();
                    var request = '';
                    for (var i = 0; i < params.length; i++) {
                        var o = params[i];
                        if (request) {
                            request += '&';
                        }
                        request += o.k + '=' + o.v;
                    }
                    this.requestString = request;
                    return this.requestString;
                }
            };
            return RouteRequestREST;
        }(UtilsLoggerByDefault, UtilsMessagesResources, ServicesRouteRequestModelRouteParamREST);
        ServicesRouteRequestRouteRequestFactory = function (Logger, ErrorService, RouteRequestOLS, RouteRequestREST) {
            var RouteRequestFactory = {
                build: function (options) {
                    var request = null;
                    var settings = options || {};
                    var bOnError = options.onError !== null && typeof options.onError === 'function' ? true : false;
                    var message = null;
                    switch (options.api) {
                    case 'REST':
                        var myReq = new RouteRequestREST(settings);
                        if (!myReq.processRequestString()) {
                            message = 'Error process request (rest) !';
                            if (bOnError) {
                                options.onError.call(options.scope, new ErrorService(message));
                                return;
                            }
                            throw new Error(message);
                        }
                        request = myReq.requestString;
                        break;
                    case 'OLS':
                        request = RouteRequestOLS.build(settings);
                        if (!request) {
                            message = 'Error process request (ols) !';
                            if (bOnError) {
                                options.onError.call(options.scope, new ErrorService(message));
                                return;
                            }
                            throw new Error(message);
                        }
                        break;
                    default:
                        message = 'Type of API is not supported by service (REST or OLS) !';
                        if (bOnError) {
                            options.onError.call(options.scope, new ErrorService(message));
                            return;
                        }
                        throw new Error(message);
                    }
                    return request;
                }
            };
            return RouteRequestFactory;
        }(UtilsLoggerByDefault, ExceptionsErrorService, ServicesRouteRequestRouteRequestOLS, ServicesRouteRequestRouteRequestREST);
        FormatsWKT = function (Logger) {
            var WKT = {
                toJson: function (strWkt, success, error) {
                    var json = null;
                    try {
                        if (!strWkt) {
                            throw new Error('La chaine WKT n\'est pas renseignée !');
                        }
                        if (!success) {
                            success = function (json) {
                                console.log(json);
                            };
                        }
                        if (!error) {
                            error = function (e) {
                                console.log(e);
                            };
                        }
                        var regex;
                        var subst;
                        var result;
                        regex = /(-?\d+\.?[0-9]*)\s(-?\d+\.?[0-9]+)/g;
                        subst = '[$1,$2]';
                        strWkt = strWkt.replace(regex, subst);
                        regex = /^(\w+)/;
                        result = regex.exec(strWkt);
                        if (RegExp.$1 === 'POLYGON') {
                            subst = '{"type" : "Polygon",';
                            strWkt = strWkt.replace(RegExp.$1, subst);
                            regex = /(\({2}?)/;
                            subst = '"coordinates" : [[';
                            strWkt = strWkt.replace(regex, subst);
                            regex = /(\){2}?)/;
                            subst = ']]}';
                            strWkt = strWkt.replace(regex, subst);
                            regex = /(\()/g;
                            subst = '[';
                            strWkt = strWkt.replace(regex, subst);
                            regex = /(\))/g;
                            subst = ']';
                            strWkt = strWkt.replace(regex, subst);
                        } else if (RegExp.$1 === 'LINESTRING') {
                            subst = '{"type" : "LineString",';
                            strWkt = strWkt.replace(RegExp.$1, subst);
                            regex = /(\(\(?)/;
                            subst = '"coordinates" : [';
                            strWkt = strWkt.replace(regex, subst);
                            regex = /(\)\)?)/;
                            subst = ']}';
                            strWkt = strWkt.replace(regex, subst);
                        }
                        json = JSON.parse(strWkt);
                        if (!json) {
                            throw new Error('Le JSON est vide !');
                        }
                        if (!json.type) {
                            throw new Error('Le type de geometrie n\'est pas connu !');
                        }
                        if (!json.coordinates) {
                            throw new Error('La liste des points est vide !');
                        }
                        success.call(this, json);
                    } catch (e) {
                        if (e.name === 'SyntaxError') {
                            error.call(this, 'Erreur de parsing JSON !');
                            return;
                        }
                        error.call(this, e);
                    }
                }
            };
            return WKT;
        }(UtilsLoggerByDefault);
        ServicesRouteResponseModelRouteResponse = function () {
            function RouteResponse() {
                if (!(this instanceof RouteResponse)) {
                    throw new TypeError('RouteResponse constructor cannot be called as a function.');
                }
                this.totalTime = null;
                this.totalDistance = null;
                this.bbox = {
                    left: null,
                    right: null,
                    top: null,
                    bottom: null
                };
                this.routeGeometry = null;
                this.routeInstructions = [];
            }
            RouteResponse.prototype = { constructor: RouteResponse };
            return RouteResponse;
        }();
        ServicesRouteResponseModelRouteInstruction = function () {
            function RouteInstruction() {
                if (!(this instanceof RouteInstruction)) {
                    throw new TypeError('RouteInstruction constructor cannot be called as a function.');
                }
                this.duration = null;
                this.distance = null;
                this.code = null;
                this.instruction = null;
                this.geometry = null;
            }
            RouteInstruction.prototype = { constructor: RouteInstruction };
            return RouteInstruction;
        }();
        ServicesRouteFormatsRouteResponseRESTReader = function (Logger, WKT, MessagesResources, ErrSrv, RouteResponse, RouteInstruction) {
            var RouteResponseRESTReader = {};
            RouteResponseRESTReader.READERS = {
                routeResult: function (node) {
                    var response = new RouteResponse();
                    __getChildNodes(node, response);
                    if (response.status === 'error') {
                        var message = MessagesResources.getMessage('SERVICE_RESPONSE_EXCEPTION', response.message);
                        throw new ErrSrv({
                            message: message,
                            type: ErrSrv.TYPE_SRVERR
                        });
                    }
                    return response;
                },
                status: function (node, response) {
                    var status = __getChildValue(node);
                    if (status === 'ERROR' || status === 'error') {
                        if (response) {
                            response.status = 'error';
                        }
                    }
                },
                message: function (node, response) {
                    if (response) {
                        response.message = __getChildValue(node);
                    }
                },
                distance: function (node, response) {
                    if (response) {
                        response.totalDistance = __getChildValue(node);
                    }
                },
                durationSeconds: function (node, response) {
                    if (response) {
                        response.totalTime = parseFloat(__getChildValue(node));
                    }
                },
                bounds: function (node, response) {
                    if (response && response.bbox) {
                        var coords = __getChildValue(node).split(/[,;]/);
                        response.bbox.left = parseFloat(coords[0]);
                        response.bbox.bottom = parseFloat(coords[1]);
                        response.bbox.right = parseFloat(coords[2]);
                        response.bbox.top = parseFloat(coords[3]);
                    }
                },
                geometryWkt: function (node, response) {
                    if (response) {
                        var geomWkt = node.innerHTML;
                        var onWKTSuccess = function (json) {
                            response.routeGeometry = json;
                        };
                        var onWKTError = function () {
                            var msg = MessagesResources.getMessage('PARAM_FORMAT', ['geometryWkt']);
                            throw new Error(msg);
                        };
                        WKT.toJson(geomWkt, onWKTSuccess, onWKTError);
                    }
                },
                step: function (node, response) {
                    var routeInstruction = new RouteInstruction();
                    var name;
                    if (node.hasChildNodes) {
                        var children = node.childNodes;
                        var child;
                        var childName;
                        for (var i = 0; i < children.length; i++) {
                            child = children[i];
                            if (child.nodeType === 1) {
                                childName = child.localName || child.baseName || child.nodeName;
                                if (childName === 'durationSeconds') {
                                    routeInstruction.duration = __getChildValue(child);
                                } else if (childName === 'distance') {
                                    routeInstruction.distance = __getChildValue(child);
                                } else if (childName === 'navInstruction') {
                                    routeInstruction.code = __getChildValue(child);
                                } else if (childName === 'name') {
                                    name = __getChildValue(child);
                                }
                            }
                        }
                    }
                    if (routeInstruction.code) {
                        switch (routeInstruction.code) {
                        case 'F':
                            if (name != 'Valeur non renseignée') {
                                routeInstruction.instruction = 'Tout droit ' + name;
                            } else {
                                routeInstruction.instruction = 'Continuer tout droit ';
                            }
                            break;
                        case 'B':
                            routeInstruction.instruction = 'Demi-tour ' + name;
                            break;
                        case 'L':
                            routeInstruction.instruction = 'Tourner à gauche ' + name;
                            break;
                        case 'R':
                            routeInstruction.instruction = 'Tourner à droite ' + name;
                            break;
                        case 'BL':
                            routeInstruction.instruction = 'Tourner très à gauche ' + name;
                            break;
                        case 'BR':
                            routeInstruction.instruction = 'Tourner très à droite ' + name;
                            break;
                        case 'FL':
                            routeInstruction.instruction = 'Tourner légèrement à gauche ' + name;
                            break;
                        case 'FR':
                            routeInstruction.instruction = 'Tourner légèrement à droite ' + name;
                            break;
                        case 'round_about_entry':
                            routeInstruction.instruction = 'Entrée rond-point ' + name;
                            break;
                        case 'round_about_exit':
                            routeInstruction.instruction = 'Sortie rond-point ' + name;
                            break;
                        case null:
                            routeInstruction.instruction = 'Prendre ' + name;
                            break;
                        default:
                            routeInstruction.instruction = '?' + routeInstruction.code + '? ' + name;
                            break;
                        }
                    }
                    if (Array.isArray(response.routeInstructions)) {
                        response.routeInstructions.push(routeInstruction);
                    }
                }
            };
            RouteResponseRESTReader.read = function (root) {
                var response;
                if (root.nodeName === 'routeResult') {
                    response = RouteResponseRESTReader.READERS['routeResult'](root);
                    return response;
                } else {
                    throw new Error('Erreur lors de la lecture de la réponse : elle n\'est pas au format attendu.');
                }
            };
            function __getChildValue(node) {
                var textNode;
                var value = '';
                if (node.hasChildNodes()) {
                    textNode = node.firstChild;
                    if (textNode && textNode.nodeType === 3) {
                        value = textNode.nodeValue;
                    }
                }
                return value;
            }
            function __getChildNodes(node, data) {
                if (node.hasChildNodes()) {
                    var children = node.childNodes;
                    var child;
                    var childName;
                    for (var i = 0; i < children.length; i++) {
                        child = children[i];
                        if (child.nodeType === 1) {
                            childName = child.localName || child.baseName || child.nodeName;
                            if (RouteResponseRESTReader.READERS[childName]) {
                                var reader = RouteResponseRESTReader.READERS[childName];
                                reader(child, data);
                            } else {
                                __getChildNodes(child, data);
                            }
                        }
                    }
                }
            }
            return RouteResponseRESTReader;
        }(UtilsLoggerByDefault, FormatsWKT, UtilsMessagesResources, ExceptionsErrorService, ServicesRouteResponseModelRouteResponse, ServicesRouteResponseModelRouteInstruction);
        ServicesRouteFormatsRouteResponseOLSReader = function (Logger) {
            var RouteResponseOLSReader = {};
            RouteResponseOLSReader.READERS = {};
            RouteResponseOLSReader.read = function (root) {
            };
            return RouteResponseOLSReader;
        }(UtilsLoggerByDefault);
        ServicesRouteResponseRouteResponseFactory = function (Logger, ErrorService, XML, WKT, MRes, RouteResponseRESTReader, RouteResponseOLSReader, RouteResponse, RouteInstruction) {
            var RouteResponseFactory = {
                build: function (options) {
                    var data = null;
                    if (options.response) {
                        if (options.rawResponse) {
                            data = options.response;
                        } else {
                            switch (options.outputFormat) {
                            case 'xml':
                                var routeReader = options.api === 'REST' ? RouteResponseRESTReader : RouteResponseOLSReader;
                                try {
                                    var p = new XML({ reader: routeReader });
                                    if (typeof options.response === 'string') {
                                        p.setXMLString(options.response);
                                    } else {
                                        p.setXMLDoc(options.response);
                                    }
                                    data = p.parse();
                                    if (!data) {
                                        throw new ErrorService(MRes.getMessage('SERVICE_RESPONSE_FORMAT', 'xml'));
                                    }
                                } catch (e) {
                                    options.onError.call(options.scope, new ErrorService(MRes.getMessage('SERVICE_RESPONSE_ANALYSE', options.response)));
                                    return;
                                }
                                break;
                            case 'json':
                                var JSONResponse;
                                if (typeof options.response === 'string') {
                                    JSONResponse = window.JSON.parse(options.response);
                                } else {
                                    JSONResponse = options.response;
                                }
                                if (JSONResponse.message) {
                                    options.onError.call(options.scope, new ErrorService(MRes.getMessage('SERVICE_RESPONSE_EXCEPTION', JSONResponse.message)));
                                    return;
                                }
                                if (JSONResponse) {
                                    var legs = [];
                                    var legSteps = [];
                                    var steps = [];
                                    data = new RouteResponse();
                                    if (data.hasOwnProperty('totalTime')) {
                                        data.totalTime = parseFloat(JSONResponse.durationSeconds);
                                    }
                                    if (data.hasOwnProperty('totalDistance')) {
                                        data.totalDistance = options.distanceUnit === 'm' ? JSONResponse.distanceMeters : JSONResponse.distance;
                                    }
                                    if (data.hasOwnProperty('bbox')) {
                                        var coords = JSONResponse.bounds.split(/[,;]/);
                                        data.bbox.left = parseFloat(coords[0]);
                                        data.bbox.bottom = parseFloat(coords[1]);
                                        data.bbox.right = parseFloat(coords[2]);
                                        data.bbox.top = parseFloat(coords[3]);
                                    }
                                    var onWKTSuccess = function (json) {
                                        data.routeGeometry = json;
                                    };
                                    var onWKTError = function (e) {
                                        console.log(e);
                                        options.onError.call(options.scope, new ErrorService(MRes.getMessage('PARAM_FORMAT', ['geometryWkt'])));
                                    };
                                    if (data.hasOwnProperty('routeGeometry')) {
                                        var geometry = JSONResponse.geometryWkt || JSONResponse.simplifiedWkt;
                                        if (geometry) {
                                            WKT.toJson(geometry, onWKTSuccess, onWKTError);
                                            if (!data.routeGeometry) {
                                                return;
                                            }
                                        }
                                    }
                                    if (data.hasOwnProperty('routeInstructions')) {
                                        var legList = JSONResponse.legs;
                                        var i;
                                        if (Array.isArray(legList) && legList.length) {
                                            for (i = 0; i < legList.length; i++) {
                                                legs.push(legList[i]);
                                            }
                                        }
                                        if (Array.isArray(legs) && legs.length) {
                                            for (i = 0; i < legs.length; i++) {
                                                legSteps.push(legs[i].steps);
                                            }
                                        }
                                        if (Array.isArray(legSteps) && legSteps.length) {
                                            for (i = 0; i < legSteps.length; i++) {
                                                steps = steps.concat(legSteps[i]);
                                            }
                                        }
                                        steps.forEach(function (step) {
                                            data.routeInstructions.push(new RouteInstruction());
                                            data.routeInstructions[data.routeInstructions.length - 1].duration = step.durationSeconds;
                                            data.routeInstructions[data.routeInstructions.length - 1].distance = options.distanceUnit === 'm' ? step.distanceMeters : step.distance;
                                            data.routeInstructions[data.routeInstructions.length - 1].code = step.navInstruction;
                                            var points = [];
                                            for (var i = 0; i < step.points.length; i++) {
                                                var point = step.points[i].split(',');
                                                if (point) {
                                                    points.push(point);
                                                }
                                            }
                                            if (points && points.length !== 0) {
                                                data.routeInstructions[data.routeInstructions.length - 1].geometry = {
                                                    coordinates: points,
                                                    type: 'LineString'
                                                };
                                            } else {
                                                data.routeInstructions[data.routeInstructions.length - 1].geometry = null;
                                            }
                                            if (step.name == 'Valeur non renseignée') {
                                                step.name = '';
                                            }
                                            switch (step.navInstruction) {
                                            case 'F':
                                                if (step.name) {
                                                    data.routeInstructions[data.routeInstructions.length - 1].instruction = 'Tout droit ' + step.name;
                                                } else {
                                                    data.routeInstructions[data.routeInstructions.length - 1].instruction = 'Continuer tout droit ';
                                                }
                                                break;
                                            case 'B':
                                                data.routeInstructions[data.routeInstructions.length - 1].instruction = 'Demi-tour ' + step.name;
                                                break;
                                            case 'L':
                                                data.routeInstructions[data.routeInstructions.length - 1].instruction = 'Tourner à gauche ' + step.name;
                                                break;
                                            case 'R':
                                                data.routeInstructions[data.routeInstructions.length - 1].instruction = 'Tourner à droite ' + step.name;
                                                break;
                                            case 'BL':
                                                data.routeInstructions[data.routeInstructions.length - 1].instruction = 'Tourner très à gauche ' + step.name;
                                                break;
                                            case 'BR':
                                                data.routeInstructions[data.routeInstructions.length - 1].instruction = 'Tourner très à droite ' + step.name;
                                                break;
                                            case 'FL':
                                                data.routeInstructions[data.routeInstructions.length - 1].instruction = 'Tourner légèrement à gauche ' + step.name;
                                                break;
                                            case 'FR':
                                                data.routeInstructions[data.routeInstructions.length - 1].instruction = 'Tourner légèrement à droite ' + step.name;
                                                break;
                                            case 'round_about_entry':
                                                data.routeInstructions[data.routeInstructions.length - 1].instruction = 'Entrée rond-point ' + step.name;
                                                break;
                                            case 'round_about_exit':
                                                data.routeInstructions[data.routeInstructions.length - 1].instruction = 'Sortie rond-point ' + step.name;
                                                break;
                                            case null:
                                                data.routeInstructions[data.routeInstructions.length - 1].instruction = 'Prendre tout droit ' + step.name;
                                                break;
                                            default:
                                                data.routeInstructions[data.routeInstructions.length - 1].instruction = '?' + step.navInstruction + '? ' + step.name;
                                                break;
                                            }
                                        });
                                    }
                                }
                                if (!data) {
                                    options.onError.call(options.scope, new ErrorService(MRes.getMessage('SERVICE_RESPONSE_ANALYSE', 'json')));
                                    return;
                                }
                                break;
                            default:
                                options.onError.call(options.scope, new ErrorService(MRes.getMessage('SERVICE_RESPONSE_FORMAT', 'json', 'xml')));
                                return;
                            }
                            if (data && data.exceptionReport) {
                                options.onError.call(options.scope, new ErrorService(MRes.getMessage('SERVICE_RESPONSE_EXCEPTION_2')));
                                return;
                            }
                        }
                    } else {
                        options.onError.call(options.scope, new ErrorService(MRes.getMessage('SERVICE_RESPONSE_EMPTY')));
                        return;
                    }
                    options.onSuccess.call(options.scope, data);
                    return;
                }
            };
            return RouteResponseFactory;
        }(UtilsLoggerByDefault, ExceptionsErrorService, FormatsXML, FormatsWKT, UtilsMessagesResources, ServicesRouteFormatsRouteResponseRESTReader, ServicesRouteFormatsRouteResponseOLSReader, ServicesRouteResponseModelRouteResponse, ServicesRouteResponseModelRouteInstruction);
        ServicesRouteRoute = function (Logger, _, ErrorService, CommonService, DefaultUrlService, RouteRequestFactory, RouteResponseFactory) {
            function Route(options) {
                if (!(this instanceof Route)) {
                    throw new TypeError(_.getMessage('CLASS_CONSTRUCTOR', 'Route'));
                }
                this.CLASSNAME = 'Route';
                CommonService.apply(this, arguments);
                if (!options.startPoint) {
                    throw new Error(_.getMessage('PARAM_MISSING', 'startPoint'));
                }
                if (options.startPoint.x == null) {
                    throw new Error(_.getMessage('PARAM_MISSING', 'startPoint.x'));
                }
                if (options.startPoint.y == null) {
                    throw new Error(_.getMessage('PARAM_MISSING', 'startPoint.y'));
                }
                if (!options.endPoint) {
                    throw new Error(_.getMessage('PARAM_MISSING', 'endPoint'));
                }
                if (options.endPoint.x == null) {
                    throw new Error(_.getMessage('PARAM_MISSING', 'endPoint.x'));
                }
                if (options.endPoint.y == null) {
                    throw new Error(_.getMessage('PARAM_MISSING', 'endPoint.y'));
                }
                this.options.api = typeof options.api == 'string' ? options.api.toUpperCase() : 'REST';
                this.options.outputFormat = typeof options.outputFormat == 'string' ? options.outputFormat.toLowerCase() : 'json';
                this.options.startPoint = options.startPoint;
                this.options.endPoint = options.endPoint;
                this.options.viaPoints = options.viaPoints || null;
                this.options.exclusions = options.exclusions || null;
                this.options.routePreference = options.routePreference || 'fastest';
                this.options.graph = options.graph || 'Voiture';
                this.options.geometryInInstructions = options.geometryInInstructions || false;
                this.options.provideBbox = options.provideBbox || true;
                this.options.distanceUnit = options.distanceUnit || 'km';
                this.options.expectedStartTime = null;
                this.options.srs = options.srs || 'EPSG:4326';
                this.options.api = 'REST';
                if (this.options.protocol === 'XHR') {
                    this.options.httpMethod = 'GET';
                }
                if (!this.options.serverUrl) {
                    var lstUrlByDefault = DefaultUrlService.Route.url(this.options.apiKey);
                    var urlFound = null;
                    switch (this.options.api) {
                    case 'OLS':
                        urlFound = lstUrlByDefault.ols;
                        break;
                    case 'REST':
                        var key = 'route' + '-' + this.options.outputFormat;
                        urlFound = lstUrlByDefault[key];
                        break;
                    default:
                        throw new Error(_.getMessage('PARAM_UNKNOWN', 'api'));
                    }
                    if (!urlFound) {
                        throw new Error('Url by default not found !');
                    }
                    this.options.serverUrl = urlFound;
                }
                var idx = this.options.serverUrl.lastIndexOf('.');
                if (idx !== -1) {
                    var extension = this.options.serverUrl.substring(idx + 1);
                    if (extension && extension.length < 5) {
                        switch (extension.toLowerCase()) {
                        case 'json':
                        case 'xml':
                            this.options.outputFormat = extension.toLowerCase();
                            break;
                        default:
                            throw new Error('type of service : unknown or unsupported (json or xml) !');
                        }
                    }
                }
            }
            Route.prototype = Object.create(CommonService.prototype, {});
            Route.prototype.constructor = Route;
            Route.prototype.buildRequest = function (error, success) {
                var options = {
                    api: this.options.api,
                    startPoint: this.options.startPoint,
                    endPoint: this.options.endPoint,
                    viaPoints: this.options.viaPoints,
                    provideBbox: this.options.provideBbox,
                    exclusions: this.options.exclusions,
                    distanceUnit: this.options.distanceUnit,
                    graph: this.options.graph,
                    geometryInInstructions: this.options.geometryInInstructions,
                    routePreference: this.options.routePreference,
                    srs: this.options.srs
                };
                this.request = RouteRequestFactory.build(options);
                if (!this.request) {
                    error.call(this, new ErrorService(_.getMessage('SERVICE_REQUEST_BUILD')));
                } else {
                    success.call(this, this.request);
                }
            };
            Route.prototype.analyzeResponse = function (error, success) {
                if (this.response) {
                    var options = {
                        distanceUnit: this.options.distanceUnit,
                        response: this.response,
                        outputFormat: this.options.outputFormat,
                        api: this.options.api,
                        rawResponse: this.options.rawResponse,
                        onError: error,
                        onSuccess: success,
                        scope: this
                    };
                    RouteResponseFactory.build(options);
                } else {
                    error.call(this, new ErrorService(_.getMessage('SERVICE_RESPONSE_EMPTY')));
                }
            };
            return Route;
        }(UtilsLoggerByDefault, UtilsMessagesResources, ExceptionsErrorService, ServicesCommonService, ServicesDefaultUrlService, ServicesRouteRequestRouteRequestFactory, ServicesRouteResponseRouteResponseFactory);
        ServicesProcessIsoCurveRequestModelProcessIsoCurveParam = function (Logger) {
            function ProcessIsoCurveParam(options) {
                if (!(this instanceof ProcessIsoCurveParam)) {
                    throw new TypeError('ProcessIsoCurveParam constructor cannot be called as a function.');
                }
                this.options = options || {};
                this.id = this.options.id;
                this.location = this.options.position;
                this.srs = this.options.srs;
                this.graphName = this.options.graph;
                this.profileId = this.options.profileId || null;
                this.profileName = this.options.profileName || null;
                this.exclusions = this.options.exclusions;
                this.reverse = this.options.reverse;
                this.smoothing = this.options.smoothing;
                this.holes = this.options.holes;
                var value = this.options.method;
                switch (value) {
                case 'time':
                    this.method = 'time';
                    this.time = this.options.time;
                    break;
                case 'distance':
                    this.method = 'distance';
                    this.distance = this.options.distance;
                    break;
                default:
                    this.method = 'time';
                }
            }
            ProcessIsoCurveParam.CLASSNAME = 'ProcessIsoCurveParam';
            ProcessIsoCurveParam.prototype = {
                constructor: ProcessIsoCurveParam,
                getLocation: function () {
                    return this.location.x + ',' + this.location.y;
                },
                getExclusions: function () {
                    return this.exclusions.join(';');
                }
            };
            ProcessIsoCurveParam.prototype.getParams = function () {
                var map = [];
                map.push({
                    k: 'location',
                    v: this.getLocation()
                });
                map.push({
                    k: 'smoothing',
                    v: this.smoothing
                });
                map.push({
                    k: 'holes',
                    v: this.holes
                });
                map.push({
                    k: 'reverse',
                    v: this.reverse
                });
                map.push({
                    k: 'method',
                    v: this.method
                });
                if (this.time) {
                    map.push({
                        k: 'time',
                        v: this.time
                    });
                }
                if (this.distance) {
                    map.push({
                        k: 'distance',
                        v: this.distance
                    });
                }
                map.push({
                    k: 'graphName',
                    v: this.graphName
                });
                if (this.exclusions) {
                    map.push({
                        k: 'exclusions',
                        v: this.getExclusions()
                    });
                }
                if (this.srs) {
                    map.push({
                        k: 'srs',
                        v: this.srs
                    });
                }
                return map;
            };
            return ProcessIsoCurveParam;
        }(UtilsLoggerByDefault);
        ServicesProcessIsoCurveRequestProcessIsoCurveRequest = function (Logger, _, ProcessIsoCurveParam) {
            function ProcessIsoCurveRequest(options) {
                if (!(this instanceof ProcessIsoCurveRequest)) {
                    throw new TypeError('ProcessIsoCurveRequest constructor cannot be called as a function.');
                }
                if (!options) {
                    throw new Error(_.getMessage('PARAM_EMPTY', 'options'));
                }
                this.settings = options;
                this.mode = this.settings.httpMethod || 'GET';
            }
            ProcessIsoCurveRequest.prototype = {
                requestString: null,
                constructor: ProcessIsoCurveRequest,
                template: {
                    container: '<?xml version="1.0" encoding="UTF-8"?>\n' + '<isochroneRequest>\n' + '__ID__' + '\t<location>\n' + '\t\t<x>__X__</x>\n' + '\t\t<y>__Y__</y>\n' + '\t</location>\n' + '\t<srs>__SRS__</srs>\n' + '\t<graphName>__GRAPHNAME__</graphName>\n' + '__PROFIL__' + '__EXCLUSIONS__' + '\t<method>__METHOD__</method>\n' + '__TIME__' + '__DISTANCE__' + '\t<reverse>__REVERSE__</reverse>\n' + '\t<smoothing>__SMOOTHING__</smoothing>\n' + '\t<holes>__HOLES__</holes>\n' + '</isochroneRequest>',
                    id: '\t<id>__IDVALUE__</id>\n',
                    profil: '\t<profileId>__PROFILID__</profileId>\n' + '\t<profileName>__PROFILNAME__</profileName>\n',
                    exclusions: {
                        container: '\t<exclusions>\n' + '__EXCLUSIONFEATURE__\n' + '\t</exclusions>\n',
                        feature: '\t\t<exclusion>__EXCLUSIONVALUE__</exclusion>'
                    },
                    time: '\t<time>__TIMEVALUE__</time>\n',
                    distance: '\t<distance>__DISTANCEVALUE__</distance>\n'
                },
                processRequestString: function () {
                    var request = '';
                    var i = 0;
                    switch (this.mode) {
                    case 'GET':
                        var oParams = new ProcessIsoCurveParam(this.settings);
                        var params = oParams.getParams();
                        for (i = 0; i < params.length; i++) {
                            var o = params[i];
                            if (request) {
                                request += '&';
                            }
                            request += o.k + '=' + o.v;
                        }
                        break;
                    case 'POST':
                        request = this.template.container;
                        request = request.replace(/__ID__/g, '');
                        request = request.replace(/__PROFIL__/g, '');
                        request = request.replace(/__X__/g, this.settings.position.x);
                        request = request.replace(/__Y__/g, this.settings.position.y);
                        request = request.replace(/__GRAPHNAME__/g, this.settings.graph);
                        request = request.replace(/__SRS__/g, this.settings.srs);
                        request = request.replace(/__SMOOTHING__/g, this.settings.smoothing);
                        request = request.replace(/__HOLES__/g, this.settings.holes);
                        request = request.replace(/__REVERSE__/g, this.settings.reverse);
                        if (this.settings.exclusions) {
                            var tmplExclusions = this.template.exclusions.container;
                            var exclusions = [];
                            for (i = 0; i < this.settings.exclusions.length; i++) {
                                var tmplFeature = this.template.exclusions.feature;
                                tmplFeature = tmplFeature.replace(/__EXCLUSIONVALUE__/, this.settings.exclusions[i]);
                                exclusions.push(tmplFeature);
                            }
                            tmplExclusions = tmplExclusions.replace(/__EXCLUSIONFEATURE__/, exclusions.join('\n'));
                            request = request.replace(/__EXCLUSIONS__/g, tmplExclusions);
                        }
                        request = request.replace(/__EXCLUSIONS__/g, '');
                        if (this.settings.distance) {
                            var tmplDistance = this.template.distance;
                            tmplDistance = tmplDistance.replace(/__DISTANCEVALUE__/g, this.settings.distance);
                            request = request.replace(/__DISTANCE__/g, tmplDistance);
                            request = request.replace(/__METHOD__/g, 'distance');
                        }
                        request = request.replace(/__DISTANCE__/g, '');
                        if (this.settings.time) {
                            var tmplTime = this.template.time;
                            tmplTime = tmplTime.replace(/__TIMEVALUE__/g, this.settings.time);
                            request = request.replace(/__TIME__/g, tmplTime);
                            request = request.replace(/__METHOD__/g, 'time');
                        }
                        request = request.replace(/__TIME__/g, '');
                        break;
                    default:
                    }
                    this.requestString = request;
                    return this.requestString;
                }
            };
            return ProcessIsoCurveRequest;
        }(UtilsLoggerByDefault, UtilsMessagesResources, ServicesProcessIsoCurveRequestModelProcessIsoCurveParam);
        ServicesProcessIsoCurveResponseModelProcessIsoCurveResponse = function () {
            function ProcessIsoCurveResponse() {
                if (!(this instanceof ProcessIsoCurveResponse)) {
                    throw new TypeError('ProcessIsoCurveResponse constructor cannot be called as a function.');
                }
                this.message = null;
                this.id = null;
                this.location = {};
                this.location.x = null;
                this.location.y = null;
                this.srs = null;
                this.geometry = null;
                this.time = null;
                this.distance = null;
            }
            ProcessIsoCurveResponse.prototype = { constructor: ProcessIsoCurveResponse };
            return ProcessIsoCurveResponse;
        }();
        ServicesProcessIsoCurveFormatsProcessIsoCurveResponseReader = function (Logger, WKT, ErrSrv, MessagesResources, ProcessIsoCurveResponse) {
            var ProcessIsoCurveResponseReader = {};
            ProcessIsoCurveResponseReader.READERS = {
                isochronResult: function (root) {
                    var response = new ProcessIsoCurveResponse();
                    if (root.hasChildNodes()) {
                        var children = root.childNodes;
                        var child;
                        for (var i = 0; i < children.length; i++) {
                            child = children[i];
                            if (ProcessIsoCurveResponseReader.READERS[child.nodeName]) {
                                ProcessIsoCurveResponseReader.READERS[child.nodeName](child, response);
                            }
                        }
                    }
                    if (response.status === 'error') {
                        var message = MessagesResources.getMessage('SERVICE_RESPONSE_EXCEPTION', response.message);
                        throw new ErrSrv({
                            message: message,
                            type: ErrSrv.TYPE_SRVERR
                        });
                    }
                    return response;
                },
                message: function (node, response) {
                    if (response) {
                        response.message = __getChildValue(node);
                    }
                },
                status: function (node, response) {
                    var status = __getChildValue(node);
                    if (status === 'ERROR' || status === 'error') {
                        if (response) {
                            response.status = 'error';
                        }
                    }
                },
                id: function (node, response) {
                    if (response) {
                        response.id = __getChildValue(node);
                    }
                },
                location: function (node, response) {
                    var coords = __getChildValue(node);
                    if (response && response.location) {
                        response.location.x = parseFloat(coords.split(',')[0]);
                        response.location.y = parseFloat(coords.split(',')[1]);
                    }
                },
                srs: function (node, response) {
                    if (response) {
                        response.srs = __getChildValue(node);
                    }
                },
                distance: function (node, response) {
                    if (response) {
                        response.distance = parseFloat(__getChildValue(node));
                    }
                },
                time: function (node, response) {
                    if (response) {
                        response.time = parseFloat(__getChildValue(node));
                    }
                },
                wktGeometry: function (node, response) {
                    if (response) {
                        var wktGeometry = node.innerHTML;
                        var onWKTSuccess = function (json) {
                            response.geometry = json;
                        };
                        var onWKTError = function () {
                            var msg = MessagesResources.getMessage('PARAM_FORMAT', ['wktGeometry']);
                            throw new Error(msg);
                        };
                        if (response.hasOwnProperty('geometry')) {
                            WKT.toJson(wktGeometry, onWKTSuccess, onWKTError);
                        }
                    }
                },
                serviceResult: function (node) {
                    var response = {};
                    if (node.hasChildNodes()) {
                        var children = node.childNodes;
                        var child;
                        for (var i = 0; i < children.length; i++) {
                            child = children[i];
                            if (ProcessIsoCurveResponseReader.READERS[child.nodeName]) {
                                ProcessIsoCurveResponseReader.READERS[child.nodeName](child, response);
                            }
                        }
                    }
                    return response;
                },
                ExceptionReport: function (node) {
                    var response = {};
                    if (node.hasChildNodes()) {
                        var children = node.childNodes;
                        var child;
                        for (var i = 0; i < children.length; i++) {
                            child = children[i];
                            if (child.nodeName === 'Exception') {
                                response.exceptionReport = ProcessIsoCurveResponseReader.READERS['Exception'](child);
                            }
                        }
                    }
                    return response;
                },
                Exception: function (node) {
                    var exceptionReport = {};
                    var exceptionCode = node.getAttribute('exceptionCode');
                    if (exceptionCode) {
                        exceptionReport.exceptionCode = exceptionCode;
                    }
                    var textNode = node.firstChild;
                    if (textNode && textNode.nodeType === 3) {
                        exceptionReport.exception = textNode.nodeValue;
                    }
                    return exceptionReport;
                }
            };
            ProcessIsoCurveResponseReader.read = function (root) {
                var response;
                if (root.nodeName === 'isochronResult' || root.nodeName === 'isochroneResult' || root.nodeName === 'IsochroneResult') {
                    response = ProcessIsoCurveResponseReader.READERS['isochronResult'](root);
                    return response;
                } else if (root.nodeName === 'ExceptionReport') {
                    response = ProcessIsoCurveResponseReader.READERS[root.nodeName](root);
                    return response;
                } else if (ProcessIsoCurveResponseReader.READERS[root.nodeName]) {
                    response = ProcessIsoCurveResponseReader.READERS[root.nodeName](root);
                    if (response.status === 'error') {
                        var errMsg = MessagesResources.getMessage('SERVICE_RESPONSE_EXCEPTION', response.message);
                        throw new ErrSrv({
                            message: errMsg,
                            type: ErrSrv.TYPE_SRVERR
                        });
                    }
                    return response;
                } else {
                    throw new ErrSrv({
                        message: MessagesResources.getMessage('SERVICE_RESPONSE_ANALYSE', root.nodeName),
                        type: ErrSrv.TYPE_UNKERR
                    });
                }
            };
            function __getChildValue(node) {
                var textNode;
                var value = '';
                if (node.hasChildNodes()) {
                    textNode = node.firstChild;
                    if (textNode && textNode.nodeType === 3) {
                        value = textNode.nodeValue;
                    }
                }
                return value;
            }
            return ProcessIsoCurveResponseReader;
        }(UtilsLoggerByDefault, FormatsWKT, ExceptionsErrorService, UtilsMessagesResources, ServicesProcessIsoCurveResponseModelProcessIsoCurveResponse);
        ServicesProcessIsoCurveResponseProcessIsoCurveResponseFactory = function (Logger, ErrorService, MRes, XML, WKT, ProcessIsoCurveResponseReader, ProcessIsoCurveResponse) {
            var ProcessIsoCurveResponseFactory = {
                build: function (options) {
                    var data = null;
                    if (options.response) {
                        if (options.rawResponse) {
                            data = options.response;
                        } else {
                            switch (options.outputFormat) {
                            case 'xml':
                                try {
                                    var p = new XML({ reader: ProcessIsoCurveResponseReader });
                                    if (typeof options.response === 'string') {
                                        p.setXMLString(options.response);
                                    } else {
                                        p.setXMLDoc(options.response);
                                    }
                                    data = p.parse();
                                    if (!data) {
                                        throw new Error(MRes.getMessage('SERVICE_RESPONSE_EXCEPTION_2'));
                                    }
                                } catch (e) {
                                    var message = e.message;
                                    message += '\n(raw response service : \'' + options.response + '\')';
                                    options.onError.call(options.scope, new ErrorService({
                                        message: MRes.getMessage('SERVICE_RESPONSE_EXCEPTION', message),
                                        status: 200,
                                        type: ErrorService.TYPE_SRVERR
                                    }));
                                    return;
                                }
                                break;
                            case 'json':
                                var JSONResponse;
                                if (typeof options.response === 'string') {
                                    JSONResponse = window.JSON.parse(options.response);
                                } else {
                                    JSONResponse = options.response;
                                }
                                if (JSONResponse.status === 'OK' || JSONResponse.status === 'ok') {
                                    data = new ProcessIsoCurveResponse();
                                    if (data) {
                                        data.time = JSONResponse.time;
                                        data.distance = JSONResponse.distance;
                                        data.message = JSONResponse.message;
                                        data.id = JSONResponse.id;
                                        data.srs = JSONResponse.srs;
                                        var onWKTSuccess = function (json) {
                                            data.geometry = json;
                                        };
                                        var onWKTError = function () {
                                            options.onError.call(options.scope, new ErrorService({ message: MRes.getMessage('PARAM_FORMAT', 'wktGeometry') }));
                                        };
                                        if (data.hasOwnProperty('geometry')) {
                                            WKT.toJson(JSONResponse.wktGeometry, onWKTSuccess, onWKTError);
                                            if (!data.geometry) {
                                                return;
                                            }
                                        }
                                        var coords = JSONResponse.location.split(',');
                                        if (data.location) {
                                            data.location.x = coords[0];
                                            data.location.y = coords[1];
                                        }
                                    } else {
                                        options.onError.call(options.scope, new ErrorService(MRes.getMessage('SERVICE_RESPONSE_ANALYSE', options.response)));
                                        return;
                                    }
                                } else if (JSONResponse.status === 'ERROR' || JSONResponse.status === 'error') {
                                    var mess = JSONResponse.message;
                                    mess += '\n(raw response service : \'' + JSONResponse + '\')';
                                    options.onError.call(options.scope, new ErrorService(MRes.getMessage('SERVICE_RESPONSE_EXCEPTION', mess)));
                                    return;
                                }
                                break;
                            default:
                                options.onError.call(options.scope, new ErrorService(MRes.getMessage('SERVICE_RESPONSE_FORMAT', 'json', 'xml')));
                                return;
                            }
                            if (data && data.exceptionReport) {
                                options.onError.call(options.scope, new ErrorService({
                                    message: MRes.getMessage('SERVICE_RESPONSE_EXCEPTION', data.exceptionReport),
                                    type: ErrorService.TYPE_SRVERR,
                                    status: 200
                                }));
                                return;
                            }
                        }
                    } else {
                        options.onError.call(options.scope, new ErrorService(MRes.getMessage('SERVICE_RESPONSE_EMPTY')));
                        return;
                    }
                    options.onSuccess.call(options.scope, data);
                    return;
                }
            };
            return ProcessIsoCurveResponseFactory;
        }(UtilsLoggerByDefault, ExceptionsErrorService, UtilsMessagesResources, FormatsXML, FormatsWKT, ServicesProcessIsoCurveFormatsProcessIsoCurveResponseReader, ServicesProcessIsoCurveResponseModelProcessIsoCurveResponse);
        ServicesProcessIsoCurveProcessIsoCurve = function (Logger, _, ErrorService, CommonService, DefaultUrlService, ProcessIsoCurveRequest, ProcessIsoCurveResponseFactory) {
            function ProcessIsoCurve(options) {
                if (!(this instanceof ProcessIsoCurve)) {
                    throw new TypeError(_.getMessage('CLASS_CONSTRUCTOR', 'ProcessIsoCurve'));
                }
                this.CLASSNAME = 'ProcessIsoCurve';
                CommonService.apply(this, arguments);
                if (!options.position) {
                    throw new Error(_.getMessage('PARAM_MISSING', 'position'));
                }
                if (options.position.x == null) {
                    throw new Error(_.getMessage('PARAM_MISSING', 'position.x'));
                }
                if (options.position.y == null) {
                    throw new Error(_.getMessage('PARAM_MISSING', 'position.y'));
                }
                if (!options.time && !options.distance) {
                    throw new Error('Parameter(s) \'distance\' missing. Parameter time to calculate an isochrone, parameter distance for an isodistance');
                }
                if (!options.time && options.distance) {
                    this.options.method = 'distance';
                    if (this.options.time) {
                        delete this.options.time;
                    }
                }
                if (options.time && !options.distance) {
                    this.options.method = 'time';
                    if (this.options.distance) {
                        delete this.options.distance;
                    }
                }
                this.options.method = this.options.method || 'time';
                this.options.exclusions = options.exclusions || null;
                this.options.graph = options.graph || 'Voiture';
                this.options.reverse = options.reverse || false;
                this.options.smoothing = options.smoothing || false;
                this.options.holes = options.holes || false;
                this.options.srs = options.srs || 'EPSG:4326';
                this.options.outputFormat = typeof options.outputFormat == 'string' ? options.outputFormat.toLowerCase() : 'json';
                if (!this.options.serverUrl) {
                    var lstUrlByDefault = DefaultUrlService.ProcessIsoCurve.url(this.options.apiKey);
                    var urlFound = lstUrlByDefault['iso' + '-' + this.options.outputFormat];
                    if (!urlFound) {
                        throw new Error('Url by default not found !');
                    }
                    this.options.serverUrl = urlFound;
                }
                var idx = this.options.serverUrl.lastIndexOf('.');
                if (idx !== -1) {
                    var extension = this.options.serverUrl.substring(idx + 1);
                    if (extension && extension.length < 5) {
                        switch (extension.toLowerCase()) {
                        case 'json':
                        case 'xml':
                            this.options.outputFormat = extension.toLowerCase();
                            break;
                        default:
                            throw new Error('type of service : unknown or unsupported (json or xml) !');
                        }
                    }
                }
            }
            ProcessIsoCurve.prototype = Object.create(CommonService.prototype, {});
            ProcessIsoCurve.prototype.constructor = ProcessIsoCurve;
            ProcessIsoCurve.prototype.buildRequest = function (error, success) {
                try {
                    var oIsoCurve = new ProcessIsoCurveRequest(this.options);
                    if (!oIsoCurve.processRequestString()) {
                        throw new Error(_.getMessage('SERVICE_REQUEST_BUILD'));
                    }
                    this.request = oIsoCurve.requestString;
                } catch (e) {
                    error.call(this, new ErrorService(e.message));
                    return;
                }
                success.call(this, this.request);
            };
            ProcessIsoCurve.prototype.analyzeResponse = function (onError, onSuccess) {
                if (this.response) {
                    var options = {
                        response: this.response,
                        outputFormat: this.options.outputFormat,
                        rawResponse: this.options.rawResponse,
                        onSuccess: onSuccess,
                        onError: onError,
                        scope: this
                    };
                    ProcessIsoCurveResponseFactory.build(options);
                } else {
                    onError.call(this, new ErrorService(_.getMessage('SERVICE_RESPONSE_EMPTY')));
                }
            };
            return ProcessIsoCurve;
        }(UtilsLoggerByDefault, UtilsMessagesResources, ExceptionsErrorService, ServicesCommonService, ServicesDefaultUrlService, ServicesProcessIsoCurveRequestProcessIsoCurveRequest, ServicesProcessIsoCurveResponseProcessIsoCurveResponseFactory);
        ServicesServices = function (Alti, AutoConf, Geocode, ReverseGeocode, AutoComplete, Route, ProcessIsoCurve) {
            var Services = {
                getConfig: function (options) {
                    var autoconfService = new AutoConf(options);
                    autoconfService.call();
                },
                getAltitude: function (options) {
                    var altiService = new Alti(options);
                    altiService.call();
                },
                geocode: function (options) {
                    var geocodeService = new Geocode(options);
                    geocodeService.call();
                },
                reverseGeocode: function (options) {
                    var reverseGeocodeService = new ReverseGeocode(options);
                    reverseGeocodeService.call();
                },
                autoComplete: function (options) {
                    var autoCompleteService = new AutoComplete(options);
                    autoCompleteService.call();
                },
                route: function (options) {
                    var routeService = new Route(options);
                    routeService.call();
                },
                isoCurve: function (options) {
                    var processIsoCurveService = new ProcessIsoCurve(options);
                    processIsoCurveService.call();
                }
            };
            var point = {};
            var circle = {};
            var bbox = {};
            return Services;
        }(ServicesAltiAlti, ServicesAutoConfAutoConf, ServicesGeocodeGeocode, ServicesGeocodeReverseGeocode, ServicesAutoCompleteAutoComplete, ServicesRouteRoute, ServicesProcessIsoCurveProcessIsoCurve);
        Gp = function (XHR, Services, AltiResponse, Elevation, AutoCompleteResponse, SuggestedLocation, GetConfigResponse, Constraint, Format, Layer, Legend, Metadata, Originator, Service, Style, Territory, Thematic, TM, TMLimit, TMS, GeocodeResponse, GeocodedLocation, DirectGeocodedLocation, ReverseGeocodedLocation, IsoCurveResponse, RouteResponse, RouteInstruction, Error, Helper, DefaultUrl) {
            var scope = typeof window !== 'undefined' ? window : {};
            var Gp = scope.Gp || {
                servicesVersion: '1.1.0',
                servicesDate: '2017-11-24',
                extend: function (strNS, value) {
                    var parts = strNS.split('.');
                    var parent = this;
                    var pl;
                    pl = parts.length;
                    for (var i = 0; i < pl; i++) {
                        if (typeof parent[parts[i]] === 'undefined') {
                            parent[parts[i]] = {};
                        }
                        var n = pl - 1;
                        if (i === n) {
                            parent[parts[i]] = value;
                        }
                        parent = parent[parts[i]];
                    }
                    return this;
                }
            };
            Gp.extend('Protocols', {});
            Gp.extend('Protocols.XHR', XHR);
            Gp.extend('Services', Services);
            Gp.extend('Services.AltiResponse', AltiResponse);
            Gp.extend('Services.Alti.Elevation', Elevation);
            Gp.extend('Services.AutoCompleteResponse', AutoCompleteResponse);
            Gp.extend('Services.AutoComplete.SuggestedLocation', SuggestedLocation);
            Gp.extend('Services.GetConfigResponse', GetConfigResponse);
            Gp.extend('Services.Config.Constraint', Constraint);
            Gp.extend('Services.Config.Format', Format);
            Gp.extend('Services.Config.Layer', Layer);
            Gp.extend('Services.Config.Legend', Legend);
            Gp.extend('Services.Config.Metadata', Metadata);
            Gp.extend('Services.Config.Originator', Originator);
            Gp.extend('Services.Config.Service', Service);
            Gp.extend('Services.Config.Style', Style);
            Gp.extend('Services.Config.Territory', Territory);
            Gp.extend('Services.Config.Thematic', SuggestedLocation);
            Gp.extend('Services.Config.TileMatrix', TM);
            Gp.extend('Services.Config.TileMatrixLimit', TMLimit);
            Gp.extend('Services.Config.TileMatrixSet', TMS);
            Gp.extend('Services.GeocodeResponse', GeocodeResponse);
            Gp.extend('Services.Geocode.GeocodedLocation', GeocodedLocation);
            Gp.extend('Services.Geocode.DirectGeocodedLocation', DirectGeocodedLocation);
            Gp.extend('Services.Geocode.ReverseGeocodedLocation', ReverseGeocodedLocation);
            Gp.extend('Services.IsoCurveResponse', IsoCurveResponse);
            Gp.extend('Services.RouteResponse', RouteResponse);
            Gp.extend('Services.Route.RouteInstruction', RouteInstruction);
            Gp.extend('Error', Error);
            Gp.extend('Helper', Helper);
            Gp.extend('Services.DefaultUrl', DefaultUrl);
            scope.Gp = Gp;
            return scope.Gp;
        }(ProtocolsXHR, ServicesServices, ServicesAltiResponseModelAltiResponse, ServicesAltiResponseModelElevation, ServicesAutoCompleteResponseModelAutoCompleteResponse, ServicesAutoCompleteResponseModelSuggestedLocation, ServicesAutoConfResponseModelAutoConfResponse, ServicesAutoConfResponseModelConstraint, ServicesAutoConfResponseModelFormat, ServicesAutoConfResponseModelLayer, ServicesAutoConfResponseModelLegend, ServicesAutoConfResponseModelMetadata, ServicesAutoConfResponseModelOriginator, ServicesAutoConfResponseModelService, ServicesAutoConfResponseModelStyle, ServicesAutoConfResponseModelTerritory, ServicesAutoConfResponseModelThematic, ServicesAutoConfResponseModelTileMatrix, ServicesAutoConfResponseModelTileMatrixLimit, ServicesAutoConfResponseModelTileMatrixSet, ServicesGeocodeResponseModelGeocodeResponse, ServicesGeocodeResponseModelGeocodedLocation, ServicesGeocodeResponseModelDirectGeocodedLocation, ServicesGeocodeResponseModelReverseGeocodedLocation, ServicesProcessIsoCurveResponseModelProcessIsoCurveResponse, ServicesRouteResponseModelRouteResponse, ServicesRouteResponseModelRouteInstruction, ExceptionsErrorService, UtilsHelper, ServicesDefaultUrlService);
        return Gp;
    }));
    CommonUtilsAutoLoadConfig = function (Gp) {
        (function () {
            var scripts = document.getElementsByTagName('script');
            var key = scripts[scripts.length - 1].getAttribute('data-key');
            if (key) {
                var splitKeys = key.split(/;|,|\|/);
                if (key && splitKeys.length > 1) {
                    var keys = [];
                    for (var i = 0; i < splitKeys.length; i++) {
                        keys.push(splitKeys[i]);
                    }
                    key = keys;
                }
            }
            var url = scripts[scripts.length - 1].getAttribute('data-url');
            var timeout = scripts[scripts.length - 1].getAttribute('data-timeout');
            var success = function () {
            };
            var error = function (e) {
                throw new Error('Configuration load failed : ' + e.message);
            };
            if (!key && !url) {
                return;
            }
            var options = {
                apiKey: key,
                onSuccess: success,
                onFailure: error
            };
            if (url) {
                options.serverUrl = url;
                options.callbackSuffix = '';
            }
            if (timeout) {
                options.timeOut = timeout;
            }
            if (!Gp.Config) {
                Gp.Services.getConfig(options);
            }
        }());
    }(gp);
    CommonUtilsLayerUtils = function () {
        var LayerUtils = {
            getZoomLevelFromScaleDenominator: function (scaleDenominator, crs) {
                var resolutionsNatives = {};
                switch (crs) {
                case 'EPSG:2154':
                    resolutionsNatives = {
                        0: 104579.224549894,
                        1: 52277.5323537905,
                        2: 26135.4870785954,
                        3: 13066.8913818,
                        4: 6533.2286041135,
                        5: 3266.5595244627,
                        6: 1633.2660045974,
                        7: 816.629554986,
                        8: 408.3139146768,
                        9: 204.1567415109,
                        10: 102.0783167832,
                        11: 51.0391448966,
                        12: 25.5195690743,
                        13: 12.7597836936,
                        14: 6.379891636,
                        15: 3.1899457653,
                        16: 1.5949728695,
                        17: 0.7974864315,
                        18: 0.3987432149,
                        19: 0.1993716073,
                        20: 0.0996858037,
                        21: 0.0498429018
                    };
                    break;
                default:
                    resolutionsNatives = {
                        0: 156543.033928041,
                        1: 78271.51696402048,
                        2: 39135.758482010235,
                        3: 19567.87924100512,
                        4: 9783.93962050256,
                        5: 4891.96981025128,
                        6: 2445.98490512564,
                        7: 1222.99245256282,
                        8: 611.49622628141,
                        9: 305.7481131407048,
                        10: 152.8740565703525,
                        11: 76.43702828517624,
                        12: 38.21851414258813,
                        13: 19.10925707129406,
                        14: 9.554628535647032,
                        15: 4.777314267823516,
                        16: 2.388657133911758,
                        17: 1.194328566955879,
                        18: 0.5971642834779395,
                        19: 0.2985821417389697,
                        20: 0.1492910708694849,
                        21: 0.0746455354347424
                    };
                    break;
                }
                var resolution = scaleDenominator * 0.00028;
                for (var index in resolutionsNatives) {
                    if (resolutionsNatives.hasOwnProperty(index)) {
                        if (resolutionsNatives[index] <= resolution) {
                            index = parseInt(index, 10);
                            return index;
                        }
                    }
                }
                return 0;
            },
            getAttributions: function (params) {
                var zoom = params.zoom;
                var attributions = [];
                if (params.originators != null && params.visibility) {
                    var drawLogo;
                    for (var j = 0, jl = params.originators.length; j < jl; j++) {
                        drawLogo = true;
                        var originator = params.originators[j];
                        var constraints = params.originators[j].constraints || [];
                        for (var k = 0, kl = constraints.length; k < kl; k++) {
                            var constraint = constraints[k];
                            drawLogo = true;
                            var minZoomLevel = this.getZoomLevelFromScaleDenominator(constraint.maxScaleDenominator, params.crs);
                            var maxZoomLevel = this.getZoomLevelFromScaleDenominator(constraint.minScaleDenominator, params.crs) || 21;
                            if (minZoomLevel && minZoomLevel > zoom) {
                                drawLogo = false;
                            }
                            if (drawLogo && maxZoomLevel !== null && maxZoomLevel < zoom) {
                                drawLogo = false;
                            }
                            var bbox = constraint.bbox;
                            if (drawLogo && bbox) {
                                drawLogo = false;
                                var viewExtent = params.extent;
                                if (viewExtent) {
                                    var bounds = [
                                        bbox.top,
                                        bbox.left,
                                        bbox.bottom,
                                        bbox.right
                                    ];
                                    if (this.intersects(viewExtent, bounds)) {
                                        drawLogo = true;
                                        break;
                                    }
                                }
                            }
                        }
                        if (drawLogo) {
                            var logo = originator.logo;
                            var url = originator.url;
                            var name = originator.name ? originator.name : '';
                            var text = originator.attribution;
                            var container = document.createElement('div');
                            container.className = 'gp-control-attribution';
                            var link = null;
                            link = document.createElement('a');
                            link.className = 'gp-control-attribution-link';
                            link.target = '_blank';
                            container.appendChild(link);
                            if (url) {
                                link.href = url;
                            }
                            var bImage = logo ? true : false;
                            var image = null;
                            if (bImage) {
                                image = document.createElement('img');
                                if (link) {
                                    image.className = 'gp-control-attribution-image';
                                    link.appendChild(image);
                                } else {
                                    image.className = '';
                                    container.appendChild(image);
                                }
                                image.src = logo;
                                image.title = text || name;
                                image.style.height = '30px';
                                image.style.width = '30px';
                            } else {
                                if (name) {
                                    link.textContent = name;
                                } else if (text) {
                                    link.textContent = text;
                                } else if (url) {
                                    link.textContent = url;
                                } else {
                                    link.textContent = '';
                                }
                            }
                            attributions.push(container.innerHTML + ' ');
                        }
                    }
                }
                return attributions;
            },
            intersects: function (extent1, extent2) {
                var intersectsX = extent1[1] <= extent2[3] && extent2[1] <= extent1[3];
                var intersectsY = extent1[2] <= extent2[0] && extent2[2] <= extent1[0];
                return intersectsX && intersectsY;
            }
        };
        return LayerUtils;
    }();
    (function (global, factory) {
        typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() : typeof define === 'function' && define.amd ? define('proj4', factory) : global.proj4 = factory();
    }(this, function () {
        'use strict';
        var globals = function (defs) {
            defs('EPSG:4326', '+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees');
            defs('EPSG:4269', '+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees');
            defs('EPSG:3857', '+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs');
            defs.WGS84 = defs['EPSG:4326'];
            defs['EPSG:3785'] = defs['EPSG:3857'];
            defs.GOOGLE = defs['EPSG:3857'];
            defs['EPSG:900913'] = defs['EPSG:3857'];
            defs['EPSG:102113'] = defs['EPSG:3857'];
        };
        var PJD_3PARAM = 1;
        var PJD_7PARAM = 2;
        var PJD_WGS84 = 4;
        var PJD_NODATUM = 5;
        var SEC_TO_RAD = 0.00000484813681109536;
        var HALF_PI = Math.PI / 2;
        var SIXTH = 0.16666666666666666;
        var RA4 = 0.04722222222222222;
        var RA6 = 0.022156084656084655;
        var EPSLN = 1e-10;
        var D2R = 0.017453292519943295;
        var R2D = 57.29577951308232;
        var FORTPI = Math.PI / 4;
        var TWO_PI = Math.PI * 2;
        var SPI = 3.14159265359;
        var exports$1 = {};
        exports$1.greenwich = 0;
        exports$1.lisbon = -9.131906111111;
        exports$1.paris = 2.337229166667;
        exports$1.bogota = -74.080916666667;
        exports$1.madrid = -3.687938888889;
        exports$1.rome = 12.452333333333;
        exports$1.bern = 7.439583333333;
        exports$1.jakarta = 106.807719444444;
        exports$1.ferro = -17.666666666667;
        exports$1.brussels = 4.367975;
        exports$1.stockholm = 18.058277777778;
        exports$1.athens = 23.7163375;
        exports$1.oslo = 10.722916666667;
        var units = {
            ft: { to_meter: 0.3048 },
            'us-ft': { to_meter: 1200 / 3937 }
        };
        var ignoredChar = /[\s_\-\/\(\)]/g;
        function match(obj, key) {
            if (obj[key]) {
                return obj[key];
            }
            var keys = Object.keys(obj);
            var lkey = key.toLowerCase().replace(ignoredChar, '');
            var i = -1;
            var testkey, processedKey;
            while (++i < keys.length) {
                testkey = keys[i];
                processedKey = testkey.toLowerCase().replace(ignoredChar, '');
                if (processedKey === lkey) {
                    return obj[testkey];
                }
            }
        }
        var parseProj = function (defData) {
            var self = {};
            var paramObj = defData.split('+').map(function (v) {
                return v.trim();
            }).filter(function (a) {
                return a;
            }).reduce(function (p, a) {
                var split = a.split('=');
                split.push(true);
                p[split[0].toLowerCase()] = split[1];
                return p;
            }, {});
            var paramName, paramVal, paramOutname;
            var params = {
                proj: 'projName',
                datum: 'datumCode',
                rf: function (v) {
                    self.rf = parseFloat(v);
                },
                lat_0: function (v) {
                    self.lat0 = v * D2R;
                },
                lat_1: function (v) {
                    self.lat1 = v * D2R;
                },
                lat_2: function (v) {
                    self.lat2 = v * D2R;
                },
                lat_ts: function (v) {
                    self.lat_ts = v * D2R;
                },
                lon_0: function (v) {
                    self.long0 = v * D2R;
                },
                lon_1: function (v) {
                    self.long1 = v * D2R;
                },
                lon_2: function (v) {
                    self.long2 = v * D2R;
                },
                alpha: function (v) {
                    self.alpha = parseFloat(v) * D2R;
                },
                lonc: function (v) {
                    self.longc = v * D2R;
                },
                x_0: function (v) {
                    self.x0 = parseFloat(v);
                },
                y_0: function (v) {
                    self.y0 = parseFloat(v);
                },
                k_0: function (v) {
                    self.k0 = parseFloat(v);
                },
                k: function (v) {
                    self.k0 = parseFloat(v);
                },
                a: function (v) {
                    self.a = parseFloat(v);
                },
                b: function (v) {
                    self.b = parseFloat(v);
                },
                r_a: function () {
                    self.R_A = true;
                },
                zone: function (v) {
                    self.zone = parseInt(v, 10);
                },
                south: function () {
                    self.utmSouth = true;
                },
                towgs84: function (v) {
                    self.datum_params = v.split(',').map(function (a) {
                        return parseFloat(a);
                    });
                },
                to_meter: function (v) {
                    self.to_meter = parseFloat(v);
                },
                units: function (v) {
                    self.units = v;
                    var unit = match(units, v);
                    if (unit) {
                        self.to_meter = unit.to_meter;
                    }
                },
                from_greenwich: function (v) {
                    self.from_greenwich = v * D2R;
                },
                pm: function (v) {
                    var pm = match(exports$1, v);
                    self.from_greenwich = (pm ? pm : parseFloat(v)) * D2R;
                },
                nadgrids: function (v) {
                    if (v === '@null') {
                        self.datumCode = 'none';
                    } else {
                        self.nadgrids = v;
                    }
                },
                axis: function (v) {
                    var legalAxis = 'ewnsud';
                    if (v.length === 3 && legalAxis.indexOf(v.substr(0, 1)) !== -1 && legalAxis.indexOf(v.substr(1, 1)) !== -1 && legalAxis.indexOf(v.substr(2, 1)) !== -1) {
                        self.axis = v;
                    }
                }
            };
            for (paramName in paramObj) {
                paramVal = paramObj[paramName];
                if (paramName in params) {
                    paramOutname = params[paramName];
                    if (typeof paramOutname === 'function') {
                        paramOutname(paramVal);
                    } else {
                        self[paramOutname] = paramVal;
                    }
                } else {
                    self[paramName] = paramVal;
                }
            }
            if (typeof self.datumCode === 'string' && self.datumCode !== 'WGS84') {
                self.datumCode = self.datumCode.toLowerCase();
            }
            return self;
        };
        var NEUTRAL = 1;
        var KEYWORD = 2;
        var NUMBER = 3;
        var QUOTED = 4;
        var AFTERQUOTE = 5;
        var ENDED = -1;
        var whitespace = /\s/;
        var latin = /[A-Za-z]/;
        var keyword = /[A-Za-z84]/;
        var endThings = /[,\]]/;
        var digets = /[\d\.E\-\+]/;
        function Parser(text) {
            if (typeof text !== 'string') {
                throw new Error('not a string');
            }
            this.text = text.trim();
            this.level = 0;
            this.place = 0;
            this.root = null;
            this.stack = [];
            this.currentObject = null;
            this.state = NEUTRAL;
        }
        Parser.prototype.readCharicter = function () {
            var char = this.text[this.place++];
            if (this.state !== QUOTED) {
                while (whitespace.test(char)) {
                    if (this.place >= this.text.length) {
                        return;
                    }
                    char = this.text[this.place++];
                }
            }
            switch (this.state) {
            case NEUTRAL:
                return this.neutral(char);
            case KEYWORD:
                return this.keyword(char);
            case QUOTED:
                return this.quoted(char);
            case AFTERQUOTE:
                return this.afterquote(char);
            case NUMBER:
                return this.number(char);
            case ENDED:
                return;
            }
        };
        Parser.prototype.afterquote = function (char) {
            if (char === '"') {
                this.word += '"';
                this.state = QUOTED;
                return;
            }
            if (endThings.test(char)) {
                this.word = this.word.trim();
                this.afterItem(char);
                return;
            }
            throw new Error('havn\'t handled "' + char + '" in afterquote yet, index ' + this.place);
        };
        Parser.prototype.afterItem = function (char) {
            if (char === ',') {
                if (this.word !== null) {
                    this.currentObject.push(this.word);
                }
                this.word = null;
                this.state = NEUTRAL;
                return;
            }
            if (char === ']') {
                this.level--;
                if (this.word !== null) {
                    this.currentObject.push(this.word);
                    this.word = null;
                }
                this.state = NEUTRAL;
                this.currentObject = this.stack.pop();
                if (!this.currentObject) {
                    this.state = ENDED;
                }
                return;
            }
        };
        Parser.prototype.number = function (char) {
            if (digets.test(char)) {
                this.word += char;
                return;
            }
            if (endThings.test(char)) {
                this.word = parseFloat(this.word);
                this.afterItem(char);
                return;
            }
            throw new Error('havn\'t handled "' + char + '" in number yet, index ' + this.place);
        };
        Parser.prototype.quoted = function (char) {
            if (char === '"') {
                this.state = AFTERQUOTE;
                return;
            }
            this.word += char;
            return;
        };
        Parser.prototype.keyword = function (char) {
            if (keyword.test(char)) {
                this.word += char;
                return;
            }
            if (char === '[') {
                var newObjects = [];
                newObjects.push(this.word);
                this.level++;
                if (this.root === null) {
                    this.root = newObjects;
                } else {
                    this.currentObject.push(newObjects);
                }
                this.stack.push(this.currentObject);
                this.currentObject = newObjects;
                this.state = NEUTRAL;
                return;
            }
            if (endThings.test(char)) {
                this.afterItem(char);
                return;
            }
            throw new Error('havn\'t handled "' + char + '" in keyword yet, index ' + this.place);
        };
        Parser.prototype.neutral = function (char) {
            if (latin.test(char)) {
                this.word = char;
                this.state = KEYWORD;
                return;
            }
            if (char === '"') {
                this.word = '';
                this.state = QUOTED;
                return;
            }
            if (digets.test(char)) {
                this.word = char;
                this.state = NUMBER;
                return;
            }
            if (endThings.test(char)) {
                this.afterItem(char);
                return;
            }
            throw new Error('havn\'t handled "' + char + '" in neutral yet, index ' + this.place);
        };
        Parser.prototype.output = function () {
            while (this.place < this.text.length) {
                this.readCharicter();
            }
            if (this.state === ENDED) {
                return this.root;
            }
            throw new Error('unable to parse string "' + this.text + '". State is ' + this.state);
        };
        function parseString(txt) {
            var parser = new Parser(txt);
            return parser.output();
        }
        function mapit(obj, key, value) {
            if (Array.isArray(key)) {
                value.unshift(key);
                key = null;
            }
            var thing = key ? {} : obj;
            var out = value.reduce(function (newObj, item) {
                sExpr(item, newObj);
                return newObj;
            }, thing);
            if (key) {
                obj[key] = out;
            }
        }
        function sExpr(v, obj) {
            if (!Array.isArray(v)) {
                obj[v] = true;
                return;
            }
            var key = v.shift();
            if (key === 'PARAMETER') {
                key = v.shift();
            }
            if (v.length === 1) {
                if (Array.isArray(v[0])) {
                    obj[key] = {};
                    sExpr(v[0], obj[key]);
                    return;
                }
                obj[key] = v[0];
                return;
            }
            if (!v.length) {
                obj[key] = true;
                return;
            }
            if (key === 'TOWGS84') {
                obj[key] = v;
                return;
            }
            if (!Array.isArray(key)) {
                obj[key] = {};
            }
            var i;
            switch (key) {
            case 'UNIT':
            case 'PRIMEM':
            case 'VERT_DATUM':
                obj[key] = {
                    name: v[0].toLowerCase(),
                    convert: v[1]
                };
                if (v.length === 3) {
                    sExpr(v[2], obj[key]);
                }
                return;
            case 'SPHEROID':
            case 'ELLIPSOID':
                obj[key] = {
                    name: v[0],
                    a: v[1],
                    rf: v[2]
                };
                if (v.length === 4) {
                    sExpr(v[3], obj[key]);
                }
                return;
            case 'PROJECTEDCRS':
            case 'PROJCRS':
            case 'GEOGCS':
            case 'GEOCCS':
            case 'PROJCS':
            case 'LOCAL_CS':
            case 'GEODCRS':
            case 'GEODETICCRS':
            case 'GEODETICDATUM':
            case 'EDATUM':
            case 'ENGINEERINGDATUM':
            case 'VERT_CS':
            case 'VERTCRS':
            case 'VERTICALCRS':
            case 'COMPD_CS':
            case 'COMPOUNDCRS':
            case 'ENGINEERINGCRS':
            case 'ENGCRS':
            case 'FITTED_CS':
            case 'LOCAL_DATUM':
            case 'DATUM':
                v[0] = [
                    'name',
                    v[0]
                ];
                mapit(obj, key, v);
                return;
            default:
                i = -1;
                while (++i < v.length) {
                    if (!Array.isArray(v[i])) {
                        return sExpr(v, obj[key]);
                    }
                }
                return mapit(obj, key, v);
            }
        }
        var D2R$1 = 0.017453292519943295;
        function rename(obj, params) {
            var outName = params[0];
            var inName = params[1];
            if (!(outName in obj) && inName in obj) {
                obj[outName] = obj[inName];
                if (params.length === 3) {
                    obj[outName] = params[2](obj[outName]);
                }
            }
        }
        function d2r(input) {
            return input * D2R$1;
        }
        function cleanWKT(wkt) {
            if (wkt.type === 'GEOGCS') {
                wkt.projName = 'longlat';
            } else if (wkt.type === 'LOCAL_CS') {
                wkt.projName = 'identity';
                wkt.local = true;
            } else {
                if (typeof wkt.PROJECTION === 'object') {
                    wkt.projName = Object.keys(wkt.PROJECTION)[0];
                } else {
                    wkt.projName = wkt.PROJECTION;
                }
            }
            if (wkt.UNIT) {
                wkt.units = wkt.UNIT.name.toLowerCase();
                if (wkt.units === 'metre') {
                    wkt.units = 'meter';
                }
                if (wkt.UNIT.convert) {
                    if (wkt.type === 'GEOGCS') {
                        if (wkt.DATUM && wkt.DATUM.SPHEROID) {
                            wkt.to_meter = wkt.UNIT.convert * wkt.DATUM.SPHEROID.a;
                        }
                    } else {
                        wkt.to_meter = wkt.UNIT.convert, 10;
                    }
                }
            }
            var geogcs = wkt.GEOGCS;
            if (wkt.type === 'GEOGCS') {
                geogcs = wkt;
            }
            if (geogcs) {
                if (geogcs.DATUM) {
                    wkt.datumCode = geogcs.DATUM.name.toLowerCase();
                } else {
                    wkt.datumCode = geogcs.name.toLowerCase();
                }
                if (wkt.datumCode.slice(0, 2) === 'd_') {
                    wkt.datumCode = wkt.datumCode.slice(2);
                }
                if (wkt.datumCode === 'new_zealand_geodetic_datum_1949' || wkt.datumCode === 'new_zealand_1949') {
                    wkt.datumCode = 'nzgd49';
                }
                if (wkt.datumCode === 'wgs_1984') {
                    if (wkt.PROJECTION === 'Mercator_Auxiliary_Sphere') {
                        wkt.sphere = true;
                    }
                    wkt.datumCode = 'wgs84';
                }
                if (wkt.datumCode.slice(-6) === '_ferro') {
                    wkt.datumCode = wkt.datumCode.slice(0, -6);
                }
                if (wkt.datumCode.slice(-8) === '_jakarta') {
                    wkt.datumCode = wkt.datumCode.slice(0, -8);
                }
                if (~wkt.datumCode.indexOf('belge')) {
                    wkt.datumCode = 'rnb72';
                }
                if (geogcs.DATUM && geogcs.DATUM.SPHEROID) {
                    wkt.ellps = geogcs.DATUM.SPHEROID.name.replace('_19', '').replace(/[Cc]larke\_18/, 'clrk');
                    if (wkt.ellps.toLowerCase().slice(0, 13) === 'international') {
                        wkt.ellps = 'intl';
                    }
                    wkt.a = geogcs.DATUM.SPHEROID.a;
                    wkt.rf = parseFloat(geogcs.DATUM.SPHEROID.rf, 10);
                }
                if (~wkt.datumCode.indexOf('osgb_1936')) {
                    wkt.datumCode = 'osgb36';
                }
                if (~wkt.datumCode.indexOf('osni_1952')) {
                    wkt.datumCode = 'osni52';
                }
                if (~wkt.datumCode.indexOf('tm65') || ~wkt.datumCode.indexOf('geodetic_datum_of_1965')) {
                    wkt.datumCode = 'ire65';
                }
            }
            if (wkt.b && !isFinite(wkt.b)) {
                wkt.b = wkt.a;
            }
            function toMeter(input) {
                var ratio = wkt.to_meter || 1;
                return input * ratio;
            }
            var renamer = function (a) {
                return rename(wkt, a);
            };
            var list = [
                [
                    'standard_parallel_1',
                    'Standard_Parallel_1'
                ],
                [
                    'standard_parallel_2',
                    'Standard_Parallel_2'
                ],
                [
                    'false_easting',
                    'False_Easting'
                ],
                [
                    'false_northing',
                    'False_Northing'
                ],
                [
                    'central_meridian',
                    'Central_Meridian'
                ],
                [
                    'latitude_of_origin',
                    'Latitude_Of_Origin'
                ],
                [
                    'latitude_of_origin',
                    'Central_Parallel'
                ],
                [
                    'scale_factor',
                    'Scale_Factor'
                ],
                [
                    'k0',
                    'scale_factor'
                ],
                [
                    'latitude_of_center',
                    'Latitude_of_center'
                ],
                [
                    'lat0',
                    'latitude_of_center',
                    d2r
                ],
                [
                    'longitude_of_center',
                    'Longitude_Of_Center'
                ],
                [
                    'longc',
                    'longitude_of_center',
                    d2r
                ],
                [
                    'x0',
                    'false_easting',
                    toMeter
                ],
                [
                    'y0',
                    'false_northing',
                    toMeter
                ],
                [
                    'long0',
                    'central_meridian',
                    d2r
                ],
                [
                    'lat0',
                    'latitude_of_origin',
                    d2r
                ],
                [
                    'lat0',
                    'standard_parallel_1',
                    d2r
                ],
                [
                    'lat1',
                    'standard_parallel_1',
                    d2r
                ],
                [
                    'lat2',
                    'standard_parallel_2',
                    d2r
                ],
                [
                    'alpha',
                    'azimuth',
                    d2r
                ],
                [
                    'srsCode',
                    'name'
                ]
            ];
            list.forEach(renamer);
            if (!wkt.long0 && wkt.longc && (wkt.projName === 'Albers_Conic_Equal_Area' || wkt.projName === 'Lambert_Azimuthal_Equal_Area')) {
                wkt.long0 = wkt.longc;
            }
            if (!wkt.lat_ts && wkt.lat1 && (wkt.projName === 'Stereographic_South_Pole' || wkt.projName === 'Polar Stereographic (variant B)')) {
                wkt.lat0 = d2r(wkt.lat1 > 0 ? 90 : -90);
                wkt.lat_ts = wkt.lat1;
            }
        }
        var wkt = function (wkt) {
            var lisp = parseString(wkt);
            var type = lisp.shift();
            var name = lisp.shift();
            lisp.unshift([
                'name',
                name
            ]);
            lisp.unshift([
                'type',
                type
            ]);
            var obj = {};
            sExpr(lisp, obj);
            cleanWKT(obj);
            return obj;
        };
        function defs(name) {
            var that = this;
            if (arguments.length === 2) {
                var def = arguments[1];
                if (typeof def === 'string') {
                    if (def.charAt(0) === '+') {
                        defs[name] = parseProj(arguments[1]);
                    } else {
                        defs[name] = wkt(arguments[1]);
                    }
                } else {
                    defs[name] = def;
                }
            } else if (arguments.length === 1) {
                if (Array.isArray(name)) {
                    return name.map(function (v) {
                        if (Array.isArray(v)) {
                            defs.apply(that, v);
                        } else {
                            defs(v);
                        }
                    });
                } else if (typeof name === 'string') {
                    if (name in defs) {
                        return defs[name];
                    }
                } else if ('EPSG' in name) {
                    defs['EPSG:' + name.EPSG] = name;
                } else if ('ESRI' in name) {
                    defs['ESRI:' + name.ESRI] = name;
                } else if ('IAU2000' in name) {
                    defs['IAU2000:' + name.IAU2000] = name;
                } else {
                    console.log(name);
                }
                return;
            }
        }
        globals(defs);
        function testObj(code) {
            return typeof code === 'string';
        }
        function testDef(code) {
            return code in defs;
        }
        var codeWords = [
            'PROJECTEDCRS',
            'PROJCRS',
            'GEOGCS',
            'GEOCCS',
            'PROJCS',
            'LOCAL_CS',
            'GEODCRS',
            'GEODETICCRS',
            'GEODETICDATUM',
            'ENGCRS',
            'ENGINEERINGCRS'
        ];
        function testWKT(code) {
            return codeWords.some(function (word) {
                return code.indexOf(word) > -1;
            });
        }
        function testProj(code) {
            return code[0] === '+';
        }
        function parse(code) {
            if (testObj(code)) {
                if (testDef(code)) {
                    return defs[code];
                }
                if (testWKT(code)) {
                    return wkt(code);
                }
                if (testProj(code)) {
                    return parseProj(code);
                }
            } else {
                return code;
            }
        }
        var extend = function (destination, source) {
            destination = destination || {};
            var value, property;
            if (!source) {
                return destination;
            }
            for (property in source) {
                value = source[property];
                if (value !== undefined) {
                    destination[property] = value;
                }
            }
            return destination;
        };
        var msfnz = function (eccent, sinphi, cosphi) {
            var con = eccent * sinphi;
            return cosphi / Math.sqrt(1 - con * con);
        };
        var sign = function (x) {
            return x < 0 ? -1 : 1;
        };
        var adjust_lon = function (x) {
            return Math.abs(x) <= SPI ? x : x - sign(x) * TWO_PI;
        };
        var tsfnz = function (eccent, phi, sinphi) {
            var con = eccent * sinphi;
            var com = 0.5 * eccent;
            con = Math.pow((1 - con) / (1 + con), com);
            return Math.tan(0.5 * (HALF_PI - phi)) / con;
        };
        var phi2z = function (eccent, ts) {
            var eccnth = 0.5 * eccent;
            var con, dphi;
            var phi = HALF_PI - 2 * Math.atan(ts);
            for (var i = 0; i <= 15; i++) {
                con = eccent * Math.sin(phi);
                dphi = HALF_PI - 2 * Math.atan(ts * Math.pow((1 - con) / (1 + con), eccnth)) - phi;
                phi += dphi;
                if (Math.abs(dphi) <= 1e-10) {
                    return phi;
                }
            }
            return -9999;
        };
        function init() {
            var con = this.b / this.a;
            this.es = 1 - con * con;
            if (!('x0' in this)) {
                this.x0 = 0;
            }
            if (!('y0' in this)) {
                this.y0 = 0;
            }
            this.e = Math.sqrt(this.es);
            if (this.lat_ts) {
                if (this.sphere) {
                    this.k0 = Math.cos(this.lat_ts);
                } else {
                    this.k0 = msfnz(this.e, Math.sin(this.lat_ts), Math.cos(this.lat_ts));
                }
            } else {
                if (!this.k0) {
                    if (this.k) {
                        this.k0 = this.k;
                    } else {
                        this.k0 = 1;
                    }
                }
            }
        }
        function forward(p) {
            var lon = p.x;
            var lat = p.y;
            if (lat * R2D > 90 && lat * R2D < -90 && lon * R2D > 180 && lon * R2D < -180) {
                return null;
            }
            var x, y;
            if (Math.abs(Math.abs(lat) - HALF_PI) <= EPSLN) {
                return null;
            } else {
                if (this.sphere) {
                    x = this.x0 + this.a * this.k0 * adjust_lon(lon - this.long0);
                    y = this.y0 + this.a * this.k0 * Math.log(Math.tan(FORTPI + 0.5 * lat));
                } else {
                    var sinphi = Math.sin(lat);
                    var ts = tsfnz(this.e, lat, sinphi);
                    x = this.x0 + this.a * this.k0 * adjust_lon(lon - this.long0);
                    y = this.y0 - this.a * this.k0 * Math.log(ts);
                }
                p.x = x;
                p.y = y;
                return p;
            }
        }
        function inverse(p) {
            var x = p.x - this.x0;
            var y = p.y - this.y0;
            var lon, lat;
            if (this.sphere) {
                lat = HALF_PI - 2 * Math.atan(Math.exp(-y / (this.a * this.k0)));
            } else {
                var ts = Math.exp(-y / (this.a * this.k0));
                lat = phi2z(this.e, ts);
                if (lat === -9999) {
                    return null;
                }
            }
            lon = adjust_lon(this.long0 + x / (this.a * this.k0));
            p.x = lon;
            p.y = lat;
            return p;
        }
        var names$1 = [
            'Mercator',
            'Popular Visualisation Pseudo Mercator',
            'Mercator_1SP',
            'Mercator_Auxiliary_Sphere',
            'merc'
        ];
        var merc = {
            init: init,
            forward: forward,
            inverse: inverse,
            names: names$1
        };
        function init$1() {
        }
        function identity(pt) {
            return pt;
        }
        var names$2 = [
            'longlat',
            'identity'
        ];
        var longlat = {
            init: init$1,
            forward: identity,
            inverse: identity,
            names: names$2
        };
        var projs = [
            merc,
            longlat
        ];
        var names$$1 = {};
        var projStore = [];
        function add(proj, i) {
            var len = projStore.length;
            if (!proj.names) {
                console.log(i);
                return true;
            }
            projStore[len] = proj;
            proj.names.forEach(function (n) {
                names$$1[n.toLowerCase()] = len;
            });
            return this;
        }
        function get(name) {
            if (!name) {
                return false;
            }
            var n = name.toLowerCase();
            if (typeof names$$1[n] !== 'undefined' && projStore[names$$1[n]]) {
                return projStore[names$$1[n]];
            }
        }
        function start() {
            projs.forEach(add);
        }
        var projections = {
            start: start,
            add: add,
            get: get
        };
        var exports$2 = {};
        exports$2.MERIT = {
            a: 6378137,
            rf: 298.257,
            ellipseName: 'MERIT 1983'
        };
        exports$2.SGS85 = {
            a: 6378136,
            rf: 298.257,
            ellipseName: 'Soviet Geodetic System 85'
        };
        exports$2.GRS80 = {
            a: 6378137,
            rf: 298.257222101,
            ellipseName: 'GRS 1980(IUGG, 1980)'
        };
        exports$2.IAU76 = {
            a: 6378140,
            rf: 298.257,
            ellipseName: 'IAU 1976'
        };
        exports$2.airy = {
            a: 6377563.396,
            b: 6356256.91,
            ellipseName: 'Airy 1830'
        };
        exports$2.APL4 = {
            a: 6378137,
            rf: 298.25,
            ellipseName: 'Appl. Physics. 1965'
        };
        exports$2.NWL9D = {
            a: 6378145,
            rf: 298.25,
            ellipseName: 'Naval Weapons Lab., 1965'
        };
        exports$2.mod_airy = {
            a: 6377340.189,
            b: 6356034.446,
            ellipseName: 'Modified Airy'
        };
        exports$2.andrae = {
            a: 6377104.43,
            rf: 300,
            ellipseName: 'Andrae 1876 (Den., Iclnd.)'
        };
        exports$2.aust_SA = {
            a: 6378160,
            rf: 298.25,
            ellipseName: 'Australian Natl & S. Amer. 1969'
        };
        exports$2.GRS67 = {
            a: 6378160,
            rf: 298.247167427,
            ellipseName: 'GRS 67(IUGG 1967)'
        };
        exports$2.bessel = {
            a: 6377397.155,
            rf: 299.1528128,
            ellipseName: 'Bessel 1841'
        };
        exports$2.bess_nam = {
            a: 6377483.865,
            rf: 299.1528128,
            ellipseName: 'Bessel 1841 (Namibia)'
        };
        exports$2.clrk66 = {
            a: 6378206.4,
            b: 6356583.8,
            ellipseName: 'Clarke 1866'
        };
        exports$2.clrk80 = {
            a: 6378249.145,
            rf: 293.4663,
            ellipseName: 'Clarke 1880 mod.'
        };
        exports$2.clrk58 = {
            a: 6378293.645208759,
            rf: 294.2606763692654,
            ellipseName: 'Clarke 1858'
        };
        exports$2.CPM = {
            a: 6375738.7,
            rf: 334.29,
            ellipseName: 'Comm. des Poids et Mesures 1799'
        };
        exports$2.delmbr = {
            a: 6376428,
            rf: 311.5,
            ellipseName: 'Delambre 1810 (Belgium)'
        };
        exports$2.engelis = {
            a: 6378136.05,
            rf: 298.2566,
            ellipseName: 'Engelis 1985'
        };
        exports$2.evrst30 = {
            a: 6377276.345,
            rf: 300.8017,
            ellipseName: 'Everest 1830'
        };
        exports$2.evrst48 = {
            a: 6377304.063,
            rf: 300.8017,
            ellipseName: 'Everest 1948'
        };
        exports$2.evrst56 = {
            a: 6377301.243,
            rf: 300.8017,
            ellipseName: 'Everest 1956'
        };
        exports$2.evrst69 = {
            a: 6377295.664,
            rf: 300.8017,
            ellipseName: 'Everest 1969'
        };
        exports$2.evrstSS = {
            a: 6377298.556,
            rf: 300.8017,
            ellipseName: 'Everest (Sabah & Sarawak)'
        };
        exports$2.fschr60 = {
            a: 6378166,
            rf: 298.3,
            ellipseName: 'Fischer (Mercury Datum) 1960'
        };
        exports$2.fschr60m = {
            a: 6378155,
            rf: 298.3,
            ellipseName: 'Fischer 1960'
        };
        exports$2.fschr68 = {
            a: 6378150,
            rf: 298.3,
            ellipseName: 'Fischer 1968'
        };
        exports$2.helmert = {
            a: 6378200,
            rf: 298.3,
            ellipseName: 'Helmert 1906'
        };
        exports$2.hough = {
            a: 6378270,
            rf: 297,
            ellipseName: 'Hough'
        };
        exports$2.intl = {
            a: 6378388,
            rf: 297,
            ellipseName: 'International 1909 (Hayford)'
        };
        exports$2.kaula = {
            a: 6378163,
            rf: 298.24,
            ellipseName: 'Kaula 1961'
        };
        exports$2.lerch = {
            a: 6378139,
            rf: 298.257,
            ellipseName: 'Lerch 1979'
        };
        exports$2.mprts = {
            a: 6397300,
            rf: 191,
            ellipseName: 'Maupertius 1738'
        };
        exports$2.new_intl = {
            a: 6378157.5,
            b: 6356772.2,
            ellipseName: 'New International 1967'
        };
        exports$2.plessis = {
            a: 6376523,
            rf: 6355863,
            ellipseName: 'Plessis 1817 (France)'
        };
        exports$2.krass = {
            a: 6378245,
            rf: 298.3,
            ellipseName: 'Krassovsky, 1942'
        };
        exports$2.SEasia = {
            a: 6378155,
            b: 6356773.3205,
            ellipseName: 'Southeast Asia'
        };
        exports$2.walbeck = {
            a: 6376896,
            b: 6355834.8467,
            ellipseName: 'Walbeck'
        };
        exports$2.WGS60 = {
            a: 6378165,
            rf: 298.3,
            ellipseName: 'WGS 60'
        };
        exports$2.WGS66 = {
            a: 6378145,
            rf: 298.25,
            ellipseName: 'WGS 66'
        };
        exports$2.WGS7 = {
            a: 6378135,
            rf: 298.26,
            ellipseName: 'WGS 72'
        };
        var WGS84 = exports$2.WGS84 = {
            a: 6378137,
            rf: 298.257223563,
            ellipseName: 'WGS 84'
        };
        exports$2.sphere = {
            a: 6370997,
            b: 6370997,
            ellipseName: 'Normal Sphere (r=6370997)'
        };
        function eccentricity(a, b, rf, R_A) {
            var a2 = a * a;
            var b2 = b * b;
            var es = (a2 - b2) / a2;
            var e = 0;
            if (R_A) {
                a *= 1 - es * (SIXTH + es * (RA4 + es * RA6));
                a2 = a * a;
                es = 0;
            } else {
                e = Math.sqrt(es);
            }
            var ep2 = (a2 - b2) / b2;
            return {
                es: es,
                e: e,
                ep2: ep2
            };
        }
        function sphere(a, b, rf, ellps, sphere) {
            if (!a) {
                var ellipse = match(exports$2, ellps);
                if (!ellipse) {
                    ellipse = WGS84;
                }
                a = ellipse.a;
                b = ellipse.b;
                rf = ellipse.rf;
            }
            if (rf && !b) {
                b = (1 - 1 / rf) * a;
            }
            if (rf === 0 || Math.abs(a - b) < EPSLN) {
                sphere = true;
                b = a;
            }
            return {
                a: a,
                b: b,
                rf: rf,
                sphere: sphere
            };
        }
        var exports$3 = {};
        exports$3.wgs84 = {
            towgs84: '0,0,0',
            ellipse: 'WGS84',
            datumName: 'WGS84'
        };
        exports$3.ch1903 = {
            towgs84: '674.374,15.056,405.346',
            ellipse: 'bessel',
            datumName: 'swiss'
        };
        exports$3.ggrs87 = {
            towgs84: '-199.87,74.79,246.62',
            ellipse: 'GRS80',
            datumName: 'Greek_Geodetic_Reference_System_1987'
        };
        exports$3.nad83 = {
            towgs84: '0,0,0',
            ellipse: 'GRS80',
            datumName: 'North_American_Datum_1983'
        };
        exports$3.nad27 = {
            nadgrids: '@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat',
            ellipse: 'clrk66',
            datumName: 'North_American_Datum_1927'
        };
        exports$3.potsdam = {
            towgs84: '606.0,23.0,413.0',
            ellipse: 'bessel',
            datumName: 'Potsdam Rauenberg 1950 DHDN'
        };
        exports$3.carthage = {
            towgs84: '-263.0,6.0,431.0',
            ellipse: 'clark80',
            datumName: 'Carthage 1934 Tunisia'
        };
        exports$3.hermannskogel = {
            towgs84: '653.0,-212.0,449.0',
            ellipse: 'bessel',
            datumName: 'Hermannskogel'
        };
        exports$3.osni52 = {
            towgs84: '482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15',
            ellipse: 'airy',
            datumName: 'Irish National'
        };
        exports$3.ire65 = {
            towgs84: '482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15',
            ellipse: 'mod_airy',
            datumName: 'Ireland 1965'
        };
        exports$3.rassadiran = {
            towgs84: '-133.63,-157.5,-158.62',
            ellipse: 'intl',
            datumName: 'Rassadiran'
        };
        exports$3.nzgd49 = {
            towgs84: '59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993',
            ellipse: 'intl',
            datumName: 'New Zealand Geodetic Datum 1949'
        };
        exports$3.osgb36 = {
            towgs84: '446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894',
            ellipse: 'airy',
            datumName: 'Airy 1830'
        };
        exports$3.s_jtsk = {
            towgs84: '589,76,480',
            ellipse: 'bessel',
            datumName: 'S-JTSK (Ferro)'
        };
        exports$3.beduaram = {
            towgs84: '-106,-87,188',
            ellipse: 'clrk80',
            datumName: 'Beduaram'
        };
        exports$3.gunung_segara = {
            towgs84: '-403,684,41',
            ellipse: 'bessel',
            datumName: 'Gunung Segara Jakarta'
        };
        exports$3.rnb72 = {
            towgs84: '106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1',
            ellipse: 'intl',
            datumName: 'Reseau National Belge 1972'
        };
        function datum(datumCode, datum_params, a, b, es, ep2) {
            var out = {};
            if (datumCode === undefined || datumCode === 'none') {
                out.datum_type = PJD_NODATUM;
            } else {
                out.datum_type = PJD_WGS84;
            }
            if (datum_params) {
                out.datum_params = datum_params.map(parseFloat);
                if (out.datum_params[0] !== 0 || out.datum_params[1] !== 0 || out.datum_params[2] !== 0) {
                    out.datum_type = PJD_3PARAM;
                }
                if (out.datum_params.length > 3) {
                    if (out.datum_params[3] !== 0 || out.datum_params[4] !== 0 || out.datum_params[5] !== 0 || out.datum_params[6] !== 0) {
                        out.datum_type = PJD_7PARAM;
                        out.datum_params[3] *= SEC_TO_RAD;
                        out.datum_params[4] *= SEC_TO_RAD;
                        out.datum_params[5] *= SEC_TO_RAD;
                        out.datum_params[6] = out.datum_params[6] / 1000000 + 1;
                    }
                }
            }
            out.a = a;
            out.b = b;
            out.es = es;
            out.ep2 = ep2;
            return out;
        }
        function Projection$1(srsCode, callback) {
            if (!(this instanceof Projection$1)) {
                return new Projection$1(srsCode);
            }
            callback = callback || function (error) {
                if (error) {
                    throw error;
                }
            };
            var json = parse(srsCode);
            if (typeof json !== 'object') {
                callback(srsCode);
                return;
            }
            var ourProj = Projection$1.projections.get(json.projName);
            if (!ourProj) {
                callback(srsCode);
                return;
            }
            if (json.datumCode && json.datumCode !== 'none') {
                var datumDef = match(exports$3, json.datumCode);
                if (datumDef) {
                    json.datum_params = datumDef.towgs84 ? datumDef.towgs84.split(',') : null;
                    json.ellps = datumDef.ellipse;
                    json.datumName = datumDef.datumName ? datumDef.datumName : json.datumCode;
                }
            }
            json.k0 = json.k0 || 1;
            json.axis = json.axis || 'enu';
            json.ellps = json.ellps || 'wgs84';
            var sphere_ = sphere(json.a, json.b, json.rf, json.ellps, json.sphere);
            var ecc = eccentricity(sphere_.a, sphere_.b, sphere_.rf, json.R_A);
            var datumObj = json.datum || datum(json.datumCode, json.datum_params, sphere_.a, sphere_.b, ecc.es, ecc.ep2);
            extend(this, json);
            extend(this, ourProj);
            this.a = sphere_.a;
            this.b = sphere_.b;
            this.rf = sphere_.rf;
            this.sphere = sphere_.sphere;
            this.es = ecc.es;
            this.e = ecc.e;
            this.ep2 = ecc.ep2;
            this.datum = datumObj;
            this.init();
            callback(null, this);
        }
        Projection$1.projections = projections;
        Projection$1.projections.start();
        function compareDatums(source, dest) {
            if (source.datum_type !== dest.datum_type) {
                return false;
            } else if (source.a !== dest.a || Math.abs(source.es - dest.es) > 5e-11) {
                return false;
            } else if (source.datum_type === PJD_3PARAM) {
                return source.datum_params[0] === dest.datum_params[0] && source.datum_params[1] === dest.datum_params[1] && source.datum_params[2] === dest.datum_params[2];
            } else if (source.datum_type === PJD_7PARAM) {
                return source.datum_params[0] === dest.datum_params[0] && source.datum_params[1] === dest.datum_params[1] && source.datum_params[2] === dest.datum_params[2] && source.datum_params[3] === dest.datum_params[3] && source.datum_params[4] === dest.datum_params[4] && source.datum_params[5] === dest.datum_params[5] && source.datum_params[6] === dest.datum_params[6];
            } else {
                return true;
            }
        }
        function geodeticToGeocentric(p, es, a) {
            var Longitude = p.x;
            var Latitude = p.y;
            var Height = p.z ? p.z : 0;
            var Rn;
            var Sin_Lat;
            var Sin2_Lat;
            var Cos_Lat;
            if (Latitude < -HALF_PI && Latitude > -1.001 * HALF_PI) {
                Latitude = -HALF_PI;
            } else if (Latitude > HALF_PI && Latitude < 1.001 * HALF_PI) {
                Latitude = HALF_PI;
            } else if (Latitude < -HALF_PI || Latitude > HALF_PI) {
                return null;
            }
            if (Longitude > Math.PI) {
                Longitude -= 2 * Math.PI;
            }
            Sin_Lat = Math.sin(Latitude);
            Cos_Lat = Math.cos(Latitude);
            Sin2_Lat = Sin_Lat * Sin_Lat;
            Rn = a / Math.sqrt(1 - es * Sin2_Lat);
            return {
                x: (Rn + Height) * Cos_Lat * Math.cos(Longitude),
                y: (Rn + Height) * Cos_Lat * Math.sin(Longitude),
                z: (Rn * (1 - es) + Height) * Sin_Lat
            };
        }
        function geocentricToGeodetic(p, es, a, b) {
            var genau = 1e-12;
            var genau2 = genau * genau;
            var maxiter = 30;
            var P;
            var RR;
            var CT;
            var ST;
            var RX;
            var RK;
            var RN;
            var CPHI0;
            var SPHI0;
            var CPHI;
            var SPHI;
            var SDPHI;
            var iter;
            var X = p.x;
            var Y = p.y;
            var Z = p.z ? p.z : 0;
            var Longitude;
            var Latitude;
            var Height;
            P = Math.sqrt(X * X + Y * Y);
            RR = Math.sqrt(X * X + Y * Y + Z * Z);
            if (P / a < genau) {
                Longitude = 0;
                if (RR / a < genau) {
                    Latitude = HALF_PI;
                    Height = -b;
                    return {
                        x: p.x,
                        y: p.y,
                        z: p.z
                    };
                }
            } else {
                Longitude = Math.atan2(Y, X);
            }
            CT = Z / RR;
            ST = P / RR;
            RX = 1 / Math.sqrt(1 - es * (2 - es) * ST * ST);
            CPHI0 = ST * (1 - es) * RX;
            SPHI0 = CT * RX;
            iter = 0;
            do {
                iter++;
                RN = a / Math.sqrt(1 - es * SPHI0 * SPHI0);
                Height = P * CPHI0 + Z * SPHI0 - RN * (1 - es * SPHI0 * SPHI0);
                RK = es * RN / (RN + Height);
                RX = 1 / Math.sqrt(1 - RK * (2 - RK) * ST * ST);
                CPHI = ST * (1 - RK) * RX;
                SPHI = CT * RX;
                SDPHI = SPHI * CPHI0 - CPHI * SPHI0;
                CPHI0 = CPHI;
                SPHI0 = SPHI;
            } while (SDPHI * SDPHI > genau2 && iter < maxiter);
            Latitude = Math.atan(SPHI / Math.abs(CPHI));
            return {
                x: Longitude,
                y: Latitude,
                z: Height
            };
        }
        function geocentricToWgs84(p, datum_type, datum_params) {
            if (datum_type === PJD_3PARAM) {
                return {
                    x: p.x + datum_params[0],
                    y: p.y + datum_params[1],
                    z: p.z + datum_params[2]
                };
            } else if (datum_type === PJD_7PARAM) {
                var Dx_BF = datum_params[0];
                var Dy_BF = datum_params[1];
                var Dz_BF = datum_params[2];
                var Rx_BF = datum_params[3];
                var Ry_BF = datum_params[4];
                var Rz_BF = datum_params[5];
                var M_BF = datum_params[6];
                return {
                    x: M_BF * (p.x - Rz_BF * p.y + Ry_BF * p.z) + Dx_BF,
                    y: M_BF * (Rz_BF * p.x + p.y - Rx_BF * p.z) + Dy_BF,
                    z: M_BF * (-Ry_BF * p.x + Rx_BF * p.y + p.z) + Dz_BF
                };
            }
        }
        function geocentricFromWgs84(p, datum_type, datum_params) {
            if (datum_type === PJD_3PARAM) {
                return {
                    x: p.x - datum_params[0],
                    y: p.y - datum_params[1],
                    z: p.z - datum_params[2]
                };
            } else if (datum_type === PJD_7PARAM) {
                var Dx_BF = datum_params[0];
                var Dy_BF = datum_params[1];
                var Dz_BF = datum_params[2];
                var Rx_BF = datum_params[3];
                var Ry_BF = datum_params[4];
                var Rz_BF = datum_params[5];
                var M_BF = datum_params[6];
                var x_tmp = (p.x - Dx_BF) / M_BF;
                var y_tmp = (p.y - Dy_BF) / M_BF;
                var z_tmp = (p.z - Dz_BF) / M_BF;
                return {
                    x: x_tmp + Rz_BF * y_tmp - Ry_BF * z_tmp,
                    y: -Rz_BF * x_tmp + y_tmp + Rx_BF * z_tmp,
                    z: Ry_BF * x_tmp - Rx_BF * y_tmp + z_tmp
                };
            }
        }
        function checkParams(type) {
            return type === PJD_3PARAM || type === PJD_7PARAM;
        }
        var datum_transform = function (source, dest, point) {
            if (compareDatums(source, dest)) {
                return point;
            }
            if (source.datum_type === PJD_NODATUM || dest.datum_type === PJD_NODATUM) {
                return point;
            }
            if (source.es === dest.es && source.a === dest.a && !checkParams(source.datum_type) && !checkParams(dest.datum_type)) {
                return point;
            }
            point = geodeticToGeocentric(point, source.es, source.a);
            if (checkParams(source.datum_type)) {
                point = geocentricToWgs84(point, source.datum_type, source.datum_params);
            }
            if (checkParams(dest.datum_type)) {
                point = geocentricFromWgs84(point, dest.datum_type, dest.datum_params);
            }
            return geocentricToGeodetic(point, dest.es, dest.a, dest.b);
        };
        var adjust_axis = function (crs, denorm, point) {
            var xin = point.x, yin = point.y, zin = point.z || 0;
            var v, t, i;
            var out = {};
            for (i = 0; i < 3; i++) {
                if (denorm && i === 2 && point.z === undefined) {
                    continue;
                }
                if (i === 0) {
                    v = xin;
                    t = 'x';
                } else if (i === 1) {
                    v = yin;
                    t = 'y';
                } else {
                    v = zin;
                    t = 'z';
                }
                switch (crs.axis[i]) {
                case 'e':
                    out[t] = v;
                    break;
                case 'w':
                    out[t] = -v;
                    break;
                case 'n':
                    out[t] = v;
                    break;
                case 's':
                    out[t] = -v;
                    break;
                case 'u':
                    if (point[t] !== undefined) {
                        out.z = v;
                    }
                    break;
                case 'd':
                    if (point[t] !== undefined) {
                        out.z = -v;
                    }
                    break;
                default:
                    return null;
                }
            }
            return out;
        };
        var toPoint = function (array) {
            var out = {
                x: array[0],
                y: array[1]
            };
            if (array.length > 2) {
                out.z = array[2];
            }
            if (array.length > 3) {
                out.m = array[3];
            }
            return out;
        };
        var checkSanity = function (point) {
            checkCoord(point.x);
            checkCoord(point.y);
        };
        function checkCoord(num) {
            if (typeof Number.isFinite === 'function') {
                if (Number.isFinite(num)) {
                    return;
                }
                throw new TypeError('coordinates must be finite numbers');
            }
            if (typeof num !== 'number' || num !== num || !isFinite(num)) {
                throw new TypeError('coordinates must be finite numbers');
            }
        }
        function checkNotWGS(source, dest) {
            return (source.datum.datum_type === PJD_3PARAM || source.datum.datum_type === PJD_7PARAM) && dest.datumCode !== 'WGS84' || (dest.datum.datum_type === PJD_3PARAM || dest.datum.datum_type === PJD_7PARAM) && source.datumCode !== 'WGS84';
        }
        function transform(source, dest, point) {
            var wgs84;
            if (Array.isArray(point)) {
                point = toPoint(point);
            }
            checkSanity(point);
            if (source.datum && dest.datum && checkNotWGS(source, dest)) {
                wgs84 = new Projection$1('WGS84');
                point = transform(source, wgs84, point);
                source = wgs84;
            }
            if (source.axis !== 'enu') {
                point = adjust_axis(source, false, point);
            }
            if (source.projName === 'longlat') {
                point = {
                    x: point.x * D2R,
                    y: point.y * D2R
                };
            } else {
                if (source.to_meter) {
                    point = {
                        x: point.x * source.to_meter,
                        y: point.y * source.to_meter
                    };
                }
                point = source.inverse(point);
            }
            if (source.from_greenwich) {
                point.x += source.from_greenwich;
            }
            point = datum_transform(source.datum, dest.datum, point);
            if (dest.from_greenwich) {
                point = {
                    x: point.x - dest.from_greenwich,
                    y: point.y
                };
            }
            if (dest.projName === 'longlat') {
                point = {
                    x: point.x * R2D,
                    y: point.y * R2D
                };
            } else {
                point = dest.forward(point);
                if (dest.to_meter) {
                    point = {
                        x: point.x / dest.to_meter,
                        y: point.y / dest.to_meter
                    };
                }
            }
            if (dest.axis !== 'enu') {
                return adjust_axis(dest, true, point);
            }
            return point;
        }
        var wgs84 = Projection$1('WGS84');
        function transformer(from, to, coords) {
            var transformedArray, out, keys;
            if (Array.isArray(coords)) {
                transformedArray = transform(from, to, coords);
                if (coords.length === 3) {
                    return [
                        transformedArray.x,
                        transformedArray.y,
                        transformedArray.z
                    ];
                } else {
                    return [
                        transformedArray.x,
                        transformedArray.y
                    ];
                }
            } else {
                out = transform(from, to, coords);
                keys = Object.keys(coords);
                if (keys.length === 2) {
                    return out;
                }
                keys.forEach(function (key) {
                    if (key === 'x' || key === 'y') {
                        return;
                    }
                    out[key] = coords[key];
                });
                return out;
            }
        }
        function checkProj(item) {
            if (item instanceof Projection$1) {
                return item;
            }
            if (item.oProj) {
                return item.oProj;
            }
            return Projection$1(item);
        }
        function proj4$1(fromProj, toProj, coord) {
            fromProj = checkProj(fromProj);
            var single = false;
            var obj;
            if (typeof toProj === 'undefined') {
                toProj = fromProj;
                fromProj = wgs84;
                single = true;
            } else if (typeof toProj.x !== 'undefined' || Array.isArray(toProj)) {
                coord = toProj;
                toProj = fromProj;
                fromProj = wgs84;
                single = true;
            }
            toProj = checkProj(toProj);
            if (coord) {
                return transformer(fromProj, toProj, coord);
            } else {
                obj = {
                    forward: function (coords) {
                        return transformer(fromProj, toProj, coords);
                    },
                    inverse: function (coords) {
                        return transformer(toProj, fromProj, coords);
                    }
                };
                if (single) {
                    obj.oProj = toProj;
                }
                return obj;
            }
        }
        var NUM_100K_SETS = 6;
        var SET_ORIGIN_COLUMN_LETTERS = 'AJSAJS';
        var SET_ORIGIN_ROW_LETTERS = 'AFAFAF';
        var A = 65;
        var I = 73;
        var O = 79;
        var V = 86;
        var Z = 90;
        var mgrs = {
            forward: forward$1,
            inverse: inverse$1,
            toPoint: toPoint$1
        };
        function forward$1(ll, accuracy) {
            accuracy = accuracy || 5;
            return encode(LLtoUTM({
                lat: ll[1],
                lon: ll[0]
            }), accuracy);
        }
        function inverse$1(mgrs) {
            var bbox = UTMtoLL(decode(mgrs.toUpperCase()));
            if (bbox.lat && bbox.lon) {
                return [
                    bbox.lon,
                    bbox.lat,
                    bbox.lon,
                    bbox.lat
                ];
            }
            return [
                bbox.left,
                bbox.bottom,
                bbox.right,
                bbox.top
            ];
        }
        function toPoint$1(mgrs) {
            var bbox = UTMtoLL(decode(mgrs.toUpperCase()));
            if (bbox.lat && bbox.lon) {
                return [
                    bbox.lon,
                    bbox.lat
                ];
            }
            return [
                (bbox.left + bbox.right) / 2,
                (bbox.top + bbox.bottom) / 2
            ];
        }
        function degToRad(deg) {
            return deg * (Math.PI / 180);
        }
        function radToDeg(rad) {
            return 180 * (rad / Math.PI);
        }
        function LLtoUTM(ll) {
            var Lat = ll.lat;
            var Long = ll.lon;
            var a = 6378137;
            var eccSquared = 0.00669438;
            var k0 = 0.9996;
            var LongOrigin;
            var eccPrimeSquared;
            var N, T, C, A, M;
            var LatRad = degToRad(Lat);
            var LongRad = degToRad(Long);
            var LongOriginRad;
            var ZoneNumber;
            ZoneNumber = Math.floor((Long + 180) / 6) + 1;
            if (Long === 180) {
                ZoneNumber = 60;
            }
            if (Lat >= 56 && Lat < 64 && Long >= 3 && Long < 12) {
                ZoneNumber = 32;
            }
            if (Lat >= 72 && Lat < 84) {
                if (Long >= 0 && Long < 9) {
                    ZoneNumber = 31;
                } else if (Long >= 9 && Long < 21) {
                    ZoneNumber = 33;
                } else if (Long >= 21 && Long < 33) {
                    ZoneNumber = 35;
                } else if (Long >= 33 && Long < 42) {
                    ZoneNumber = 37;
                }
            }
            LongOrigin = (ZoneNumber - 1) * 6 - 180 + 3;
            LongOriginRad = degToRad(LongOrigin);
            eccPrimeSquared = eccSquared / (1 - eccSquared);
            N = a / Math.sqrt(1 - eccSquared * Math.sin(LatRad) * Math.sin(LatRad));
            T = Math.tan(LatRad) * Math.tan(LatRad);
            C = eccPrimeSquared * Math.cos(LatRad) * Math.cos(LatRad);
            A = Math.cos(LatRad) * (LongRad - LongOriginRad);
            M = a * ((1 - eccSquared / 4 - 3 * eccSquared * eccSquared / 64 - 5 * eccSquared * eccSquared * eccSquared / 256) * LatRad - (3 * eccSquared / 8 + 3 * eccSquared * eccSquared / 32 + 45 * eccSquared * eccSquared * eccSquared / 1024) * Math.sin(2 * LatRad) + (15 * eccSquared * eccSquared / 256 + 45 * eccSquared * eccSquared * eccSquared / 1024) * Math.sin(4 * LatRad) - 35 * eccSquared * eccSquared * eccSquared / 3072 * Math.sin(6 * LatRad));
            var UTMEasting = k0 * N * (A + (1 - T + C) * A * A * A / 6 + (5 - 18 * T + T * T + 72 * C - 58 * eccPrimeSquared) * A * A * A * A * A / 120) + 500000;
            var UTMNorthing = k0 * (M + N * Math.tan(LatRad) * (A * A / 2 + (5 - T + 9 * C + 4 * C * C) * A * A * A * A / 24 + (61 - 58 * T + T * T + 600 * C - 330 * eccPrimeSquared) * A * A * A * A * A * A / 720));
            if (Lat < 0) {
                UTMNorthing += 10000000;
            }
            return {
                northing: Math.round(UTMNorthing),
                easting: Math.round(UTMEasting),
                zoneNumber: ZoneNumber,
                zoneLetter: getLetterDesignator(Lat)
            };
        }
        function UTMtoLL(utm) {
            var UTMNorthing = utm.northing;
            var UTMEasting = utm.easting;
            var zoneLetter = utm.zoneLetter;
            var zoneNumber = utm.zoneNumber;
            if (zoneNumber < 0 || zoneNumber > 60) {
                return null;
            }
            var k0 = 0.9996;
            var a = 6378137;
            var eccSquared = 0.00669438;
            var eccPrimeSquared;
            var e1 = (1 - Math.sqrt(1 - eccSquared)) / (1 + Math.sqrt(1 - eccSquared));
            var N1, T1, C1, R1, D, M;
            var LongOrigin;
            var mu, phi1Rad;
            var x = UTMEasting - 500000;
            var y = UTMNorthing;
            if (zoneLetter < 'N') {
                y -= 10000000;
            }
            LongOrigin = (zoneNumber - 1) * 6 - 180 + 3;
            eccPrimeSquared = eccSquared / (1 - eccSquared);
            M = y / k0;
            mu = M / (a * (1 - eccSquared / 4 - 3 * eccSquared * eccSquared / 64 - 5 * eccSquared * eccSquared * eccSquared / 256));
            phi1Rad = mu + (3 * e1 / 2 - 27 * e1 * e1 * e1 / 32) * Math.sin(2 * mu) + (21 * e1 * e1 / 16 - 55 * e1 * e1 * e1 * e1 / 32) * Math.sin(4 * mu) + 151 * e1 * e1 * e1 / 96 * Math.sin(6 * mu);
            N1 = a / Math.sqrt(1 - eccSquared * Math.sin(phi1Rad) * Math.sin(phi1Rad));
            T1 = Math.tan(phi1Rad) * Math.tan(phi1Rad);
            C1 = eccPrimeSquared * Math.cos(phi1Rad) * Math.cos(phi1Rad);
            R1 = a * (1 - eccSquared) / Math.pow(1 - eccSquared * Math.sin(phi1Rad) * Math.sin(phi1Rad), 1.5);
            D = x / (N1 * k0);
            var lat = phi1Rad - N1 * Math.tan(phi1Rad) / R1 * (D * D / 2 - (5 + 3 * T1 + 10 * C1 - 4 * C1 * C1 - 9 * eccPrimeSquared) * D * D * D * D / 24 + (61 + 90 * T1 + 298 * C1 + 45 * T1 * T1 - 252 * eccPrimeSquared - 3 * C1 * C1) * D * D * D * D * D * D / 720);
            lat = radToDeg(lat);
            var lon = (D - (1 + 2 * T1 + C1) * D * D * D / 6 + (5 - 2 * C1 + 28 * T1 - 3 * C1 * C1 + 8 * eccPrimeSquared + 24 * T1 * T1) * D * D * D * D * D / 120) / Math.cos(phi1Rad);
            lon = LongOrigin + radToDeg(lon);
            var result;
            if (utm.accuracy) {
                var topRight = UTMtoLL({
                    northing: utm.northing + utm.accuracy,
                    easting: utm.easting + utm.accuracy,
                    zoneLetter: utm.zoneLetter,
                    zoneNumber: utm.zoneNumber
                });
                result = {
                    top: topRight.lat,
                    right: topRight.lon,
                    bottom: lat,
                    left: lon
                };
            } else {
                result = {
                    lat: lat,
                    lon: lon
                };
            }
            return result;
        }
        function getLetterDesignator(lat) {
            var LetterDesignator = 'Z';
            if (84 >= lat && lat >= 72) {
                LetterDesignator = 'X';
            } else if (72 > lat && lat >= 64) {
                LetterDesignator = 'W';
            } else if (64 > lat && lat >= 56) {
                LetterDesignator = 'V';
            } else if (56 > lat && lat >= 48) {
                LetterDesignator = 'U';
            } else if (48 > lat && lat >= 40) {
                LetterDesignator = 'T';
            } else if (40 > lat && lat >= 32) {
                LetterDesignator = 'S';
            } else if (32 > lat && lat >= 24) {
                LetterDesignator = 'R';
            } else if (24 > lat && lat >= 16) {
                LetterDesignator = 'Q';
            } else if (16 > lat && lat >= 8) {
                LetterDesignator = 'P';
            } else if (8 > lat && lat >= 0) {
                LetterDesignator = 'N';
            } else if (0 > lat && lat >= -8) {
                LetterDesignator = 'M';
            } else if (-8 > lat && lat >= -16) {
                LetterDesignator = 'L';
            } else if (-16 > lat && lat >= -24) {
                LetterDesignator = 'K';
            } else if (-24 > lat && lat >= -32) {
                LetterDesignator = 'J';
            } else if (-32 > lat && lat >= -40) {
                LetterDesignator = 'H';
            } else if (-40 > lat && lat >= -48) {
                LetterDesignator = 'G';
            } else if (-48 > lat && lat >= -56) {
                LetterDesignator = 'F';
            } else if (-56 > lat && lat >= -64) {
                LetterDesignator = 'E';
            } else if (-64 > lat && lat >= -72) {
                LetterDesignator = 'D';
            } else if (-72 > lat && lat >= -80) {
                LetterDesignator = 'C';
            }
            return LetterDesignator;
        }
        function encode(utm, accuracy) {
            var seasting = '00000' + utm.easting, snorthing = '00000' + utm.northing;
            return utm.zoneNumber + utm.zoneLetter + get100kID(utm.easting, utm.northing, utm.zoneNumber) + seasting.substr(seasting.length - 5, accuracy) + snorthing.substr(snorthing.length - 5, accuracy);
        }
        function get100kID(easting, northing, zoneNumber) {
            var setParm = get100kSetForZone(zoneNumber);
            var setColumn = Math.floor(easting / 100000);
            var setRow = Math.floor(northing / 100000) % 20;
            return getLetter100kID(setColumn, setRow, setParm);
        }
        function get100kSetForZone(i) {
            var setParm = i % NUM_100K_SETS;
            if (setParm === 0) {
                setParm = NUM_100K_SETS;
            }
            return setParm;
        }
        function getLetter100kID(column, row, parm) {
            var index = parm - 1;
            var colOrigin = SET_ORIGIN_COLUMN_LETTERS.charCodeAt(index);
            var rowOrigin = SET_ORIGIN_ROW_LETTERS.charCodeAt(index);
            var colInt = colOrigin + column - 1;
            var rowInt = rowOrigin + row;
            var rollover = false;
            if (colInt > Z) {
                colInt = colInt - Z + A - 1;
                rollover = true;
            }
            if (colInt === I || colOrigin < I && colInt > I || (colInt > I || colOrigin < I) && rollover) {
                colInt++;
            }
            if (colInt === O || colOrigin < O && colInt > O || (colInt > O || colOrigin < O) && rollover) {
                colInt++;
                if (colInt === I) {
                    colInt++;
                }
            }
            if (colInt > Z) {
                colInt = colInt - Z + A - 1;
            }
            if (rowInt > V) {
                rowInt = rowInt - V + A - 1;
                rollover = true;
            } else {
                rollover = false;
            }
            if (rowInt === I || rowOrigin < I && rowInt > I || (rowInt > I || rowOrigin < I) && rollover) {
                rowInt++;
            }
            if (rowInt === O || rowOrigin < O && rowInt > O || (rowInt > O || rowOrigin < O) && rollover) {
                rowInt++;
                if (rowInt === I) {
                    rowInt++;
                }
            }
            if (rowInt > V) {
                rowInt = rowInt - V + A - 1;
            }
            var twoLetter = String.fromCharCode(colInt) + String.fromCharCode(rowInt);
            return twoLetter;
        }
        function decode(mgrsString) {
            if (mgrsString && mgrsString.length === 0) {
                throw 'MGRSPoint coverting from nothing';
            }
            var length = mgrsString.length;
            var hunK = null;
            var sb = '';
            var testChar;
            var i = 0;
            while (!/[A-Z]/.test(testChar = mgrsString.charAt(i))) {
                if (i >= 2) {
                    throw 'MGRSPoint bad conversion from: ' + mgrsString;
                }
                sb += testChar;
                i++;
            }
            var zoneNumber = parseInt(sb, 10);
            if (i === 0 || i + 3 > length) {
                throw 'MGRSPoint bad conversion from: ' + mgrsString;
            }
            var zoneLetter = mgrsString.charAt(i++);
            if (zoneLetter <= 'A' || zoneLetter === 'B' || zoneLetter === 'Y' || zoneLetter >= 'Z' || zoneLetter === 'I' || zoneLetter === 'O') {
                throw 'MGRSPoint zone letter ' + zoneLetter + ' not handled: ' + mgrsString;
            }
            hunK = mgrsString.substring(i, i += 2);
            var set = get100kSetForZone(zoneNumber);
            var east100k = getEastingFromChar(hunK.charAt(0), set);
            var north100k = getNorthingFromChar(hunK.charAt(1), set);
            while (north100k < getMinNorthing(zoneLetter)) {
                north100k += 2000000;
            }
            var remainder = length - i;
            if (remainder % 2 !== 0) {
                throw 'MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters' + mgrsString;
            }
            var sep = remainder / 2;
            var sepEasting = 0;
            var sepNorthing = 0;
            var accuracyBonus, sepEastingString, sepNorthingString, easting, northing;
            if (sep > 0) {
                accuracyBonus = 100000 / Math.pow(10, sep);
                sepEastingString = mgrsString.substring(i, i + sep);
                sepEasting = parseFloat(sepEastingString) * accuracyBonus;
                sepNorthingString = mgrsString.substring(i + sep);
                sepNorthing = parseFloat(sepNorthingString) * accuracyBonus;
            }
            easting = sepEasting + east100k;
            northing = sepNorthing + north100k;
            return {
                easting: easting,
                northing: northing,
                zoneLetter: zoneLetter,
                zoneNumber: zoneNumber,
                accuracy: accuracyBonus
            };
        }
        function getEastingFromChar(e, set) {
            var curCol = SET_ORIGIN_COLUMN_LETTERS.charCodeAt(set - 1);
            var eastingValue = 100000;
            var rewindMarker = false;
            while (curCol !== e.charCodeAt(0)) {
                curCol++;
                if (curCol === I) {
                    curCol++;
                }
                if (curCol === O) {
                    curCol++;
                }
                if (curCol > Z) {
                    if (rewindMarker) {
                        throw 'Bad character: ' + e;
                    }
                    curCol = A;
                    rewindMarker = true;
                }
                eastingValue += 100000;
            }
            return eastingValue;
        }
        function getNorthingFromChar(n, set) {
            if (n > 'V') {
                throw 'MGRSPoint given invalid Northing ' + n;
            }
            var curRow = SET_ORIGIN_ROW_LETTERS.charCodeAt(set - 1);
            var northingValue = 0;
            var rewindMarker = false;
            while (curRow !== n.charCodeAt(0)) {
                curRow++;
                if (curRow === I) {
                    curRow++;
                }
                if (curRow === O) {
                    curRow++;
                }
                if (curRow > V) {
                    if (rewindMarker) {
                        throw 'Bad character: ' + n;
                    }
                    curRow = A;
                    rewindMarker = true;
                }
                northingValue += 100000;
            }
            return northingValue;
        }
        function getMinNorthing(zoneLetter) {
            var northing;
            switch (zoneLetter) {
            case 'C':
                northing = 1100000;
                break;
            case 'D':
                northing = 2000000;
                break;
            case 'E':
                northing = 2800000;
                break;
            case 'F':
                northing = 3700000;
                break;
            case 'G':
                northing = 4600000;
                break;
            case 'H':
                northing = 5500000;
                break;
            case 'J':
                northing = 6400000;
                break;
            case 'K':
                northing = 7300000;
                break;
            case 'L':
                northing = 8200000;
                break;
            case 'M':
                northing = 9100000;
                break;
            case 'N':
                northing = 0;
                break;
            case 'P':
                northing = 800000;
                break;
            case 'Q':
                northing = 1700000;
                break;
            case 'R':
                northing = 2600000;
                break;
            case 'S':
                northing = 3500000;
                break;
            case 'T':
                northing = 4400000;
                break;
            case 'U':
                northing = 5300000;
                break;
            case 'V':
                northing = 6200000;
                break;
            case 'W':
                northing = 7000000;
                break;
            case 'X':
                northing = 7900000;
                break;
            default:
                northing = -1;
            }
            if (northing >= 0) {
                return northing;
            } else {
                throw 'Invalid zone letter: ' + zoneLetter;
            }
        }
        function Point(x, y, z) {
            if (!(this instanceof Point)) {
                return new Point(x, y, z);
            }
            if (Array.isArray(x)) {
                this.x = x[0];
                this.y = x[1];
                this.z = x[2] || 0;
            } else if (typeof x === 'object') {
                this.x = x.x;
                this.y = x.y;
                this.z = x.z || 0;
            } else if (typeof x === 'string' && typeof y === 'undefined') {
                var coords = x.split(',');
                this.x = parseFloat(coords[0], 10);
                this.y = parseFloat(coords[1], 10);
                this.z = parseFloat(coords[2], 10) || 0;
            } else {
                this.x = x;
                this.y = y;
                this.z = z || 0;
            }
            console.warn('proj4.Point will be removed in version 3, use proj4.toPoint');
        }
        Point.fromMGRS = function (mgrsStr) {
            return new Point(toPoint$1(mgrsStr));
        };
        Point.prototype.toMGRS = function (accuracy) {
            return forward$1([
                this.x,
                this.y
            ], accuracy);
        };
        var version = '2.4.4';
        var C00 = 1;
        var C02 = 0.25;
        var C04 = 0.046875;
        var C06 = 0.01953125;
        var C08 = 0.01068115234375;
        var C22 = 0.75;
        var C44 = 0.46875;
        var C46 = 0.013020833333333334;
        var C48 = 0.007120768229166667;
        var C66 = 0.3645833333333333;
        var C68 = 0.005696614583333333;
        var C88 = 0.3076171875;
        var pj_enfn = function (es) {
            var en = [];
            en[0] = C00 - es * (C02 + es * (C04 + es * (C06 + es * C08)));
            en[1] = es * (C22 - es * (C04 + es * (C06 + es * C08)));
            var t = es * es;
            en[2] = t * (C44 - es * (C46 + es * C48));
            t *= es;
            en[3] = t * (C66 - es * C68);
            en[4] = t * es * C88;
            return en;
        };
        var pj_mlfn = function (phi, sphi, cphi, en) {
            cphi *= sphi;
            sphi *= sphi;
            return en[0] * phi - cphi * (en[1] + sphi * (en[2] + sphi * (en[3] + sphi * en[4])));
        };
        var MAX_ITER = 20;
        var pj_inv_mlfn = function (arg, es, en) {
            var k = 1 / (1 - es);
            var phi = arg;
            for (var i = MAX_ITER; i; --i) {
                var s = Math.sin(phi);
                var t = 1 - es * s * s;
                t = (pj_mlfn(phi, s, Math.cos(phi), en) - arg) * (t * Math.sqrt(t)) * k;
                phi -= t;
                if (Math.abs(t) < EPSLN) {
                    return phi;
                }
            }
            return phi;
        };
        function init$2() {
            this.x0 = this.x0 !== undefined ? this.x0 : 0;
            this.y0 = this.y0 !== undefined ? this.y0 : 0;
            this.long0 = this.long0 !== undefined ? this.long0 : 0;
            this.lat0 = this.lat0 !== undefined ? this.lat0 : 0;
            if (this.es) {
                this.en = pj_enfn(this.es);
                this.ml0 = pj_mlfn(this.lat0, Math.sin(this.lat0), Math.cos(this.lat0), this.en);
            }
        }
        function forward$2(p) {
            var lon = p.x;
            var lat = p.y;
            var delta_lon = adjust_lon(lon - this.long0);
            var con;
            var x, y;
            var sin_phi = Math.sin(lat);
            var cos_phi = Math.cos(lat);
            if (!this.es) {
                var b = cos_phi * Math.sin(delta_lon);
                if (Math.abs(Math.abs(b) - 1) < EPSLN) {
                    return 93;
                } else {
                    x = 0.5 * this.a * this.k0 * Math.log((1 + b) / (1 - b)) + this.x0;
                    y = cos_phi * Math.cos(delta_lon) / Math.sqrt(1 - Math.pow(b, 2));
                    b = Math.abs(y);
                    if (b >= 1) {
                        if (b - 1 > EPSLN) {
                            return 93;
                        } else {
                            y = 0;
                        }
                    } else {
                        y = Math.acos(y);
                    }
                    if (lat < 0) {
                        y = -y;
                    }
                    y = this.a * this.k0 * (y - this.lat0) + this.y0;
                }
            } else {
                var al = cos_phi * delta_lon;
                var als = Math.pow(al, 2);
                var c = this.ep2 * Math.pow(cos_phi, 2);
                var cs = Math.pow(c, 2);
                var tq = Math.abs(cos_phi) > EPSLN ? Math.tan(lat) : 0;
                var t = Math.pow(tq, 2);
                var ts = Math.pow(t, 2);
                con = 1 - this.es * Math.pow(sin_phi, 2);
                al = al / Math.sqrt(con);
                var ml = pj_mlfn(lat, sin_phi, cos_phi, this.en);
                x = this.a * (this.k0 * al * (1 + als / 6 * (1 - t + c + als / 20 * (5 - 18 * t + ts + 14 * c - 58 * t * c + als / 42 * (61 + 179 * ts - ts * t - 479 * t))))) + this.x0;
                y = this.a * (this.k0 * (ml - this.ml0 + sin_phi * delta_lon * al / 2 * (1 + als / 12 * (5 - t + 9 * c + 4 * cs + als / 30 * (61 + ts - 58 * t + 270 * c - 330 * t * c + als / 56 * (1385 + 543 * ts - ts * t - 3111 * t)))))) + this.y0;
            }
            p.x = x;
            p.y = y;
            return p;
        }
        function inverse$2(p) {
            var con, phi;
            var lat, lon;
            var x = (p.x - this.x0) * (1 / this.a);
            var y = (p.y - this.y0) * (1 / this.a);
            if (!this.es) {
                var f = Math.exp(x / this.k0);
                var g = 0.5 * (f - 1 / f);
                var temp = this.lat0 + y / this.k0;
                var h = Math.cos(temp);
                con = Math.sqrt((1 - Math.pow(h, 2)) / (1 + Math.pow(g, 2)));
                lat = Math.asin(con);
                if (y < 0) {
                    lat = -lat;
                }
                if (g === 0 && h === 0) {
                    lon = 0;
                } else {
                    lon = adjust_lon(Math.atan2(g, h) + this.long0);
                }
            } else {
                con = this.ml0 + y / this.k0;
                phi = pj_inv_mlfn(con, this.es, this.en);
                if (Math.abs(phi) < HALF_PI) {
                    var sin_phi = Math.sin(phi);
                    var cos_phi = Math.cos(phi);
                    var tan_phi = Math.abs(cos_phi) > EPSLN ? Math.tan(phi) : 0;
                    var c = this.ep2 * Math.pow(cos_phi, 2);
                    var cs = Math.pow(c, 2);
                    var t = Math.pow(tan_phi, 2);
                    var ts = Math.pow(t, 2);
                    con = 1 - this.es * Math.pow(sin_phi, 2);
                    var d = x * Math.sqrt(con) / this.k0;
                    var ds = Math.pow(d, 2);
                    con = con * tan_phi;
                    lat = phi - con * ds / (1 - this.es) * 0.5 * (1 - ds / 12 * (5 + 3 * t - 9 * c * t + c - 4 * cs - ds / 30 * (61 + 90 * t - 252 * c * t + 45 * ts + 46 * c - ds / 56 * (1385 + 3633 * t + 4095 * ts + 1574 * ts * t))));
                    lon = adjust_lon(this.long0 + d * (1 - ds / 6 * (1 + 2 * t + c - ds / 20 * (5 + 28 * t + 24 * ts + 8 * c * t + 6 * c - ds / 42 * (61 + 662 * t + 1320 * ts + 720 * ts * t)))) / cos_phi);
                } else {
                    lat = HALF_PI * sign(y);
                    lon = 0;
                }
            }
            p.x = lon;
            p.y = lat;
            return p;
        }
        var names$3 = [
            'Transverse_Mercator',
            'Transverse Mercator',
            'tmerc'
        ];
        var tmerc = {
            init: init$2,
            forward: forward$2,
            inverse: inverse$2,
            names: names$3
        };
        var sinh = function (x) {
            var r = Math.exp(x);
            r = (r - 1 / r) / 2;
            return r;
        };
        var hypot = function (x, y) {
            x = Math.abs(x);
            y = Math.abs(y);
            var a = Math.max(x, y);
            var b = Math.min(x, y) / (a ? a : 1);
            return a * Math.sqrt(1 + Math.pow(b, 2));
        };
        var log1py = function (x) {
            var y = 1 + x;
            var z = y - 1;
            return z === 0 ? x : x * Math.log(y) / z;
        };
        var asinhy = function (x) {
            var y = Math.abs(x);
            y = log1py(y * (1 + y / (hypot(1, y) + 1)));
            return x < 0 ? -y : y;
        };
        var gatg = function (pp, B) {
            var cos_2B = 2 * Math.cos(2 * B);
            var i = pp.length - 1;
            var h1 = pp[i];
            var h2 = 0;
            var h;
            while (--i >= 0) {
                h = -h2 + cos_2B * h1 + pp[i];
                h2 = h1;
                h1 = h;
            }
            return B + h * Math.sin(2 * B);
        };
        var clens = function (pp, arg_r) {
            var r = 2 * Math.cos(arg_r);
            var i = pp.length - 1;
            var hr1 = pp[i];
            var hr2 = 0;
            var hr;
            while (--i >= 0) {
                hr = -hr2 + r * hr1 + pp[i];
                hr2 = hr1;
                hr1 = hr;
            }
            return Math.sin(arg_r) * hr;
        };
        var cosh = function (x) {
            var r = Math.exp(x);
            r = (r + 1 / r) / 2;
            return r;
        };
        var clens_cmplx = function (pp, arg_r, arg_i) {
            var sin_arg_r = Math.sin(arg_r);
            var cos_arg_r = Math.cos(arg_r);
            var sinh_arg_i = sinh(arg_i);
            var cosh_arg_i = cosh(arg_i);
            var r = 2 * cos_arg_r * cosh_arg_i;
            var i = -2 * sin_arg_r * sinh_arg_i;
            var j = pp.length - 1;
            var hr = pp[j];
            var hi1 = 0;
            var hr1 = 0;
            var hi = 0;
            var hr2;
            var hi2;
            while (--j >= 0) {
                hr2 = hr1;
                hi2 = hi1;
                hr1 = hr;
                hi1 = hi;
                hr = -hr2 + r * hr1 - i * hi1 + pp[j];
                hi = -hi2 + i * hr1 + r * hi1;
            }
            r = sin_arg_r * cosh_arg_i;
            i = cos_arg_r * sinh_arg_i;
            return [
                r * hr - i * hi,
                r * hi + i * hr
            ];
        };
        function init$3() {
            if (this.es === undefined || this.es <= 0) {
                throw new Error('incorrect elliptical usage');
            }
            this.x0 = this.x0 !== undefined ? this.x0 : 0;
            this.y0 = this.y0 !== undefined ? this.y0 : 0;
            this.long0 = this.long0 !== undefined ? this.long0 : 0;
            this.lat0 = this.lat0 !== undefined ? this.lat0 : 0;
            this.cgb = [];
            this.cbg = [];
            this.utg = [];
            this.gtu = [];
            var f = this.es / (1 + Math.sqrt(1 - this.es));
            var n = f / (2 - f);
            var np = n;
            this.cgb[0] = n * (2 + n * (-2 / 3 + n * (-2 + n * (116 / 45 + n * (26 / 45 + n * (-2854 / 675))))));
            this.cbg[0] = n * (-2 + n * (2 / 3 + n * (4 / 3 + n * (-82 / 45 + n * (32 / 45 + n * (4642 / 4725))))));
            np = np * n;
            this.cgb[1] = np * (7 / 3 + n * (-8 / 5 + n * (-227 / 45 + n * (2704 / 315 + n * (2323 / 945)))));
            this.cbg[1] = np * (5 / 3 + n * (-16 / 15 + n * (-13 / 9 + n * (904 / 315 + n * (-1522 / 945)))));
            np = np * n;
            this.cgb[2] = np * (56 / 15 + n * (-136 / 35 + n * (-1262 / 105 + n * (73814 / 2835))));
            this.cbg[2] = np * (-26 / 15 + n * (34 / 21 + n * (8 / 5 + n * (-12686 / 2835))));
            np = np * n;
            this.cgb[3] = np * (4279 / 630 + n * (-332 / 35 + n * (-399572 / 14175)));
            this.cbg[3] = np * (1237 / 630 + n * (-12 / 5 + n * (-24832 / 14175)));
            np = np * n;
            this.cgb[4] = np * (4174 / 315 + n * (-144838 / 6237));
            this.cbg[4] = np * (-734 / 315 + n * (109598 / 31185));
            np = np * n;
            this.cgb[5] = np * (601676 / 22275);
            this.cbg[5] = np * (444337 / 155925);
            np = Math.pow(n, 2);
            this.Qn = this.k0 / (1 + n) * (1 + np * (1 / 4 + np * (1 / 64 + np / 256)));
            this.utg[0] = n * (-0.5 + n * (2 / 3 + n * (-37 / 96 + n * (1 / 360 + n * (81 / 512 + n * (-96199 / 604800))))));
            this.gtu[0] = n * (0.5 + n * (-2 / 3 + n * (5 / 16 + n * (41 / 180 + n * (-127 / 288 + n * (7891 / 37800))))));
            this.utg[1] = np * (-1 / 48 + n * (-1 / 15 + n * (437 / 1440 + n * (-46 / 105 + n * (1118711 / 3870720)))));
            this.gtu[1] = np * (13 / 48 + n * (-3 / 5 + n * (557 / 1440 + n * (281 / 630 + n * (-1983433 / 1935360)))));
            np = np * n;
            this.utg[2] = np * (-17 / 480 + n * (37 / 840 + n * (209 / 4480 + n * (-5569 / 90720))));
            this.gtu[2] = np * (61 / 240 + n * (-103 / 140 + n * (15061 / 26880 + n * (167603 / 181440))));
            np = np * n;
            this.utg[3] = np * (-4397 / 161280 + n * (11 / 504 + n * (830251 / 7257600)));
            this.gtu[3] = np * (49561 / 161280 + n * (-179 / 168 + n * (6601661 / 7257600)));
            np = np * n;
            this.utg[4] = np * (-4583 / 161280 + n * (108847 / 3991680));
            this.gtu[4] = np * (34729 / 80640 + n * (-3418889 / 1995840));
            np = np * n;
            this.utg[5] = np * (-20648693 / 638668800);
            this.gtu[5] = np * (212378941 / 319334400);
            var Z = gatg(this.cbg, this.lat0);
            this.Zb = -this.Qn * (Z + clens(this.gtu, 2 * Z));
        }
        function forward$3(p) {
            var Ce = adjust_lon(p.x - this.long0);
            var Cn = p.y;
            Cn = gatg(this.cbg, Cn);
            var sin_Cn = Math.sin(Cn);
            var cos_Cn = Math.cos(Cn);
            var sin_Ce = Math.sin(Ce);
            var cos_Ce = Math.cos(Ce);
            Cn = Math.atan2(sin_Cn, cos_Ce * cos_Cn);
            Ce = Math.atan2(sin_Ce * cos_Cn, hypot(sin_Cn, cos_Cn * cos_Ce));
            Ce = asinhy(Math.tan(Ce));
            var tmp = clens_cmplx(this.gtu, 2 * Cn, 2 * Ce);
            Cn = Cn + tmp[0];
            Ce = Ce + tmp[1];
            var x;
            var y;
            if (Math.abs(Ce) <= 2.623395162778) {
                x = this.a * (this.Qn * Ce) + this.x0;
                y = this.a * (this.Qn * Cn + this.Zb) + this.y0;
            } else {
                x = Infinity;
                y = Infinity;
            }
            p.x = x;
            p.y = y;
            return p;
        }
        function inverse$3(p) {
            var Ce = (p.x - this.x0) * (1 / this.a);
            var Cn = (p.y - this.y0) * (1 / this.a);
            Cn = (Cn - this.Zb) / this.Qn;
            Ce = Ce / this.Qn;
            var lon;
            var lat;
            if (Math.abs(Ce) <= 2.623395162778) {
                var tmp = clens_cmplx(this.utg, 2 * Cn, 2 * Ce);
                Cn = Cn + tmp[0];
                Ce = Ce + tmp[1];
                Ce = Math.atan(sinh(Ce));
                var sin_Cn = Math.sin(Cn);
                var cos_Cn = Math.cos(Cn);
                var sin_Ce = Math.sin(Ce);
                var cos_Ce = Math.cos(Ce);
                Cn = Math.atan2(sin_Cn * cos_Ce, hypot(sin_Ce, cos_Ce * cos_Cn));
                Ce = Math.atan2(sin_Ce, cos_Ce * cos_Cn);
                lon = adjust_lon(Ce + this.long0);
                lat = gatg(this.cgb, Cn);
            } else {
                lon = Infinity;
                lat = Infinity;
            }
            p.x = lon;
            p.y = lat;
            return p;
        }
        var names$4 = [
            'Extended_Transverse_Mercator',
            'Extended Transverse Mercator',
            'etmerc'
        ];
        var etmerc = {
            init: init$3,
            forward: forward$3,
            inverse: inverse$3,
            names: names$4
        };
        var adjust_zone = function (zone, lon) {
            if (zone === undefined) {
                zone = Math.floor((adjust_lon(lon) + Math.PI) * 30 / Math.PI) + 1;
                if (zone < 0) {
                    return 0;
                } else if (zone > 60) {
                    return 60;
                }
            }
            return zone;
        };
        var dependsOn = 'etmerc';
        function init$4() {
            var zone = adjust_zone(this.zone, this.long0);
            if (zone === undefined) {
                throw new Error('unknown utm zone');
            }
            this.lat0 = 0;
            this.long0 = (6 * Math.abs(zone) - 183) * D2R;
            this.x0 = 500000;
            this.y0 = this.utmSouth ? 10000000 : 0;
            this.k0 = 0.9996;
            etmerc.init.apply(this);
            this.forward = etmerc.forward;
            this.inverse = etmerc.inverse;
        }
        var names$5 = [
            'Universal Transverse Mercator System',
            'utm'
        ];
        var utm = {
            init: init$4,
            names: names$5,
            dependsOn: dependsOn
        };
        var srat = function (esinp, exp) {
            return Math.pow((1 - esinp) / (1 + esinp), exp);
        };
        var MAX_ITER$1 = 20;
        function init$6() {
            var sphi = Math.sin(this.lat0);
            var cphi = Math.cos(this.lat0);
            cphi *= cphi;
            this.rc = Math.sqrt(1 - this.es) / (1 - this.es * sphi * sphi);
            this.C = Math.sqrt(1 + this.es * cphi * cphi / (1 - this.es));
            this.phic0 = Math.asin(sphi / this.C);
            this.ratexp = 0.5 * this.C * this.e;
            this.K = Math.tan(0.5 * this.phic0 + FORTPI) / (Math.pow(Math.tan(0.5 * this.lat0 + FORTPI), this.C) * srat(this.e * sphi, this.ratexp));
        }
        function forward$5(p) {
            var lon = p.x;
            var lat = p.y;
            p.y = 2 * Math.atan(this.K * Math.pow(Math.tan(0.5 * lat + FORTPI), this.C) * srat(this.e * Math.sin(lat), this.ratexp)) - HALF_PI;
            p.x = this.C * lon;
            return p;
        }
        function inverse$5(p) {
            var DEL_TOL = 1e-14;
            var lon = p.x / this.C;
            var lat = p.y;
            var num = Math.pow(Math.tan(0.5 * lat + FORTPI) / this.K, 1 / this.C);
            for (var i = MAX_ITER$1; i > 0; --i) {
                lat = 2 * Math.atan(num * srat(this.e * Math.sin(p.y), -0.5 * this.e)) - HALF_PI;
                if (Math.abs(lat - p.y) < DEL_TOL) {
                    break;
                }
                p.y = lat;
            }
            if (!i) {
                return null;
            }
            p.x = lon;
            p.y = lat;
            return p;
        }
        var names$7 = ['gauss'];
        var gauss = {
            init: init$6,
            forward: forward$5,
            inverse: inverse$5,
            names: names$7
        };
        function init$5() {
            gauss.init.apply(this);
            if (!this.rc) {
                return;
            }
            this.sinc0 = Math.sin(this.phic0);
            this.cosc0 = Math.cos(this.phic0);
            this.R2 = 2 * this.rc;
            if (!this.title) {
                this.title = 'Oblique Stereographic Alternative';
            }
        }
        function forward$4(p) {
            var sinc, cosc, cosl, k;
            p.x = adjust_lon(p.x - this.long0);
            gauss.forward.apply(this, [p]);
            sinc = Math.sin(p.y);
            cosc = Math.cos(p.y);
            cosl = Math.cos(p.x);
            k = this.k0 * this.R2 / (1 + this.sinc0 * sinc + this.cosc0 * cosc * cosl);
            p.x = k * cosc * Math.sin(p.x);
            p.y = k * (this.cosc0 * sinc - this.sinc0 * cosc * cosl);
            p.x = this.a * p.x + this.x0;
            p.y = this.a * p.y + this.y0;
            return p;
        }
        function inverse$4(p) {
            var sinc, cosc, lon, lat, rho;
            p.x = (p.x - this.x0) / this.a;
            p.y = (p.y - this.y0) / this.a;
            p.x /= this.k0;
            p.y /= this.k0;
            if (rho = Math.sqrt(p.x * p.x + p.y * p.y)) {
                var c = 2 * Math.atan2(rho, this.R2);
                sinc = Math.sin(c);
                cosc = Math.cos(c);
                lat = Math.asin(cosc * this.sinc0 + p.y * sinc * this.cosc0 / rho);
                lon = Math.atan2(p.x * sinc, rho * this.cosc0 * cosc - p.y * this.sinc0 * sinc);
            } else {
                lat = this.phic0;
                lon = 0;
            }
            p.x = lon;
            p.y = lat;
            gauss.inverse.apply(this, [p]);
            p.x = adjust_lon(p.x + this.long0);
            return p;
        }
        var names$6 = [
            'Stereographic_North_Pole',
            'Oblique_Stereographic',
            'Polar_Stereographic',
            'sterea',
            'Oblique Stereographic Alternative'
        ];
        var sterea = {
            init: init$5,
            forward: forward$4,
            inverse: inverse$4,
            names: names$6
        };
        function ssfn_(phit, sinphi, eccen) {
            sinphi *= eccen;
            return Math.tan(0.5 * (HALF_PI + phit)) * Math.pow((1 - sinphi) / (1 + sinphi), 0.5 * eccen);
        }
        function init$7() {
            this.coslat0 = Math.cos(this.lat0);
            this.sinlat0 = Math.sin(this.lat0);
            if (this.sphere) {
                if (this.k0 === 1 && !isNaN(this.lat_ts) && Math.abs(this.coslat0) <= EPSLN) {
                    this.k0 = 0.5 * (1 + sign(this.lat0) * Math.sin(this.lat_ts));
                }
            } else {
                if (Math.abs(this.coslat0) <= EPSLN) {
                    if (this.lat0 > 0) {
                        this.con = 1;
                    } else {
                        this.con = -1;
                    }
                }
                this.cons = Math.sqrt(Math.pow(1 + this.e, 1 + this.e) * Math.pow(1 - this.e, 1 - this.e));
                if (this.k0 === 1 && !isNaN(this.lat_ts) && Math.abs(this.coslat0) <= EPSLN) {
                    this.k0 = 0.5 * this.cons * msfnz(this.e, Math.sin(this.lat_ts), Math.cos(this.lat_ts)) / tsfnz(this.e, this.con * this.lat_ts, this.con * Math.sin(this.lat_ts));
                }
                this.ms1 = msfnz(this.e, this.sinlat0, this.coslat0);
                this.X0 = 2 * Math.atan(this.ssfn_(this.lat0, this.sinlat0, this.e)) - HALF_PI;
                this.cosX0 = Math.cos(this.X0);
                this.sinX0 = Math.sin(this.X0);
            }
        }
        function forward$6(p) {
            var lon = p.x;
            var lat = p.y;
            var sinlat = Math.sin(lat);
            var coslat = Math.cos(lat);
            var A, X, sinX, cosX, ts, rh;
            var dlon = adjust_lon(lon - this.long0);
            if (Math.abs(Math.abs(lon - this.long0) - Math.PI) <= EPSLN && Math.abs(lat + this.lat0) <= EPSLN) {
                p.x = NaN;
                p.y = NaN;
                return p;
            }
            if (this.sphere) {
                A = 2 * this.k0 / (1 + this.sinlat0 * sinlat + this.coslat0 * coslat * Math.cos(dlon));
                p.x = this.a * A * coslat * Math.sin(dlon) + this.x0;
                p.y = this.a * A * (this.coslat0 * sinlat - this.sinlat0 * coslat * Math.cos(dlon)) + this.y0;
                return p;
            } else {
                X = 2 * Math.atan(this.ssfn_(lat, sinlat, this.e)) - HALF_PI;
                cosX = Math.cos(X);
                sinX = Math.sin(X);
                if (Math.abs(this.coslat0) <= EPSLN) {
                    ts = tsfnz(this.e, lat * this.con, this.con * sinlat);
                    rh = 2 * this.a * this.k0 * ts / this.cons;
                    p.x = this.x0 + rh * Math.sin(lon - this.long0);
                    p.y = this.y0 - this.con * rh * Math.cos(lon - this.long0);
                    return p;
                } else if (Math.abs(this.sinlat0) < EPSLN) {
                    A = 2 * this.a * this.k0 / (1 + cosX * Math.cos(dlon));
                    p.y = A * sinX;
                } else {
                    A = 2 * this.a * this.k0 * this.ms1 / (this.cosX0 * (1 + this.sinX0 * sinX + this.cosX0 * cosX * Math.cos(dlon)));
                    p.y = A * (this.cosX0 * sinX - this.sinX0 * cosX * Math.cos(dlon)) + this.y0;
                }
                p.x = A * cosX * Math.sin(dlon) + this.x0;
            }
            return p;
        }
        function inverse$6(p) {
            p.x -= this.x0;
            p.y -= this.y0;
            var lon, lat, ts, ce, Chi;
            var rh = Math.sqrt(p.x * p.x + p.y * p.y);
            if (this.sphere) {
                var c = 2 * Math.atan(rh / (0.5 * this.a * this.k0));
                lon = this.long0;
                lat = this.lat0;
                if (rh <= EPSLN) {
                    p.x = lon;
                    p.y = lat;
                    return p;
                }
                lat = Math.asin(Math.cos(c) * this.sinlat0 + p.y * Math.sin(c) * this.coslat0 / rh);
                if (Math.abs(this.coslat0) < EPSLN) {
                    if (this.lat0 > 0) {
                        lon = adjust_lon(this.long0 + Math.atan2(p.x, -1 * p.y));
                    } else {
                        lon = adjust_lon(this.long0 + Math.atan2(p.x, p.y));
                    }
                } else {
                    lon = adjust_lon(this.long0 + Math.atan2(p.x * Math.sin(c), rh * this.coslat0 * Math.cos(c) - p.y * this.sinlat0 * Math.sin(c)));
                }
                p.x = lon;
                p.y = lat;
                return p;
            } else {
                if (Math.abs(this.coslat0) <= EPSLN) {
                    if (rh <= EPSLN) {
                        lat = this.lat0;
                        lon = this.long0;
                        p.x = lon;
                        p.y = lat;
                        return p;
                    }
                    p.x *= this.con;
                    p.y *= this.con;
                    ts = rh * this.cons / (2 * this.a * this.k0);
                    lat = this.con * phi2z(this.e, ts);
                    lon = this.con * adjust_lon(this.con * this.long0 + Math.atan2(p.x, -1 * p.y));
                } else {
                    ce = 2 * Math.atan(rh * this.cosX0 / (2 * this.a * this.k0 * this.ms1));
                    lon = this.long0;
                    if (rh <= EPSLN) {
                        Chi = this.X0;
                    } else {
                        Chi = Math.asin(Math.cos(ce) * this.sinX0 + p.y * Math.sin(ce) * this.cosX0 / rh);
                        lon = adjust_lon(this.long0 + Math.atan2(p.x * Math.sin(ce), rh * this.cosX0 * Math.cos(ce) - p.y * this.sinX0 * Math.sin(ce)));
                    }
                    lat = -1 * phi2z(this.e, Math.tan(0.5 * (HALF_PI + Chi)));
                }
            }
            p.x = lon;
            p.y = lat;
            return p;
        }
        var names$8 = [
            'stere',
            'Stereographic_South_Pole',
            'Polar Stereographic (variant B)'
        ];
        var stere = {
            init: init$7,
            forward: forward$6,
            inverse: inverse$6,
            names: names$8,
            ssfn_: ssfn_
        };
        function init$8() {
            var phy0 = this.lat0;
            this.lambda0 = this.long0;
            var sinPhy0 = Math.sin(phy0);
            var semiMajorAxis = this.a;
            var invF = this.rf;
            var flattening = 1 / invF;
            var e2 = 2 * flattening - Math.pow(flattening, 2);
            var e = this.e = Math.sqrt(e2);
            this.R = this.k0 * semiMajorAxis * Math.sqrt(1 - e2) / (1 - e2 * Math.pow(sinPhy0, 2));
            this.alpha = Math.sqrt(1 + e2 / (1 - e2) * Math.pow(Math.cos(phy0), 4));
            this.b0 = Math.asin(sinPhy0 / this.alpha);
            var k1 = Math.log(Math.tan(Math.PI / 4 + this.b0 / 2));
            var k2 = Math.log(Math.tan(Math.PI / 4 + phy0 / 2));
            var k3 = Math.log((1 + e * sinPhy0) / (1 - e * sinPhy0));
            this.K = k1 - this.alpha * k2 + this.alpha * e / 2 * k3;
        }
        function forward$7(p) {
            var Sa1 = Math.log(Math.tan(Math.PI / 4 - p.y / 2));
            var Sa2 = this.e / 2 * Math.log((1 + this.e * Math.sin(p.y)) / (1 - this.e * Math.sin(p.y)));
            var S = -this.alpha * (Sa1 + Sa2) + this.K;
            var b = 2 * (Math.atan(Math.exp(S)) - Math.PI / 4);
            var I = this.alpha * (p.x - this.lambda0);
            var rotI = Math.atan(Math.sin(I) / (Math.sin(this.b0) * Math.tan(b) + Math.cos(this.b0) * Math.cos(I)));
            var rotB = Math.asin(Math.cos(this.b0) * Math.sin(b) - Math.sin(this.b0) * Math.cos(b) * Math.cos(I));
            p.y = this.R / 2 * Math.log((1 + Math.sin(rotB)) / (1 - Math.sin(rotB))) + this.y0;
            p.x = this.R * rotI + this.x0;
            return p;
        }
        function inverse$7(p) {
            var Y = p.x - this.x0;
            var X = p.y - this.y0;
            var rotI = Y / this.R;
            var rotB = 2 * (Math.atan(Math.exp(X / this.R)) - Math.PI / 4);
            var b = Math.asin(Math.cos(this.b0) * Math.sin(rotB) + Math.sin(this.b0) * Math.cos(rotB) * Math.cos(rotI));
            var I = Math.atan(Math.sin(rotI) / (Math.cos(this.b0) * Math.cos(rotI) - Math.sin(this.b0) * Math.tan(rotB)));
            var lambda = this.lambda0 + I / this.alpha;
            var S = 0;
            var phy = b;
            var prevPhy = -1000;
            var iteration = 0;
            while (Math.abs(phy - prevPhy) > 1e-7) {
                if (++iteration > 20) {
                    return;
                }
                S = 1 / this.alpha * (Math.log(Math.tan(Math.PI / 4 + b / 2)) - this.K) + this.e * Math.log(Math.tan(Math.PI / 4 + Math.asin(this.e * Math.sin(phy)) / 2));
                prevPhy = phy;
                phy = 2 * Math.atan(Math.exp(S)) - Math.PI / 2;
            }
            p.x = lambda;
            p.y = phy;
            return p;
        }
        var names$9 = ['somerc'];
        var somerc = {
            init: init$8,
            forward: forward$7,
            inverse: inverse$7,
            names: names$9
        };
        function init$9() {
            this.no_off = this.no_off || false;
            this.no_rot = this.no_rot || false;
            if (isNaN(this.k0)) {
                this.k0 = 1;
            }
            var sinlat = Math.sin(this.lat0);
            var coslat = Math.cos(this.lat0);
            var con = this.e * sinlat;
            this.bl = Math.sqrt(1 + this.es / (1 - this.es) * Math.pow(coslat, 4));
            this.al = this.a * this.bl * this.k0 * Math.sqrt(1 - this.es) / (1 - con * con);
            var t0 = tsfnz(this.e, this.lat0, sinlat);
            var dl = this.bl / coslat * Math.sqrt((1 - this.es) / (1 - con * con));
            if (dl * dl < 1) {
                dl = 1;
            }
            var fl;
            var gl;
            if (!isNaN(this.longc)) {
                if (this.lat0 >= 0) {
                    fl = dl + Math.sqrt(dl * dl - 1);
                } else {
                    fl = dl - Math.sqrt(dl * dl - 1);
                }
                this.el = fl * Math.pow(t0, this.bl);
                gl = 0.5 * (fl - 1 / fl);
                this.gamma0 = Math.asin(Math.sin(this.alpha) / dl);
                this.long0 = this.longc - Math.asin(gl * Math.tan(this.gamma0)) / this.bl;
            } else {
                var t1 = tsfnz(this.e, this.lat1, Math.sin(this.lat1));
                var t2 = tsfnz(this.e, this.lat2, Math.sin(this.lat2));
                if (this.lat0 >= 0) {
                    this.el = (dl + Math.sqrt(dl * dl - 1)) * Math.pow(t0, this.bl);
                } else {
                    this.el = (dl - Math.sqrt(dl * dl - 1)) * Math.pow(t0, this.bl);
                }
                var hl = Math.pow(t1, this.bl);
                var ll = Math.pow(t2, this.bl);
                fl = this.el / hl;
                gl = 0.5 * (fl - 1 / fl);
                var jl = (this.el * this.el - ll * hl) / (this.el * this.el + ll * hl);
                var pl = (ll - hl) / (ll + hl);
                var dlon12 = adjust_lon(this.long1 - this.long2);
                this.long0 = 0.5 * (this.long1 + this.long2) - Math.atan(jl * Math.tan(0.5 * this.bl * dlon12) / pl) / this.bl;
                this.long0 = adjust_lon(this.long0);
                var dlon10 = adjust_lon(this.long1 - this.long0);
                this.gamma0 = Math.atan(Math.sin(this.bl * dlon10) / gl);
                this.alpha = Math.asin(dl * Math.sin(this.gamma0));
            }
            if (this.no_off) {
                this.uc = 0;
            } else {
                if (this.lat0 >= 0) {
                    this.uc = this.al / this.bl * Math.atan2(Math.sqrt(dl * dl - 1), Math.cos(this.alpha));
                } else {
                    this.uc = -1 * this.al / this.bl * Math.atan2(Math.sqrt(dl * dl - 1), Math.cos(this.alpha));
                }
            }
        }
        function forward$8(p) {
            var lon = p.x;
            var lat = p.y;
            var dlon = adjust_lon(lon - this.long0);
            var us, vs;
            var con;
            if (Math.abs(Math.abs(lat) - HALF_PI) <= EPSLN) {
                if (lat > 0) {
                    con = -1;
                } else {
                    con = 1;
                }
                vs = this.al / this.bl * Math.log(Math.tan(FORTPI + con * this.gamma0 * 0.5));
                us = -1 * con * HALF_PI * this.al / this.bl;
            } else {
                var t = tsfnz(this.e, lat, Math.sin(lat));
                var ql = this.el / Math.pow(t, this.bl);
                var sl = 0.5 * (ql - 1 / ql);
                var tl = 0.5 * (ql + 1 / ql);
                var vl = Math.sin(this.bl * dlon);
                var ul = (sl * Math.sin(this.gamma0) - vl * Math.cos(this.gamma0)) / tl;
                if (Math.abs(Math.abs(ul) - 1) <= EPSLN) {
                    vs = Number.POSITIVE_INFINITY;
                } else {
                    vs = 0.5 * this.al * Math.log((1 - ul) / (1 + ul)) / this.bl;
                }
                if (Math.abs(Math.cos(this.bl * dlon)) <= EPSLN) {
                    us = this.al * this.bl * dlon;
                } else {
                    us = this.al * Math.atan2(sl * Math.cos(this.gamma0) + vl * Math.sin(this.gamma0), Math.cos(this.bl * dlon)) / this.bl;
                }
            }
            if (this.no_rot) {
                p.x = this.x0 + us;
                p.y = this.y0 + vs;
            } else {
                us -= this.uc;
                p.x = this.x0 + vs * Math.cos(this.alpha) + us * Math.sin(this.alpha);
                p.y = this.y0 + us * Math.cos(this.alpha) - vs * Math.sin(this.alpha);
            }
            return p;
        }
        function inverse$8(p) {
            var us, vs;
            if (this.no_rot) {
                vs = p.y - this.y0;
                us = p.x - this.x0;
            } else {
                vs = (p.x - this.x0) * Math.cos(this.alpha) - (p.y - this.y0) * Math.sin(this.alpha);
                us = (p.y - this.y0) * Math.cos(this.alpha) + (p.x - this.x0) * Math.sin(this.alpha);
                us += this.uc;
            }
            var qp = Math.exp(-1 * this.bl * vs / this.al);
            var sp = 0.5 * (qp - 1 / qp);
            var tp = 0.5 * (qp + 1 / qp);
            var vp = Math.sin(this.bl * us / this.al);
            var up = (vp * Math.cos(this.gamma0) + sp * Math.sin(this.gamma0)) / tp;
            var ts = Math.pow(this.el / Math.sqrt((1 + up) / (1 - up)), 1 / this.bl);
            if (Math.abs(up - 1) < EPSLN) {
                p.x = this.long0;
                p.y = HALF_PI;
            } else if (Math.abs(up + 1) < EPSLN) {
                p.x = this.long0;
                p.y = -1 * HALF_PI;
            } else {
                p.y = phi2z(this.e, ts);
                p.x = adjust_lon(this.long0 - Math.atan2(sp * Math.cos(this.gamma0) - vp * Math.sin(this.gamma0), Math.cos(this.bl * us / this.al)) / this.bl);
            }
            return p;
        }
        var names$10 = [
            'Hotine_Oblique_Mercator',
            'Hotine Oblique Mercator',
            'Hotine_Oblique_Mercator_Azimuth_Natural_Origin',
            'Hotine_Oblique_Mercator_Azimuth_Center',
            'omerc'
        ];
        var omerc = {
            init: init$9,
            forward: forward$8,
            inverse: inverse$8,
            names: names$10
        };
        function init$10() {
            if (!this.lat2) {
                this.lat2 = this.lat1;
            }
            if (!this.k0) {
                this.k0 = 1;
            }
            this.x0 = this.x0 || 0;
            this.y0 = this.y0 || 0;
            if (Math.abs(this.lat1 + this.lat2) < EPSLN) {
                return;
            }
            var temp = this.b / this.a;
            this.e = Math.sqrt(1 - temp * temp);
            var sin1 = Math.sin(this.lat1);
            var cos1 = Math.cos(this.lat1);
            var ms1 = msfnz(this.e, sin1, cos1);
            var ts1 = tsfnz(this.e, this.lat1, sin1);
            var sin2 = Math.sin(this.lat2);
            var cos2 = Math.cos(this.lat2);
            var ms2 = msfnz(this.e, sin2, cos2);
            var ts2 = tsfnz(this.e, this.lat2, sin2);
            var ts0 = tsfnz(this.e, this.lat0, Math.sin(this.lat0));
            if (Math.abs(this.lat1 - this.lat2) > EPSLN) {
                this.ns = Math.log(ms1 / ms2) / Math.log(ts1 / ts2);
            } else {
                this.ns = sin1;
            }
            if (isNaN(this.ns)) {
                this.ns = sin1;
            }
            this.f0 = ms1 / (this.ns * Math.pow(ts1, this.ns));
            this.rh = this.a * this.f0 * Math.pow(ts0, this.ns);
            if (!this.title) {
                this.title = 'Lambert Conformal Conic';
            }
        }
        function forward$9(p) {
            var lon = p.x;
            var lat = p.y;
            if (Math.abs(2 * Math.abs(lat) - Math.PI) <= EPSLN) {
                lat = sign(lat) * (HALF_PI - 2 * EPSLN);
            }
            var con = Math.abs(Math.abs(lat) - HALF_PI);
            var ts, rh1;
            if (con > EPSLN) {
                ts = tsfnz(this.e, lat, Math.sin(lat));
                rh1 = this.a * this.f0 * Math.pow(ts, this.ns);
            } else {
                con = lat * this.ns;
                if (con <= 0) {
                    return null;
                }
                rh1 = 0;
            }
            var theta = this.ns * adjust_lon(lon - this.long0);
            p.x = this.k0 * (rh1 * Math.sin(theta)) + this.x0;
            p.y = this.k0 * (this.rh - rh1 * Math.cos(theta)) + this.y0;
            return p;
        }
        function inverse$9(p) {
            var rh1, con, ts;
            var lat, lon;
            var x = (p.x - this.x0) / this.k0;
            var y = this.rh - (p.y - this.y0) / this.k0;
            if (this.ns > 0) {
                rh1 = Math.sqrt(x * x + y * y);
                con = 1;
            } else {
                rh1 = -Math.sqrt(x * x + y * y);
                con = -1;
            }
            var theta = 0;
            if (rh1 !== 0) {
                theta = Math.atan2(con * x, con * y);
            }
            if (rh1 !== 0 || this.ns > 0) {
                con = 1 / this.ns;
                ts = Math.pow(rh1 / (this.a * this.f0), con);
                lat = phi2z(this.e, ts);
                if (lat === -9999) {
                    return null;
                }
            } else {
                lat = -HALF_PI;
            }
            lon = adjust_lon(theta / this.ns + this.long0);
            p.x = lon;
            p.y = lat;
            return p;
        }
        var names$11 = [
            'Lambert Tangential Conformal Conic Projection',
            'Lambert_Conformal_Conic',
            'Lambert_Conformal_Conic_2SP',
            'lcc'
        ];
        var lcc = {
            init: init$10,
            forward: forward$9,
            inverse: inverse$9,
            names: names$11
        };
        function init$11() {
            this.a = 6377397.155;
            this.es = 0.006674372230614;
            this.e = Math.sqrt(this.es);
            if (!this.lat0) {
                this.lat0 = 0.863937979737193;
            }
            if (!this.long0) {
                this.long0 = 0.7417649320975901 - 0.308341501185665;
            }
            if (!this.k0) {
                this.k0 = 0.9999;
            }
            this.s45 = 0.785398163397448;
            this.s90 = 2 * this.s45;
            this.fi0 = this.lat0;
            this.e2 = this.es;
            this.e = Math.sqrt(this.e2);
            this.alfa = Math.sqrt(1 + this.e2 * Math.pow(Math.cos(this.fi0), 4) / (1 - this.e2));
            this.uq = 1.04216856380474;
            this.u0 = Math.asin(Math.sin(this.fi0) / this.alfa);
            this.g = Math.pow((1 + this.e * Math.sin(this.fi0)) / (1 - this.e * Math.sin(this.fi0)), this.alfa * this.e / 2);
            this.k = Math.tan(this.u0 / 2 + this.s45) / Math.pow(Math.tan(this.fi0 / 2 + this.s45), this.alfa) * this.g;
            this.k1 = this.k0;
            this.n0 = this.a * Math.sqrt(1 - this.e2) / (1 - this.e2 * Math.pow(Math.sin(this.fi0), 2));
            this.s0 = 1.37008346281555;
            this.n = Math.sin(this.s0);
            this.ro0 = this.k1 * this.n0 / Math.tan(this.s0);
            this.ad = this.s90 - this.uq;
        }
        function forward$10(p) {
            var gfi, u, deltav, s, d, eps, ro;
            var lon = p.x;
            var lat = p.y;
            var delta_lon = adjust_lon(lon - this.long0);
            gfi = Math.pow((1 + this.e * Math.sin(lat)) / (1 - this.e * Math.sin(lat)), this.alfa * this.e / 2);
            u = 2 * (Math.atan(this.k * Math.pow(Math.tan(lat / 2 + this.s45), this.alfa) / gfi) - this.s45);
            deltav = -delta_lon * this.alfa;
            s = Math.asin(Math.cos(this.ad) * Math.sin(u) + Math.sin(this.ad) * Math.cos(u) * Math.cos(deltav));
            d = Math.asin(Math.cos(u) * Math.sin(deltav) / Math.cos(s));
            eps = this.n * d;
            ro = this.ro0 * Math.pow(Math.tan(this.s0 / 2 + this.s45), this.n) / Math.pow(Math.tan(s / 2 + this.s45), this.n);
            p.y = ro * Math.cos(eps) / 1;
            p.x = ro * Math.sin(eps) / 1;
            if (!this.czech) {
                p.y *= -1;
                p.x *= -1;
            }
            return p;
        }
        function inverse$10(p) {
            var u, deltav, s, d, eps, ro, fi1;
            var ok;
            var tmp = p.x;
            p.x = p.y;
            p.y = tmp;
            if (!this.czech) {
                p.y *= -1;
                p.x *= -1;
            }
            ro = Math.sqrt(p.x * p.x + p.y * p.y);
            eps = Math.atan2(p.y, p.x);
            d = eps / Math.sin(this.s0);
            s = 2 * (Math.atan(Math.pow(this.ro0 / ro, 1 / this.n) * Math.tan(this.s0 / 2 + this.s45)) - this.s45);
            u = Math.asin(Math.cos(this.ad) * Math.sin(s) - Math.sin(this.ad) * Math.cos(s) * Math.cos(d));
            deltav = Math.asin(Math.cos(s) * Math.sin(d) / Math.cos(u));
            p.x = this.long0 - deltav / this.alfa;
            fi1 = u;
            ok = 0;
            var iter = 0;
            do {
                p.y = 2 * (Math.atan(Math.pow(this.k, -1 / this.alfa) * Math.pow(Math.tan(u / 2 + this.s45), 1 / this.alfa) * Math.pow((1 + this.e * Math.sin(fi1)) / (1 - this.e * Math.sin(fi1)), this.e / 2)) - this.s45);
                if (Math.abs(fi1 - p.y) < 1e-10) {
                    ok = 1;
                }
                fi1 = p.y;
                iter += 1;
            } while (ok === 0 && iter < 15);
            if (iter >= 15) {
                return null;
            }
            return p;
        }
        var names$12 = [
            'Krovak',
            'krovak'
        ];
        var krovak = {
            init: init$11,
            forward: forward$10,
            inverse: inverse$10,
            names: names$12
        };
        var mlfn = function (e0, e1, e2, e3, phi) {
            return e0 * phi - e1 * Math.sin(2 * phi) + e2 * Math.sin(4 * phi) - e3 * Math.sin(6 * phi);
        };
        var e0fn = function (x) {
            return 1 - 0.25 * x * (1 + x / 16 * (3 + 1.25 * x));
        };
        var e1fn = function (x) {
            return 0.375 * x * (1 + 0.25 * x * (1 + 0.46875 * x));
        };
        var e2fn = function (x) {
            return 0.05859375 * x * x * (1 + 0.75 * x);
        };
        var e3fn = function (x) {
            return x * x * x * (35 / 3072);
        };
        var gN = function (a, e, sinphi) {
            var temp = e * sinphi;
            return a / Math.sqrt(1 - temp * temp);
        };
        var adjust_lat = function (x) {
            return Math.abs(x) < HALF_PI ? x : x - sign(x) * Math.PI;
        };
        var imlfn = function (ml, e0, e1, e2, e3) {
            var phi;
            var dphi;
            phi = ml / e0;
            for (var i = 0; i < 15; i++) {
                dphi = (ml - (e0 * phi - e1 * Math.sin(2 * phi) + e2 * Math.sin(4 * phi) - e3 * Math.sin(6 * phi))) / (e0 - 2 * e1 * Math.cos(2 * phi) + 4 * e2 * Math.cos(4 * phi) - 6 * e3 * Math.cos(6 * phi));
                phi += dphi;
                if (Math.abs(dphi) <= 1e-10) {
                    return phi;
                }
            }
            return NaN;
        };
        function init$12() {
            if (!this.sphere) {
                this.e0 = e0fn(this.es);
                this.e1 = e1fn(this.es);
                this.e2 = e2fn(this.es);
                this.e3 = e3fn(this.es);
                this.ml0 = this.a * mlfn(this.e0, this.e1, this.e2, this.e3, this.lat0);
            }
        }
        function forward$11(p) {
            var x, y;
            var lam = p.x;
            var phi = p.y;
            lam = adjust_lon(lam - this.long0);
            if (this.sphere) {
                x = this.a * Math.asin(Math.cos(phi) * Math.sin(lam));
                y = this.a * (Math.atan2(Math.tan(phi), Math.cos(lam)) - this.lat0);
            } else {
                var sinphi = Math.sin(phi);
                var cosphi = Math.cos(phi);
                var nl = gN(this.a, this.e, sinphi);
                var tl = Math.tan(phi) * Math.tan(phi);
                var al = lam * Math.cos(phi);
                var asq = al * al;
                var cl = this.es * cosphi * cosphi / (1 - this.es);
                var ml = this.a * mlfn(this.e0, this.e1, this.e2, this.e3, phi);
                x = nl * al * (1 - asq * tl * (1 / 6 - (8 - tl + 8 * cl) * asq / 120));
                y = ml - this.ml0 + nl * sinphi / cosphi * asq * (0.5 + (5 - tl + 6 * cl) * asq / 24);
            }
            p.x = x + this.x0;
            p.y = y + this.y0;
            return p;
        }
        function inverse$11(p) {
            p.x -= this.x0;
            p.y -= this.y0;
            var x = p.x / this.a;
            var y = p.y / this.a;
            var phi, lam;
            if (this.sphere) {
                var dd = y + this.lat0;
                phi = Math.asin(Math.sin(dd) * Math.cos(x));
                lam = Math.atan2(Math.tan(x), Math.cos(dd));
            } else {
                var ml1 = this.ml0 / this.a + y;
                var phi1 = imlfn(ml1, this.e0, this.e1, this.e2, this.e3);
                if (Math.abs(Math.abs(phi1) - HALF_PI) <= EPSLN) {
                    p.x = this.long0;
                    p.y = HALF_PI;
                    if (y < 0) {
                        p.y *= -1;
                    }
                    return p;
                }
                var nl1 = gN(this.a, this.e, Math.sin(phi1));
                var rl1 = nl1 * nl1 * nl1 / this.a / this.a * (1 - this.es);
                var tl1 = Math.pow(Math.tan(phi1), 2);
                var dl = x * this.a / nl1;
                var dsq = dl * dl;
                phi = phi1 - nl1 * Math.tan(phi1) / rl1 * dl * dl * (0.5 - (1 + 3 * tl1) * dl * dl / 24);
                lam = dl * (1 - dsq * (tl1 / 3 + (1 + 3 * tl1) * tl1 * dsq / 15)) / Math.cos(phi1);
            }
            p.x = adjust_lon(lam + this.long0);
            p.y = adjust_lat(phi);
            return p;
        }
        var names$13 = [
            'Cassini',
            'Cassini_Soldner',
            'cass'
        ];
        var cass = {
            init: init$12,
            forward: forward$11,
            inverse: inverse$11,
            names: names$13
        };
        var qsfnz = function (eccent, sinphi) {
            var con;
            if (eccent > 1e-7) {
                con = eccent * sinphi;
                return (1 - eccent * eccent) * (sinphi / (1 - con * con) - 0.5 / eccent * Math.log((1 - con) / (1 + con)));
            } else {
                return 2 * sinphi;
            }
        };
        var S_POLE = 1;
        var N_POLE = 2;
        var EQUIT = 3;
        var OBLIQ = 4;
        function init$13() {
            var t = Math.abs(this.lat0);
            if (Math.abs(t - HALF_PI) < EPSLN) {
                this.mode = this.lat0 < 0 ? this.S_POLE : this.N_POLE;
            } else if (Math.abs(t) < EPSLN) {
                this.mode = this.EQUIT;
            } else {
                this.mode = this.OBLIQ;
            }
            if (this.es > 0) {
                var sinphi;
                this.qp = qsfnz(this.e, 1);
                this.mmf = 0.5 / (1 - this.es);
                this.apa = authset(this.es);
                switch (this.mode) {
                case this.N_POLE:
                    this.dd = 1;
                    break;
                case this.S_POLE:
                    this.dd = 1;
                    break;
                case this.EQUIT:
                    this.rq = Math.sqrt(0.5 * this.qp);
                    this.dd = 1 / this.rq;
                    this.xmf = 1;
                    this.ymf = 0.5 * this.qp;
                    break;
                case this.OBLIQ:
                    this.rq = Math.sqrt(0.5 * this.qp);
                    sinphi = Math.sin(this.lat0);
                    this.sinb1 = qsfnz(this.e, sinphi) / this.qp;
                    this.cosb1 = Math.sqrt(1 - this.sinb1 * this.sinb1);
                    this.dd = Math.cos(this.lat0) / (Math.sqrt(1 - this.es * sinphi * sinphi) * this.rq * this.cosb1);
                    this.ymf = (this.xmf = this.rq) / this.dd;
                    this.xmf *= this.dd;
                    break;
                }
            } else {
                if (this.mode === this.OBLIQ) {
                    this.sinph0 = Math.sin(this.lat0);
                    this.cosph0 = Math.cos(this.lat0);
                }
            }
        }
        function forward$12(p) {
            var x, y, coslam, sinlam, sinphi, q, sinb, cosb, b, cosphi;
            var lam = p.x;
            var phi = p.y;
            lam = adjust_lon(lam - this.long0);
            if (this.sphere) {
                sinphi = Math.sin(phi);
                cosphi = Math.cos(phi);
                coslam = Math.cos(lam);
                if (this.mode === this.OBLIQ || this.mode === this.EQUIT) {
                    y = this.mode === this.EQUIT ? 1 + cosphi * coslam : 1 + this.sinph0 * sinphi + this.cosph0 * cosphi * coslam;
                    if (y <= EPSLN) {
                        return null;
                    }
                    y = Math.sqrt(2 / y);
                    x = y * cosphi * Math.sin(lam);
                    y *= this.mode === this.EQUIT ? sinphi : this.cosph0 * sinphi - this.sinph0 * cosphi * coslam;
                } else if (this.mode === this.N_POLE || this.mode === this.S_POLE) {
                    if (this.mode === this.N_POLE) {
                        coslam = -coslam;
                    }
                    if (Math.abs(phi + this.phi0) < EPSLN) {
                        return null;
                    }
                    y = FORTPI - phi * 0.5;
                    y = 2 * (this.mode === this.S_POLE ? Math.cos(y) : Math.sin(y));
                    x = y * Math.sin(lam);
                    y *= coslam;
                }
            } else {
                sinb = 0;
                cosb = 0;
                b = 0;
                coslam = Math.cos(lam);
                sinlam = Math.sin(lam);
                sinphi = Math.sin(phi);
                q = qsfnz(this.e, sinphi);
                if (this.mode === this.OBLIQ || this.mode === this.EQUIT) {
                    sinb = q / this.qp;
                    cosb = Math.sqrt(1 - sinb * sinb);
                }
                switch (this.mode) {
                case this.OBLIQ:
                    b = 1 + this.sinb1 * sinb + this.cosb1 * cosb * coslam;
                    break;
                case this.EQUIT:
                    b = 1 + cosb * coslam;
                    break;
                case this.N_POLE:
                    b = HALF_PI + phi;
                    q = this.qp - q;
                    break;
                case this.S_POLE:
                    b = phi - HALF_PI;
                    q = this.qp + q;
                    break;
                }
                if (Math.abs(b) < EPSLN) {
                    return null;
                }
                switch (this.mode) {
                case this.OBLIQ:
                case this.EQUIT:
                    b = Math.sqrt(2 / b);
                    if (this.mode === this.OBLIQ) {
                        y = this.ymf * b * (this.cosb1 * sinb - this.sinb1 * cosb * coslam);
                    } else {
                        y = (b = Math.sqrt(2 / (1 + cosb * coslam))) * sinb * this.ymf;
                    }
                    x = this.xmf * b * cosb * sinlam;
                    break;
                case this.N_POLE:
                case this.S_POLE:
                    if (q >= 0) {
                        x = (b = Math.sqrt(q)) * sinlam;
                        y = coslam * (this.mode === this.S_POLE ? b : -b);
                    } else {
                        x = y = 0;
                    }
                    break;
                }
            }
            p.x = this.a * x + this.x0;
            p.y = this.a * y + this.y0;
            return p;
        }
        function inverse$12(p) {
            p.x -= this.x0;
            p.y -= this.y0;
            var x = p.x / this.a;
            var y = p.y / this.a;
            var lam, phi, cCe, sCe, q, rho, ab;
            if (this.sphere) {
                var cosz = 0, rh, sinz = 0;
                rh = Math.sqrt(x * x + y * y);
                phi = rh * 0.5;
                if (phi > 1) {
                    return null;
                }
                phi = 2 * Math.asin(phi);
                if (this.mode === this.OBLIQ || this.mode === this.EQUIT) {
                    sinz = Math.sin(phi);
                    cosz = Math.cos(phi);
                }
                switch (this.mode) {
                case this.EQUIT:
                    phi = Math.abs(rh) <= EPSLN ? 0 : Math.asin(y * sinz / rh);
                    x *= sinz;
                    y = cosz * rh;
                    break;
                case this.OBLIQ:
                    phi = Math.abs(rh) <= EPSLN ? this.phi0 : Math.asin(cosz * this.sinph0 + y * sinz * this.cosph0 / rh);
                    x *= sinz * this.cosph0;
                    y = (cosz - Math.sin(phi) * this.sinph0) * rh;
                    break;
                case this.N_POLE:
                    y = -y;
                    phi = HALF_PI - phi;
                    break;
                case this.S_POLE:
                    phi -= HALF_PI;
                    break;
                }
                lam = y === 0 && (this.mode === this.EQUIT || this.mode === this.OBLIQ) ? 0 : Math.atan2(x, y);
            } else {
                ab = 0;
                if (this.mode === this.OBLIQ || this.mode === this.EQUIT) {
                    x /= this.dd;
                    y *= this.dd;
                    rho = Math.sqrt(x * x + y * y);
                    if (rho < EPSLN) {
                        p.x = 0;
                        p.y = this.phi0;
                        return p;
                    }
                    sCe = 2 * Math.asin(0.5 * rho / this.rq);
                    cCe = Math.cos(sCe);
                    x *= sCe = Math.sin(sCe);
                    if (this.mode === this.OBLIQ) {
                        ab = cCe * this.sinb1 + y * sCe * this.cosb1 / rho;
                        q = this.qp * ab;
                        y = rho * this.cosb1 * cCe - y * this.sinb1 * sCe;
                    } else {
                        ab = y * sCe / rho;
                        q = this.qp * ab;
                        y = rho * cCe;
                    }
                } else if (this.mode === this.N_POLE || this.mode === this.S_POLE) {
                    if (this.mode === this.N_POLE) {
                        y = -y;
                    }
                    q = x * x + y * y;
                    if (!q) {
                        p.x = 0;
                        p.y = this.phi0;
                        return p;
                    }
                    ab = 1 - q / this.qp;
                    if (this.mode === this.S_POLE) {
                        ab = -ab;
                    }
                }
                lam = Math.atan2(x, y);
                phi = authlat(Math.asin(ab), this.apa);
            }
            p.x = adjust_lon(this.long0 + lam);
            p.y = phi;
            return p;
        }
        var P00 = 0.3333333333333333;
        var P01 = 0.17222222222222222;
        var P02 = 0.10257936507936508;
        var P10 = 0.06388888888888888;
        var P11 = 0.0664021164021164;
        var P20 = 0.016415012942191543;
        function authset(es) {
            var t;
            var APA = [];
            APA[0] = es * P00;
            t = es * es;
            APA[0] += t * P01;
            APA[1] = t * P10;
            t *= es;
            APA[0] += t * P02;
            APA[1] += t * P11;
            APA[2] = t * P20;
            return APA;
        }
        function authlat(beta, APA) {
            var t = beta + beta;
            return beta + APA[0] * Math.sin(t) + APA[1] * Math.sin(t + t) + APA[2] * Math.sin(t + t + t);
        }
        var names$14 = [
            'Lambert Azimuthal Equal Area',
            'Lambert_Azimuthal_Equal_Area',
            'laea'
        ];
        var laea = {
            init: init$13,
            forward: forward$12,
            inverse: inverse$12,
            names: names$14,
            S_POLE: S_POLE,
            N_POLE: N_POLE,
            EQUIT: EQUIT,
            OBLIQ: OBLIQ
        };
        var asinz = function (x) {
            if (Math.abs(x) > 1) {
                x = x > 1 ? 1 : -1;
            }
            return Math.asin(x);
        };
        function init$14() {
            if (Math.abs(this.lat1 + this.lat2) < EPSLN) {
                return;
            }
            this.temp = this.b / this.a;
            this.es = 1 - Math.pow(this.temp, 2);
            this.e3 = Math.sqrt(this.es);
            this.sin_po = Math.sin(this.lat1);
            this.cos_po = Math.cos(this.lat1);
            this.t1 = this.sin_po;
            this.con = this.sin_po;
            this.ms1 = msfnz(this.e3, this.sin_po, this.cos_po);
            this.qs1 = qsfnz(this.e3, this.sin_po, this.cos_po);
            this.sin_po = Math.sin(this.lat2);
            this.cos_po = Math.cos(this.lat2);
            this.t2 = this.sin_po;
            this.ms2 = msfnz(this.e3, this.sin_po, this.cos_po);
            this.qs2 = qsfnz(this.e3, this.sin_po, this.cos_po);
            this.sin_po = Math.sin(this.lat0);
            this.cos_po = Math.cos(this.lat0);
            this.t3 = this.sin_po;
            this.qs0 = qsfnz(this.e3, this.sin_po, this.cos_po);
            if (Math.abs(this.lat1 - this.lat2) > EPSLN) {
                this.ns0 = (this.ms1 * this.ms1 - this.ms2 * this.ms2) / (this.qs2 - this.qs1);
            } else {
                this.ns0 = this.con;
            }
            this.c = this.ms1 * this.ms1 + this.ns0 * this.qs1;
            this.rh = this.a * Math.sqrt(this.c - this.ns0 * this.qs0) / this.ns0;
        }
        function forward$13(p) {
            var lon = p.x;
            var lat = p.y;
            this.sin_phi = Math.sin(lat);
            this.cos_phi = Math.cos(lat);
            var qs = qsfnz(this.e3, this.sin_phi, this.cos_phi);
            var rh1 = this.a * Math.sqrt(this.c - this.ns0 * qs) / this.ns0;
            var theta = this.ns0 * adjust_lon(lon - this.long0);
            var x = rh1 * Math.sin(theta) + this.x0;
            var y = this.rh - rh1 * Math.cos(theta) + this.y0;
            p.x = x;
            p.y = y;
            return p;
        }
        function inverse$13(p) {
            var rh1, qs, con, theta, lon, lat;
            p.x -= this.x0;
            p.y = this.rh - p.y + this.y0;
            if (this.ns0 >= 0) {
                rh1 = Math.sqrt(p.x * p.x + p.y * p.y);
                con = 1;
            } else {
                rh1 = -Math.sqrt(p.x * p.x + p.y * p.y);
                con = -1;
            }
            theta = 0;
            if (rh1 !== 0) {
                theta = Math.atan2(con * p.x, con * p.y);
            }
            con = rh1 * this.ns0 / this.a;
            if (this.sphere) {
                lat = Math.asin((this.c - con * con) / (2 * this.ns0));
            } else {
                qs = (this.c - con * con) / this.ns0;
                lat = this.phi1z(this.e3, qs);
            }
            lon = adjust_lon(theta / this.ns0 + this.long0);
            p.x = lon;
            p.y = lat;
            return p;
        }
        function phi1z(eccent, qs) {
            var sinphi, cosphi, con, com, dphi;
            var phi = asinz(0.5 * qs);
            if (eccent < EPSLN) {
                return phi;
            }
            var eccnts = eccent * eccent;
            for (var i = 1; i <= 25; i++) {
                sinphi = Math.sin(phi);
                cosphi = Math.cos(phi);
                con = eccent * sinphi;
                com = 1 - con * con;
                dphi = 0.5 * com * com / cosphi * (qs / (1 - eccnts) - sinphi / com + 0.5 / eccent * Math.log((1 - con) / (1 + con)));
                phi = phi + dphi;
                if (Math.abs(dphi) <= 1e-7) {
                    return phi;
                }
            }
            return null;
        }
        var names$15 = [
            'Albers_Conic_Equal_Area',
            'Albers',
            'aea'
        ];
        var aea = {
            init: init$14,
            forward: forward$13,
            inverse: inverse$13,
            names: names$15,
            phi1z: phi1z
        };
        function init$15() {
            this.sin_p14 = Math.sin(this.lat0);
            this.cos_p14 = Math.cos(this.lat0);
            this.infinity_dist = 1000 * this.a;
            this.rc = 1;
        }
        function forward$14(p) {
            var sinphi, cosphi;
            var dlon;
            var coslon;
            var ksp;
            var g;
            var x, y;
            var lon = p.x;
            var lat = p.y;
            dlon = adjust_lon(lon - this.long0);
            sinphi = Math.sin(lat);
            cosphi = Math.cos(lat);
            coslon = Math.cos(dlon);
            g = this.sin_p14 * sinphi + this.cos_p14 * cosphi * coslon;
            ksp = 1;
            if (g > 0 || Math.abs(g) <= EPSLN) {
                x = this.x0 + this.a * ksp * cosphi * Math.sin(dlon) / g;
                y = this.y0 + this.a * ksp * (this.cos_p14 * sinphi - this.sin_p14 * cosphi * coslon) / g;
            } else {
                x = this.x0 + this.infinity_dist * cosphi * Math.sin(dlon);
                y = this.y0 + this.infinity_dist * (this.cos_p14 * sinphi - this.sin_p14 * cosphi * coslon);
            }
            p.x = x;
            p.y = y;
            return p;
        }
        function inverse$14(p) {
            var rh;
            var sinc, cosc;
            var c;
            var lon, lat;
            p.x = (p.x - this.x0) / this.a;
            p.y = (p.y - this.y0) / this.a;
            p.x /= this.k0;
            p.y /= this.k0;
            if (rh = Math.sqrt(p.x * p.x + p.y * p.y)) {
                c = Math.atan2(rh, this.rc);
                sinc = Math.sin(c);
                cosc = Math.cos(c);
                lat = asinz(cosc * this.sin_p14 + p.y * sinc * this.cos_p14 / rh);
                lon = Math.atan2(p.x * sinc, rh * this.cos_p14 * cosc - p.y * this.sin_p14 * sinc);
                lon = adjust_lon(this.long0 + lon);
            } else {
                lat = this.phic0;
                lon = 0;
            }
            p.x = lon;
            p.y = lat;
            return p;
        }
        var names$16 = ['gnom'];
        var gnom = {
            init: init$15,
            forward: forward$14,
            inverse: inverse$14,
            names: names$16
        };
        var iqsfnz = function (eccent, q) {
            var temp = 1 - (1 - eccent * eccent) / (2 * eccent) * Math.log((1 - eccent) / (1 + eccent));
            if (Math.abs(Math.abs(q) - temp) < 0.000001) {
                if (q < 0) {
                    return -1 * HALF_PI;
                } else {
                    return HALF_PI;
                }
            }
            var phi = Math.asin(0.5 * q);
            var dphi;
            var sin_phi;
            var cos_phi;
            var con;
            for (var i = 0; i < 30; i++) {
                sin_phi = Math.sin(phi);
                cos_phi = Math.cos(phi);
                con = eccent * sin_phi;
                dphi = Math.pow(1 - con * con, 2) / (2 * cos_phi) * (q / (1 - eccent * eccent) - sin_phi / (1 - con * con) + 0.5 / eccent * Math.log((1 - con) / (1 + con)));
                phi += dphi;
                if (Math.abs(dphi) <= 1e-10) {
                    return phi;
                }
            }
            return NaN;
        };
        function init$16() {
            if (!this.sphere) {
                this.k0 = msfnz(this.e, Math.sin(this.lat_ts), Math.cos(this.lat_ts));
            }
        }
        function forward$15(p) {
            var lon = p.x;
            var lat = p.y;
            var x, y;
            var dlon = adjust_lon(lon - this.long0);
            if (this.sphere) {
                x = this.x0 + this.a * dlon * Math.cos(this.lat_ts);
                y = this.y0 + this.a * Math.sin(lat) / Math.cos(this.lat_ts);
            } else {
                var qs = qsfnz(this.e, Math.sin(lat));
                x = this.x0 + this.a * this.k0 * dlon;
                y = this.y0 + this.a * qs * 0.5 / this.k0;
            }
            p.x = x;
            p.y = y;
            return p;
        }
        function inverse$15(p) {
            p.x -= this.x0;
            p.y -= this.y0;
            var lon, lat;
            if (this.sphere) {
                lon = adjust_lon(this.long0 + p.x / this.a / Math.cos(this.lat_ts));
                lat = Math.asin(p.y / this.a * Math.cos(this.lat_ts));
            } else {
                lat = iqsfnz(this.e, 2 * p.y * this.k0 / this.a);
                lon = adjust_lon(this.long0 + p.x / (this.a * this.k0));
            }
            p.x = lon;
            p.y = lat;
            return p;
        }
        var names$17 = ['cea'];
        var cea = {
            init: init$16,
            forward: forward$15,
            inverse: inverse$15,
            names: names$17
        };
        function init$17() {
            this.x0 = this.x0 || 0;
            this.y0 = this.y0 || 0;
            this.lat0 = this.lat0 || 0;
            this.long0 = this.long0 || 0;
            this.lat_ts = this.lat_ts || 0;
            this.title = this.title || 'Equidistant Cylindrical (Plate Carre)';
            this.rc = Math.cos(this.lat_ts);
        }
        function forward$16(p) {
            var lon = p.x;
            var lat = p.y;
            var dlon = adjust_lon(lon - this.long0);
            var dlat = adjust_lat(lat - this.lat0);
            p.x = this.x0 + this.a * dlon * this.rc;
            p.y = this.y0 + this.a * dlat;
            return p;
        }
        function inverse$16(p) {
            var x = p.x;
            var y = p.y;
            p.x = adjust_lon(this.long0 + (x - this.x0) / (this.a * this.rc));
            p.y = adjust_lat(this.lat0 + (y - this.y0) / this.a);
            return p;
        }
        var names$18 = [
            'Equirectangular',
            'Equidistant_Cylindrical',
            'eqc'
        ];
        var eqc = {
            init: init$17,
            forward: forward$16,
            inverse: inverse$16,
            names: names$18
        };
        var MAX_ITER$2 = 20;
        function init$18() {
            this.temp = this.b / this.a;
            this.es = 1 - Math.pow(this.temp, 2);
            this.e = Math.sqrt(this.es);
            this.e0 = e0fn(this.es);
            this.e1 = e1fn(this.es);
            this.e2 = e2fn(this.es);
            this.e3 = e3fn(this.es);
            this.ml0 = this.a * mlfn(this.e0, this.e1, this.e2, this.e3, this.lat0);
        }
        function forward$17(p) {
            var lon = p.x;
            var lat = p.y;
            var x, y, el;
            var dlon = adjust_lon(lon - this.long0);
            el = dlon * Math.sin(lat);
            if (this.sphere) {
                if (Math.abs(lat) <= EPSLN) {
                    x = this.a * dlon;
                    y = -1 * this.a * this.lat0;
                } else {
                    x = this.a * Math.sin(el) / Math.tan(lat);
                    y = this.a * (adjust_lat(lat - this.lat0) + (1 - Math.cos(el)) / Math.tan(lat));
                }
            } else {
                if (Math.abs(lat) <= EPSLN) {
                    x = this.a * dlon;
                    y = -1 * this.ml0;
                } else {
                    var nl = gN(this.a, this.e, Math.sin(lat)) / Math.tan(lat);
                    x = nl * Math.sin(el);
                    y = this.a * mlfn(this.e0, this.e1, this.e2, this.e3, lat) - this.ml0 + nl * (1 - Math.cos(el));
                }
            }
            p.x = x + this.x0;
            p.y = y + this.y0;
            return p;
        }
        function inverse$17(p) {
            var lon, lat, x, y, i;
            var al, bl;
            var phi, dphi;
            x = p.x - this.x0;
            y = p.y - this.y0;
            if (this.sphere) {
                if (Math.abs(y + this.a * this.lat0) <= EPSLN) {
                    lon = adjust_lon(x / this.a + this.long0);
                    lat = 0;
                } else {
                    al = this.lat0 + y / this.a;
                    bl = x * x / this.a / this.a + al * al;
                    phi = al;
                    var tanphi;
                    for (i = MAX_ITER$2; i; --i) {
                        tanphi = Math.tan(phi);
                        dphi = -1 * (al * (phi * tanphi + 1) - phi - 0.5 * (phi * phi + bl) * tanphi) / ((phi - al) / tanphi - 1);
                        phi += dphi;
                        if (Math.abs(dphi) <= EPSLN) {
                            lat = phi;
                            break;
                        }
                    }
                    lon = adjust_lon(this.long0 + Math.asin(x * Math.tan(phi) / this.a) / Math.sin(lat));
                }
            } else {
                if (Math.abs(y + this.ml0) <= EPSLN) {
                    lat = 0;
                    lon = adjust_lon(this.long0 + x / this.a);
                } else {
                    al = (this.ml0 + y) / this.a;
                    bl = x * x / this.a / this.a + al * al;
                    phi = al;
                    var cl, mln, mlnp, ma;
                    var con;
                    for (i = MAX_ITER$2; i; --i) {
                        con = this.e * Math.sin(phi);
                        cl = Math.sqrt(1 - con * con) * Math.tan(phi);
                        mln = this.a * mlfn(this.e0, this.e1, this.e2, this.e3, phi);
                        mlnp = this.e0 - 2 * this.e1 * Math.cos(2 * phi) + 4 * this.e2 * Math.cos(4 * phi) - 6 * this.e3 * Math.cos(6 * phi);
                        ma = mln / this.a;
                        dphi = (al * (cl * ma + 1) - ma - 0.5 * cl * (ma * ma + bl)) / (this.es * Math.sin(2 * phi) * (ma * ma + bl - 2 * al * ma) / (4 * cl) + (al - ma) * (cl * mlnp - 2 / Math.sin(2 * phi)) - mlnp);
                        phi -= dphi;
                        if (Math.abs(dphi) <= EPSLN) {
                            lat = phi;
                            break;
                        }
                    }
                    cl = Math.sqrt(1 - this.es * Math.pow(Math.sin(lat), 2)) * Math.tan(lat);
                    lon = adjust_lon(this.long0 + Math.asin(x * cl / this.a) / Math.sin(lat));
                }
            }
            p.x = lon;
            p.y = lat;
            return p;
        }
        var names$19 = [
            'Polyconic',
            'poly'
        ];
        var poly = {
            init: init$18,
            forward: forward$17,
            inverse: inverse$17,
            names: names$19
        };
        function init$19() {
            this.A = [];
            this.A[1] = 0.6399175073;
            this.A[2] = -0.1358797613;
            this.A[3] = 0.063294409;
            this.A[4] = -0.02526853;
            this.A[5] = 0.0117879;
            this.A[6] = -0.0055161;
            this.A[7] = 0.0026906;
            this.A[8] = -0.001333;
            this.A[9] = 0.00067;
            this.A[10] = -0.00034;
            this.B_re = [];
            this.B_im = [];
            this.B_re[1] = 0.7557853228;
            this.B_im[1] = 0;
            this.B_re[2] = 0.249204646;
            this.B_im[2] = 0.003371507;
            this.B_re[3] = -0.001541739;
            this.B_im[3] = 0.04105856;
            this.B_re[4] = -0.10162907;
            this.B_im[4] = 0.01727609;
            this.B_re[5] = -0.26623489;
            this.B_im[5] = -0.36249218;
            this.B_re[6] = -0.6870983;
            this.B_im[6] = -1.1651967;
            this.C_re = [];
            this.C_im = [];
            this.C_re[1] = 1.3231270439;
            this.C_im[1] = 0;
            this.C_re[2] = -0.577245789;
            this.C_im[2] = -0.007809598;
            this.C_re[3] = 0.508307513;
            this.C_im[3] = -0.112208952;
            this.C_re[4] = -0.15094762;
            this.C_im[4] = 0.18200602;
            this.C_re[5] = 1.01418179;
            this.C_im[5] = 1.64497696;
            this.C_re[6] = 1.9660549;
            this.C_im[6] = 2.5127645;
            this.D = [];
            this.D[1] = 1.5627014243;
            this.D[2] = 0.5185406398;
            this.D[3] = -0.03333098;
            this.D[4] = -0.1052906;
            this.D[5] = -0.0368594;
            this.D[6] = 0.007317;
            this.D[7] = 0.0122;
            this.D[8] = 0.00394;
            this.D[9] = -0.0013;
        }
        function forward$18(p) {
            var n;
            var lon = p.x;
            var lat = p.y;
            var delta_lat = lat - this.lat0;
            var delta_lon = lon - this.long0;
            var d_phi = delta_lat / SEC_TO_RAD * 0.00001;
            var d_lambda = delta_lon;
            var d_phi_n = 1;
            var d_psi = 0;
            for (n = 1; n <= 10; n++) {
                d_phi_n = d_phi_n * d_phi;
                d_psi = d_psi + this.A[n] * d_phi_n;
            }
            var th_re = d_psi;
            var th_im = d_lambda;
            var th_n_re = 1;
            var th_n_im = 0;
            var th_n_re1;
            var th_n_im1;
            var z_re = 0;
            var z_im = 0;
            for (n = 1; n <= 6; n++) {
                th_n_re1 = th_n_re * th_re - th_n_im * th_im;
                th_n_im1 = th_n_im * th_re + th_n_re * th_im;
                th_n_re = th_n_re1;
                th_n_im = th_n_im1;
                z_re = z_re + this.B_re[n] * th_n_re - this.B_im[n] * th_n_im;
                z_im = z_im + this.B_im[n] * th_n_re + this.B_re[n] * th_n_im;
            }
            p.x = z_im * this.a + this.x0;
            p.y = z_re * this.a + this.y0;
            return p;
        }
        function inverse$18(p) {
            var n;
            var x = p.x;
            var y = p.y;
            var delta_x = x - this.x0;
            var delta_y = y - this.y0;
            var z_re = delta_y / this.a;
            var z_im = delta_x / this.a;
            var z_n_re = 1;
            var z_n_im = 0;
            var z_n_re1;
            var z_n_im1;
            var th_re = 0;
            var th_im = 0;
            for (n = 1; n <= 6; n++) {
                z_n_re1 = z_n_re * z_re - z_n_im * z_im;
                z_n_im1 = z_n_im * z_re + z_n_re * z_im;
                z_n_re = z_n_re1;
                z_n_im = z_n_im1;
                th_re = th_re + this.C_re[n] * z_n_re - this.C_im[n] * z_n_im;
                th_im = th_im + this.C_im[n] * z_n_re + this.C_re[n] * z_n_im;
            }
            for (var i = 0; i < this.iterations; i++) {
                var th_n_re = th_re;
                var th_n_im = th_im;
                var th_n_re1;
                var th_n_im1;
                var num_re = z_re;
                var num_im = z_im;
                for (n = 2; n <= 6; n++) {
                    th_n_re1 = th_n_re * th_re - th_n_im * th_im;
                    th_n_im1 = th_n_im * th_re + th_n_re * th_im;
                    th_n_re = th_n_re1;
                    th_n_im = th_n_im1;
                    num_re = num_re + (n - 1) * (this.B_re[n] * th_n_re - this.B_im[n] * th_n_im);
                    num_im = num_im + (n - 1) * (this.B_im[n] * th_n_re + this.B_re[n] * th_n_im);
                }
                th_n_re = 1;
                th_n_im = 0;
                var den_re = this.B_re[1];
                var den_im = this.B_im[1];
                for (n = 2; n <= 6; n++) {
                    th_n_re1 = th_n_re * th_re - th_n_im * th_im;
                    th_n_im1 = th_n_im * th_re + th_n_re * th_im;
                    th_n_re = th_n_re1;
                    th_n_im = th_n_im1;
                    den_re = den_re + n * (this.B_re[n] * th_n_re - this.B_im[n] * th_n_im);
                    den_im = den_im + n * (this.B_im[n] * th_n_re + this.B_re[n] * th_n_im);
                }
                var den2 = den_re * den_re + den_im * den_im;
                th_re = (num_re * den_re + num_im * den_im) / den2;
                th_im = (num_im * den_re - num_re * den_im) / den2;
            }
            var d_psi = th_re;
            var d_lambda = th_im;
            var d_psi_n = 1;
            var d_phi = 0;
            for (n = 1; n <= 9; n++) {
                d_psi_n = d_psi_n * d_psi;
                d_phi = d_phi + this.D[n] * d_psi_n;
            }
            var lat = this.lat0 + d_phi * SEC_TO_RAD * 100000;
            var lon = this.long0 + d_lambda;
            p.x = lon;
            p.y = lat;
            return p;
        }
        var names$20 = [
            'New_Zealand_Map_Grid',
            'nzmg'
        ];
        var nzmg = {
            init: init$19,
            forward: forward$18,
            inverse: inverse$18,
            names: names$20
        };
        function init$20() {
        }
        function forward$19(p) {
            var lon = p.x;
            var lat = p.y;
            var dlon = adjust_lon(lon - this.long0);
            var x = this.x0 + this.a * dlon;
            var y = this.y0 + this.a * Math.log(Math.tan(Math.PI / 4 + lat / 2.5)) * 1.25;
            p.x = x;
            p.y = y;
            return p;
        }
        function inverse$19(p) {
            p.x -= this.x0;
            p.y -= this.y0;
            var lon = adjust_lon(this.long0 + p.x / this.a);
            var lat = 2.5 * (Math.atan(Math.exp(0.8 * p.y / this.a)) - Math.PI / 4);
            p.x = lon;
            p.y = lat;
            return p;
        }
        var names$21 = [
            'Miller_Cylindrical',
            'mill'
        ];
        var mill = {
            init: init$20,
            forward: forward$19,
            inverse: inverse$19,
            names: names$21
        };
        var MAX_ITER$3 = 20;
        function init$21() {
            if (!this.sphere) {
                this.en = pj_enfn(this.es);
            } else {
                this.n = 1;
                this.m = 0;
                this.es = 0;
                this.C_y = Math.sqrt((this.m + 1) / this.n);
                this.C_x = this.C_y / (this.m + 1);
            }
        }
        function forward$20(p) {
            var x, y;
            var lon = p.x;
            var lat = p.y;
            lon = adjust_lon(lon - this.long0);
            if (this.sphere) {
                if (!this.m) {
                    lat = this.n !== 1 ? Math.asin(this.n * Math.sin(lat)) : lat;
                } else {
                    var k = this.n * Math.sin(lat);
                    for (var i = MAX_ITER$3; i; --i) {
                        var V = (this.m * lat + Math.sin(lat) - k) / (this.m + Math.cos(lat));
                        lat -= V;
                        if (Math.abs(V) < EPSLN) {
                            break;
                        }
                    }
                }
                x = this.a * this.C_x * lon * (this.m + Math.cos(lat));
                y = this.a * this.C_y * lat;
            } else {
                var s = Math.sin(lat);
                var c = Math.cos(lat);
                y = this.a * pj_mlfn(lat, s, c, this.en);
                x = this.a * lon * c / Math.sqrt(1 - this.es * s * s);
            }
            p.x = x;
            p.y = y;
            return p;
        }
        function inverse$20(p) {
            var lat, temp, lon, s;
            p.x -= this.x0;
            lon = p.x / this.a;
            p.y -= this.y0;
            lat = p.y / this.a;
            if (this.sphere) {
                lat /= this.C_y;
                lon = lon / (this.C_x * (this.m + Math.cos(lat)));
                if (this.m) {
                    lat = asinz((this.m * lat + Math.sin(lat)) / this.n);
                } else if (this.n !== 1) {
                    lat = asinz(Math.sin(lat) / this.n);
                }
                lon = adjust_lon(lon + this.long0);
                lat = adjust_lat(lat);
            } else {
                lat = pj_inv_mlfn(p.y / this.a, this.es, this.en);
                s = Math.abs(lat);
                if (s < HALF_PI) {
                    s = Math.sin(lat);
                    temp = this.long0 + p.x * Math.sqrt(1 - this.es * s * s) / (this.a * Math.cos(lat));
                    lon = adjust_lon(temp);
                } else if (s - EPSLN < HALF_PI) {
                    lon = this.long0;
                }
            }
            p.x = lon;
            p.y = lat;
            return p;
        }
        var names$22 = [
            'Sinusoidal',
            'sinu'
        ];
        var sinu = {
            init: init$21,
            forward: forward$20,
            inverse: inverse$20,
            names: names$22
        };
        function init$22() {
        }
        function forward$21(p) {
            var lon = p.x;
            var lat = p.y;
            var delta_lon = adjust_lon(lon - this.long0);
            var theta = lat;
            var con = Math.PI * Math.sin(lat);
            while (true) {
                var delta_theta = -(theta + Math.sin(theta) - con) / (1 + Math.cos(theta));
                theta += delta_theta;
                if (Math.abs(delta_theta) < EPSLN) {
                    break;
                }
            }
            theta /= 2;
            if (Math.PI / 2 - Math.abs(lat) < EPSLN) {
                delta_lon = 0;
            }
            var x = 0.900316316158 * this.a * delta_lon * Math.cos(theta) + this.x0;
            var y = 1.4142135623731 * this.a * Math.sin(theta) + this.y0;
            p.x = x;
            p.y = y;
            return p;
        }
        function inverse$21(p) {
            var theta;
            var arg;
            p.x -= this.x0;
            p.y -= this.y0;
            arg = p.y / (1.4142135623731 * this.a);
            if (Math.abs(arg) > 0.999999999999) {
                arg = 0.999999999999;
            }
            theta = Math.asin(arg);
            var lon = adjust_lon(this.long0 + p.x / (0.900316316158 * this.a * Math.cos(theta)));
            if (lon < -Math.PI) {
                lon = -Math.PI;
            }
            if (lon > Math.PI) {
                lon = Math.PI;
            }
            arg = (2 * theta + Math.sin(2 * theta)) / Math.PI;
            if (Math.abs(arg) > 1) {
                arg = 1;
            }
            var lat = Math.asin(arg);
            p.x = lon;
            p.y = lat;
            return p;
        }
        var names$23 = [
            'Mollweide',
            'moll'
        ];
        var moll = {
            init: init$22,
            forward: forward$21,
            inverse: inverse$21,
            names: names$23
        };
        function init$23() {
            if (Math.abs(this.lat1 + this.lat2) < EPSLN) {
                return;
            }
            this.lat2 = this.lat2 || this.lat1;
            this.temp = this.b / this.a;
            this.es = 1 - Math.pow(this.temp, 2);
            this.e = Math.sqrt(this.es);
            this.e0 = e0fn(this.es);
            this.e1 = e1fn(this.es);
            this.e2 = e2fn(this.es);
            this.e3 = e3fn(this.es);
            this.sinphi = Math.sin(this.lat1);
            this.cosphi = Math.cos(this.lat1);
            this.ms1 = msfnz(this.e, this.sinphi, this.cosphi);
            this.ml1 = mlfn(this.e0, this.e1, this.e2, this.e3, this.lat1);
            if (Math.abs(this.lat1 - this.lat2) < EPSLN) {
                this.ns = this.sinphi;
            } else {
                this.sinphi = Math.sin(this.lat2);
                this.cosphi = Math.cos(this.lat2);
                this.ms2 = msfnz(this.e, this.sinphi, this.cosphi);
                this.ml2 = mlfn(this.e0, this.e1, this.e2, this.e3, this.lat2);
                this.ns = (this.ms1 - this.ms2) / (this.ml2 - this.ml1);
            }
            this.g = this.ml1 + this.ms1 / this.ns;
            this.ml0 = mlfn(this.e0, this.e1, this.e2, this.e3, this.lat0);
            this.rh = this.a * (this.g - this.ml0);
        }
        function forward$22(p) {
            var lon = p.x;
            var lat = p.y;
            var rh1;
            if (this.sphere) {
                rh1 = this.a * (this.g - lat);
            } else {
                var ml = mlfn(this.e0, this.e1, this.e2, this.e3, lat);
                rh1 = this.a * (this.g - ml);
            }
            var theta = this.ns * adjust_lon(lon - this.long0);
            var x = this.x0 + rh1 * Math.sin(theta);
            var y = this.y0 + this.rh - rh1 * Math.cos(theta);
            p.x = x;
            p.y = y;
            return p;
        }
        function inverse$22(p) {
            p.x -= this.x0;
            p.y = this.rh - p.y + this.y0;
            var con, rh1, lat, lon;
            if (this.ns >= 0) {
                rh1 = Math.sqrt(p.x * p.x + p.y * p.y);
                con = 1;
            } else {
                rh1 = -Math.sqrt(p.x * p.x + p.y * p.y);
                con = -1;
            }
            var theta = 0;
            if (rh1 !== 0) {
                theta = Math.atan2(con * p.x, con * p.y);
            }
            if (this.sphere) {
                lon = adjust_lon(this.long0 + theta / this.ns);
                lat = adjust_lat(this.g - rh1 / this.a);
                p.x = lon;
                p.y = lat;
                return p;
            } else {
                var ml = this.g - rh1 / this.a;
                lat = imlfn(ml, this.e0, this.e1, this.e2, this.e3);
                lon = adjust_lon(this.long0 + theta / this.ns);
                p.x = lon;
                p.y = lat;
                return p;
            }
        }
        var names$24 = [
            'Equidistant_Conic',
            'eqdc'
        ];
        var eqdc = {
            init: init$23,
            forward: forward$22,
            inverse: inverse$22,
            names: names$24
        };
        function init$24() {
            this.R = this.a;
        }
        function forward$23(p) {
            var lon = p.x;
            var lat = p.y;
            var dlon = adjust_lon(lon - this.long0);
            var x, y;
            if (Math.abs(lat) <= EPSLN) {
                x = this.x0 + this.R * dlon;
                y = this.y0;
            }
            var theta = asinz(2 * Math.abs(lat / Math.PI));
            if (Math.abs(dlon) <= EPSLN || Math.abs(Math.abs(lat) - HALF_PI) <= EPSLN) {
                x = this.x0;
                if (lat >= 0) {
                    y = this.y0 + Math.PI * this.R * Math.tan(0.5 * theta);
                } else {
                    y = this.y0 + Math.PI * this.R * -Math.tan(0.5 * theta);
                }
            }
            var al = 0.5 * Math.abs(Math.PI / dlon - dlon / Math.PI);
            var asq = al * al;
            var sinth = Math.sin(theta);
            var costh = Math.cos(theta);
            var g = costh / (sinth + costh - 1);
            var gsq = g * g;
            var m = g * (2 / sinth - 1);
            var msq = m * m;
            var con = Math.PI * this.R * (al * (g - msq) + Math.sqrt(asq * (g - msq) * (g - msq) - (msq + asq) * (gsq - msq))) / (msq + asq);
            if (dlon < 0) {
                con = -con;
            }
            x = this.x0 + con;
            var q = asq + g;
            con = Math.PI * this.R * (m * q - al * Math.sqrt((msq + asq) * (asq + 1) - q * q)) / (msq + asq);
            if (lat >= 0) {
                y = this.y0 + con;
            } else {
                y = this.y0 - con;
            }
            p.x = x;
            p.y = y;
            return p;
        }
        function inverse$23(p) {
            var lon, lat;
            var xx, yy, xys, c1, c2, c3;
            var a1;
            var m1;
            var con;
            var th1;
            var d;
            p.x -= this.x0;
            p.y -= this.y0;
            con = Math.PI * this.R;
            xx = p.x / con;
            yy = p.y / con;
            xys = xx * xx + yy * yy;
            c1 = -Math.abs(yy) * (1 + xys);
            c2 = c1 - 2 * yy * yy + xx * xx;
            c3 = -2 * c1 + 1 + 2 * yy * yy + xys * xys;
            d = yy * yy / c3 + (2 * c2 * c2 * c2 / c3 / c3 / c3 - 9 * c1 * c2 / c3 / c3) / 27;
            a1 = (c1 - c2 * c2 / 3 / c3) / c3;
            m1 = 2 * Math.sqrt(-a1 / 3);
            con = 3 * d / a1 / m1;
            if (Math.abs(con) > 1) {
                if (con >= 0) {
                    con = 1;
                } else {
                    con = -1;
                }
            }
            th1 = Math.acos(con) / 3;
            if (p.y >= 0) {
                lat = (-m1 * Math.cos(th1 + Math.PI / 3) - c2 / 3 / c3) * Math.PI;
            } else {
                lat = -(-m1 * Math.cos(th1 + Math.PI / 3) - c2 / 3 / c3) * Math.PI;
            }
            if (Math.abs(xx) < EPSLN) {
                lon = this.long0;
            } else {
                lon = adjust_lon(this.long0 + Math.PI * (xys - 1 + Math.sqrt(1 + 2 * (xx * xx - yy * yy) + xys * xys)) / 2 / xx);
            }
            p.x = lon;
            p.y = lat;
            return p;
        }
        var names$25 = [
            'Van_der_Grinten_I',
            'VanDerGrinten',
            'vandg'
        ];
        var vandg = {
            init: init$24,
            forward: forward$23,
            inverse: inverse$23,
            names: names$25
        };
        function init$25() {
            this.sin_p12 = Math.sin(this.lat0);
            this.cos_p12 = Math.cos(this.lat0);
        }
        function forward$24(p) {
            var lon = p.x;
            var lat = p.y;
            var sinphi = Math.sin(p.y);
            var cosphi = Math.cos(p.y);
            var dlon = adjust_lon(lon - this.long0);
            var e0, e1, e2, e3, Mlp, Ml, tanphi, Nl1, Nl, psi, Az, G, H, GH, Hs, c, kp, cos_c, s, s2, s3, s4, s5;
            if (this.sphere) {
                if (Math.abs(this.sin_p12 - 1) <= EPSLN) {
                    p.x = this.x0 + this.a * (HALF_PI - lat) * Math.sin(dlon);
                    p.y = this.y0 - this.a * (HALF_PI - lat) * Math.cos(dlon);
                    return p;
                } else if (Math.abs(this.sin_p12 + 1) <= EPSLN) {
                    p.x = this.x0 + this.a * (HALF_PI + lat) * Math.sin(dlon);
                    p.y = this.y0 + this.a * (HALF_PI + lat) * Math.cos(dlon);
                    return p;
                } else {
                    cos_c = this.sin_p12 * sinphi + this.cos_p12 * cosphi * Math.cos(dlon);
                    c = Math.acos(cos_c);
                    kp = c / Math.sin(c);
                    p.x = this.x0 + this.a * kp * cosphi * Math.sin(dlon);
                    p.y = this.y0 + this.a * kp * (this.cos_p12 * sinphi - this.sin_p12 * cosphi * Math.cos(dlon));
                    return p;
                }
            } else {
                e0 = e0fn(this.es);
                e1 = e1fn(this.es);
                e2 = e2fn(this.es);
                e3 = e3fn(this.es);
                if (Math.abs(this.sin_p12 - 1) <= EPSLN) {
                    Mlp = this.a * mlfn(e0, e1, e2, e3, HALF_PI);
                    Ml = this.a * mlfn(e0, e1, e2, e3, lat);
                    p.x = this.x0 + (Mlp - Ml) * Math.sin(dlon);
                    p.y = this.y0 - (Mlp - Ml) * Math.cos(dlon);
                    return p;
                } else if (Math.abs(this.sin_p12 + 1) <= EPSLN) {
                    Mlp = this.a * mlfn(e0, e1, e2, e3, HALF_PI);
                    Ml = this.a * mlfn(e0, e1, e2, e3, lat);
                    p.x = this.x0 + (Mlp + Ml) * Math.sin(dlon);
                    p.y = this.y0 + (Mlp + Ml) * Math.cos(dlon);
                    return p;
                } else {
                    tanphi = sinphi / cosphi;
                    Nl1 = gN(this.a, this.e, this.sin_p12);
                    Nl = gN(this.a, this.e, sinphi);
                    psi = Math.atan((1 - this.es) * tanphi + this.es * Nl1 * this.sin_p12 / (Nl * cosphi));
                    Az = Math.atan2(Math.sin(dlon), this.cos_p12 * Math.tan(psi) - this.sin_p12 * Math.cos(dlon));
                    if (Az === 0) {
                        s = Math.asin(this.cos_p12 * Math.sin(psi) - this.sin_p12 * Math.cos(psi));
                    } else if (Math.abs(Math.abs(Az) - Math.PI) <= EPSLN) {
                        s = -Math.asin(this.cos_p12 * Math.sin(psi) - this.sin_p12 * Math.cos(psi));
                    } else {
                        s = Math.asin(Math.sin(dlon) * Math.cos(psi) / Math.sin(Az));
                    }
                    G = this.e * this.sin_p12 / Math.sqrt(1 - this.es);
                    H = this.e * this.cos_p12 * Math.cos(Az) / Math.sqrt(1 - this.es);
                    GH = G * H;
                    Hs = H * H;
                    s2 = s * s;
                    s3 = s2 * s;
                    s4 = s3 * s;
                    s5 = s4 * s;
                    c = Nl1 * s * (1 - s2 * Hs * (1 - Hs) / 6 + s3 / 8 * GH * (1 - 2 * Hs) + s4 / 120 * (Hs * (4 - 7 * Hs) - 3 * G * G * (1 - 7 * Hs)) - s5 / 48 * GH);
                    p.x = this.x0 + c * Math.sin(Az);
                    p.y = this.y0 + c * Math.cos(Az);
                    return p;
                }
            }
        }
        function inverse$24(p) {
            p.x -= this.x0;
            p.y -= this.y0;
            var rh, z, sinz, cosz, lon, lat, con, e0, e1, e2, e3, Mlp, M, N1, psi, Az, cosAz, tmp, A, B, D, Ee, F;
            if (this.sphere) {
                rh = Math.sqrt(p.x * p.x + p.y * p.y);
                if (rh > 2 * HALF_PI * this.a) {
                    return;
                }
                z = rh / this.a;
                sinz = Math.sin(z);
                cosz = Math.cos(z);
                lon = this.long0;
                if (Math.abs(rh) <= EPSLN) {
                    lat = this.lat0;
                } else {
                    lat = asinz(cosz * this.sin_p12 + p.y * sinz * this.cos_p12 / rh);
                    con = Math.abs(this.lat0) - HALF_PI;
                    if (Math.abs(con) <= EPSLN) {
                        if (this.lat0 >= 0) {
                            lon = adjust_lon(this.long0 + Math.atan2(p.x, -p.y));
                        } else {
                            lon = adjust_lon(this.long0 - Math.atan2(-p.x, p.y));
                        }
                    } else {
                        lon = adjust_lon(this.long0 + Math.atan2(p.x * sinz, rh * this.cos_p12 * cosz - p.y * this.sin_p12 * sinz));
                    }
                }
                p.x = lon;
                p.y = lat;
                return p;
            } else {
                e0 = e0fn(this.es);
                e1 = e1fn(this.es);
                e2 = e2fn(this.es);
                e3 = e3fn(this.es);
                if (Math.abs(this.sin_p12 - 1) <= EPSLN) {
                    Mlp = this.a * mlfn(e0, e1, e2, e3, HALF_PI);
                    rh = Math.sqrt(p.x * p.x + p.y * p.y);
                    M = Mlp - rh;
                    lat = imlfn(M / this.a, e0, e1, e2, e3);
                    lon = adjust_lon(this.long0 + Math.atan2(p.x, -1 * p.y));
                    p.x = lon;
                    p.y = lat;
                    return p;
                } else if (Math.abs(this.sin_p12 + 1) <= EPSLN) {
                    Mlp = this.a * mlfn(e0, e1, e2, e3, HALF_PI);
                    rh = Math.sqrt(p.x * p.x + p.y * p.y);
                    M = rh - Mlp;
                    lat = imlfn(M / this.a, e0, e1, e2, e3);
                    lon = adjust_lon(this.long0 + Math.atan2(p.x, p.y));
                    p.x = lon;
                    p.y = lat;
                    return p;
                } else {
                    rh = Math.sqrt(p.x * p.x + p.y * p.y);
                    Az = Math.atan2(p.x, p.y);
                    N1 = gN(this.a, this.e, this.sin_p12);
                    cosAz = Math.cos(Az);
                    tmp = this.e * this.cos_p12 * cosAz;
                    A = -tmp * tmp / (1 - this.es);
                    B = 3 * this.es * (1 - A) * this.sin_p12 * this.cos_p12 * cosAz / (1 - this.es);
                    D = rh / N1;
                    Ee = D - A * (1 + A) * Math.pow(D, 3) / 6 - B * (1 + 3 * A) * Math.pow(D, 4) / 24;
                    F = 1 - A * Ee * Ee / 2 - D * Ee * Ee * Ee / 6;
                    psi = Math.asin(this.sin_p12 * Math.cos(Ee) + this.cos_p12 * Math.sin(Ee) * cosAz);
                    lon = adjust_lon(this.long0 + Math.asin(Math.sin(Az) * Math.sin(Ee) / Math.cos(psi)));
                    lat = Math.atan((1 - this.es * F * this.sin_p12 / Math.sin(psi)) * Math.tan(psi) / (1 - this.es));
                    p.x = lon;
                    p.y = lat;
                    return p;
                }
            }
        }
        var names$26 = [
            'Azimuthal_Equidistant',
            'aeqd'
        ];
        var aeqd = {
            init: init$25,
            forward: forward$24,
            inverse: inverse$24,
            names: names$26
        };
        function init$26() {
            this.sin_p14 = Math.sin(this.lat0);
            this.cos_p14 = Math.cos(this.lat0);
        }
        function forward$25(p) {
            var sinphi, cosphi;
            var dlon;
            var coslon;
            var ksp;
            var g, x, y;
            var lon = p.x;
            var lat = p.y;
            dlon = adjust_lon(lon - this.long0);
            sinphi = Math.sin(lat);
            cosphi = Math.cos(lat);
            coslon = Math.cos(dlon);
            g = this.sin_p14 * sinphi + this.cos_p14 * cosphi * coslon;
            ksp = 1;
            if (g > 0 || Math.abs(g) <= EPSLN) {
                x = this.a * ksp * cosphi * Math.sin(dlon);
                y = this.y0 + this.a * ksp * (this.cos_p14 * sinphi - this.sin_p14 * cosphi * coslon);
            }
            p.x = x;
            p.y = y;
            return p;
        }
        function inverse$25(p) {
            var rh;
            var z;
            var sinz, cosz;
            var con;
            var lon, lat;
            p.x -= this.x0;
            p.y -= this.y0;
            rh = Math.sqrt(p.x * p.x + p.y * p.y);
            z = asinz(rh / this.a);
            sinz = Math.sin(z);
            cosz = Math.cos(z);
            lon = this.long0;
            if (Math.abs(rh) <= EPSLN) {
                lat = this.lat0;
                p.x = lon;
                p.y = lat;
                return p;
            }
            lat = asinz(cosz * this.sin_p14 + p.y * sinz * this.cos_p14 / rh);
            con = Math.abs(this.lat0) - HALF_PI;
            if (Math.abs(con) <= EPSLN) {
                if (this.lat0 >= 0) {
                    lon = adjust_lon(this.long0 + Math.atan2(p.x, -p.y));
                } else {
                    lon = adjust_lon(this.long0 - Math.atan2(-p.x, p.y));
                }
                p.x = lon;
                p.y = lat;
                return p;
            }
            lon = adjust_lon(this.long0 + Math.atan2(p.x * sinz, rh * this.cos_p14 * cosz - p.y * this.sin_p14 * sinz));
            p.x = lon;
            p.y = lat;
            return p;
        }
        var names$27 = ['ortho'];
        var ortho = {
            init: init$26,
            forward: forward$25,
            inverse: inverse$25,
            names: names$27
        };
        var FACE_ENUM = {
            FRONT: 1,
            RIGHT: 2,
            BACK: 3,
            LEFT: 4,
            TOP: 5,
            BOTTOM: 6
        };
        var AREA_ENUM = {
            AREA_0: 1,
            AREA_1: 2,
            AREA_2: 3,
            AREA_3: 4
        };
        function init$27() {
            this.x0 = this.x0 || 0;
            this.y0 = this.y0 || 0;
            this.lat0 = this.lat0 || 0;
            this.long0 = this.long0 || 0;
            this.lat_ts = this.lat_ts || 0;
            this.title = this.title || 'Quadrilateralized Spherical Cube';
            if (this.lat0 >= HALF_PI - FORTPI / 2) {
                this.face = FACE_ENUM.TOP;
            } else if (this.lat0 <= -(HALF_PI - FORTPI / 2)) {
                this.face = FACE_ENUM.BOTTOM;
            } else if (Math.abs(this.long0) <= FORTPI) {
                this.face = FACE_ENUM.FRONT;
            } else if (Math.abs(this.long0) <= HALF_PI + FORTPI) {
                this.face = this.long0 > 0 ? FACE_ENUM.RIGHT : FACE_ENUM.LEFT;
            } else {
                this.face = FACE_ENUM.BACK;
            }
            if (this.es !== 0) {
                this.one_minus_f = 1 - (this.a - this.b) / this.a;
                this.one_minus_f_squared = this.one_minus_f * this.one_minus_f;
            }
        }
        function forward$26(p) {
            var xy = {
                x: 0,
                y: 0
            };
            var lat, lon;
            var theta, phi;
            var t, mu;
            var area = { value: 0 };
            p.x -= this.long0;
            if (this.es !== 0) {
                lat = Math.atan(this.one_minus_f_squared * Math.tan(p.y));
            } else {
                lat = p.y;
            }
            lon = p.x;
            if (this.face === FACE_ENUM.TOP) {
                phi = HALF_PI - lat;
                if (lon >= FORTPI && lon <= HALF_PI + FORTPI) {
                    area.value = AREA_ENUM.AREA_0;
                    theta = lon - HALF_PI;
                } else if (lon > HALF_PI + FORTPI || lon <= -(HALF_PI + FORTPI)) {
                    area.value = AREA_ENUM.AREA_1;
                    theta = lon > 0 ? lon - SPI : lon + SPI;
                } else if (lon > -(HALF_PI + FORTPI) && lon <= -FORTPI) {
                    area.value = AREA_ENUM.AREA_2;
                    theta = lon + HALF_PI;
                } else {
                    area.value = AREA_ENUM.AREA_3;
                    theta = lon;
                }
            } else if (this.face === FACE_ENUM.BOTTOM) {
                phi = HALF_PI + lat;
                if (lon >= FORTPI && lon <= HALF_PI + FORTPI) {
                    area.value = AREA_ENUM.AREA_0;
                    theta = -lon + HALF_PI;
                } else if (lon < FORTPI && lon >= -FORTPI) {
                    area.value = AREA_ENUM.AREA_1;
                    theta = -lon;
                } else if (lon < -FORTPI && lon >= -(HALF_PI + FORTPI)) {
                    area.value = AREA_ENUM.AREA_2;
                    theta = -lon - HALF_PI;
                } else {
                    area.value = AREA_ENUM.AREA_3;
                    theta = lon > 0 ? -lon + SPI : -lon - SPI;
                }
            } else {
                var q, r, s;
                var sinlat, coslat;
                var sinlon, coslon;
                if (this.face === FACE_ENUM.RIGHT) {
                    lon = qsc_shift_lon_origin(lon, +HALF_PI);
                } else if (this.face === FACE_ENUM.BACK) {
                    lon = qsc_shift_lon_origin(lon, +SPI);
                } else if (this.face === FACE_ENUM.LEFT) {
                    lon = qsc_shift_lon_origin(lon, -HALF_PI);
                }
                sinlat = Math.sin(lat);
                coslat = Math.cos(lat);
                sinlon = Math.sin(lon);
                coslon = Math.cos(lon);
                q = coslat * coslon;
                r = coslat * sinlon;
                s = sinlat;
                if (this.face === FACE_ENUM.FRONT) {
                    phi = Math.acos(q);
                    theta = qsc_fwd_equat_face_theta(phi, s, r, area);
                } else if (this.face === FACE_ENUM.RIGHT) {
                    phi = Math.acos(r);
                    theta = qsc_fwd_equat_face_theta(phi, s, -q, area);
                } else if (this.face === FACE_ENUM.BACK) {
                    phi = Math.acos(-q);
                    theta = qsc_fwd_equat_face_theta(phi, s, -r, area);
                } else if (this.face === FACE_ENUM.LEFT) {
                    phi = Math.acos(-r);
                    theta = qsc_fwd_equat_face_theta(phi, s, q, area);
                } else {
                    phi = theta = 0;
                    area.value = AREA_ENUM.AREA_0;
                }
            }
            mu = Math.atan(12 / SPI * (theta + Math.acos(Math.sin(theta) * Math.cos(FORTPI)) - HALF_PI));
            t = Math.sqrt((1 - Math.cos(phi)) / (Math.cos(mu) * Math.cos(mu)) / (1 - Math.cos(Math.atan(1 / Math.cos(theta)))));
            if (area.value === AREA_ENUM.AREA_1) {
                mu += HALF_PI;
            } else if (area.value === AREA_ENUM.AREA_2) {
                mu += SPI;
            } else if (area.value === AREA_ENUM.AREA_3) {
                mu += 1.5 * SPI;
            }
            xy.x = t * Math.cos(mu);
            xy.y = t * Math.sin(mu);
            xy.x = xy.x * this.a + this.x0;
            xy.y = xy.y * this.a + this.y0;
            p.x = xy.x;
            p.y = xy.y;
            return p;
        }
        function inverse$26(p) {
            var lp = {
                lam: 0,
                phi: 0
            };
            var mu, nu, cosmu, tannu;
            var tantheta, theta, cosphi, phi;
            var t;
            var area = { value: 0 };
            p.x = (p.x - this.x0) / this.a;
            p.y = (p.y - this.y0) / this.a;
            nu = Math.atan(Math.sqrt(p.x * p.x + p.y * p.y));
            mu = Math.atan2(p.y, p.x);
            if (p.x >= 0 && p.x >= Math.abs(p.y)) {
                area.value = AREA_ENUM.AREA_0;
            } else if (p.y >= 0 && p.y >= Math.abs(p.x)) {
                area.value = AREA_ENUM.AREA_1;
                mu -= HALF_PI;
            } else if (p.x < 0 && -p.x >= Math.abs(p.y)) {
                area.value = AREA_ENUM.AREA_2;
                mu = mu < 0 ? mu + SPI : mu - SPI;
            } else {
                area.value = AREA_ENUM.AREA_3;
                mu += HALF_PI;
            }
            t = SPI / 12 * Math.tan(mu);
            tantheta = Math.sin(t) / (Math.cos(t) - 1 / Math.sqrt(2));
            theta = Math.atan(tantheta);
            cosmu = Math.cos(mu);
            tannu = Math.tan(nu);
            cosphi = 1 - cosmu * cosmu * tannu * tannu * (1 - Math.cos(Math.atan(1 / Math.cos(theta))));
            if (cosphi < -1) {
                cosphi = -1;
            } else if (cosphi > +1) {
                cosphi = +1;
            }
            if (this.face === FACE_ENUM.TOP) {
                phi = Math.acos(cosphi);
                lp.phi = HALF_PI - phi;
                if (area.value === AREA_ENUM.AREA_0) {
                    lp.lam = theta + HALF_PI;
                } else if (area.value === AREA_ENUM.AREA_1) {
                    lp.lam = theta < 0 ? theta + SPI : theta - SPI;
                } else if (area.value === AREA_ENUM.AREA_2) {
                    lp.lam = theta - HALF_PI;
                } else {
                    lp.lam = theta;
                }
            } else if (this.face === FACE_ENUM.BOTTOM) {
                phi = Math.acos(cosphi);
                lp.phi = phi - HALF_PI;
                if (area.value === AREA_ENUM.AREA_0) {
                    lp.lam = -theta + HALF_PI;
                } else if (area.value === AREA_ENUM.AREA_1) {
                    lp.lam = -theta;
                } else if (area.value === AREA_ENUM.AREA_2) {
                    lp.lam = -theta - HALF_PI;
                } else {
                    lp.lam = theta < 0 ? -theta - SPI : -theta + SPI;
                }
            } else {
                var q, r, s;
                q = cosphi;
                t = q * q;
                if (t >= 1) {
                    s = 0;
                } else {
                    s = Math.sqrt(1 - t) * Math.sin(theta);
                }
                t += s * s;
                if (t >= 1) {
                    r = 0;
                } else {
                    r = Math.sqrt(1 - t);
                }
                if (area.value === AREA_ENUM.AREA_1) {
                    t = r;
                    r = -s;
                    s = t;
                } else if (area.value === AREA_ENUM.AREA_2) {
                    r = -r;
                    s = -s;
                } else if (area.value === AREA_ENUM.AREA_3) {
                    t = r;
                    r = s;
                    s = -t;
                }
                if (this.face === FACE_ENUM.RIGHT) {
                    t = q;
                    q = -r;
                    r = t;
                } else if (this.face === FACE_ENUM.BACK) {
                    q = -q;
                    r = -r;
                } else if (this.face === FACE_ENUM.LEFT) {
                    t = q;
                    q = r;
                    r = -t;
                }
                lp.phi = Math.acos(-s) - HALF_PI;
                lp.lam = Math.atan2(r, q);
                if (this.face === FACE_ENUM.RIGHT) {
                    lp.lam = qsc_shift_lon_origin(lp.lam, -HALF_PI);
                } else if (this.face === FACE_ENUM.BACK) {
                    lp.lam = qsc_shift_lon_origin(lp.lam, -SPI);
                } else if (this.face === FACE_ENUM.LEFT) {
                    lp.lam = qsc_shift_lon_origin(lp.lam, +HALF_PI);
                }
            }
            if (this.es !== 0) {
                var invert_sign;
                var tanphi, xa;
                invert_sign = lp.phi < 0 ? 1 : 0;
                tanphi = Math.tan(lp.phi);
                xa = this.b / Math.sqrt(tanphi * tanphi + this.one_minus_f_squared);
                lp.phi = Math.atan(Math.sqrt(this.a * this.a - xa * xa) / (this.one_minus_f * xa));
                if (invert_sign) {
                    lp.phi = -lp.phi;
                }
            }
            lp.lam += this.long0;
            p.x = lp.lam;
            p.y = lp.phi;
            return p;
        }
        function qsc_fwd_equat_face_theta(phi, y, x, area) {
            var theta;
            if (phi < EPSLN) {
                area.value = AREA_ENUM.AREA_0;
                theta = 0;
            } else {
                theta = Math.atan2(y, x);
                if (Math.abs(theta) <= FORTPI) {
                    area.value = AREA_ENUM.AREA_0;
                } else if (theta > FORTPI && theta <= HALF_PI + FORTPI) {
                    area.value = AREA_ENUM.AREA_1;
                    theta -= HALF_PI;
                } else if (theta > HALF_PI + FORTPI || theta <= -(HALF_PI + FORTPI)) {
                    area.value = AREA_ENUM.AREA_2;
                    theta = theta >= 0 ? theta - SPI : theta + SPI;
                } else {
                    area.value = AREA_ENUM.AREA_3;
                    theta += HALF_PI;
                }
            }
            return theta;
        }
        function qsc_shift_lon_origin(lon, offset) {
            var slon = lon + offset;
            if (slon < -SPI) {
                slon += TWO_PI;
            } else if (slon > +SPI) {
                slon -= TWO_PI;
            }
            return slon;
        }
        var names$28 = [
            'Quadrilateralized Spherical Cube',
            'Quadrilateralized_Spherical_Cube',
            'qsc'
        ];
        var qsc = {
            init: init$27,
            forward: forward$26,
            inverse: inverse$26,
            names: names$28
        };
        var includedProjections = function (proj4) {
            proj4.Proj.projections.add(tmerc);
            proj4.Proj.projections.add(etmerc);
            proj4.Proj.projections.add(utm);
            proj4.Proj.projections.add(sterea);
            proj4.Proj.projections.add(stere);
            proj4.Proj.projections.add(somerc);
            proj4.Proj.projections.add(omerc);
            proj4.Proj.projections.add(lcc);
            proj4.Proj.projections.add(krovak);
            proj4.Proj.projections.add(cass);
            proj4.Proj.projections.add(laea);
            proj4.Proj.projections.add(aea);
            proj4.Proj.projections.add(gnom);
            proj4.Proj.projections.add(cea);
            proj4.Proj.projections.add(eqc);
            proj4.Proj.projections.add(poly);
            proj4.Proj.projections.add(nzmg);
            proj4.Proj.projections.add(mill);
            proj4.Proj.projections.add(sinu);
            proj4.Proj.projections.add(moll);
            proj4.Proj.projections.add(eqdc);
            proj4.Proj.projections.add(vandg);
            proj4.Proj.projections.add(aeqd);
            proj4.Proj.projections.add(ortho);
            proj4.Proj.projections.add(qsc);
        };
        proj4$1.defaultDatum = 'WGS84';
        proj4$1.Proj = Projection$1;
        proj4$1.WGS84 = new proj4$1.Proj('WGS84');
        proj4$1.Point = Point;
        proj4$1.toPoint = toPoint;
        proj4$1.defs = defs;
        proj4$1.transform = transform;
        proj4$1.mgrs = mgrs;
        proj4$1.version = version;
        includedProjections(proj4$1);
        return proj4$1;
    }));
    CommonUtilsRegister = function (Proj4) {
        var Register = {
            isLoaded: false,
            get: function (name) {
                if (name === '' || name === null || typeof name === 'undefined') {
                    return;
                }
                var s = name.split(':');
                if (s.length !== 2) {
                    return;
                }
                var register = s[0];
                var code = s[1];
                if (!this.hasOwnProperty(register)) {
                    return;
                }
                if (!this[register].hasOwnProperty(code)) {
                    return;
                }
                return this[register][code];
            },
            load: function () {
                if (!this.isLoaded) {
                    var registers = [
                        'IGNF',
                        'EPSG',
                        'CRS'
                    ];
                    for (var i = 0; i < registers.length; i++) {
                        var register = registers[i];
                        var codes = this[register];
                        for (var code in codes) {
                            if (codes.hasOwnProperty(code)) {
                                var name = register + ':' + code;
                                Proj4.defs(name, this.get(name));
                            }
                        }
                    }
                    this.isLoaded = true;
                }
            },
            EPSG: {
                4149: '+title=CH1903 +proj=longlat +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +no_defs ',
                4150: '+title=CH1903plus +proj=longlat +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +no_defs ',
                4151: '+title=CHTRF95 +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ',
                4171: '+title=RGF93 +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ',
                4230: '+title=ED50 +proj=longlat +ellps=intl +no_defs ',
                4235: '+title=Guyane Francaise +proj=longlat +ellps=intl +no_defs ',
                4258: '+title=ETRS89 +proj=longlat +ellps=GRS80 +no_defs ',
                4275: '+title=NTF +proj=longlat +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +no_defs ',
                4322: '+title=WGS 72 +proj=longlat +ellps=WGS72 +no_defs ',
                4326: '+title=WGS 84 +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ',
                4467: '+proj=utm +zone=21 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                4470: '+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ',
                4471: '+proj=utm +zone=38 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                4474: '+proj=utm +zone=38 +south +ellps=intl +towgs84=-382,-59,-262,0,0,0,0 +units=m +no_defs ',
                4558: '+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ',
                4559: '+proj=utm +zone=20 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                4621: '+title=Fort Marigot +proj=longlat +ellps=intl +towgs84=137,248,-430,0,0,0,0 +no_defs ',
                4622: '+title=Guadeloupe 1948 +proj=longlat +ellps=intl +no_defs ',
                4623: '+title=CSG67 +proj=longlat +ellps=intl +towgs84=-186,230,110,0,0,0,0 +no_defs ',
                4624: '+title=RGFG95 +proj=longlat +ellps=GRS80 +towgs84=2,2,-2,0,0,0,0 +no_defs ',
                4625: '+title=Martinique 1938 +proj=longlat +ellps=intl +no_defs ',
                4626: '+title=Reunion 1947 +proj=longlat +ellps=intl +no_defs ',
                4627: '+title=RGR92 +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ',
                4628: '+title=Tahiti 52 +proj=longlat +ellps=intl +towgs84=162,117,154,0,0,0,0 +no_defs ',
                4629: '+title=Tahaa 54 +proj=longlat +ellps=intl +no_defs ',
                4630: '+title=IGN72 Nuku Hiva +proj=longlat +ellps=intl +no_defs ',
                4632: '+title=Combani 1950 +proj=longlat +ellps=intl +towgs84=-382,-59,-262,0,0,0,0 +no_defs ',
                4633: '+title=IGN56 Lifou +proj=longlat +ellps=intl +no_defs ',
                4634: '+title=IGN72 Grand Terre +proj=longlat +ellps=intl +no_defs ',
                4637: '+title=Perroud 1950 +proj=longlat +ellps=intl +towgs84=325,154,172,0,0,0,0 +no_defs ',
                4638: '+title=Saint Pierre et Miquelon 1950 +proj=longlat +ellps=clrk66 +towgs84=30,430,368,0,0,0,0 +no_defs ',
                4640: '+title=RRAF 1991 +proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs ',
                4641: '+title=IGN53 Mare +proj=longlat +ellps=intl +no_defs ',
                4645: '+title=RGNC 1991 +proj=longlat +ellps=intl +towgs84=0,0,0,0,0,0,0 +no_defs ',
                4687: '+proj=longlat +ellps=GRS80 +no_defs ',
                4662: '+title=IGN72 Grande Terre +proj=longlat +ellps=intl +no_defs ',
                4689: '+title=IGN63 Hiva Oa +proj=longlat +ellps=intl +no_defs ',
                4690: '+title=Tahiti 79 +proj=longlat +ellps=intl +no_defs ',
                4691: '+title=Moorea 87 +proj=longlat +ellps=intl +towgs84=215.525,149.593,176.229,-3.2624,-1.692,-1.1571,10.4773 +no_defs ',
                4692: '+title=Maupiti 83 +proj=longlat +ellps=intl +towgs84=217.037,86.959,23.956,0,0,0,0 +no_defs ',
                4698: '+title=IGN 1962 Kerguelen +proj=longlat +ellps=intl +towgs84=145,-187,103,0,0,0,0 +no_defs ',
                4749: '+title=RGNC91-93 +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs ',
                4750: '+title=ST87 Ouvea +proj=longlat +ellps=WGS84 +towgs84=-56.263,16.136,-22.856,0,0,0,0 +no_defs ',
                4807: '+title=NTF (Paris) +proj=longlat +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +no_defs ',
                2056: '+title=CH1903+ / LV95 +proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +x_0=2600000 +y_0=1200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs ',
                2154: '+title=RGF93 / Lambert-93 +proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                2213: '+title=ETRS89 / TM 30 NE +proj=tmerc +lat_0=0 +lon_0=30 +k=0.9996 +x_0=500000 +y_0=0 +ellps=GRS80 +units=m +no_defs ',
                2969: '+title=Fort Marigot / UTM zone 20N +proj=utm +zone=20 +ellps=intl +towgs84=137,248,-430,0,0,0,0 +units=m +no_defs ',
                2970: '+title=Guadeloupe 1948 / UTM zone 20N +proj=utm +zone=20 +ellps=intl +units=m +no_defs ',
                2971: '+title=CSG67 / UTM zone 22N +proj=utm +zone=22 +ellps=intl +towgs84=-186,230,110,0,0,0,0 +units=m +no_defs ',
                2972: '+title=RGFG95 / UTM zone 22N +proj=utm +zone=22 +ellps=GRS80 +towgs84=2,2,-2,0,0,0,0 +units=m +no_defs ',
                2973: '+title=Martinique 1938 / UTM zone 20N +proj=utm +zone=20 +ellps=intl +units=m +no_defs ',
                2975: '+title=RGR92 / UTM zone 40S +proj=utm +zone=40 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                2976: '+title=Tahiti 52 / UTM zone 6S +proj=utm +zone=6 +south +ellps=intl +towgs84=162,117,154,0,0,0,0 +units=m +no_defs ',
                2977: '+title=Tahaa 54 / UTM zone 5S +proj=utm +zone=5 +south +ellps=intl +units=m +no_defs ',
                2978: '+title=IGN72 Nuku Hiva / UTM zone 7S +proj=utm +zone=7 +south +ellps=intl +units=m +no_defs ',
                2980: '+title=Combani 1950 / UTM zone 38S +proj=utm +zone=38 +south +ellps=intl +towgs84=-382,-59,-262,0,0,0,0 +units=m +no_defs ',
                2981: '+title=IGN56 Lifou / UTM zone 58S +proj=utm +zone=58 +south +ellps=intl +units=m +no_defs ',
                2982: '+title=IGN72 Grand Terre / UTM zone 58S (deprecated) +proj=utm +zone=58 +south +ellps=intl +units=m +no_defs ',
                2984: '+title=RGNC 1991 / Lambert New Caledonia (deprecated) +proj=lcc +lat_1=-20.66666666666667 +lat_2=-22.33333333333333 +lat_0=-21.5 +lon_0=166 +x_0=400000 +y_0=300000 +ellps=intl +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                2986: '+title=Terre Adelie 1950 +proj=stere +towgs84=324.9120,153.2820,172.0260 +a=6378388.0000 +rf=297.0000000000000 +lat_0=-90.000000000 +lon_0=140.000000000 +lat_ts=-67.000000000 +k=0.96027295 +x_0=300000.000 +y_0=-2299363.482 +units=m +no_defs',
                2987: '+title=Saint Pierre et Miquelon 1950 / UTM zone 21N +proj=utm +zone=21 +ellps=clrk66 +towgs84=30,430,368,0,0,0,0 +units=m +no_defs ',
                2989: '+title=RRAF 1991 / UTM zone 20N +proj=utm +zone=20 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                2990: '+title=Reunion 1947 / TM Reunion (deprecated) +proj=tmerc +lat_0=-21.11666666666667 +lon_0=55.53333333333333 +k=1 +x_0=50000 +y_0=160000 +ellps=intl +units=m +no_defs ',
                2995: '+title=IGN53 Mare / UTM zone 58S +proj=utm +zone=58 +south +ellps=intl +units=m +no_defs ',
                3038: '+proj=utm +zone=26 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                3039: '+proj=utm +zone=27 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                3040: '+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                3041: '+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                3045: '+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                3046: '+proj=utm +zone=34 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                3047: '+proj=utm +zone=35 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                3048: '+proj=utm +zone=36 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                3049: '+proj=utm +zone=37 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                3050: '+proj=utm +zone=38 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                3051: '+proj=utm +zone=39 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                3034: '+title=ETRS89 / ETRS-LCC +proj=lcc +lat_1=35 +lat_2=65 +lat_0=52 +lon_0=10 +x_0=4000000 +y_0=2800000 +ellps=GRS80 +units=m +no_defs ',
                3035: '+title=ETRS89 / ETRS-LAEA +proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs ',
                3042: '+title=ETRS89 / ETRS-TM30 +proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs ',
                3043: '+title=ETRS89 / ETRS-TM31 +proj=utm +zone=31 +ellps=GRS80 +units=m +no_defs ',
                3044: '+title=ETRS89 / ETRS-TM32 +proj=utm +zone=32 +ellps=GRS80 +units=m +no_defs ',
                25828: '+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                25829: '+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                25833: '+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                25834: '+proj=utm +zone=34 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                25835: '+proj=utm +zone=35 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                25836: '+proj=utm +zone=36 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                25837: '+proj=utm +zone=37 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                25838: '+proj=utm +zone=38 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                3060: '+title=IGN72 Grande Terre / UTM zone 58S +proj=utm +zone=58 +south +ellps=intl +units=m +no_defs ',
                3163: '+title=RGNC91-93 / Lambert New Caledonia +proj=lcc +lat_1=-20.66666666666667 +lat_2=-22.33333333333333 +lat_0=-21.5 +lon_0=166 +x_0=400000 +y_0=300000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                3164: '+title=ST87 Ouvea / UTM zone 58S +proj=utm +zone=58 +south +ellps=WGS84 +towgs84=-56.263,16.136,-22.856,0,0,0,0 +units=m +no_defs ',
                3165: '+title=NEA74 Noumea / Noumea Lambert +proj=lcc +lat_1=-22.24469175 +lat_2=-22.29469175 +lat_0=-22.26969175 +lon_0=166.44242575 +x_0=0.66 +y_0=1.02 +ellps=intl +units=m +no_defs ',
                3166: '+title=NEA74 Noumea / Noumea Lambert 2 +proj=lcc +lat_1=-22.24472222222222 +lat_2=-22.29472222222222 +lat_0=-22.26972222222222 +lon_0=166.4425 +x_0=8.313000000000001 +y_0=-2.354 +ellps=intl +units=m +no_defs ',
                3169: '+title=RGNC91-93 / UTM zone 57S +proj=utm +zone=57 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                3170: '+title=RGNC91-93 / UTM zone 58S +proj=utm +zone=58 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                3171: '+title=RGNC91-93 / UTM zone 59S +proj=utm +zone=59 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ',
                3172: '+title=IGN53 Mare / UTM zone 59S +proj=utm +zone=59 +south +ellps=intl +units=m +no_defs ',
                3296: '+title=RGPF / UTM zone 5S +proj=utm +zone=5 +south +ellps=GRS80 +units=m +no_defs ',
                3297: '+title=RGPF / UTM zone 6S +proj=utm +zone=6 +south +ellps=GRS80 +units=m +no_defs ',
                3298: '+title=RGPF / UTM zone 7S +proj=utm +zone=7 +south +ellps=GRS80 +units=m +no_defs ',
                3299: '+title=RGPF / UTM zone 8S +proj=utm +zone=8 +south +ellps=GRS80 +units=m +no_defs ',
                3302: '+title=IGN63 Hiva Oa / UTM zone 7S +proj=utm +zone=7 +south +ellps=intl +units=m +no_defs ',
                3303: '+title=Fatu Iva 72 / UTM zone 7S +proj=utm +zone=7 +south +ellps=intl +towgs84=347.103,1078.12,2623.92,-33.8875,70.6773,-9.3943,186.074 +units=m +no_defs ',
                3304: '+title=Tahiti 79 / UTM zone 6S +proj=utm +zone=6 +south +ellps=intl +units=m +no_defs ',
                3305: '+title=Moorea 87 / UTM zone 6S +proj=utm +zone=6 +south +ellps=intl +towgs84=215.525,149.593,176.229,-3.2624,-1.692,-1.1571,10.4773 +units=m +no_defs ',
                3306: '+title=Maupiti 83 / UTM zone 5S +proj=utm +zone=5 +south +ellps=intl +towgs84=217.037,86.959,23.956,0,0,0,0 +units=m +no_defs ',
                3312: '+title=CSG67 / UTM zone 21N +proj=utm +zone=21 +ellps=intl +towgs84=-186,230,110,0,0,0,0 +units=m +no_defs ',
                3313: '+title=RGFG95 / UTM zone 21N +proj=utm +zone=21 +ellps=GRS80 +towgs84=2,2,-2,0,0,0,0 +units=m +no_defs ',
                3336: '+title=IGN 1962 Kerguelen / UTM zone 42S +proj=utm +zone=42 +south +ellps=intl +towgs84=145,-187,103,0,0,0,0 +units=m +no_defs ',
                3395: '+title=WGS 84 / World Mercator +proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                3727: '+title=Reunion 1947 / TM Reunion +proj=tmerc +lat_0=-21.11666666666667 +lon_0=55.53333333333333 +k=1 +x_0=160000 +y_0=50000 +ellps=intl +units=m +no_defs ',
                21781: '+title=CH1903 / LV03 +proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +x_0=600000 +y_0=200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs ',
                25830: '+title=ETRS89 / UTM zone 30N +proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs ',
                25831: '+title=ETRS89 / UTM zone 31N +proj=utm +zone=31 +ellps=GRS80 +units=m +no_defs ',
                25832: '+title=ETRS89 / UTM zone 32N +proj=utm +zone=32 +ellps=GRS80 +units=m +no_defs ',
                27561: '+title=NTF (Paris) / Lambert Nord France +proj=lcc +lat_1=49.50000000000001 +lat_0=49.50000000000001 +lon_0=0 +k_0=0.999877341 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ',
                27562: '+title=NTF (Paris) / Lambert Centre France +proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ',
                27563: '+title=NTF (Paris) / Lambert Sud France +proj=lcc +lat_1=44.10000000000001 +lat_0=44.10000000000001 +lon_0=0 +k_0=0.9998774990000001 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ',
                27564: '+title=NTF (Paris) / Lambert Corse +proj=lcc +lat_1=42.16500000000001 +lat_0=42.16500000000001 +lon_0=0 +k_0=0.9999447100000001 +x_0=234.358 +y_0=185861.369 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ',
                27571: '+title=NTF (Paris) / Lambert zone I +proj=lcc +lat_1=49.50000000000001 +lat_0=49.50000000000001 +lon_0=0 +k_0=0.999877341 +x_0=600000 +y_0=1200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ',
                27572: '+title=NTF (Paris) / Lambert zone II +proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=2200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ',
                27573: '+title=NTF (Paris) / Lambert zone III +proj=lcc +lat_1=44.10000000000001 +lat_0=44.10000000000001 +lon_0=0 +k_0=0.9998774990000001 +x_0=600000 +y_0=3200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ',
                27574: '+title=NTF (Paris) / Lambert zone IV +proj=lcc +lat_1=42.16500000000001 +lat_0=42.16500000000001 +lon_0=0 +k_0=0.9999447100000001 +x_0=234.358 +y_0=4185861.369 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ',
                27581: '+title=NTF (Paris) / France I (deprecated) +proj=lcc +lat_1=49.50000000000001 +lat_0=49.50000000000001 +lon_0=0 +k_0=0.999877341 +x_0=600000 +y_0=1200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ',
                27582: '+title=NTF (Paris) / France II (deprecated) +proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=2200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ',
                27583: '+title=NTF (Paris) / France III (deprecated) +proj=lcc +lat_1=44.10000000000001 +lat_0=44.10000000000001 +lon_0=0 +k_0=0.9998774990000001 +x_0=600000 +y_0=3200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ',
                27584: '+title=NTF (Paris) / France IV (deprecated) +proj=lcc +lat_1=42.16500000000001 +lat_0=42.16500000000001 +lon_0=0 +k_0=0.9999447100000001 +x_0=234.358 +y_0=4185861.369 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ',
                27591: '+title=NTF (Paris) / Nord France (deprecated) +proj=lcc +lat_1=49.50000000000001 +lat_0=49.50000000000001 +lon_0=0 +k_0=0.999877341 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ',
                27592: '+title=NTF (Paris) / Centre France (deprecated) +proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ',
                27593: '+title=NTF (Paris) / Sud France (deprecated) +proj=lcc +lat_1=44.10000000000001 +lat_0=44.10000000000001 +lon_0=0 +k_0=0.9998774990000001 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ',
                27594: '+title=NTF (Paris) / Corse (deprecated) +proj=lcc +lat_1=42.16500000000001 +lat_0=42.16500000000001 +lon_0=0 +k_0=0.9999447100000001 +x_0=234.358 +y_0=185861.369 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs ',
                32601: '+proj=utm +zone=1 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32602: '+proj=utm +zone=2 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32603: '+proj=utm +zone=3 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32604: '+proj=utm +zone=4 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32605: '+proj=utm +zone=5 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32606: '+proj=utm +zone=6 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32607: '+proj=utm +zone=7 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32608: '+proj=utm +zone=8 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32609: '+proj=utm +zone=9 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32610: '+proj=utm +zone=10 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32611: '+proj=utm +zone=11 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32612: '+proj=utm +zone=12 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32613: '+proj=utm +zone=13 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32614: '+proj=utm +zone=14 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32615: '+proj=utm +zone=15 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32616: '+proj=utm +zone=16 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32617: '+proj=utm +zone=17 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32618: '+proj=utm +zone=18 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32619: '+proj=utm +zone=19 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32620: '+proj=utm +zone=20 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32621: '+proj=utm +zone=21 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32622: '+proj=utm +zone=22 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32623: '+proj=utm +zone=23 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32624: '+proj=utm +zone=24 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32625: '+proj=utm +zone=25 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32626: '+proj=utm +zone=26 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32627: '+proj=utm +zone=27 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32628: '+proj=utm +zone=28 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32629: '+proj=utm +zone=29 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32630: '+proj=utm +zone=30 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32631: '+proj=utm +zone=31 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32632: '+proj=utm +zone=32 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32633: '+proj=utm +zone=33 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32634: '+proj=utm +zone=34 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32635: '+proj=utm +zone=35 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32636: '+proj=utm +zone=36 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32637: '+proj=utm +zone=37 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32638: '+proj=utm +zone=38 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32639: '+proj=utm +zone=39 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32640: '+proj=utm +zone=40 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32641: '+proj=utm +zone=41 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32642: '+proj=utm +zone=42 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32643: '+proj=utm +zone=43 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32644: '+proj=utm +zone=44 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32645: '+proj=utm +zone=45 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32646: '+proj=utm +zone=46 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32647: '+proj=utm +zone=47 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32648: '+proj=utm +zone=48 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32649: '+proj=utm +zone=49 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32650: '+proj=utm +zone=50 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32651: '+proj=utm +zone=51 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32652: '+proj=utm +zone=52 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32653: '+proj=utm +zone=53 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32654: '+proj=utm +zone=54 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32655: '+proj=utm +zone=55 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32656: '+proj=utm +zone=56 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32657: '+proj=utm +zone=57 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32658: '+proj=utm +zone=58 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32659: '+proj=utm +zone=59 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32660: '+proj=utm +zone=60 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32661: '+proj=stere +lat_0=90 +lat_ts=90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32662: '+title=WGS 84 / Plate Carree +proj=eqc +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32701: '+proj=utm +zone=1 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32702: '+proj=utm +zone=2 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32703: '+proj=utm +zone=3 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32704: '+proj=utm +zone=4 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32705: '+proj=utm +zone=5 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32706: '+proj=utm +zone=6 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32707: '+proj=utm +zone=7 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32708: '+proj=utm +zone=8 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32709: '+proj=utm +zone=9 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32710: '+proj=utm +zone=10 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32711: '+proj=utm +zone=11 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32712: '+proj=utm +zone=12 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32713: '+proj=utm +zone=13 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32714: '+proj=utm +zone=14 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32715: '+proj=utm +zone=15 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32716: '+proj=utm +zone=16 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32717: '+proj=utm +zone=17 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32718: '+proj=utm +zone=18 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32719: '+proj=utm +zone=19 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32720: '+proj=utm +zone=20 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32721: '+proj=utm +zone=21 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32722: '+proj=utm +zone=22 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32723: '+proj=utm +zone=23 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32724: '+proj=utm +zone=24 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32725: '+proj=utm +zone=25 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32726: '+proj=utm +zone=26 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32727: '+proj=utm +zone=27 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32728: '+proj=utm +zone=28 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32729: '+proj=utm +zone=29 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32730: '+proj=utm +zone=30 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32731: '+proj=utm +zone=31 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32732: '+proj=utm +zone=32 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32733: '+proj=utm +zone=33 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32734: '+proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32735: '+proj=utm +zone=35 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32736: '+proj=utm +zone=36 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32737: '+proj=utm +zone=37 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32738: '+proj=utm +zone=38 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32739: '+proj=utm +zone=39 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32740: '+proj=utm +zone=40 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32741: '+proj=utm +zone=41 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32742: '+proj=utm +zone=42 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32743: '+proj=utm +zone=43 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32744: '+proj=utm +zone=44 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32745: '+proj=utm +zone=45 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32746: '+proj=utm +zone=46 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32747: '+proj=utm +zone=47 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32748: '+proj=utm +zone=48 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32749: '+proj=utm +zone=49 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32750: '+proj=utm +zone=50 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32751: '+proj=utm +zone=51 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32752: '+proj=utm +zone=52 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32753: '+proj=utm +zone=53 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32754: '+proj=utm +zone=54 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32755: '+proj=utm +zone=55 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32756: '+proj=utm +zone=56 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32757: '+proj=utm +zone=57 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32758: '+proj=utm +zone=58 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32759: '+proj=utm +zone=59 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32760: '+proj=utm +zone=60 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                32761: '+proj=stere +lat_0=-90 +lat_ts=-90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +ellps=WGS84 +datum=WGS84 +units=m +no_defs ',
                310024802: '+title=Geoportail - France metropolitaine +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=46.500000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                310915814: '+title=Geoportail - Antilles francaises +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=15.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                310486805: '+title=Geoportail - Guyane +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=4.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                310700806: '+title=Geoportail - Reunion et dependances +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-21.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                310702807: '+title=Geoportail - Mayotte +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-12.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                310706808: '+title=Geoportail - Saint-Pierre et Miquelon +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=47.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                310547809: '+title=Geoportail - Nouvelle-Caledonie +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-22.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                310642810: '+title=Geoportail - Wallis et Futuna +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000,0.0000,0.0000,0.0000,0.000000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-14.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                310032811: '+title=Geoportail - Polynesie francaise +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-15.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                310642812: '+title=Geoportail - Kerguelen +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-49.500000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                310642801: '+title=Geoportail - Crozet +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-46.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                310642813: '+title=Geoportail - Amsterdam et Saint-Paul +proj=eqc +nadgrids=null +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-38.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                310642901: '+title=Geoportail - Monde +proj=mill +towgs84=0.0000,0.0000,0.0000,0.0000,0.0000,0.0000,0.000000 +a=6378137.0000 +rf=298.2572221010000 +lon_0=0.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                5489: '+title=RGAF09 geographiques (dms) +proj=longlat +nadgrids=@null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137 +rf=298.257222101 +units=m +no_defs',
                5490: '+title=RGAF09 UTM Nord Fuseau 20 +proj=tmerc +nadgrids=@null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137 +rf=298.257222101 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs'
            },
            CRS: { 84: '+title=WGS 84 longitude-latitude +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ' },
            IGNF: {
                AMST63: '+title=Amsterdam 1963 +proj=geocent +towgs84=109.753,-528.133,-362.244,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                CROZ63: '+title=Crozet 1963 +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                CSG67: '+title=Guyane CSG67 +proj=geocent +towgs84=-193.0660,236.9930,105.4470,0.4814,-0.8074,0.1276,1.564900 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                ED50: '+title=ED50 +proj=geocent +towgs84=-84.0000,-97.0000,-117.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                ETRS89: '+title=Systeme de reference terrestre Europeen (1989) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                GUAD48: '+title=Guadeloupe Ste Anne +proj=geocent +towgs84=-472.2900,-5.6300,-304.1200,0.4362,-0.8374,0.2563,1.898400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                GUADFM49: '+title=Guadeloupe Fort Marigot +proj=geocent +towgs84=136.5960,248.1480,-429.7890 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                IGN63: '+title=IGN 1963 (Hiva Oa, Tahuata, Mohotani) +proj=geocent +towgs84=410.7210,55.0490,80.7460,-2.5779,-2.3514,-0.6664,17.331100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                IGN72: '+title=IGN 1972 Grande-Terre / Ile des Pins +proj=geocent +towgs84=-11.6400,-348.6000,291.6800 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                KERG62CAR: '+title=Kerguelen - K0 +proj=geocent +towgs84=144.8990,-186.7700,100.9230 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                MART38: '+title=Martinique Fort-Desaix +proj=geocent +towgs84=126.9260,547.9390,130.4090,-2.7867,5.1612,-0.8584,13.822650 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                MAYO50: '+title=Mayotte Combani +proj=geocent +towgs84=-599.9280,-275.5520,-195.6650,-0.0835,-0.4715,0.0602,49.281400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                MOOREA87: '+title=Moorea 1987 +proj=geocent +towgs84=215.9820,149.5930,176.2290,3.2624,1.6920,1.1571,10.477300 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                NTF: '+title=Nouvelle Triangulation Francaise +proj=geocent +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +units=m +no_defs',
                NUKU72: '+title=IGN 1972 Nuku Hiva +proj=geocent +towgs84=165.7320,216.7200,180.5050,-0.6434,-0.4512,-0.0791,7.420400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                REUN47: '+title=Reunion 1947 +proj=geocent +towgs84=789.5240,-626.4860,-89.9040,0.6006,76.7946,-10.5788,-32.324100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                RGF93: '+title=Reseau geodesique francais 1993 +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                RGFG95: '+title=Reseau geodesique francais de Guyane 1995 +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                RGM04: '+title=RGM04 (Reseau Geodesique de Mayotte 2004) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                RGNC: '+title=Reseau Geodesique de Nouvelle-Caledonie +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                RGPF: '+title=RGPF (Reseau Geodesique de Polynesie Francaise) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                RGR92: '+title=Reseau geodesique Reunion 1992 +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                RGSPM06: '+title=Reseau Geodesique Saint-Pierre-et-Miquelon (2006) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                RGTAAF07: '+title=Reseau Geodesique des TAAF (2007) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                RRAF91: '+title=RRAF 1991 (Reseau de Reference des Antilles Francaises) +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                STPL69: '+title=Saint-Paul 1969 +proj=geocent +towgs84=225.571,-346.608,-46.567,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                STPM50: '+title=St Pierre et Miquelon 1950 +proj=geocent +towgs84=-95.5930,573.7630,173.4420,-0.9602,1.2510,-1.3918,42.626500 +a=6378206.4000 +rf=294.9786982000000 +units=m +no_defs',
                TAHAA: '+title=Raiatea - Tahaa 51-54 (Tahaa, Base Terme Est) +proj=geocent +towgs84=72.4380,345.9180,79.4860,-1.6045,-0.8823,-0.5565,1.374600 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                TAHI79: '+title=IGN79 (Tahiti) Iles de la Societe +proj=geocent +towgs84=221.5250,152.9480,176.7680,2.3847,1.3896,0.8770,11.474100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                TERA50: '+title=Pointe Geologie - Perroud 1950 +proj=geocent +towgs84=324.9120,153.2820,172.0260 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                WALL78: '+title=Wallis-Uvea 1978 (MOP78) +proj=geocent +towgs84=253.0000,-133.0000,-127.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                WGS72: '+title=World Geodetic System 1972 +proj=geocent +towgs84=0.0000,12.0000,6.0000 +a=6378135.0000 +rf=298.2600000000000 +units=m +no_defs',
                WGS84: '+title=World Geodetic System 1984 +proj=geocent +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                AMST63GEO: '+title=Amsterdam 1963 +proj=longlat +towgs84=109.753,-528.133,-362.244,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                CROZ63GEO: '+title=Crozet 1963 +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                CSG67GEO: '+title=Guyane CSG67 +proj=longlat +towgs84=-193.0660,236.9930,105.4470,0.4814,-0.8074,0.1276,1.564900 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                ED50G: '+title=ED50 +proj=longlat +towgs84=-84.0000,-97.0000,-117.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                GUAD48GEO: '+title=Guadeloupe Ste Anne +proj=longlat +towgs84=-472.2900,-5.6300,-304.1200,0.4362,-0.8374,0.2563,1.898400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                GUADFM49GEO: '+title=Guadeloupe Fort Marigot +proj=longlat +towgs84=136.5960,248.1480,-429.7890 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                IGN63GEO: '+title=IGN 1963 (Hiva Oa, Tahuata, Mohotani) +proj=longlat +towgs84=410.7210,55.0490,80.7460,-2.5779,-2.3514,-0.6664,17.331100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                IGN72GEO: '+title=IGN 1972 Grande-Terre / Ile des Pins +proj=longlat +towgs84=-11.6400,-348.6000,291.6800 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                KERG62GEO: '+title=Kerguelen - K0 +proj=longlat +towgs84=144.8990,-186.7700,100.9230 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                MART38GEO: '+title=Martinique Fort-Desaix +proj=longlat +towgs84=126.9260,547.9390,130.4090,-2.7867,5.1612,-0.8584,13.822650 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                MAYO50GEO: '+title=Mayotte Combani +proj=longlat +towgs84=-599.9280,-275.5520,-195.6650,-0.0835,-0.4715,0.0602,49.281400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                MOOREA87GEO: '+title=Moorea 1987 +proj=longlat +towgs84=215.9820,149.5930,176.2290,3.2624,1.6920,1.1571,10.477300 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                NTFG: '+title=Nouvelle Triangulation Francaise Greenwich degres sexagesimaux +proj=longlat +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +units=m +no_defs',
                NTFP: '+title=Nouvelle Triangulation Francaise Paris grades +proj=longlat +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +units=m +no_defs',
                NUKU72GEO: '+title=IGN 1972 Nuku Hiva +proj=longlat +towgs84=165.7320,216.7200,180.5050,-0.6434,-0.4512,-0.0791,7.420400 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                REUN47GEO: '+title=Reunion 1947 +proj=longlat +towgs84=789.5240,-626.4860,-89.9040,0.6006,76.7946,-10.5788,-32.324100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                RGF93G: '+title=Reseau geodesique francais 1993 +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                RGFG95GEO: '+title=Reseau geodesique francais de Guyane 1995 +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                RGM04GEO: '+title=RGM04 (Reseau Geodesique de Mayotte 2004) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                RGNCGEO: '+title=Reseau Geodesique de Nouvelle-Caledonie +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                RGPFGEO: '+title=RGPF (Reseau Geodesique de Polynesie Francaise) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                RGR92GEO: '+title=Reseau geodesique de la Reunion 1992 +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                RGSPM06GEO: '+title=Saint-Pierre-et-Miquelon (2006) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                RGTAAF07G: '+title=Reseau Geodesique des TAAF (2007) (dms) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                STPL69GEO: '+title=Saint-Paul 1969 +proj=longlat +towgs84=225.571,-346.608,-46.567,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                STPM50GEO: '+title=St Pierre et Miquelon 1950  +proj=longlat +towgs84=-95.5930,573.7630,173.4420,-0.9602,1.2510,-1.3918,42.626500 +a=6378206.4000 +rf=294.9786982000000 +units=m +no_defs',
                TAHAAGEO: '+title=Raiatea - Tahaa 51-54 (Tahaa, Base Terme Est) +proj=longlat +towgs84=72.4380,345.9180,79.4860,-1.6045,-0.8823,-0.5565,1.374600 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                TAHI79GEO: '+title=IGN79 (Tahiti) Iles de la Societe +proj=longlat +towgs84=221.5250,152.9480,176.7680,2.3847,1.3896,0.8770,11.474100 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                TERA50G: '+title=Pointe Geologie - Perroud 1950 +proj=longlat +towgs84=324.9120,153.2820,172.0260 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                WALL78GEO: '+title=Wallis - Uvea 1978 (MOP78) +proj=longlat +towgs84=253.0000,-133.0000,-127.0000 +a=6378388.0000 +rf=297.0000000000000 +units=m +no_defs',
                WGS72G: '+title=WGS72 +proj=longlat +towgs84=0.0000,12.0000,6.0000 +a=6378135.0000 +rf=298.2600000000000 +units=m +no_defs',
                WGS84G: '+title=World Geodetic System 1984 +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                WGS84RRAFGEO: '+title=Reseau de reference des Antilles francaises (1988-1991) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                XGEO: '+title=Systeme CIO-BIH +proj=longlat +towgs84=0.0000,0.0000,0.5000,0.0000,0.0000,0.0140,-0.100000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                AMST63UTM43S: '+title=Amsterdam 1963 UTM fuseau 43 Sud +proj=tmerc +towgs84=109.753,-528.133,-362.244,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=75.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                CROZ63UTM39S: '+title=Crozet 1963 +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=51.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                CSG67UTM21: '+title=Guyane CSG67 UTM fuseau 21 +proj=tmerc +towgs84=-193.0660,236.9930,105.4470,0.4814,-0.8074,0.1276,1.564900 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-57.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                CSG67UTM22: '+title=Guyane CSG67 UTM fuseau 22 +proj=tmerc +towgs84=-193.0660,236.9930,105.4470,0.4814,-0.8074,0.1276,1.564900 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-51.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                GEOPORTALANF: '+title=Geoportail - Antilles francaises +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=15.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                GEOPORTALASP: '+title=Geoportail - Amsterdam et Saint-Paul +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-38.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                GEOPORTALCRZ: '+title=Geoportail - Crozet +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-46.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                GEOPORTALFXX: '+title=Geoportail - France metropolitaine +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=46.500000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                GEOPORTALGUF: '+title=Geoportail - Guyane +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=4.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                GEOPORTALKER: '+title=Geoportail - Kerguelen +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-49.500000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                GEOPORTALMYT: '+title=Geoportail - Mayotte +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-12.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                GEOPORTALNCL: '+title=Geoportail - Nouvelle-Caledonie +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-22.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                GEOPORTALPYF: '+title=Geoportail - Polynesie francaise +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-15.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                GEOPORTALREU: '+title=Geoportail - Reunion et dependances +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-21.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                GEOPORTALSPM: '+title=Geoportail - Saint-Pierre et Miquelon +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=47.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                GEOPORTALWLF: '+title=Geoportail - Wallis et Futuna +proj=eqc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=0.000000000 +lat_ts=-14.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                GUAD48UTM20: '+title=Guadeloupe Ste Anne +proj=tmerc +towgs84=-472.2900,-5.6300,-304.1200,0.4362,-0.8374,0.2563,1.898400 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                GUADFM49U20: '+title=Guadeloupe Fort Marigot  +proj=tmerc +towgs84=136.5960,248.1480,-429.7890 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                IGN63UTM7S: '+title=IGN 1963 - Hiva Oa, Tahuata, Mohotani - UTM fuseau 7 Sud +proj=tmerc +towgs84=410.7210,55.0490,80.7460,-2.5779,-2.3514,-0.6664,17.331100 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-141.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                IGN72UTM58S: '+title=IGN 1972 - UTM fuseau 58 Sud +proj=tmerc +towgs84=-11.6400,-348.6000,291.6800 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=165.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                KERG62UTM42S: '+title=Kerguelen 1962 +proj=tmerc +towgs84=144.8990,-186.7700,100.9230 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=69.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                LAMB1: '+title=Lambert I +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=49.500000000 +lon_0=0.000000000 +k_0=0.99987734 +lat_1=49.500000000 +x_0=600000.000 +y_0=200000.000 +units=m +no_defs',
                LAMB1C: '+title=Lambert I Carto +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=49.500000000 +lon_0=0.000000000 +k_0=0.99987734 +lat_1=49.500000000 +x_0=600000.000 +y_0=1200000.000 +units=m +no_defs',
                LAMB2: '+title=Lambert II +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=46.800000000 +lon_0=0.000000000 +k_0=0.99987742 +lat_1=46.800000000 +x_0=600000.000 +y_0=200000.000 +units=m +no_defs',
                LAMB2C: '+title=Lambert II Carto +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=46.800000000 +lon_0=0.000000000 +k_0=0.99987742 +lat_1=46.800000000 +x_0=600000.000 +y_0=2200000.000 +units=m +no_defs',
                LAMB3: '+title=Lambert III +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=44.100000000 +lon_0=0.000000000 +k_0=0.99987750 +lat_1=44.100000000 +x_0=600000.000 +y_0=200000.000 +units=m +no_defs',
                LAMB3C: '+title=Lambert III Carto +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=44.100000000 +lon_0=0.000000000 +k_0=0.99987750 +lat_1=44.100000000 +x_0=600000.000 +y_0=3200000.000 +units=m +no_defs',
                LAMB4: '+title=Lambert IV +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=42.165000000 +lon_0=0.000000000 +k_0=0.99994471 +lat_1=42.165000000 +x_0=234.358 +y_0=185861.369 +units=m +no_defs',
                LAMB4C: '+title=Lambert IV Carto +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=42.165000000 +lon_0=0.000000000 +k_0=0.99994471 +lat_1=42.165000000 +x_0=234.358 +y_0=4185861.369 +units=m +no_defs',
                LAMB93: '+title=Lambert 93 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=46.500000000 +lon_0=3.000000000 +lat_1=44.000000000 +lat_2=49.000000000 +x_0=700000.000 +y_0=6600000.000 +units=m +no_defs',
                RGF93CC42: '+title=Lambert conique conforme Zone 1 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=42.000000000 +lon_0=3.000000000 +lat_1=41.200000000 +lat_2=42.800000000 +x_0=1700000.000 +y_0=1200000.000 +units=m +no_defs',
                RGF93CC43: '+title=Lambert conique conforme Zone 2 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=43.000000000 +lon_0=3.000000000 +lat_1=42.200000000 +lat_2=43.800000000 +x_0=1700000.000 +y_0=2200000.000 +units=m +no_defs',
                RGF93CC44: '+title=Lambert conique conforme Zone 3 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=44.000000000 +lon_0=3.000000000 +lat_1=43.200000000 +lat_2=44.800000000 +x_0=1700000.000 +y_0=3200000.000 +units=m +no_defs',
                RGF93CC45: '+title=Lambert conique conforme Zone 4 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=45.000000000 +lon_0=3.000000000 +lat_1=44.200000000 +lat_2=45.800000000 +x_0=1700000.000 +y_0=4200000.000 +units=m +no_defs',
                RGF93CC46: '+title=Lambert conique conforme Zone 5 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=46.000000000 +lon_0=3.000000000 +lat_1=45.200000000 +lat_2=46.800000000 +x_0=1700000.000 +y_0=5200000.000 +units=m +no_defs',
                RGF93CC47: '+title=Lambert conique conforme Zone 6 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=47.000000000 +lon_0=3.000000000 +lat_1=46.200000000 +lat_2=47.800000000 +x_0=1700000.000 +y_0=6200000.000 +units=m +no_defs',
                RGF93CC48: '+title=Lambert conique conforme Zone 7 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=48.000000000 +lon_0=3.000000000 +lat_1=47.200000000 +lat_2=48.800000000 +x_0=1700000.000 +y_0=7200000.000 +units=m +no_defs',
                RGF93CC49: '+title=Lambert conique conforme Zone 8 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=49.000000000 +lon_0=3.000000000 +lat_1=48.200000000 +lat_2=49.800000000 +x_0=1700000.000 +y_0=8200000.000 +units=m +no_defs',
                RGF93CC50: '+title=Lambert conique conforme Zone 9 +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=50.000000000 +lon_0=3.000000000 +lat_1=49.200000000 +lat_2=50.800000000 +x_0=1700000.000 +y_0=9200000.000 +units=m +no_defs',
                LAMBE: '+title=Lambert II etendu +proj=lcc +nadgrids=ntf_r93.gsb,null +wktext +towgs84=-168.0000,-60.0000,320.0000 +a=6378249.2000 +rf=293.4660210000000 +pm=2.337229167 +lat_0=46.800000000 +lon_0=0.000000000 +k_0=0.99987742 +lat_1=46.800000000 +x_0=600000.000 +y_0=2200000.000 +units=m +no_defs',
                MART38UTM20: '+title=Martinique Fort-Desaix +proj=tmerc +towgs84=126.9260,547.9390,130.4090,-2.7867,5.1612,-0.8584,13.822650 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                MAYO50UTM38S: '+title=Mayotte Combani +proj=tmerc +towgs84=-599.9280,-275.5520,-195.6650,-0.0835,-0.4715,0.0602,49.281400 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=45.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                MILLER: '+title=Geoportail - Monde +proj=mill +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lon_0=0.000000000 +x_0=0.000 +y_0=0.000 +units=m +no_defs',
                MOOREA87U6S: '+title=Moorea 1987 - UTM fuseau 6 Sud +proj=tmerc +towgs84=215.9820,149.5930,176.2290,3.2624,1.6920,1.1571,10.477300 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-147.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                NUKU72U7S: '+title=IGN 1972 Nuku Hiva - UTM fuseau 7 Sud +proj=tmerc +towgs84=165.7320,216.7200,180.5050,-0.6434,-0.4512,-0.0791,7.420400 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-141.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                REUN47GAUSSL: '+title=Reunion Gauss Laborde +proj=gstmerc +towgs84=789.5240,-626.4860,-89.9040,0.6006,76.7946,-10.5788,-32.324100 +a=6378388.0000 +rf=297.0000000000000 +lat_0=-21.116666667 +lon_0=55.533333333 +k_0=1.00000000 +x_0=160000.000 +y_0=50000.000 +units=m +no_defs',
                RGM04UTM38S: '+title=UTM fuseau 38 Sud (Reseau Geodesique de Mayotte 2004) +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=45.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                RGNCUTM57S: '+title=Reseau Geodesique de Nouvelle-Caledonie - UTM fuseau 57 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=159.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                RGNCUTM58S: '+title=Reseau Geodesique de Nouvelle-Caledonie - UTM fuseau 58 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=165.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                RGNCUTM59S: '+title=Reseau Geodesique de Nouvelle-Caledonie - UTM fuseau 59 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=171.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                RGPFUTM5S: '+title=RGPF - UTM fuseau 5 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-153.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                RGPFUTM6S: '+title=RGPF - UTM fuseau 6 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-147.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                RGPFUTM7S: '+title=RGPF - UTM fuseau 7 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-141.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                RGR92UTM40S: '+title=RGR92 UTM fuseau 40 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=57.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                RGSPM06U21: '+title=Saint-Pierre-et-Miquelon (2006) UTM Fuseau 21 Nord +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-57.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                STPL69UTM43S: '+title=Saint-Paul 1969 UTM fuseau 43 Sud +proj=tmerc +towgs84=225.571,-346.608,-46.567,0,0,0,0 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=75.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                STPM50UTM21: '+title=St Pierre et Miquelon 1950 +proj=tmerc +towgs84=-95.5930,573.7630,173.4420,-0.9602,1.2510,-1.3918,42.626500 +a=6378206.4000 +rf=294.9786982000000 +lat_0=0.000000000 +lon_0=-57.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                TAHAAUTM05S: '+title=Tahaa 1951 +proj=tmerc +towgs84=72.4380,345.9180,79.4860,-1.6045,-0.8823,-0.5565,1.374600 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-153.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                TAHI51UTM06S: '+title=Tahiti-Terme Nord UTM fuseau 6 Sud +proj=tmerc +towgs84=162.0000,117.0000,154.0000 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-147.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                TAHI79UTM6S: '+title=Tahiti 1979 +proj=tmerc +towgs84=221.5250,152.9480,176.7680,2.3847,1.3896,0.8770,11.474100 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-147.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                TERA50STEREO: '+title=Terre Adelie 1950 +proj=stere +towgs84=324.9120,153.2820,172.0260 +a=6378388.0000 +rf=297.0000000000000 +lat_0=-90.000000000 +lon_0=140.000000000 +lat_ts=-67 +k=0.96027295 +x_0=300000.000 +y_0=-2299363.482 +units=m +no_defs',
                UTM01SW84: '+title=World Geodetic System 1984 UTM fuseau 01 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-177.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                UTM20W84GUAD: '+title=World Geodetic System 1984 UTM fuseau 20 Nord-Guadeloupe +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                UTM20W84MART: '+title=World Geodetic System 1984 UTM fuseau 20 Nord-Martinique +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-63.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                UTM22RGFG95: '+title=RGFG95 UTM fuseau 22 Nord-Guyane +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-51.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                UTM39SW84: '+title=World Geodetic System 1984 UTM fuseau 39 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=51.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                UTM42SW84: '+title=World Geodetic System 1984 UTM fuseau 42 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=69.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                UTM43SW84: '+title=World Geodetic System 1984 UTM fuseau 43 Sud +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=75.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                WALL78UTM1S: '+title=Wallis-Uvea 1978 (MOP78) UTM 1 SUD +proj=tmerc +towgs84=253.0000,-133.0000,-127.0000 +a=6378388.0000 +rf=297.0000000000000 +lat_0=0.000000000 +lon_0=-177.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=10000000.000 +units=m +no_defs',
                ETRS89GEO: '+title=ETRS89 geographiques (dms) +proj=longlat +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +units=m +no_defs',
                ETRS89LAEA: '+title=ETRS89 Lambert Azimutal Equal Area +proj=laea +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=52.000000000 +lon_0=10.000000000 +x_0=4321000.000 +y_0=3210000.000 +units=m +no_defs',
                ETRS89LCC: '+title=ETRS89 Lambert Conformal Conic +proj=lcc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=52.000000000 +lon_0=9.999999995 +lat_1=35.000000000 +lat_2=65.000000000 +x_0=4000000.000 +y_0=2800000.000 +units=m +no_defs',
                UTM26ETRS89: '+title=Europe - de 30d a 24d Ouest +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-27.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                UTM27ETRS89: '+title=Europe - de 24d a 18d Ouest +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-21.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                UTM28ETRS89: '+title=Europe - de 18d a 12d Ouest +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-15.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                UTM29ETRS89: '+title=Europe - de 12d a 6d Ouest +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-9.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                UTM30ETRS89: '+title=Europe - de -6d a 0d Ouest +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=-3.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                UTM31ETRS89: '+title=Europe - de 0d a 6d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=3.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                UTM32ETRS89: '+title=Europe - de 6d a 12d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=9.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                UTM33ETRS89: '+title=Europe - de 12d a 18d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=15.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                UTM34ETRS89: '+title=Europe - de 18d a 24d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=21.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                UTM35ETRS89: '+title=Europe - de 24d a 30d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=27.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                UTM36ETRS89: '+title=Europe - de 30d a 36d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=33.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                UTM37ETRS89: '+title=Europe - de 36d a 42d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=39.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs',
                UTM38ETRS89: '+title=Europe - de 42d a 48d Est +proj=tmerc +nadgrids=null +wktext +towgs84=0.0000,0.0000,0.0000 +a=6378137.0000 +rf=298.2572221010000 +lat_0=0.000000000 +lon_0=45.000000000 +k_0=0.99960000 +x_0=500000.000 +y_0=0.000 +units=m +no_defs'
            }
        };
        return Register;
    }(proj4);
    CommonUtilsProxyUtils = function (woodman) {
        var ProxyUtils = {
            proxifyUrl: function (url, proxyOptions) {
                if (!proxyOptions || !proxyOptions.hasOwnProperty('proxyUrl') || proxyOptions.proxyUrl === null || proxyOptions.proxyUrl.trim().length == 0) {
                    return url;
                }
                if (proxyOptions.noProxyDomains && Array.isArray(proxyOptions.noProxyDomains) && proxyOptions.noProxyDomains.length > 0) {
                    for (var i in proxyOptions.noProxyDomains) {
                        if (url.indexOf(proxyOptions.noProxyDomains[i]) !== -1) {
                            return url;
                        }
                    }
                }
                return proxyOptions.proxyUrl + encodeURIComponent(url);
            }
        };
        return ProxyUtils;
    }({});
    Ol3GfiUtils = function (ol, Gp, woodman, ProxyUtils) {
        var GfiUtils = {
            getLayerFormat: function (l) {
                var source = l.getSource();
                if (source instanceof ol.source.TileWMS || source instanceof ol.source.ImageWMS) {
                    return 'wms';
                }
                if (source instanceof ol.source.WMTS) {
                    return 'wmts';
                }
                if (source instanceof ol.source.Vector) {
                    return 'vector';
                }
                return 'unknown';
            },
            displayInfo: function (map, coords, content, contentType, autoPanOptions) {
                if (!contentType) {
                    contentType = 'text/html';
                }
                if (content === null) {
                    return;
                }
                var _htmlDoc = null;
                var _parser = null;
                var _content = content;
                _content = _content.replace(/\n/g, '');
                _content = _content.replace(/(>)\s*(<)/g, '$1$2');
                var scope = typeof window !== 'undefined' ? window : null;
                if (typeof exports === 'object' && window === null) {
                    var DOMParser = xmldom.DOMParser;
                    _parser = new DOMParser();
                    _htmlDoc = _parser.parseFromString(_content, contentType);
                } else if (scope.DOMParser) {
                    _parser = new scope.DOMParser();
                    _htmlDoc = _parser.parseFromString(_content, contentType);
                } else if (scope.ActiveXObject) {
                    _htmlDoc = new scope.ActiveXObject('Microsoft.XMLDOM');
                    _htmlDoc.async = false;
                    _htmlDoc.loadXML(_content);
                } else {
                    console.log('Incompatible environment for DOM Parser !');
                    return false;
                }
                var body = _htmlDoc.getElementsByTagName('body');
                if (body && body.length === 1) {
                    if (!body[0].hasChildNodes()) {
                        return false;
                    }
                }
                var element = document.createElement('div');
                element.className = 'gp-feature-info-div';
                var closer = document.createElement('input');
                closer.type = 'button';
                closer.className = 'gp-styling-button closer';
                closer.onclick = function () {
                    if (map.featuresOverlay) {
                        map.removeOverlay(map.featuresOverlay);
                        map.featuresOverlay = null;
                    }
                    return false;
                };
                var contentDiv = document.createElement('div');
                contentDiv.className = 'gp-features-content-div';
                contentDiv.innerHTML = content;
                element.appendChild(contentDiv);
                element.appendChild(closer);
                if (map.featuresOverlay) {
                    map.removeOverlay(map.featuresOverlay);
                    map.featuresOverlay = null;
                }
                map.featuresOverlay = new ol.Overlay({
                    element: element,
                    autoPan: autoPanOptions.autoPan,
                    autoPanAnimation: autoPanOptions.autoPanAnimation,
                    autoPanMargin: autoPanOptions.autoPanMargin,
                    positioning: 'bottom-center',
                    insertFirst: false,
                    stopEvent: true
                });
                map.addOverlay(map.featuresOverlay);
                map.featuresOverlay.setPosition(coords);
                map.featuresOverlay.render();
                return true;
            },
            features2html: function (map, features) {
                var content = document.createElement('div');
                features.forEach(function (f) {
                    var props = f.getProperties();
                    if (props.hasOwnProperty('name')) {
                        var nameDiv = document.createElement('div');
                        nameDiv.className = 'gp-att-name-div';
                        nameDiv.insertAdjacentHTML('afterbegin', props['name']);
                        content.appendChild(nameDiv);
                    }
                    if (props.hasOwnProperty('description')) {
                        var descDiv = document.createElement('div');
                        descDiv.className = 'gp-att-description-div';
                        descDiv.insertAdjacentHTML('afterbegin', props['description']);
                        content.appendChild(descDiv);
                    }
                    var p = null;
                    var others = false;
                    var oDiv = null;
                    var ul = null;
                    var li = null;
                    for (p in props) {
                        if (p == 'geometry' || p == 'value' || p == 'name' || p == 'description' || p == 'styleUrl') {
                            continue;
                        }
                        if (p == 'extensionsNode_' && props[p] === undefined) {
                            continue;
                        }
                        if (!others) {
                            oDiv = document.createElement('div');
                            oDiv.className = 'gp-att-others-div';
                            ul = document.createElement('ul');
                            others = true;
                        }
                        li = document.createElement('li');
                        var span = document.createElement('span');
                        span.className = 'gp-attname-others-span';
                        span.appendChild(document.createTextNode(p + ' : '));
                        li.appendChild(span);
                        li.appendChild(document.createTextNode(props[p]));
                        ul.appendChild(li);
                    }
                    if (ul) {
                        oDiv.appendChild(ul);
                        content.appendChild(oDiv);
                    }
                }, map);
                if (!content.hasChildNodes()) {
                    content = null;
                }
                return content;
            },
            layerGetFeatureAtCoordinates: function (map, olLayer, olCoordinate) {
                var pixel = map.getPixelFromCoordinate(olCoordinate);
                return map.hasFeatureAtPixel(pixel, function (layer) {
                    if (layer === olLayer) {
                        return true;
                    }
                    return false;
                });
            },
            displayVectorFeatureInfo: function (map, olCoordinate, olLayers, autoPanOptions) {
                var pixel = map.getPixelFromCoordinate(olCoordinate);
                var features = [];
                map.forEachFeatureAtPixel(pixel, function (feature, layer) {
                    if (!olLayers || olLayers.indexOf(layer) > -1) {
                        features.push(feature);
                    }
                });
                if (features.length == 0) {
                    return false;
                }
                var content = this.features2html(map, features);
                if (content === null) {
                    return false;
                }
                this.displayInfo(map, olCoordinate, content.innerHTML, 'text/html', autoPanOptions);
                return true;
            },
            displayFeatureInfo: function (map, olCoordinate, gfiLayers, proxyOptions, autoPanOptions) {
                var layersOrdered = {};
                for (var j = 0; j < gfiLayers.length; j++) {
                    var layer = gfiLayers[j];
                    var position = layer.obj.getZIndex();
                    if (!layersOrdered[position]) {
                        layersOrdered[position] = [];
                    }
                    layersOrdered[position].push(layer);
                }
                var requests = [];
                var positions = Object.keys(layersOrdered);
                positions.sort(function (a, b) {
                    return b - a;
                });
                var foundFeature = false;
                for (var k = 0; k < positions.length; k++) {
                    var p = positions[k];
                    for (var h = 0; h < layersOrdered[p].length; ++h) {
                        var l = layersOrdered[p][h].obj;
                        var infoFormat = layersOrdered[p][h].infoFormat || 'text/html';
                        var minMaxResolutionOk = true;
                        if (l.minResolution && l.minResolution > map.getResolution()) {
                            minMaxResolutionOk = false;
                        }
                        if (minMaxResolutionOk && l.maxResolution && l.maxResolution < map.getResolution()) {
                            minMaxResolutionOk = false;
                        }
                        if (l.getVisible() && minMaxResolutionOk) {
                            var format = this.getLayerFormat(l);
                            if (format == 'vector') {
                                if (!foundFeature && this.layerGetFeatureAtCoordinates(map, l, olCoordinate)) {
                                    requests.push({
                                        format: format,
                                        scope: this,
                                        coordinate: olCoordinate
                                    });
                                }
                                continue;
                            } else if (format != 'wms' && format != 'wmts') {
                                console.log('[ERROR] DisplayFeatureInfo - layer format \'' + format + '\' not allowed');
                                continue;
                            }
                            var _res = map.getView().getResolution();
                            var _url = null;
                            if (format == 'wmts') {
                                _url = l.getSource().getGetFeatureInfoUrl(olCoordinate, _res, map.getView().getProjection(), { INFOFORMAT: infoFormat });
                            } else {
                                _url = l.getSource().getGetFeatureInfoUrl(olCoordinate, _res, map.getView().getProjection(), { INFO_FORMAT: infoFormat });
                            }
                            requests.push({
                                format: infoFormat,
                                url: ProxyUtils.proxifyUrl(_url, proxyOptions),
                                scope: this,
                                coordinate: olCoordinate
                            });
                        }
                    }
                }
                var vectorLayersOrdered = null;
                function requestsSync(list, iterator, callback) {
                    if (list.length === 0) {
                        return;
                    }
                    var nextItemIndex = 0;
                    function report(displayed) {
                        nextItemIndex++;
                        if (displayed || nextItemIndex === list.length) {
                            callback();
                        } else {
                            iterator(list[nextItemIndex], report);
                        }
                    }
                    iterator(list[0], report);
                }
                var context = this;
                requestsSync(requests, function (data, report) {
                    if (data.format == 'vector') {
                        if (!vectorLayersOrdered) {
                            vectorLayersOrdered = [];
                            for (var m = 0; m < positions.length; m++) {
                                var p = positions[m];
                                for (var n = 0; n < layersOrdered[p].length; ++n) {
                                    vectorLayersOrdered.push(layersOrdered[p][n].obj);
                                }
                            }
                        }
                        report(data.scope.displayVectorFeatureInfo(map, data.coordinate, vectorLayersOrdered, autoPanOptions));
                    } else {
                        Gp.Protocols.XHR.call({
                            url: data.url,
                            method: 'GET',
                            scope: data.scope,
                            onResponse: function (resp) {
                                var exception = false;
                                if (resp.trim().length === 0 || resp.indexOf('java.lang.NullPointerException') !== -1 || resp.indexOf('not queryable') !== -1) {
                                    exception = true;
                                }
                                var displayed = !exception && context.displayInfo(map, data.coordinate, resp, 'text/html', autoPanOptions);
                                report(displayed);
                            },
                            onFailure: function (error) {
                                console.log(error);
                                report(false);
                            }
                        });
                    }
                }, function () {
                });
            },
            getPosition: function (e, map) {
                if (e.coordinate) {
                    return e.coordinate;
                }
                var pixel = [
                    0,
                    0
                ];
                if (e.offsetX || e.offsetY) {
                    pixel[0] = e.offsetX;
                    pixel[1] = e.offsetY;
                } else if (e.pointerType === 'touch') {
                    var p = e.pointers[0];
                    pixel[0] = p.pageX;
                    pixel[1] = p.pageY;
                }
                var coordinate = map.getCoordinateFromPixel(pixel);
                return coordinate;
            },
            onDisplayFeatureInfo: function (e, gfiObj) {
                if (!gfiObj.isActive()) {
                    return;
                }
                var map = gfiObj.getMap();
                if (e.type == 'contextmenu' || e.type == 'dblclick') {
                    e.preventDefault();
                } else if (e.type == 'singleclick') {
                    var interactions = map.getInteractions().getArray();
                    for (var i = 0; i < interactions.length; i++) {
                        if (interactions[i].getActive() && (interactions[i] instanceof ol.interaction.Select || interactions[i] instanceof ol.interaction.Modify || interactions[i] instanceof ol.interaction.Draw)) {
                            return;
                        }
                    }
                }
                var proxyOptions = {};
                if (gfiObj._proxyUrl) {
                    proxyOptions.proxyUrl = gfiObj._proxyUrl;
                }
                if (gfiObj._noProxyDomains) {
                    proxyOptions.noProxyDomains = gfiObj._noProxyDomains;
                }
                var autoPanOptions = {};
                if (gfiObj._autoPan) {
                    autoPanOptions.autoPan = gfiObj._autoPan;
                }
                if (gfiObj._autoPanAnimation) {
                    autoPanOptions.autoPanAnimation = gfiObj._autoPanAnimation;
                }
                if (gfiObj._autoPanMargin) {
                    autoPanOptions.autoPanMargin = gfiObj._autoPanMargin;
                }
                var eventLayers = [];
                for (var j = 0; j < gfiObj._layers.length; ++j) {
                    var event = gfiObj._layers[j].event ? gfiObj._layers[j].event : gfiObj._defaultEvent;
                    if (event == e.type) {
                        var ind = eventLayers.push(gfiObj._layers[j]) - 1;
                        if (!eventLayers[ind].infoFormat) {
                            eventLayers[ind].infoFormat = gfiObj._defaultInfoFormat;
                        }
                    }
                }
                var coords = this.getPosition(e, map);
                this.displayFeatureInfo(map, coords, eventLayers, proxyOptions, autoPanOptions);
            }
        };
        return GfiUtils;
    }(ol, gp, {}, CommonUtilsProxyUtils);
    CommonUtils = function () {
        var Utils = {
            detectSupport: function () {
                var isDesktop = true;
                var userAgent = window.navigator.userAgent.toLowerCase();
                if (userAgent.indexOf('iphone') !== -1 || userAgent.indexOf('ipod') !== -1 || userAgent.indexOf('ipad') !== -1 || userAgent.indexOf('android') !== -1 || userAgent.indexOf('mobile') !== -1 || userAgent.indexOf('blackberry') !== -1 || userAgent.indexOf('tablet') !== -1 || userAgent.indexOf('phone') !== -1 || userAgent.indexOf('touch') !== -1) {
                    isDesktop = false;
                }
                if (userAgent.indexOf('msie') !== -1 || userAgent.indexOf('trident') !== -1) {
                    isDesktop = true;
                }
                return isDesktop;
            },
            assign: function (dest, source) {
                dest = dest || {};
                for (var prop in source) {
                    if (source.hasOwnProperty(prop)) {
                        dest[prop] = source[prop];
                    }
                }
                return dest;
            },
            mergeParams: function (dest, source) {
                if (!dest || !source) {
                    return;
                }
                for (var param in source) {
                    if (source.hasOwnProperty(param)) {
                        if (typeof source[param] === 'object') {
                            if (dest.hasOwnProperty(param)) {
                                this.mergeParams(dest[param], source[param]);
                            } else {
                                dest[param] = source[param];
                            }
                        } else {
                            dest[param] = source[param];
                        }
                    }
                }
            }
        };
        return Utils;
    }();
    Ol3FormatsKML = function (woodman, ol, Utils) {
        function KML(options) {
            if (!(this instanceof KML)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            ol.format.KML.call(this, options);
            this.options = options || {};
        }
        ol.inherits(KML, ol.format.KML);
        KML.prototype = Object.create(ol.format.KML.prototype, {});
        KML.prototype.constructor = KML;
        function _kmlFormattedToString(xml) {
            var reg = /(>)\s*(<)(\/*)/g;
            var wsexp = / *(.*) +\n/g;
            var contexp = /(<.+>)(.+\n)/g;
            xml = xml.replace(reg, '$1\n$2$3').replace(wsexp, '$1\n').replace(contexp, '$1\n$2');
            var formatted = '';
            var lines = xml.split('\n');
            var indent = 0;
            var lastType = 'other';
            var transitions = {
                'single->single': 0,
                'single->closing': -1,
                'single->opening': 0,
                'single->other': 0,
                'closing->single': 0,
                'closing->closing': -1,
                'closing->opening': 0,
                'closing->other': 0,
                'opening->single': 1,
                'opening->closing': 0,
                'opening->opening': 1,
                'opening->other': 1,
                'other->single': 0,
                'other->closing': -1,
                'other->opening': 0,
                'other->other': 0
            };
            for (var i = 0; i < lines.length; i++) {
                var ln = lines[i];
                var single = Boolean(ln.match(/<.+\/>/));
                var closing = Boolean(ln.match(/<\/.+>/));
                var opening = Boolean(ln.match(/<[^!].*>/));
                var type = single ? 'single' : closing ? 'closing' : opening ? 'opening' : 'other';
                var fromTo = lastType + '->' + type;
                lastType = type;
                var padding = '';
                indent += transitions[fromTo];
                for (var j = 0; j < indent; j++) {
                    padding += '\t';
                }
                if (fromTo == 'opening->closing') {
                    formatted = formatted.substr(0, formatted.length - 1) + ln + '\n';
                } else {
                    formatted += padding + ln + '\n';
                }
            }
            return formatted;
        }
        function _kmlParse(kmlString) {
            var kmlDoc = null;
            var parser = null;
            var scope = typeof window !== 'undefined' ? window : null;
            if (typeof exports === 'object' && window === null) {
                var DOMParser = xmldom.DOMParser;
                parser = new DOMParser();
                kmlDoc = parser.parseFromString(kmlString, 'text/xml');
            } else if (scope.DOMParser) {
                parser = new scope.DOMParser();
                kmlDoc = parser.parseFromString(kmlString, 'text/xml');
            } else if (scope.ActiveXObject) {
                kmlDoc = new scope.ActiveXObject('Microsoft.XMLDOM');
                kmlDoc.async = false;
                kmlDoc.loadXML(kmlString);
            } else {
                console.log('Incompatible environment for DOM Parser !');
            }
            return kmlDoc;
        }
        function _kmlToString(kmlDoc) {
            var oSerializer = new XMLSerializer();
            var kmlStringExtended = oSerializer.serializeToString(kmlDoc);
            return kmlStringExtended;
        }
        function _kmlRead(kmlDoc, features, process) {
            var root = kmlDoc.documentElement;
            var firstNodeLevel = root.childNodes;
            var nodes = firstNodeLevel;
            if (firstNodeLevel.length === 1 && firstNodeLevel[0].nodeName === 'Document') {
                nodes = firstNodeLevel[0].childNodes;
            }
            var stylesUrl = {};
            var index = -1;
            for (var i = 0; i < nodes.length; i++) {
                var node = nodes[i];
                switch (node.nodeName) {
                case 'Style':
                    var id = node.attributes[0];
                    if (id && id.nodeName === 'id') {
                        var _k = id.nodeValue;
                        var _v = node;
                        stylesUrl[_k] = _v;
                    }
                    break;
                case 'Placemark':
                    index++;
                    var types = node.childNodes;
                    var point = false;
                    var styles = null;
                    var extend = null;
                    var name = node;
                    for (var j = 0; j < types.length; j++) {
                        switch (types[j].nodeName) {
                        case 'Point':
                            point = true;
                            break;
                        case 'Style':
                            styles = types[j].childNodes;
                            break;
                        case 'styleUrl':
                            var _idStyle = types[j].textContent.slice(1);
                            if (stylesUrl[_idStyle]) {
                                styles = stylesUrl[_idStyle].childNodes;
                            }
                            break;
                        case 'ExtendedData':
                            extend = types[j].childNodes;
                            break;
                        case 'name':
                            name = null;
                            break;
                        default:
                        }
                    }
                    if (extend) {
                        var fctExtend = process.extendedData;
                        if (fctExtend && typeof fctExtend === 'function') {
                            fctExtend(features[index], extend);
                        }
                    }
                    if (name) {
                        var fctName = process.nameData;
                        if (fctName && typeof fctName === 'function') {
                            fctName(features[index], name);
                        }
                    }
                    if (point && styles) {
                        if (styles.length) {
                            var labelStyle = null;
                            var iconStyle = null;
                            for (var k = 0; k < styles.length; k++) {
                                switch (styles[k].nodeName) {
                                case 'LabelStyle':
                                    labelStyle = styles[k];
                                    break;
                                case 'IconStyle':
                                    iconStyle = styles[k];
                                    break;
                                default:
                                }
                            }
                            var labelName = features[index].getProperties().name;
                            var labelDescription = features[index].getProperties().description;
                            var value = labelName || labelDescription;
                            if (!iconStyle && labelStyle) {
                                var fctLabel = process.labelStyle;
                                if (fctLabel && typeof fctLabel === 'function') {
                                    fctLabel(features[index], labelStyle);
                                }
                            } else if (iconStyle && !labelStyle) {
                                var fctIcon = process.iconStyle;
                                if (fctIcon && typeof fctIcon === 'function') {
                                    fctIcon(features[index], iconStyle);
                                }
                            } else if (iconStyle && labelStyle) {
                                var fctIconLabel = process.iconLabelStyle;
                                if (fctIconLabel && typeof fctIconLabel === 'function') {
                                    fctIconLabel(features[index], iconStyle, labelStyle);
                                }
                            }
                        }
                    }
                    break;
                default:
                }
            }
        }
        KML.prototype.writeFeatures = function (features, options) {
            var kmlString = this._writeExtendStylesFeatures(features, options);
            return kmlString;
        };
        KML.prototype._writeExtendStylesFeatures = function (features, options) {
            var kmlString = ol.format.KML.prototype.writeFeatures.call(this, features, options);
            var kmlDoc = _kmlParse(kmlString);
            if (kmlDoc === null) {
                return kmlString;
            }
            var __createExtensionStyleLabel = function (feature, style) {
                if (!feature) {
                    return;
                }
                var labelName = feature.getProperties().name;
                if (!labelName) {
                    return;
                }
                function __convertRGBColorsToKML(data) {
                    var strColor = data.toString(16);
                    if (strColor.charAt(0) === '#') {
                        strColor = strColor.slice(1);
                    }
                    var opacity = 1;
                    opacity = parseInt(opacity * 255, 10);
                    opacity = opacity.toString(16);
                    var color = opacity;
                    color = color + strColor.substr(4, 2);
                    color = color + strColor.substr(2, 2);
                    color = color + strColor.substr(0, 2);
                    return color.toLowerCase();
                }
                if (feature.getStyle() instanceof ol.style.Style) {
                    var fTextStyle = feature.getStyle().getText().getStroke();
                    if (!fTextStyle) {
                        return;
                    }
                    var _haloColor = __convertRGBColorsToKML(fTextStyle.getColor()) || __convertRGBColorsToKML('#FFFFFF');
                    var _haloRadius = fTextStyle.getWidth() || '0';
                    var _haloOpacity = '1';
                    var _font = 'Sans';
                    if (style && style.getElementsByTagName('LabelStyleSimpleExtensionGroup').length === 0) {
                        var labelextend = kmlDoc.createElement('LabelStyleSimpleExtensionGroup');
                        labelextend.setAttribute('fontFamily', _font);
                        labelextend.setAttribute('haloColor', _haloColor);
                        labelextend.setAttribute('haloRadius', _haloRadius);
                        labelextend.setAttribute('haloOpacity', _haloOpacity);
                        style.appendChild(labelextend);
                    }
                }
            };
            var __createHotSpotStyleIcon = function (feature, style) {
                if (!feature) {
                    return;
                }
                if (feature.getStyle() instanceof ol.style.Style) {
                    var fImageStyle = feature.getStyle().getImage();
                    if (!fImageStyle) {
                        return;
                    }
                    var x = 0;
                    var y = 0;
                    var xunits = 'pixels';
                    var yunits = 'pixels';
                    var size = fImageStyle.getSize();
                    var anchor = fImageStyle.getAnchor();
                    if (anchor.length) {
                        x = anchor[0];
                        y = anchor[1];
                        if (yunits === 'fraction') {
                            y = anchor[1] === 1 ? 0 : 1 - anchor[1];
                        } else {
                            y = yunits === 'pixels' && anchor[1] === size[1] ? 0 : size[1] - anchor[1];
                        }
                    }
                    if (style && style.getElementsByTagName('hotSpot').length === 0) {
                        var hotspot = kmlDoc.createElement('hotSpot');
                        hotspot.setAttribute('x', x);
                        hotspot.setAttribute('y', y);
                        hotspot.setAttribute('xunits', xunits);
                        hotspot.setAttribute('yunits', yunits);
                        style.appendChild(hotspot);
                    }
                }
            };
            var __createStyleToFeatureIconLabel = function (feature, iconStyle, labelStyle) {
                __createHotSpotStyleIcon(feature, iconStyle);
                __createExtensionStyleLabel(feature, labelStyle);
            };
            var __setNameData = function (feature, tags) {
                for (var i = 0; i < tags.length; i++) {
                    var tag = tags[i];
                    if (tag.nodeName === 'name') {
                        return;
                    }
                }
                var labelName = feature.getProperties().name;
                if (labelName) {
                    var name = kmlDoc.createElement('name');
                    name.innerHTML = labelName;
                    tags.appendChild(name);
                }
            };
            _kmlRead(kmlDoc, features, {
                labelStyle: __createExtensionStyleLabel,
                iconStyle: __createHotSpotStyleIcon,
                iconLabelStyle: __createStyleToFeatureIconLabel,
                nameData: __setNameData
            });
            var kmlStringExtended = _kmlToString(kmlDoc);
            if (kmlStringExtended === null) {
                kmlStringExtended = kmlString;
            }
            var kmlStringFormatted = _kmlFormattedToString(kmlStringExtended);
            if (kmlStringFormatted === null) {
                kmlStringFormatted = kmlString;
            }
            return kmlStringFormatted;
        };
        KML.prototype.readFeatures = function (source, options) {
            var features = this._readExtendStylesFeatures(source, options);
            return features;
        };
        KML.prototype._readExtendStylesFeatures = function (source, options) {
            var features = ol.format.KML.prototype.readFeatures.call(this, source, options);
            var kmlDoc = null;
            var kmlString = '';
            if (typeof source === 'string') {
                kmlString = source;
            } else {
                kmlString = source.documentElement.outerHTML;
            }
            kmlString = kmlString.replace(/\n/g, '');
            kmlString = kmlString.replace(/(>)\s*(<)/g, '$1$2');
            kmlDoc = _kmlParse(kmlString);
            if (kmlDoc === null) {
                return features;
            }
            var __getExtensionStyleToFeatureLabel = function (feature, style) {
                if (!feature) {
                    return;
                }
                function __convertKMLColorsToRGB(data) {
                    var color = '';
                    color = color + data.substr(6, 2);
                    color = color + data.substr(4, 2);
                    color = color + data.substr(2, 2);
                    var hex = parseInt(color, 16).toString(16);
                    var comp = '';
                    var len = hex.length || 0;
                    for (var i = 0; i < 6 - len; i++) {
                        comp += '0';
                    }
                    hex = '#' + comp + hex;
                    return hex.toString(16);
                }
                var _text = feature.getProperties().name || '---';
                var _color = __convertKMLColorsToRGB('ff000000');
                var _colorHalo = '#FFFFFF';
                var _radiusHalo = 0;
                var _font = 'Sans';
                var _fontSize = '16px';
                var bLabelStyleSimpleExtensionGroup = false;
                var styles = style.childNodes;
                for (var k = 0; k < styles.length; k++) {
                    switch (styles[k].nodeName) {
                    case 'scale':
                        break;
                    case 'colorMode':
                        break;
                    case 'color':
                        _color = __convertKMLColorsToRGB(styles[k].textContent);
                        break;
                    case 'LabelStyleSimpleExtensionGroup':
                        bLabelStyleSimpleExtensionGroup = true;
                        var attributs = styles[k].attributes;
                        for (var l = 0; l < attributs.length; l++) {
                            switch (attributs[l].nodeName) {
                            case 'fontFamily':
                                break;
                            case 'haloColor':
                                _colorHalo = __convertKMLColorsToRGB(attributs[l].nodeValue);
                                break;
                            case 'haloRadius':
                                _radiusHalo = parseInt(attributs[l].nodeValue, 10);
                                break;
                            case 'haloOpacity':
                                break;
                            default:
                            }
                        }
                        break;
                    default:
                    }
                }
                if (!bLabelStyleSimpleExtensionGroup) {
                    return;
                }
                feature.setStyle(new ol.style.Style({
                    image: new ol.style.Icon({
                        src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNiYAAAAAkAAxkR2eQAAAAASUVORK5CYII=',
                        size: [
                            51,
                            38
                        ],
                        anchor: [
                            25.5,
                            38
                        ],
                        anchorOrigin: 'top-left',
                        anchorXUnits: 'pixels',
                        anchorYUnits: 'pixels'
                    }),
                    text: new ol.style.Text({
                        font: _fontSize + ' ' + _font,
                        textAlign: 'left',
                        text: _text,
                        fill: new ol.style.Fill({ color: _color }),
                        stroke: new ol.style.Stroke({
                            color: _colorHalo,
                            width: _radiusHalo
                        })
                    })
                }));
            };
            var __getHotSpotStyleToFeatureIcon = function (feature, style) {
                var _src = null;
                var _scale = null;
                var _bSizeIcon = false;
                var _sizeW = 51;
                var _sizeH = 38;
                var _bHotSpot = false;
                var _anchorX = 25.5;
                var _anchorXUnits = 'pixels';
                var _anchorY = 38;
                var _anchorYUnits = 'pixels';
                var styles = style.childNodes;
                for (var k = 0; k < styles.length; k++) {
                    switch (styles[k].nodeName) {
                    case 'Icon':
                        var nodes = styles[k].childNodes;
                        for (var i = 0; i < nodes.length; i++) {
                            switch (nodes[i].nodeName) {
                            case 'href':
                                _src = nodes[i].textContent;
                                break;
                            case 'gx:w':
                                _bSizeIcon = true;
                                _sizeW = parseFloat(nodes[i].textContent);
                                break;
                            case 'gx:h':
                                _bSizeIcon = true;
                                _sizeH = parseFloat(nodes[i].textContent);
                                break;
                            default:
                            }
                        }
                        break;
                    case 'hotSpot':
                        _bHotSpot = true;
                        var attributs = styles[k].attributes;
                        for (var l = 0; l < attributs.length; l++) {
                            switch (attributs[l].nodeName) {
                            case 'x':
                                _anchorX = parseFloat(attributs[l].nodeValue);
                                break;
                            case 'y':
                                _anchorY = parseFloat(attributs[l].nodeValue);
                                break;
                            case 'yunits':
                                _anchorXUnits = attributs[l].nodeValue;
                                break;
                            case 'xunits':
                                _anchorYUnits = attributs[l].nodeValue;
                                break;
                            default:
                            }
                        }
                        break;
                    case 'scale':
                        _scale = parseFloat(styles[k].textContent);
                        break;
                    default:
                    }
                }
                var _options = {
                    src: _src,
                    crossOrigin: 'anonymous',
                    scale: _scale || 1
                };
                if (_bSizeIcon) {
                    Utils.mergeParams(_options, {
                        size: [
                            _sizeW,
                            _sizeH
                        ]
                    });
                }
                if (_bHotSpot) {
                    Utils.mergeParams(_options, {
                        anchor: [
                            _anchorX,
                            _anchorY
                        ],
                        anchorOrigin: 'bottom-left',
                        anchorXUnits: _anchorXUnits || 'pixels',
                        anchorYUnits: _anchorYUnits || 'pixels'
                    });
                }
                var featureStyleFunction = feature.getStyleFunction();
                if (featureStyleFunction) {
                    var _styles = featureStyleFunction.call(feature, 0);
                    if (_styles && _styles.length !== 0) {
                        var _style = _styles.length === 1 ? _styles[0] : _styles[_styles.length - 1];
                        feature.setStyle(new ol.style.Style({
                            image: new ol.style.Icon(_options),
                            text: _style.getText()
                        }));
                    }
                }
            };
            var __getExtendedData = function (feature, extend) {
                if (!feature) {
                    return;
                }
                var _fname = feature.getProperties().name || '';
                var _fdescription = feature.getProperties().description || '';
                var _ftitle = null;
                for (var i = 0; i < extend.length; i++) {
                    var data = extend[i];
                    var name = data.attributes[0];
                    var nodes = data.childNodes;
                    if (name.nodeName === 'name') {
                        switch (name.nodeValue) {
                        case 'label':
                            _fname = data.textContent;
                            break;
                        case 'title':
                        case 'attributetitle':
                            for (var j = 0; j < nodes.length; j++) {
                                if (nodes[j].nodeName === 'value') {
                                    _ftitle = nodes[j].textContent;
                                }
                            }
                            break;
                        default:
                        }
                    }
                }
                if (_ftitle) {
                    _fdescription = _fdescription ? _ftitle + ' : ' + _fdescription : _ftitle;
                }
                feature.setProperties({
                    name: _fname,
                    description: _fdescription
                });
            };
            var __getStyleToFeatureIconLabel = function (feature, iconStyle, labelStyle) {
                __getExtensionStyleToFeatureLabel(feature, labelStyle);
                __getHotSpotStyleToFeatureIcon(feature, iconStyle);
            };
            _kmlRead(kmlDoc, features, {
                labelStyle: this.options.showPointNames ? __getExtensionStyleToFeatureLabel : null,
                iconStyle: __getHotSpotStyleToFeatureIcon,
                iconLabelStyle: this.options.showPointNames ? __getStyleToFeatureIconLabel : __getHotSpotStyleToFeatureIcon,
                extendedData: __getExtendedData
            });
            return features;
        };
        return KML;
    }({}, ol, CommonUtils);
    Ol3SourcesWMTS = function (Gp, ol, Utils) {
        function WMTS(options) {
            if (!(this instanceof WMTS)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            ol.source.WMTS.call(this, options);
        }
        ol.inherits(WMTS, ol.source.WMTS);
        WMTS.prototype = Object.create(ol.source.WMTS.prototype, {});
        WMTS.prototype.constructor = WMTS;
        WMTS.prototype.getGetFeatureInfoUrl = function (coordinate, resolution, projection, params) {
            var pixelRatio = this.option && this.options.tilePixelRatio ? this.options.tilePixelRatio : 1;
            var tileGrid = this.tileGrid;
            var tileCoord = this.tileGrid.getTileCoordForCoordAndResolution(coordinate, resolution);
            var getTransformedTileCoord = function (tileCoord, tileGrid, projection) {
                var tmpTileCoord = [
                    0,
                    0,
                    0
                ];
                var tmpExtent = ol.extent.createEmpty();
                var x = tileCoord[1];
                var y = -tileCoord[2] - 1;
                var tileExtent = tileGrid.getTileCoordExtent(tileCoord);
                var projectionExtent = projection.getExtent();
                var extent = projectionExtent;
                if (extent != null && projection.isGlobal() && extent[0] === projectionExtent[0] && extent[2] === projectionExtent[2]) {
                    var numCols = Math.ceil(ol.extent.getWidth(extent) / ol.extent.getWidth(tileExtent));
                    x = x % numCols;
                    tmpTileCoord[0] = tileCoord[0];
                    tmpTileCoord[1] = x;
                    tmpTileCoord[2] = tileCoord[2];
                    tileExtent = tileGrid.getTileCoordExtent(tmpTileCoord, tmpExtent);
                }
                if (!ol.extent.intersects(tileExtent, extent)) {
                    return null;
                }
                return [
                    tileCoord[0],
                    x,
                    y
                ];
            };
            var tileExtent = tileGrid.getTileCoordExtent(tileCoord);
            var transformedTileCoord = getTransformedTileCoord(tileCoord, tileGrid, projection);
            if (tileGrid.getResolutions().length <= tileCoord[0]) {
                return undefined;
            }
            var tileResolution = tileGrid.getResolution(tileCoord[0]);
            var tileMatrix = tileGrid.getMatrixIds()[tileCoord[0]];
            var baseParams = {
                SERVICE: 'WMTS',
                VERSION: '1.0.0',
                REQUEST: 'GetFeatureInfo',
                LAYER: this.getLayer(),
                TILECOL: transformedTileCoord[1],
                TILEROW: transformedTileCoord[2],
                TILEMATRIX: tileMatrix,
                TILEMATRIXSET: this.getMatrixSet(),
                FORMAT: this.getFormat() || 'image/png',
                STYLE: this.getStyle() || 'normal'
            };
            Utils.assign(baseParams, params);
            var x = Math.floor((coordinate[0] - tileExtent[0]) / (tileResolution / pixelRatio));
            var y = Math.floor((tileExtent[3] - coordinate[1]) / (tileResolution / pixelRatio));
            baseParams['I'] = x;
            baseParams['J'] = y;
            var url = this.urls[0];
            var featureInfoUrl = Gp.Helper.normalyzeUrl(url, baseParams);
            return featureInfoUrl;
        };
        return WMTS;
    }(gp, ol, CommonUtils);
    Ol3CRSCRS = function (proj4, ol, Register) {
        (function () {
            Register.load();
            if (!ol.proj.proj4_ && ol.proj.setProj4) {
                ol.proj.setProj4(proj4);
            } else {
                console.log('WARNING : OpenLayers library should manage proj4 dependency in order to add custom projections (Lambert 93 for instance)');
            }
        }());
        var CRS = {
            overloadTransformExtent: function () {
                ol.proj.transformExtent = function (extent, source, destination) {
                    if (destination === 'EPSG:2154') {
                        if (source === 'EPSG:4326') {
                            if (extent[0] < -9.62) {
                                extent[0] = -9.62;
                            }
                            if (extent[1] < 41.18) {
                                extent[1] = 41.18;
                            }
                            if (extent[2] > 10.3) {
                                extent[2] = 10.3;
                            }
                            if (extent[3] > 51.54) {
                                extent[3] = 51.54;
                            }
                        }
                    }
                    var transformFn = ol.proj.getTransform(source, destination);
                    var transformedExtent = ol.extent.applyTransform(extent, transformFn);
                    return transformedExtent;
                };
            },
            overload: function () {
                this.overloadTransformExtent();
            }
        };
        return CRS;
    }(proj4, ol, CommonUtilsRegister);
    CommonUtilsConfig = function () {
        var Config = {
            configuration: null,
            isConfigLoaded: function () {
                var scope = typeof window !== 'undefined' ? window : {};
                if (scope.Gp && scope.Gp.Config && Object.keys(scope.Gp.Config).length !== 0) {
                    this.configuration = scope.Gp.Config;
                    return true;
                }
                return false;
            },
            getLayerId: function (layerName, service) {
                var layerId = null;
                if (this.configuration) {
                    var layers = this.configuration['layers'];
                    for (var key in layers) {
                        if (layers.hasOwnProperty(key)) {
                            var parts = key.split('$');
                            if (layerName === parts[0]) {
                                if (parts[1]) {
                                    var servicePartsLayer = parts[1].split(':');
                                    var servicePartsService = parts[1].split(';');
                                    if (servicePartsService[1] === service) {
                                        layerId = key;
                                        break;
                                    }
                                    if (servicePartsLayer[2] === service) {
                                        layerId = key;
                                        break;
                                    }
                                }
                            }
                        }
                    }
                }
                if (!layerId) {
                    console.log('ERROR layer id (' + layerName + ' / ' + service + ') was not found !?');
                }
                return layerId;
            },
            getLayerParams: function (layerName, service, apiKey) {
                var params = {};
                if (this.configuration) {
                    var layerId = this.getLayerId(layerName, service);
                    if (layerId) {
                        var layerConf = this.configuration.layers[layerId];
                        var key = layerConf.apiKeys[0];
                        if (apiKey) {
                            if (apiKey !== key) {
                                console.log('ERROR different keys (' + apiKey + ' !== ' + key + ') !?');
                                return;
                            }
                        }
                        apiKey = apiKey || key;
                        params.key = apiKey;
                        params.url = layerConf.getServerUrl(apiKey);
                        params.version = layerConf.getServiceParams().version;
                        params.styles = layerConf.getDefaultStyle();
                        params.format = layerConf.getDefaultFormat();
                        params.projection = layerConf.getDefaultProjection();
                        params.minScale = layerConf.getMinScaleDenominator();
                        params.maxScale = layerConf.getMaxScaleDenominator();
                        params.extent = layerConf.getBBOX();
                        params.legends = layerConf.getLegends();
                        params.metadata = layerConf.getMetadata();
                        params.originators = layerConf.getOriginators();
                        params.title = layerConf.getTitle();
                        params.description = layerConf.getDescription();
                        params.quicklookUrl = layerConf.getQuicklookUrl();
                        if (layerConf.wmtsOptions) {
                            params.tileMatrixSetLimits = layerConf.wmtsOptions.tileMatrixSetLimits;
                        }
                        var TMSLink = layerConf.getTMSID();
                        if (TMSLink) {
                            params.TMSLink = TMSLink;
                            var tmsConf = this.configuration.getTMSConf(TMSLink);
                            params.matrixOrigin = tmsConf.getTopLeftCorner();
                            params.nativeResolutions = tmsConf.nativeResolutions;
                            params.matrixIds = tmsConf.matrixIds;
                            params.tileMatrices = tmsConf.tileMatrices;
                        }
                    }
                }
                return params;
            },
            getServiceParams: function (resource, service, apiKey) {
                var params = {};
                if (this.configuration) {
                    var layerId = this.getLayerId(resource, service);
                    if (layerId) {
                        var layerConf = this.configuration.layers[layerId];
                        var key = layerConf.apiKeys[0];
                        if (apiKey) {
                            if (apiKey !== key) {
                                return;
                            }
                        }
                        apiKey = apiKey || key;
                        params.key = apiKey;
                        params.url = layerConf.getServerUrl(apiKey);
                        params.version = layerConf.getServiceParams().version;
                        params.extent = layerConf.getBBOX();
                        params.title = layerConf.getTitle();
                        params.description = layerConf.getDescription();
                    }
                }
                return params;
            },
            getResolutions: function () {
                var resolutions = [];
                if (this.configuration) {
                    resolutions = this.configuration['generalOptions']['wgs84Resolutions'];
                }
                return resolutions;
            },
            getTileMatrix: function (tmsName) {
                var tms = {};
                if (this.configuration) {
                    if (tmsName) {
                        tms = this.configuration['tileMatrixSets'][tmsName.toUpperCase()];
                    }
                }
                return tms;
            },
            getGlobalConstraints: function (layerId) {
                var params = {};
                if (layerId) {
                    var layerConf = this.configuration.layers[layerId];
                    params.projection = layerConf.getDefaultProjection();
                    params.minScale = layerConf.getMinScaleDenominator();
                    params.maxScale = layerConf.getMaxScaleDenominator();
                    params.extent = layerConf.getBBOX();
                }
                return params;
            }
        };
        return Config;
    }();
    Ol3LayersSourceWMTS = function (ol, WMTSExtended, Gp, GfiUtils, Utils, Config, LayerUtils) {
        function SourceWMTS(options) {
            if (!(this instanceof SourceWMTS)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            if (!options.layer) {
                throw new Error('ERROR PARAM_MISSING : layer');
            }
            if (typeof options.layer !== 'string') {
                throw new Error('ERROR WRONG TYPE : layer');
            }
            if (!Config.isConfigLoaded()) {
                throw new Error('ERROR : contract key configuration has to be loaded to load Geoportal layers. See http://ignf.github.io/evolution-apigeoportail/ol3/ol3-autoconf.html');
            }
            var layerId = Config.getLayerId(options.layer, 'WMTS');
            if (layerId && Config.configuration.getLayerConf(layerId)) {
                var wmtsParams = Config.getLayerParams(options.layer, 'WMTS', options.apiKey);
                this._originators = wmtsParams.originators;
                this._legends = wmtsParams.legends;
                this._metadata = wmtsParams.metadata;
                var wmtsSourceOptions = {
                    url: Gp.Helper.normalyzeUrl(wmtsParams.url, { 'gp-ol3-ext': '1.0.0' }, false),
                    version: wmtsParams.version,
                    style: wmtsParams.styles,
                    format: wmtsParams.format,
                    projection: wmtsParams.projection,
                    maxZoom: LayerUtils.getZoomLevelFromScaleDenominator(wmtsParams.minScale),
                    layer: options.layer,
                    matrixSet: wmtsParams.TMSLink,
                    tileGrid: new ol.tilegrid.WMTS({
                        resolutions: wmtsParams.nativeResolutions,
                        matrixIds: wmtsParams.matrixIds,
                        origin: [
                            wmtsParams.matrixOrigin.x,
                            wmtsParams.matrixOrigin.y
                        ]
                    })
                };
                Utils.mergeParams(wmtsSourceOptions, options.olParams);
                WMTSExtended.call(this, wmtsSourceOptions);
                this._originators = wmtsParams.originators;
                this._legends = wmtsParams.legends;
                this._metadata = wmtsParams.metadata;
                this._description = wmtsParams.description;
                this._title = wmtsParams.title;
                this._quicklookUrl = wmtsParams.quicklookUrl;
            } else {
                console.log('[source WMTS] ERROR : ' + options.layer + ' cannot be found in Geoportal Configuration. Make sure that this resource is included in your contract key.');
                return new WMTSExtended({});
            }
        }
        ol.inherits(SourceWMTS, WMTSExtended);
        SourceWMTS.prototype = Object.create(WMTSExtended.prototype, {});
        SourceWMTS.prototype.constructor = SourceWMTS;
        return SourceWMTS;
    }(ol, Ol3SourcesWMTS, gp, Ol3GfiUtils, CommonUtils, CommonUtilsConfig, CommonUtilsLayerUtils);
    Ol3LayersSourceWMS = function (ol, Gp, Utils, Config) {
        function SourceWMS(options) {
            if (!(this instanceof SourceWMS)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            if (!options.layer) {
                throw new Error('ERROR PARAM_MISSING : layer');
            }
            if (typeof options.layer !== 'string') {
                throw new Error('ERROR WRONG TYPE : layer');
            }
            if (!Config.isConfigLoaded()) {
                throw new Error('ERROR : contract key configuration has to be loaded to load Geoportal layers. See http://ignf.github.io/evolution-apigeoportail/ol3/ol3-autoconf.html');
            }
            var layerId = Config.getLayerId(options.layer, 'WMS');
            if (layerId && Config.configuration.getLayerConf(layerId)) {
                var wmsParams = Config.getLayerParams(options.layer, 'WMS', options.apiKey);
                var wmsSourceOptions = {
                    url: Gp.Helper.normalyzeUrl(wmsParams.url, { 'gp-ol3-ext': '1.0.0' }, false),
                    params: {
                        SERVICE: 'WMS',
                        LAYERS: options.layer,
                        VERSION: wmsParams.version,
                        STYLES: wmsParams.styles,
                        FORMAT: wmsParams.format
                    }
                };
                Utils.mergeParams(wmsSourceOptions, options.olParams);
                ol.source.TileWMS.call(this, wmsSourceOptions);
                this._originators = wmsParams.originators;
                this._legends = wmsParams.legends;
                this._metadata = wmsParams.metadata;
                this._title = wmsParams.title;
                this._description = wmsParams.description;
                this._quicklookUrl = wmsParams.quicklookUrl;
            } else {
                console.log('[source WMS] ERROR : ' + options.layer + ' cannot be found in Geoportal Configuration. Make sure that this resource is included in your contract key.');
                return new ol.source.TileWMS({});
            }
        }
        ol.inherits(SourceWMS, ol.source.TileWMS);
        SourceWMS.prototype = Object.create(ol.source.TileWMS.prototype, {});
        SourceWMS.prototype.constructor = SourceWMS;
        return SourceWMS;
    }(ol, gp, CommonUtils, CommonUtilsConfig);
    Ol3LayersLayerWMTS = function (ol, Utils, Config, LayerUtils, SourceWMTS) {
        function LayerWMTS(options) {
            if (!(this instanceof LayerWMTS)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            if (!options.layer) {
                throw new Error('ERROR PARAM_MISSING : layer');
            }
            if (typeof options.layer !== 'string') {
                throw new Error('ERROR WRONG TYPE : layer');
            }
            if (!Config.isConfigLoaded()) {
                throw new Error('ERROR : contract key configuration has to be loaded to load Geoportal layers. See http://ignf.github.io/evolution-apigeoportail/ol3/ol3-autoconf.html');
            }
            var olSourceParams;
            if (options.olParams && options.olParams.sourceParams) {
                olSourceParams = options.olParams.sourceParams;
            }
            var wmtsSource = new SourceWMTS({
                layer: options.layer,
                apiKey: options.apiKey,
                olParams: olSourceParams
            });
            var layerTileOptions = { source: wmtsSource };
            if (wmtsSource.getLayer() !== undefined) {
                var layerId = Config.getLayerId(options.layer, 'WMTS');
                var globalConstraints = Config.getGlobalConstraints(layerId);
                if (globalConstraints && globalConstraints.projection) {
                    var p;
                    if (typeof globalConstraints.projection === 'string') {
                        p = ol.proj.get(globalConstraints.projection);
                    }
                    if (p && p.getUnits()) {
                        if (p.getUnits() === 'm') {
                            layerTileOptions.minResolution = (globalConstraints.minScale - 1) * 0.00028;
                            layerTileOptions.maxResolution = (globalConstraints.maxScale + 1) * 0.00028;
                        } else if (p.getUnits() === 'degrees') {
                            layerTileOptions.minResolution = (globalConstraints.minScale - 1) * 0.00028 * 180 / (Math.PI * 6378137);
                            layerTileOptions.maxResolution = (globalConstraints.maxScale + 1) * 0.00028 * 180 / (Math.PI * 6378137);
                        }
                    }
                }
            }
            Utils.mergeParams(layerTileOptions, options.olParams);
            ol.layer.Tile.call(this, layerTileOptions);
        }
        ol.inherits(LayerWMTS, ol.layer.Tile);
        LayerWMTS.prototype = Object.create(ol.layer.Tile.prototype, {});
        LayerWMTS.prototype.constructor = LayerWMTS;
        return LayerWMTS;
    }(ol, CommonUtils, CommonUtilsConfig, CommonUtilsLayerUtils, Ol3LayersSourceWMTS);
    Ol3LayersLayerWMS = function (ol, Utils, Config, LayerUtils, SourceWMS) {
        function LayerWMS(options) {
            if (!(this instanceof LayerWMS)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            if (!options.layer) {
                throw new Error('ERROR PARAM_MISSING : layer');
            }
            if (typeof options.layer !== 'string') {
                throw new Error('ERROR WRONG TYPE : layer');
            }
            if (!Config.isConfigLoaded()) {
                throw new Error('ERROR : contract key configuration has to be loaded to load Geoportal layers. See http://ignf.github.io/evolution-apigeoportail/ol3/ol3-autoconf.html');
            }
            var olSourceParams;
            if (options.olParams && options.olParams.sourceParams) {
                olSourceParams = options.olParams.sourceParams;
            }
            var wmsSource = new SourceWMS({
                layer: options.layer,
                apiKey: options.apiKey,
                olParams: olSourceParams
            });
            var layerTileOptions = { source: wmsSource };
            if (wmsSource.getParams().LAYERS !== undefined) {
                var layerId = Config.getLayerId(options.layer, 'WMS');
                var globalConstraints = Config.getGlobalConstraints(layerId);
                if (olSourceParams && olSourceParams.projection) {
                    var geobbox = [
                        globalConstraints.extent.left,
                        globalConstraints.extent.bottom,
                        globalConstraints.extent.right,
                        globalConstraints.extent.top
                    ];
                    layerTileOptions.extent = ol.proj.transformExtent(geobbox, 'EPSG:4326', olSourceParams.projection);
                    var p;
                    if (typeof olSourceParams.projection === 'string') {
                        p = ol.proj.get(olSourceParams.projection);
                    } else if (typeof olSourceParams.projection === 'object' && olSourceParams.projection.getCode()) {
                        p = ol.proj.get(olSourceParams.projection.getCode());
                    }
                    if (p && p.getUnits()) {
                        if (p.getUnits() === 'm') {
                            layerTileOptions.minResolution = (globalConstraints.minScale - 1) * 0.00028;
                            layerTileOptions.maxResolution = (globalConstraints.maxScale + 1) * 0.00028;
                        } else if (p.getUnits() === 'degrees') {
                            layerTileOptions.minResolution = (globalConstraints.minScale - 1) * 0.00028 * 180 / (Math.PI * 6378137);
                            layerTileOptions.maxResolution = (globalConstraints.maxScale + 1) * 0.00028 * 180 / (Math.PI * 6378137);
                        }
                    }
                }
            }
            Utils.mergeParams(layerTileOptions, options.olParams);
            ol.layer.Tile.call(this, layerTileOptions);
        }
        ol.inherits(LayerWMS, ol.layer.Tile);
        LayerWMS.prototype = Object.create(ol.layer.Tile.prototype, {});
        LayerWMS.prototype.constructor = LayerWMS;
        return LayerWMS;
    }(ol, CommonUtils, CommonUtilsConfig, CommonUtilsLayerUtils, Ol3LayersSourceWMS);
    CommonUtilsSelectorID = function () {
        var SelectorID = {
            generate: function () {
                var timestamp = Math.floor(Date.now());
                return function () {
                    return timestamp++;
                };
            }(),
            name: function (id) {
                var name = null;
                var i = id.lastIndexOf('-');
                if (i === -1) {
                    name = id;
                } else {
                    name = id.substring(0, i);
                }
                return name;
            },
            index: function (id) {
                var index = null;
                var name = this.name(id);
                var i = name.lastIndexOf('_');
                if (i !== -1) {
                    index = name.substring(i + 1);
                }
                return index;
            },
            uuid: function (id) {
                var uuid = null;
                var i = id.lastIndexOf('-');
                if (i !== -1) {
                    uuid = parseInt(id.substring(i + 1), 10);
                }
                return uuid;
            }
        };
        return SelectorID;
    }();
    (function (factory) {
        'use strict';
        if (true) {
            sortable = function () {
                return typeof factory === 'function' ? factory() : factory;
            }();
        } else if (typeof module != 'undefined' && typeof module.exports != 'undefined') {
            module.exports = factory();
        } else if (typeof Package !== 'undefined') {
            Sortable = factory();
        } else {
            window['Sortable'] = factory();
        }
    }(function () {
        'use strict';
        var dragEl, parentEl, ghostEl, cloneEl, rootEl, nextEl, scrollEl, scrollParentEl, lastEl, lastCSS, lastParentCSS, oldIndex, newIndex, activeGroup, autoScroll = {}, tapEvt, touchEvt, moved, RSPACE = /\s+/g, expando = 'Sortable' + new Date().getTime(), win = window, document = win.document, parseInt = win.parseInt, supportDraggable = !!('draggable' in document.createElement('div')), supportCssPointerEvents = function (el) {
                el = document.createElement('x');
                el.style.cssText = 'pointer-events:auto';
                return el.style.pointerEvents === 'auto';
            }(), _silent = false, abs = Math.abs, slice = [].slice, touchDragOverListeners = [], _autoScroll = _throttle(function (evt, options, rootEl) {
                if (rootEl && options.scroll) {
                    var el, rect, sens = options.scrollSensitivity, speed = options.scrollSpeed, x = evt.clientX, y = evt.clientY, winWidth = window.innerWidth, winHeight = window.innerHeight, vx, vy;
                    if (scrollParentEl !== rootEl) {
                        scrollEl = options.scroll;
                        scrollParentEl = rootEl;
                        if (scrollEl === true) {
                            scrollEl = rootEl;
                            do {
                                if (scrollEl.offsetWidth < scrollEl.scrollWidth || scrollEl.offsetHeight < scrollEl.scrollHeight) {
                                    break;
                                }
                            } while (scrollEl = scrollEl.parentNode);
                        }
                    }
                    if (scrollEl) {
                        el = scrollEl;
                        rect = scrollEl.getBoundingClientRect();
                        vx = (abs(rect.right - x) <= sens) - (abs(rect.left - x) <= sens);
                        vy = (abs(rect.bottom - y) <= sens) - (abs(rect.top - y) <= sens);
                    }
                    if (!(vx || vy)) {
                        vx = (winWidth - x <= sens) - (x <= sens);
                        vy = (winHeight - y <= sens) - (y <= sens);
                        (vx || vy) && (el = win);
                    }
                    if (autoScroll.vx !== vx || autoScroll.vy !== vy || autoScroll.el !== el) {
                        autoScroll.el = el;
                        autoScroll.vx = vx;
                        autoScroll.vy = vy;
                        clearInterval(autoScroll.pid);
                        if (el) {
                            autoScroll.pid = setInterval(function () {
                                if (el === win) {
                                    win.scrollTo(win.pageXOffset + vx * speed, win.pageYOffset + vy * speed);
                                } else {
                                    vy && (el.scrollTop += vy * speed);
                                    vx && (el.scrollLeft += vx * speed);
                                }
                            }, 24);
                        }
                    }
                }
            }, 30), _prepareGroup = function (options) {
                var group = options.group;
                if (!group || typeof group != 'object') {
                    group = options.group = { name: group };
                }
                [
                    'pull',
                    'put'
                ].forEach(function (key) {
                    if (!(key in group)) {
                        group[key] = true;
                    }
                });
                options.groups = ' ' + group.name + (group.put.join ? ' ' + group.put.join(' ') : '') + ' ';
            };
        function Sortable(el, options) {
            if (!(el && el.nodeType && el.nodeType === 1)) {
                throw 'Sortable: `el` must be HTMLElement, and not ' + {}.toString.call(el);
            }
            this.el = el;
            this.options = options = _extend({}, options);
            el[expando] = this;
            var defaults = {
                group: Math.random(),
                sort: true,
                disabled: false,
                store: null,
                handle: null,
                scroll: true,
                scrollSensitivity: 30,
                scrollSpeed: 10,
                draggable: /[uo]l/i.test(el.nodeName) ? 'li' : '>*',
                ghostClass: 'sortable-ghost',
                chosenClass: 'sortable-chosen',
                ignore: 'a, img',
                filter: null,
                animation: 0,
                setData: function (dataTransfer, dragEl) {
                    dataTransfer.setData('Text', dragEl.textContent);
                },
                dropBubble: false,
                dragoverBubble: false,
                dataIdAttr: 'data-id',
                delay: 0,
                forceFallback: false,
                fallbackClass: 'sortable-fallback',
                fallbackOnBody: false
            };
            for (var name in defaults) {
                !(name in options) && (options[name] = defaults[name]);
            }
            _prepareGroup(options);
            for (var fn in this) {
                if (fn.charAt(0) === '_') {
                    this[fn] = this[fn].bind(this);
                }
            }
            this.nativeDraggable = options.forceFallback ? false : supportDraggable;
            _on(el, 'mousedown', this._onTapStart);
            _on(el, 'touchstart', this._onTapStart);
            if (this.nativeDraggable) {
                _on(el, 'dragover', this);
                _on(el, 'dragenter', this);
            }
            touchDragOverListeners.push(this._onDragOver);
            options.store && this.sort(options.store.get(this));
        }
        Sortable.prototype = {
            constructor: Sortable,
            _onTapStart: function (evt) {
                var _this = this, el = this.el, options = this.options, type = evt.type, touch = evt.touches && evt.touches[0], target = (touch || evt).target, originalTarget = target, filter = options.filter;
                if (type === 'mousedown' && evt.button !== 0 || options.disabled) {
                    return;
                }
                target = _closest(target, options.draggable, el);
                if (!target) {
                    return;
                }
                oldIndex = _index(target);
                if (typeof filter === 'function') {
                    if (filter.call(this, evt, target, this)) {
                        _dispatchEvent(_this, originalTarget, 'filter', target, el, oldIndex);
                        evt.preventDefault();
                        return;
                    }
                } else if (filter) {
                    filter = filter.split(',').some(function (criteria) {
                        criteria = _closest(originalTarget, criteria.trim(), el);
                        if (criteria) {
                            _dispatchEvent(_this, criteria, 'filter', target, el, oldIndex);
                            return true;
                        }
                    });
                    if (filter) {
                        evt.preventDefault();
                        return;
                    }
                }
                if (options.handle && !_closest(originalTarget, options.handle, el)) {
                    return;
                }
                this._prepareDragStart(evt, touch, target);
            },
            _prepareDragStart: function (evt, touch, target) {
                var _this = this, el = _this.el, options = _this.options, ownerDocument = el.ownerDocument, dragStartFn;
                if (target && !dragEl && target.parentNode === el) {
                    tapEvt = evt;
                    rootEl = el;
                    dragEl = target;
                    parentEl = dragEl.parentNode;
                    nextEl = dragEl.nextSibling;
                    activeGroup = options.group;
                    dragStartFn = function () {
                        _this._disableDelayedDrag();
                        dragEl.draggable = true;
                        _toggleClass(dragEl, _this.options.chosenClass, true);
                        _this._triggerDragStart(touch);
                    };
                    options.ignore.split(',').forEach(function (criteria) {
                        _find(dragEl, criteria.trim(), _disableDraggable);
                    });
                    _on(ownerDocument, 'mouseup', _this._onDrop);
                    _on(ownerDocument, 'touchend', _this._onDrop);
                    _on(ownerDocument, 'touchcancel', _this._onDrop);
                    if (options.delay) {
                        _on(ownerDocument, 'mouseup', _this._disableDelayedDrag);
                        _on(ownerDocument, 'touchend', _this._disableDelayedDrag);
                        _on(ownerDocument, 'touchcancel', _this._disableDelayedDrag);
                        _on(ownerDocument, 'mousemove', _this._disableDelayedDrag);
                        _on(ownerDocument, 'touchmove', _this._disableDelayedDrag);
                        _this._dragStartTimer = setTimeout(dragStartFn, options.delay);
                    } else {
                        dragStartFn();
                    }
                }
            },
            _disableDelayedDrag: function () {
                var ownerDocument = this.el.ownerDocument;
                clearTimeout(this._dragStartTimer);
                _off(ownerDocument, 'mouseup', this._disableDelayedDrag);
                _off(ownerDocument, 'touchend', this._disableDelayedDrag);
                _off(ownerDocument, 'touchcancel', this._disableDelayedDrag);
                _off(ownerDocument, 'mousemove', this._disableDelayedDrag);
                _off(ownerDocument, 'touchmove', this._disableDelayedDrag);
            },
            _triggerDragStart: function (touch) {
                if (touch) {
                    tapEvt = {
                        target: dragEl,
                        clientX: touch.clientX,
                        clientY: touch.clientY
                    };
                    this._onDragStart(tapEvt, 'touch');
                } else if (!this.nativeDraggable) {
                    this._onDragStart(tapEvt, true);
                } else {
                    _on(dragEl, 'dragend', this);
                    _on(rootEl, 'dragstart', this._onDragStart);
                }
                try {
                    if (document.selection) {
                        document.selection.empty();
                    } else {
                        window.getSelection().removeAllRanges();
                    }
                } catch (err) {
                }
            },
            _dragStarted: function () {
                if (rootEl && dragEl) {
                    _toggleClass(dragEl, this.options.ghostClass, true);
                    Sortable.active = this;
                    _dispatchEvent(this, rootEl, 'start', dragEl, rootEl, oldIndex);
                }
            },
            _emulateDragOver: function () {
                if (touchEvt) {
                    if (this._lastX === touchEvt.clientX && this._lastY === touchEvt.clientY) {
                        return;
                    }
                    this._lastX = touchEvt.clientX;
                    this._lastY = touchEvt.clientY;
                    if (!supportCssPointerEvents) {
                        _css(ghostEl, 'display', 'none');
                    }
                    var target = document.elementFromPoint(touchEvt.clientX, touchEvt.clientY), parent = target, groupName = ' ' + this.options.group.name + '', i = touchDragOverListeners.length;
                    if (parent) {
                        do {
                            if (parent[expando] && parent[expando].options.groups.indexOf(groupName) > -1) {
                                while (i--) {
                                    touchDragOverListeners[i]({
                                        clientX: touchEvt.clientX,
                                        clientY: touchEvt.clientY,
                                        target: target,
                                        rootEl: parent
                                    });
                                }
                                break;
                            }
                            target = parent;
                        } while (parent = parent.parentNode);
                    }
                    if (!supportCssPointerEvents) {
                        _css(ghostEl, 'display', '');
                    }
                }
            },
            _onTouchMove: function (evt) {
                if (tapEvt) {
                    if (!Sortable.active) {
                        this._dragStarted();
                    }
                    this._appendGhost();
                    var touch = evt.touches ? evt.touches[0] : evt, dx = touch.clientX - tapEvt.clientX, dy = touch.clientY - tapEvt.clientY, translate3d = evt.touches ? 'translate3d(' + dx + 'px,' + dy + 'px,0)' : 'translate(' + dx + 'px,' + dy + 'px)';
                    moved = true;
                    touchEvt = touch;
                    _css(ghostEl, 'webkitTransform', translate3d);
                    _css(ghostEl, 'mozTransform', translate3d);
                    _css(ghostEl, 'msTransform', translate3d);
                    _css(ghostEl, 'transform', translate3d);
                    evt.preventDefault();
                }
            },
            _appendGhost: function () {
                if (!ghostEl) {
                    var rect = dragEl.getBoundingClientRect(), css = _css(dragEl), options = this.options, ghostRect;
                    ghostEl = dragEl.cloneNode(true);
                    _toggleClass(ghostEl, options.ghostClass, false);
                    _toggleClass(ghostEl, options.fallbackClass, true);
                    _css(ghostEl, 'top', rect.top - parseInt(css.marginTop, 10));
                    _css(ghostEl, 'left', rect.left - parseInt(css.marginLeft, 10));
                    _css(ghostEl, 'width', rect.width);
                    _css(ghostEl, 'height', rect.height);
                    _css(ghostEl, 'opacity', '0.8');
                    _css(ghostEl, 'position', 'fixed');
                    _css(ghostEl, 'zIndex', '100000');
                    _css(ghostEl, 'pointerEvents', 'none');
                    options.fallbackOnBody && document.body.appendChild(ghostEl) || rootEl.appendChild(ghostEl);
                    ghostRect = ghostEl.getBoundingClientRect();
                    _css(ghostEl, 'width', rect.width * 2 - ghostRect.width);
                    _css(ghostEl, 'height', rect.height * 2 - ghostRect.height);
                }
            },
            _onDragStart: function (evt, useFallback) {
                var dataTransfer = evt.dataTransfer, options = this.options;
                this._offUpEvents();
                if (activeGroup.pull == 'clone') {
                    cloneEl = dragEl.cloneNode(true);
                    _css(cloneEl, 'display', 'none');
                    rootEl.insertBefore(cloneEl, dragEl);
                }
                if (useFallback) {
                    if (useFallback === 'touch') {
                        _on(document, 'touchmove', this._onTouchMove);
                        _on(document, 'touchend', this._onDrop);
                        _on(document, 'touchcancel', this._onDrop);
                    } else {
                        _on(document, 'mousemove', this._onTouchMove);
                        _on(document, 'mouseup', this._onDrop);
                    }
                    this._loopId = setInterval(this._emulateDragOver, 50);
                } else {
                    if (dataTransfer) {
                        dataTransfer.effectAllowed = 'move';
                        options.setData && options.setData.call(this, dataTransfer, dragEl);
                    }
                    _on(document, 'drop', this);
                    setTimeout(this._dragStarted, 0);
                }
            },
            _onDragOver: function (evt) {
                var el = this.el, target, dragRect, revert, options = this.options, group = options.group, groupPut = group.put, isOwner = activeGroup === group, canSort = options.sort;
                if (evt.preventDefault !== void 0) {
                    evt.preventDefault();
                    !options.dragoverBubble && evt.stopPropagation();
                }
                moved = true;
                if (activeGroup && !options.disabled && (isOwner ? canSort || (revert = !rootEl.contains(dragEl)) : activeGroup.pull && groupPut && (activeGroup.name === group.name || groupPut.indexOf && ~groupPut.indexOf(activeGroup.name))) && (evt.rootEl === void 0 || evt.rootEl === this.el)) {
                    _autoScroll(evt, options, this.el);
                    if (_silent) {
                        return;
                    }
                    target = _closest(evt.target, options.draggable, el);
                    dragRect = dragEl.getBoundingClientRect();
                    if (revert) {
                        _cloneHide(true);
                        if (cloneEl || nextEl) {
                            rootEl.insertBefore(dragEl, cloneEl || nextEl);
                        } else if (!canSort) {
                            rootEl.appendChild(dragEl);
                        }
                        return;
                    }
                    if (el.children.length === 0 || el.children[0] === ghostEl || el === evt.target && (target = _ghostIsLast(el, evt))) {
                        if (target) {
                            if (target.animated) {
                                return;
                            }
                            targetRect = target.getBoundingClientRect();
                        }
                        _cloneHide(isOwner);
                        if (_onMove(rootEl, el, dragEl, dragRect, target, targetRect) !== false) {
                            if (!dragEl.contains(el)) {
                                el.appendChild(dragEl);
                                parentEl = el;
                            }
                            this._animate(dragRect, dragEl);
                            target && this._animate(targetRect, target);
                        }
                    } else if (target && !target.animated && target !== dragEl && target.parentNode[expando] !== void 0) {
                        if (lastEl !== target) {
                            lastEl = target;
                            lastCSS = _css(target);
                            lastParentCSS = _css(target.parentNode);
                        }
                        var targetRect = target.getBoundingClientRect(), width = targetRect.right - targetRect.left, height = targetRect.bottom - targetRect.top, floating = /left|right|inline/.test(lastCSS.cssFloat + lastCSS.display) || lastParentCSS.display == 'flex' && lastParentCSS['flex-direction'].indexOf('row') === 0, isWide = target.offsetWidth > dragEl.offsetWidth, isLong = target.offsetHeight > dragEl.offsetHeight, halfway = (floating ? (evt.clientX - targetRect.left) / width : (evt.clientY - targetRect.top) / height) > 0.5, nextSibling = target.nextElementSibling, moveVector = _onMove(rootEl, el, dragEl, dragRect, target, targetRect), after;
                        if (moveVector !== false) {
                            _silent = true;
                            setTimeout(_unsilent, 30);
                            _cloneHide(isOwner);
                            if (moveVector === 1 || moveVector === -1) {
                                after = moveVector === 1;
                            } else if (floating) {
                                var elTop = dragEl.offsetTop, tgTop = target.offsetTop;
                                if (elTop === tgTop) {
                                    after = target.previousElementSibling === dragEl && !isWide || halfway && isWide;
                                } else {
                                    after = tgTop > elTop;
                                }
                            } else {
                                after = nextSibling !== dragEl && !isLong || halfway && isLong;
                            }
                            if (!dragEl.contains(el)) {
                                if (after && !nextSibling) {
                                    el.appendChild(dragEl);
                                } else {
                                    target.parentNode.insertBefore(dragEl, after ? nextSibling : target);
                                }
                            }
                            parentEl = dragEl.parentNode;
                            this._animate(dragRect, dragEl);
                            this._animate(targetRect, target);
                        }
                    }
                }
            },
            _animate: function (prevRect, target) {
                var ms = this.options.animation;
                if (ms) {
                    var currentRect = target.getBoundingClientRect();
                    _css(target, 'transition', 'none');
                    _css(target, 'transform', 'translate3d(' + (prevRect.left - currentRect.left) + 'px,' + (prevRect.top - currentRect.top) + 'px,0)');
                    target.offsetWidth;
                    _css(target, 'transition', 'all ' + ms + 'ms');
                    _css(target, 'transform', 'translate3d(0,0,0)');
                    clearTimeout(target.animated);
                    target.animated = setTimeout(function () {
                        _css(target, 'transition', '');
                        _css(target, 'transform', '');
                        target.animated = false;
                    }, ms);
                }
            },
            _offUpEvents: function () {
                var ownerDocument = this.el.ownerDocument;
                _off(document, 'touchmove', this._onTouchMove);
                _off(ownerDocument, 'mouseup', this._onDrop);
                _off(ownerDocument, 'touchend', this._onDrop);
                _off(ownerDocument, 'touchcancel', this._onDrop);
            },
            _onDrop: function (evt) {
                var el = this.el, options = this.options;
                clearInterval(this._loopId);
                clearInterval(autoScroll.pid);
                clearTimeout(this._dragStartTimer);
                _off(document, 'mousemove', this._onTouchMove);
                if (this.nativeDraggable) {
                    _off(document, 'drop', this);
                    _off(el, 'dragstart', this._onDragStart);
                }
                this._offUpEvents();
                if (evt) {
                    if (moved) {
                        evt.preventDefault();
                        !options.dropBubble && evt.stopPropagation();
                    }
                    ghostEl && ghostEl.parentNode.removeChild(ghostEl);
                    if (dragEl) {
                        if (this.nativeDraggable) {
                            _off(dragEl, 'dragend', this);
                        }
                        _disableDraggable(dragEl);
                        _toggleClass(dragEl, this.options.ghostClass, false);
                        _toggleClass(dragEl, this.options.chosenClass, false);
                        if (rootEl !== parentEl) {
                            newIndex = _index(dragEl);
                            if (newIndex >= 0) {
                                _dispatchEvent(null, parentEl, 'sort', dragEl, rootEl, oldIndex, newIndex);
                                _dispatchEvent(this, rootEl, 'sort', dragEl, rootEl, oldIndex, newIndex);
                                _dispatchEvent(null, parentEl, 'add', dragEl, rootEl, oldIndex, newIndex);
                                _dispatchEvent(this, rootEl, 'remove', dragEl, rootEl, oldIndex, newIndex);
                            }
                        } else {
                            cloneEl && cloneEl.parentNode.removeChild(cloneEl);
                            if (dragEl.nextSibling !== nextEl) {
                                newIndex = _index(dragEl);
                                if (newIndex >= 0) {
                                    _dispatchEvent(this, rootEl, 'update', dragEl, rootEl, oldIndex, newIndex);
                                    _dispatchEvent(this, rootEl, 'sort', dragEl, rootEl, oldIndex, newIndex);
                                }
                            }
                        }
                        if (Sortable.active) {
                            if (newIndex === null || newIndex === -1) {
                                newIndex = oldIndex;
                            }
                            _dispatchEvent(this, rootEl, 'end', dragEl, rootEl, oldIndex, newIndex);
                            this.save();
                        }
                    }
                    rootEl = dragEl = parentEl = ghostEl = nextEl = cloneEl = scrollEl = scrollParentEl = tapEvt = touchEvt = moved = newIndex = lastEl = lastCSS = activeGroup = Sortable.active = null;
                }
            },
            handleEvent: function (evt) {
                var type = evt.type;
                if (type === 'dragover' || type === 'dragenter') {
                    if (dragEl) {
                        this._onDragOver(evt);
                        _globalDragOver(evt);
                    }
                } else if (type === 'drop' || type === 'dragend') {
                    this._onDrop(evt);
                }
            },
            toArray: function () {
                var order = [], el, children = this.el.children, i = 0, n = children.length, options = this.options;
                for (; i < n; i++) {
                    el = children[i];
                    if (_closest(el, options.draggable, this.el)) {
                        order.push(el.getAttribute(options.dataIdAttr) || _generateId(el));
                    }
                }
                return order;
            },
            sort: function (order) {
                var items = {}, rootEl = this.el;
                this.toArray().forEach(function (id, i) {
                    var el = rootEl.children[i];
                    if (_closest(el, this.options.draggable, rootEl)) {
                        items[id] = el;
                    }
                }, this);
                order.forEach(function (id) {
                    if (items[id]) {
                        rootEl.removeChild(items[id]);
                        rootEl.appendChild(items[id]);
                    }
                });
            },
            save: function () {
                var store = this.options.store;
                store && store.set(this);
            },
            closest: function (el, selector) {
                return _closest(el, selector || this.options.draggable, this.el);
            },
            option: function (name, value) {
                var options = this.options;
                if (value === void 0) {
                    return options[name];
                } else {
                    options[name] = value;
                    if (name === 'group') {
                        _prepareGroup(options);
                    }
                }
            },
            destroy: function () {
                var el = this.el;
                el[expando] = null;
                _off(el, 'mousedown', this._onTapStart);
                _off(el, 'touchstart', this._onTapStart);
                if (this.nativeDraggable) {
                    _off(el, 'dragover', this);
                    _off(el, 'dragenter', this);
                }
                Array.prototype.forEach.call(el.querySelectorAll('[draggable]'), function (el) {
                    el.removeAttribute('draggable');
                });
                touchDragOverListeners.splice(touchDragOverListeners.indexOf(this._onDragOver), 1);
                this._onDrop();
                this.el = el = null;
            }
        };
        function _cloneHide(state) {
            if (cloneEl && cloneEl.state !== state) {
                _css(cloneEl, 'display', state ? 'none' : '');
                !state && cloneEl.state && rootEl.insertBefore(cloneEl, dragEl);
                cloneEl.state = state;
            }
        }
        function _closest(el, selector, ctx) {
            if (el) {
                ctx = ctx || document;
                selector = selector.split('.');
                var tag = selector.shift().toUpperCase(), re = new RegExp('\\s(' + selector.join('|') + ')(?=\\s)', 'g');
                do {
                    if (tag === '>*' && el.parentNode === ctx || (tag === '' || el.nodeName.toUpperCase() == tag) && (!selector.length || ((' ' + el.className + ' ').match(re) || []).length == selector.length)) {
                        return el;
                    }
                } while (el !== ctx && (el = el.parentNode));
            }
            return null;
        }
        function _globalDragOver(evt) {
            if (evt.dataTransfer) {
                evt.dataTransfer.dropEffect = 'move';
            }
            evt.preventDefault();
        }
        function _on(el, event, fn) {
            el.addEventListener(event, fn, false);
        }
        function _off(el, event, fn) {
            el.removeEventListener(event, fn, false);
        }
        function _toggleClass(el, name, state) {
            if (el) {
                if (el.classList) {
                    el.classList[state ? 'add' : 'remove'](name);
                } else {
                    var className = (' ' + el.className + ' ').replace(RSPACE, ' ').replace(' ' + name + ' ', ' ');
                    el.className = (className + (state ? ' ' + name : '')).replace(RSPACE, ' ');
                }
            }
        }
        function _css(el, prop, val) {
            var style = el && el.style;
            if (style) {
                if (val === void 0) {
                    if (document.defaultView && document.defaultView.getComputedStyle) {
                        val = document.defaultView.getComputedStyle(el, '');
                    } else if (el.currentStyle) {
                        val = el.currentStyle;
                    }
                    return prop === void 0 ? val : val[prop];
                } else {
                    if (!(prop in style)) {
                        prop = '-webkit-' + prop;
                    }
                    style[prop] = val + (typeof val === 'string' ? '' : 'px');
                }
            }
        }
        function _find(ctx, tagName, iterator) {
            if (ctx) {
                var list = ctx.getElementsByTagName(tagName), i = 0, n = list.length;
                if (iterator) {
                    for (; i < n; i++) {
                        iterator(list[i], i);
                    }
                }
                return list;
            }
            return [];
        }
        function _dispatchEvent(sortable, rootEl, name, targetEl, fromEl, startIndex, newIndex) {
            var evt = document.createEvent('Event'), options = (sortable || rootEl[expando]).options, onName = 'on' + name.charAt(0).toUpperCase() + name.substr(1);
            evt.initEvent(name, true, true);
            evt.to = rootEl;
            evt.from = fromEl || rootEl;
            evt.item = targetEl || rootEl;
            evt.clone = cloneEl;
            evt.oldIndex = startIndex;
            evt.newIndex = newIndex;
            rootEl.dispatchEvent(evt);
            if (options[onName]) {
                options[onName].call(sortable, evt);
            }
        }
        function _onMove(fromEl, toEl, dragEl, dragRect, targetEl, targetRect) {
            var evt, sortable = fromEl[expando], onMoveFn = sortable.options.onMove, retVal;
            evt = document.createEvent('Event');
            evt.initEvent('move', true, true);
            evt.to = toEl;
            evt.from = fromEl;
            evt.dragged = dragEl;
            evt.draggedRect = dragRect;
            evt.related = targetEl || toEl;
            evt.relatedRect = targetRect || toEl.getBoundingClientRect();
            fromEl.dispatchEvent(evt);
            if (onMoveFn) {
                retVal = onMoveFn.call(sortable, evt);
            }
            return retVal;
        }
        function _disableDraggable(el) {
            el.draggable = false;
        }
        function _unsilent() {
            _silent = false;
        }
        function _ghostIsLast(el, evt) {
            var lastEl = el.lastElementChild, rect = lastEl.getBoundingClientRect();
            return (evt.clientY - (rect.top + rect.height) > 5 || evt.clientX - (rect.right + rect.width) > 5) && lastEl;
        }
        function _generateId(el) {
            var str = el.tagName + el.className + el.src + el.href + el.textContent, i = str.length, sum = 0;
            while (i--) {
                sum += str.charCodeAt(i);
            }
            return sum.toString(36);
        }
        function _index(el) {
            var index = 0;
            if (!el || !el.parentNode) {
                return -1;
            }
            while (el && (el = el.previousElementSibling)) {
                if (el.nodeName.toUpperCase() !== 'TEMPLATE') {
                    index++;
                }
            }
            return index;
        }
        function _throttle(callback, ms) {
            var args, _this;
            return function () {
                if (args === void 0) {
                    args = arguments;
                    _this = this;
                    setTimeout(function () {
                        if (args.length === 1) {
                            callback.call(_this, args[0]);
                        } else {
                            callback.apply(_this, args);
                        }
                        args = void 0;
                    }, ms);
                }
            };
        }
        function _extend(dst, src) {
            if (dst && src) {
                for (var key in src) {
                    if (src.hasOwnProperty(key)) {
                        dst[key] = src[key];
                    }
                }
            }
            return dst;
        }
        Sortable.utils = {
            on: _on,
            off: _off,
            css: _css,
            find: _find,
            is: function (el, selector) {
                return !!_closest(el, selector, el);
            },
            extend: _extend,
            throttle: _throttle,
            closest: _closest,
            toggleClass: _toggleClass,
            index: _index
        };
        Sortable.create = function (el, options) {
            return new Sortable(el, options);
        };
        Sortable.version = '1.3.0';
        return Sortable;
    }));
    CommonControlsLayerSwitcherDOM = function (Sortable) {
        var LayerSwitcherDOM = {
            _createDraggableElement: function (elementDraggable, context) {
                Sortable.create(elementDraggable, {
                    handle: '.GPlayerName',
                    draggable: '.draggable-layer',
                    ghostClass: 'GPghostLayer',
                    animation: 200,
                    onEnd: function (e) {
                        context._onDragAndDropLayerClick(e);
                    }
                });
            },
            _addUID: function (id) {
                var uid = this._uid ? id + '-' + this._uid : id;
                return uid;
            },
            _createMainContainerElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GPlayerSwitcher');
                container.className = 'GPwidget';
                return container;
            },
            _createMainLayersShowElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPshowLayersList');
                input.type = 'checkbox';
                return input;
            },
            _createMainLayersElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPlayersList');
                div.className = 'GPpanel';
                return div;
            },
            _createMainPictoElement: function () {
                var self = this;
                var label = document.createElement('label');
                label.id = this._addUID('GPshowLayersListPicto');
                label.className = 'GPshowAdvancedToolPicto';
                label.htmlFor = this._addUID('GPshowLayersList');
                label.title = 'Afficher/masquer le gestionnaire de couches';
                var spanOpen = document.createElement('span');
                spanOpen.id = this._addUID('GPshowLayersListOpen');
                spanOpen.className = 'GPshowAdvancedToolOpen';
                spanOpen.addEventListener('click', function () {
                    if (document.getElementById(self._addUID('GPshowLayersList')).checked) {
                        var layers = document.getElementsByClassName('GPlayerInfoOpened');
                        for (var i = 0; i < layers.length; i++) {
                            layers[i].className = 'GPlayerInfo';
                        }
                        document.getElementById(self._addUID('GPlayerInfoPanel')).className = 'GPlayerInfoPanelClosed';
                    }
                });
                label.appendChild(spanOpen);
                var spanClose = document.createElement('span');
                spanClose.addEventListener('click', function () {
                    if (document.getElementById(self._addUID('GPshowLayersList')).checked) {
                        var layers = document.getElementsByClassName('GPlayerInfoOpened');
                        for (var i = 0; i < layers.length; i++) {
                            layers[i].className = 'GPlayerInfo';
                        }
                        document.getElementById(self._addUID('GPlayerInfoPanel')).className = 'GPlayerInfoPanelClosed';
                    }
                });
                spanClose.id = self._addUID('GPshowLayersListClose');
                label.appendChild(spanClose);
                return label;
            },
            _createMainInfoElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPlayerInfoPanel');
                div.className = 'GPpanel GPlayerInfoPanelClosed';
                return div;
            },
            _createContainerLayerElement: function (obj) {
                var container = document.createElement('div');
                container.id = this._addUID('GPlayerSwitcher_ID_' + obj.id);
                container.className = 'GPlayerSwitcher_layer draggable-layer';
                container.appendChild(this._createBasicToolElement(obj));
                var array = this._createAdvancedToolShowElement(obj);
                for (var i = 0; i < array.length; i++) {
                    container.appendChild(array[i]);
                }
                container.appendChild(this._createAdvancedToolElement(obj));
                return container;
            },
            _createBasicToolElement: function (obj) {
                var div = document.createElement('div');
                div.id = this._addUID('GPbasicTools_ID_' + obj.id);
                div.className = 'GPlayerBasicTools';
                div.appendChild(this._createBasicToolNameElement(obj));
                var array = this._createBasicToolVisibilityElement(obj);
                for (var i = 0; i < array.length; i++) {
                    div.appendChild(array[i]);
                }
                return div;
            },
            _createBasicToolNameElement: function (obj) {
                var span = document.createElement('span');
                span.id = this._addUID('GPname_ID_' + obj.id);
                span.className = 'GPlayerName';
                span.title = obj.description || obj.title;
                span.innerHTML = obj.title;
                return span;
            },
            _createBasicToolVisibilityElement: function (obj) {
                var list = [];
                var checked = typeof obj.visibility !== 'undefined' ? obj.visibility : true;
                var id = this._addUID('GPvisibility_ID_' + obj.id);
                var input = document.createElement('input');
                input.id = id;
                input.type = 'checkbox';
                input.checked = checked;
                var label = document.createElement('label');
                label.htmlFor = id;
                label.id = this._addUID('GPvisibilityPicto_ID_' + obj.id);
                label.className = 'GPlayerVisibility';
                label.title = 'Afficher/masquer la couche';
                var context = this;
                if (input.addEventListener) {
                    input.addEventListener('click', function (e) {
                        context._onVisibilityLayerClick.call(context, e);
                    });
                } else if (input.attachEvent) {
                    input.attachEvent('onclick', function (e) {
                        context._onVisibilityLayerClick.call(context, e);
                    });
                }
                list.push(input);
                list.push(label);
                return list;
            },
            _createAdvancedToolShowElement: function (obj) {
                var list = [];
                var label = document.createElement('label');
                label.id = this._addUID('GPshowAdvancedToolsPicto_ID_' + obj.id);
                label.htmlFor = this._addUID('GPshowAdvancedTools_ID_' + obj.id);
                label.title = 'Plus d\'outils';
                label.className = 'GPshowMoreOptions GPshowLayerAdvancedTools';
                var input = document.createElement('input');
                input.type = 'checkbox';
                input.id = this._addUID('GPshowAdvancedTools_ID_' + obj.id);
                list.push(input);
                list.push(label);
                return list;
            },
            _createAdvancedToolElement: function (obj) {
                var container = document.createElement('div');
                container.id = this._addUID('GPadvancedTools_ID_' + obj.id);
                container.className = 'GPlayerAdvancedTools';
                container.appendChild(this._createAdvancedToolDeleteElement(obj));
                if (obj.title && obj.description) {
                    container.appendChild(this._createAdvancedToolInformationElement(obj));
                }
                if (obj.type !== 'feature') {
                    var array = this._createAdvancedToolOpacityElement(obj);
                    for (var i = 0; i < array.length; i++) {
                        container.appendChild(array[i]);
                    }
                }
                return container;
            },
            _createAdvancedToolDeleteElement: function (obj) {
                var div = document.createElement('div');
                div.id = this._addUID('GPremove_ID_' + obj.id);
                div.className = 'GPlayerRemove';
                div.title = 'Supprimer la couche';
                div.layerId = obj.id;
                var context = this;
                if (div.addEventListener) {
                    div.addEventListener('click', function (e) {
                        context._onDropLayerClick.call(context, e);
                    });
                } else if (div.attachEvent) {
                    div.attachEvent('onclick', function (e) {
                        context._onDropLayerClick.call(context, e);
                    });
                }
                return div;
            },
            _createAdvancedToolInformationElement: function (obj) {
                var div = document.createElement('div');
                div.id = this._addUID('GPinfo_ID_' + obj.id);
                div.className = 'GPlayerInfo';
                div.title = 'Informations/légende';
                div.layerId = obj.id;
                var context = this;
                if (div.addEventListener) {
                    div.addEventListener('click', function (e) {
                        context._onOpenLayerInfoClick.call(context, e);
                    });
                } else if (div.attachEvent) {
                    div.attachEvent('onclick', function (e) {
                        context._onOpenLayerInfoClick.call(context, e);
                    });
                }
                return div;
            },
            _createAdvancedToolOpacityElement: function (obj) {
                var list = [];
                var divO = document.createElement('div');
                divO.id = this._addUID('GPopacity_ID_' + obj.id);
                divO.className = 'GPlayerOpacity';
                divO.title = 'Opacité';
                var opacity = typeof obj.opacity !== 'undefined' ? obj.opacity : 1;
                opacity = Math.round(opacity * 100);
                var input = document.createElement('input');
                input.id = this._addUID('GPopacityValueDiv_ID_' + obj.id);
                input.type = 'range';
                input.value = opacity;
                var context = this;
                if (input.addEventListener) {
                    input.addEventListener('change', function (e) {
                        context._onChangeLayerOpacity.call(context, e);
                    });
                } else if (input.attachEvent) {
                    input.attachEvent('onchange', function (e) {
                        context._onChangeLayerOpacity.call(context, e);
                    });
                }
                if (input.addEventListener) {
                    input.addEventListener('input', function (e) {
                        context._onChangeLayerOpacity.call(context, e);
                    });
                } else if (input.attachEvent) {
                    input.attachEvent('oninput', function (e) {
                        context._onChangeLayerOpacity.call(context, e);
                    });
                }
                divO.appendChild(input);
                var divC = document.createElement('div');
                divC.id = this._addUID('GPopacityValueDiv_ID_' + obj.id);
                divC.className = 'GPlayerOpacityValue';
                var span = document.createElement('span');
                span.id = this._addUID('GPopacityValue_ID_' + obj.id);
                span.innerHTML = opacity + '%';
                divC.appendChild(span);
                list.push(divO);
                list.push(divC);
                return list;
            },
            _createContainerLayerInfoElement: function (obj) {
                var container = document.createElement('div');
                container.id = this._addUID('GPlayerInfoContent');
                var title = document.createElement('div');
                title.id = this._addUID('GPlayerInfoTitle');
                title.innerHTML = obj.title;
                container.appendChild(title);
                if (obj.quicklookUrl) {
                    var quick = document.createElement('div');
                    quick.id = this._addUID('GPlayerInfoQuicklook');
                    quick.title = 'Afficher un aperçu de la couche';
                    var refquick = document.createElement('a');
                    refquick.href = obj.quicklookUrl;
                    refquick.appendChild(quick);
                    container.appendChild(refquick);
                }
                var close = document.createElement('div');
                close.id = this._addUID('GPlayerInfoClose');
                close.title = 'Fermer la fenêtre';
                var self = this;
                var onCloseClick = function () {
                    document.getElementById(self._addUID('GPlayerInfoPanel')).className = 'GPlayerInfoPanelClosed';
                    var layers = document.getElementsByClassName('GPlayerInfoOpened');
                    for (var i = 0; i < layers.length; i++) {
                        layers[i].className = 'GPlayerInfo';
                    }
                };
                if (close.addEventListener) {
                    close.addEventListener('click', onCloseClick);
                } else if (close.attachEvent) {
                    close.attachEvent('onclick', onCloseClick);
                }
                container.appendChild(close);
                var desc = document.createElement('div');
                desc.id = this._addUID('GPlayerInfoDescription');
                desc.innerHTML = obj.description;
                container.appendChild(desc);
                if (obj.metadata) {
                    var mtd = document.createElement('div');
                    mtd.id = this._addUID('GPlayerInfoMetadata');
                    var mtdtitle = document.createElement('div');
                    mtdtitle.className = 'GPlayerInfoSubtitle';
                    mtdtitle.innerHTML = 'Métadonnées';
                    mtd.appendChild(mtdtitle);
                    for (var i = 0; i < obj.metadata.length; i++) {
                        var urlmtd = obj.metadata[i].url;
                        var mtdlink = document.createElement('div');
                        mtdlink.className = 'GPlayerInfoLink';
                        var refmtd = document.createElement('a');
                        refmtd.href = urlmtd;
                        refmtd.innerHTML = urlmtd;
                        mtdlink.appendChild(refmtd);
                        mtd.appendChild(mtdlink);
                    }
                    if (obj.metadata.length !== 0) {
                        container.appendChild(mtd);
                    }
                }
                if (obj.legends) {
                    var lgd = document.createElement('div');
                    lgd.id = this._addUID('GPlayerInfoLegend');
                    var lgdtitle = document.createElement('div');
                    lgdtitle.className = 'GPlayerInfoSubtitle';
                    lgdtitle.innerHTML = 'Légende';
                    lgd.appendChild(lgdtitle);
                    var legends = {};
                    var maxScale = obj.maxScaleDenominator || 560000000;
                    for (var k = 0; k < obj.legends.length; k++) {
                        var minScale = obj.legends[k].minScaleDenominator;
                        if (minScale) {
                            var s = minScale.toString();
                            minScale = Math.round(parseInt(s.substring(0, 3), 10) / 10) * Math.pow(10, s.length - 2);
                        } else {
                            minScale = 270;
                        }
                        legends[minScale] = obj.legends[k];
                    }
                    for (var scale in legends) {
                        if (legends.hasOwnProperty(scale)) {
                            var urllgd = legends[scale].url;
                            if (typeof urllgd === 'string' && urllgd.toLowerCase().indexOf('nolegend.jpg') == -1) {
                                var lgdlink = document.createElement('div');
                                lgdlink.className = 'GPlayerInfoLink';
                                maxScale = legends[scale].maxScaleDenominator || maxScale;
                                var reflgd = document.createElement('a');
                                reflgd.href = urllgd;
                                reflgd.innerHTML = 'Du 1/' + scale + ' au 1/' + maxScale;
                                lgdlink.appendChild(reflgd);
                                lgd.appendChild(lgdlink);
                            } else {
                                delete legends[scale];
                            }
                        }
                    }
                    if (Object.keys(legends).length !== 0) {
                        container.appendChild(lgd);
                    }
                }
                return container;
            }
        };
        return LayerSwitcherDOM;
    }(sortable);
    Ol3ControlsLayerSwitcher = function (ol, Utils, SelectorID, LayerSwitcherDOM) {
        function LayerSwitcher(lsOptions) {
            lsOptions = lsOptions || {};
            var options = lsOptions.options || {};
            var layers = lsOptions.layers || [];
            if (!(this instanceof LayerSwitcher)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            if (layers && !Array.isArray(layers)) {
                throw new Error('ERROR WRONG_TYPE : layers should be an array');
            }
            if (options && typeof options !== 'object') {
                throw new Error('ERROR WRONG_TYPE : options should be an object');
            }
            this._initialize(options, layers);
            var container = this._initContainer(options);
            ol.control.Control.call(this, {
                element: container,
                target: options.target,
                render: options.render
            });
        }
        ol.inherits(LayerSwitcher, ol.control.Control);
        LayerSwitcher.prototype = Object.create(ol.control.Control.prototype, {});
        Utils.assign(LayerSwitcher.prototype, LayerSwitcherDOM);
        LayerSwitcher.prototype.constructor = LayerSwitcher;
        LayerSwitcher.prototype.setMap = function (map) {
            if (map) {
                this._addMapLayers(map);
                this._listeners.onMoveListener = map.on('moveend', function () {
                    this._onMapMoveEnd.call(this, map);
                }, this);
                this._listeners.onAddListener = map.getLayers().on('add', function (evt) {
                    var layer = evt.element;
                    var id;
                    if (!layer.hasOwnProperty('gpLayerId')) {
                        id = this._layerId;
                        layer.gpLayerId = id;
                        this._layerId++;
                    } else {
                        id = layer.gpLayerId;
                    }
                    if (!this._layers[id]) {
                        this.addLayer(layer);
                    }
                }, this);
                this._listeners.onRemoveListener = map.getLayers().on('remove', function (evt) {
                    var layer = evt.element;
                    var id = layer.gpLayerId;
                    if (this._layers[id]) {
                        this.removeLayer(layer);
                    }
                }, this);
            } else {
                ol.Observable.unByKey(this._listeners.onMoveListener);
                ol.Observable.unByKey(this._listeners.onAddListener);
                ol.Observable.unByKey(this._listeners.onRemoveListener);
                for (var i = this._layersOrder.length - 1; i >= 0; i--) {
                    this._layersOrder[i].layer.setZIndex(0);
                }
            }
            ol.control.Control.prototype.setMap.call(this, map);
        };
        LayerSwitcher.prototype.addLayer = function (layer, config) {
            var map = this.getMap();
            config = config || {};
            if (!layer) {
                console.log('[ERROR] LayerSwitcher:addLayer - missing layer parameter');
                return;
            }
            var id = layer.gpLayerId;
            if (id === 'undefined') {
                console.log('[ERROR] LayerSwitcher:addLayer - configuration cannot be set for ' + layer + ' layer (layer id not found)');
                return;
            }
            var isLayerInMap = false;
            map.getLayers().forEach(function (lyr) {
                if (lyr.gpLayerId === id) {
                    isLayerInMap = true;
                }
            }, this);
            if (!isLayerInMap) {
                console.log('[ERROR] LayerSwitcher:addLayer - configuration cannot be set for ', layer, ' layer (layer is not in map.getLayers() )');
                return;
            }
            if (!this._layers[id]) {
                var layerInfos = this.getLayerInfo(layer) || {};
                var opacity = layer.getOpacity();
                var visibility = layer.getVisible();
                var isInRange = this.isInRange(layer, map);
                var layerOptions = {
                    layer: layer,
                    id: id,
                    opacity: opacity != null ? opacity : 1,
                    visibility: visibility != null ? visibility : true,
                    inRange: isInRange != null ? isInRange : true,
                    title: config.title != null ? config.title : layerInfos._title || id,
                    description: config.description || layerInfos._description || null,
                    legends: config.legends || layerInfos._legends || [],
                    metadata: config.metadata || layerInfos._metadata || [],
                    quicklookUrl: config.quicklookUrl || layerInfos._quicklookUrl || null
                };
                this._layers[id] = layerOptions;
                var layerDiv = this._createLayerDiv(layerOptions);
                this._layers[id].div = layerDiv;
                if (layer.getZIndex && layer.getZIndex() !== 0 || layer._forceNullzIndex) {
                    this._updateLayersOrder(map);
                } else {
                    this._layersOrder.unshift(layerOptions);
                    this._lastZIndex++;
                    layer.setZIndex(this._lastZIndex);
                    this._layerListContainer.insertBefore(layerDiv, this._layerListContainer.firstChild);
                }
                layer.on('change:opacity', this._updateLayerOpacity, this);
                layer.on('change:visible', this._updateLayerVisibility, this);
                var context = this;
                var updateLayersOrder = function (e) {
                    context._updateLayersOrder.call(context, e);
                };
                if (this._layers[id].onZIndexChangeEvent == null) {
                    this._layers[id].onZIndexChangeEvent = layer.on('change:zIndex', updateLayersOrder);
                }
            } else if (this._layers[id] && config) {
                for (var prop in config) {
                    if (config.hasOwnProperty(prop)) {
                        this._layers[id][prop] = config[prop];
                    }
                }
                if (config.title) {
                    var nameDiv = document.getElementById(this._addUID('GPname_ID_' + id));
                    if (nameDiv) {
                        nameDiv.innerHTML = config.title;
                        nameDiv.title = config.description || config.title;
                    }
                }
                var infodiv = document.getElementById(this._addUID('GPinfo_ID_' + id));
                if (!document.getElementById(this._addUID('GPinfo_ID_' + id)) && config.description) {
                    var advancedTools = document.getElementById(this._addUID('GPadvancedTools_ID_' + id));
                    if (advancedTools) {
                        advancedTools.appendChild(this._createAdvancedToolInformationElement({ id: id }));
                    }
                }
                if (infodiv && infodiv.className === 'GPlayerInfoOpened') {
                    document.getElementById(this._addUID('GPlayerInfoPanel')).className = 'GPlayerInfoPanelClosed';
                    infodiv.className === 'GPlayerInfo';
                }
            }
        };
        LayerSwitcher.prototype.removeLayer = function (layer) {
            var layerID = layer.gpLayerId;
            var layerList = document.getElementById(this._addUID('GPlayersList'));
            var infodiv = document.getElementById(this._addUID('GPinfo_ID_' + layerID));
            if (infodiv && infodiv.className === 'GPlayerInfoOpened') {
                document.getElementById(this._addUID('GPlayerInfoPanel')).className = 'GPlayerInfoPanelClosed';
                infodiv.className === 'GPlayerInfo';
            }
            var layerDiv = document.getElementById(this._addUID('GPlayerSwitcher_ID_' + layerID));
            layerList.removeChild(layerDiv);
            var layerIndex = Math.abs(layer.getZIndex() - this._lastZIndex);
            this._layersOrder.splice(layerIndex, 1);
            this._lastZIndex--;
            var layerOrderTemp = this._layersOrder;
            for (var i = 0; i < layerOrderTemp.length; i++) {
                layerOrderTemp[i].layer.setZIndex(this._lastZIndex - i);
            }
            delete this._layers[layerID];
        };
        LayerSwitcher.prototype.setCollapsed = function (collapsed) {
            if (collapsed === undefined) {
                console.log('[ERROR] LayerSwitcher:setCollapsed - missing collapsed parameter');
                return;
            }
            var isCollapsed = !document.getElementById(this._addUID('GPshowLayersList')).checked;
            if (collapsed && isCollapsed || !collapsed && !isCollapsed) {
                return;
            }
            if (!isCollapsed) {
                var layers = document.getElementsByClassName('GPlayerInfoOpened');
                for (var i = 0; i < layers.length; i++) {
                    layers[i].className = 'GPlayerInfo';
                }
                document.getElementById(this._addUID('GPlayerInfoPanel')).className = 'GPlayerInfoPanelClosed';
            }
            document.getElementById(this._addUID('GPshowLayersList')).checked = !collapsed;
        };
        LayerSwitcher.prototype.getCollapsed = function () {
            return this.collapsed;
        };
        LayerSwitcher.prototype.setRemovable = function (layer, removable) {
            if (!layer) {
                return;
            }
            var layerID = layer.gpLayerId;
            if (layerID == null) {
                console.log('[LayerSwitcher:setRemovable] layer should be added to map before calling setRemovable method');
                return;
            }
            var removalDiv = document.getElementById(this._addUID('GPremove_ID_' + layerID));
            console.log(removalDiv.style.display);
            if (removalDiv) {
                if (removable === false) {
                    removalDiv.style.display = 'none';
                } else if (removable === true) {
                    removalDiv.style.display = 'block';
                } else {
                    return;
                }
            }
        };
        LayerSwitcher.prototype._initialize = function (options, layers) {
            this._uid = SelectorID.generate();
            this._layers = {};
            this._layersOrder = [];
            this._layersIndex = {};
            this._lastZIndex = 0;
            this._layerId = 0;
            this.collapsed = options.collapsed !== undefined ? options.collapsed : true;
            this._layerListContainer = null;
            this._listeners = {};
            for (var i = 0; i < layers.length; i++) {
                var layer = layers[i].layer;
                if (layer) {
                    var id;
                    if (!layer.hasOwnProperty('gpLayerId')) {
                        id = this._layerId;
                        layer.gpLayerId = id;
                        this._layerId++;
                    } else {
                        id = layer.gpLayerId;
                    }
                    var conf = layers[i].config || {};
                    var opacity = layer.getOpacity();
                    var visibility = layer.getVisible();
                    var layerOptions = {
                        layer: layer,
                        id: id,
                        opacity: opacity != null ? opacity : 1,
                        visibility: visibility != null ? visibility : true,
                        title: conf.title != null ? conf.title : id,
                        description: conf.description || null,
                        legends: conf.legends || [],
                        metadata: conf.metadata || [],
                        quicklookUrl: conf.quicklookUrl || null
                    };
                    this._layers[id] = layerOptions;
                }
            }
        };
        LayerSwitcher.prototype._initContainer = function () {
            var container = this._createMainContainerElement();
            var input = this._createMainLayersShowElement();
            container.appendChild(input);
            if (!this.collapsed) {
                input.checked = 'checked';
                this.collapsed = false;
            } else {
                this.collapsed = true;
            }
            var context = this;
            var changeCollapsed = function (e) {
                this.collapsed = !e.target.checked;
                this.dispatchEvent('change:collapsed');
            };
            input.addEventListener('click', function (e) {
                changeCollapsed.call(context, e);
            });
            var divL = this._layerListContainer = this._createMainLayersElement();
            container.appendChild(divL);
            this._createDraggableElement(divL, this);
            var picto = this._createMainPictoElement();
            container.appendChild(picto);
            var divI = this._createMainInfoElement();
            container.appendChild(divI);
            return container;
        };
        LayerSwitcher.prototype._addMapLayers = function (map) {
            this._layersIndex = {};
            var context = this;
            map.getLayers().forEach(function (layer) {
                var id;
                if (!layer.hasOwnProperty('gpLayerId')) {
                    id = this._layerId;
                    layer.gpLayerId = id;
                    this._layerId++;
                } else {
                    id = layer.gpLayerId;
                }
                var layerInfos = this.getLayerInfo(layer) || {};
                if (!this._layers[id]) {
                    var opacity = layer.getOpacity();
                    var visibility = layer.getVisible();
                    var isInRange = this.isInRange(layer, map);
                    var layerOptions = {
                        layer: layer,
                        id: id,
                        opacity: opacity != null ? opacity : 1,
                        visibility: visibility != null ? visibility : true,
                        inRange: isInRange != null ? isInRange : true,
                        title: layerInfos._title || id,
                        description: layerInfos._description || null,
                        legends: layerInfos._legends || [],
                        metadata: layerInfos._metadata || [],
                        quicklookUrl: layerInfos._quicklookUrl || null
                    };
                    this._layers[id] = layerOptions;
                } else {
                    this._layers[id].opacity = layer.getOpacity();
                    this._layers[id].visibility = layer.getVisible();
                    this._layers[id].inRange = this.isInRange(layer, map);
                }
                layer.on('change:opacity', this._updateLayerOpacity, this);
                layer.on('change:visible', this._updateLayerVisibility, this);
                var layerIndex = null;
                if (layer.getZIndex !== undefined) {
                    layerIndex = layer.getZIndex();
                    if (!this._layersIndex[layerIndex] || !Array.isArray(this._layersIndex[layerIndex])) {
                        this._layersIndex[layerIndex] = [];
                    }
                    this._layersIndex[layerIndex].push(this._layers[id]);
                }
            }, this);
            var updateLayersOrder = function (e) {
                context._updateLayersOrder.call(context, e);
            };
            for (var zindex in this._layersIndex) {
                if (this._layersIndex.hasOwnProperty(zindex)) {
                    var layers = this._layersIndex[zindex];
                    for (var l = 0; l < layers.length; l++) {
                        this._layersOrder.unshift(layers[l]);
                        this._lastZIndex++;
                        layers[l].layer.setZIndex(this._lastZIndex);
                        if (this._layers[layers[l].layer.gpLayerId].onZIndexChangeEvent == null) {
                            this._layers[layers[l].layer.gpLayerId].onZIndexChangeEvent = layers[l].layer.on('change:zIndex', updateLayersOrder);
                        }
                    }
                }
            }
            for (var j = 0; j < this._layersOrder.length; j++) {
                var layerOptions = this._layersOrder[j];
                var layerDiv = this._createLayerDiv(layerOptions);
                this._layerListContainer.appendChild(layerDiv);
                this._layers[layerOptions.id].div = layerDiv;
            }
        };
        LayerSwitcher.prototype._createLayerDiv = function (layerOptions) {
            var isLegends = layerOptions.legends && layerOptions.legends.length !== 0;
            var isMetadata = layerOptions.metadata && layerOptions.metadata.length !== 0;
            var isQuicklookUrl = layerOptions.quicklookUrl;
            if (isLegends || isMetadata || isQuicklookUrl) {
                layerOptions.displayInformationElement = true;
            }
            var layerDiv = this._createContainerLayerElement(layerOptions);
            if (!layerOptions.inRange) {
                layerDiv.classList.add('outOfRange');
            }
            return layerDiv;
        };
        LayerSwitcher.prototype._onChangeLayerOpacity = function (e) {
            var divId = e.target.id;
            var layerID = SelectorID.index(divId);
            var layer = this._layers[layerID].layer;
            var opacityValue = e.target.value;
            var opacityId = document.getElementById(this._addUID('GPopacityValue_ID_' + layerID));
            opacityId.innerHTML = opacityValue + '%';
            layer.setOpacity(opacityValue / 100);
        };
        LayerSwitcher.prototype._updateLayerOpacity = function (e) {
            var opacity = e.target.getOpacity();
            if (opacity > 1) {
                opacity = 1;
            }
            if (opacity < 0) {
                opacity = 0;
            }
            var id = e.target.gpLayerId;
            var layerOpacityInput = document.getElementById(this._addUID('GPopacityValueDiv_ID_' + id));
            layerOpacityInput.value = Math.round(opacity * 100);
            var layerOpacitySpan = document.getElementById(this._addUID('GPopacityValue_ID_' + id));
            layerOpacitySpan.innerHTML = Math.round(opacity * 100) + '%';
        };
        LayerSwitcher.prototype._onVisibilityLayerClick = function (e) {
            var divId = e.target.id;
            var layerID = SelectorID.index(divId);
            var layer = this._layers[layerID].layer;
            layer.setVisible(e.target.checked);
        };
        LayerSwitcher.prototype._updateLayerVisibility = function (e) {
            var visible = e.target.getVisible();
            var id = e.target.gpLayerId;
            var layerVisibilityInput = document.getElementById(this._addUID('GPvisibility_ID_' + id));
            layerVisibilityInput.checked = visible;
        };
        LayerSwitcher.prototype._updateLayersOrder = function () {
            var map = this.getMap();
            if (!map) {
                return;
            }
            this._layersIndex = {};
            var layerIndex;
            var id;
            map.getLayers().forEach(function (layer) {
                id = layer.gpLayerId;
                ol.Observable.unByKey(this._layers[id].onZIndexChangeEvent);
                this._layers[id].onZIndexChangeEvent = null;
                layerIndex = null;
                if (layer.getZIndex !== undefined) {
                    layerIndex = layer.getZIndex();
                    if (!this._layersIndex[layerIndex] || !Array.isArray(this._layersIndex[layerIndex])) {
                        this._layersIndex[layerIndex] = [];
                    }
                    this._layersIndex[layerIndex].push(this._layers[id]);
                }
            }, this);
            this._lastZIndex = 0;
            var context = this;
            var updateLayersOrder = function (e) {
                context._updateLayersOrder.call(context, e);
            };
            this._layersOrder = [];
            for (var zindex in this._layersIndex) {
                if (this._layersIndex.hasOwnProperty(zindex)) {
                    var layers = this._layersIndex[zindex];
                    for (var l = 0; l < layers.length; l++) {
                        this._layersOrder.unshift(layers[l]);
                        this._lastZIndex++;
                        if (this._layers[layers[l].layer.gpLayerId].onZIndexChangeEvent == null) {
                            this._layers[layers[l].layer.gpLayerId].onZIndexChangeEvent = layers[l].layer.on('change:zIndex', updateLayersOrder);
                        }
                    }
                }
            }
            if (this._layerListContainer) {
                while (this._layerListContainer.firstChild) {
                    this._layerListContainer.removeChild(this._layerListContainer.firstChild);
                }
                for (var j = 0; j < this._layersOrder.length; j++) {
                    var layerOptions = this._layersOrder[j];
                    this._layerListContainer.appendChild(layerOptions.div);
                }
            } else {
                console.log('[ol.control.LayerSwitcher] _updateLayersOrder : layer list container not found to update layers order ?!');
            }
        };
        LayerSwitcher.prototype._onOpenLayerInfoClick = function (e) {
            var divId = e.target.id;
            var layerID = SelectorID.index(divId);
            var layerOptions = this._layers[layerID];
            var panel;
            var info;
            divId = document.getElementById(e.target.id);
            if (divId.className === 'GPlayerInfoOpened') {
                if (divId.classList !== undefined) {
                    divId.classList.remove('GPlayerInfoOpened');
                    divId.classList.add('GPlayerInfo');
                }
                panel = document.getElementById(this._addUID('GPlayerInfoPanel'));
                if (panel.classList !== undefined) {
                    panel.classList.remove('GPpanel');
                    panel.classList.remove('GPlayerInfoPanelOpened');
                    panel.classList.add('GPlayerInfoPanelClosed');
                }
                info = document.getElementById(this._addUID('GPlayerInfoContent'));
                panel.removeChild(info);
                return;
            }
            var layers = document.getElementsByClassName('GPlayerInfoOpened');
            for (var i = 0; i < layers.length; i++) {
                layers[i].className = 'GPlayerInfo';
            }
            if (divId.classList !== undefined) {
                divId.classList.remove('GPlayerInfo');
                divId.classList.add('GPlayerInfoOpened');
            }
            panel = document.getElementById(this._addUID('GPlayerInfoPanel'));
            if (panel.classList !== undefined) {
                panel.classList.add('GPpanel');
                panel.classList.remove('GPlayerInfoPanelClosed');
                panel.classList.add('GPlayerInfoPanelOpened');
            }
            info = document.getElementById(this._addUID('GPlayerInfoContent'));
            if (info) {
                panel.removeChild(info);
            }
            var obj = {
                title: layerOptions.title,
                description: layerOptions.description,
                quicklookUrl: layerOptions.quicklookUrl,
                metadata: layerOptions.metadata,
                legends: layerOptions.legends
            };
            var maxResolution = layerOptions.layer.getMaxResolution();
            if (maxResolution === Infinity) {
                obj._maxScaleDenominator = 560000000;
            } else {
                obj._maxScaleDenominator = Math.round(maxResolution / 0.00028);
            }
            var infoLayer = this._createContainerLayerInfoElement(obj);
            panel.appendChild(infoLayer);
        };
        LayerSwitcher.prototype._onDropLayerClick = function (e) {
            var divId = e.target.id;
            var layerID = SelectorID.index(divId);
            var layer = this._layers[layerID].layer;
            this.getMap().getLayers().remove(layer);
        };
        LayerSwitcher.prototype._onDragAndDropLayerClick = function () {
            var map = this.getMap();
            var context = this;
            var updateLayersOrder = function (e) {
                context._updateLayersOrder.call(context, e);
            };
            var matchesLayers = document.querySelectorAll('div.GPlayerSwitcher_layer');
            var maxZIndex = matchesLayers.length;
            this._layersOrder = [];
            for (var i = 0; i < matchesLayers.length; i++) {
                var tag = matchesLayers[i].id;
                var id = SelectorID.index(tag);
                var layer = this._layers[id].layer;
                ol.Observable.unByKey(this._layers[id].onZIndexChangeEvent);
                this._layers[id].onZIndexChangeEvent = null;
                if (layer.setZIndex) {
                    layer.setZIndex(maxZIndex);
                    this._layersOrder.push(this._layers[id]);
                    maxZIndex--;
                }
                if (this._layers[id].onZIndexChangeEvent == null) {
                    this._layers[id].onZIndexChangeEvent = layer.on('change:zIndex', updateLayersOrder);
                }
            }
            map.updateSize();
        };
        LayerSwitcher.prototype._onMapMoveEnd = function (map) {
            map.getLayers().forEach(function (layer) {
                var id = layer.gpLayerId;
                if (this._layers[id]) {
                    var layerOptions = this._layers[id];
                    var layerDiv;
                    if (this.isInRange(layer, map) && !layerOptions.inRange) {
                        layerOptions.inRange = true;
                        layerDiv = document.getElementById(this._addUID('GPlayerSwitcher_ID_' + id));
                        layerDiv.classList.remove('outOfRange');
                    } else if (!this.isInRange(layer, map) && layerOptions.inRange) {
                        layerOptions.inRange = false;
                        layerDiv = document.getElementById(this._addUID('GPlayerSwitcher_ID_' + id));
                        layerDiv.classList.add('outOfRange');
                    }
                }
            }, this);
        };
        LayerSwitcher.prototype.getLayerDOMId = function (olLayer) {
            var foundId = null;
            this.getMap().getLayers().forEach(function (layer) {
                if (layer == olLayer) {
                    foundId = layer.hasOwnProperty('gpLayerId') ? layer.gpLayerId : null;
                }
            }, this);
            return foundId !== null ? this._addUID('GPlayerSwitcher_ID_' + foundId) : null;
        };
        LayerSwitcher.prototype.isInRange = function (layer, map) {
            if (!map) {
                return;
            }
            var mapResolution = map.getView().getResolution();
            if (mapResolution > layer.getMaxResolution() || mapResolution < layer.getMinResolution()) {
                return false;
            }
            var mapExtent = map.getView().calculateExtent(map.getSize());
            var layerExtent = layer.getExtent();
            if (layerExtent && !ol.extent.intersects(mapExtent, layerExtent)) {
                return false;
            }
            return true;
        };
        LayerSwitcher.prototype.getLayerInfo = function (layer) {
            var layerInfo = {};
            if (layer.getSource !== undefined) {
                var src = layer.getSource();
                layerInfo._title = src._title || '';
                layerInfo._description = src._description || '';
                layerInfo._quicklookUrl = src._quicklookUrl || '';
                layerInfo._metadata = src._metadata || [];
                layerInfo._legends = src._legends || [];
            }
            return layerInfo;
        };
        return LayerSwitcher;
    }(ol, CommonUtils, CommonUtilsSelectorID, CommonControlsLayerSwitcherDOM);
    CommonControlsGetFeatureInfoDOM = function () {
        var GetFeatureInfoDOM = {
            _addUID: function (id) {
                var uid = this._uid ? id + '-' + this._uid : id;
                return uid;
            },
            _createMainContainerElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GPgetFeatureInfo');
                container.className = 'GPwidget';
                return container;
            },
            _createActivateGetFeatureInfoElement: function (activate) {
                var context = this;
                var input = document.createElement('input');
                input.id = this._addUID('GPactivateGetFeatureInfo');
                input.type = 'checkbox';
                input.checked = activate;
                input.addEventListener('change', function (e) {
                    context.onActivateGetFeatureInfoElementChange(e);
                });
                return input;
            },
            _createMainPictoElement: function () {
                var self = this;
                var label = document.createElement('label');
                label.id = this._addUID('GPgetFeatureInfoPicto');
                label.className = 'GPshowAdvancedToolPicto';
                label.htmlFor = this._addUID('GPactivateGetFeatureInfo');
                label.title = 'activer/desactiver l\'interrogation des couches';
                var spanOpen = document.createElement('span');
                spanOpen.id = this._addUID('GPgetFeatureInfoActivate');
                spanOpen.className = 'GPshowAdvancedToolOpen';
                label.appendChild(spanOpen);
                var spanClose = document.createElement('span');
                spanClose.id = self._addUID('GPgetFeatureInfoDeactivate');
                label.appendChild(spanClose);
                return label;
            }
        };
        return GetFeatureInfoDOM;
    }();
    Ol3ControlsGetFeatureInfo = function (ol, proj4, Gp, Utils, GfiUtils, SelectorID, GetFeatureInfoDOM) {
        function GetFeatureInfo(gfiOptions) {
            gfiOptions = gfiOptions || {};
            var options = gfiOptions.options || {};
            var layers = gfiOptions.layers || [];
            if (!(this instanceof GetFeatureInfo)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            if (layers && !Array.isArray(layers)) {
                throw new Error('ERROR WRONG_TYPE : layers should be an array');
            }
            if (options && typeof options !== 'object') {
                throw new Error('ERROR WRONG_TYPE : options should be an object');
            }
            this._initialize(options, layers);
            var container = this._initContainer(options);
            ol.control.Control.call(this, {
                element: container,
                target: options.target,
                render: options.render
            });
        }
        ol.inherits(GetFeatureInfo, ol.control.Control);
        GetFeatureInfo.prototype = Object.create(ol.control.Control.prototype, {});
        Utils.assign(GetFeatureInfo.prototype, GetFeatureInfoDOM);
        GetFeatureInfo.prototype.constructor = GetFeatureInfo;
        GetFeatureInfo.prototype._initialize = function (options, layers) {
            this._uid = SelectorID.generate();
            this._events = {
                dblclick: false,
                singleclick: false,
                contextmenu: false
            };
            this._eventsHandler = {};
            if (typeof options.auto !== 'undefined' && typeof options.auto !== 'boolean') {
                console.log('[ERROR] GetFeatureInfo:_initialize - auto parameter should be a boolean');
                return;
            }
            this._auto = options.auto || false;
            if (typeof options.active !== 'undefined' && typeof options.active !== 'boolean') {
                console.log('[ERROR] GetFeatureInfo:_initialize - active parameter should be a boolean');
                return;
            }
            this._active = typeof options.active === 'undefined' ? true : options.active;
            if (options.defaultEvent && typeof options.defaultEvent !== 'string') {
                console.log('[ERROR] GetFeatureInfo:_initialize - defaultEvent parameter should be a string');
                return;
            }
            this._defaultEvent = options.defaultEvent || 'singleclick';
            if (!this._isValidEvent(this._defaultEvent)) {
                console.log('[ERROR] GetFeatureInfo:_initialize - _defaultEvent \'' + this._defaultEvent + '\' is not a valid event');
                return;
            }
            if (options.defaultInfoFormat && typeof options.defaultInfoFormat !== 'string') {
                console.log('[ERROR] GetFeatureInfo:_initialize - defaultInfoFormat parameter should be a string');
                return;
            }
            this._defaultInfoFormat = options.defaultInfoFormat || 'text/html';
            if (options.cursorStyle && typeof options.cursorStyle !== 'string') {
                console.log('[ERROR] GetFeatureInfo:_initialize - cursorStyle parameter should be a string');
                return;
            }
            this._cursorStyle = options.cursorStyle || 'pointer';
            if (options.proxyUrl) {
                if (typeof options.proxyUrl !== 'string') {
                    console.log('[ERROR] GetFeatureInfo:_initialize - proxyUrl parameter should be a string');
                    return;
                }
                this._proxyUrl = options.proxyUrl;
            }
            if (options.noProxyDomains) {
                if (!Array.isArray(options.noProxyDomains)) {
                    console.log('[ERROR] GetFeatureInfo:_initialize - noProxyDomains parameter should be a array');
                    return;
                }
                this._noProxyDomains = options.noProxyDomains;
            }
            if (typeof options.autoPan !== 'undefined' && typeof options.autoPan !== 'boolean') {
                console.log('[ERROR] GetFeatureInfo:_initialize - autoPan parameter should be a boolean');
                return;
            }
            this._autoPan = typeof options.autoPan === 'undefined' ? true : options.autoPan;
            if (options.autoPanAnimation) {
                if (options.autoPanAnimation.duration) {
                    if (typeof options.autoPanAnimation.duration !== 'number') {
                        console.log('[ERROR] GetFeatureInfo:_initialize - autoPanAnimation parameter is invalid : duration should be a number.');
                        return;
                    }
                }
                if (options.autoPanAnimation.easing) {
                    if (typeof options.autoPanAnimation.easing !== 'function') {
                        console.log('[ERROR] GetFeatureInfo:_initialize - autoPanAnimation parameter is invalid : easing should be a ol.easing function or a custom function.');
                        return;
                    }
                }
                this._autoPanAnimation = options.autoPanAnimation;
            }
            if (options.autoPanMargin) {
                if (typeof options.autoPanMargin !== 'number') {
                    console.log('[ERROR] GetFeatureInfo:_initialize - autoPanMargin parameter should be a number');
                    return;
                }
                this._autoPanMargin = options.autoPanMargin;
            }
            if (!Array.isArray(layers)) {
                console.log('[ERROR] GetFeatureInfo:_initialize - layers parameter should be an array');
                return;
            }
            this._setLayers(layers);
            this._activateGetFeatureInfoContainer = null;
        };
        GetFeatureInfo.prototype.setMap = function (map) {
            ol.control.Control.prototype.setMap.call(this, map);
            this._updateEvents();
            if (map == null) {
                return;
            }
            if (this._cursorStyle && this._active) {
                this._activateCursor(true);
            }
            map.getLayers().on('remove', function (evt) {
                for (var i = 0; i < this._layers.length; ++i) {
                    if (this._layers[i].obj === evt.element) {
                        this._layers.splice(i, 1);
                        break;
                    }
                }
                this._updateEvents();
            }, this);
            if (this._auto) {
                var updated = false;
                map.getLayers().forEach(function (olLayer) {
                    var layerFormat = GfiUtils.getLayerFormat(olLayer);
                    if (!this._hasLayer(olLayer) && layerFormat == 'vector') {
                        this._layers.push({ obj: olLayer });
                        updated = true;
                    }
                }, this);
                if (updated) {
                    this._updateEvents();
                }
                map.getLayers().on('add', function (evt) {
                    var layerFormat = GfiUtils.getLayerFormat(evt.element);
                    if (layerFormat == 'vector') {
                        this._layers.push({ obj: evt.element });
                    }
                    this._updateEvents();
                }, this);
            }
        };
        GetFeatureInfo.prototype.getLayers = function () {
            return this._layers;
        };
        GetFeatureInfo.prototype.setDefaultEvent = function (eventName) {
            if (typeof eventName !== 'string') {
                console.log('[ERROR] GetFeatureInfo:setDefaultEvent - eventName parameter should be a string');
                return;
            }
            if (!eventName || !this._isValidEvent(eventName)) {
                console.log('[ERROR] GetFeatureInfo:setDefaultEvent - event \'' + eventName + '\' is not allowed.');
                return;
            }
            this._defaultEvent = eventName;
            this._updateEvents();
        };
        GetFeatureInfo.prototype.setCursorStyle = function (cursorStyle) {
            if (typeof cursorStyle !== 'string') {
                console.log('[ERROR] GetFeatureInfo:setCursorStyle - cursorStyle parameter should be a string');
                return;
            }
            if (this._active) {
                if (!this._cursorStyle && cursorStyle) {
                    this._activateCursor(true);
                } else if (this._cursorStyle && !cursorStyle) {
                    this._activateCursor(false);
                }
            }
            this._cursorStyle = cursorStyle;
        };
        GetFeatureInfo.prototype.setActive = function (active) {
            this._setActive(active);
            var element = document.getElementById(this._addUID('GPactivateGetFeatureInfo'));
            if (element) {
                element.checked = active;
            }
        };
        GetFeatureInfo.prototype._setActive = function (active) {
            if (typeof active !== 'boolean') {
                console.log('[ERROR] GetFeatureInfo:_setActive - active parameter should be a boolean');
                return;
            }
            if (this._active === active) {
                return;
            }
            this._active = active;
            if (this._cursorStyle) {
                this._activateCursor(active);
            }
        };
        GetFeatureInfo.prototype.isActive = function () {
            return this._active;
        };
        GetFeatureInfo.prototype.setHidden = function (hidden) {
            this.element.style.visibility = hidden ? 'hidden' : '';
        };
        GetFeatureInfo.prototype.isHidden = function () {
            return this.element.style.visibility == 'hidden';
        };
        GetFeatureInfo.prototype.setLayers = function (gfiLayers) {
            this._setLayers(gfiLayers);
            this._updateEvents();
        };
        GetFeatureInfo.prototype._isValidEvent = function (eventName) {
            return Object.keys(this._events).indexOf(eventName) > -1;
        };
        GetFeatureInfo.prototype._activateEvent = function (eventName) {
            var map = this.getMap();
            var gfiObj = this;
            var getFeatureInfoHandler = function (e) {
                GfiUtils.onDisplayFeatureInfo(e, gfiObj);
            };
            if (eventName == 'contextmenu') {
                map.getViewport().addEventListener(eventName, getFeatureInfoHandler);
            } else {
                map.on(eventName, getFeatureInfoHandler);
            }
            this._eventsHandler[eventName] = getFeatureInfoHandler;
            this._events[eventName] = true;
        };
        GetFeatureInfo.prototype._deactivateEvent = function (eventName) {
            var map = this.getMap();
            if (eventName == 'contextmenu') {
                map.getViewport().removeEventListener(eventName, this._eventsHandler[eventName]);
            } else {
                map.un(eventName, this._eventsHandler[eventName]);
            }
            delete this._eventsHandler[eventName];
            this._events[eventName] = false;
        };
        GetFeatureInfo.prototype._updateEvents = function () {
            var sEvent = [];
            for (var i = 0; i < this._layers.length; ++i) {
                var event = this._layers[i].event ? this._layers[i].event : this._defaultEvent;
                if (sEvent.indexOf(event) < 0) {
                    sEvent.push(event);
                }
            }
            for (var eventName in this._events) {
                if (!this._events[eventName] && sEvent.indexOf(eventName) >= 0) {
                    this._activateEvent(eventName);
                } else if (this._events[eventName] && sEvent.indexOf(eventName) < 0) {
                    this._deactivateEvent(eventName);
                }
            }
        };
        GetFeatureInfo.prototype._hasLayer = function (olLayer) {
            for (var i = 0; i < this._layers.length; ++i) {
                if (this._layers[i].obj === olLayer) {
                    return true;
                }
            }
            return false;
        };
        GetFeatureInfo.prototype._activateCursor = function (activate) {
            var map = this.getMap();
            if (activate) {
                if (this._eventsHandler.hasOwnProperty('pointermove')) {
                    console.log('[ERROR] _activateCursor - inconsistent state: pointermove event handler already registered');
                    return;
                }
                var gfiObj = this;
                var displayCursor = function (evt) {
                    var hit = map.forEachFeatureAtPixel(evt.pixel, function (feature, layer) {
                        var gfiLayers = gfiObj.getLayers();
                        for (var m = 0; m < gfiLayers.length; ++m) {
                            if (gfiLayers[m].obj === layer) {
                                return true;
                            }
                        }
                    });
                    if (hit) {
                        map.getTargetElement().style.cursor = gfiObj._cursorStyle;
                    } else {
                        map.getTargetElement().style.cursor = '';
                    }
                };
                this._eventsHandler['pointermove'] = displayCursor;
                map.on('pointermove', displayCursor);
            } else {
                map.un('pointermove', this._eventsHandler['pointermove']);
                delete this._eventsHandler['pointermove'];
                map.getTargetElement().style.cursor = '';
            }
        };
        GetFeatureInfo.prototype._setLayers = function (gfiLayers) {
            if (!gfiLayers || !Array.isArray(gfiLayers)) {
                console.log('[ERROR] GetFeatureInfo:setLayers - gfiLayers parameter should be a array');
                return;
            }
            this._layers = [];
            for (var i = 0; i < gfiLayers.length; ++i) {
                var ind = this._layers.push({}) - 1;
                if (gfiLayers[i].event) {
                    if (!this._isValidEvent(gfiLayers[i].event)) {
                        console.log('[ERROR] GetFeatureInfo:setLayers - layer event \'' + this._layers[i].event + '\' is not allowed.');
                    } else {
                        this._layers[ind].event = gfiLayers[i].event;
                    }
                }
                if (gfiLayers[i].infoFormat) {
                    this._layers[ind].infoFormat = gfiLayers[i].infoFormat;
                }
                this._layers[ind].obj = gfiLayers[i].obj;
            }
        };
        GetFeatureInfo.prototype.onActivateGetFeatureInfoElementChange = function (e) {
            this._setActive(e.target.checked);
        };
        GetFeatureInfo.prototype._initContainer = function (options) {
            var container = this._createMainContainerElement();
            var inputActivate = this._activateGetFeatureInfoContainer = this._createActivateGetFeatureInfoElement(this.isActive());
            container.appendChild(inputActivate);
            var picto = this._createMainPictoElement();
            container.appendChild(picto);
            if (typeof options.hidden !== 'undefined') {
                if (typeof options.hidden !== 'boolean') {
                    console.log('[ERROR] GetFeatureInfo:_initContainer - hidden parameter should be a boolean');
                    return;
                }
                if (options.hidden) {
                    container.style.visibility = 'hidden';
                }
            }
            return container;
        };
        return GetFeatureInfo;
    }(ol, proj4, gp, CommonUtils, Ol3GfiUtils, CommonUtilsSelectorID, CommonControlsGetFeatureInfoDOM);
    Ol3ControlsUtilsMarkers = function () {
        var Marker = {
            lightOrange: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAARDSURBVFiF3ZndaxxVGMZ/Z/YjX00Nadpo1qrFBgu56D9QbAtiLoRC7ywSNK1NURRREBKRFlSwFBW0gnSrJXY1CmISgyjFiyYSFC9ajE3MmpjdjWlMUtNos9lN9mteLzbRuCbZmTMTBB+Yi51znvd5n3nPnjnnjBIR/i/wuh4xpCpI0ojiENAA1AE1wCzwKzCE0EM5l2iShJvSyrXKnFVb8dOK4hmg3AIjifAmaU7ztMy7kYI7Zs6rQwjvka+AXcyiOMZx6XGahuE0AEHVitCFnhGAGoQugqrVaSrOKpNP4FWnSaxCGy1yWpesbyY/tLpwo7p/w0RxWHfI6Zk5q7ZSwhj6Q2sjzJLiXp1JQe+p+mllc4wA1CzHtw37lQmpCha5gbXpVxdJythh9z1kvzJJGrFixPBmOXixl+Z4mONmguZ4mIMXezG8WQsq5cs6tmDfTP7NXiSqN0vTzBD1TQfwbdmDUhX4tuyhvukATTNDlgxZ0SmUtUsgv0TZGPsv9FNSvXfNtpLqvey/0O+KTgF0zNQV7XHP4dsdtVvVKYCOmeqiPbwVOx21W9UpgI6ZWNEe2cSEo3arOgWwb0YYLp5G17Sjdqs6BdCZzYqL9B3dR2puYM221NwAfUf3uaJTAB0zaye5GmbWS6i2gdFQL5mFMCIJMgthRkO9hGobMLPFN4VWdAoptlcAQeUDRoG77YrZwDhQT4tk7JDsV6ZFMggv2+bZwyt2jYDuQnOa94GIFrc4IkzRrkPUM3NKsijatLjF0copsbJ++xec7TTPqw6EI/oB/glT+PC+13Y/aSQNv/Is+tNer09lMn7DMHwAYppp8fvTIpISkVQsFrslqww4M9OuqkgzANzl1MhCyrjZGAycm573pK1yFCyi5FoWvo/FYlPOT2fOqftRXMbB9lkEs+3zbe2f/FD5i3YMj2p3vn8/IV8DZ5yE+Gqkot+JEQCPada5dRhxEriiQ5ya90w+272916F+KpnJDLhjpkUy5HgESNqhZU2Vfr5ne+dSFtOBeso06J6cnEy6d0z0hPwEPGeH8sGVykvfjpfe1NZUci2+mHg7Go2G8z/d/goQVJ9B8S1veMYffujduo/thl+ZwUzDuBqJRGZWt7n/FcDH46lFNVLilar1uiTTxsJTnTssH/QpJVlMNQa5wbGJiWERya3Vz30zzfLb3OveY3dU5j5dp4e80Xdbd3TOu/H/yyAtpjnqgeGS8crRQRks+v5xf5gtY/KM/6NAVebhwvv90bLvHu2o/XId2pJSMmIaxo/RaHRMxN6yZtPM0K5K/7hl/FxVZgZWbs0mPDceeKcuGE95/kpSKUmaImHDNIfHrl+PiIj2zOb+MFvBY7IUOVl2ZG9g6bJH4ckJuRe/2NYZT3myKIkrGM4pNRyLjY+LW09URDb1+uaF0pfm3zJ+7zhRGdq1c9eDuwOBOzdLa/OG2X+APwE8DU64Y/5gfAAAAABJRU5ErkJggg==',
            darkOrange: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAQ+SURBVFiF3ZlLaFxlGIaf/5zJpJNpaoxpYieoCxULEYK7Lqp0IWQhFLooKNKEtNIULxWlQoJgQQWLFMEg0lQMuXgD0dRSkNJFgoy0IrYNSTpj08xMmoxNYhLUyUwyt/O5mFbjmGTOLS58d3O+y/u95/vnvx0lIvxf4HE9Y7PyU0ETwl6gAQgANcA88AswhuIsKc7TJ0k3qZVrnTmqtpGhHeFloMJERArF+3g5Qaf84UYJ7og5rPai+JhCB6xiHuEQp+Ws0zI0pwloU+0oBrAnBKAGxQBtqt1pKc46UyjgHadFrEIHXXLCbrB9MYWhNYAb3f0bBsI+u0POnpijahtpJrA/tDbCPOU8aGdSsPdWM7SzOUIAam7ntwzrnWlWfnzMYW76tYsUy9RaXYesd6aCJswI0Tw5WvuG6EyEOWUk6UyEae0bQvPkTLEUeCzBupjCyl4iqyfHydkxdh3YQ/nWnSjlp3zrTnYd2MPJ2TFTgszwFNNaDaCwRdkYLd1B/NWNa9r81Y20dAdd4SmCHTGBkh6P7bvXkd0sTxHsiKku6eH13+fIbpanCHbExEp6ZJJTjuxmeYpgXYwiVNLnysCMI7tZniLYmc1Kk/Qe3E1ycXhNW3JxmN6Du13hKYIdMWsXuRpGzsOxugYu9Q+RXgojkiS9FOZS/xDH6howcqUPhWZ4imB9B9CmyoBx4AGrZBYwCTxMl2StBFnvTJdkUbxlOc4a3rYqBOxuNHfQC0RsxZZGhAA9dgLtiTkuOYQOW7Gl0c5xMbN/+xecnTQPq89QPGM/wT9hCJ8+MvjQ81pK8yp92ZvxeMpUNuvVNK0MQAwjI15vRkTSIpKOxWK/yyoBzsS0qiq8DAP3OxWylNMWmoL1XTMresZsjIJllIzk4GosFrvl/HbmiHoCYRAHx2cBo2Pknp4v45U3befQVY/z8/sp+Q5410mKC7P+oBMhALphBNy6jHgDxU92Am+t6PFXhrcPOeRPp7LZYXfEdEkWjWeBlJWwnKEyr41s/3rFwHDAnjY0zsTj8ZR710Qfys/Aq1ZCPrlZef7iwpYF25xKRhLLyQ+i0Wi48NPtrwBt6hsofeQNJ7zhp74PfGE1/Z0ZzNC0y5FIZHa1zf2vAFmeS2vqerkuVeu5pPLa0otXa01f9CklOQw1AfnRiampkIjk1/JzX0y3/LrY7Dm0w5f/ah0Pee/GXWeiSc/G/y+NjBjGuA6h8snK8VEZLbn+uD/MbiPe7P283pd9uvh5cMH3Q8uPdd+uE7ailFw3NO1aNBqdELG2rdk0MbSqLb8p7UZVmVF/59F8Wp97Mhg4ncjqfxWplKQMkbBmGKGJ6emIiNie2TZPDHB5v+/xxrtXBnWFnhfyL1yp/ejCXMUMShIKQnmlQrFYbFJcKmJTxQBc3O9789FtmZfOzfjPvT5S068bmWvj09PTm8G16WL+S/wJLybNu1V6htkAAAAASUVORK5CYII=',
            red: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAQxSURBVFiF3ZldaBxVFMd/d2ayTRtjQpo2mlilWBEMshoj+FAERZIHIdA3iw+V1icRREFIQAKNgsUHQfBFwZI2WgWxqYUiVTDBBj9ILC5Nu2tjdjemsR+mSZNNNvsxO8eHTTRuk+zMnQmCf9iHnXvO+Z//nDvn3rmjRIT/C6zAI4ZVFRbtKDpQNCM0AvXANIo/EC4inMbmLBFZDJJaBVaZJ9Sd2HQCrwDbXHikgfewOMKPMh9ECsGIeVx1IHxEsQJeMY3iEMNy2m8aht8AtKpOhH70hADUI/TTqjr9puKvMsUE3vabxCp0MSJHdJ31xRSnVj9BVPcfOCj26U45PTHFh30c/am1EaaxuF+nKejd1WLX2gwhAPXL8T3De2XCqooKbuCu/eoiTZ6dXtch75WxaMeNENOyOXx8kHOpGMPOIudSMQ4fH8S0bBcs25Z5PMF7ZVpVL3BgQxvTsvn6+kVq6sK3jc3NRGhraKZgl9t9HGNEXvCSmvfKKJrL2nQfHVpTCEBNXZjuo0OB8JTAu5jiXmtjPL3vLl/jbnlKoNPN6spaVFbt8jXulqcEOmKSZS0yi5O+xt3ylEBHTLSsxbf913yNu+UpgU4DKE/Sc3AvczORNcfmZiL0HNwbCE8JvItxWDvJ1SjYFm0NzZzpG2RpIYbIIksLMc70Dbpsy+54SqCzzlQAY8B9Xsk8YAJ4gBHJe3HyXpkRyaN407OfN7zlVQjobjTv4BgQ1/ItjzjV9Oo46okZEBuhS8u3PDoZEDf7t9vg903zBLBfP8C/4cAnD87teclIGyFlLoVyllWh8vmQYRgVAOI4OQmFciKSFZFsMpmck1UC/Il5VNViEgHu9StkQYyb7bNNH1wrmDm3PgqWUHLBhl+SyeRV/6czLepJDAbw8fos4HTNb+/9PFv9u3YMU/X6f38/L98B7/gJ8U2uasiPEADTcRqDOozoBn7WcbzqmFOvpnYM+uTPpvP5SDBiimvP8xRPKV3DFpV7fX7HyYyD44M96xicmpqaSgd3TDQsv6J4zYvLx5nqsz/kK29qcyq5kFpafD+RSMSKf4P+CvCY+hJFRzmzmB2KPTvb+JnX8CsdzDGM8/F4/PrqseC/AggvZlGXtyipXc8kLcbCy6mdrg/6lBIbR41DYXR8cjIqIoW17IIXc17+nHnEOnS3VfhiHQt5d7HmVMK2Nn6+DHLiOGMmRLdMVI+NymjZ9Sf4abaMqZbQp01G/rnS60P5rT8duNXw1TpuGaXksmMYlxKJxLiIt23NponhKVV5a874rdZwmlYuTTvmjWdmGj9Mifl3kkpJ2hGJGY4THb9yJS4i2p0t+Gm2ggHJxMNb94eNzIAJZgEKbyxsP5kS00ZJSkG0oFQ0mZyYkKDuqIhs6u/7hyt75luM2RMPVfft3rW7bU9T0z2bxbV50+w/wF8f81R5OpwBhwAAAABJRU5ErkJggg==',
            turquoiseBlue: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAASxSURBVFiF3ZhdbBRVGIafc2Z2210hbeWnpcQVUC8kwBUJXJBIgwkgBEPEC1GMxhgE4gUJJsYERMWI3orYaiqgrYSWH/mvMaQLciE1RAKUkrLbbhMobQ20/LT7N3OOF0CC0O7szGwv9L3c73u/93vnnD3zzYH/EUTBKx6sHUvQWgR6GTAdmASMA26A6AYuofUhQnYTVevuFlK6cGaObC9DGh8i9PtAKA/GEIKvSRZtZfnbA4VooTBmjlWvQFADPOmBfRN4l8Xv7ffbhvTF1lpwrHoTgga8GeE+by9NNRvR2tfDNfyQmVv5MYJP8L/CAqgidtai/sgpP0W84d7WavBV43Eo0CtYvOaAF7K3Rg7sKKU4Hcf71sqFfmz1DEvX9rslevvPFKc/YnSMAJRhyA+8EN2vzMHasQSzveR3/HrFEMV2udv3kOlaJmgtIg8jYcMcqpu1oGXJhMi0oJQVGaV6Dvd1day62DwnaWWd+GHSciGwz01rHraZXuaUETbMoe6qVR3Ly6fMD0oZAYJBKSOvVEyd3z3/jVjIDCSddYSjzqPwYEY875RRN2tBS4kZnDFcrNQMztw144UzjjKa6W4787IylU4ZSyZEpuWKv1w+dWohdB6Fl9NsnFNCUMqKnHGRO34PYnz+Ld2DFzN3nBIySvXkjGt1PQ+d23l3dB9ezPQ6JRzu6+rIFT/Q25lwVNHkfCDDwYuZFqeEVReb5wxYmQvDxfqz6QtvnW+e69yZcNR5jOKWgKbZKSVpZUOV0bpnG3vi0YxWXUAmo1XXnp54tLL5p+dSyi52FlJRt625nwCavxlDyrgKlLjm5o9byPBkFr456IbkfmWq1t1FsMM1zx1q3RoBr4OmpT4F+jxxndGHrbZ4IXozs3RtP0Ks98R1ghDrvYz/4PfD6ti39Qix0leNh6H07siaL9ZJKYuKtA6lhSgKaC0sWwYATENlLSmVECIZTKcHZ167NtAI9gO6PzO/1ZRg6XPAFF91AJnKDES21NaYN26l8uVoLWyhSZhS/345kUj4/+Q9XjMPdBR/9wl6Qn3TjyWnzyW88i3Y5e92BmDx6tPAV35KjDnXftqHEQBhKDXZvxmA4p5NCJzH+mFg3rxzvXzn0ZN+5BUoW8p4YcxUbbZQ4nXyGEIfhrDt7MS6o/tEOm07Z48ArTPCMPYnEomewpgBeGl1HMQGN5SSk381hdsSNzwqag1tRbZdHY/HL8JoXJwfr24AXnVKK7rae/mpz3fs8aCQ1FqfxzTPxuPxf7243V9oOMESa4XOvqgDZtlIKTKVHpz4w6Ej+ZbUWlgIHdNStkYikbZoNGoNl1f4lQGM3V8us0tLfhmhvh6/98Tu0hN/XslVQ2uRlahOIWWrMozLsVgs7aQ7KmYAAnVb67PjSh+bDsKtHX9Ubmv4dQRaEiE6JLQHwuG21tbWjBvNwm+z+8hmU+/Iu8l5akwo8uA34/bg3+W1B088nKdhCK2vmFJemjV7dqyxsdHzyTZqKwMQ2r55bmpK+SktRABb2ZO+2//9E+djvcAthIgZ0P5aZ+eVzaAKoTeqZgCKt238LP10xYaxZy7tq/j5+E5Ms629vb0b0KOt/Z/GP4jqqfL5oxVsAAAAAElFTkSuQmCC',
            defaultOffset: [
                -25.5,
                -38
            ]
        };
        return Marker;
    }();
    CommonUtilsCheckRightManagement = function (woodman, Config) {
        return {
            check: function (options) {
                if (!options) {
                    return;
                }
                var _key = options.key;
                var _resources = options.resources || [];
                var _services = options.services || [];
                if (!_resources || _resources.length === 0) {
                    return;
                }
                if (!_services || _services.length === 0) {
                    return;
                }
                var _rightManagement = {};
                if (!_key) {
                    if (!Config.isConfigLoaded()) {
                        console.log('WARNING : ' + 'The \'apiKey\' parameter is missing, ' + 'and the contract key configuration has not been loaded, ' + 'so impossible to check yours rights !');
                        return;
                    } else {
                        _key = Object.keys(Config.configuration.generalOptions.apiKeys)[0];
                    }
                }
                if (_key) {
                    if (!Config.isConfigLoaded()) {
                        console.log('WARNING : ' + 'the contract key configuration has not been loaded, ' + 'so be carefull !');
                        var _noRightManagement = {};
                        for (var i = 0; i < _services.length; i++) {
                            var service = _services[i];
                            _noRightManagement[service] = [];
                            for (var j = 0; j < _resources.length; j++) {
                                var resource = _resources[j];
                                _noRightManagement[service].push(resource);
                            }
                        }
                        _noRightManagement.key = _key;
                        return _noRightManagement;
                    } else {
                        for (var k = 0; k < _resources.length; k++) {
                            var _resource = _resources[k];
                            for (var l = 0; l < _services.length; l++) {
                                var _service = _services[l];
                                var params = Config.getServiceParams(_resource, _service, _key);
                                if (!params || Object.keys(params).length === 0) {
                                    console.log('WARNING : ' + 'The contract key configuration has no rights to load this geoportal ' + 'resource (' + _resource + ') ' + 'for this service (' + _service + ') ');
                                    continue;
                                }
                                if (!_rightManagement[_service]) {
                                    _rightManagement[_service] = [];
                                }
                                _rightManagement[_service].push(_resource);
                            }
                        }
                        if (!_rightManagement || Object.keys(_rightManagement).length === 0) {
                            console.log('WARNING : ' + 'The contract key configuration has been loaded, ' + 'and the \'apiKey\' parameter has been set, ' + 'but, there is a problem on the mapping between the contract and the key !');
                            return;
                        }
                        _rightManagement.key = _key;
                        return _rightManagement;
                    }
                }
            }
        };
    }({}, CommonUtilsConfig);
    CommonControlsSearchEngineDOM = function (ID) {
        var SearchEngineDOM = {
            _addUID: function (id) {
                var uid = this._uid ? id + '-' + this._uid : id;
                return uid;
            },
            _createMainContainerElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GPsearchEngine');
                container.className = 'GPwidget';
                return container;
            },
            _createShowSearchEngineElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPshowSearchEngine');
                input.type = 'checkbox';
                return input;
            },
            _createShowSearchEnginePictoElement: function () {
                var self = this;
                var label = document.createElement('label');
                label.id = this._addUID('GPshowSearchEnginePicto');
                label.className = 'GPshowAdvancedToolPicto';
                label.htmlFor = this._addUID('GPshowSearchEngine');
                label.title = 'Afficher/masquer la recherche par lieux';
                label.addEventListener('click', function () {
                    document.getElementById(self._addUID('GPautoCompleteList')).style.display = 'none';
                    document.getElementById(self._addUID('GPgeocodeResultsList')).style.display = 'none';
                    var showAdvancedSearch = document.getElementById(self._addUID('GPshowAdvancedSearch'));
                    if (showAdvancedSearch) {
                        showAdvancedSearch.style.display = null;
                        document.getElementById(self._addUID('GPadvancedSearchPanel')).style.display = 'none';
                    }
                    var id = '#GPsearchInput-' + self._uid;
                    document.querySelector(id + ' input').disabled = false;
                    self.onShowSearchEngineClick();
                });
                var spanOpen = document.createElement('span');
                spanOpen.id = this._addUID('GPshowSearchEngineOpen');
                spanOpen.className = 'GPshowAdvancedToolOpen';
                label.appendChild(spanOpen);
                return label;
            },
            _createSearchInputElement: function () {
                var self = this;
                var form = document.createElement('form');
                form.id = this._addUID('GPsearchInput');
                form.addEventListener('submit', function (e) {
                    e.preventDefault();
                    document.getElementById(self._addUID('GPgeocodeResultsList')).style.display = 'block';
                    document.getElementById(self._addUID('GPautoCompleteList')).style.display = 'none';
                    self.onGeocodingSearchSubmit(e);
                    return false;
                });
                var input = document.createElement('input');
                input.id = this._addUID('GPsearchInputText');
                input.type = 'text';
                input.placeholder = 'Rechercher un lieu, une adresse';
                input.autocomplete = 'off';
                input.addEventListener('keyup', function (e) {
                    var charCode = e.which || e.keyCode;
                    if (charCode === 13 || charCode === 10 || charCode === 38 || charCode === 40) {
                        return;
                    }
                    document.getElementById(self._addUID('GPgeocodeResultsList')).style.display = 'none';
                    if (input.value.length > 2) {
                        document.getElementById(self._addUID('GPautoCompleteList')).style.display = 'block';
                    } else {
                        document.getElementById(self._addUID('GPautoCompleteList')).style.display = 'none';
                    }
                    self.onAutoCompleteSearchText(e);
                });
                input.addEventListener('keydown', function (e) {
                    if (true) {
                        return;
                    }
                    var charCode = e.which || e.keyCode;
                    var container = document.getElementById(self._addUID('GPautocompleteResults'));
                    if (!container) {
                        return;
                    }
                    var curr = container.getElementsByClassName('GPautoCompleteProposal current');
                    var list = container.getElementsByClassName('GPautoCompleteProposal');
                    var length = list.length;
                    if (!length) {
                        return;
                    }
                    var current = null;
                    if (!curr.length) {
                        current = list[0];
                        current.className = 'GPautoCompleteProposal current';
                        current.style.color = '#000000';
                        current.style['background-color'] = '#CEDBEF';
                        return;
                    } else {
                        current = curr[0];
                    }
                    var index = parseInt(ID.index(current.id), 10);
                    var next = index === length - 1 ? list[0] : list[index + 1];
                    var prev = index === 0 ? list[length - 1] : list[index - 1];
                    current.style['background-color'] = '';
                    current.style.color = '';
                    prev.style['background-color'] = '';
                    prev.style.color = '';
                    next.style['background-color'] = '';
                    next.style.color = '';
                    switch (charCode) {
                    case 38:
                        current.className = 'GPautoCompleteProposal';
                        prev.className = 'GPautoCompleteProposal current';
                        prev.style.color = '#000000';
                        prev.style['background-color'] = '#CEDBEF';
                        break;
                    case 40:
                        current.className = 'GPautoCompleteProposal';
                        next.className = 'GPautoCompleteProposal current';
                        next.style.color = '#000000';
                        next.style['background-color'] = '#CEDBEF';
                        break;
                    case 13:
                        current.click(e);
                        break;
                    }
                    current.focus();
                });
                form.appendChild(input);
                var div = document.createElement('div');
                div.id = this._addUID('GPsearchInputReset');
                div.addEventListener('click', function () {
                    document.getElementById(self._addUID('GPsearchInputText')).value = '';
                    document.getElementById(self._addUID('GPautoCompleteList')).style.display = 'none';
                    document.getElementById(self._addUID('GPgeocodeResultsList')).style.display = 'none';
                    self.onSearchResetClick();
                });
                form.appendChild(div);
                return form;
            },
            _createShowAdvancedSearchElement: function () {
                var self = this;
                var div = document.createElement('div');
                div.id = this._addUID('GPshowAdvancedSearch');
                div.className = 'GPshowAdvancedToolPicto';
                div.title = 'Ouvrir la recherche avancée';
                div.addEventListener('click', function () {
                    var id = '#GPsearchInput-' + self._uid;
                    document.querySelector(id + ' input').disabled = true;
                    document.getElementById(self._addUID('GPautoCompleteList')).style.display = 'none';
                    document.getElementById(self._addUID('GPgeocodeResultsList')).style.display = 'none';
                    document.getElementById(self._addUID('GPshowAdvancedSearch')).style.display = 'none';
                    document.getElementById(self._addUID('GPadvancedSearchPanel')).style.display = 'inline-block';
                });
                var span = document.createElement('span');
                span.id = this._addUID('GPshowAdvancedSearchOpen');
                span.className = 'GPshowAdvancedToolOpen';
                div.appendChild(span);
                return div;
            },
            _createAdvancedSearchPanelElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPadvancedSearchPanel');
                div.className = 'GPpanel';
                div.style.display = 'none';
                return div;
            },
            _createGeocodeResultsElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPgeocodeResultsList');
                div.className = 'GPpanel';
                div.style.display = 'none';
                div.appendChild(this._createGeocodeResultsHeaderElement());
                return div;
            },
            _createAutoCompleteElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPautoCompleteList');
                div.className = 'GPautoCompleteList';
                div.style.display = 'none';
                return div;
            },
            _createAutoCompleteListElement: function () {
                var self = this;
                var container = document.createElement('div');
                container.id = this._addUID('GPautocompleteResults');
                if (container.addEventListener) {
                    container.addEventListener('click', function (e) {
                        self.onAutoCompletedResultsItemClick(e);
                        document.getElementById(self._addUID('GPautoCompleteList')).style.display = 'none';
                    }, false);
                } else if (container.attachEvent) {
                    container.attachEvent('onclick', function (e) {
                        self.onAutoCompletedResultsItemClick(e);
                        document.getElementById(self._addUID('GPautoCompleteList')).style.display = 'none';
                    });
                }
                return container;
            },
            _createAutoCompletedLocationElement: function (location, id) {
                var container = document.getElementById(this._addUID('GPautocompleteResults'));
                var div = document.createElement('div');
                div.id = this._addUID('AutoCompletedLocation_' + id);
                div.className = 'GPautoCompleteProposal';
                div.innerHTML = location.fullText;
                if (div.addEventListener) {
                    div.addEventListener('click', function (e) {
                        container.click(e);
                    }, false);
                } else if (div.attachEvent) {
                    div.attachEvent('onclick', function (e) {
                        container.click(e);
                    });
                }
                container.appendChild(div);
            },
            _createAdvancedSearchPanelHeaderElement: function () {
                var self = this;
                var container = document.createElement('div');
                container.className = 'GPpanelHeader';
                var divTitle = document.createElement('div');
                divTitle.className = 'GPpanelTitle';
                divTitle.innerHTML = 'Recherche avancée';
                container.appendChild(divTitle);
                var divClose = document.createElement('div');
                divClose.id = this._addUID('GPadvancedSearchClose');
                divClose.className = 'GPpanelClose';
                divClose.title = 'Fermer la recherche avancée';
                if (divClose.addEventListener) {
                    divClose.addEventListener('click', function () {
                        var id = '#GPsearchInput-' + self._uid;
                        document.querySelector(id + ' input').disabled = false;
                        document.getElementById(self._addUID('GPgeocodeResultsList')).style.display = 'none';
                        document.getElementById(self._addUID('GPshowAdvancedSearch')).style.display = 'inline-block';
                        document.getElementById(self._addUID('GPadvancedSearchPanel')).style.display = 'none';
                    }, false);
                } else if (divClose.attachEvent) {
                    divClose.attachEvent('onclick', function () {
                        var id = '#GPsearchInput-' + self._uid;
                        document.querySelector(id + ' input').disabled = false;
                        document.getElementById(self._addUID('GPgeocodeResultsList')).style.display = 'none';
                        document.getElementById(self._addUID('GPshowAdvancedSearch')).style.display = 'inline-block';
                        document.getElementById(self._addUID('GPadvancedSearchPanel')).style.display = 'none';
                    });
                }
                container.appendChild(divClose);
                return container;
            },
            _createAdvancedSearchPanelFormElement: function (advancedSearchCodes) {
                var self = this;
                var form = document.createElement('form');
                form.id = this._addUID('GPadvancedSearchForm');
                form.addEventListener('submit', function (e) {
                    e.preventDefault();
                    var data = [];
                    var id = '#GPadvancedSearchFilters-' + self._uid;
                    var matchesFilters = document.querySelectorAll(id + ' > div > div > input');
                    for (var i = 0; i < matchesFilters.length; i++) {
                        var element = matchesFilters[i];
                        data.push({
                            key: element.name,
                            value: element.value
                        });
                    }
                    self.onGeocodingAdvancedSearchSubmit(e, data);
                    document.getElementById(self._addUID('GPgeocodeResultsList')).style.display = 'block';
                    return false;
                });
                var div = document.createElement('div');
                div.className = 'GPflexInput';
                var label = document.createElement('label');
                label.className = 'GPadvancedSearchCodeLabel';
                label.innerHTML = 'Recherche par';
                div.appendChild(label);
                var select = this._createAdvancedSearchFormCodeElement(advancedSearchCodes);
                div.appendChild(select);
                form.appendChild(div);
                return form;
            },
            _createAdvancedSearchFormCodeElement: function (codes) {
                var self = this;
                var select = document.createElement('select');
                select.id = this._addUID('GPadvancedSearchCode');
                select.className = 'GPadvancedSearchCode';
                select.addEventListener('change', function (e) {
                    self.onGeocodingAdvancedSearchCodeChange(e);
                }, false);
                if (!codes) {
                    codes = [
                        {
                            id: 'PositionOfInterest',
                            title: 'Lieux/toponymes'
                        },
                        {
                            id: 'StreetAddress',
                            title: 'Adresses'
                        },
                        {
                            id: 'CadastralParcel',
                            title: 'Parcelles cadastrales'
                        },
                        {
                            id: 'Administratif',
                            title: 'Administratif'
                        }
                    ];
                }
                for (var i = 0; i < codes.length; i++) {
                    var option = document.createElement('option');
                    option.value = codes[i].id;
                    option.text = codes[i].title;
                    select.appendChild(option);
                }
                return select;
            },
            _createAdvancedSearchFormInputElement: function () {
                var input = document.createElement('input');
                input.type = 'submit';
                input.id = this._addUID('GPadvancedSearchSubmit');
                input.className = 'GPinputSubmit';
                input.value = 'Chercher';
                return input;
            },
            _createAdvancedSearchFormFiltersElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GPadvancedSearchFilters');
                return container;
            },
            _createAdvancedSearchFiltersTableElement: function (code, display) {
                var container = document.createElement('div');
                container.id = this._addUID(code);
                if (!display) {
                    container.style.display = 'none';
                }
                return container;
            },
            _createAdvancedSearchFiltersAttributElement: function (filterAttributes) {
                var container = null;
                var name = filterAttributes.name;
                var title = filterAttributes.title;
                var description = filterAttributes.description;
                var code = filterAttributes.code;
                var value = filterAttributes.value;
                var div = document.createElement('div');
                div.className = 'GPflexInput';
                var label = document.createElement('label');
                label.className = 'GPadvancedSearchFilterLabel';
                label.htmlFor = name;
                label.title = description || title;
                label.innerHTML = title;
                div.appendChild(label);
                var input = document.createElement('input');
                input.id = name;
                input.className = 'GPadvancedSearchFilterInput';
                input.type = 'text';
                input.name = name;
                if (value) {
                    input.value = value;
                }
                div.appendChild(input);
                container = document.getElementById(this._addUID(code));
                if (container) {
                    container.appendChild(div);
                } else {
                    container = div;
                }
                return container;
            },
            _createGeocodeResultsHeaderElement: function () {
                var self = this;
                var container = document.createElement('div');
                container.className = 'GPpanelHeader';
                var divTitle = document.createElement('div');
                divTitle.className = 'GPpanelTitle';
                divTitle.innerHTML = 'Résultats de la recherche';
                container.appendChild(divTitle);
                var divClose = document.createElement('div');
                divClose.id = this._addUID('GPgeocodeResultsClose');
                divClose.className = 'GPpanelClose';
                divClose.title = 'Fermer la fenêtre de résultats';
                if (divClose.addEventListener) {
                    divClose.addEventListener('click', function () {
                        document.getElementById(self._addUID('GPgeocodeResultsList')).style.display = 'none';
                    }, false);
                } else if (divClose.attachEvent) {
                    divClose.attachEvent('onclick', function () {
                        document.getElementById(self._addUID('GPgeocodeResultsList')).style.display = 'none';
                    });
                }
                container.appendChild(divClose);
                return container;
            },
            _createGeocodeResultsListElement: function () {
                var self = this;
                var container = document.createElement('div');
                container.id = this._addUID('GPgeocodeResults');
                if (container.addEventListener) {
                    container.addEventListener('click', function (e) {
                        if (!e.ctrlKey) {
                            document.getElementById(self._addUID('GPgeocodeResultsList')).style.display = 'none';
                        }
                        self.onGeocodedResultsItemClick(e);
                    }, false);
                } else if (container.attachEvent) {
                    container.attachEvent('onclick', function (e) {
                        if (!e.ctrlKey) {
                            document.getElementById(self._addUID('GPgeocodeResultsList')).style.display = 'none';
                        }
                        self.onGeocodedResultsItemClick(e);
                    });
                }
                return container;
            },
            _createGeocodedLocationElement: function (location, id) {
                var container = document.getElementById(this._addUID('GPgeocodeResults'));
                var div = document.createElement('div');
                div.id = this._addUID('GeocodedLocation_' + id);
                div.className = 'GPautoCompleteProposal';
                if (typeof location === 'string') {
                    div.innerHTML = location;
                } else {
                    var places = location.placeAttributes;
                    if (places.freeform) {
                        div.innerHTML = places.freeform;
                    } else if (places.postalCode) {
                        div.innerHTML = places.postalCode + ' ' + places.commune;
                    } else if (places.cadastralParcel) {
                        div.innerHTML = places.cadastralParcel;
                    } else {
                        div.innerHTML = '...';
                    }
                }
                container.appendChild(div);
            }
        };
        return SearchEngineDOM;
    }(CommonUtilsSelectorID);
    CommonControlsSearchEngineUtils = function () {
        var SearchEngineUtils = {
            advancedSearchFiltersByDefault: {
                PositionOfInterest: [
                    {
                        name: 'importance',
                        title: 'Importance'
                    },
                    {
                        name: 'nature',
                        title: 'Nature'
                    },
                    {
                        name: 'territory',
                        title: 'Territoire'
                    },
                    {
                        name: 'insee',
                        title: 'Code INSEE'
                    },
                    {
                        name: 'municipality',
                        title: 'Ville'
                    },
                    {
                        name: 'department',
                        title: 'Département'
                    }
                ],
                StreetAddress: [
                    {
                        name: 'territory',
                        title: 'Territoire'
                    },
                    {
                        name: 'insee',
                        title: 'Code INSEE'
                    },
                    {
                        name: 'municipality',
                        title: 'Ville'
                    },
                    {
                        name: 'department',
                        title: 'Département'
                    }
                ],
                CadastralParcel: [
                    {
                        name: 'department',
                        title: 'Département',
                        description: 'Numéro du département (ex: 01, 94)'
                    },
                    {
                        name: 'commune',
                        title: 'Code commune (INSEE)',
                        description: 'Code commune (INSEE) : 3 chiffres (ex: 067)'
                    },
                    {
                        name: 'absorbedCity',
                        title: 'Commune absorbée',
                        description: 'Commune absorbée : 3 chiffres (ex: 000, 001)'
                    },
                    {
                        name: 'section',
                        title: 'Section',
                        description: 'Section : 2 caractères (ex: AA, 0D)'
                    },
                    {
                        name: 'number',
                        title: 'Numéro',
                        description: 'Numéro de la parcelle : 4 chiffres (ex: 0041, 0250)'
                    }
                ],
                Administratif: [
                    {
                        name: 'prefecture',
                        title: 'Préfecture'
                    },
                    {
                        name: 'inseeRegion',
                        title: 'Code région (INSEE)'
                    },
                    {
                        name: 'inseeDepartment',
                        title: 'Code département (INSEE)'
                    },
                    {
                        name: 'municipality',
                        title: 'Ville'
                    }
                ]
            },
            zoomToResultsByDefault: function (info) {
                var zoom = 15;
                var service = info.service;
                var fields = info.fields;
                var type = info.type;
                var importance = {
                    1: 11,
                    2: 12,
                    3: 13,
                    4: 14,
                    5: 15,
                    6: 16,
                    7: 17,
                    8: 17
                };
                if (service === 'SuggestedLocation') {
                    if (type === 'PositionOfInterest') {
                        zoom = importance[fields.classification];
                    }
                }
                if (service === 'DirectGeocodedLocation') {
                    if (type === 'PositionOfInterest') {
                        zoom = importance[fields.importance] || 14;
                    }
                }
                if (type === 'StreetAddress') {
                    zoom = 17;
                }
                if (type === 'CadastralParcel') {
                    zoom = 17;
                }
                if (type === 'Administratif') {
                    zoom = 12;
                }
                return zoom;
            }
        };
        return SearchEngineUtils;
    }();
    Ol3ControlsSearchEngine = function (ol, Gp, woodman, Utils, Markers, RightManagement, SelectorID, SearchEngineDOM, SearchEngineUtils) {
        function SearchEngine(options) {
            options = options || {};
            if (!(this instanceof SearchEngine)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            this.initialize(options);
            this._container = this._initContainer();
            this._containerElement = null;
            if (options.element && options.element.appendChild) {
                options.element.appendChild(this._container);
                this._containerElement = options.element;
            }
            ol.control.Control.call(this, {
                element: this._containerElement || this._container,
                target: options.target,
                render: options.render
            });
        }
        ol.inherits(SearchEngine, ol.control.Control);
        SearchEngine.prototype = Object.create(ol.control.Control.prototype, {});
        Utils.assign(SearchEngine.prototype, SearchEngineDOM);
        SearchEngine.prototype.constructor = SearchEngine;
        SearchEngine.prototype.setMap = function (map) {
            if (!map) {
                this._clearResults();
            }
            ol.control.Control.prototype.setMap.call(this, map);
        };
        SearchEngine.prototype.getCollapsed = function () {
            return this.collapsed;
        };
        SearchEngine.prototype.setCollapsed = function (collapsed) {
            if (collapsed === undefined) {
                console.log('[ERROR] SearchEngine:setCollapsed - missing collapsed parameter');
                return;
            }
            if (collapsed && this.collapsed || !collapsed && !this.collapsed) {
                return;
            }
            if (collapsed) {
                this._showSearchEngineInput.click();
            } else {
                this._showSearchEngineInput.click();
            }
            this.collapsed = collapsed;
        };
        SearchEngine.prototype.initialize = function (options) {
            this._checkInputOptions(options);
            this.options = {
                collapsed: true,
                zoomTo: '',
                resources: {
                    geocode: [],
                    autocomplete: []
                },
                displayAdvancedSearch: true,
                advancedSearch: {},
                geocodeOptions: {},
                autocompleteOptions: {}
            };
            Utils.mergeParams(this.options, options);
            if (this.options.resources.geocode.length === 0) {
                this.options.resources.geocode = [
                    'PositionOfInterest',
                    'StreetAddress'
                ];
            }
            if (this.options.resources.autocomplete.length === 0) {
                this.options.resources.autocomplete = [
                    'PositionOfInterest',
                    'StreetAddress'
                ];
            }
            this.collapsed = this.options.collapsed;
            this._uid = SelectorID.generate();
            this._showSearchEngineInput = null;
            this._inputSearchContainer = null;
            this._autocompleteContainer = null;
            this._suggestedContainer = null;
            this._suggestedLocations = [];
            this._geocodedContainer = null;
            this._geocodedLocations = [];
            this._filterContainer = null;
            this._currentGeocodingCode = null;
            this._currentGeocodingLocation = null;
            this._advancedSearchFilters = {};
            this._initAdvancedSearchFilters();
            this._advancedSearchCodes = [];
            this._initAdvancedSearchCodes();
            this._marker = null;
            this._markerUrl = Markers['lightOrange'];
            this._popupContent = null;
            this._popupDiv = this._initPopupDiv();
            this._popupOverlay = null;
            this._servicesRightManagement = {};
            this._noRightManagement = false;
            this._checkRightsManagement();
        };
        SearchEngine.prototype._checkInputOptions = function (options) {
            var i;
            if (options.resources) {
                if (typeof options.resources === 'object') {
                    var geocodeResources = options.resources.geocode;
                    if (geocodeResources) {
                        if (!Array.isArray(geocodeResources)) {
                            console.log('[SearchEngine] \'options.resources.geocode\' parameter should be an array');
                            geocodeResources = null;
                        }
                        var geocodeResourcesList = [
                            'StreetAddress',
                            'PositionOfInterest',
                            'CadastralParcel',
                            'Administratif'
                        ];
                        for (i = 0; i < geocodeResources.length; i++) {
                            if (geocodeResourcesList.indexOf(geocodeResources[i]) === -1) {
                                console.log('[SearchEngine] options.resources.geocode : ' + geocodeResources[i] + ' is not a resource for geocode');
                            }
                        }
                    }
                    var autocompleteResources = options.resources.autocomplete;
                    if (autocompleteResources) {
                        if (!Array.isArray(autocompleteResources)) {
                            console.log('[SearchEngine] \'options.resources.autocomplete\' parameter should be an array');
                            autocompleteResources = null;
                        }
                        var autocompleteResourcesList = [
                            'StreetAddress',
                            'PositionOfInterest'
                        ];
                        for (i = 0; i < autocompleteResources.length; i++) {
                            if (autocompleteResourcesList.indexOf(autocompleteResources[i]) === -1) {
                                console.log('[SearchEngine] options.resources.autocomplete : ' + autocompleteResources[i] + ' is not a resource for autocomplete');
                            }
                        }
                    }
                } else {
                    console.log('[SearchEngine] \'resources\' parameter should be an object');
                    options.resources = null;
                }
            }
        };
        SearchEngine.prototype._initAdvancedSearchCodes = function () {
            var geocodeResources = this.options.resources.geocode;
            for (var i = 0; i < geocodeResources.length; i++) {
                switch (geocodeResources[i]) {
                case 'PositionOfInterest':
                    this._advancedSearchCodes.push({
                        id: 'PositionOfInterest',
                        title: 'Lieux/toponymes'
                    });
                    break;
                case 'StreetAddress':
                    this._advancedSearchCodes.push({
                        id: 'StreetAddress',
                        title: 'Adresses'
                    });
                    break;
                case 'CadastralParcel':
                    this._advancedSearchCodes.push({
                        id: 'CadastralParcel',
                        title: 'Parcelles cadastrales'
                    });
                    break;
                case 'Administratif':
                    this._advancedSearchCodes.push({
                        id: 'Administratif',
                        title: 'Administratif'
                    });
                    break;
                default:
                    break;
                }
            }
            if (this._advancedSearchCodes.length === 0) {
                this._advancedSearchCodes = [
                    {
                        id: 'StreetAddress',
                        title: 'Adresses'
                    },
                    {
                        id: 'PositionOfInterest',
                        title: 'Lieux/toponymes'
                    }
                ];
            }
        };
        SearchEngine.prototype._initAdvancedSearchFilters = function () {
            this._advancedSearchFilters = SearchEngineUtils.advancedSearchFiltersByDefault;
            var advancedSearchFiltersCustom = this.options.advancedSearch;
            Utils.assign(this._advancedSearchFilters, advancedSearchFiltersCustom);
        };
        SearchEngine.prototype._initPopupDiv = function () {
            var context = this;
            var element = document.createElement('div');
            element.className = 'gp-feature-info-div';
            var closer = document.createElement('input');
            closer.type = 'button';
            closer.className = 'gp-styling-button closer';
            closer.onclick = function () {
                if (context._popupOverlay != null) {
                    context._popupOverlay.setPosition(undefined);
                }
                return false;
            };
            this._popupContent = document.createElement('div');
            this._popupContent.className = 'gp-features-content-div';
            this._popupContent.style['min-width'] = '200px';
            element.appendChild(this._popupContent);
            element.appendChild(closer);
            return element;
        };
        SearchEngine.prototype._initContainer = function () {
            var container = this._createMainContainerElement();
            var inputShow = this._showSearchEngineInput = this._createShowSearchEngineElement();
            container.appendChild(inputShow);
            if (!this.options.collapsed) {
                inputShow.checked = true;
            }
            var picto = this._createShowSearchEnginePictoElement();
            container.appendChild(picto);
            var search = this._inputSearchContainer = this._createSearchInputElement();
            var context = this;
            if (search.addEventListener) {
                search.addEventListener('click', function () {
                    context.onAutoCompleteInputClick();
                });
            } else if (search.attachEvent) {
                search.attachEvent('onclick', function () {
                    context.onAutoCompleteInputClick();
                });
            }
            container.appendChild(search);
            if (this.options.displayAdvancedSearch) {
                var advancedShow = this._createShowAdvancedSearchElement();
                container.appendChild(advancedShow);
                var advancedPanel = this._createAdvancedSearchPanelElement();
                var advancedHeader = this._createAdvancedSearchPanelHeaderElement();
                var advancedForm = this._createAdvancedSearchPanelFormElement(this._advancedSearchCodes);
                var advancedFormFilters = this._filterContainer = this._createAdvancedSearchFormFiltersElement();
                this._setFilter(this._advancedSearchCodes[0].id);
                var advancedFormInput = this._createAdvancedSearchFormInputElement();
                advancedForm.appendChild(advancedFormFilters);
                advancedForm.appendChild(advancedFormInput);
                advancedPanel.appendChild(advancedHeader);
                advancedPanel.appendChild(advancedForm);
                container.appendChild(advancedPanel);
            }
            var autocomplete = this._autocompleteContainer = this._createAutoCompleteElement();
            var autocompleteList = this._suggestedContainer = this._createAutoCompleteListElement();
            autocomplete.appendChild(autocompleteList);
            container.appendChild(autocomplete);
            var geocode = this._createGeocodeResultsElement();
            var geocodeList = this._geocodedContainer = this._createGeocodeResultsListElement();
            geocode.appendChild(geocodeList);
            container.appendChild(geocode);
            return container;
        };
        SearchEngine.prototype._setFilter = function (code) {
            var container = this._filterContainer;
            var codeFound = false;
            for (var i = 0; i < this._advancedSearchCodes.length; i++) {
                if (this._advancedSearchCodes[i].id === code) {
                    codeFound = true;
                    break;
                }
            }
            if (!codeFound) {
                while (container.firstChild) {
                    container.removeChild(container.firstChild);
                }
                return;
            }
            this._currentGeocodingCode = code;
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }
            var lstAttributs = this._advancedSearchFilters[code];
            if (!lstAttributs || lstAttributs.length === 0) {
                return;
            }
            var divTable = this._createAdvancedSearchFiltersTableElement(code, true);
            for (var j = 0; j < lstAttributs.length; j++) {
                var divFilter = this._createAdvancedSearchFiltersAttributElement(lstAttributs[j]);
                divTable.appendChild(divFilter);
            }
            container.appendChild(divTable);
            return container;
        };
        SearchEngine.prototype._checkRightsManagement = function () {
            var _resources = [];
            var _key;
            var _opts = null;
            _key = this.options.autocompleteOptions.apiKey;
            _opts = this.options.autocompleteOptions.filterOptions;
            _resources = _opts ? _opts.type : [];
            if (!_resources || _resources.length === 0) {
                _resources = this.options.resources.autocomplete;
            }
            if (!_resources || _resources.length === 0) {
                _resources = [
                    'StreetAddress',
                    'PositionOfInterest'
                ];
            }
            var rightManagementAutoComplete = RightManagement.check({
                key: _key || this.options.apiKey,
                resources: _resources,
                services: ['AutoCompletion']
            });
            _key = this.options.geocodeOptions.apiKey;
            _opts = this.options.geocodeOptions.filterOptions;
            _resources = _opts ? _opts.type : [];
            if (!_resources || _resources.length === 0) {
                _resources = this.options.resources.geocode;
            }
            if (!_resources || _resources.length === 0) {
                _resources = [
                    'StreetAddress',
                    'PositionOfInterest'
                ];
            }
            var rightManagementGeocode = RightManagement.check({
                key: _key || this.options.apiKey,
                resources: _resources,
                services: ['Geocode']
            });
            if (!rightManagementAutoComplete && !rightManagementGeocode) {
                this._noRightManagement = true;
                return;
            }
            if (!this.options.apiKey) {
                if (rightManagementGeocode) {
                    this.options.apiKey = rightManagementGeocode.key;
                } else {
                    this.options.apiKey = rightManagementAutoComplete.key;
                }
            }
            if (rightManagementAutoComplete) {
                this._servicesRightManagement['AutoCompletion'] = rightManagementAutoComplete['AutoCompletion'];
            }
            if (rightManagementGeocode) {
                this._servicesRightManagement['Geocode'] = rightManagementGeocode['Geocode'];
            }
        };
        SearchEngine.prototype._requestAutoComplete = function (settings) {
            if (!settings || typeof settings === 'object' && Object.keys(settings).length === 0) {
                return;
            }
            if (!settings.text) {
                return;
            }
            var options = {};
            Utils.assign(options, this.options.autocompleteOptions);
            Utils.assign(options, settings);
            var resources = this.options.resources.autocomplete;
            if (resources && Array.isArray(resources)) {
                if (!options.filterOptions) {
                    options.filterOptions = {};
                }
                if (!options.filterOptions.type) {
                    options.filterOptions.type = resources;
                }
            }
            options.apiKey = options.apiKey || this.options.apiKey;
            Gp.Services.autoComplete(options);
        };
        SearchEngine.prototype._fillAutoCompletedLocationListContainer = function (locations) {
            if (!locations || locations.length === 0) {
                return;
            }
            var element = this._suggestedContainer;
            if (element.childElementCount) {
                while (element.firstChild) {
                    element.removeChild(element.firstChild);
                }
            }
            this._displaySuggestedLocation();
            for (var i = 0; i < locations.length; i++) {
                this._createAutoCompletedLocationElement(locations[i], i);
            }
        };
        SearchEngine.prototype._requestGeocoding = function (settings) {
            if (!settings || typeof settings === 'object' && Object.keys(settings).length === 0) {
                return;
            }
            if (!settings.location) {
                return;
            }
            var options = {};
            options.returnFreeForm = true;
            Utils.assign(options, this.options.geocodeOptions);
            Utils.assign(options, settings);
            var resources = this.options.resources.geocode;
            if (resources && Array.isArray(resources)) {
                if (!options.filterOptions) {
                    options.filterOptions = {};
                }
                if (!options.filterOptions.type) {
                    options.filterOptions.type = resources;
                }
            }
            options.apiKey = options.apiKey || this.options.apiKey;
            Gp.Services.geocode(options);
        };
        SearchEngine.prototype._fillGeocodedLocationListContainer = function (locations) {
            if (!locations || locations.length === 0) {
                this._clearGeocodedLocation();
                return;
            }
            var element = this._geocodedContainer;
            if (element.childElementCount) {
                while (element.firstChild) {
                    element.removeChild(element.firstChild);
                }
            }
            for (var i = 0; i < locations.length; i++) {
                this._createGeocodedLocationElement(locations[i], i);
            }
            this._geocodedLocations = locations;
        };
        SearchEngine.prototype._setLabel = function (label) {
            document.getElementById('GPsearchInputText-' + this._uid).value = label;
        };
        SearchEngine.prototype._setPosition = function (position, zoom) {
            var view = this.getMap().getView();
            console.log(position);
            view.setCenter(position);
            view.setZoom(zoom);
        };
        SearchEngine.prototype._setMarker = function (position, info) {
            var map = this.getMap();
            var context = this;
            if (this._marker != null) {
                map.removeOverlay(this._marker);
                this._marker = null;
            }
            if (position) {
                var markerDiv = document.createElement('img');
                markerDiv.src = this._markerUrl;
                if (markerDiv.addEventListener) {
                    markerDiv.addEventListener('click', function () {
                        context._onResultMarkerSelect(info);
                    });
                } else if (markerDiv.attachEvent) {
                    markerDiv.attachEvent('onclick', function () {
                        context._onResultMarkerSelect(info);
                    });
                }
                this._marker = new ol.Overlay({
                    position: position,
                    offset: [
                        -25.5,
                        -38
                    ],
                    element: markerDiv,
                    stopEvent: false
                });
                map.addOverlay(this._marker);
            }
        };
        SearchEngine.prototype._getZoom = function (info) {
            var map = this.getMap();
            var key = this.options.zoomTo;
            var zoom = null;
            if (typeof key === 'function') {
                zoom = key.call(this, info);
            }
            if (typeof key === 'number') {
                zoom = key;
            }
            if (typeof key === 'string') {
                if (key === 'auto') {
                    zoom = SearchEngineUtils.zoomToResultsByDefault(info);
                } else {
                    var value = parseInt(key, 10);
                    if (!isNaN(value)) {
                        zoom = value;
                    }
                }
            }
            Number.isInteger = Number.isInteger || function (value) {
                return typeof value === 'number' && isFinite(value) && Math.floor(value) === value;
            };
            if (!zoom || zoom === '' || !Number.isInteger(zoom)) {
                zoom = map.getView().getZoom();
            }
            var min = map.minZoom;
            var max = map.maxZoom;
            if (zoom < min) {
                zoom = min;
            }
            if (zoom > max) {
                zoom = max;
            }
            return zoom;
        };
        SearchEngine.prototype._onResultMarkerSelect = function (information) {
            var map = this.getMap();
            var popupContent = '';
            if (information.attributes) {
                popupContent = '<ul>';
                var attributes = information.attributes;
                for (var attr in attributes) {
                    if (attributes.hasOwnProperty(attr)) {
                        if (attr !== 'bbox') {
                            popupContent += '<li>';
                            popupContent += '<span class="gp-attname-others-span">' + attr.toUpperCase() + ' : </span>';
                            popupContent += attributes[attr];
                            popupContent += ' </li>';
                        }
                    }
                }
                popupContent += ' </ul>';
            } else {
                popupContent = information.label;
            }
            this._popupContent.innerHTML = popupContent;
            if (!this._popupOverlay) {
                this._popupOverlay = new ol.Overlay({
                    element: this._popupDiv,
                    positioning: 'bottom-center',
                    position: this._marker.getPosition(),
                    offset: [
                        0,
                        -42
                    ]
                });
                map.addOverlay(this._popupOverlay);
            } else {
                this._popupOverlay.setPosition(this._marker.getPosition());
            }
        };
        SearchEngine.prototype.onShowSearchEngineClick = function () {
            this.collapsed = this._showSearchEngineInput.checked;
            this.dispatchEvent('change:collapsed');
        };
        SearchEngine.prototype.onSearchResetClick = function () {
            this._clearResults();
        };
        SearchEngine.prototype.onAutoCompleteInputClick = function () {
            var inputSearchTextContainer = document.getElementById('GPsearchInputText-' + this._uid);
            if (inputSearchTextContainer && !inputSearchTextContainer.disabled && inputSearchTextContainer.value.length > 2) {
                this._displaySuggestedLocation();
            }
        };
        SearchEngine.prototype.onAutoCompleteSearchText = function (e) {
            var value = e.target.value;
            if (!value) {
                return;
            }
            if (this._noRightManagement) {
                console.log('no rights for this service !');
                return;
            }
            this._currentGeocodingLocation = value;
            if (value.length < 3) {
                this._clearSuggestedLocation();
                return;
            }
            var context = this;
            this._requestAutoComplete({
                text: value,
                onSuccess: function (results) {
                    if (results) {
                        context._suggestedLocations = results.suggestedLocations;
                        context._locationsToBeDisplayed = [];
                        for (var i = 0; i < context._suggestedLocations.length; i++) {
                            var ilocation = context._suggestedLocations[i];
                            if (ilocation.position && ilocation.position.x === 0 && ilocation.position.y === 0 && ilocation.fullText) {
                                context._getGeocodeCoordinatesFromFullText(ilocation, i);
                            } else {
                                context._locationsToBeDisplayed.push(ilocation);
                            }
                        }
                        context._fillAutoCompletedLocationListContainer(context._locationsToBeDisplayed);
                    }
                },
                onFailure: function (error) {
                    context._clearSuggestedLocation();
                }
            });
            var map = this.getMap();
            map.on('click', this._hideSuggestedLocation, this);
            map.on('pointerdrag', this._hideSuggestedLocation, this);
        };
        SearchEngine.prototype._getGeocodeCoordinatesFromFullText = function (suggestedLocation, i) {
            var context = this;
            Gp.Services.geocode({
                apiKey: this.options.apiKey,
                location: suggestedLocation.fullText,
                filterOptions: { type: suggestedLocation.type },
                onSuccess: function (response) {
                    if (response.locations && response.locations.length !== 0 && response.locations[0].position) {
                        if (context._suggestedLocations && context._suggestedLocations[i]) {
                            context._suggestedLocations[i].position = {
                                x: response.locations[0].position.y,
                                y: response.locations[0].position.x
                            };
                            context._locationsToBeDisplayed.unshift(context._suggestedLocations[i]);
                            context._fillAutoCompletedLocationListContainer(context._locationsToBeDisplayed);
                        }
                    }
                },
                onFailure: function () {
                    if (context._suggestedLocations && context._suggestedLocations[i]) {
                        context._createAutoCompletedLocationElement(context._suggestedLocations[i], i);
                    }
                }
            });
        };
        SearchEngine.prototype.onAutoCompletedResultsItemClick = function (e) {
            var idx = SelectorID.index(e.target.id);
            if (!idx) {
                return;
            }
            var position = [
                this._locationsToBeDisplayed[idx].position.x,
                this._locationsToBeDisplayed[idx].position.y
            ];
            var info = {
                service: 'SuggestedLocation',
                type: this._locationsToBeDisplayed[idx].type,
                fields: this._locationsToBeDisplayed[idx]
            };
            var label = this._locationsToBeDisplayed[idx].fullText;
            this._setLabel(label);
            info.label = label;
            var view = this.getMap().getView();
            var mapProj = view.getProjection().getCode();
            if (mapProj !== 'EPSG:4326') {
                position = ol.proj.transform(position, 'EPSG:4326', mapProj);
            }
            var zoom = this._getZoom(info);
            this._setPosition(position, zoom);
            this._setMarker(position, info);
        };
        SearchEngine.prototype.onGeocodingSearchSubmit = function (e) {
            var value = e.target[0].value;
            if (!value) {
                return;
            }
            if (this._noRightManagement) {
                console.log('no rights for this service !');
                return;
            }
            this._currentGeocodingLocation = value;
            var context = this;
            this._requestGeocoding({
                location: value,
                onSuccess: function (results) {
                    if (results) {
                        var locations = results.locations;
                        context._fillGeocodedLocationListContainer(locations);
                    }
                },
                onFailure: function (error) {
                    context._clearGeocodedLocation();
                }
            });
        };
        SearchEngine.prototype.onGeocodedResultsItemClick = function (e) {
            var idx = SelectorID.index(e.target.id);
            if (!idx) {
                return;
            }
            var position = [
                this._geocodedLocations[idx].position.y,
                this._geocodedLocations[idx].position.x
            ];
            var attributes = this._geocodedLocations[idx].placeAttributes;
            var info = {
                service: 'DirectGeocodedLocation',
                type: this._geocodedLocations[idx].type,
                fields: this._geocodedLocations[idx]
            };
            var label;
            if (attributes.freeform) {
                label = attributes.freeform;
            } else if (attributes.postalCode) {
                label = attributes.postalCode + ' ' + attributes.commune;
                info.attributes = attributes;
            } else if (attributes.cadastralParcel) {
                label = attributes.cadastralParcel;
                info.attributes = attributes;
            } else {
                label = '...';
            }
            this._setLabel(label);
            info.label = label;
            var view = this.getMap().getView();
            var mapProj = view.getProjection().getCode();
            if (mapProj !== 'EPSG:4326') {
                position = ol.proj.transform(position, 'EPSG:4326', mapProj);
            }
            var zoom = this._getZoom(info);
            this._setPosition(position, zoom);
            this._setMarker(position, info);
        };
        SearchEngine.prototype.onGeocodingAdvancedSearchCodeChange = function (e) {
            var idx = e.target.selectedIndex;
            var value = e.target.options[idx].value;
            if (!value) {
                return;
            }
            this._setFilter(value);
        };
        SearchEngine.prototype.onGeocodingAdvancedSearchSubmit = function (e, data) {
            if (!data || data.length === 0) {
                return;
            }
            var _location;
            var _filterOptions = {};
            var filter;
            _filterOptions.type = [this._currentGeocodingCode];
            for (var i = 0; i < data.length; i++) {
                filter = data[i];
                _filterOptions[filter.key] = filter.value;
            }
            if (this._currentGeocodingCode === 'CadastralParcel') {
                _location = this._getCadastralParcelRequestParams(_filterOptions);
                _filterOptions = { type: [this._currentGeocodingCode] };
            } else {
                _location = this._currentGeocodingLocation;
            }
            var context = this;
            this._requestGeocoding({
                location: _location,
                filterOptions: _filterOptions,
                onSuccess: function (results) {
                    if (results) {
                        var locations = results.locations;
                        context._fillGeocodedLocationListContainer(locations);
                    }
                },
                onFailure: function (error) {
                    context._clearGeocodedLocation();
                }
            });
        };
        SearchEngine.prototype._getCadastralParcelRequestParams = function (filterOptions) {
            var _location = '';
            var l;
            var dep = filterOptions.department;
            if (dep) {
                l = dep.length;
                if (l === 2) {
                    _location = dep;
                } else if (l === 1) {
                    _location = '0' + dep;
                } else {
                    _location = dep.substring(0, 2);
                }
            } else {
                _location = '__';
            }
            var commune = filterOptions.commune;
            if (commune) {
                l = commune.length;
                if (l === 3) {
                    _location += commune;
                } else if (l == 2) {
                    _location += '_' + commune;
                } else if (l == 1) {
                    _location += '__' + commune;
                } else {
                    _location += commune.substring(0, 3);
                }
            } else {
                _location += '___';
            }
            var insee = filterOptions.insee;
            if (insee) {
                if (insee.length === 5) {
                    _location = insee;
                }
            }
            var absorbedCity = filterOptions.absorbedCity;
            if (absorbedCity) {
                l = absorbedCity.length;
                if (l === 3) {
                    _location += absorbedCity;
                } else if (l < 3) {
                    if (l === 2) {
                        _location += '_' + absorbedCity;
                    } else if (l === 1) {
                        _location += '__' + absorbedCity;
                    }
                } else {
                    _location += absorbedCity.substring(0, 3);
                }
            } else {
                _location += '___';
            }
            var section = filterOptions.section;
            if (section) {
                l = section.length;
                if (l === 2) {
                    _location += section;
                } else if (l === 1) {
                    _location += '_' + section;
                } else {
                    _location += section.substring(0, 2);
                }
            } else {
                _location += '__';
            }
            var number = filterOptions.number;
            if (number) {
                l = number.length;
                if (l === 4) {
                    _location += number;
                } else if (l === 3) {
                    _location += '_' + number;
                } else if (l === 2) {
                    _location += '__' + number;
                } else if (l === 1) {
                    _location += '___' + number;
                } else {
                    _location += number.substring(0, 4);
                }
            } else {
                _location += '___';
            }
            return _location;
        };
        SearchEngine.prototype._clearResults = function () {
            var map = this.getMap();
            this._currentGeocodingLocation = null;
            this._clearSuggestedLocation();
            this._clearGeocodedLocation();
            this._setMarker();
            if (this._popupOverlay != null) {
                map.removeOverlay(this._popupOverlay);
                this._popupOverlay = null;
            }
        };
        SearchEngine.prototype._clearSuggestedLocation = function () {
            this._suggestedLocations = [];
            if (this._suggestedContainer) {
                while (this._suggestedContainer.firstChild) {
                    this._suggestedContainer.removeChild(this._suggestedContainer.firstChild);
                }
            }
        };
        SearchEngine.prototype._hideSuggestedLocation = function () {
            if (this._autocompleteContainer) {
                this._autocompleteContainer.style.display = 'none';
            }
        };
        SearchEngine.prototype._displaySuggestedLocation = function () {
            if (this._autocompleteContainer) {
                this._autocompleteContainer.style.display = 'block';
            }
        };
        SearchEngine.prototype._clearGeocodedLocation = function () {
            this._geocodedLocations = [];
            if (this._geocodedContainer) {
                while (this._geocodedContainer.firstChild) {
                    this._geocodedContainer.removeChild(this._geocodedContainer.firstChild);
                }
            }
        };
        return SearchEngine;
    }(ol, gp, {}, CommonUtils, Ol3ControlsUtilsMarkers, CommonUtilsCheckRightManagement, CommonUtilsSelectorID, CommonControlsSearchEngineDOM, CommonControlsSearchEngineUtils);
    CommonUtilsMathUtils = function () {
        var MathUtils = {
            modulo: function (a, b) {
                var r = a % b;
                return r * b < 0 ? r + b : r;
            },
            decimalToDMS: function (degrees, hemispheres, numDigits) {
                var normalizedDegrees = this.modulo(degrees + 180, 360) - 180;
                var x = Math.abs(3600 * normalizedDegrees);
                var dflPrecision = numDigits || 0;
                var precision = Math.pow(10, dflPrecision);
                var deg = Math.floor(x / 3600);
                var min = Math.floor((x - deg * 3600) / 60);
                var sec = x - deg * 3600 - min * 60;
                sec = Math.ceil(sec * precision) / precision;
                if (sec >= 60) {
                    sec = 0;
                    min += 1;
                }
                if (min >= 60) {
                    min = 0;
                    deg += 1;
                }
                var direction = hemispheres.charAt(normalizedDegrees < 0 ? 1 : 0);
                return {
                    d: deg,
                    m: min,
                    s: sec,
                    direction: direction
                };
            },
            toInteger: function (s, base) {
                var _base = base || 10;
                var n = parseInt(s, _base);
                if (!isNaN(n) && isFinite(n)) {
                    return n;
                }
                return null;
            },
            isInteger: function (s) {
                if (isNaN(s)) {
                    return false;
                }
                var v = parseFloat(s);
                return (v | 0) === v;
            },
            toFloat: function (s) {
                var n = parseFloat(s);
                if (!isNaN(n) && isFinite(n)) {
                    return n;
                }
                return null;
            }
        };
        return MathUtils;
    }();
    CommonControlsMousePositionDOM = function () {
        var MousePositionDOM = {
            _addUID: function (id) {
                var uid = this._uid ? id + '-' + this._uid : id;
                return uid;
            },
            _createMainContainerElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GPmousePosition');
                container.className = 'GPwidget';
                return container;
            },
            _createShowMousePositionElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPshowMousePosition');
                input.type = 'checkbox';
                return input;
            },
            _createShowMousePositionPictoElement: function (isDesktop) {
                var self = this;
                var label = document.createElement('label');
                label.id = this._addUID('GPshowMousePositionPicto');
                label.className = 'GPshowAdvancedToolPicto';
                label.htmlFor = this._addUID('GPshowMousePosition');
                label.title = 'Afficher les coordonnées du curseur';
                label.addEventListener('click', function (e) {
                    var mapCenterClass = '';
                    if (!document.getElementById(self._addUID('GPshowMousePosition')).checked && !isDesktop) {
                        mapCenterClass = 'GPmapCenterVisible';
                    }
                    document.getElementById('GPmapCenter').className = mapCenterClass;
                    self.onShowMousePositionClick(e);
                });
                var spanOpen = document.createElement('span');
                spanOpen.id = this._addUID('GPshowMousePositionOpen');
                spanOpen.className = 'GPshowAdvancedToolOpen';
                label.appendChild(spanOpen);
                return label;
            },
            _createMousePositionPanelElement: function (displayAltitude, displayCoordinates, editCoordinates, currentProjectionUnits) {
                displayAltitude = typeof displayAltitude === 'undefined' ? true : displayAltitude;
                displayCoordinates = typeof displayCoordinates === 'undefined' ? true : displayCoordinates;
                editCoordinates = typeof editCoordinates === 'undefined' ? false : editCoordinates;
                var div = document.createElement('div');
                div.id = this._addUID('GPmousePositionPanel');
                div.className = 'GPpanel';
                div.appendChild(this._createMousePositionPanelHeaderElement());
                div.appendChild(this._createMousePositionPanelBasicElement(displayAltitude, displayCoordinates, editCoordinates, currentProjectionUnits));
                var arraySettings = this._createShowMousePositionSettingsElement(displayCoordinates);
                for (var j = 0; j < arraySettings.length; j++) {
                    div.appendChild(arraySettings[j]);
                }
                return div;
            },
            _createMapCenter: function () {
                var div = document.createElement('div');
                div.id = 'GPmapCenter';
                div.className = '';
                return div;
            },
            _createMousePositionPanelHeaderElement: function () {
                var container = document.createElement('div');
                container.className = 'GPpanelHeader';
                var divTitle = document.createElement('div');
                divTitle.className = 'GPpanelTitle';
                divTitle.innerHTML = 'Coordonnées';
                container.appendChild(divTitle);
                var divClose = document.createElement('div');
                divClose.id = 'GPmousePositionPanelClose';
                divClose.className = 'GPpanelClose';
                divClose.title = 'Fermer le panneau';
                var self = this;
                if (divClose.addEventListener) {
                    divClose.addEventListener('click', function () {
                        document.getElementById(self._addUID('GPshowMousePositionPicto')).click();
                    }, false);
                } else if (divClose.attachEvent) {
                    divClose.attachEvent('onclick', function () {
                        document.getElementById(self._addUID('GPshowMousePositionPicto')).click();
                    });
                }
                container.appendChild(divClose);
                return container;
            },
            _createMousePositionPanelBasicElement: function (displayAltitude, displayCoordinates, editCoordinates, currentProjectionUnits) {
                var container = document.createElement('div');
                container.id = this._addUID('GPmousePositionBasicPanel');
                container.appendChild(this._createMousePositionPanelBasicCoordinateElement(displayCoordinates, editCoordinates, currentProjectionUnits));
                container.appendChild(this._createMousePositionPanelEditToolsElement(editCoordinates));
                container.appendChild(this._createMousePositionPanelBasicAltitudeElement(displayAltitude));
                return container;
            },
            _createCoordinateElement: function (coordType, editCoordinates) {
                var context = this;
                if ([
                        'Lon',
                        'Lat'
                    ].indexOf(coordType) === -1) {
                    return [];
                }
                var list = [];
                var input = document.createElement('input');
                input.id = this._addUID('GPmousePosition' + coordType);
                input.title = editCoordinates === true ? 'Cliquer pour saisir des coordonnées' : '';
                input.readOnly = true;
                if (editCoordinates) {
                    input.addEventListener('click', function () {
                        context.onMousePositionEditModeClick(true);
                    });
                    input.addEventListener('change', function (e) {
                        this.classList.remove('error');
                        var valid = context.validateExtentCoordinate(coordType, this.value, e);
                        valid ? this.classList.remove('error') : this.classList.add('error');
                    });
                }
                list.push(input);
                var span = document.createElement('span');
                span.className = 'GPmousePositionUnits';
                list.push(span);
                return list;
            },
            _createDMSCoordinateElement: function (coordType, editCoordinates) {
                if ([
                        'Lon',
                        'Lat'
                    ].indexOf(coordType) === -1) {
                    return [];
                }
                var context = this;
                var list = [];
                var input = document.createElement('input');
                input.id = this._addUID('GPmousePosition' + coordType + 'Degrees');
                input.className = 'GPSexagesimal';
                input.setAttribute('name', 'degrees');
                input.title = editCoordinates === true ? 'Cliquer pour saisir des coordonnées' : '';
                input.readOnly = true;
                input.dataset.min = 0;
                input.dataset.max = coordType === 'Lon' ? 180 : 90;
                if (editCoordinates) {
                    input.addEventListener('click', function () {
                        context.onMousePositionEditModeClick(true);
                    });
                    input.addEventListener('change', function () {
                        this.classList.remove('error');
                        var valid = context._checkDMSDegrees(coordType, this);
                        valid ? this.classList.remove('error') : this.classList.add('error');
                    });
                }
                list.push(input);
                var span = document.createElement('span');
                span.className = 'GPmousePositionSexagesimalLabel';
                span.innerHTML = '\xB0';
                list.push(span);
                var input1 = document.createElement('input');
                input1.id = this._addUID('GPmousePosition' + coordType + 'Minutes');
                input1.className = 'GPSexagesimal';
                input1.setAttribute('name', 'minutes');
                input1.title = editCoordinates === true ? 'Cliquer pour saisir des coordonnées' : '';
                input1.readOnly = true;
                input1.dataset.min = 0;
                input1.dataset.max = 59;
                if (editCoordinates) {
                    input1.addEventListener('click', function () {
                        context.onMousePositionEditModeClick(true);
                    });
                    input1.addEventListener('change', function () {
                        this.classList.remove('error');
                        var valid = context._checkDMSElement(this);
                        valid ? this.classList.remove('error') : this.classList.add('error');
                    });
                }
                list.push(input1);
                var span1 = document.createElement('span');
                span1.className = 'GPmousePositionSexagesimalLabel';
                span1.innerHTML = '\'';
                list.push(span1);
                var input2 = document.createElement('input');
                input2.id = this._addUID('GPmousePosition' + coordType + 'Seconds');
                input2.className = 'GPSexagesimalsec';
                input2.setAttribute('name', 'seconds');
                input2.title = editCoordinates === true ? 'Cliquer pour saisir des coordonnées' : '';
                input2.readOnly = true;
                input2.dataset.min = 0;
                input2.dataset.max = 59;
                if (editCoordinates) {
                    input2.addEventListener('click', function () {
                        context.onMousePositionEditModeClick(true);
                    });
                    input2.addEventListener('change', function () {
                        this.classList.remove('error');
                        var valid = context._checkDMSElement(this, true);
                        valid ? this.classList.remove('error') : this.classList.add('error');
                    });
                }
                list.push(input2);
                var span2 = document.createElement('span');
                span2.className = 'GPmousePositionSexagesimalLabel';
                span2.innerHTML = '\'\'';
                list.push(span2);
                var select = document.createElement('select');
                select.id = this._addUID('GPmousePosition' + coordType + 'Direction');
                select.className = 'GPmousePositionDirection';
                select.setAttribute('name', 'direction');
                select.disabled = true;
                var option = document.createElement('option');
                option.value = coordType === 'Lon' ? 'E' : 'N';
                option.innerHTML = coordType === 'Lon' ? 'E' : 'N';
                select.appendChild(option);
                var option1 = document.createElement('option');
                option1.value = coordType === 'Lon' ? 'O' : 'S';
                option1.innerHTML = coordType === 'Lon' ? 'O' : 'S';
                select.appendChild(option1);
                list.push(select);
                return list;
            },
            _createMousePositionPanelBasicCoordinateElement: function (display, editCoordinates, currentProjectionUnits) {
                var div = document.createElement('div');
                div.id = this._addUID('GPmousePositionCoordinate');
                div.style.display = display ? 'block' : 'none';
                var divLat = document.createElement('div');
                var spanLat = document.createElement('span');
                spanLat.className = 'GPmousePositionLabel';
                spanLat.id = this._addUID('GPmousePositionLatLabel');
                spanLat.innerHTML = 'Latitude : ';
                divLat.appendChild(spanLat);
                var span = document.createElement('span');
                span.id = this._addUID('GPmousePositionLatCoordinate');
                var arrayCoords;
                if (currentProjectionUnits === 'DMS') {
                    arrayCoords = this._createDMSCoordinateElement('Lat', editCoordinates);
                } else {
                    arrayCoords = this._createCoordinateElement('Lat', editCoordinates);
                }
                for (var i = 0; i < arrayCoords.length; i++) {
                    span.appendChild(arrayCoords[i]);
                }
                divLat.appendChild(span);
                div.appendChild(divLat);
                var divLon = document.createElement('div');
                var spanLon = document.createElement('span');
                spanLon.className = 'GPmousePositionLabel';
                spanLon.id = this._addUID('GPmousePositionLonLabel');
                spanLon.innerHTML = 'Longitude : ';
                divLon.appendChild(spanLon);
                var span1 = document.createElement('span');
                span1.id = this._addUID('GPmousePositionLonCoordinate');
                var arrayCoords1;
                if (currentProjectionUnits === 'DMS') {
                    arrayCoords1 = this._createDMSCoordinateElement('Lon', editCoordinates);
                } else {
                    arrayCoords1 = this._createCoordinateElement('Lon', editCoordinates);
                }
                for (var j = 0; j < arrayCoords1.length; j++) {
                    span1.appendChild(arrayCoords1[j]);
                }
                divLon.appendChild(span1);
                div.appendChild(divLon);
                return div;
            },
            _createMousePositionPanelBasicAltitudeElement: function (display) {
                var div = document.createElement('div');
                div.id = this._addUID('GPmousePositionAltitude');
                div.style.display = display ? 'block' : 'none';
                var spanLabel = document.createElement('span');
                spanLabel.className = 'GPmousePositionLabel';
                spanLabel.innerHTML = 'Altitude : ';
                div.appendChild(spanLabel);
                var spanAlt = document.createElement('span');
                spanAlt.className = 'GPmousePositionCoords';
                spanAlt.id = this._addUID('GPmousePositionAlt');
                spanAlt.innerHTML = '...';
                div.appendChild(spanAlt);
                var spanUnits = document.createElement('span');
                spanUnits.className = 'GPmousePositionAltitudeUnits';
                spanUnits.innerHTML = 'm';
                div.appendChild(spanUnits);
                return div;
            },
            _createMousePositionPanelEditToolsElement: function (editCoordinates) {
                var context = this;
                var div = document.createElement('div');
                div.className = 'GPmousePositionPanelEditTools';
                div.id = this._addUID('GPmousePositionPanelEditTools');
                if (!editCoordinates) {
                    div.style.display = 'none';
                }
                var span1 = document.createElement('span');
                span1.className = 'GPmousePositionEditTool';
                span1.id = this._addUID('GPmousePositionLocate');
                span1.title = editCoordinates === true ? 'Cliquer pour saisir des coordonnées' : '';
                if (editCoordinates) {
                    span1.addEventListener('click', function () {
                        context.onMousePositionEditModeLocateClick();
                    });
                }
                div.appendChild(span1);
                var span2 = document.createElement('span');
                span2.className = 'GPmousePositionEditTool';
                span2.id = this._addUID('GPmousePositionCloseEdit');
                span2.title = 'Quitter la saisie des coordonnées';
                span2.style.display = 'none';
                if (editCoordinates) {
                    span2.addEventListener('click', function () {
                        context.onMousePositionEditModeClick(false);
                    });
                }
                div.appendChild(span2);
                return div;
            },
            _createShowMousePositionSettingsElement: function (display) {
                var list = [];
                var input = document.createElement('input');
                input.type = 'checkbox';
                input.id = this._addUID('GPshowMousePositionSettings');
                var label = document.createElement('label');
                label.id = this._addUID('GPshowMousePositionSettingsPicto');
                label.htmlFor = this._addUID('GPshowMousePositionSettings');
                label.title = 'Réglages';
                label.className = 'GPshowMoreOptions GPshowMousePositionSettingsPicto';
                label.style.display = display ? 'block' : 'none';
                list.push(input);
                list.push(label);
                return list;
            },
            _createMousePositionSettingsElement: function (display) {
                var container = document.createElement('div');
                container.id = this._addUID('GPmousePositionSettings');
                container.style.display = display === undefined || display ? 'block' : 'none';
                var span = document.createElement('span');
                span.className = 'GPmousePositionSettingsLabel';
                span.innerHTML = 'Système de référence';
                container.appendChild(span);
                return container;
            },
            _createMousePositionSettingsSystemsElement: function (systems) {
                var context = this;
                var selectSystem = document.createElement('select');
                selectSystem.id = this._addUID('GPmousePositionProjectionSystem');
                selectSystem.className = 'GPinputSelect GPmousePositionSettingsSelect';
                selectSystem.addEventListener('change', function (e) {
                    context.onMousePositionProjectionSystemChange(e);
                });
                selectSystem.addEventListener('mouseover', function (e) {
                    context.onMousePositionProjectionSystemMouseOver(e);
                });
                for (var i = 0; i < systems.length; i++) {
                    var obj = systems[i];
                    var option = document.createElement('option');
                    option.value = obj.code;
                    option.text = obj.label || i;
                    selectSystem.appendChild(option);
                }
                return selectSystem;
            },
            _createMousePositionSettingsUnitsElement: function (units) {
                var context = this;
                var selectUnits = document.createElement('select');
                selectUnits.id = this._addUID('GPmousePositionProjectionUnits');
                selectUnits.className = 'GPinputSelect GPmousePositionSettingsSelect';
                selectUnits.addEventListener('change', function (e) {
                    context.onMousePositionProjectionUnitsChange(e);
                });
                for (var j = 0; j < units.length; j++) {
                    var obj = units[j];
                    var option = document.createElement('option');
                    option.value = obj.code ? obj.code : j;
                    option.text = obj.label || j;
                    selectUnits.appendChild(option);
                }
                return selectUnits;
            },
            _resetLabelElements: function (currentProjectionType) {
                var spanLat = document.getElementById(this._addUID('GPmousePositionLatLabel'));
                spanLat.innerHTML = currentProjectionType === 'Geographical' ? 'Latitude :' : 'X :';
                var spanLon = document.getElementById(this._addUID('GPmousePositionLonLabel'));
                spanLon.innerHTML = currentProjectionType === 'Geographical' ? 'Longitude :' : 'Y :';
            },
            _resetUnitElements: function (currentProjectionUnits) {
                var value = '';
                if (currentProjectionUnits === 'M' || currentProjectionUnits === 'KM') {
                    value = currentProjectionUnits.toLowerCase();
                }
                var elts = document.getElementsByClassName('GPmousePositionUnits');
                for (var e = 0; e < elts.length; e++) {
                    elts[e].innerHTML = value;
                }
            },
            _resetCoordinateElements: function (editCoordinates, currentProjectionType, currentProjectionUnits) {
                var latElt = document.getElementById(this._addUID('GPmousePositionLatCoordinate'));
                while (latElt.firstChild) {
                    latElt.removeChild(latElt.firstChild);
                }
                var arrayCoords;
                if (currentProjectionUnits === 'DMS') {
                    arrayCoords = this._createDMSCoordinateElement('Lat', editCoordinates);
                } else {
                    arrayCoords = this._createCoordinateElement('Lat', editCoordinates);
                }
                for (var i = 0; i < arrayCoords.length; i++) {
                    latElt.appendChild(arrayCoords[i]);
                }
                var lonElt = document.getElementById(this._addUID('GPmousePositionLonCoordinate'));
                while (lonElt.firstChild) {
                    lonElt.removeChild(lonElt.firstChild);
                }
                var arrayCoords1;
                if (currentProjectionUnits === 'DMS') {
                    arrayCoords1 = this._createDMSCoordinateElement('Lon', editCoordinates);
                } else {
                    arrayCoords1 = this._createCoordinateElement('Lon', editCoordinates);
                }
                for (var j = 0; j < arrayCoords1.length; j++) {
                    lonElt.appendChild(arrayCoords1[j]);
                }
                this.onMapMove();
            },
            _setEditMode: function (editing) {
                var locateElt = document.getElementById(this._addUID('GPmousePositionLocate'));
                locateElt.title = editing ? 'Aller à la position ...' : 'Cliquer pour saisir des coordonnées';
                var closeEditElt = document.getElementById(this._addUID('GPmousePositionCloseEdit'));
                closeEditElt.style.display = editing ? 'inline-block' : 'none';
                var selector = 'div[id^=' + this._addUID('GPmousePositionCoordinate') + ']';
                var inputs = document.querySelectorAll(selector + ' input');
                for (var i = 0; i < inputs.length; i++) {
                    inputs[i].readOnly = !editing;
                    if (editing) {
                        inputs[i].value = '';
                        inputs[i].classList.remove('error');
                    }
                }
                var selects = document.querySelectorAll(selector + ' select');
                for (var j = 0; j < selects.length; j++) {
                    selects[j].disabled = !editing;
                }
            },
            _checkDMSElement: function (input, isFloat) {
                var b = isFloat === undefined ? false : true;
                var value = input.value;
                if (b) {
                    value = value.replace(',', '.');
                }
                if (isNaN(value)) {
                    return false;
                }
                var v = parseFloat(value);
                if (!b && (v | 0) !== v) {
                    return false;
                }
                var min = Number(input.dataset.min);
                var max = Number(input.dataset.max);
                return v >= min && v <= max;
            },
            _checkDMSDegrees: function (coordType, input) {
                if (isNaN(input.value)) {
                    return false;
                }
                var v = parseFloat(input.value);
                if ((v | 0) !== v) {
                    return false;
                }
                var min = Number(input.dataset.min);
                var max = Number(input.dataset.max);
                if (v < min || v > max) {
                    return false;
                }
                var inputMinutes = document.getElementById(this._addUID('GPmousePosition' + coordType + 'Minutes'));
                var inputSeconds = document.getElementById(this._addUID('GPmousePosition' + coordType + 'Seconds'));
                if (v >= max) {
                    inputMinutes.dataset.max = 0;
                    inputSeconds.dataset.max = 0;
                } else {
                    inputMinutes.dataset.max = 59;
                    inputSeconds.dataset.max = 59.9999;
                }
                return true;
            },
            GPdisplayCoords: function (coordinate) {
                if (coordinate && coordinate != null) {
                    var labelLon = document.getElementById(this._addUID('GPmousePositionLonLabel'));
                    var labelLat = document.getElementById(this._addUID('GPmousePositionLatLabel'));
                    if (coordinate.x || coordinate.y) {
                        labelLat.innerHTML = 'X : ';
                        labelLon.innerHTML = 'Y : ';
                    } else if (coordinate.e || coordinate.n) {
                        labelLat.innerHTML = 'E : ';
                        labelLon.innerHTML = 'N : ';
                    } else {
                        labelLat.innerHTML = 'Latitude : ';
                        labelLon.innerHTML = 'Longitude : ';
                    }
                    if (typeof coordinate.lat === 'object' && typeof coordinate.lng === 'object') {
                        var parts = {
                            lng: 'Lon',
                            lat: 'Lat'
                        };
                        var units = [
                            'Degrees',
                            'Minutes',
                            'Seconds'
                        ];
                        for (var p in parts) {
                            for (var u = 0; u < units.length; ++u) {
                                var selector = 'GPmousePosition' + parts[p] + units[u];
                                var elt = document.getElementById(this._addUID(selector));
                                var key = units[u].charAt(0).toLowerCase();
                                elt.value = coordinate[p][key];
                            }
                        }
                        document.getElementById(this._addUID('GPmousePositionLonDirection')).value = coordinate.lng.direction;
                        document.getElementById(this._addUID('GPmousePositionLatDirection')).value = coordinate.lat.direction;
                    } else {
                        var elLat = document.getElementById(this._addUID('GPmousePositionLat'));
                        var elLon = document.getElementById(this._addUID('GPmousePositionLon'));
                        elLat.value = coordinate.x || coordinate.lat || coordinate.e || '0';
                        elLon.value = coordinate.y || coordinate.lng || coordinate.lon || coordinate.n || '0';
                        var unit = coordinate.unit === undefined ? '' : coordinate.unit;
                        var elements = document.getElementsByClassName('GPmousePositionUnits');
                        for (var n = 0; n < elements.length; ++n) {
                            elements[n].innerHTML = unit;
                        }
                    }
                }
            },
            GPdisplayElevation: function (coordinate, altitudeTimeoutDelay, noDataValue, noDataValueTolerance) {
                var self = this;
                var altitudeTimeout;
                if (!altitudeTimeoutDelay) {
                    altitudeTimeoutDelay = 500;
                }
                clearTimeout(altitudeTimeout);
                document.getElementById(this._addUID('GPmousePositionAlt')).innerHTML = '...';
                if (noDataValue == null) {
                    noDataValue = -99999;
                }
                if (noDataValueTolerance == null) {
                    noDataValueTolerance = 99980;
                }
                var maxThreshold = noDataValue + noDataValueTolerance;
                var minThreshold = noDataValue - noDataValueTolerance;
                if (coordinate && coordinate != null) {
                    if (document.getElementById(this._addUID('GPmousePositionAltitude'))) {
                        altitudeTimeout = setTimeout(function () {
                            self.onRequestAltitude(coordinate, function (z) {
                                if (minThreshold < z && z < maxThreshold) {
                                    self.GPresetElevation();
                                } else {
                                    document.getElementById(self._addUID('GPmousePositionAlt')).innerHTML = z;
                                }
                            });
                        }, altitudeTimeoutDelay);
                    }
                }
            },
            GPresetElevation: function () {
                if (document.getElementById(this._addUID('GPmousePositionAltitude'))) {
                    document.getElementById(this._addUID('GPmousePositionAlt')).innerHTML = '---';
                }
            }
        };
        return MousePositionDOM;
    }();
    Ol3ControlsMousePosition = function (ol, proj4, woodman, Gp, Utils, Markers, RightManagement, SelectorID, MathUtils, MousePositionDOM) {
        function MousePosition(options) {
            options = options || {};
            if (!(this instanceof MousePosition)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            this._initialize(options);
            var container = this._initContainer(options);
            ol.control.Control.call(this, {
                element: container,
                target: options.target,
                render: options.render
            });
        }
        ol.inherits(MousePosition, ol.control.Control);
        MousePosition.prototype = Object.create(ol.control.Control.prototype, {});
        Utils.assign(MousePosition.prototype, MousePositionDOM);
        MousePosition.prototype.constructor = MousePosition;
        MousePosition.prototype.setMap = function (map) {
            var context = this;
            if (map) {
                var center = this._createMapCenter();
                map.getViewport().appendChild(center);
                if (!this.collapsed && !this._isDesktop) {
                    center.className = 'GPmapCenterVisible';
                }
                if (!this.collapsed) {
                    if (this._isDesktop) {
                        map.on('pointermove', this.onMouseMove, this);
                    } else {
                        map.on('moveend', this.onMapMove, this);
                    }
                }
                if (this.options.editCoordinates) {
                    var markerDiv = document.createElement('img');
                    markerDiv.id = this._addUID('GPmousePositionMarker');
                    markerDiv.src = this._markerUrl;
                    markerDiv.title = 'Cliquer pour supprimer';
                    markerDiv.addEventListener('click', function () {
                        context._markerOverlay.setPosition(undefined);
                    });
                    this._markerOverlay = new ol.Overlay({
                        offset: this._markerOffset,
                        element: markerDiv,
                        stopEvent: false
                    });
                    map.addOverlay(this._markerOverlay);
                }
            }
            ol.control.Control.prototype.setMap.call(this, map);
            if (map == null) {
                return;
            }
            if (!this.collapsed) {
                var inputShow = document.getElementById('GPshowMousePosition-' + this._uid);
                inputShow.checked = 'checked';
                this._setElevationPanel(this.options.displayAltitude);
                this._setCoordinatesPanel(this.options.displayCoordinates);
                if (!this.options.displayCoordinates) {
                    this._setSettingsPanel(false);
                }
            }
        };
        MousePosition.prototype.addSystem = function (system) {
            if (typeof system !== 'object') {
                console.log('[ERROR] MousePosition:addSystem - system parameter should be an object');
                return;
            }
            if (!system.crs) {
                return;
            }
            if (!system.label) {
                system.label = system.crs;
            }
            if (!system.type) {
                system.type = 'Metric';
            }
            var found = false;
            for (var j = 0; j < this._projectionSystems.length; j++) {
                var obj = this._projectionSystems[j];
                if (system.crs === obj.crs) {
                    found = true;
                }
            }
            system.code = this._projectionSystems.length;
            this._projectionSystems.push(system);
            var selectSystem = document.getElementById('GPmousePositionProjectionSystem-' + this._uid);
            if (selectSystem) {
                var option = document.createElement('option');
                option.value = system.code;
                option.text = system.label;
                selectSystem.appendChild(option);
            }
        };
        MousePosition.prototype.addSystems = function (systems) {
            if (!systems) {
                return;
            }
            if (!Array.isArray(systems)) {
                console.log('[ERROR] MousePosition:addSystems - systems parameter should be an array');
                return;
            }
            for (var i = 0; i < systems.length; i++) {
                this.addSystem(systems[i]);
            }
        };
        MousePosition.prototype.removeSystem = function (systemCrs) {
            if (!systemCrs || typeof systemCrs !== 'string') {
                console.log('[ERROR] MousePosition:removeSystem - systemCode parameter should be a string');
                return;
            }
            var systemList = document.getElementById('GPmousePositionProjectionSystem-' + this._uid);
            var systemCode = null;
            for (var i = 0; i < this._projectionSystems.length; i++) {
                var proj = this._projectionSystems[i];
                if (systemCrs === proj.crs) {
                    systemCode = proj.code;
                    this._projectionSystems.splice(i, 1);
                    break;
                }
            }
            if (systemCode == null) {
                console.log('[WARN] MousePosition:removeSystem - system not found');
                return;
            }
            var oldNewCodeMap = [];
            for (var j = 0; j < this._projectionSystems.length; j++) {
                oldNewCodeMap[Number(this._projectionSystems[j].code)] = j;
                this._projectionSystems[j].code = j;
            }
            var indexChildToRemove = null;
            for (var k = 0; k < systemList.childNodes.length; k++) {
                if (systemCode == systemList.childNodes[j].value) {
                    indexChildToRemove = k;
                    continue;
                }
                systemList.childNodes[j].value = oldNewCodeMap[Number(systemList.childNodes[j].value)];
            }
            if (indexChildToRemove != null) {
                systemList.removeChild(systemList.childNodes[indexChildToRemove]);
            }
            if (this._currentProjectionSystems.code == systemCode) {
                systemList.childNodes[0].setAttribute('selected', 'selected');
                this._setCurrentSystem(systemList.childNodes[0].value);
            }
        };
        MousePosition.prototype.setUnits = function (units) {
            if (!units || !Array.isArray(units)) {
                return;
            }
            this.options.units = units;
            this._projectionUnits = [];
            this._initProjectionUnits();
            if (this._currentProjectionType) {
                this._setTypeUnitsPanel(this._currentProjectionType);
            }
        };
        MousePosition.prototype.setAltitudeOptions = function (options) {
            if (!options || typeof options !== 'object') {
                return;
            }
            this.options.altitude.triggerDelay = options.triggerDelay;
            this.options.altitude.responseDelay = options.responseDelay;
            if (options.serviceOptions) {
                for (var opt in options.serviceOptions) {
                    if (options.serviceOptions.hasOwnProperty(opt)) {
                        this.options.altitude.serviceOptions[opt] = options.serviceOptions[opt];
                    }
                }
            }
        };
        MousePosition.prototype.displayAltitude = function (displayAltitude) {
            if (displayAltitude === undefined) {
                return;
            }
            if (typeof this._noRightManagement === 'undefined') {
                this._checkRightsManagement();
            }
            this.options.displayAltitude = displayAltitude;
            this._setElevationPanel(displayAltitude);
        };
        MousePosition.prototype.displayCoordinates = function (displayCoordinates) {
            if (displayCoordinates === undefined) {
                return;
            }
            this.options.displayCoordinates = displayCoordinates;
            this._setCoordinatesPanel(displayCoordinates);
            this._setSettingsPanel(displayCoordinates);
        };
        MousePosition.prototype.setCollapsed = function (collapsed) {
            if (collapsed === undefined) {
                console.log('[ERROR] MousePosition:setCollapsed - missing collapsed parameter');
                return;
            }
            if (collapsed && this.collapsed || !collapsed && !this.collapsed) {
                return;
            }
            if (!this._isDesktop) {
                document.getElementById('GPmapCenter').className = collapsed ? '' : 'GPmapCenterVisible';
            }
            this.onShowMousePositionClick();
            this._showMousePositionContainer.checked = !collapsed;
        };
        MousePosition.prototype._initialize = function (options) {
            this.options = options || {};
            this.options.collapsed = options.collapsed !== undefined ? options.collapsed : true;
            this.collapsed = this.options.collapsed;
            this._markerOverlay = null;
            this._markerUrl = null;
            this._markerOffset = [
                0,
                0
            ];
            this._hideMarker = false;
            this._initMarker(options.positionMarker);
            this.options.units = options.units || [];
            this.options.displayAltitude = options.displayAltitude !== undefined ? options.displayAltitude : true;
            this.options.displayCoordinates = options.displayCoordinates !== undefined ? options.displayCoordinates : true;
            if (this.options.displayCoordinates) {
                this.options.editCoordinates = options.editCoordinates !== undefined ? options.editCoordinates : false;
            } else {
                this.options.editCoordinates = false;
            }
            this.editing = false;
            this.options.systems = options.systems || [];
            if (options.altitude) {
                var altitude = options.altitude;
                this.options.altitude = {
                    triggerDelay: altitude.triggerDelay !== undefined ? altitude.triggerDelay : 200,
                    responseDelay: altitude.responseDelay !== undefined ? altitude.responseDelay : 500,
                    serviceOptions: altitude.serviceOptions || {},
                    noDataValue: altitude.noDataValue !== undefined ? altitude.noDataValue : -99999,
                    noDataValueTolerance: altitude.noDataValueTolerance !== undefined ? altitude.noDataValueTolerance : 90000
                };
            } else {
                this.options.altitude = {
                    triggerDelay: 200,
                    responseDelay: 500,
                    serviceOptions: {}
                };
            }
            this._uid = SelectorID.generate();
            this._projectionSystems = [];
            this._initProjectionSystems();
            this._projectionUnits = {};
            this._initProjectionUnits();
            this._isDesktop = Utils.detectSupport();
            if (this.options.altitude.triggerDelay < 100) {
                this.options.altitude.triggerDelay = 100;
            }
            this._timer = this.options.altitude.triggerDelay;
            this._currentProjectionSystems = this._projectionSystems[0];
            this._currentProjectionType = this._projectionSystems[0].type;
            this._currentProjectionUnits = this._projectionUnits[this._currentProjectionType][0].code;
            this._projectionUnitsContainer = null;
            this._showMousePositionContainer = null;
            if (!this.options.displayAltitude && !this.options.displayCoordinates) {
                this.options.displayCoordinates = true;
            }
            if (this.options.displayAltitude) {
                this._checkRightsManagement();
            }
        };
        MousePosition.prototype._initMarker = function (option) {
            if (!this.options.editCoordinates) {
                return;
            }
            if (!option) {
                this._markerUrl = Markers['lightOrange'];
                this._markerOffset = Markers.defaultOffset;
                return;
            }
            this._hideMarker = option.hide !== undefined ? option.hide : false;
            if (option.offset) {
                if (Array.isArray(option.offset) && option.offset.length === 2) {
                    this._markerOffset = option.offset;
                } else {
                    console.log('positionMarker.offset should be an array. e.g. : [0,0]');
                    this._markerOffset = Markers.defaultOffset;
                }
            } else {
                this._markerOffset = Markers.defaultOffset;
            }
            var url = option.url;
            if (!url) {
                this._markerUrl = Markers['lightOrange'];
            } else if (url.match(/^[a-zA-Z]+$/)) {
                this._markerUrl = Markers[url] !== undefined ? Markers[url] : Markers['lightOrange'];
            } else {
                this._markerUrl = url;
            }
        };
        MousePosition.prototype._initProjectionSystems = function () {
            var projectionSystemsByDefault = [
                {
                    label: 'Géographique',
                    crs: ol.proj.get('EPSG:4326').getCode(),
                    type: 'Geographical'
                },
                {
                    label: 'Web Mercator',
                    crs: ol.proj.get('EPSG:3857').getCode(),
                    type: 'Metric'
                },
                {
                    label: 'Lambert 93',
                    crs: ol.proj.get('EPSG:2154').getCode(),
                    type: 'Metric',
                    geoBBox: {
                        left: -9.86,
                        bottom: 41.15,
                        right: 10.38,
                        top: 51.56
                    }
                },
                {
                    label: 'Lambert II étendu',
                    crs: ol.proj.get('EPSG:27572'),
                    type: 'Metric',
                    geoBBox: {
                        left: -4.87,
                        bottom: 42.33,
                        right: 8.23,
                        top: 51.14
                    }
                }
            ];
            var systems = this.options.systems;
            for (var i = 0; i < systems.length; i++) {
                var sys = systems[i];
                this.addSystem(sys);
            }
            if (this._projectionSystems.length === 0) {
                for (var j = 0; j < projectionSystemsByDefault.length; j++) {
                    this.addSystem(projectionSystemsByDefault[j]);
                }
            }
        };
        MousePosition.prototype._initProjectionUnits = function () {
            var projectionUnitsByDefault = {
                Geographical: [
                    {
                        code: 'DEC',
                        label: 'degrés décimaux',
                        format: this._displayDEC
                    },
                    {
                        code: 'DMS',
                        label: 'degrés sexagésimaux',
                        format: this._displayDMS
                    },
                    {
                        code: 'RAD',
                        label: 'radians',
                        format: this._displayRAD
                    },
                    {
                        code: 'GON',
                        label: 'grades',
                        format: this._displayGON
                    }
                ],
                Metric: [
                    {
                        code: 'M',
                        label: 'mètres',
                        format: this._displayMeter
                    },
                    {
                        code: 'KM',
                        label: 'kilomètres',
                        format: this._displayKMeter
                    }
                ]
            };
            var units = this.options.units;
            for (var type in projectionUnitsByDefault) {
                if (projectionUnitsByDefault.hasOwnProperty(type)) {
                    var found = false;
                    for (var j = 0; j < projectionUnitsByDefault[type].length; j++) {
                        var obj = projectionUnitsByDefault[type][j];
                        for (var i = 0; i < units.length; i++) {
                            var unit = units[i];
                            if (obj.code === unit) {
                                found = true;
                                if (!this._projectionUnits[type]) {
                                    this._projectionUnits[type] = [];
                                }
                                this._projectionUnits[type].push(obj);
                            }
                        }
                    }
                    if (!found) {
                        this._projectionUnits[type] = projectionUnitsByDefault[type];
                    }
                }
            }
            if (typeof this._projectionUnits === 'object' && Object.keys(this._projectionUnits).length === 0) {
                this._projectionUnits = projectionUnitsByDefault;
            }
        };
        MousePosition.prototype._getCurrentProjectionInformation = function () {
            var systemInfo = [
                this._currentProjectionSystems.label,
                'en'
            ];
            var units = this._projectionUnits[this._currentProjectionType];
            for (var u = 0; u < units.length; ++u) {
                if (units[u].code === this._currentProjectionUnits) {
                    systemInfo.push(units[u].label);
                    break;
                }
            }
            return systemInfo.join(' ');
        };
        MousePosition.prototype._checkRightsManagement = function () {
            var rightManagement = RightManagement.check({
                key: this.options.apiKey,
                resources: ['SERVICE_CALCUL_ALTIMETRIQUE_RSC'],
                services: ['Elevation']
            });
            this._noRightManagement = !rightManagement;
            if (!this.options.apiKey) {
                this.options.apiKey = rightManagement.key;
            }
        };
        MousePosition.prototype._initContainer = function () {
            var container = this._createMainContainerElement();
            var inputShow = this._showMousePositionContainer = this._createShowMousePositionElement();
            container.appendChild(inputShow);
            var picto = this._createShowMousePositionPictoElement(this._isDesktop);
            container.appendChild(picto);
            var panel = this._createMousePositionPanelElement(this.options.displayAltitude, this.options.displayCoordinates, this.options.editCoordinates, this._currentProjectionUnits);
            var settings = this._createMousePositionSettingsElement();
            var systems = this._projectionSystemsContainer = this._createMousePositionSettingsSystemsElement(this._projectionSystems);
            var units = this._projectionUnitsContainer = this._createMousePositionSettingsUnitsElement(this._projectionUnits[this._currentProjectionType]);
            settings.appendChild(systems);
            settings.appendChild(units);
            panel.appendChild(settings);
            container.appendChild(panel);
            return container;
        };
        MousePosition.prototype._setElevationPanel = function (active) {
            var div = null;
            if (!active) {
                div = document.getElementById('GPmousePositionAltitude-' + this._uid);
                div.style.display = 'none';
            } else {
                if (this._noRightManagement) {
                    div = document.getElementById('GPmousePositionAlt-' + this._uid);
                    div.innerHTML = 'No rights!';
                } else {
                    div = document.getElementById('GPmousePositionAltitude-' + this._uid);
                    div.style.display = '';
                }
            }
        };
        MousePosition.prototype._setCoordinatesPanel = function (active) {
            var div = document.getElementById('GPmousePositionCoordinate-' + this._uid);
            if (!active) {
                div.style.display = 'none';
            } else {
                div.style.display = '';
            }
        };
        MousePosition.prototype._setSettingsPanel = function (active) {
            var divPicto = document.getElementById('GPshowMousePositionSettingsPicto-' + this._uid);
            var divPanel = document.getElementById('GPmousePositionSettings-' + this._uid);
            if (!active) {
                divPicto.style.display = 'none';
                divPanel.style.display = 'none';
            } else {
                divPicto.style.display = '';
                divPanel.style.display = '';
            }
        };
        MousePosition.prototype._setTypeUnitsPanel = function (type) {
            var container = this._projectionUnitsContainer;
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }
            var units = this._projectionUnits[type];
            for (var j = 0; j < units.length; j++) {
                var obj = units[j];
                var option = document.createElement('option');
                option.value = obj.code ? obj.code : j;
                option.text = obj.label || j;
                container.appendChild(option);
            }
            var projectionUnits = this._projectionUnits[type][0].code;
            if (this._currentProjectionUnits === 'DMS' || projectionUnits === 'DMS') {
                this._resetCoordinateElements(this.options.editCoordinates, type, projectionUnits);
                this._setEditMode(this.editing);
            }
            this._currentProjectionType = type;
            this._resetLabelElements(type);
            this._resetUnitElements(projectionUnits);
            this._currentProjectionUnits = projectionUnits;
        };
        MousePosition.prototype._displayDEC = function (olCoordinate) {
            var coordinate = {};
            coordinate.lat = olCoordinate[1].toFixed(6);
            coordinate.lng = olCoordinate[0].toFixed(6);
            coordinate.unit = '\xB0';
            return coordinate;
        };
        MousePosition.prototype._displayDMS = function (olCoordinate) {
            return {
                lng: MathUtils.decimalToDMS(olCoordinate[0], 'EO', 2),
                lat: MathUtils.decimalToDMS(olCoordinate[1], 'NS', 2),
                unit: 'DMS'
            };
        };
        MousePosition.prototype._displayRAD = function (olCoordinate) {
            var coordinate = {};
            var d = 0.017453292519943295;
            coordinate.lng = olCoordinate[0] * d;
            coordinate.lng = coordinate.lng.toFixed(8);
            coordinate.lat = olCoordinate[1] * d;
            coordinate.lat = coordinate.lat.toFixed(8);
            coordinate.unit = 'rad';
            return coordinate;
        };
        MousePosition.prototype._displayGON = function (olCoordinate) {
            var coordinate = {};
            var d = 1.1111111111111112;
            coordinate.lng = olCoordinate[0] * d;
            coordinate.lng = coordinate.lng.toFixed(8);
            coordinate.lat = olCoordinate[1] * d;
            coordinate.lat = coordinate.lat.toFixed(8);
            coordinate.unit = 'gon';
            return coordinate;
        };
        MousePosition.prototype._displayMeter = function (olCoordinate) {
            var coordinate = {};
            coordinate.x = olCoordinate[0].toFixed(2);
            coordinate.y = olCoordinate[1].toFixed(2);
            coordinate.unit = 'm';
            return coordinate;
        };
        MousePosition.prototype._displayKMeter = function (olCoordinate) {
            var coordinate = {};
            coordinate.x = (olCoordinate[0] / 1000).toFixed(2);
            coordinate.y = (olCoordinate[1] / 1000).toFixed(2);
            coordinate.unit = 'km';
            return coordinate;
        };
        MousePosition.prototype._setCoordinate = function (olCoordinate, crs) {
            var coordinate = {};
            var oSrs = this._currentProjectionSystems.crs;
            if (!oSrs) {
                console.log('ERROR : system crs not found');
                return;
            }
            olCoordinate = ol.proj.transform(olCoordinate, crs, oSrs);
            var type = this._currentProjectionSystems.type;
            var format = null;
            var units = this._projectionUnits[type];
            for (var i = 0; i < units.length; i++) {
                if (units[i].code === this._currentProjectionUnits) {
                    format = units[i].format;
                    break;
                }
            }
            if (!format || typeof format !== 'function') {
                console.log('WARNING : coordinates format function not found');
                return;
            } else {
                coordinate = format(olCoordinate);
            }
            if (!coordinate || Object.keys(coordinate).length === 0) {
                return;
            }
            this.GPdisplayCoords(coordinate);
        };
        MousePosition.prototype._setElevation = function (olCoordinate) {
            var delay = this.options.altitude.responseDelay;
            var noDataValue = this.options.altitude.noDataValue;
            var noDataValueTolerance = this.options.altitude.noDataValueTolerance;
            this.GPdisplayElevation(olCoordinate, delay, noDataValue, noDataValueTolerance);
        };
        MousePosition.prototype.onMoveStopped = function (olCoordinate, crs) {
            var oLatLng = ol.proj.transform(olCoordinate, crs, 'EPSG:4326');
            this._setElevation(oLatLng);
        };
        MousePosition.prototype.onMouseMove = function (e) {
            var self = this;
            var coordinate = e.coordinate;
            if (!e.map || !e.map.getView()) {
                return;
            }
            var crs = e.map.getView().getProjection();
            this._setCoordinate(coordinate, crs);
            clearTimeout(this._timer);
            this._timer = setTimeout(function () {
                self.onMoveStopped(coordinate, crs);
            }, this.options.altitude.triggerDelay);
        };
        MousePosition.prototype.onMapMove = function () {
            var self = this;
            var map = this.getMap();
            if (!map || !map.getView()) {
                return;
            }
            var view = map.getView();
            var coordinate = view.getCenter();
            var crs = view.getProjection();
            this._setCoordinate(coordinate, crs);
            clearTimeout(this._timer);
            this._timer = setTimeout(function () {
                self.onMoveStopped(coordinate, crs);
            }, this.options.altitude.triggerDelay);
        };
        MousePosition.prototype.onRequestAltitude = function (coordinate, callback) {
            if (!coordinate || Object.keys(coordinate).length === 0) {
                return;
            }
            if (!this.options.displayAltitude) {
                return;
            }
            if (this._noRightManagement) {
                console.log('[WARNING] contract key configuration has no rights to load geoportal elevation ');
                document.getElementById('GPmousePositionAlt-' + this._uid).innerHTML = 'No rights!';
                return;
            }
            var options = this.options.altitude.serviceOptions || {};
            var _protocol = options.protocol || 'XHR';
            var _timeout = options.timeOut || 0;
            if (_protocol === 'JSONP' && _timeout === 0) {
                _timeout = 15000;
            }
            var _zonly = true;
            var _positions = [{
                    lon: coordinate[0],
                    lat: coordinate[1]
                }];
            var _scope = this;
            var _rawResponse = options.rawResponse || false;
            var _onSuccess = null;
            var _onFailure = null;
            if (!_rawResponse) {
                _onSuccess = function (results) {
                    if (results && Object.keys(results)) {
                        callback.call(this, results.elevations[0].z);
                    }
                };
            } else {
                _onSuccess = function (results) {
                    console.log('alti service raw response : ', results);
                };
            }
            _onFailure = function (error) {
                console.log('[getAltitude] ERROR : ' + error.message);
            };
            var _apiKey = options.apiKey || this.options.apiKey;
            Gp.Services.getAltitude({
                apiKey: _apiKey,
                protocol: _protocol,
                timeOut: _timeout,
                scope: _scope,
                rawResponse: _rawResponse,
                onSuccess: _onSuccess,
                onFailure: _onFailure,
                zonly: _zonly,
                positions: _positions
            });
        };
        MousePosition.prototype.onShowMousePositionClick = function () {
            var map = this.getMap();
            this.collapsed = this._showMousePositionContainer.checked;
            this.dispatchEvent('change:collapsed');
            if (this._showMousePositionContainer.checked) {
                if (this._isDesktop) {
                    map.un('pointermove', this.onMouseMove, this);
                } else {
                    map.un('moveend', this.onMapMove, this);
                }
            } else if (!this.editing) {
                if (this._isDesktop) {
                    map.on('pointermove', this.onMouseMove, this);
                } else {
                    map.on('moveend', this.onMapMove, this);
                    this.onMapMove();
                }
            }
            this._setElevationPanel(this.options.displayAltitude);
            this._setCoordinatesPanel(this.options.displayCoordinates);
            if (!this.options.displayCoordinates) {
                this._setSettingsPanel(false);
            }
        };
        MousePosition.prototype.onMousePositionEditModeClick = function (editing) {
            if (!this.options.editCoordinates) {
                return;
            }
            if (this.editing === editing) {
                return;
            }
            this.editing = editing;
            this._setEditMode(this.editing);
            var map = this.getMap();
            if (this._isDesktop) {
                if (this.editing) {
                    map.un('pointermove', this.onMouseMove, this);
                } else {
                    map.on('pointermove', this.onMouseMove, this);
                    this.onMapMove();
                }
            } else {
                if (this.editing) {
                    map.un('moveend', this.onMapMove, this);
                } else {
                    map.on('moveend', this.onMapMove, this);
                    this.onMapMove();
                }
            }
            if (!this.editing && this._markerOverlay) {
                this._markerOverlay.setPosition(undefined);
            }
        };
        MousePosition.prototype.getCoordinate = function (coordType) {
            var inputDegrees = document.getElementById(this._addUID('GPmousePosition' + coordType + 'Degrees'));
            var degrees = inputDegrees.value;
            if (!degrees) {
                return null;
            }
            degrees = degrees.replace(',', '.');
            if (!MathUtils.isInteger(degrees)) {
                return null;
            }
            var result = MathUtils.toInteger(degrees);
            if (result < Number(inputDegrees.dataset.min) || result > Number(inputDegrees.dataset.max)) {
                return null;
            }
            var direction = document.getElementById(this._addUID('GPmousePosition' + coordType + 'Direction')).value;
            var inputMinutes = document.getElementById(this._addUID('GPmousePosition' + coordType + 'Minutes'));
            var minutes = inputMinutes.value;
            if (minutes) {
                minutes = minutes.replace(',', '.');
                if (MathUtils.isInteger(minutes)) {
                    var mins = MathUtils.toInteger(minutes);
                    if (mins >= Number(inputMinutes.dataset.min) && mins <= Number(inputMinutes.dataset.max)) {
                        result += mins / 60;
                    }
                }
            }
            var inputSeconds = document.getElementById(this._addUID('GPmousePosition' + coordType + 'Seconds'));
            var seconds = inputSeconds.value;
            if (seconds) {
                seconds = seconds.replace(',', '.');
                var secs = MathUtils.toFloat(seconds);
                if (secs && secs >= Number(inputSeconds.dataset.min) && secs <= Number(inputSeconds.dataset.max)) {
                    result += secs / 3600;
                }
            }
            if (direction === 'O' || direction === 'S') {
                result = -result;
            }
            return result;
        };
        MousePosition.prototype.locateDMSCoordinates = function () {
            var lonlat = [
                this.getCoordinate('Lon'),
                this.getCoordinate('Lat')
            ];
            if (lonlat[0] === null || lonlat[1] === null) {
                return;
            }
            var oSrs = this._currentProjectionSystems.crs;
            if (!oSrs) {
                console.log('ERROR : system crs not found');
                return;
            }
            var view = this.getMap().getView();
            var coordinate = ol.proj.transform(lonlat, oSrs, view.getProjection());
            view.setCenter(coordinate);
            if (this._markerOverlay && !this._hideMarker) {
                this._markerOverlay.setPosition(coordinate);
            }
        };
        MousePosition.prototype.locateCoordinates = function () {
            var lon = document.getElementById(this._addUID('GPmousePositionLon')).value;
            lon = lon.replace(',', '.');
            lon = MathUtils.toFloat(lon);
            if (lon === null) {
                return;
            }
            var lat = document.getElementById(this._addUID('GPmousePositionLat')).value;
            lat = lat.replace(',', '.');
            lat = MathUtils.toFloat(lat);
            if (lat === null) {
                return;
            }
            var oSrs = this._currentProjectionSystems.crs;
            if (!oSrs) {
                console.log('ERROR : system crs not found');
                return;
            }
            var xy;
            if (this._currentProjectionSystems.type === 'Geographical') {
                xy = [
                    this.convert(lon),
                    this.convert(lat)
                ];
            } else {
                xy = [
                    this.convert(lat),
                    this.convert(lon)
                ];
            }
            var xyWGS84 = ol.proj.transform(xy, this._currentProjectionSystems.crs, 'EPSG:4326');
            var geoBBox = this._currentProjectionSystems.geoBBox;
            if (geoBBox) {
                var extent = [
                    geoBBox.left,
                    geoBBox.bottom,
                    geoBBox.right,
                    geoBBox.top
                ];
                if (xyWGS84[0] < extent[0] || xyWGS84[0] > extent[2]) {
                    return;
                }
                if (xyWGS84[1] < extent[1] || xyWGS84[1] > extent[3]) {
                    return;
                }
            }
            var view = this.getMap().getView();
            var coordinate = ol.proj.transform(xy, oSrs, view.getProjection());
            view.setCenter(coordinate);
            if (this._markerOverlay && !this._hideMarker) {
                this._markerOverlay.setPosition(coordinate);
            }
        };
        MousePosition.prototype.onMousePositionEditModeLocateClick = function () {
            if (!this.options.editCoordinates) {
                return;
            }
            if (!this.editing) {
                this.onMousePositionEditModeClick(true);
                return;
            }
            if (this._currentProjectionUnits === 'DMS') {
                this.locateDMSCoordinates();
            } else {
                this.locateCoordinates();
            }
        };
        MousePosition.prototype.onMousePositionProjectionSystemChange = function (e) {
            var idx = e.target.selectedIndex;
            var value = e.target.options[idx].value;
            this._setCurrentSystem(value);
        };
        MousePosition.prototype._setCurrentSystem = function (systemCode) {
            var type = null;
            for (var i = 0; i < this._projectionSystems.length; ++i) {
                if (this._projectionSystems[i].code == systemCode) {
                    type = this._projectionSystems[i].type;
                    break;
                }
            }
            if (!type) {
                return;
            }
            this._currentProjectionSystems = this._projectionSystems[Number(systemCode)];
            if (type !== this._currentProjectionType) {
                this._setTypeUnitsPanel(type);
            }
            if (!this._isDesktop) {
                this.onMapMove();
            }
        };
        MousePosition.prototype.onMousePositionProjectionSystemMouseOver = function (e) {
            var map = this.getMap();
            if (!map || !map.getView()) {
                return;
            }
            var view = map.getView();
            var crs = view.getProjection();
            var mapExtent = view.calculateExtent(map.getSize());
            mapExtent = ol.proj.transformExtent(mapExtent, crs, 'EPSG:4326');
            var systemList = document.getElementById(this._addUID('GPmousePositionProjectionSystem'));
            systemList.innerHTML = '';
            for (var j = 0; j < this._projectionSystems.length; j++) {
                var proj = this._projectionSystems[j];
                var option = null;
                if (proj.geoBBox) {
                    if (mapExtent[0] > proj.geoBBox.right || mapExtent[1] > proj.geoBBox.top || mapExtent[2] < proj.geoBBox.left || mapExtent[3] < proj.geoBBox.bottom) {
                        if (proj === this._currentProjectionSystems) {
                            option = document.createElement('option');
                            option.value = proj.code;
                            option.text = proj.label || j;
                            option.setAttribute('selected', 'selected');
                            option.setAttribute('disabled', 'disabled');
                            systemList.appendChild(option);
                        }
                        continue;
                    }
                }
                var optionElement = document.createElement('option');
                optionElement.value = proj.code;
                optionElement.text = proj.label || j;
                if (proj === this._currentProjectionSystems) {
                    optionElement.setAttribute('selected', 'selected');
                }
                systemList.appendChild(optionElement);
            }
        };
        MousePosition.prototype.onMousePositionProjectionUnitsChange = function (e) {
            var idx = e.target.selectedIndex;
            var value = e.target.options[idx].value;
            var oldProjectionUnits = this._currentProjectionUnits;
            this._currentProjectionUnits = value;
            this._resetLabelElements(this._currentProjectionType);
            this._resetUnitElements(this._currentProjectionUnits);
            if (oldProjectionUnits === 'DMS' || this._currentProjectionUnits === 'DMS') {
                this._resetCoordinateElements(this.options.editCoordinates, this._currentProjectionType, this._currentProjectionUnits);
                this._setEditMode(this.editing);
            }
            if (!this._isDesktop) {
                this.onMapMove();
            }
        };
        MousePosition.prototype.convert = function (value) {
            var result;
            if (this._currentProjectionUnits === 'M' || this._currentProjectionUnits === 'DEC') {
                result = value;
            } else if (this._currentProjectionUnits === 'KM') {
                result = value * 1000;
            } else if (this._currentProjectionUnits === 'RAD') {
                var rd = (180 / Math.PI).toFixed(20);
                result = (value * rd).toFixed(20);
            } else if (this._currentProjectionUnits === 'GON') {
                var d = (9 / 10).toFixed(20);
                result = (value * d).toFixed(20);
            }
            return result;
        };
        MousePosition.prototype.validateExtentCoordinate = function (coordType, value) {
            if ([
                    'Lon',
                    'Lat'
                ].indexOf(coordType) === -1) {
                return false;
            }
            var coord = value.replace(',', '.');
            coord = MathUtils.toFloat(coord);
            if (coord === null) {
                return false;
            }
            coord = this.convert(coord);
            var geoBBox = this._currentProjectionSystems.geoBBox;
            if (geoBBox === undefined) {
                return true;
            }
            var extent = [
                geoBBox.left,
                geoBBox.bottom,
                geoBBox.right,
                geoBBox.top
            ];
            extent = ol.proj.transformExtent(extent, 'EPSG:4326', this._currentProjectionSystems.crs);
            if (coordType === 'Lat' && (coord < extent[0] || coord > extent[2])) {
                return false;
            }
            if (coordType === 'Lon' && (coord < extent[1] || coord > extent[3])) {
                return false;
            }
            return true;
        };
        return MousePosition;
    }(ol, proj4, {}, gp, CommonUtils, Ol3ControlsUtilsMarkers, CommonUtilsCheckRightManagement, CommonUtilsSelectorID, CommonUtilsMathUtils, CommonControlsMousePositionDOM);
    Ol3ControlsUtilsInteractions = function (ol, woodman, Utils) {
        var Interactions = {
            _extensions: [
                'Measures',
                'ElevationPath',
                'Drawing'
            ],
            _options: {
                current: null,
                clean: null
            },
            unset: function (map, options) {
                var opts = {};
                Utils.mergeParams(opts, this._options);
                Utils.mergeParams(opts, options);
                var interactions = map.getInteractions().getArray();
                for (var i = 0; i < interactions.length; i++) {
                    if (interactions[i].getActive() && interactions[i] instanceof ol.interaction.Draw) {
                        var prop = interactions[i].getProperties();
                        var name = prop.name;
                        if (typeof name !== 'undefined' && this._extensions.indexOf(name) > -1) {
                            if (opts.current && opts.current === name) {
                                continue;
                            }
                            interactions[i].setActive(false);
                            var source = prop.source;
                            if (typeof source !== 'undefined' && source instanceof ol.control.Control) {
                                for (var action in opts) {
                                    if (opts.hasOwnProperty(action)) {
                                        if (action === 'current') {
                                            continue;
                                        }
                                        if (typeof source[action] === 'function') {
                                            var args = Array.isArray(opts[action]) ? opts[action] : [opts[action]];
                                            source[action].apply(source, args);
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        };
        return Interactions;
    }(ol, {}, CommonUtils);
    CommonControlsDrawingDOM = function () {
        var DrawingDOM = {
            _addUID: function (id) {
                var uid = this._uid ? id + '-' + this._uid : id;
                return uid;
            },
            _createMainContainerElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GPdrawing');
                container.className = 'GPwidget';
                return container;
            },
            _createShowDrawingElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPshowDrawing');
                input.className = 'GPshowDrawing';
                input.type = 'checkbox';
                return input;
            },
            _createShowDrawingPictoElement: function () {
                var self = this;
                var label = document.createElement('label');
                label.id = this._addUID('GPshowDrawingPicto');
                label.className = 'GPshowAdvancedToolPicto';
                label.htmlFor = this._addUID('GPshowDrawing');
                label.title = this.options.labels.control;
                if (label.addEventListener) {
                    label.addEventListener('click', function (e) {
                        self.onShowDrawingClick(e);
                    });
                } else if (label.attachEvent) {
                    label.attachEvent('onclick', function (e) {
                        self.onShowDrawingClick(e);
                    });
                }
                var spanOpen = document.createElement('span');
                spanOpen.id = this._addUID('GPshowDrawingOpen');
                spanOpen.className = 'GPshowAdvancedToolOpen';
                label.appendChild(spanOpen);
                return label;
            },
            _createDrawingPanelElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPdrawingPanel');
                div.className = 'GPpanel';
                div.appendChild(this._createDrawingPanelHeaderElement());
                this.dtOptions = {};
                if (this.options.tools.points) {
                    this.dtOptions.points = {
                        label: this.options.labels.points,
                        active: false,
                        panel: 'draw',
                        id: 'point'
                    };
                }
                if (this.options.tools.lines) {
                    this.dtOptions.lines = {
                        label: this.options.labels.lines,
                        active: false,
                        panel: 'draw',
                        id: 'line'
                    };
                }
                if (this.options.tools.polygons) {
                    this.dtOptions.polygons = {
                        label: this.options.labels.polygons,
                        active: false,
                        panel: 'draw',
                        id: 'polygon'
                    };
                }
                if (this.options.tools.text) {
                    this.dtOptions.text = {
                        label: this.options.labels.text,
                        active: false,
                        panel: 'draw',
                        id: 'text'
                    };
                }
                if (this.options.tools.edit) {
                    this.dtOptions.edit = {
                        label: this.options.labels.edit,
                        active: false,
                        panel: 'edit',
                        id: 'edit'
                    };
                }
                if (this.options.tools.display) {
                    this.dtOptions.display = {
                        label: this.options.labels.display,
                        active: false,
                        panel: 'edit',
                        id: 'display'
                    };
                }
                if (this.options.tools.tooltip) {
                    this.dtOptions.tooltip = {
                        label: this.options.labels.tooltip,
                        active: false,
                        panel: 'edit',
                        id: 'tooltip'
                    };
                }
                if (this.options.tools.remove) {
                    this.dtOptions.remove = {
                        label: this.options.labels.remove,
                        active: false,
                        panel: 'edit',
                        id: 'remove'
                    };
                }
                if (this.dtOptions.points || this.dtOptions.lines || this.dtOptions.polygons || this.dtOptions.text) {
                    div.appendChild(this._createDrawingToolSection(this.options.labels.creatingTools, 'draw'));
                }
                if (this.dtOptions.edit || this.dtOptions.display || this.dtOptions.tooltip || this.dtOptions.remove) {
                    div.appendChild(this._createDrawingToolSection(this.options.labels.editingTools, 'edit'));
                }
                if (this.options.tools.export) {
                    div.appendChild(this._createSavingSection(this.options.labels.export, this.options.labels.exportTitle));
                }
                return div;
            },
            _createDrawingPanelHeaderElement: function () {
                var container = document.createElement('div');
                container.className = 'GPpanelHeader';
                var divTitle = document.createElement('div');
                divTitle.className = 'GPpanelTitle';
                divTitle.innerHTML = this.options.controlLabel || 'Annoter la carte';
                container.appendChild(divTitle);
                var divClose = document.createElement('div');
                divClose.id = this._addUID('GPdrawingPanelClose');
                divClose.className = 'GPpanelClose';
                divClose.title = 'Fermer le panneau';
                var dtObj = this;
                if (divClose.addEventListener) {
                    divClose.addEventListener('click', function () {
                        document.getElementById(dtObj._addUID('GPshowDrawingPicto')).click();
                    }, false);
                } else if (divClose.attachEvent) {
                    divClose.attachEvent('onclick', function () {
                        document.getElementById(dtObj._addUID('GPshowDrawingPicto')).click();
                    });
                }
                container.appendChild(divClose);
                return container;
            },
            _createDrawingToolSection: function (sectionLabel, panelType) {
                var container = document.createElement('div');
                container.className = 'drawing-tool-section';
                var p = document.createElement('p');
                p.className = 'drawing-tool-section-title';
                p.innerHTML = sectionLabel;
                container.appendChild(p);
                var ul = document.createElement('ul');
                ul.className = 'drawing-tools-flex-display';
                var context = this;
                function liClickHandler(e) {
                    context._handleDOMToolClick(e, this.id, context);
                    context._handleToolClick(e, this.id, context);
                }
                for (var type in this.dtOptions) {
                    if (this.dtOptions[type].panel != panelType) {
                        continue;
                    }
                    var li = document.createElement('li');
                    li.className = 'drawing-tool';
                    li.id = this._addUID('drawing-tool-' + this.dtOptions[type].id);
                    li.title = this.dtOptions[type].label;
                    li.addEventListener('click', liClickHandler);
                    ul.appendChild(li);
                }
                container.appendChild(ul);
                return container;
            },
            _createSavingSection: function (buttonLabel, buttonTitle) {
                var container = document.createElement('div');
                container.className = 'drawing-tool-section drawing-tools-flex-display';
                var button = document.createElement('button');
                button.title = buttonTitle;
                button.className = 'tool-form-submit drawing-button';
                button.id = this._addUID('drawing-export');
                button.type = 'button';
                button.textContent = buttonLabel;
                var context = this;
                button.onclick = function () {
                    context.onExportFeatureClick();
                };
                container.appendChild(button);
                return container;
            },
            rgbaToHex: function (rgba) {
                function hex(number) {
                    if (number > 255) {
                        throw '\'' + number + '\'\' is greater than 255(0xff);';
                    }
                    var str = Number(number).toString(16);
                    return ('0' + str).slice(-2);
                }
                var regex = /rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(0?.?\d+)\s*)?\)/;
                var parsed = regex.exec(rgba);
                if (!parsed) {
                    throw 'Invalid format: ' + rgba;
                }
                var red = parsed[1];
                var green = parsed[2];
                var blue = parsed[3];
                var alpha = parsed[4];
                var elems = [
                    hex(red),
                    hex(green),
                    hex(blue)
                ];
                var result = {};
                result.hex = '#' + elems.join('');
                if (alpha) {
                    result.opacity = parseFloat(alpha);
                }
                return result;
            },
            hexToRgba: function (hex, opacity) {
                var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
                hex = hex.replace(shorthandRegex, function (m, r, g, b) {
                    return r + r + g + g + b + b;
                });
                var rgb = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                rgb = rgb ? {
                    r: parseInt(rgb[1], 16),
                    g: parseInt(rgb[2], 16),
                    b: parseInt(rgb[3], 16)
                } : null;
                var result = rgb ? 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + opacity + ')' : null;
                return result;
            },
            _createMarkersChooser: function (options) {
                var li = document.createElement('li');
                li.className = options.className;
                for (var i = 0; i < this.options.markersList.length; i++) {
                    var inputElem = document.createElement('input');
                    inputElem.type = 'radio';
                    inputElem.name = 'marker';
                    inputElem.id = this._addUID('marker-' + i);
                    inputElem.value = this.options.markersList[i].src;
                    inputElem.className = 'marker-input-radio';
                    if (options.defaultValue == inputElem.value) {
                        inputElem.checked = true;
                    }
                    li.appendChild(inputElem);
                    var labelElem = document.createElement('label');
                    labelElem.className = 'marker-label';
                    labelElem.setAttribute('for', inputElem.id);
                    var imgElem = document.createElement('img');
                    imgElem.src = inputElem.value;
                    labelElem.appendChild(imgElem);
                    li.appendChild(labelElem);
                }
                return li;
            },
            _createStylingElement: function (options) {
                var li = document.createElement('li');
                li.className = options.className;
                var textNode = document.createTextNode(options.label);
                li.appendChild(textNode);
                var inputElem = document.createElement('input');
                try {
                    inputElem.type = options.type;
                } catch (e) {
                    inputElem.type = 'text';
                }
                inputElem.id = options.id;
                inputElem.value = options.defaultValue;
                if (options.title) {
                    inputElem.title = options.title;
                }
                if (options.min !== undefined) {
                    inputElem.min = options.min;
                }
                if (options.max !== undefined) {
                    inputElem.max = options.max;
                }
                if (options.step !== undefined) {
                    inputElem.step = options.step;
                }
                li.appendChild(inputElem);
                return li;
            },
            _createStylingDiv: function (options) {
                var div = document.createElement('div');
                div.className = 'gp-styling-div';
                var ul = document.createElement('ul');
                var li = null;
                switch (options.geomType.toLowerCase()) {
                case 'point':
                    li = this._createMarkersChooser({
                        className: 'gp-styling-option',
                        defaultValue: options.initValues.markerSrc
                    });
                    ul.appendChild(li);
                    break;
                case 'text':
                    li = this._createStylingElement({
                        type: 'color',
                        className: 'gp-styling-option',
                        label: this.options.labels.fillColor,
                        id: this._addUID('fillColor'),
                        defaultValue: options.initValues.fillColor
                    });
                    ul.appendChild(li);
                    li = this._createStylingElement({
                        type: 'color',
                        className: 'gp-styling-option',
                        label: this.options.labels.strokeColor,
                        id: this._addUID('strokeColor'),
                        defaultValue: options.initValues.strokeColor
                    });
                    ul.appendChild(li);
                    break;
                case 'line':
                    li = this._createStylingElement({
                        type: 'color',
                        className: 'gp-styling-option',
                        label: this.options.labels.strokeColor,
                        id: this._addUID('strokeColor'),
                        defaultValue: options.initValues.strokeColor
                    });
                    ul.appendChild(li);
                    li = this._createStylingElement({
                        type: 'range',
                        className: 'gp-styling-option',
                        label: this.options.labels.strokeWidth,
                        title: '1 à 10 pixels',
                        id: this._addUID('strokeWidth'),
                        min: 1,
                        max: 10,
                        step: 1,
                        defaultValue: options.initValues.strokeWidth
                    });
                    ul.appendChild(li);
                    break;
                case 'polygon':
                    li = this._createStylingElement({
                        type: 'color',
                        className: 'gp-styling-option',
                        label: this.options.labels.strokeColor,
                        id: this._addUID('strokeColor'),
                        defaultValue: options.initValues.strokeColor
                    });
                    ul.appendChild(li);
                    li = this._createStylingElement({
                        type: 'range',
                        className: 'gp-styling-option',
                        label: this.options.labels.strokeWidth,
                        title: '1 à 10 pixels',
                        id: this._addUID('strokeWidth'),
                        min: 1,
                        max: 10,
                        step: 1,
                        defaultValue: options.initValues.strokeWidth
                    });
                    ul.appendChild(li);
                    li = this._createStylingElement({
                        type: 'color',
                        className: 'gp-styling-option',
                        label: this.options.labels.fillColor,
                        id: this._addUID('fillColor'),
                        defaultValue: options.initValues.fillColor
                    });
                    ul.appendChild(li);
                    li = this._createStylingElement({
                        type: 'range',
                        className: 'gp-styling-option',
                        label: this.options.labels.fillOpacity,
                        title: '0 (transparent) à 100% (opaque)',
                        id: this._addUID('fillOpacity'),
                        min: 0,
                        max: 10,
                        step: 1,
                        defaultValue: options.initValues.fillOpacity * 10
                    });
                    ul.appendChild(li);
                    break;
                default:
                    console.log('Unhandled geometry type for styling.');
                }
                div.appendChild(ul);
                var applyButton = document.createElement('input');
                applyButton.type = 'button';
                applyButton.className = 'gp-styling-button';
                applyButton.value = this.options.labels.applyToObject;
                applyButton.onclick = function () {
                    options.applyFunc.call(this, 'apply');
                };
                div.appendChild(applyButton);
                var setDefaultButton = document.createElement('input');
                setDefaultButton.type = 'button';
                setDefaultButton.value = this.options.labels.setAsDefault;
                setDefaultButton.className = 'gp-styling-button';
                setDefaultButton.onclick = function () {
                    options.applyFunc.call(this, 'default');
                };
                div.appendChild(setDefaultButton);
                var cancelButton = document.createElement('input');
                cancelButton.type = 'button';
                cancelButton.className = 'gp-styling-button closer';
                cancelButton.onclick = function () {
                    options.applyFunc.call(this, 'cancel');
                };
                div.appendChild(cancelButton);
                return div;
            },
            _createLabelDiv: function (options) {
                var popup = document.createElement('div');
                popup.className = 'gp-label-div';
                var inputLabel = null;
                if (options.geomType == 'Text') {
                    inputLabel = document.createElement('input');
                    inputLabel.type = 'text';
                    inputLabel.className = 'gp-input-label-style';
                } else {
                    inputLabel = document.createElement('textArea');
                    inputLabel.rows = 2;
                    inputLabel.cols = 40;
                    inputLabel.className = 'gp-textarea-att-label-style';
                }
                if (options.text) {
                    inputLabel.value = options.text;
                }
                inputLabel.autocomplete = 'off';
                inputLabel.placeholder = options.placeholder;
                inputLabel.id = options.inputId;
                popup.appendChild(inputLabel);
                inputLabel.onblur = function () {
                    options.applyFunc.call(this, inputLabel.value, true);
                };
                inputLabel.onkeyup = function (evtk) {
                    if (options.geomType == 'Text' && evtk.keyCode == 13) {
                        options.applyFunc.call(this, inputLabel.value, true);
                    }
                    if (evtk.keyCode == 27) {
                        options.applyFunc.call(this, inputLabel.value, false);
                    }
                };
                if (options.geomType != 'Text') {
                    var applyButton = document.createElement('input');
                    applyButton.type = 'button';
                    applyButton.className = 'gp-styling-button';
                    applyButton.value = this.options.labels.saveDescription;
                    applyButton.onclick = function () {
                        options.applyFunc.call(this, inputLabel.value, true);
                    };
                    popup.appendChild(applyButton);
                    var cancelButton = document.createElement('input');
                    cancelButton.type = 'button';
                    cancelButton.className = 'gp-styling-button closer';
                    cancelButton.onclick = function () {
                        options.applyFunc.call(this, inputLabel.value, false);
                    };
                    popup.appendChild(cancelButton);
                }
                return popup;
            },
            _handleDOMToolClick: function (e, toolId, context) {
                for (var availType in context.dtOptions) {
                    var availToolId = context._addUID('drawing-tool-' + context.dtOptions[availType].id);
                    var li = document.getElementById(availToolId);
                    if (availToolId != toolId) {
                        li.className = 'drawing-tool';
                        context.dtOptions[availType].active = false;
                        continue;
                    }
                    if (context.dtOptions[availType].active) {
                        li.className = 'drawing-tool';
                    } else {
                        li.className = 'drawing-tool drawing-tool-active';
                    }
                    context.dtOptions[availType].active = !context.dtOptions[availType].active;
                }
            }
        };
        return DrawingDOM;
    }();
    Ol3ControlsDrawing = function (woodman, ol, Gp, SelectorID, Interactions, DrawingDOM, Utils, KMLExtended) {
        function Drawing(options) {
            options = options || {};
            if (!(this instanceof Drawing)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            this._initialize(options);
            var container = this._initContainer();
            ol.control.Control.call(this, {
                element: container,
                target: options.target,
                render: options.render
            });
        }
        ol.inherits(Drawing, ol.control.Control);
        Drawing.DefaultTools = {
            points: true,
            lines: true,
            polygons: true,
            text: true,
            remove: true,
            display: true,
            tooltip: true,
            edit: true,
            export: true
        };
        Drawing.DefaultLabels = {
            control: 'Annoter la carte',
            creatingTools: 'Outils de création',
            points: 'Placer des points',
            lines: 'Dessiner des lignes',
            polygons: 'Dessiner des polygones',
            text: 'Ecrire sur la carte',
            editingTools: 'Outils d\'édition',
            edit: 'Editer les tracés',
            display: 'Modifier l\'apparence des objets',
            tooltip: 'Modifier les textes / infos-bulles',
            remove: 'Supprimer des objets',
            export: 'Exporter',
            exportTitle: 'Exporter en KML',
            applyToObject: 'Appliquer à l\'objet',
            saveDescription: 'Enregistrer',
            setAsDefault: 'Définir par défaut',
            strokeColor: 'Couleur du trait : ',
            strokeWidth: 'Epaisseur du trait : ',
            fillColor: 'Couleur de remplissage : ',
            fillOpacity: 'Opacité du remplissage : '
        };
        Drawing.DefaultStyles = {
            textFillColor: '#000000',
            textStrokeColor: '#FFFFFF',
            textIcon1x1: {
                src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNiYAAAAAkAAxkR2eQAAAAASUVORK5CYII=',
                anchor: [
                    0,
                    0
                ]
            },
            polyFillColor: '#ffffff',
            polyFillOpacity: 0.4,
            polyStrokeColor: '#ffcc33',
            polyStrokeWidth: 4,
            strokeColor: '#ffcc33',
            strokeWidth: 4
        };
        Drawing.DefaultCursorStyle = {
            radius: 6,
            strokeColor: '#FFF',
            strokeWidth: 1,
            fillColor: 'rgba(0, 153, 255, 1)'
        };
        Drawing.prototype = Object.create(ol.control.Control.prototype, {});
        Drawing.prototype.assign = function (source) {
            for (var prop in source) {
                if (source.hasOwnProperty(prop)) {
                    this[prop] = source[prop];
                }
            }
        };
        Drawing.prototype.assign(DrawingDOM);
        Drawing.prototype.constructor = Drawing;
        Drawing.prototype.setMap = function (map) {
            ol.control.Control.prototype.setMap.call(this, map);
            if (this.getMap() && this.eventKey) {
                ol.Observable.unByKey(this.eventKey);
            }
            if (map == null) {
                return;
            }
            if (!this.collapsed) {
                var inputShow = document.getElementById(this._addUID('GPshowDrawing'));
                inputShow.checked = 'checked';
            }
            if (this.layer) {
                this.setLayer(this.layer);
            }
            this.eventKey = this.getMap().getLayers().on('remove', function (evtRm) {
                if (evtRm.element == this.layer) {
                    this.layer = null;
                    if (this.interaction) {
                        this.getMap().removeInteraction(this.interaction);
                        this.interaction = null;
                    }
                }
            }, this);
        };
        Drawing.prototype.exportFeatures = function () {
            var result = null;
            if (ol.control.Control.prototype.getMap.call(this) == null) {
                console.log('Impossible to export : control isn\'t attached to any map.');
                return result;
            }
            if (!this.layer) {
                console.log('Impossible to export : no layer is hosting features.');
                return result;
            }
            if (!this.layer.getSource() || !this.layer.getSource().getFeatures() || !this.layer.getSource().getFeatures().length) {
                console.log('Impossible to export : no features found.');
                return result;
            }
            var featProj = this.layer.getSource().getProjection();
            featProj = featProj || this.getMap().getView().getProjection();
            var kmlFormat = new KMLExtended({ writeStyles: true });
            result = kmlFormat.writeFeatures(this.layer.getSource().getFeatures(), {
                dataProjection: 'EPSG:4326',
                featureProjection: featProj
            });
            return result;
        };
        Drawing.prototype.setCollapsed = function (collapsed) {
            if (collapsed === undefined) {
                console.log('[ERROR] Drawing:setCollapsed - missing collapsed parameter');
                return;
            }
            if (collapsed && this.collapsed || !collapsed && !this.collapsed) {
                return;
            }
            this.onShowDrawingClick();
            this._showDrawingContainer.checked = !collapsed;
        };
        Drawing.prototype.setExportName = function (name) {
            this._exportName = name;
        };
        Drawing.prototype.getExportName = function () {
            return this._exportName;
        };
        Drawing.prototype._getsMarkersOptionsFromSrc = function (src) {
            var markerOptions = null;
            for (var i = 0; i < this.options.markersList.length; i++) {
                if (this.options.markersList[i].src == src) {
                    markerOptions = this.options.markersList[i];
                    return markerOptions;
                }
            }
            return markerOptions;
        };
        Drawing.prototype._getIconStyleOptions = function (markerElement) {
            var iconOptions = {};
            Object.keys(markerElement).forEach(function (key) {
                switch (key) {
                case 'src':
                case 'size':
                case 'anchor':
                case 'anchorOrigin':
                case 'anchorXUnits':
                case 'anchorYUnits':
                    iconOptions[key] = markerElement[key];
                    break;
                }
            }, this);
            return iconOptions;
        };
        Drawing.prototype._initialize = function (options) {
            this._uid = SelectorID.generate();
            this._exportName = 'Croquis';
            this._exportFormat = '.kml';
            this.options = options || {};
            if (!this.options.tools) {
                this.options.tools = {};
            }
            Object.keys(Drawing.DefaultTools).forEach(function (key) {
                if (!this.options.tools.hasOwnProperty(key)) {
                    this.options.tools[key] = Drawing.DefaultTools[key];
                }
            }, this);
            if (!this.options.cursorStyle) {
                this.options.cursorStyle = {};
            }
            Object.keys(Drawing.DefaultCursorStyle).forEach(function (key) {
                if (!this.options.cursorStyle.hasOwnProperty(key)) {
                    this.options.cursorStyle[key] = Drawing.DefaultCursorStyle[key];
                }
            }, this);
            this.options.collapsed = options.collapsed !== undefined ? options.collapsed : true;
            this.collapsed = this.options.collapsed;
            this.options.markersList = options.markersList || [
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAARfSURBVFiF3ZhfbBRVGMV/d2Z3212tbSkCbuNaqzaRiL6QyAMPjSFoYqgx4oOiRmMFUzQG479o2lQ0QXk1EhYFgmlD2mIRkYhRwqLEaA2GiKWV7rZLQ0sLwbZId7t/Zq4PFK1125m5s/vCedz7nXO+M9/N3jsD1xFEvgXlTkrI8hBQBywFbgEqgEvAMHAayZcYHBYbuZJP77yFkdsoR+ct4GXAb4OSQPARXj4QzzGejx7yEkZuZy2CMLBAgf4nkhfEi3S67UNzQ5YSIXfQhKAdtSAACxDsk2EapXT3cF2FYQdNSN7F/YQFsJkw77gVUcL01mp3o5EDJoK1Yj37VchKjcjdlJEmhvrWmg9jGNwhGhhzSlTbZmnepjBBAMrReF2F6Hgy0+fIKPb+flWRIMtip+eQ88lcPRCtg3gCCVZ3RqhPDbJepqlPDbJ6XwSvP2nDJYCXB522prLN6iwrPIEETw33U/VoLZovBPjQfCGqHqtl3XDUZiBrn1lQCXO3ZcUDLV34Su/JueYrW0btnp8tNSRLnTamEiZoWRF6uHre9dseuT0vPrOgEqbCWtW3xNX6VSy02c+/sk4JwF+WFWZ6xGL9vA2fyzb7+QcqYUYtKwYP9s+7PrA/bsNn/geSA87DSLosa44+fT/p8VM511Jjp4g8u8KGk7XPLKhM5qhlRSbppzV4JwMdEcz0WSCNmT5LrC1CS/AujKliSw1BxGljzm8AH3MjHs4BpU65DjCBn0rxDJNOSI4nM33F2O2U58yEnU6DgOpF02AzcEGJa40LZHlfhagUZvp6vkmFawObVK7/4PLFSoZpBZ50ozEThsne6i2hjZqmFRVJ6U8JUeSVUmQNzQvg0c1MVtNMIUTSl0pNLhsaGu8A4xrfbZhS4CRQ5SoFcCWtja/5NBg+N+GZsu0vhSEkcY8mf+iNx+OuX3llmJVABNCVNUA2fl3xWdvJkriqRBb2uPugAYgNHEey1Y3Gt3/ccNxFEAChm2al6zAAjNAEWF/rc1Ev6+ffOLTwmBt7E0xD02J5CSOayQLrsHMJnYGMITJvHrr588mUMKyr54CUaaHrnfF4fCQ/kwHEBmLAa044rb+WHP4xXnxJ0VJK6CkyjO2xWOx3KMSH8zDtwONWdb2jvt41u4JtChZJKeVveDwnYrHYfw5uj4KYFRpSWbGqyCPL5ypIpMTkKwcWfWVXUEqRRcio1LTuUCjUE4lEsrnq8j4ZgKEP9bpgmfHFHPpyy3fle3f9Uto3n4aUIqNhDghN6zZ1vTcajaasfAsSBmBwq7f11tLM/24Hx2L+n+rbF38zBy2JEP0anPEGAj3d3d1pJ56F2GYAGInM82M+bWW53wxd++3ipH7x1QMLj8ysk5BAyj6Ppp2+d/nyaEdHh/I/W8EmA3Ci2b/iviVT3+tCerMmxkudiz450hcYBSYQIqrDmScGBvqawSxkH3lDV2Pxe6ltItnWcFNLTXX1qpqamkoK/BCvC/wNB+l5MdQKNHsAAAAASUVORK5CYII=',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAS7SURBVFiF3VhNTFxVFP7OfTNvOjMtM9AoJSSYEEVMCv6kJi5NoCa1TRqNxDTaFhcWNSmxaaxNQ0w3mqgLdGeRhKFYXVC7qDU2BhVt/YdqEQRhRgYTKD8VZqAMzM+7xwVCcIR58+6b2fRb3nO+853v3fvuu+8CtxEo1wX5pTu2IpasBfEeSFSCUAygCMAsgEkAQyD6DClXF3VMLeZSO2dmuN7vB+MYiBsAbDEn8BIIZ6BrzdQyF81FDzkxw8/594P5HQCFCvQ5QDRSYO4Tu30IO2QGiA/5XgVzAGpGsMKTZ/mw7wTbfLi2yFzvOwngpJ0aaXidAtG3VcnKZv5dWgE7Nf5fFBJCHqK2hUsqdKVG+EihDwn5K9SXViZEAHqAApGIVaLaO5Pg48iPEQDwg2WjCtHyzKx8RxJBZLP9qoJ5CdJ9t9XvkPWZiSVrkY0R3b2MxnM9aJ2Ooi3iRut0FEc/6IHuiZtyidwQ8RqrrVk3Q7zHNEd3L6N5eAYP7q2BppcB0KHpZXhoXw2aB6eyM8SPW23NuhnGvaY5L7T2w7Nt54Yxj68KDS19WSiZ66RBZQPYYZpRvfuejPH7H8scX0FJlv2sQcVMkWmGpmc2bBbPVicNKsvslmmOkZg0id/IQmkhy47WoLABYNo05/rnIxnjv1wOmtbgLHTSoDIz10xzzhypQiz624axWLQPLQ3V5kLUa7U1la35G9OcRMyFY/cV49qlLhiJMQAJGIkx9FzswsuVO5BccpnryKuWW7NK4IPFXmjLgwAKrHItYB66t5JaJmJWSJZnhjqmFiFxzirPIjqsGgFUD5qC3gRjRolrBsYMQEr/NEpmKBCJgHBKhWteHKdUjv8rVBvgw773QaizU2M9DMb58q98rwghXC5md5zI5WSmlCGcAODQZDIlhCSiJT0eX6waH490AsYq356ZZ4oK4DSuAihT4UuGYIaQILGQ4vknen2BibhYzlqfySBG2CH4ylA4HLb9y8v1BY8A9CkAzVwcZDA0BgkG0+oFBjP49Ij3o48n9b9U20gB7bZuZwCAAvM/gPndTDmSIZKS9CRDNwCHBIv1NzFdfzu/t2EEAEiTstS2GQDA2PwbAHrSh9ebSDewihtxMdn0h/dbO/ISkIYQoZyYoW6kYOD59YdQg8mRYjgleFONpKRk07D34qJBxmY5pmBOkKZdCIfDk7mZGQDUER0FUROwaoQdZpd6H07oXT/OOWYVJZmBQZdhvBcKhfqBfFyc1xcEEpKeNjMytOgYfqp32wUFiSVm7oPD0RsKhf5zsnYoFMsMyccTUtvtFHL7ZimxFC2eGPJezrYkM6VAHGQhBsrKyga7u7tTG+XlfGYAIFxXuLfEzZ288fvCb4U858+Ou0KZajBTUkCOkhADUtOGgsGg6SVIXswAQKiuqK3UbRxIH78yq//8Yr/3i01oSyD6UwDDTo9ncGBgIGFFM29mRh/FFm+J/3qBk+9aHbsZFzf39WwN3DK0tWXCQAzMIw4hfq/etSvY2dmpvLPlzQwA/PTk9od3eowvhWCnZEodHfC2fz3rnAEQBVFQA4YPjI6OnAZkPvvIGb7bX/Ta/LP+SEftne0V5eW1FRUVpcjzQ7wt8A+9at5zXMB2DQAAAABJRU5ErkJggg==',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAP0SURBVFiF3ZnLbxtVFIe/e8eOPU5DapI2whEWyiILJGDTBQuWSGTTSkVlQRGs2MGSh4RoQWLB4x/gpVIViNokJUV0U4RQXKgQr0ookCYkdjONSJtQJTGltjO2Zw6LJlEbkszLTgQ/6Ww859xzPt97556Zgf+RVKMHFGgD+oADwP3APUAHsABcBS4BXwDnFNxsdP6GSCAt8LZAWUB8WEngLYHdO137HRI4JLDgE2K9LQg8vtMMCCiBowJuSJBVcwWOSBOWfRCY1yJCrLdXdwrkUANmZL05Age3G2R3hD3iZYsC6TB16ZA8rwB3h4z1Uhp4MUxg4A23co7MA2aYhD5VBrqCnkNhZqYPPyCpVJnh4Ry2PYNIFdue4fTpHKZZ8ZEjBTwWorZgEvjEc92nUiUpFn+VjbS0NCqm6edgPbEdMD97FjI8PLIhyKoGB0d8wPy0HTBXPQux7Stbwti25QNmNmhtYW4ANtCytZNUPXxslEp4pKoq8PK5Q2FuAH97elSrcx7Xr/nIc8NnPWsKAzPv6XH27OUtr585Y/nIs/Uf0ggJHPdc76ZZlqWl0Q33y+LiqCSTFR975th2wDzjqy0xzbIMDo6IbVsiYottW3Lq1IhPEBF4ejtgdgkUm9SXrVpRoDVobYH3zEqLcTxoXEAdU1Bqco5bkluPyPNNmpV5Cdk1RwE63CSYw2FrivSYKtBPhOTr5cDJnmz2Oa11IiFi2kol4iKq7ug4QMxwa3WtXaVUpcW2Sw/MzhaHwFmNjwrTDvwC3BeJAripdXF/JvP+H7HYsu/8ohwlWDEt305YlhX5BYLAI0AOMCKMIUc6Oj4eaGuzwg5RhxNhnzTXpOAC8E6UMb5qbb0QAQRAGa7bHRlmRUeBH8IEzhnGtZc6O89HSe6C62hdaAiMgjrwFH6a0NtUU6r28p49n5WUcry9N5FIVRnGsGVZc42aGRQUgBeCxPS3tZ37LplcCJlSBMYTjvNeoVD4baWGxkpgEHjCy2+ipWVifyYzECJFRURGicUuFgqFP2+/0AyYTlupyYTIpqd4WanSwe7udy/HYr5aFhFVR0letB7LZrPjuVyuvpFfU97tzhrGgYzjfL7J+PJmOn3yo/b2qa3GEFE1jTuttB5zDWMin8/bXnmb9qJ6Jh7vv7dW+1d3cN40v3+2q+vLTcIqKHVZw2Q8lRofGxurBsnZNJhpSLZr/XvadbOrv103jOt9mcwHNwxjbZkIlBGZiml96cF9+/JDQ0Oh72xN/YRw0TQffmh5+RtDJF4H5/m9ez/8OpWaB/5CqbwBk09OT0+9Dm4z62iYfkwm37CVqgzsuuvT3p6eR3t7e7vZye8w/xX9A0ynxee2hlfFAAAAAElFTkSuQmCC',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAASKSURBVFiF3ZhdbBRVHMV/9+5uPwikFExEiCtWbSKCCEsCiU1EJIEXeMIHxZgYPzBUYzB+RUPlwwTl1UhYFIiGhrQVFCMRAoQFidGaEgIuVLrbLgSkhWBb2N3uzs7M3weBILadnZndF87j3P8553/m3ty5c+Eugiq1oDy5dRw5czGKpQjTgPuAicBV4C+E02j5gSFrn4o3pkvpXbIwMmNTLaHAByjeBKqLoGRBfY4V+lSdeGmgFD2UJIzM2bwMUVFgggf634i8qo6/vttvH9oPWRAlkS1NiGrFWxCACSj1rUSiqwXx9XJ9hWH2liaQtfifYQWsIxL9yK+IJ9xYWq1+NIaBjahl6vhr33khe2pEntg+noCRxPvSGg39GNZD6tTKfrdEb8ssaHxIeYIA1FKh3/VCdD0zN74jfRS3/XpFlpx5r9vvUNC1Tc5cTDFBqoJZ1i9opyFcR0hPomD3cvR8N02H55IvOPHHUB1aBOxy05r7ZaZY6lhTFcyy74Vunp46n5AOAxWEdJhnps5n//IElaEhRw0pwucOuA8jPOpYs35BO2Mrpg87NrZiBmvn/+aooWSa29a8bACTHSsawnWjjj/1wIOOGlKEzx3wEmaiY0VIT/I1/i/uKbKfW/AS5rpjRcHudRi/VITPtSL7uQUvYfocK46e7x51PNaTKsJn9BcyDDyEkXbHkqbDc0kbp4Ydu54/xcexec42OPvcAS9b82HHmnyhmkXND3OwJ0bBPgcYFOxzHEjGWLTjEQyryrkzFXPfmkvIY1+MpSp4Aahxy3WBQQrVU9TJFzNuSK5nRsUb0yi2u+W5dNnqNgh4PWjmrXXAZU9cZ1zGMD/xQvQU5sbxfJUXbhFY5eX4Dz5/rCQSbQae96NxOyzsnXVXNjRqrSsrRarzSlWGRJRp6RBAMGAXTK1tpdRQRT6fmXHx4kAbWDf5fsPUACeAqb5SAGkxBpYMfBW9YA/mivYXZSkhFdTyc2cqlfL9yyuRaAMQAwKeNUBWZ376piV3IuVVwoSv/V1oAKpjxTGQjX40Dhh/HvMRBEAFbHuK7zAAjOttApyP9cOg17526b303iN+7G2wLa2TJQmjYmtMYDnFHEJvQwGr8H5m766M5C3n6hEgYqhAYHcqleotzcwAqmNFEuEdN5zm3PF9vxipqx4tReBMpWVtTiaTf0A5Ls4j0VbgWae6TrOvc8ngthYPFkMicpJgsCOZTP7nw+3+QsMZK/NiLqxUwdqRCrJ2PvNWes+PxQqKKBMlCdE6Hg6Hz8RiMXO4upLPDMDFWZ8tnazHfz+CvmzIHNy5Lfd712gaIqqgsXuU1nE7EOhMJBJ5J9+yhAE4P2tj8/265n+ngyNG8tdXrrfuH4E2hFLdGs6Gxow5E4/HDTee5VhmAFj92Zf7J1Q01Krq8M1nV+zMlbfTew7dXieQRaQrqPXpx+fMSbS1tXne2co2MwAds9fMm6kmHQ2gQia29ca13V8eKnT1AYMolQjA2ed6errWgF3OPkqG9pmr1+cjm4ZapjfuqK+rW1hfXz+FMr/EuwL/AGOdsbn1H7gQAAAAAElFTkSuQmCC',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAATNSURBVFiF3VhZTFxlFP7Of+8Mi12Eot2Sia36IIJCIWmT0lhSK30wfaoaNcampBhrfGhSl5hIW9HE5VFTpWilNpUI0hrTh1YwjJSkthFEcABhBoZ0YekCFGa72/FBSLAF7jY86Pc453znO9/9//nvuT/wPwIlu2DLns1Lo3J8hwDtZHA2gNUAVgC4SYRrzNxFJH6UpNjZ4iOBqWRqJ83MmVdzM7y6520CvQ4gzQIlSoxPJVX/sLi6fTwZPSTFTOMrhbuYuRJApgP6LRDv3V7ZdsptH8INmQH6aW9BOTPXwpkRAMgE0/eNZQXvssuHK7khF5VtOEhEh+F+hQlAcX/hGu1E61CzmyKOML21at3UmAMGM+96qqrttBOyo0aadufdq3mlEJxvrXlBwFhcUh58+vPOMbtcR/8ZzSu/g0UwAgAMZHgN7xtOuLZXpmXP5qUxOT4Ca8evU0RlOb7S7ntItq8S30EWjEje1GhOacWlrNyi9SR5VrGuDo92NPd3HSvfqCsJM366pqaVAKi305vtbSZAO81yJG9qdMsnZ/vvyyveSpLHB8BLkse3Mn/b1i0fnQtK3pSYuRKb6tzdm10QP2KWklNacUlOXZIzV0xOX5KbvfvwRXMdyrbbmm0zzFhjlpOVW7R+ofj9eU+ss6BkqnMnnJxmK8wSSPKschOfRpbljqbhxMykWQLr6rBJfMiCzm3LHU3DiZkRs4TRjub+BeO/+8MWdBZ8IHPBthkiXDLL6TpWvlGLTnXOFVOjk52B6oObzJXYVOdO2D8AQE1mObqSSDv/VslDI62NftbVQQAK6+rgyG8N/vNvljxsqEqqqQ4Lv93ebE8ATfseXaJpqVcALLfLtYEJI6auLTnREbFDsr0y/4wY9LVdnh0w4yu7RgCHg2ZCSrwHYNQJ1wJGFVl53wnRkZnp8Xy/E64F7Hcy/gMuP6waygpOAnjBTY3Z0Bk1ZeeuvyaESElhTksQpXiYSdOFBwBkyVA1IQwiinkTiUju1avjdYA+w3drZjkB7Qw84NIH4hqPV1wYr7wVM+JWOcykEyMsCz7fEw6HXX/yNpQVFAHww819AoNP9kS+abkcDzutoAHHXd3OAMD2o60tTPjYTY3260qLCyMAQJJhrHVtBgA8q5eWAzAf6+fAeNwYqu6c+sWNvgEYuhChpJgpPuTXBPAiLAyhs6Ez1ONdkfqEzrp59jxgVkiSToXD4eGkmAGAbUdbQ0R8wA7Hfzl+tueGctOhJDPQnaLrX4RCoT+BRbg4bywrqGXgGbO8K5NazwcXJr5zIBFj5g7IcmsoFPrXi9v2hYYZJGBfzOAnPYIy5stJaEbky86pM1ZrMpMG4iALEfD5fN1+v1+bKy/pKwMAtS/n78xIET/MU5/r/4rUNA7G+xaqwUyqgDFAQgQMSeoJBoMJM91FMQMANS/ln8xKE3dNB4Ebyq+ftU2em4cWA1G/AHo96endgUBAsaOZ9G02g7g0VhpRMovu8ZJv5rcJxbh+rHPq59l5DETB3CcL0fVYYWGwrq7O8cm2aCsDAFXPbdjkW0bNguDRDehV7ber/rihjgCYAFFQAnqfHxjoOwQYydBbVDMAcOTZxyvWLZMPXBxS6r/tjlRDlrt7e3uvAeDF1v5P42/pFun0pc2xBwAAAABJRU5ErkJggg==',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAARrSURBVFiF3ZhNbFRVFMd/985H26m1VEoL0zj0Ayqi6IZElpiQ2MSgIeJCDZGFuEEXJH4bG9QN6spoImiMIaExbREEYoIxhgEb1CZNjFg6lHnTacNHW8QW7Mx0pjPvuKDVprR9X1MX/Jfvnv/5n/89N++d++AOgip2QolRQZAWhCeA9cAqYDlwHbiCcB7NcTKcVA8wUUztopmRQarI8wbwMlBmg5IGPkGzTzUwXowaimJGEmxHOADc44L+F7BLNXHEax3aC1kEJQatCB24M8I077DEeUfE2+Z6MkOCVuBdvHdYoXgPg7e9JXGJ6aPV4SXHPDARtqs1HHVDdlWIDLAMEwP3R2sxjOGnSa1mzCnR3TET3mJpjABUkedVN0THnZEYFQQYwd7r1y3STFLr9DvkvDNBWrBjRIfS1B6J0pAdolFyNGSHqD0cRZVlbKiEKOUxp6U5N3Pry26RNZRm9ZUE5ds2o4IRIIgKRih/ajOrr8RtGVI2dObKOiUA91tGrDjUjap8cH7FZRuoOfirZQ5hvdPC3JgJW0aEHm9cfP3JBsscYkNnDtyYWW4ZoYIrPa0DKKptVzQN52YUf1vGSG548YDcVRtKN+0V9B/cvABGLGPSJxKLrqeOJm0oWWzI7XBzzLotI0Z3PII5fm7eNXPsHKM7NxVFZw7cdOaUdUymjMHwGlKdUSQ3COSQ3CCp9iiD4bXIZKllDkXUaWnOJ4Be7qKUS0ClU64D3KCcOrWSlBOS485MjxhfOeU5xJdOjYDbqfnWFTkG1LjhW2AUP+v+t6l5WmiPG64N7HFjBDxerMSgDXjWS47ZKBT4unFLZLfWuqREpCyrVElAROULOgDg95lTea1NpVQmmM2mNly+PN4JhRm+VzOVwG9AvScXwERaj2/dFT5wadg/aVtfVEEJSb+Wn2LJZNLTPwDVxA1gB7N2xw1EkH37q445MQKglPjQ0pSH5+vr6+u9/dAAVBNdwIdecvzQVd7V/l1F0ksZPtOs82wGgCFaAeuxfh4MX/Ndfe2D6tNe5E0wC1obRTGjHiWPyXNgYwidhakpNfX6Ryu+SWWU+2MqklM+35FkMjlcnM4Aai0GwitOOG0nKk6e7Sm97lJSBPpKCoX9hmH8AUvx49ygA3jaKi5mBGNbXwy3u5DIiMjv+P09hmGMzl4ovpkLVGcLqr+kRKoWikmnVWrb7rrPEkN+WyOLiMqjJC5a90Yikb5oNJqfL87vtuiFoO7jz8s/653hmsK3zL9Z8vHBZcesjIioKY05oLTuNf2+WDwezwIkEgtflYremRkMdQXa7l01ddt0cLq77JcX3qz9fgFaBqUSGvoDoVBfb29vzonmkpkZOEVpZaW+UFVpRmaeXRvzXWvZGf785oTv32MikEbkol/r8w9t3Bjv7Ox0/WZbMjMAPcfLNj28bvKMzyeBfIHCS3trvvjxbGgEuIFScR/0PzMwcHEvmEtZR9HQfaz0/WxMZdo/vftQc2Pjlubm5jqWeBPvCPwD/KOH+jnO5aMAAAAASUVORK5CYII=',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAASxSURBVFiF3ZhdbBRVGIafc2Z2210hbeWnpcQVUC8kwBUJXJBIgwkgBEPEC1GMxhgE4gUJJsYERMWI3orYaiqgrYSWH/mvMaQLciE1RAKUkrLbbhMobQ20/LT7N3OOF0CC0O7szGwv9L3c73u/93vnnD3zzYH/EUTBKx6sHUvQWgR6GTAdmASMA26A6AYuofUhQnYTVevuFlK6cGaObC9DGh8i9PtAKA/GEIKvSRZtZfnbA4VooTBmjlWvQFADPOmBfRN4l8Xv7ffbhvTF1lpwrHoTgga8GeE+by9NNRvR2tfDNfyQmVv5MYJP8L/CAqgidtai/sgpP0W84d7WavBV43Eo0CtYvOaAF7K3Rg7sKKU4Hcf71sqFfmz1DEvX9rslevvPFKc/YnSMAJRhyA+8EN2vzMHasQSzveR3/HrFEMV2udv3kOlaJmgtIg8jYcMcqpu1oGXJhMi0oJQVGaV6Dvd1day62DwnaWWd+GHSciGwz01rHraZXuaUETbMoe6qVR3Ly6fMD0oZAYJBKSOvVEyd3z3/jVjIDCSddYSjzqPwYEY875RRN2tBS4kZnDFcrNQMztw144UzjjKa6W4787IylU4ZSyZEpuWKv1w+dWohdB6Fl9NsnFNCUMqKnHGRO34PYnz+Ld2DFzN3nBIySvXkjGt1PQ+d23l3dB9ezPQ6JRzu6+rIFT/Q25lwVNHkfCDDwYuZFqeEVReb5wxYmQvDxfqz6QtvnW+e69yZcNR5jOKWgKbZKSVpZUOV0bpnG3vi0YxWXUAmo1XXnp54tLL5p+dSyi52FlJRt625nwCavxlDyrgKlLjm5o9byPBkFr456IbkfmWq1t1FsMM1zx1q3RoBr4OmpT4F+jxxndGHrbZ4IXozs3RtP0Ks98R1ghDrvYz/4PfD6ti39Qix0leNh6H07siaL9ZJKYuKtA6lhSgKaC0sWwYATENlLSmVECIZTKcHZ167NtAI9gO6PzO/1ZRg6XPAFF91AJnKDES21NaYN26l8uVoLWyhSZhS/345kUj4/+Q9XjMPdBR/9wl6Qn3TjyWnzyW88i3Y5e92BmDx6tPAV35KjDnXftqHEQBhKDXZvxmA4p5NCJzH+mFg3rxzvXzn0ZN+5BUoW8p4YcxUbbZQ4nXyGEIfhrDt7MS6o/tEOm07Z48ArTPCMPYnEomewpgBeGl1HMQGN5SSk381hdsSNzwqag1tRbZdHY/HL8JoXJwfr24AXnVKK7rae/mpz3fs8aCQ1FqfxzTPxuPxf7243V9oOMESa4XOvqgDZtlIKTKVHpz4w6Ej+ZbUWlgIHdNStkYikbZoNGoNl1f4lQGM3V8us0tLfhmhvh6/98Tu0hN/XslVQ2uRlahOIWWrMozLsVgs7aQ7KmYAAnVb67PjSh+bDsKtHX9Ubmv4dQRaEiE6JLQHwuG21tbWjBvNwm+z+8hmU+/Iu8l5akwo8uA34/bg3+W1B088nKdhCK2vmFJemjV7dqyxsdHzyTZqKwMQ2r55bmpK+SktRABb2ZO+2//9E+djvcAthIgZ0P5aZ+eVzaAKoTeqZgCKt238LP10xYaxZy7tq/j5+E5Ms629vb0b0KOt/Z/GP4jqqfL5oxVsAAAAAElFTkSuQmCC',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAS8SURBVFiF3VhdTBxVGD3f3Rl2oRAstZXaBGxpoxaxhSVpE0ha0ib0qU/1QX009UHjQ5Oa+BO3pdTEn0QffNDGGH+SprGUqlUTSGtcKfGHBELALYTuwGJsSyEVKLuz87Mzny80sQjMzp3lQc/j3O+c8525N3fuXOB/BCq0YNNoU5lRZBwipsMM3glgM4ANAO4AuMnM14QQl7LZbFeiNpEupHfBwtRN1q1Xc+orBHoJQHEeFB3AB45w3hrcOjhXiB4KEqZxvPEIM58BUCFB/4vBRwdqBi4G7UMEYjMoqkVjzHweckEAoIJAF6LJ6BvgYC83UJiG8YYYgDYEn2EC4VRUi74eTEQSi0vrfBCNZeAy85GB7QNfyZClGtk9sfuBkBvSIL+0VsOspVg1w9XDs36JUstMYeU1rE0QAFhflCt6WYboe2aaRpvKDNW4jfy2X1nohmE85Pc7pPh1MYqMQ2DvIBER0ds3tvc1lzRvU0mttNme6tF7xmPTsT0mm178kuJIcSuATj+9+V5mxHTYqyYiInpXddd4y7qW/SqpVQCKVFKrDqw7sL+7ujsZpnDWS4OJPX2WwncYBj/uVdO+sb2vlEqfWG6sVJTWtW1q+81Lg5h2+u1NZgN42KuguaR522rj+0r2bfXSYGZPn6WQCbPBq0AltTLIOACA8KCPngDIhCEseJXYbE+tOg77Vh5Od/PuaRH+wzBue5X06D3jq43HM/FUHk6rvpDlILPM+rwKYtOxPWk3Pbzc2IK7MHxi+sReLw0Ge/oshczW/KNXjclmcetk6/YrmStxm+1JAJbN9uTlzOV462TrDoutiGdjJOK+e/NLqE3UlkYikT8BlPvl+sC8vc7eMlQ5lPFD8j0zidpEmkCf+uX5xCd+gwCSB01TMU8BmJbh5oFpS7FOyxClwiwez4/JcPPAMZnjPxDwxyqqRc8CeCaIxn1wcG7m4MyLQohwmLnYJAqrzJRzhAoASsi1c0K4RJQtMs1M3Y0bcx2Ac48eNEw5gEEAjwQKAYB1nksfnTvjTrlG3hwmhxgpRfDV0VQqFfiXN6pFmwHEAYSkRRisv5/5wv7eSMkq5IDPg93OAOiv6e8F8E4QDbvX6g0QBAAo5LpbAocBgLI/ymIAPI/1y4Fn3FvZt9M/BfF3AdcRQitImHhLPAcXzwLeh9D7YMPW3810cpYd7+IVwGxRKHQxlUpNFSQMAPTv6NeY+bgfjvmt0ZXrt+5IWjIDI2HH+UjTtN+BNbg4j2rR8wCe8qpztdzowvPzX0pYZJl5CIrSr2nafR9u3xcansjhBXb4IIVp/UolrLuZ9On0d/lKMlMOxEkWIlFVVTUSj8dzy9UVfGYAoP6X+sNik/h6BX02PsycMy8Y11fTYCZbwJ0gIRJuKDSaTCZNL981CQMA9b31Z8Vm8a/Tgd1n/aq/utC9Ai0LonEBjKklJSOJRMLy41n4ZbaIWXv2uYr5imYqp6p7z9xZdyb7ZvqHf9YxoIP5uiLEtScbG5MdHR3SO9uazQwANFxq2EuPUQ9CUOHA0U/e/dj+2b4NYB5EyRAw9vTExPWTgFsIvzUNAwC7vtnVrjyqHLeuWJ3me5nPoCgjY2NjNwHwWnv/p/E3iQfm3w9KV7kAAAAASUVORK5CYII=',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAATaSURBVFiF3VhbbBRVGP7+M9NddtmyvcYKSbGoAYn4REJNIGmRpMREfMEH5YEYY6ptfCCBxEgEvMR4eeCBtBYa1EIIsbVAFAIIsis0og1GpJbWdrdsiUBLuXQp3e3MzpzfB23Cpe3pzGwf9Huc83/f939z5nLOAf5HoGwL7m4ryjWssdVgWkPEi5npURAKwbgJ4CoYF5n4WyBwrLZy6G42vbMWpv5MOJ9s+TYz3gIQUDtzCkw7DGgfb6gcHs5GD1kJUxcJrSWinWAUuOjgFkt+vXbl3QNe+xBeyMyg+lOhLQRqdhUEABgFRPTN59HQu8zebq7mhVxSEdoKovfgfYYJoMpzCZ91pMk87UHEHeoiobUEavai8RAYkgTWvlkxctAN3VUj2yN5eX6y464fralxG7p4vGZF8rZToqt3xs/2OzMUBADykZGb3BAdz8zutqJcI2MMYjqfX7cgTjEHHnH6H9Kd+hjW2GqAlEF0PZhataixfX5h1QJBvhLJ5kD/jaN9J7url1l2amo+U1BwugpAq5PenD9mTGtUJboeTK0v7+0rK3qhQpCvFIBPkK+0rPjFivXP/hnTtWBaaSPUPg/CzTvzlKpg1aLGdp+e+/REYz49vGTlooZfVBrMWOy0MTdh5qoK5hdWLZhqvKzo+TKVBpHa50E4D0MoVIqSr8TL+L8omnZP47pOCWCMqEokmwOK8WvT8LnjoCsA7mZmUFXSf+No31TjfTeOJKbhNOUNmQiOwxCjXVVzsrt6mWklOyYaMzLDHae63ihXaTCpfR6E4zCSKaKqsexUoOnswifiQ4eiks1+AKZksz82dDDadHbhk7ZMz1I3RlGnvTleAdRFikOEsb8AhJ1yHSA5agbnbaoaHHVCcjwz/ywx+EunPEcg7HYaBHC7OdO190G47oqrAuE6NPGhG6qrMDUrkrchaYMbrhKSNrhZ/gMeN1b10dA+ML3iReNe2JL3f/ZqQa0Qwu9nDhhE/hxmsmyRAwC6JjOWEJKI0j7DGF1y5cpwC2CP8z2F2XkiP2zr1nkAj3mLAZhpMbx3a3hnckiMTZfDTDYxErrgM92JRMLzlrcukrucgCi8nCcw+MSe2Xs6orMSbhUsoMnT6QwA1FaOtIHxqReN2G/+Ng9BAIA0Ked5DgMA12lkCwDlsn4ijNyia8d3zf7Ri78EpC1EPCthtlXC0qRYB6gXofc1YSNz/Is5rYZBtrp6EjCbpGkHEonEQFbCAED1c8k4GBudcM6fmnXscqd+06UlM9Dlt+2GeDz+BzADB+f1kTnNAL+kqhu6rHfv3Rr+2oVFmpkvQNd/jcfj9/24HR9oqKCBawyTVuk+zp+sxhyj0cMNocPT1WQmC8QxFqKztLS0KxqNWhPVZX1mAOCT1rw1uQX2oUn0+fT+4P5z3wd6p9JgpoyAvERCdEpN647FYobKd0bCAMBHzeF9ecXyodVB4kLOzwe2zzk+CS0Noj4B9OQEg12dnZ2mE8+sP2bjMEeTr6UD4eWBkCwdvzZ6Rwwd2TX7h3vrGEiBuVcX4uIzS5fGWlpaXH/ZZmxmAGBzY0H53AXWaRKcI23Y3+0INcZ/9w8CSIIopgE9L1+61LsNkNnwm9EwALB5V8EHJWWZjV0/BVpPNoW+gq539fT0XAXAM+39n8bfE7XcWzV66JYAAAAASUVORK5CYII=',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAR4SURBVFiF3ZhbbBRVGMd/58x2u7vQbmtvssSNAjaRiE8k8oAPBowkVTAGTVAJJMYXiTGYNFxisHiJ7ZMPQiIxxhRLCG1tjSBRubiAJEhiNDaFSlu6baRQELsI7e7sZY4PlKT2sjNzZvvC/3HO9//+33++M2e+GbiPIAqesYkSLNYgWAssBRYAFcBNYBjFBSTfkuR7GrhTSOnCmfmYcgTbgbeAoAPGOIJP8dPIVhKFKKEwZppYj2If8IAG+x8Eb7CNDq9lGJ7YCkGQXcBeIKSZJQi8zDNYHOMMu/XL8WYmxHvAbrx3WABPc5YsxzntJYke7m6tVk85psNCsZ4ddOqQ9Qr5hDJM+tF7RuwwimIxOxh1S5Racml2MjdGAMqBeh2i+840UYJiBGfHry7GSVHj9j3kvjMWa3BgJOQPjXe82BEz680htU2lzXpzqP2F9ljQF0w6UAlRzLNuS3PfmUa+Al7LW4k/ND68Zfhy2B9+fOpawkx0RfZEliSzSbsbsp/tbHJTms4z85hdQMtzLednMgJQVly2rLmu+RcHOkvdFqZjJmIXULe4blG+9XW16x4phM5U6JipsAvwS/+DXtYnUOm4ognomLltF5C20tds1q860PnXcUUT0DEzYhdwuPfw5XzrnZc647Yqgrw3ZCbomDlvF7DxyMYnE2aia6a10dRo1+bvNq+wVVH2OlOhY+Ynu4BkNhmM7Iksaetpi6Wt9CCQTlvpwUM9h2KRvZFHU9lUwFZFEHNbmPv3TAPzCfAXEHbNdY5bGCyknjE3JPeduTtifOma5w5fuDUCuoOm4n3guhbXHtdRfKhD1DNzdzzfqsW1x1ad8R+8flg1cgB4xVOOybA4GP0sukVKWVysVNAUorhIKZHNySIAn2FlslJaQoik3zTHll25kmiD3D26VzNh4HfgYU95AJmRiWhrZJ/vti/llKOUyAlF3CfVmZ54PO79k7eRlUAMb/8TVNWpiv3hiyVxXX4Wmr390AA4zhCrCCB4SjfF/IF5P1eeK//NQxVCWNYNvQNgKkx2AU7G+mnw3TGu1pysPOVF3gIrJ2V/Ycw0kEXyKg6G0MkQlshUn6r6WmREzj56FiiVFobREY/Hr3nfZvdwjFFWcRPB804pZV2lR8PdJXmH0jxQCnoCuVzrn4ODgzA3P85bUbxkF1b8t7/nofbIIQ2FpFLqD3y+X/v7+//34vZpJMsPgzeFKVYrQ5XPFiIzYqz6ZPURpymVElmE6lNSdkej0YuxWCw7U1zhOwMY7xprc/Nz38ySX1WeLT9Y1hXuzZdDKZGRWANCym7LMHr6+vpMO905MQNQtLPoQKY0M206CA0Fz0WO1vwwCy2JEJclXCoKhS52d3en3WgWfptNIOPPvC5TcqUVsKL3rhnjxo2aE5UnJscpGEepXp+UF55Yvryvra1N+2Sbs84ABN8JrkhVpU4roYqwyC34sfrzefHQCHALIfoMuLRhYKC3Aay5rKNgCLwd+EB8JJKlm0pbahctWl1bW7uQOb6J9wX+A8zucxGCTS9IAAAAAElFTkSuQmCC',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAARZSURBVFiF3ZhbbFRVFIa/vedSZkTbClJow1irNpGIvpDIAw+NIYghqTHig6JGIoLSGEK8xEhoKpKovBoJg1aCaVNpsYhIRINh1D5oDYaIvUhn2qGhNwi2RabtXM7ZPrQk0Ns5Z5+ZF/7Hs9e//vXvtXP2OgduI4isZ1S1d0JmPVAJrACWAYuAq0A/0A7qWzBOIaquZ1M6e2bU/kLwvAu8AQRsMMZAfAK+jxCbR7JRQnbMqAMbQYSBuzXY/4J6FfFas9sypCu2UgJ1sBpEI3pGmOSJo6jwbpRytbnuzHCwGtT7uO+wAPZAeJfbJHqYPFqNrnLMhAliI2LrMR2yXiHqUAGkYugfrfkwDMb9iO3DTomaxyz1HrkxAlAI8m0dovPOTN4jQ9h7/epiDDJFTu8hjc5k1mPDSBDvWDPrIkm29Cq2ppJs6T3KukgA37gNkSD4nnBamc4xq7SuxDvWzwvdT1Na4UeGAL8fGXqG0op+NkVtGrLUmQ4dMw9ZBdTxeGs+/odnWyvAv/IwFb9by6gVTgvTMVNsFbCBUNl8609x733Z0JkOHTOLrAL8yKVu1qew2HZFU9Ax859VQApz0GJ9wIbONdsVTUHHzJBVwAl6u+dbP0ZP3IbOvBsyGzTMqFariBc589gIqfOzrQ2TPP8ykdU2hCx1pkOnM2esAsZJB4qpf6CJnkgK8yKQSmFePEIsUkzdgxMYC6xlRMRpYRoTwKcLwXsJyHfMtY9RCJQgXko4ITnvzOSIccgxz5lIrVMjoD1oGnuAy3pcS1yGzF4dop6ZyfF8pxbXGjt1xn9w+2GlwvXA865y3AzDbAiVfVglpczLUyqQFCLPp5TIGNIH4PWY6YyUphBi3J9MJlb29Y00gXGD7tZMPnAOKHWVB5DXUyOhJz8Pey+NTtiWV8IQirhXql874/G4+09eFV4DRACPfg7UPbu+/zK/4VxcN0MGDrv8oQGIbS2g9rlJsfDHf1pcGAEQHtMscW8GgMFqwMZYPxPegWsDRW+e/NmNugmmIWUsO2ZETQbYhI0h9BZa2kgveefk1yKRNKyj54BSKeHxNMfj8cEsdQYQ22LAW04o+XV/ngq2xK9qKioFHXmGcSAWi/0NOflxHm4EnrUKy2sf6ly+4YsjGgrjSqm/8HrPxmKxWy5ur0YyK2wXycxalectnCtAJpKJJTuOf2c3oVIig1BRJWVbKBTqiEQimdnist8ZwNP3caVRXPDNHPnV4r2nGwpq/+iaL4dSIi0xe4SUbabH0xmNRpNWujkxA+Dr3VefXp4/YzoIRmK/FW9u/GEO2jhCdEu44AsGO9ra2lJONHNxzABIG2OvyGH/GrMwELrxzHMlcaVox/Gfbo5TMIZSXV4p2x9ZtSra1NSk/WbLWWcAAmdrVk88uvQX5RE+Mqax7PXmz+443TUEjCJE1AMXnuvp6aoBM5d1ZA0LWnd/IJL7x+/6qqquvKxsbXl5eQk53sTbAv8DzFJ5Mvw8/r8AAAAASUVORK5CYII=',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAQLSURBVFiF3ZnPT1xVHMU/983QYcbqlNZoCmEkqCxMtJsm+gfQ2KaJqaYurDHaZeO2dmH8lZg06qZLtYY0RhqkKFrd1KYJE2VhqiQG5YftDAwEShFpARmGN8y84wIxhQLvx8xA0pPczbzv955z7u97B+4hmLLXKN0PHASeA54A9gJ7gGngBtAPfAdcwpj5svOXBVIN0odIC0jyULJIHyDt2m7pqyEdRZr2aGJtmUZ6YbstgGSQ3kFyAhpZKQ7S20jlH/Y+zLxboom15a3tMnK0DD2ythSRnt9qI7tKmCNu5RZSTRBZVkA7bwK7A+a6oQZ4I0ii/wm3vI9MAtEghB6xADzsdx8K0jMH8WAkBgudkLRhVJC3YfQrSEYh54EjBjwbQJtPSF+4jfuYlJ2Rftc6uC31Rr1trJ9vhZlf3YR0Sl3rGVnBBanLg5lftsLMDTchtjSymRlbyngwM+5XWpAFwAZ2bBoCeZcY20DEhSmPMW4xqxBkAfjHLSAPN12+T3jgmfOs6D8EMTPpFvA9DG32/RvIeODZtEHKA+mc23iPSgu3pd715sstqbdaynmYMy1+pQXpmS63gBxEa+GxDkjmYQTI52GkHZK18PgiVHvgSfoVFmQB2AmMAXHfud4xC9RhTNZPkv+eWT5inPOd5w8tfo0Ex/IVebJCp+bJoKfmUgwdq5CZY0EllXZNlc4DgcnvQrHYlmhsfN2yrEhEitrGRKokUyhaVQDhkLNUsCzHGJPbYdvZJ8fHZzqguJJeqpk48BvQUFI9gDU/P5M4dOjT8NjYond6UzQiE7b002Amkwl6OVuGMbPAK9zROoEgac/p0xf9GFmmVwhLjxbg1YaGhobSzCzX2A18VEoVOy9f7o63tWVKURFynLryPO1IYaAbeNpvanhiYuKRAwdaTDYbuHcdcBw4W3rPABhTAF7GwyF0VdrS0tJDp059XYoRpLwJhTozmczN8pgBMCYNnPSTEm9tvRTr7p4OyCjBQKRY/CSdTv8BlXk4vwC86BYW6e8frD98uD0AQ05SL+FwTzqd/uvOD5Uw86Cx7WuKRDbcxa1sNlt35MjHkVTK05FFMgWMUrKsvkQiMZBMJgvrxYWDat4QxvxtjY+/Vqyt/Zb1G0u7z5y56GZEMksWzrCxrD4nHBpMpVI2wNDQxlelij1UV42Onl+qr7/rdBBLJn+uPX78hw3SchgzZMG1qlhsoK+vL++Hs3Kv7sPD1VY8/qdTU5NY+Sk0NTWVaG4+G5qb+3+YCBaQroctq/+p/ftTHR0dgVe2iv6FEO3peWZx374fFQpVUSgU95448dl9V65MArMYkwrBtZeGh6+/B04ldZQN1Vevvm9sO/fAl+2tTY2NzU1NTXVUuBHvCfwLna16k1MlopgAAAAASUVORK5CYII=',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAATaSURBVFiF3VhdbBRVFP7Ondlddvqz/aERARtFMUos4YFIH3iAxESICfCABtqkCRiJtjGRBBODivhH1PigEovFGKhJXWktpdgQfDCugEFrCEhbitvdditSKIhtge52d3bu8YE2AWx7d2a2D/o97jnf+c43996Zsxf4H4GyXXD25ta8MSOxiiWvAWERCPeCUQzCNYAGwHyOGIf90I5erX3mZja1s2Ym8EJDYZq0V0D8IgB/BpQ4gN0ez9h7wx9tGs5GD1kxk1sdXM+EOgBFDuh/E9NzN2s3HHTbh3BHZzJqvt7BhEY4MwIARUz8jVEdfB1gVw9Xc0M2qh95gwhvwv0KExFWeh7vTJu/Nh9zXMQpcXxrNbqpMQmkBNYnPt3Y4oTsqJGCl/YVmOasKJxvrekwpEv54MieyiG7REdnxjR92zEzRgCgMC3Ey06Itldm9ubWvIQ/PojMXr9OETdYu8fud0i3qzJmJFaB1UZyvHp8b1V5++qyuQu8mpiTsuTlIx0DvVvqTy6Lm5aKbyRE+kkAzXZ6s73NWPIaVU6OV4+Hd63tXbtk/gqvJkoBeL2aKF23ZP6K8LvrIoZHSyh1AKXO3bB/ZgQ9qkrZW1XeHpjleWyyWIHhKaurKv9FqcO0yHZrdgkAz1VlrC6bu2C6+FOL5z2QgZBS527YN8MoVqV4NTHHTXwcszPuaRxOXs03VAkpS15WxC9loHM9447G4WSbDaoyjnQM9E4X//bMhZhShjDtA5kMDsxQuypjS/3JZcNxs2Oy2HA81fF8Q3u5Uoah1LkbDs4M/aBKiZuW/+FXDz3UcvpCKGXJfgCplCX7m0/1hxa+1rowkbJmZaAUstua7QmgpLoxN07WnwACdrk2MDLqN+fhw6pROyTbK3NrxKB9dnn2wF/YNQI4HDR1ab0F4IoTbga4okt+xwnRkZmRPZVDIGx1wlWCsNXJ+H+L6gI5NcEGABVuatwBtoLFbdtrhBA+H7M/SeTzMFPaEh4A0DVppoWQRJTwJpOjZRcvDjcB1gTdlZnCLY2BlMc6A+B+dy4AkU4Olxz7uE4khsYy5TCTRYyYLvj4+Vgs5vovb171V8slUQhu7hMYHOhs+dL4oz3mtEIaqHd5OwPcqK04AeADNzX8g10nXBgBANKknOfaDACMlszZAUA91k8CbWzkUuBs049u9CUgLSGiWTGDnSvTuqBKgJVD6O0gaZmB35qbyUxa6uwpwJwiTTsYi8UuZ8cMgJHdG6JMYpsdjr//5FHfXz3XHEoyA90+y/osGo12AjNwcZ5TE2wE8LQqz3v90vni458ccCCRYOaz0PVT0Wj0jg+37QsNFYTJ1axZT7DQC6fOSY7mnw62ZVqTmdIgjrAQXaWlpd2hUCg9WV7WVwYA8jbXrpH+wkNT1Of8c23BnL6feqarwUymgOwjIbqkpp2PRCJJle6MmAGA/E21DZZR+K/pwHf195+L2vd/NwUtAaJeAYQ9htHd1dWVsqOZ9W02gevsfzY3NbqcvTmlE7+J5M2rgdMHvr89j4E4mHt0Ic4tXro00tTU5PjNNmMrAwBFle+XpwLzjzEJD6RlFZ1q+Nx3pXsQwAiIIhoQ3tjX17MTkNnQm1EzAFBQsettM3DfNv/FM81FnS37oevd4XB4AADPtPZ/Gv8AkvXQkIP4nXQAAAAASUVORK5CYII=',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAASpSURBVFiF3ZhbbBRlFMd/3ze7bXdp0yKlQI2NIqZlK8YHjDxgFEIikVhKAibeooH4otFIosFLgvdEn9QQHojxAkoIFChRMWBCXC5GxRgb6sJSWrrlDgXbUrrbndmZ44Mlwdru7MxsH/T/ON/5n//5z5n55swH/yOoomesb6rAMBaDNAExYAYwBbiC4hxwFORrKNlDouVaMaWLZ2bOksk44VeA5xEiBTDSiFpHqbxP267+YpRQHDONS5cjagNwkw/2n2j1DH+07gxahhGQr2hcthZhPRD1mSOC8Ag1DQ69yYNBiglmJtb8BvAWwTusgAVUN+S4nDzgN4l/M41Ll4NaTzHfO8UDVNe3c/l40h/dD+5ursKkC3/viBv6MKzbad/d55WofclZ8hoTYwRgMnb4ZT9E752pb6ogpC8WuP36RRoVnub1O+S9M4axuBAj0bLS9M6P18SzbdtPSaLVzLZtP7X9ozXxSKQkU4BKFKwHvZbmvTOx5i+BJ/JWUlaaPrf/s5OV5dE7R6/1Dw611y5YOSuTMfPfEKU2kWh9yktp3jujmO0W8tUHLx4eywhAVcWkORvfe+EXVx1HYl5L825GqHULWXL/PTPzrS9dOO82Vx3lrjMafnazKW4BJWFjepD1EVQXXNEI/JgZdAswLfuCy/r5AnSuFlzRCPyYuegW8E3815P51lv3/ZQqQCfvDRkLfswcdgt48tUP7+0fHGofa61v4Fr706+vm1cMndHwsQHID24hmYwZqV2wclbL3h/jpmX3AKZp2T1b9xyK1y5cdcfwsFnmrkPca2nevzONK8rBOoNQ6ZlbKBQDGOmbOfL9kBea9878PWJ87pnnBcKnXo2A30FTW28Dl3xx3XEJw3rXD9GfmfbdfShZ7YvrBiWr/Yz/EPTHKta8GXgsUI4bIc6WuqG257TWpaUikaxSpWERlbN1GCBkOFZOa0cplSnJZofmnD3b3wL2dXowMzNXVFJmtQG3BsoDaJz+uuHkhpBjDhfKEVG2ElIhLQeTqVQq+C9v47L5IHEkyHmCyFTrzKZK60rKb4IcbAx6OgO9yVNMbSgD7vObotweOFRtnv89QBVKOU6vvw1gNGr61wLuY/0YCIl5fpp5en8QeQccW+uu4piJx3NoHqeAIfRGKLBqzNM7lNi2e/Q4EDGVYexMpVIXgj9m13Ep2UdNwxXg4UIpVVbvd5W5y3mH0jwQgWSZbW873tPTAxNxcB5r3gascAsrdTLJW4aPb/WhkBGRI4RCv3V1df3jwx3ykSw/cvazKqQWCXryeCFa7KEaq+fbQlOKqBxKOkXrRF1d3bF4PJ4bK674nQGM+iVNthHeNU5+qTbPbqnK9Z7Il0NEWRqnW2mdcAwj2dnZmXXTnRAzAOHYQ5stSv41HURzgz/Xml17x6FlUOqkho5wNHoskUiYXjSL/5iNwEqnV+mInu+oUN31a4bkeqdlU/tuvIUCaUROhLQ+etfcuZ0tLS2+d7YJ6wxAZPaiecO6/IAIYUTsGWb3J5PsqxeBAZTqNKDj0e7uE2+CUwy9CTUDUFa/6J2sEX2pwurfMd0+8wWh0LGOjo5zgEy09n8afwEcs7T5cvn0GwAAAABJRU5ErkJggg==',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAS2SURBVFiF3VhbTBxVGP7+szPscmkq1FZqE2pvUYvYwpK0SUla0ib0iaf6oD6a+qDxoUlNvMTthZp4ifHBB22M8ZI0jVCqVk0gbeOKxAsJpAG3ENiBxdiWSypQdmd3Znbm9wGaCAKzc2b3Qb/HOf/3ff835+TMmQP8j0D5FjxwYGhdJlN0lIibmbEbwGYAGwDcBXCbmW8KIa6k0+mOWKw6mU/vvIWpqRkvV9XsK0R4CUBxDhQdwAe2Ld66cWPbbD56yEuY+vrRY8x8HkCFBP0vZhzv69tx2W8fwh+dKRzWIszcCrkgAFBBhEvhcPwNgH29XF9h6upGIwDOwP8ME0Bnw2HtdZ8iclhcWq1+NFaAw8zH+vp2fiVDlmpk796xBwIBR4P80loLM6ap7BgY2DrjlSi1zBSFX0NhggBAeVFR9mUZoueZWfiOqJPIbfuVhZ7JZB7y+h1SvLpkMkVHAXYNEgoJvaVlY09DQ8l2VaVKy+KJri59NBKZ2mcYrvyS4uJQE4B2L715XmZE3OxWEwoJvaNj62hjY+khVaUqAEWqSlWHD5ce6uzcGg8GKe2mwUyuPsvhOQwzHneraWnZ2FNWRk+sNFZWJmrOnNn0m5sGEe/22pvMBvCwW0FDQ8n2tcYPHizZ5qbBzK4+yyETZoNbgapSpZ/xBdCDube0AIkwNO9WYVk8sfY47uRgdC/nlhYhEYYn3Sq6uvTRtcaj0VQiB6M1X8hKkFlmPW4FkcjUvmTSGVhpbH7eGTh1amq/mwazu89yyGzNP7jVGAYXNzWN77x2LRW1LB4HYFoWj1+9moo2NY3vMk0OuTYmKOq5N6+E6upYWSgU+hPAeq9cD5izrNIt/f2VKS8kzzMTi1UnifCpV55HfOI1CCB50DQM5SyAKRluDpgyTeWcDFEqzOLx/IQMNweckDn+Az5/rMJh7QKAZ/xoLIV9cXr6yItCiGCQudggCqrMlLWFCgBKwLGyQjhElC4yjFTNrVuzbYB9n+03zHoANwA84isDAGZ9Njl7/LzjTGRy55BNjIQi+KehRCLh+5c3HNYaAEQBBORVmPXU+19Yme8TsgJZ4HOftzNAb++ObgDv+NGwzO5uH0EAgAKOs8V3GABYt+6PCADXY/1KYGf6Tjr59o9+/B3AsYXQ8hImGm3MAs6zAFwPoUthWXrq3XbmtO1euwqYTQoELicSiYm8hAGA3t5dGjOf9MIxMt92ZM3eu5KWzMBg0LY/0jTtd6AAF+fhsNYK4Cm3OierDc3PPf+lhEWamfuhKL2api35cHu+0HBH9gVm+whRsHy1Cnb0VDJ57rtcFZkpC+I4CxGrqqoajEaj2ZXq8j4zAFBb+0uzEJu+XkWfM6kPLxqZSyNraTCTJeCMkRAxJxAYisfjhptvQcIAQG1t9wUhNv/rdGCZPb/q8692rkJLg2hUAMNqSclgLBYzvXgWYJktYGbGeq6iYq6BaH3V/WeOMzOdTr55/Z91DOhgHlGEuPlkfX28ra1Nemcr2MwAQF3dlf1Ej3UBARWwbf3e6Y8t6+dJAHMgigeA4afHxkZOA04+/AoaBgD27PmmRVEePWka19sN/b3PoCiDw8PDtwFwob3/0/gbh/Lm30zcQi4AAAAASUVORK5CYII=',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAASdSURBVFiF3ZhbbBRVHMZ/58xeSgNCqRegsamt1EhEXwjw4AMmJGpAEhNoVOItxgdFQ1C5qqQiKiVRHtQIGuKDXNItFJGSoFFYpIltExIj9EK7WxbTUi7BFqHbTndm/r60CWDp7MxsX/ge9/y/7/t/55ydOXPgDoLKtWDVQZnkDPGUgiUIs4DpQCFwBTgv0KLhpwE4UlmhrufSO2dhPtstBSrEOhRvAxOyoKSV4stIiC2rnlV9ueghJ2GqYrJUYAcw1Qf9H6V4fe0yVRu0Dx2ELCJqS0w2CsTwFwRgqgj7qqrlQxEJNLmBwmzdx0bgI4KvsBLFpqp9vB9IxC9xeGvFgmiMAkdg6foKdcAP2Vcj2w7IFDNDEv9bayz0Soay9ctVr1eir202lGED4xMEoIAQq/0QPa9M1UGZJCYXye7x6xfpQbjP63so5NVl+IXoGiQSIr14Lk1l0ynVmmmOw4WOHjrrGpln2a78/KjwJLDfS2+et5mCJW41kRDpFYvpnFnEAq0pBiJaU/xQEQveeoZEyGAgFz63wvt/RnjYrWTxXJoiYR4ZbSwaZvaiuTS6+ihmeW3NzwNghltB2XRKxxovn8EDufC5FX7CFLqKaqYFGR/G3Vl3NKLrlQBccytwHC6MOS70ZOHzb9YdDcNPmItuBR09dI413t5Nyk1DMfaEjAY/YZrcCuoamWdmODXa2OAQpw43Md9NQ5S7z63wHkZxzK3Espnw1SEebOsi7jicA4Ych3NtXcS/rmOmZZPnaiPEvbfmEZUxmZgHXcBkr1wPuGoMUrT6JdXvheR5ZSor1HWE773yPGKn1yDg86ApFpuAS364WeCSZNjsh+grzPDxfJUfbhZY5ef4DwE/rLbEZDfwQhCNG+HY9t7ta0tXaK2jUZEJplLRsIiybB0GCBlOxtLaUUoNREyzf3Z3d18N2CP8oGEmA38CJYFSABnzel/tF0/vuNbbNZgtR0TZSkiFtJxoS6VSge4A1lWoq8CL3DA7/iDScPjTg16CACglBlrKLHi5pKSkJFAYgHUVql6ErUE0Uqd/qT/TsDcVQEIZjlMUOAyAeS8bIYtj/Sjo7+vpOV797vEg/g44ttbJnISpfEJZ2mE5WRxCb2rCzmSO16zZnzH7/W9TkSFlGLWpVOpCTsIArHlOJQXe88Jp+WPXkfMd9Vd8WopAa9S2tyeTydMwHhfnMYkJLHOru9LT0nZg26JqHxYDIvIXodDJZDJ504vb84WGGwyLN00xFxrhaMHtaiyzv//onpV12WqKKAslCdG6ubi4uDUej1uj1eV8ZQA++LZ7ycQpM368jb40HNq89/SJnR1jaYiojMY5q7RudgyjLZFImG6+4xIGYMM3f+++q/D+/50Ous7EG47sfPXn29AGUKpTQ3s4P7+1ubl5yItnzrfZCCJ59muD6d7H8/ILikd+S1+7fPnYnpW/3VgnkEakI6R1y6Nz5iRqamp8P9nGbWUA3vn85Px7ih77XWkj7NiWffSHN75Ltfx6EbiKUgkD2p8/e7ajEpzx7CNnWLm16eNP9pgDr6yu3lVeWrqwvLy8iHGexDsC/wHqq7fSQTg4DwAAAABJRU5ErkJggg==',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAARmSURBVFiF3ZhfbBRVFMZ/d2Z3y1aatoCAbVyxahON6AuJPPDQGIIakhojPihqJCIoxBDinxgJTUUSlVcjYTENYNo0UCiKRKrRdFUetJGEWAuE7rZLA+VPg22Fbdk/M8cHtkmtbWfmzu4L3+Pc833nfPfczD0zcAdBFVqwCSnLwdNAPfAIcA8wH7gODAJnBI5Z0LEZdbOQuQtmZjdSacIHwNtA2AVlTMHnQfh0HWqkEDUUxMweZI2CKDBPg/63wBtvotr91mH4IQui9iINCg6hZwRgnoLDUWS7IL4215eZvdAg8BH+O6yAHVHY5ldEC/mjdciPxjSwFazZgDqqQ9YqZB9SkYEE+kdrNgxb8MAm1LBXotYxy8CHFMcIQKUB7+kQPXcmf49cxd3rVxdjOVjk9R7y3Jn8hehoJFDK2Kp2YuvTDGwQMuvTDKw6TCwYZtxFmtIgPOW1Np1jVu8UEChl7OVB+pY8R50RIgKEjBCRJc9Tt3aQuEtDjnmmQsfMw04BTzbTFSrn0enWQhUsrTvA704acnsU8gQdM1VOAZHV1My2ft+z3F+IPFOhY2a+o2iIxX7W81jguqIJXa8E4IZTgJ3hisP6ZRd5/nFdUR46Zq46BQx8S99s6/1HSbrIM+uGTAfPZgS6nGI6X+GJzAjd062lh+mOvcZyF6kc80yFTmc6nQKy44Rbqniwv42YneECkLEzXEgcJNZcxUPWLeY4aSiIeS3M8wTwBTI3ABeBcq9cDxgNQ/WrqJQXkufO5EeMfV55XqCgyasR0Bw0LdgBXNPhusC1HOzUIWqZyY/nW3W4LrBVZ/wHnx9WUaQFeMmPxmTYWK2fRGo2G4ZRUiISTitVEhRROcsIAgRMO5szDFspNR5Kp1NLL10aaQNrgu/XTDlwGljiywWQMW6O7K96JjoauHjLLUdEWUpIBgz59VwymfT9yRtFVnD7NWrqq4h0zN/2VXdZa1JXIAcHfP3QANiIOimwy49G710/nPRhBECZtl3t2wzAFWgA57F+OtwwL18+seCdn/3kt8G2DCNREDONqBywFhdD6GRYKpv97u73j6RVynKOngEiGWWa7clk8kpBzABsRCWAd71wTpc1dwzMOXldM6UInC2xrD2JROIvKMKP8yhyCHjBKW4odObc/qrVBzVSjIvInwQCpxKJxH8u7oCGmBM25VR6ZUBKKmcKyKhU6puFW467FRRROZTExTB6IpHI2VgslpsuruCdAfjMvFRfYVV9PYO+dFbubP2jvKl3Ng0RlTWw+5Vh9NimeS4ej6ed8hbFDMCu4EBLefbe/00HfeHYb0cWrft+Bto4SvUZcD5YWnq2p6cn4yVnMY4ZAGNZ6/WQMbwibFdGJp6lzKGh4wu2/DQ5TmAMkd6AYZx5bNmyeFtbm/abrWidAWgMn1q++NbjvygxgzY569jCt77sLf3xKjCKUnETzr/Y39/bCHYx6ygYts/p+ni3So9vnnuwubamZmVtbW01Rd7EOwL/Ai1BeTIkgAbWAAAAAElFTkSuQmCC',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAQMSURBVFiF3ZnLT1xlGIef78zAMFgCeGscLCGoLEy0myb6B9SIMTXW1IU1Rk3cGF16SYy3xMRUN8aVWkMaY0lDUbS6qbcwKjGmSmKwXKQzMBAoINICMgxnLufnoqWhCJzLzEDSX/Ju5rzved/nu39n4BqSKfULhWqAVuAh4E7gFuAGYA44DwwAXwGnDWap1PlLIqF6oXeEloXkwdJCR4Tqdrr2qyR0SGjOI8R6mxN6ZKcZEDJCrws5AUFWzRF6Tajkw94PzBtFQqy3V3cK5FAJemS9FYQObjdIXRFzxM0uCNUHqcsKyPMKcH3AWDfVAy8GCfQ94S7vIzNANEhCj1oGdvvdh4L0TCteQKpZpos4NuOILDbjfEacKBkPOaqB+wPU5k9Cn7qO+2qlNa8/tZEuqk9RTxvrJ9sB87trIV3q3hBkVSfV7QHmt+2AOe9aiK2xLWFspTzATPqtLcgCYAOVLk5ZFx8bQ8QlVdZg3HyuUpAF4F9XjyzTLs+nPORZ9FjPFQWBmXH1+JqRLZ9/QcpDnq0bpBQSOuY63qNa1kX1bThfLqhPVcp4mDNtfmsL0jPdrh4ZosS4nU7iZBkDsmQZo4M4Me5ghSoPeeJ+CwuyAOwCJoBav7E+tAA0GEzaT5Dvnrl8xDjmN86n2vyCBJYuXZFnynRqngl6ai4G6HCZYA4Hramoa6pQOxA4+XoVKJxobmx+zrKsSESK2sZEKiSTL1gVAOGQk8tblmOMyVTadvquycn5TiisxhcLUwv8ATQVRQEsWUvzB2IPfDQRnljxnF+mYEQqbOnnoVQqFfRyBoDBLABPsKZ1gkhIR+rfPuUHBMAYhbB0Wx6ebGpqaioKBsBgeoB3i3nHd9d929NRcyJVTBkhx2koyacdoTDQA9zjN3Y6NDXVeut9bWmTDty7DjgOHC26ZwAMJg88jpdD6BrlTC738k0vfV4MCFLWhEJdqVRquiQwAAaTBF7wE9Nec/z0L1U9cwFTSjAYKRQ+TCaTZy/VUGIJnQQedfMbqhwYOhB7sCNAioykPsLh3mQy+ffaB+WAudE29nBEkU138WWTTh9sePiDkXDC05FFMnmMErKs/sbGxsF4PJ7fyC8ctOjNZDD/TFqTT8UKsS/ZuLH0ft17p9xAJJOzcEaNZfU74dBQIpGwAUZGNr8qle1D9XjFePue3J7/nQ5+jMZ/fWb3099sEpbBmBELhiuqqwf7+/uzfnKWDWaU0apaq/aveqe+cfW32dDsbGts/9HF0OKVYSJYRjoXtqyBu/ftS3R2dgZe2cr6F0JvtPfevSt7fwopVJEnX3j+5mc//qH6+xlgAWMSIRh+bHT03JvglLOOkulM1Zm3bGNnOnZ1HG9pbt7f0tLSQJkb8ZrQf5kyepAtajIBAAAAAElFTkSuQmCC',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAASoSURBVFiF3VhNbFRVFP7OffMY6EjnvYGMrW2atmijRNyUBJcsTGRFQkJTKwpuXBliSDQxGolVEo0rjAuBhLCRGFuL4AoXTauWaBtNTHHoD/NHImXoOH2vY9+Uzvs5blpSoO37m7rgW777feec794zb867wGMEqnXAYrG4XQhxgIgOAtgNoBHADgAlADMAbjDzD7ZtX00mkwu1zF0zM7quq47jvAfgOIBtHiQVAF8S0Weqquq1qKEmZkql0mEiOgsgEUA+R0Rvqqp6KWwdIoyYmUnTtJNE1IdgRgAgwczfaZr2ITOH2txQZnRdP8nMvQh/wsTMH+u6/kGoIEGFy63VFybGGnCI6LCqqt8HEQcqRNM0hZkzCN5aG4YXQuxSFEXzKwzUZsz8PjbHCACojuO8G0To+2SKxeJ2SZLuwtvrNygqlmU96fd/KOI3ixDiADwYIaJKLBYbk2W5HUADgIJpmlnDMPYxs5u+TpKklwEM+KrND3m5yIMeOJV4PJ6VZXk/gBYAWwC0yLK8Px6Pp4losRZ5HkaQ38xzboRYLDZGRM+vtUZEe2Kx2KhbDGbe7bewIGaeciMst9ZG621uMYjINc/DCGJmhwdOQ8h1ANjpgfMAgpj51wOn4LJ+x0OMsgfOAwhi5q4bwTTNrMt63kMetw15BL7NMPOYG2f59Xt9Hf31SqXyolsMInLN8zB8mxFCDLlxmHnb/Pz806ZpDgO4BaAK4JZpmsPlcvkZx3G2ekg17Lc23xPA7OzsE5FI5G8Acb9aH5ivVqtNDQ0Nhh+R75NJJpMLzHzBr84PiOi8XyNAwKlZ13XVtu1JIkoG0W8EZp6VJOnZ/21qVhRFI6ITQbRuIKITQYwAIT+s5ubmLgJ4NUyM1bBt+5vOzs63hBDRKPO2JaKozEyWLWQAiEiOaQnhENHilqUlY8/t23o/YK/ow5qJA/gTQGsoFwAMw9CPdHefnZmZuedVw0w2MfIRwb9M5vP5UHcAiURiHsDrWLU7QcDM/MXp01f8GAEAIpYgeJcFHGttbW0NZQYAEonECIDPw8T4aWho5PLAQD5ECJIcp6kmlxHMHNE0bQTAPr/au4XCnVe6us4bhhH4dB3AcYBzoU8GAIjIEkIcgbch9D4syzJ7e3sHwhgBc5Uk6VI+ny/UxAwAKIqSAfCOH01/X9/V30dHSwFTMgMTUds+k8lk/gI24eJc07Q+Zu5y401PTU2+1tPzbYAUi8w8jkjkj0wmM7t6oeZmyuXyTsMwpqPRqLpuNZWKcezo0a/y2aynkYWZLBCnWYhUS0vLxPDwsLUWz/ftjBvq6+v/SaVSbzQ2Nl7G2pvF586cueJmhJlMASdHQqSciDSZTqeXACCbXf9TqeYns4Lx8fGLzc3Nj0wHv1679tvbx4//uI5sEURZAUzLdXUTqVSq6ifnppnJ5XJbmXlKUZSWlWelUqnYdejQuYWFhfttwkAFzDcjQtx4Ye/edH9/f+A3W83bbAVtbW33hoaGuuvr638WQsiWZdmfnjo1sGxkHkRpCZjuyeVufgQ4ADCVy21WObXB4ODgJ4VCYfHC+Qtfd7S3v9TR0dGETeyIxwb/Abxf6DIUZxAeAAAAAElFTkSuQmCC',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAS9SURBVFiF3VhNbFRVFP7Ond9OlBnApihJM1N0EqltQzoJLFxAQiKrruhCjXFh3GhcEGowGomiJEhYUJtUiTFCGEJsBX9CU2pQqzZB6WtLOgw0MNN5TUSggtNp6Tw6fe8dNyWp0Pa9d9/Mhm8593zfOd+9J/educAjBCq34MDAwOPBYHAHM7cQ0UYATwJYC+AOgL+J6LJpmj+EQqGz9fX1d8uZu2xmRkdHV8/Pz7/DzG8BqLJBKQLo8Hg8BzZt2jRVjhrKYmZwcHAnER0BsEaC/i8Rvd7c3HzabR3CDZmZSVGUvUTUBTkjALCGmb9RFOV9Zna1ua7MDA8P7wXwIdyfMAHYNzQ09J5bESkstFaXG40lYBLRzubm5m9lyFKFjIyMRAzDyEK+tVZC3u/3b2hsbMw7JUq1ma7r76IyRgBgdalUeluG6PhkFr4jt2Dv+pVFsaqqqsbpd8jrNEswGNwBG0aEEMVYLHYhHA7XEdE6Zr5ZKBTGc7ncZtM0rfihYrH4AoBTTmpz3GbM3GIpKkSxqalpPBKJbCWiWgB+IqqNRCJbGxoaMkIIzUqDiCzzPJTXKYGInrWKicViF4QQzy215vV6G6LR6J9WGsy80WltMhfAU1YB4XC4bqX1SCQSs9IgIss8D0LGzFobhaxzs76AJ2xXtAAZMzNWAcx802L9ho0807YrWoCMmVtWAYVCYXyl9ampKdVGnhU3ZCnImLlgFZDL5Tbrup5aak3X9ZSqqlusNIjIMs+DkLmaf7GKMU2zKpVKPZ3P5/uZeQJAiZkn8vl8fyqVesY0zaANjX6ntTmeANLp9GOapv0FIOyU6wAFn8+3vqmpadYJyfHJ1NfX32Xmr5zyHOJLp0YAyUEzEAjsAzApw7WBSb/f/7EMUcrMwni+S4ZrA7tkxn/A5R8rRVFOAHjJjcZiGIZxsrW19U0hRCDAXDVHFPAxk24IHwB4Pea8LoRJRJp/bm624fr1qW7AuM93ayYM4CKAqCsXADRNm9qze/eRycnJe3Y5zGQQQ/UK/n1MVVVXbwCJRKIA4BUs2h0ZMDMfP3bseydGAICIPRC8QQdejUajUVdmACCRSAwAOOhGQxkcHPj53DnVhQR5THO9azMAMDMzsxeA5Vi/FO7cvn2js6PjVzf5TcA0hMiWxcy2bdt0AC/DxhC6GLquz3/W2XlK0zT5NmUukcdzWlXVm2UxAwCJRCJLRG1OOD/29Z29NDp6RzIlM3AlYBifZ7PZS0AFHs4VRekC0GoVN6GqY3va2r6WSKEx8yi83qFsNvu/D7fjBw0beKNUKm33+/2rlwu4p2mz7e3tZ+wKMpMO4gwLka6trb3S39+vLxVX9pMBgN7e3pbq6urvltHn40ePnuw5c+baShrMNC9g5kiItOnxjGUymTmrvBUxAwA9PT0nampqHpoOLo6M/HFg//6+ZWgaiMYFcNUXCl1Jp9MlJzkr0WYAgFAo9Nr09PTzq1atqr3/W6FQ+OfTw4d/WhzHQBHM17xCXG5MJDLd3d3SN1vFTgYAksnklng8/psQwqfrunH40KEvFEW5BaAAoowHuPpiLnftA8CsZB1lQzKZ/Oj8+fPawU8OJuN1ddvj8fh6VHgTHwn8B/S71Ufd4vUbAAAAAElFTkSuQmCC',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAATTSURBVFiF3VhPTBRXHP7e2xmBTYwgDXVdQ6m2hxrsyaweeoCkSXtQExOZ0JLSQ9NLmx5MbGya1P49NCRoQg9UG1MTA5RZEbegsYemVE1gMU1JBRZhF9dkccHGAkUXZmfe/HooJJTCzs6b5dB+yV7m/b7v9/veezvvNw/4H4EVWjASiWzNZrOvAjhCRHsBBACUA3gE4AGAUQDfA7iuadrjQuYumJm2trYyRVE+YIy9B6AkD0qGMfaVoihfHj16dK4QNRTEjK7rxwCcBbBdgv4HY+zturq6y17r4F7IRMR0XT8FQIecEQDYTkSXOjs7PyIiT5Pr80Kurq7+GMCn8L7CjDFWG4vFrHA4fENaRJa4vLV0LxrrwAZwTNO0bhmyVCHd3d2lpmkmIL+1cmHWNM09DQ0Ns26JUv8Z0zQ/xOYYAYAyRVHelyG6XplIJLLVMIwZ5Pf6lUUGwNNuzyHFbZblA9HRiKIomVAoNBgIBHZzznfYtj2dTqcno9HoASGEE99PRK8A6HJTm8w2O+IUoChK5tChQ5PBYLCGc14JYAvnvDIYDNYcPnw47vP5FguRZy1cmyGiF5xiQqHQoKqq1euNqaq6LxQKRZ00GGN73dYmszI7nQICgcDunAI7dz5biDxrIWOm3FGU8x1expfxVN4Vrei6JQBYcAqwbXs61zgRpfPI82feFS1DxsyMU0A6nZ7MNT41NZXMI0/OCVkPMmYGnQKi0egB0zTvrDeWzWbvDA4OHnTSYIw55lkL12YYYz85xQghSnp6ep5LpVJ9tm3fB5C1bft+KpXq6+3tfV4IUeykQUR9bmtzfWgS0WUALQC25YoTQpT09/fXrHr0zPIvH8wvLS25/r5xvTKapj0mom/d8lzifGNj4xO3JKlG07KszwA8lOHmgYemaX4hQ5Qys9yeH5fh5oHjMu0/4PHDStf1NgCve9FYDSFEx8mTJ9/lnBcVEZUYjBWpRMwSXAUAxWebFuc2Y2xxi2E82Tc1NRcGxArfq5ltAIYAVHlyAcAwjLmW06fPzs7OLuXLIWKCEZIKp5tjyWTS04WGpmnzAN7AqtmRBF27ejXixggAMEY+cNpjAW9WVVVVeTIDAJqm3SKiJi8ao8PDt24PDCQ9SDCfbQc9mwGAioqKUwAc2/r1MD83lw53dv7sJb8N2ILzREHM1NbWWrZtNyCPJnQ1hBDmpXC4yzAM+W1KlGU+3+VkMjldEDMAUF9fnwBwwg0n2t9/PTEx8UgyJREQKxLi60QiMQxswsW5rus6gDqnuOl0eqzlzJlOiRSLRPQbFOWXRCLxj4PbdW/mBMuy3iGil1VVLdsoJmsYTzra23vz1SRiFhjFifORysrKWF9fn7VeXMFXBgDOnTt3pLS09MoG+nStp6fj1s2bE7k0iJjJYd9jnI/YPt9YPB43nPJuihkAaG1tbSsvL/9XdzB+9+7AhfPnf9iAtgjGJjkwrvr9sZGRkaybnAXfZisoLi5+K5PJvOT3+ytXni0sLPz+XXv7j6vjCMiAaELhfPTF/fvj4XBY+s22aSsDAM3NzQeDweANzrkqhBAdFy9+Mzo6OgNgHozFfcD4a/fuTXzy94W5Z2yqGQBoamr6fNeuXSeGfh3qutJ16QIUJTY+Pv4AAG127v80/gIGr+iWe+FGsAAAAABJRU5ErkJggg==',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAToSURBVFiF3VhdbFNlGH7ec05/F6IUE9GLIYgXXYpXJBBZE0xM9EausIl6ObzBGSHRdnEJ1p+RhnBBNF4YY/xJFigNaIwxLpFYB2WwMWCW0bG1W7eEdUBwQ0fb7fy83nQJjK3nnO90F/okvTnf+7zP+/Q75/ve7wP+R6BGJ4xGo+skSXqFmfcAaAHwFIANAO4CmCai64Zh/OT3+3+Nx+PzjdRumJmOjo71zNwB4B0APguUMjN/vri4mDh27NhcI2poiJloNLqXiL4EEBCg/8XMbx05cuS00zpkh3yKxWKHiOgLAH7BHD4iiuzatcvIZDJnnRTjyEw0Gv2QiD6C8xkmInqxtbVVy2QyvcJJRIm1V+ukkxwrwCCivYlE4gcRslAhBw4ceNzj8RQg9o2YYZaInk0kErN2iZKImtvt/gBrYwQA1gN4X4Roe2ai0eg6IroFa8uvKMo+n+9Ju/uQYleltiGaGnG73eVIJNIfDAa3yLK8Udf1mVwuN55MJneoqmrG91er1ZcBnLJVm51gAKjt7HXhdrvLnZ2d46FQaLcsy80A3LIsN4dCod2dnZ15l8tVaYTOcoh8M0GzgEgk0u/xeEIrjXm93m2RSOSiBZ0Wu4WJmHnaLCAYDG6pN97S0rK5ETrLIWJmg1mALMsbnYzX8ITlimoQMfOPWYCu6zMm4yULOn9brqgGETO3zAJyudx4vfFr164VzXIwc90/ZCWImOk3C0gmkzuq1Wp2pbFyuZxNpVI7zXIQkanOcoiY+d0sQFVVX1dX19ZsNpvWdX0SwKKu65NDQ0Ppw4cPP6dpmtcsBzOn7RZme9P0+XynK5XKZwAeqxenqqqvu7t79wOPNtV+VnDPMAzb5xvbM1NrMb6xy7OJr48ePXrfLkmo0SSijwHcFuFawG0i+lSEKGSm1p4fFOFawEGR9h9weLCKxWLdAN5wkuNBMPPxEydOvC1JksfD7Fsg8riYSdMlFwAosqFqkmQQUcW9sHB/282bcylAX+LbXgCWYT+AFwA84zAPVFWdO9PTM+WWpHcBQCeCAoCJICsMAGAQZGaAGZrLhcubNutbGUVF4rMjxWLR8ZE3Fou1AkjDwX0CM/OVwcHvJwqFomgKDfjO6e0MMpnMVDgc9gIIi+YoTU+fyw4NXXFQBpFh3BFaAJbD6/UeAmClrX8ElXK5dOnixT+c6BuAoUtSoSFm4vG4ZhjGm7DQhD5UhGGoAwMDp1RV1c2jVwHzIsny6WKxOOP4NVvC+fPnZ8Ph8F0Ar1rlFPL5X8bHxuo2pXXADIx4df3kjcnJSWANLs5jsdhJAK+Zxd2bmxv5racnKSBRYeY/oSiDhULhoY3b6dL8CDRN209EL8myvH7VGFW9f6Gv72erOZlJA3GeJWm4ubk5l06ntZXiGj4zANDe3r6nqanpx1Xyc/bq1eOjN26M1cvBTKoEY4IkadiQ5ZF8Pr9gprsmZgCgvb29u6mp6ZHuYKZUupDp7e1ZhVYB0bgEjLr8/tzw8PCiHc2Gv2ZLmJ+fb1MUpdXj8TQvPatWq3f6+/rOPBjHQBnMY4okXX9++/Z8KpUSXtnWbGYAYN++fTsDgUAvEbkMw9AvnDv3ValUugXgHojyMjD6+sTEWBwwGqG3pmYAoK2t7ZNAIPDe1OTUqSuXBr6FouRGR0enAfBaa/+n8S8PPeWMetb8+wAAAABJRU5ErkJggg==',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAATISURBVFiF3VhNbBtFGH0z3vXGbqpSikQBKSIOHKgop0quYtMadSsqVfRCoQo9IjiAuAXJ4lB+D0Q5Ig4VQvxIVZREKQhRRNoiNi2VcBECUaUNjmM7VRPHcdP81HGc/ZmPSyKVNMnuzjoHeEfPe9/73s54dnaA/xFYowsmEont0Wj0iBDiGGNsD4BHAOwCMANgEsB1IvrOcZwfDcOoNtK7YWGOHj260zTNNBG9BSDiQVID8Ilt2x8bhjHXiB4aEubQoUPHGWOnATwoIb8D4LWLFy+eDdpHKKCeHT58+BSATwFEJWtEALzc2toqCoXC5SDNBAqj6/q7AN5H8BlmjLHnYrGYnc/nL0kXkRWuLK2+IDXWgWCMHb9w4cI3MmKpRlKp1AOKooxB7j/ihllN09rOnTs361fIZdwURXkHWxMEAHaapvm2jND3zCQSie2RSKQMb9uvLGq2bT/s9z2k+HWJRqNHiMg1iKZptXQ6fTUej8dUVd1tWdZUJpPJd3V1xev1ups+qijK8wAG/PTme5kJIY65cTRNq/X29uaTyWRKVdUWAGFVVVuSyWSqp6cn19TUtOTBytVnLXyHYYw95cZJp9NXt23b9vR6Y83NzXs7OzszHqz2+O1NZgN41I0Qj8djm423t7e3NsJnLWTC7HIjqKq6O8j4Ch7y3NEKZMLcdSNYljXlMl7y4LPguaMVyIQpuxEymUx+s/ErV64UPfhs+kDWg+8wRHTVjdPV1RWvVqvX1hurVqvXuru793uwcvVZC5nd7Gc3Tr1ej3R0dDwxNDRkWJY1DsC0LGvcMAzjxIkTT5qm2eTBx/Ddm19BKpVqVhTlFoAdfrU+MM85f+z8+fOLfkS+Z2bliPGFX50fMMY+9xsEkDxoapr2AYBpGa0HTIfD4Y9khFIfZ6Ojo/VYLDYJ4EUZvQteHxwc/E1GGOjDStf1MwBeCVJjDXqy2eybnHNNI4osM6apRMx2uAoASkhYNueCMbYUXl5e3DsxMdcPOKvioGF2ENGfjLHHg2UAhBBzpVu3TlumWfeqIWIOIxQVTpdHisVi4E9eXdeTAAwEuE8gIpqpVL6uLiwUZUvYwFdBb2eQz+dvtrW1NQF4VrbGUq32y+zMzB8B2mBMiIrUbrYWlmWdAuDlWH8fbMsqzUxPDwXxF4BwOB9rSBjDMGwhxEl4OITeCyKyKpXKgOM4jjt7wyImC4XOFovFqcDLbBWFQmE2FovNAHjBq+buwsIP1fn5TQ+lm4AIGGlynL6/x8fHgS24ONd1vQ/AS248yzRHJm7e7JWwWCKiv6Aov4+Njf3rxe37QsMNtm2/wTnXOec7N+KQEIvlcvl7rzWJmA1GOeJ8uKWl5YZhGPZ6vIbPDAAcOHDgWDgc/naD+jR7+3bP/Nzc6GY1iJjFIQqM82ERCo3kcrllN98tCQMABw8ePKOq6n2ng6Va7dfy5OTgBrIlMJbnQFaNRm8MDw+bfjwbvsxWwRh71XGcZCgUaln9zXGcynSp9NO9PAJqIBpVOL/+zL59uf7+fumdbctmBgASicT+SCRyCYBKRE6lVPqsVquVAcyDsVwIyHYUCqPvAaIRflsaBgCSyeSHmqZ1Lt5dHLhze/pLKMqNbDY7CYC22vs/jX8A/Nff8x41WYEAAAAASUVORK5CYII=',
                    anchor: [
                        0.5,
                        1
                    ]
                },
                {
                    src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAPjSURBVFiF3ZlNbxtVFIafe2cceyZxEitfqiMs1EUWSLDqggXskOiGSqCyoAj+AH8BChISAv5ABahCBaoGJziISAhWMR8LECBQUNo0cZpJpLQNVWMDTZxre+ayMIGQOp7J2DMFXuls5p57zvver7lzBv5HEBHETAMngVPAA8AxYAi4DVwHLgOfAJ8BdyLI3xVkgDeAHUAHsG3gdWDwXpBth9M0Rz6IiIN2G3gqfsp3QwBnAY9wQvbMA14immUfGC/TmYiD9mK89P/GaTqfkYPmAk/GKQKamzbsHvGzLZqHSWx4MwIR++21uISkCX78hrVtoO+oxGQIMScBy8/Jtu2dQqFQVEqta61rSqn16enpomVZ1QA5bODxENyOjPfxGVnbtrcrlcrPugXK5fK8ZVlBZvZCHGK+9yNSKBTmWgnZQz6fnwsg5rs4xFz3I6KUWmsnRinlBBCzcVRiYd64Cuhp56C1rvn4KCFE0idPDfDz+QfCHAC/+znUarWbPu03AuT5LTCjPxFGzKafw+zs7LV27TMzM06APG0HpFt4F5/1blnWTrlcnm+1X7a2tuZTqVTVLwZwPg4xzwcgoi3L2snn83NKKae555UzOTk5F1CIBp6LQ0wfUAlIKKxVgN6jEguzZ+7QXGpR4jzNK00syNA8CKKYlU1ivjUDnOkC8VZ2JiyhTj9TL3aSvAUu5XK5F6SUyaTWlhIimdBaNFyZADANr96Q0hNCVHuU2n5wY6My1fygAzoXMwD8BNzfYRyklJVcNvuWaZq7QftoLVyhcUypv1p0HKcbBYRHgCJgdBBDjwwNvTeQTjth+zfgQicE9rAOpIBHwwbo6+39ejiT+bEDDkJ43q0wR3MrnAW+DdPRNIwbY8PDX3SS3APPlXKlW2IawLMEuITuhxCiPjoy8pEQwvX3PgRa14RhFBzHudmNZbaHMs2KzRNBOwz29386kE63vZS2gdawmHLd/NW1tTWIpoKYB572c0r29Czel81+GCJ+VWs9j2n+sLKy8sv+hijEDAshlrTWh77FpRDb4+Pj55KmGejKorVoIHRJS7mQy+WuFIvFRiu/SGq7hmGccl3340Pi6+FM5tLgwMByuxhai7rEWxVSLniGsVgqlZRf3sgK1YlE4mK9Xr/rdmBb1jfZsbHPD+lWRYhrEpYStn1lYWGhdpScUVbdU1LKq57n5fYeGIZxK5fNvm0Yxl/LRMMOWi+bUl5+6MSJ0tTUVOiTLdJfCJZlPby7u/ul1joBuMdGR9/pte1N4FeEKBmw9Mzq6vIrzQL8vx+pVOpVIUS1v6//g4njxx+bmJgY5x7/h/lP4A+AJ7grnrOyCgAAAABJRU5ErkJggg==',
                    anchor: [
                        0.5,
                        1
                    ]
                }
            ];
            if (!this.options.labels) {
                this.options.labels = {};
            }
            Object.keys(Drawing.DefaultLabels).forEach(function (key) {
                if (!this.options.labels.hasOwnProperty(key)) {
                    this.options.labels[key] = Drawing.DefaultLabels[key];
                }
            }, this);
            if (!this.options.defaultStyles) {
                this.options.defaultStyles = {};
            }
            Object.keys(Drawing.DefaultStyles).forEach(function (key) {
                if (!options.defaultStyles.hasOwnProperty(key)) {
                    this.options.defaultStyles[key] = Drawing.DefaultStyles[key];
                    return;
                }
                if (key == 'polyFillOpacity' && (options.defaultStyles[key] < 0 || options.defaultStyles[key] > 1)) {
                    console.log('Wrong value (' + options.defaultStyles[key] + ') for defaultStyles.polyFillOpactity. Must be between 0 and 1');
                    this.options.defaultStyles[key] = Drawing.DefaultStyles[key];
                    return;
                }
                if (key == 'strokeWidth' || key == 'polyStrokeWidth') {
                    var intValue = parseInt(options.defaultStyles[key], 10);
                    if (isNaN(intValue) || intValue < 0) {
                        console.log('Wrong value (' + options.defaultStyles[key] + ') for defaultStyles.strokeWidth. Must be a positive interger value.');
                        this.options.defaultStyles[key] = Drawing.DefaultStyles[key];
                        return;
                    }
                    this.options.defaultStyles[key] = intValue;
                }
            }, this);
            this.interaction = null;
            this.stylingOvl = null;
            this.layer = null;
            if (this.options.layer && this.options.layer instanceof ol.layer.Vector) {
                this.layer = this.options.layer;
            }
            this._isDesktop = this._detectSupport();
        };
        Drawing.prototype._createEmptyLayer = function () {
            var features = new ol.Collection();
            var layer = new ol.layer.Vector({ source: new ol.source.Vector({ features: features }) });
            layer.gpResultLayerId = 'drawing';
            this.setLayer(layer);
        };
        Drawing.prototype.setLayer = function (vlayer) {
            if (!vlayer) {
                this.layer = null;
                return;
            }
            if (!(vlayer instanceof ol.layer.Vector)) {
                console.log('no valid layer given for hosting drawn features.');
                return;
            }
            var layers = this.getMap().getLayers();
            if (layers) {
                var found = false;
                layers.forEach(function (mapLayer) {
                    if (mapLayer == vlayer) {
                        found = true;
                    }
                }, this);
                if (!found) {
                    this.getMap().addLayer(vlayer);
                }
                vlayer.getSource().getFeatures().forEach(function (feature) {
                    var featureStyleFunction = feature.getStyleFunction();
                    if (featureStyleFunction) {
                        var styles = featureStyleFunction.call(feature, 0);
                        if (styles && styles.length !== 0) {
                            feature.setStyle(styles[0]);
                        }
                    }
                });
            }
            this.layer = vlayer;
        };
        Drawing.prototype._detectSupport = function () {
            var isDesktop = true;
            var userAgent = window.navigator.userAgent.toLowerCase();
            if (userAgent.indexOf('iphone') !== -1 || userAgent.indexOf('ipod') !== -1 || userAgent.indexOf('ipad') !== -1 || userAgent.indexOf('android') !== -1 || userAgent.indexOf('mobile') !== -1 || userAgent.indexOf('blackberry') !== -1 || userAgent.indexOf('tablet') !== -1 || userAgent.indexOf('phone') !== -1 || userAgent.indexOf('touch') !== -1) {
                isDesktop = false;
            }
            if (userAgent.indexOf('msie') !== -1 || userAgent.indexOf('trident') !== -1) {
                isDesktop = true;
            }
            return isDesktop;
        };
        Drawing.prototype._initContainer = function () {
            var container = this._createMainContainerElement();
            var inputShow = this._showDrawingContainer = this._createShowDrawingElement();
            container.appendChild(inputShow);
            var picto = this._createShowDrawingPictoElement();
            container.appendChild(picto);
            var panel = this._createDrawingPanelElement();
            container.appendChild(panel);
            return container;
        };
        Drawing.prototype._drawEndFeature = function (feature, geomType) {
            var style = null;
            switch (geomType) {
            case 'Point':
                style = new ol.style.Style({ image: new ol.style.Icon(this._getIconStyleOptions(this.options.markersList[0])) });
                break;
            case 'LineString':
                style = new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: this.options.defaultStyles.strokeColor,
                        width: this.options.defaultStyles.strokeWidth
                    })
                });
                break;
            case 'Polygon':
                style = new ol.style.Style({
                    fill: new ol.style.Fill({ color: this.hexToRgba(this.options.defaultStyles.polyFillColor, this.options.defaultStyles.polyFillOpacity) }),
                    stroke: new ol.style.Stroke({
                        color: this.options.defaultStyles.polyStrokeColor,
                        width: this.options.defaultStyles.polyStrokeWidth
                    })
                });
                break;
            }
            feature.setStyle(style);
            var popupOvl = null;
            var context = this;
            var setAttValue = function (value, save) {
                context.getMap().removeOverlay(popupOvl);
                if (save && value && value.trim().length > 0) {
                    var formated = value.replace(/\n/g, '<br>');
                    feature.setProperties({ description: formated });
                }
            };
            var popup = this._createLabelDiv({
                applyFunc: setAttValue,
                inputId: this._addUID('att-input'),
                placeholder: 'Saisir une description...',
                geomType: geomType
            });
            popupOvl = new ol.Overlay({
                element: popup,
                positioning: 'top-center'
            });
            this.getMap().addOverlay(popupOvl);
            var geomExtent = feature.getGeometry().getExtent();
            popupOvl.setPosition([
                (geomExtent[0] + geomExtent[2]) / 2,
                (geomExtent[1] + geomExtent[3]) / 2
            ]);
            document.getElementById(this._addUID('att-input')).focus();
        };
        Drawing.prototype._createRemoveInteraction = function () {
            var interaction = new ol.interaction.Select({ layers: [this.layer] });
            interaction.on('select', function (seEv) {
                if (!seEv || !seEv.selected || seEv.selected.length == 0) {
                    return;
                }
                this.layer.getSource().removeFeature(seEv.selected[0]);
                this.getMap().removeInteraction(this.interaction);
                this.interaction = this._createRemoveInteraction();
                this.getMap().addInteraction(this.interaction);
            }, this);
            return interaction;
        };
        Drawing.prototype._createStylingInteraction = function () {
            var interaction = new ol.interaction.Select({ layers: [this.layer] });
            interaction.on('select', function (seEv) {
                if (this.stylingOvl) {
                    this.getMap().removeOverlay(this.stylingOvl);
                }
                if (!seEv || !seEv.selected || seEv.selected.length == 0) {
                    return;
                }
                var valuesColor = null;
                var hexColor = null;
                var popupOvl = null;
                var geomType = null;
                var initValues = {};
                if (seEv.selected[0].getGeometry() instanceof ol.geom.Point) {
                    var _label = seEv.selected[0].getProperties().name;
                    if (seEv.selected[0].getStyle().getText() && _label) {
                        geomType = 'Text';
                        if (seEv.selected[0].getStyle().getText().getStroke() && seEv.selected[0].getStyle().getText().getStroke().getColor()) {
                            valuesColor = seEv.selected[0].getStyle().getText().getStroke().getColor();
                            if (Array.isArray(valuesColor)) {
                                valuesColor = 'rgba(' + valuesColor.join() + ')';
                                hexColor = this.rgbaToHex(valuesColor);
                                initValues.strokeColor = hexColor.hex;
                                initValues.strokeOpacity = hexColor.opacity;
                            } else {
                                initValues.strokeColor = valuesColor;
                            }
                        }
                        if (seEv.selected[0].getStyle().getText().getFill() && seEv.selected[0].getStyle().getText().getFill().getColor()) {
                            valuesColor = seEv.selected[0].getStyle().getText().getFill().getColor();
                            if (Array.isArray(valuesColor)) {
                                valuesColor = 'rgba(' + valuesColor.join() + ')';
                                hexColor = this.rgbaToHex(valuesColor);
                                initValues.fillColor = hexColor.hex;
                                initValues.fillOpacity = hexColor.opacity;
                            } else {
                                initValues.fillColor = valuesColor;
                            }
                        }
                        initValues.strokeColor = initValues.hasOwnProperty('strokeColor') ? initValues.strokeColor : this.options.defaultStyles.textStrokeColor;
                        initValues.fillColor = initValues.hasOwnProperty('fillColor') ? initValues.fillColor : this.options.defaultStyles.textFillColor;
                    } else if (seEv.selected[0].getStyle() && seEv.selected[0].getStyle().getImage()) {
                        geomType = 'Point';
                        if (seEv.selected[0].getStyle().getImage().getSrc()) {
                            initValues.markerSrc = seEv.selected[0].getStyle().getImage().getSrc();
                        } else {
                            initValues.markerSrc = this.options.markersList[0].src;
                        }
                    }
                } else if (seEv.selected[0].getGeometry() instanceof ol.geom.LineString) {
                    geomType = 'Line';
                    if (seEv.selected[0].getStyle() && seEv.selected[0].getStyle().getStroke()) {
                        if (seEv.selected[0].getStyle().getStroke().getWidth()) {
                            initValues.strokeWidth = seEv.selected[0].getStyle().getStroke().getWidth();
                        }
                        if (seEv.selected[0].getStyle().getStroke().getColor()) {
                            valuesColor = seEv.selected[0].getStyle().getStroke().getColor();
                            if (Array.isArray(valuesColor)) {
                                valuesColor = 'rgba(' + valuesColor.join() + ')';
                                hexColor = this.rgbaToHex(valuesColor);
                                initValues.strokeColor = hexColor.hex;
                                initValues.fillOpacity = hexColor.opacity;
                            } else {
                                initValues.strokeColor = valuesColor;
                            }
                        }
                    }
                    initValues.strokeWidth = initValues.hasOwnProperty('strokeWidth') ? initValues.strokeWidth : this.options.defaultStyles.strokeWidth;
                    initValues.strokeColor = initValues.hasOwnProperty('strokeColor') ? initValues.strokeColor : this.options.defaultStyles.strokeColor;
                } else if (seEv.selected[0].getGeometry() instanceof ol.geom.Polygon) {
                    geomType = 'Polygon';
                    if (seEv.selected[0].getStyle() && seEv.selected[0].getStyle().getStroke()) {
                        if (seEv.selected[0].getStyle().getStroke().getWidth()) {
                            initValues.strokeWidth = seEv.selected[0].getStyle().getStroke().getWidth();
                        }
                        if (seEv.selected[0].getStyle().getStroke().getColor()) {
                            valuesColor = seEv.selected[0].getStyle().getStroke().getColor();
                            if (Array.isArray(valuesColor)) {
                                valuesColor = 'rgba(' + valuesColor.join() + ')';
                                hexColor = this.rgbaToHex(valuesColor);
                                initValues.strokeColor = hexColor.hex;
                                initValues.strokeOpacity = hexColor.opacity;
                            } else {
                                initValues.strokeColor = valuesColor;
                            }
                        }
                    }
                    if (seEv.selected[0].getStyle() && seEv.selected[0].getStyle().getFill()) {
                        if (seEv.selected[0].getStyle().getFill().getColor()) {
                            valuesColor = seEv.selected[0].getStyle().getFill().getColor();
                            if (Array.isArray(valuesColor)) {
                                valuesColor = 'rgba(' + valuesColor.join() + ')';
                            }
                            hexColor = this.rgbaToHex(valuesColor);
                            initValues.fillColor = hexColor.hex;
                            initValues.fillOpacity = hexColor.opacity;
                        }
                    }
                    initValues.strokeWidth = initValues.hasOwnProperty('strokeWidth') ? initValues.strokeWidth : this.options.defaultStyles.polyStrokeWidth;
                    initValues.strokeColor = initValues.hasOwnProperty('strokeColor') ? initValues.strokeColor : this.options.defaultStyles.polyStrokeColor;
                    initValues.fillColor = initValues.hasOwnProperty('fillColor') ? initValues.fillColor : this.options.defaultStyles.polyFillColor;
                    initValues.fillOpacity = initValues.hasOwnProperty('fillOpacity') ? initValues.fillOpacity : this.options.defaultStyles.polyFillOpacity;
                }
                if (!geomType) {
                    console.log('Unhandled geometry type for styling.');
                    return;
                }
                var dtObj = this;
                var applyStyle = function (action) {
                    if (action == 'cancel') {
                        dtObj.getMap().removeOverlay(popupOvl);
                        return;
                    }
                    var setDefault = action == 'apply' ? false : true;
                    var fillColorElem = document.getElementById(dtObj._addUID('fillColor'));
                    var fillOpacityElem = document.getElementById(dtObj._addUID('fillOpacity'));
                    var strokeColorElem = document.getElementById(dtObj._addUID('strokeColor'));
                    var strokeWidthElem = document.getElementById(dtObj._addUID('strokeWidth'));
                    switch (geomType.toLowerCase()) {
                    case 'text':
                        if (setDefault) {
                            dtObj.options.defaultStyles.textStrokeColor = strokeColorElem.value;
                            dtObj.options.defaultStyles.textFillColor = fillColorElem.value;
                        } else {
                            seEv.selected[0].setStyle(new ol.style.Style({
                                text: new ol.style.Text({
                                    font: '16px sans',
                                    textAlign: 'left',
                                    text: seEv.selected[0].getStyle().getText().getText(),
                                    fill: new ol.style.Fill({ color: fillColorElem.value }),
                                    stroke: new ol.style.Stroke({
                                        color: strokeColorElem.value,
                                        width: 3
                                    })
                                })
                            }));
                        }
                        break;
                    case 'point':
                        var markerSelected = dtObj._getsMarkersOptionsFromSrc(document.querySelector('input[name=\'marker\']:checked').value);
                        if (setDefault) {
                            if (dtObj.options.markersList.length > 1) {
                                var idxMarker = dtObj.options.markersList.findIndex(function (mrk) {
                                    if (mrk == markerSelected) {
                                        return true;
                                    }
                                    return false;
                                });
                                if (idxMarker > 0) {
                                    dtObj.options.markersList.splice(idxMarker, 1);
                                    dtObj.options.markersList.splice(0, 0, markerSelected);
                                }
                            }
                        } else {
                            seEv.selected[0].setStyle(new ol.style.Style({ image: new ol.style.Icon(dtObj._getIconStyleOptions(markerSelected)) }));
                        }
                        break;
                    case 'line':
                        if (setDefault) {
                            dtObj.options.defaultStyles.strokeColor = strokeColorElem.value;
                            dtObj.options.defaultStyles.strokeWidth = parseInt(strokeWidthElem.value, 10);
                        } else {
                            seEv.selected[0].setStyle(new ol.style.Style({
                                stroke: new ol.style.Stroke({
                                    width: parseInt(strokeWidthElem.value, 10),
                                    color: strokeColorElem.value
                                })
                            }));
                        }
                        break;
                    case 'polygon':
                        var opacity = parseInt(fillOpacityElem.value, 10) / 10;
                        if (setDefault) {
                            dtObj.options.defaultStyles.polyStrokeColor = strokeColorElem.value;
                            dtObj.options.defaultStyles.polyFillColor = fillColorElem.value;
                            dtObj.options.defaultStyles.polyFillOpacity = opacity;
                            dtObj.options.defaultStyles.polyStrokeWidth = parseInt(strokeWidthElem.value, 10);
                        } else {
                            seEv.selected[0].setStyle(new ol.style.Style({
                                stroke: new ol.style.Stroke({
                                    width: parseInt(strokeWidthElem.value, 10),
                                    color: strokeColorElem.value
                                }),
                                fill: new ol.style.Fill({ color: dtObj.hexToRgba(fillColorElem.value, opacity) })
                            }));
                        }
                        break;
                    }
                    if (!setDefault) {
                        dtObj.getMap().removeOverlay(popupOvl);
                    }
                };
                var popupDiv = this._createStylingDiv({
                    geomType: geomType,
                    initValues: initValues,
                    applyFunc: applyStyle
                });
                popupOvl = new ol.Overlay({
                    element: popupDiv,
                    positioning: 'top-center'
                });
                this.getMap().addOverlay(popupOvl);
                popupOvl.setPosition(seEv.mapBrowserEvent.coordinate);
                this.stylingOvl = popupOvl;
                this.getMap().removeInteraction(this.interaction);
                this.interaction = this._createStylingInteraction();
                this.getMap().addInteraction(this.interaction);
            }, this);
            return interaction;
        };
        Drawing.prototype._createLabelInteraction = function () {
            var interaction = new ol.interaction.Select({ layers: [this.layer] });
            interaction.on('select', function (seEv) {
                if (this.labelOvl) {
                    this.getMap().removeOverlay(this.labelOvl);
                }
                if (!seEv || !seEv.selected || seEv.selected.length == 0) {
                    return;
                }
                var popupOvl = null;
                var geomType = null;
                var textValue = null;
                if (seEv.selected[0].getGeometry() instanceof ol.geom.Point) {
                    var _label = seEv.selected[0].getProperties().name;
                    if (seEv.selected[0].getStyle() && seEv.selected[0].getStyle().getText() && _label) {
                        geomType = 'Text';
                    } else if (seEv.selected[0].getStyle() && seEv.selected[0].getStyle().getImage()) {
                        geomType = 'Point';
                    }
                } else if (seEv.selected[0].getGeometry() instanceof ol.geom.LineString) {
                    geomType = 'Line';
                } else if (seEv.selected[0].getGeometry() instanceof ol.geom.Polygon) {
                    geomType = 'Polygon';
                }
                if (!geomType) {
                    console.log('Unhandled geometry type for styling.');
                    return;
                }
                if (geomType == 'Text') {
                    textValue = seEv.selected[0].getStyle().getText().getText();
                } else {
                    var featProps = seEv.selected[0].getProperties();
                    if (featProps && featProps.hasOwnProperty('description')) {
                        textValue = featProps['description'];
                    }
                }
                var context = this;
                var setTextValue = function (value, save) {
                    context.getMap().removeOverlay(popupOvl);
                    if (!save) {
                        return;
                    }
                    var feature = seEv.selected[0];
                    if (geomType == 'Text') {
                        var style = feature.getStyle();
                        style.getText().setText(value);
                        feature.setProperties({ name: value });
                        feature.setStyle(style);
                        return;
                    }
                    var formated = value.replace(/\n/g, '<br>');
                    feature.setProperties({ description: formated });
                };
                var popupDiv = this._createLabelDiv({
                    applyFunc: setTextValue,
                    inputId: this._addUID('label-input'),
                    placeholder: geomType == 'Text' ? 'Saisir un label...' : 'Saisir une description...',
                    text: textValue,
                    geomType: geomType
                });
                popupOvl = new ol.Overlay({
                    element: popupDiv,
                    positioning: 'top-center'
                });
                this.getMap().addOverlay(popupOvl);
                popupOvl.setPosition(seEv.mapBrowserEvent.coordinate);
                document.getElementById(this._addUID('label-input')).focus();
                this.labelOvl = popupOvl;
                this.getMap().removeInteraction(this.interaction);
                this.interaction = this._createLabelInteraction();
                this.getMap().addInteraction(this.interaction);
            }, this);
            return interaction;
        };
        Drawing.prototype._handleToolClick = function (clickEvent, toolId, context) {
            var map = context.getMap();
            if (!map) {
                return;
            }
            Interactions.unset(map, { current: 'Drawing' });
            if (context.interaction) {
                map.removeInteraction(context.interaction);
                context.interaction = null;
            }
            if (!this.layer) {
                this._createEmptyLayer();
            }
            switch (toolId) {
            case this._addUID('drawing-tool-point'):
                if (context.dtOptions['points'].active) {
                    context.interaction = new ol.interaction.Draw({
                        features: context.layer.getSource().getFeaturesCollection(),
                        style: new ol.style.Style({ image: new ol.style.Icon(this._getIconStyleOptions(this.options.markersList[0])) }),
                        type: 'Point'
                    });
                    context.interaction.on('drawend', function (deEv) {
                        context._drawEndFeature(deEv.feature, 'Point');
                    }, context);
                }
                break;
            case this._addUID('drawing-tool-line'):
                if (context.dtOptions['lines'].active) {
                    context.interaction = new ol.interaction.Draw({
                        features: context.layer.getSource().getFeaturesCollection(),
                        style: new ol.style.Style({
                            image: new ol.style.Circle({
                                radius: this.options.cursorStyle.radius,
                                stroke: new ol.style.Stroke({
                                    color: this.options.cursorStyle.strokeColor,
                                    width: this.options.cursorStyle.strokeWidth
                                }),
                                fill: new ol.style.Fill({ color: this.options.cursorStyle.fillColor })
                            }),
                            stroke: new ol.style.Stroke({
                                color: this.options.defaultStyles.strokeColor,
                                width: this.options.defaultStyles.strokeWidth
                            })
                        }),
                        type: 'LineString'
                    });
                    context.interaction.on('drawend', function (deEv) {
                        context._drawEndFeature(deEv.feature, 'LineString');
                    }, context);
                }
                break;
            case this._addUID('drawing-tool-polygon'):
                if (context.dtOptions['polygons'].active) {
                    context.interaction = new ol.interaction.Draw({
                        features: context.layer.getSource().getFeaturesCollection(),
                        style: new ol.style.Style({
                            image: new ol.style.Circle({
                                radius: this.options.cursorStyle.radius,
                                stroke: new ol.style.Stroke({
                                    color: this.options.cursorStyle.strokeColor,
                                    width: this.options.cursorStyle.strokeWidth
                                }),
                                fill: new ol.style.Fill({ color: this.options.cursorStyle.fillColor })
                            }),
                            stroke: new ol.style.Stroke({
                                color: this.options.defaultStyles.polyStrokeColor,
                                width: this.options.defaultStyles.polyStrokeWidth
                            }),
                            fill: new ol.style.Fill({ color: this.hexToRgba(this.options.defaultStyles.polyFillColor, this.options.defaultStyles.polyFillOpacity) })
                        }),
                        type: 'Polygon'
                    });
                    context.interaction.on('drawend', function (deEv) {
                        context._drawEndFeature(deEv.feature, 'Polygon');
                    }, context);
                }
                break;
            case this._addUID('drawing-tool-text'):
                if (context.dtOptions['text'].active) {
                    context.interaction = new ol.interaction.Draw({
                        features: context.layer.getSource().getFeaturesCollection(),
                        style: new ol.style.Style({
                            image: new ol.style.Circle({
                                radius: this.options.cursorStyle.radius,
                                stroke: new ol.style.Stroke({
                                    color: this.options.cursorStyle.strokeColor,
                                    width: this.options.cursorStyle.strokeWidth
                                }),
                                fill: new ol.style.Fill({ color: this.options.cursorStyle.fillColor })
                            })
                        }),
                        type: 'Point'
                    });
                    context.interaction.on('drawend', function (deEv) {
                        var popupOvl = null;
                        var setTextValue = function (value, save) {
                            context.getMap().removeOverlay(popupOvl);
                            if (!save) {
                                context.layer.getSource().removeFeature(deEv.feature);
                                return;
                            }
                            deEv.feature.setProperties({ name: value });
                            deEv.feature.setStyle(new ol.style.Style({
                                image: new ol.style.Icon(context._getIconStyleOptions(context.options.defaultStyles.textIcon1x1)),
                                text: new ol.style.Text({
                                    textAlign: 'left',
                                    font: '16px sans',
                                    text: value,
                                    fill: new ol.style.Fill({ color: context.options.defaultStyles.textFillColor }),
                                    stroke: new ol.style.Stroke({
                                        color: context.options.defaultStyles.textStrokeColor,
                                        width: 3
                                    })
                                })
                            }));
                        };
                        var popup = this._createLabelDiv({
                            applyFunc: setTextValue,
                            inputId: context._addUID('label-input'),
                            geomType: 'Text',
                            placeholder: 'Saisir un label...'
                        });
                        popupOvl = new ol.Overlay({
                            element: popup,
                            positioning: 'top-center'
                        });
                        context.getMap().addOverlay(popupOvl);
                        popupOvl.setPosition(deEv.feature.getGeometry().getCoordinates());
                        document.getElementById(this._addUID('label-input')).focus();
                    }, context);
                }
                break;
            case this._addUID('drawing-tool-edit'):
                if (context.dtOptions['edit'].active) {
                    context.interaction = new ol.interaction.Modify({
                        features: context.layer.getSource().getFeaturesCollection(),
                        style: new ol.style.Style({
                            image: new ol.style.Circle({
                                radius: this.options.cursorStyle.radius,
                                stroke: new ol.style.Stroke({
                                    color: this.options.cursorStyle.strokeColor,
                                    width: this.options.cursorStyle.strokeWidth
                                }),
                                fill: new ol.style.Fill({ color: this.options.cursorStyle.fillColor })
                            })
                        }),
                        deleteCondition: function () {
                            return false;
                        }
                    });
                }
                break;
            case this._addUID('drawing-tool-display'):
                if (context.dtOptions['display'].active) {
                    context.interaction = this._createStylingInteraction();
                }
                break;
            case this._addUID('drawing-tool-tooltip'):
                if (context.dtOptions['tooltip'].active) {
                    context.interaction = this._createLabelInteraction();
                }
                break;
            case this._addUID('drawing-tool-remove'):
                if (context.dtOptions['remove'].active) {
                    context.interaction = context._createRemoveInteraction();
                }
                break;
            default:
            }
            if (context.interaction) {
                context.interaction.setProperties({
                    name: 'Drawing',
                    source: this
                });
                map.addInteraction(context.interaction);
            }
        };
        Drawing.prototype.onShowDrawingClick = function () {
            var map = this.getMap();
            Interactions.unset(map);
            this.collapsed = this._showDrawingContainer.checked;
            this.dispatchEvent('change:collapsed');
        };
        Drawing.prototype.onExportFeatureClick = function () {
            var content = this.exportFeatures();
            if (!content) {
                return;
            }
            var link = document.createElement('a');
            var charset = 'utf-8';
            link.setAttribute('href', 'data:application/vnd.google-earth.kml+xml;charset=' + charset + ',' + encodeURIComponent(content));
            link.setAttribute('download', this.getExportName() + '.kml');
            if (document.createEvent) {
                var event = document.createEvent('MouseEvents');
                event.initEvent('click', true, true);
                link.dispatchEvent(event);
            } else {
                link.click();
            }
        };
        return Drawing;
    }({}, ol, gp, CommonUtilsSelectorID, Ol3ControlsUtilsInteractions, CommonControlsDrawingDOM, CommonUtils, Ol3FormatsKML);
    CommonControlsLocationSelectorDOM = function (ID) {
        var LocationSelectorDOM = {
            _addUID: function (id) {
                var uid = this._uid ? id + '-' + this._uid : id;
                return uid;
            },
            _createMainContainerElement: function () {
                var container = document.createElement('div');
                container.className = this._addUID('GPlocationPoint');
                container.className += ' GPwidget';
                return container;
            },
            _createLocationPointElement: function (id, display) {
                var div = document.createElement('div');
                div.id = this._addUID('GPlocationPoint_' + id);
                div.className = display ? 'GPflexInput GPlocationStageFlexInput' : 'GPflexInput GPlocationStageFlexInputHidden';
                div.style.cssText = '';
                return div;
            },
            _createLocationPointLabelElement: function (id, text) {
                var self = this;
                var labelOrigin = document.createElement('label');
                labelOrigin.id = this._addUID('GPlocationOriginLabel_' + id);
                labelOrigin.htmlFor = 'GPlocationOrigin_' + id;
                labelOrigin.innerHTML = text;
                labelOrigin.addEventListener('click', function (e) {
                    var i = ID.index(this.id);
                    var points = document.getElementsByClassName(self._addUID('GPlocationPoint'));
                    for (var j = 0; j < points.length; j++) {
                        var tag = points[j].childNodes[0].id;
                        var id = ID.index(tag);
                        document.getElementById(self._addUID('GPlocationPoint_' + id)).style.cssText = '';
                    }
                    document.getElementById(self._addUID('GPlocationOriginCoords_' + i)).value = '';
                    document.getElementById(self._addUID('GPlocationOrigin_' + i)).value = '';
                    document.getElementById(self._addUID('GPlocationPoint_' + i)).style.cssText = '';
                    document.getElementById(self._addUID('GPlocationOriginPointer_' + i)).checked = false;
                    document.getElementById(self._addUID('GPlocationOrigin_' + i)).className = 'GPlocationOriginVisible';
                    document.getElementById(self._addUID('GPlocationOriginCoords_' + i)).className = 'GPlocationOriginHidden';
                    if (document.getElementById(self._addUID('GPlocationStageRemove_' + i))) {
                        document.getElementById(self._addUID('GPlocationStageRemove_' + i)).className = 'GPlocationStageRemove';
                    }
                    if (document.getElementById(self._addUID('GPlocationStageAdd'))) {
                        document.getElementById(self._addUID('GPlocationStageAdd')).className = '';
                    }
                    self.onLocationClearPointClick(e);
                });
                return labelOrigin;
            },
            _createLocationAutoCompleteteInputElement: function (id) {
                var self = this;
                var inputOrigin = document.createElement('input');
                inputOrigin.id = this._addUID('GPlocationOrigin_' + id);
                inputOrigin.className = 'GPlocationOriginVisible';
                inputOrigin.type = 'text';
                inputOrigin.placeholder = 'Saisir une adresse';
                inputOrigin.autocomplete = 'off';
                inputOrigin.addEventListener('keyup', function (e) {
                    var charCode = e.which || e.keyCode;
                    if (charCode === 13 || charCode === 10 || charCode === 38 || charCode === 40) {
                        return;
                    }
                    var i = ID.index(this.id);
                    if (document.getElementById(self._addUID('GPlocationOrigin_' + i)).value.length > 2) {
                        document.getElementById(self._addUID('GPlocationAutoCompleteList_' + i)).style.display = 'block';
                    } else {
                        document.getElementById(self._addUID('GPlocationAutoCompleteList_' + i)).style.display = 'none';
                    }
                    self.onAutoCompleteSearchText(e);
                });
                inputOrigin.addEventListener('keydown', function (e) {
                    var charCode = e.which || e.keyCode;
                    var container = document.getElementById(self._addUID('GPlocationAutoCompleteList_' + id));
                    if (!container) {
                        return;
                    }
                    var curr = container.getElementsByClassName('GPautoCompleteProposal current');
                    var list = container.getElementsByClassName('GPautoCompleteProposal');
                    var length = list.length;
                    if (!length) {
                        return;
                    }
                    var current = null;
                    if (!curr.length) {
                        current = list[0];
                        current.className = 'GPautoCompleteProposal current';
                        current.style.color = '#000000';
                        current.style['background-color'] = '#CEDBEF';
                        return;
                    } else {
                        current = curr[0];
                    }
                    var index = parseInt(ID.index(current.id), 10);
                    var next = index === length - 1 ? list[0] : list[index + 1];
                    var prev = index === 0 ? list[length - 1] : list[index - 1];
                    current.style['background-color'] = '';
                    current.style.color = '';
                    prev.style['background-color'] = '';
                    prev.style.color = '';
                    next.style['background-color'] = '';
                    next.style.color = '';
                    switch (charCode) {
                    case 38:
                        console.log('arrow up');
                        current.className = 'GPautoCompleteProposal';
                        prev.className = 'GPautoCompleteProposal current';
                        prev.style.color = '#000000';
                        prev.style['background-color'] = '#CEDBEF';
                        break;
                    case 40:
                        console.log('arrow down');
                        current.className = 'GPautoCompleteProposal';
                        next.className = 'GPautoCompleteProposal current';
                        next.style.color = '#000000';
                        next.style['background-color'] = '#CEDBEF';
                        break;
                    case 13:
                        console.log('enter');
                        current.click(e);
                        break;
                    }
                    current.focus();
                });
                return inputOrigin;
            },
            _createLocationCoordinateInputElement: function (id) {
                var self = this;
                var inputOriginCoord = document.createElement('input');
                inputOriginCoord.id = this._addUID('GPlocationOriginCoords_' + id);
                inputOriginCoord.className = 'GPlocationOriginHidden';
                inputOriginCoord.type = 'text';
                inputOriginCoord.disabled = false;
                inputOriginCoord.addEventListener('click', function () {
                    var i = ID.index(this.id);
                    document.getElementById(self._addUID('GPlocationOriginLabel_' + i)).click();
                });
                return inputOriginCoord;
            },
            _createLocationPointerShowInputElement: function (id) {
                var inputOriginPointer = document.createElement('input');
                inputOriginPointer.id = this._addUID('GPlocationOriginPointer_' + id);
                inputOriginPointer.type = 'checkbox';
                return inputOriginPointer;
            },
            _createLocationPointerInputElement: function (id) {
                var self = this;
                var labelOriginPointer = document.createElement('label');
                labelOriginPointer.id = this._addUID('GPlocationOriginPointerImg_' + id);
                labelOriginPointer.htmlFor = 'GPlocationOriginPointer_' + id;
                labelOriginPointer.className = 'GPlocationOriginPointerImg';
                labelOriginPointer.title = 'Pointer un lieu sur la carte';
                labelOriginPointer.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    var i = ID.index(this.id);
                    var points = document.getElementsByClassName(self._addUID('GPlocationPoint'));
                    var j;
                    var tag;
                    var id;
                    for (j = 0; j < points.length; j++) {
                        tag = points[j].childNodes[0].id;
                        id = ID.index(tag);
                        if (i != id) {
                            document.getElementById(self._addUID('GPlocationOriginPointer_' + id)).checked = false;
                            if (document.getElementById(self._addUID('GPlocationOriginCoords_' + id)).value == 'Pointer un lieu sur la carte') {
                                document.getElementById(self._addUID('GPlocationOriginCoords_' + id)).value = '';
                                document.getElementById(self._addUID('GPlocationOrigin_' + id)).className = 'GPlocationOriginVisible';
                                document.getElementById(self._addUID('GPlocationOriginCoords_' + id)).className = 'GPlocationOriginHidden';
                            }
                        }
                    }
                    if (document.getElementById(self._addUID('GPlocationOriginPointer_' + i)).checked) {
                        document.getElementById(self._addUID('GPlocationOriginCoords_' + i)).value = '';
                        for (j = 0; j < points.length; j++) {
                            tag = points[j].childNodes[0].id;
                            id = ID.index(tag);
                            document.getElementById(self._addUID('GPlocationPoint_' + id)).style.cssText = '';
                        }
                        if (document.getElementById(self._addUID('GPlocationStageRemove_' + i))) {
                            document.getElementById(self._addUID('GPlocationStageRemove_' + i)).className = 'GPlocationStageRemove';
                        }
                        if (document.getElementById(self._addUID('GPlocationStageAdd'))) {
                            document.getElementById(self._addUID('GPlocationStageAdd')).className = '';
                        }
                        document.getElementById(self._addUID('GPlocationOriginPointer_' + i)).checked = false;
                        document.getElementById(self._addUID('GPlocationOrigin_' + i)).className = 'GPlocationOriginVisible';
                        document.getElementById(self._addUID('GPlocationOriginCoords_' + i)).className = 'GPlocationOriginHidden';
                    } else {
                        document.getElementById(self._addUID('GPlocationOriginCoords_' + i)).value = 'Pointer un lieu sur la carte';
                        for (j = 0; j < points.length; j++) {
                            tag = points[j].childNodes[0].id;
                            id = ID.index(tag);
                            if (i == id) {
                                document.getElementById(self._addUID('GPlocationPoint_' + id)).style.cssText = '';
                            } else {
                                document.getElementById(self._addUID('GPlocationPoint_' + id)).style.display = 'none';
                            }
                        }
                        if (document.getElementById(self._addUID('GPlocationStageRemove_' + i))) {
                            document.getElementById(self._addUID('GPlocationStageRemove_' + i)).className = 'GPlocationOriginHidden';
                        }
                        if (document.getElementById(self._addUID('GPlocationStageAdd'))) {
                            document.getElementById(self._addUID('GPlocationStageAdd')).className = 'GPlocationOriginHidden';
                        }
                        document.getElementById(self._addUID('GPlocationOriginPointer_' + i)).checked = true;
                        document.getElementById(self._addUID('GPlocationOrigin_' + i)).className = 'GPlocationOriginHidden';
                        document.getElementById(self._addUID('GPlocationOriginCoords_' + i)).className = 'GPlocationOriginVisible';
                        document.getElementById(self._addUID('GPlocationOriginCoords_' + i)).disabled = true;
                    }
                    self.onActivateMapPointClick(e);
                });
                return labelOriginPointer;
            },
            _createLocationRemovePointElement: function (id) {
                var self = this;
                var divRm = document.createElement('div');
                divRm.id = this._addUID('GPlocationStageRemove_' + id);
                divRm.className = 'GPlocationStageRemove';
                divRm.title = 'Supprimer l\'étape';
                divRm.addEventListener('click', function (e) {
                    var points = document.getElementsByClassName(self._addUID('GPlocationPoint'));
                    var last = points.length - 1;
                    var start = points[0].childNodes[0].id;
                    var end = points[last].childNodes[0].id;
                    var startID = ID.index(start);
                    var endID = ID.index(end);
                    if (id != startID && id != endID) {
                        var i = ID.index(this.id);
                        document.getElementById(self._addUID('GPlocationPoint_' + i)).className = 'GPflexInput GPlocationStageFlexInputHidden';
                        document.getElementById(self._addUID('GPlocationOrigin_' + i)).value = '';
                        document.getElementById(self._addUID('GPlocationOrigin_' + i)).className = 'GPlocationOriginVisible';
                        document.getElementById(self._addUID('GPlocationOriginCoords_' + i)).value = '';
                        document.getElementById(self._addUID('GPlocationOriginCoords_' + i)).className = 'GPlocationOriginHidden';
                        document.getElementById(self._addUID('GPlocationStageAdd')).style.display = '';
                        self.onLocationRemovePointClick(e);
                    }
                });
                return divRm;
            },
            _createLocationAddPointElement: function () {
                var self = this;
                var divAdd = document.createElement('div');
                divAdd.id = this._addUID('GPlocationStageAdd');
                divAdd.title = 'Ajouter une étape';
                divAdd.addEventListener('click', function (e) {
                    var lastStage = 1;
                    var nbStages = 0;
                    var points = document.getElementsByClassName(self._addUID('GPlocationPoint'));
                    for (var i = 1; i < points.length - 1; i++) {
                        var tag = points[i].childNodes[0].id;
                        var id = ID.index(tag);
                        if (document.getElementById(self._addUID('GPlocationPoint_' + id))) {
                            if (document.getElementById(self._addUID('GPlocationPoint_' + id)).className == 'GPflexInput GPlocationStageFlexInputHidden') {
                                if (lastStage == 1) {
                                    lastStage = id;
                                }
                            } else {
                                nbStages++;
                            }
                        }
                    }
                    if (lastStage < points.length) {
                        document.getElementById(self._addUID('GPlocationPoint_' + lastStage)).className = 'GPflexInput GPlocationStageFlexInput';
                    }
                    if (nbStages == 4) {
                        document.getElementById(self._addUID('GPlocationStageAdd')).style.display = 'none';
                    }
                    self.onLocationAddPointClick(e);
                });
                return divAdd;
            },
            _createLocationAutoCompleteResultElement: function (id) {
                var self = this;
                var div = document.createElement('div');
                div.id = this._addUID('GPlocationAutoCompleteList_' + id);
                div.className = 'GPadvancedAutoCompleteList';
                if (div.addEventListener) {
                    div.addEventListener('click', function (e) {
                        self.onAutoCompletedResultsItemClick(e);
                        document.getElementById(self._addUID('GPlocationAutoCompleteList_' + id)).style.display = 'none';
                    }, false);
                } else if (div.attachEvent) {
                    div.attachEvent('onclick', function (e) {
                        self.onAutoCompletedResultsItemClick(e);
                        document.getElementById(self._addUID('GPlocationAutoCompleteList_' + id)).style.display = 'none';
                    });
                }
                return div;
            },
            _createLocationAutoCompletedLocationElement: function (id, location, n) {
                var container = document.getElementById(this._addUID('GPlocationAutoCompleteList_' + id));
                var div = document.createElement('div');
                div.id = this._addUID('AutoCompletedLocation_' + n);
                div.className = 'GPautoCompleteProposal';
                div.innerHTML = location.fullText;
                container.appendChild(div);
            },
            GPdisplayCoordinate: function (value) {
                var points = document.getElementsByClassName(this._addUID('GPlocationPoint'));
                for (var i = 0; i < points.length; i++) {
                    var tag = points[i].childNodes[0].id;
                    var id1 = ID.index(tag);
                    if (document.getElementById(this._addUID('GPlocationOriginPointer_' + id1)).checked) {
                        document.getElementById(this._addUID('GPlocationOriginCoords_' + id1)).value = value;
                        document.getElementById(this._addUID('GPlocationOriginCoords_' + id1)).disabled = false;
                        for (var j = 0; j < points.length; j++) {
                            tag = points[j].childNodes[0].id;
                            var id2 = ID.index(tag);
                            document.getElementById(this._addUID('GPlocationPoint_' + id2)).style.cssText = '';
                            if (document.getElementById(this._addUID('GPlocationStageRemove_' + id2))) {
                                document.getElementById(this._addUID('GPlocationStageRemove_' + id2)).className = 'GPlocationStageRemove';
                            }
                        }
                        document.getElementById(this._addUID('GPlocationOriginPointer_' + id1)).checked = false;
                        if (document.getElementById(this._addUID('GPlocationStageAdd'))) {
                            document.getElementById(this._addUID('GPlocationStageAdd')).className = '';
                        }
                        return;
                    }
                }
            }
        };
        return LocationSelectorDOM;
    }(CommonUtilsSelectorID);
    Ol3ControlsLocationSelector = function (ol, Utils, woodman, Gp, RightManagement, SelectorID, LocationSelectorDOM, Markers) {
        function LocationSelector(options) {
            options = options || {};
            if (!(this instanceof LocationSelector)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            this.initialize(options);
            this._container = this._initContainer();
            if (options.element && options.element.appendChild) {
                options.element.appendChild(this._container);
                this._container = options.element;
            }
            ol.control.Control.call(this, {
                element: this._container,
                target: options.target,
                render: options.render
            });
        }
        ol.inherits(LocationSelector, ol.control.Control);
        LocationSelector.prototype = Object.create(ol.control.Control.prototype, {});
        Utils.assign(LocationSelector.prototype, LocationSelectorDOM);
        LocationSelector.prototype.constructor = LocationSelector;
        LocationSelector.prototype.initialize = function (options) {
            this.options = {
                tag: {
                    id: 1,
                    groupId: null,
                    label: '>',
                    display: true,
                    addOption: false,
                    removeOption: false
                },
                displayInfo: true,
                autocompleteOptions: {}
            };
            Utils.mergeParams(this.options, options);
            this._uid = this.options.tag.groupId || SelectorID.generate();
            this._map = null;
            this._inputsContainer = null;
            this._inputLabelContainer = null;
            this._inputAutoCompleteContainer = null;
            this._inputShowPointerContainer = null;
            this._inputShowPointer = null;
            this._inputCoordinateContainer = null;
            this._addPointElement = null;
            this._removePointElement = null;
            this._coordinate = null;
            this._suggestedContainer = null;
            this._suggestedLocations = [];
            this._currentLocation = null;
            this._initMarker();
            this._resources = {};
            this._noRightManagement = false;
            this._checkRightsManagement();
        };
        LocationSelector.prototype._initMarker = function () {
            this._marker = null;
            this._markerUrl = '';
            this._markerOffset = [
                0,
                0
            ];
            if (this.options.tag.markerOpts && this.options.tag.markerOpts.url) {
                this._markerUrl = this.options.tag.markerOpts.url;
                var offset = this.options.tag.markerOpts.offset;
                if (offset) {
                    if (Array.isArray(offset) && offset.length === 2) {
                        this._markerOffset = offset;
                    } else {
                        console.log('markerOpts.offset should be an array. e.g. : [0,0]');
                    }
                }
            } else {
                this._markerUrl = Markers['lightOrange'];
                this._markerOffset = Markers.defaultOffset;
            }
        };
        LocationSelector.prototype.getCoordinate = function () {
            return this._coordinate;
        };
        LocationSelector.prototype.clear = function () {
            this._clearResults();
            this._inputLabelContainer.click();
        };
        LocationSelector.prototype._checkRightsManagement = function () {
            var _opts = this.options.autocompleteOptions.filterOptions;
            var _res = _opts ? _opts.type : [];
            if (!_res || _res.length === 0) {
                _res = [
                    'PositionOfInterest',
                    'StreetAddress'
                ];
            }
            var rightManagement = RightManagement.check({
                key: this.options.apiKey,
                resources: _res,
                services: ['AutoCompletion']
            });
            if (!rightManagement) {
                this._noRightManagement = true;
            }
            if (!this.options.apiKey) {
                this.options.apiKey = rightManagement.key;
            }
            Utils.assign(this._resources, rightManagement);
        };
        LocationSelector.prototype._initContainer = function () {
            var id = this.options.tag.id;
            var container = this._createMainContainerElement();
            var inputs = this._inputsContainer = this._createLocationPointElement(id, this.options.tag.display);
            container.appendChild(inputs);
            var _inputLabel = this._inputLabelContainer = this._createLocationPointLabelElement(id, this.options.tag.label);
            inputs.appendChild(_inputLabel);
            var _inputAutoComplete = this._inputAutoCompleteContainer = this._createLocationAutoCompleteteInputElement(id);
            var context = this;
            if (_inputAutoComplete.addEventListener) {
                _inputAutoComplete.addEventListener('click', function () {
                    context.onAutoCompleteInputClick();
                });
            } else if (_inputAutoComplete.attachEvent) {
                _inputAutoComplete.attachEvent('onclick', function () {
                    context.onAutoCompleteInputClick();
                });
            }
            inputs.appendChild(_inputAutoComplete);
            var _inputCoordinate = this._inputCoordinateContainer = this._createLocationCoordinateInputElement(id);
            inputs.appendChild(_inputCoordinate);
            var _inputShowPointer = this._inputShowPointerContainer = this._createLocationPointerShowInputElement(id);
            inputs.appendChild(_inputShowPointer);
            var _inputPointer = this._inputShowPointer = this._createLocationPointerInputElement(id);
            inputs.appendChild(_inputPointer);
            if (this.options.tag.addOption) {
                var _inputAddStage = this._addPointElement = this._createLocationAddPointElement();
                inputs.appendChild(_inputAddStage);
            }
            if (this.options.tag.removeOption) {
                var _inputRemoveStage = this._removePointElement = this._createLocationRemovePointElement(id);
                inputs.appendChild(_inputRemoveStage);
            }
            var results = this._suggestedContainer = this._createLocationAutoCompleteResultElement(id);
            container.appendChild(results);
            return container;
        };
        LocationSelector.prototype.onAutoCompleteInputClick = function () {
            if (this._inputAutoCompleteContainer && this._inputAutoCompleteContainer.value.length > 2) {
                this._displaySuggestedLocation();
            }
        };
        LocationSelector.prototype.onAutoCompleteSearchText = function (e) {
            var value = e.target.value;
            if (!value) {
                return;
            }
            if (this._noRightManagement) {
                console.log('no rights for this service !?');
                return;
            }
            this._currentLocation = value;
            if (value.length < 3) {
                this._clearSuggestedLocation();
                return;
            }
            var context = this;
            this._requestAutoComplete({
                text: value,
                maximumResponses: 5,
                onSuccess: function (results) {
                    if (results) {
                        var locations = results.suggestedLocations;
                        context._fillAutoCompletedLocationListContainer(locations);
                    }
                },
                onFailure: function (error) {
                    context._clearSuggestedLocation();
                }
            });
            var map = this.getMap();
            map.on('click', this._hideSuggestedLocation, this);
            map.on('pointerdrag', this._hideSuggestedLocation, this);
        };
        LocationSelector.prototype.onAutoCompletedResultsItemClick = function (e) {
            var idx = SelectorID.index(e.target.id);
            if (!idx) {
                return;
            }
            var position = [
                this._suggestedLocations[idx].position.x,
                this._suggestedLocations[idx].position.y
            ];
            this._coordinate = position;
            var info = {
                type: this._suggestedLocations[idx].type,
                fields: this._suggestedLocations[idx]
            };
            var label = this._suggestedLocations[idx].fullText;
            this._setLabel(label);
            var view = this.getMap().getView();
            var mapProj = view.getProjection().getCode();
            if (mapProj !== 'EPSG:4326') {
                position = ol.proj.transform(position, 'EPSG:4326', mapProj);
            }
            this._setPosition(position);
            this._setMarker(position, info, this.options.displayInfo);
        };
        LocationSelector.prototype.onActivateMapPointClick = function () {
            var map = this.getMap();
            if (this._inputShowPointerContainer.checked) {
                this._clearResults();
                map.on('click', this.onMouseMapClick, this);
                this._setCursor('crosshair');
            } else {
                map.un('click', this.onMouseMapClick, this);
                this._setCursor();
            }
        };
        LocationSelector.prototype.onLocationClearPointClick = function () {
            this._setCursor();
            this._clearResults();
        };
        LocationSelector.prototype.onLocationRemovePointClick = function () {
            this._setCursor();
            this._clearResults();
        };
        LocationSelector.prototype.onLocationAddPointClick = function (e) {
        };
        LocationSelector.prototype.onMouseMapClick = function (e) {
            var coordinate = e.coordinate;
            if (!e.map || !e.map.getView()) {
                return;
            }
            var crs = e.map.getView().getProjection();
            this._setCoordinate(coordinate, crs);
            this._setMarker([
                coordinate[0],
                coordinate[1]
            ], null, false);
            this.onActivateMapPointClick(e);
        };
        LocationSelector.prototype._setLabel = function (label) {
            this._inputAutoCompleteContainer.value = label;
        };
        LocationSelector.prototype._setCursor = function (cursor) {
            var map = this.getMap();
            var div = map.getTargetElement();
            if (cursor) {
                div.style.cursor = cursor;
            } else {
                div.style.cursor = null;
            }
        };
        LocationSelector.prototype._setCoordinate = function (olCoordinate, crs) {
            this._coordinate = ol.proj.transform(olCoordinate, crs, 'EPSG:4326');
            var lat = this._coordinate[0].toFixed(4);
            var lng = this._coordinate[1].toFixed(4);
            var value = lat + ' / ' + lng;
            this.GPdisplayCoordinate(value);
        };
        LocationSelector.prototype._setPosition = function (position) {
            var view = this.getMap().getView();
            view.setCenter(position);
        };
        LocationSelector.prototype._setMarker = function (position, information, display) {
            var map = this.getMap();
            if (this._marker != null) {
                map.removeOverlay(this._marker);
                this._marker = null;
            }
            if (position) {
                var markerDiv = document.createElement('img');
                markerDiv.src = this._markerUrl;
                this._marker = new ol.Overlay({
                    position: position,
                    offset: this._markerOffset,
                    element: markerDiv,
                    stopEvent: false
                });
                map.addOverlay(this._marker);
                if (display) {
                }
            }
        };
        LocationSelector.prototype._clearResults = function () {
            var map = this.getMap();
            this._currentLocation = null;
            this._coordinate = null;
            this._hideSuggestedLocation();
            this._clearSuggestedLocation();
            this._setMarker();
            map.un('click', this.onMouseMapClick, this);
        };
        LocationSelector.prototype._clearSuggestedLocation = function () {
            this._suggestedLocations = [];
            if (this._suggestedContainer) {
                while (this._suggestedContainer.firstChild) {
                    this._suggestedContainer.removeChild(this._suggestedContainer.firstChild);
                }
            }
        };
        LocationSelector.prototype._hideSuggestedLocation = function () {
            if (this._suggestedContainer) {
                this._suggestedContainer.style.display = 'none';
            }
        };
        LocationSelector.prototype._displaySuggestedLocation = function () {
            if (this._suggestedContainer) {
                this._suggestedContainer.style.display = 'block';
            }
        };
        LocationSelector.prototype._requestAutoComplete = function (settings) {
            if (!settings || Object.keys(settings).length === 0) {
                return;
            }
            if (!settings.text) {
                return;
            }
            var options = {};
            Utils.assign(options, this.options.autocompleteOptions);
            Utils.assign(options, settings);
            var resources = this._resources['AutoCompletion'] || null;
            if (resources && Array.isArray(resources)) {
                if (!options.filterOptions) {
                    options.filterOptions = {};
                }
                options.filterOptions.type = resources;
            }
            options.apiKey = options.apiKey || this.options.apiKey;
            Gp.Services.autoComplete(options);
        };
        LocationSelector.prototype._fillAutoCompletedLocationListContainer = function (locations) {
            if (!locations || locations.length === 0) {
                return;
            }
            var element = this._suggestedContainer;
            if (element.childElementCount) {
                while (element.firstChild) {
                    element.removeChild(element.firstChild);
                }
            }
            for (var i = 0; i < locations.length; i++) {
                this._createLocationAutoCompletedLocationElement(this.options.tag.id, locations[i], i);
            }
            this._suggestedLocations = locations;
        };
        return LocationSelector;
    }(ol, CommonUtils, {}, gp, CommonUtilsCheckRightManagement, CommonUtilsSelectorID, CommonControlsLocationSelectorDOM, Ol3ControlsUtilsMarkers);
    CommonControlsRouteDOM = function (ID) {
        var RouteDOM = {
            _addUID: function (id) {
                var uid = this._uid ? id + '-' + this._uid : id;
                return uid;
            },
            _createMainContainerElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GProute');
                container.className = 'GPwidget';
                return container;
            },
            _createShowRouteElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPshowRoute');
                input.type = 'checkbox';
                return input;
            },
            _createShowRoutePictoElement: function () {
                var context = this;
                var label = document.createElement('label');
                label.id = this._addUID('GPshowRoutePicto');
                label.className = 'GPshowAdvancedToolPicto';
                label.htmlFor = this._addUID('GPshowRoute');
                label.title = 'Ouvrir le calcul d\'itinéraire';
                if (label.addEventListener) {
                    label.addEventListener('click', function (e) {
                        context.onShowRoutePanelClick(e);
                    });
                } else if (label.attachEvent) {
                    label.attachEvent('onclick', function (e) {
                        context.onShowRoutePanelClick(e);
                    });
                }
                var spanOpen = document.createElement('span');
                spanOpen.id = this._addUID('GPshowRouteOpen');
                spanOpen.className = 'GPshowAdvancedToolOpen';
                label.appendChild(spanOpen);
                return label;
            },
            _createRoutePanelElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GProutePanel');
                div.className = 'GPpanel';
                return div;
            },
            _createRoutePanelHeaderElement: function () {
                var self = this;
                var container = document.createElement('div');
                container.className = 'GPpanelHeader';
                var div = document.createElement('div');
                div.className = 'GPpanelTitle';
                div.innerHTML = 'Calcul d\'itinéraire';
                container.appendChild(div);
                var divClose = document.createElement('div');
                divClose.id = this._addUID('GProutePanelClose');
                divClose.className = 'GPpanelClose';
                divClose.title = 'Masquer le panneau';
                if (divClose.addEventListener) {
                    divClose.addEventListener('click', function () {
                        document.getElementById(self._addUID('GPshowRoutePicto')).click();
                    }, false);
                } else if (divClose.attachEvent) {
                    divClose.attachEvent('onclick', function () {
                        document.getElementById(self._addUID('GPshowRoutePicto')).click();
                    });
                }
                container.appendChild(divClose);
                return container;
            },
            _createRoutePanelFormElement: function () {
                var self = this;
                var form = document.createElement('form');
                form.id = this._addUID('GProuteForm');
                form.setAttribute('onkeypress', 'return event.keyCode != 13;');
                form.addEventListener('submit', function (e) {
                    console.log(e);
                    e.preventDefault();
                    var points = document.getElementsByClassName(self._addUID('GPlocationPoint'));
                    var start = points[0].childNodes[0].id;
                    var end = points[points.length - 1].childNodes[0].id;
                    var startID = ID.index(start);
                    var endID = ID.index(end);
                    if (document.getElementById(self._addUID('GPlocationOrigin_' + startID)).value == '' && document.getElementById(self._addUID('GPlocationOriginCoords_' + startID)).value == '' || document.getElementById(self._addUID('GPlocationOrigin_' + endID)).value == '' && document.getElementById(self._addUID('GPlocationOriginCoords_' + endID)).value == '') {
                        return false;
                    }
                    var id;
                    document.getElementById(self._addUID('GProuteResultsStages')).innerHTML = '';
                    for (var i = 0; i < points.length; i++) {
                        var tag = points[i].childNodes[0].id;
                        id = ID.index(tag);
                        if (document.getElementById(self._addUID('GPlocationPoint_' + id)).className == 'GPflexInput GPlocationStageFlexInput') {
                            var resultStage = document.createElement('div');
                            resultStage.className = 'GProuteResultsStages';
                            var resultStageLabel = document.createElement('div');
                            resultStageLabel.className = 'GProuteResultStageLabel';
                            resultStageLabel.innerHTML = document.getElementById(self._addUID('GPlocationOriginLabel_' + id)).innerHTML + ' :';
                            resultStage.appendChild(resultStageLabel);
                            var resultStageValue = document.createElement('div');
                            resultStageValue.className = 'GProuteResultStageValue';
                            var elementCoords = document.getElementById(self._addUID('GPlocationOriginCoords_' + id));
                            var stageCoords = elementCoords.value;
                            var visible = elementCoords.className === 'GPlocationOriginVisible' ? true : false;
                            if (stageCoords != null && stageCoords != '' && visible) {
                                resultStageValue.innerHTML = stageCoords;
                            } else {
                                resultStageValue.innerHTML = document.getElementById(self._addUID('GPlocationOrigin_' + id)).value;
                            }
                            resultStage.appendChild(resultStageValue);
                            if (resultStageValue.innerHTML != '') {
                                document.getElementById(self._addUID('GProuteResultsStages')).appendChild(resultStage);
                            }
                        }
                    }
                    var modeComputation = null;
                    if (document.getElementById(self._addUID('GProuteComputationSelect'))) {
                        var select = document.getElementById(self._addUID('GProuteResultsComputationSelect'));
                        select.selectedIndex = document.getElementById(self._addUID('GProuteComputationSelect')).selectedIndex;
                        modeComputation = select.options[select.selectedIndex].value;
                    }
                    var modeTransport = null;
                    if (document.getElementById(self._addUID('GProuteTransportCar'))) {
                        if (document.getElementById(self._addUID('GProuteTransportCar')).checked) {
                            modeTransport = document.getElementById(self._addUID('GProuteTransportCar')).value;
                        }
                    }
                    if (document.getElementById(self._addUID('GProuteTransportPedestrian'))) {
                        if (document.getElementById(self._addUID('GProuteTransportPedestrian')).checked) {
                            modeTransport = document.getElementById(self._addUID('GProuteTransportPedestrian')).value;
                        }
                    }
                    var exclusions = [];
                    var exclusionsElement = document.getElementsByClassName('GProuteExclusionsOption');
                    for (var j = 0; j < exclusionsElement.length; j++) {
                        id = exclusionsElement[j].htmlFor;
                        var el = document.getElementById(id);
                        if (!el.checked) {
                            exclusions.push(el.value);
                        }
                    }
                    self.onRouteComputationSubmit({
                        computation: modeComputation,
                        transport: modeTransport,
                        exclusions: exclusions
                    });
                    return false;
                });
                return form;
            },
            _createRoutePanelResultsElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GProuteResultsPanel');
                container.className = 'GProuteComponentHidden';
                container.appendChild(this._createRouteResultsStagesElement());
                container.appendChild(this._createRouteResultsElement());
                var divBorderUp = document.createElement('div');
                divBorderUp.className = 'GPfakeBorder GPfakeBorderLeft';
                container.appendChild(divBorderUp);
                container.appendChild(this._createRouteShowResultsDetailsElement());
                var labelShow = document.createElement('label');
                labelShow.htmlFor = this._addUID('GProuteResultsShowDetails');
                labelShow.innerHTML = 'Afficher le détail';
                container.appendChild(labelShow);
                var labelHide = document.createElement('label');
                labelHide.htmlFor = this._addUID('GProuteResultsShowDetails');
                labelHide.innerHTML = 'Masquer le détail';
                container.appendChild(labelHide);
                var divBorderDown = document.createElement('div');
                divBorderDown.className = 'GPfakeBorder';
                container.appendChild(divBorderDown);
                container.appendChild(this._createRouteResultsDetailsElement());
                return container;
            },
            _createRouteWaitingElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GProuteCalcWaitingContainer');
                div.className = 'GProuteCalcWaitingContainerHidden';
                var p = document.createElement('p');
                p.className = 'GProuteCalcWaiting';
                p.innerHTML = 'Calcul en cours...';
                div.appendChild(p);
                return div;
            },
            _createRouteResultsStagesElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GProuteResultsStages');
                return div;
            },
            _createRouteResultsElement: function () {
                var self = this;
                var container = document.createElement('div');
                container.id = this._addUID('GProuteResults');
                var divValue = document.createElement('div');
                divValue.id = this._addUID('GProuteResultsValues');
                container.appendChild(divValue);
                var divMode = document.createElement('div');
                divMode.id = this._addUID('GProuteResultsMode');
                var select = document.createElement('select');
                select.id = this._addUID('GProuteResultsComputationSelect');
                select.className = 'GPinputSelect';
                select.addEventListener('change', function (e) {
                    self.onRouteModeComputationChangeAndRun(e);
                });
                var computes = [
                    {
                        code: 'fastest',
                        label: 'Plus rapide'
                    },
                    {
                        code: 'shortest',
                        label: 'Plus court'
                    }
                ];
                for (var i = 0; i < computes.length; i++) {
                    var option = document.createElement('option');
                    option.value = computes[i].code;
                    option.text = computes[i].label;
                    select.appendChild(option);
                }
                divMode.appendChild(select);
                container.appendChild(divMode);
                var divNew = document.createElement('div');
                divNew.id = this._addUID('GProuteResultsNew');
                divNew.title = 'Modifier le calcul';
                divNew.addEventListener('click', function (e) {
                    document.getElementById(self._addUID('GProuteResultsPanel')).className = 'GProuteComponentHidden';
                    document.getElementById(self._addUID('GProuteForm')).className = '';
                    self.onShowRouteResultsNewClick(e);
                });
                container.appendChild(divNew);
                return container;
            },
            _addRouteResultsValuesElement: function (distance, duration, fconvert) {
                var div = document.getElementById(this._addUID('GProuteResultsValues'));
                if (div.childElementCount) {
                    while (div.firstChild) {
                        div.removeChild(div.firstChild);
                    }
                }
                var containerDistance = document.createElement('div');
                containerDistance.className = 'GProuteResultsValue';
                var labelDistance = document.createElement('label');
                labelDistance.className = 'GProuteResultsValueLabel';
                labelDistance.innerHTML = 'Distance :';
                containerDistance.appendChild(labelDistance);
                var distanceLabel = 0;
                var isKm = parseInt(distance / 1000, 10);
                if (!isKm) {
                    distanceLabel = Math.round(distance) + ' m';
                } else {
                    var distanceArrondi = Math.round(distance);
                    distanceArrondi = distanceArrondi / 1000;
                    distanceLabel = distanceArrondi + ' km';
                }
                var divDistance = document.createElement('div');
                divDistance.id = this._addUID('GProuteResultsValueDist');
                divDistance.innerHTML = distanceLabel;
                containerDistance.appendChild(divDistance);
                div.appendChild(containerDistance);
                var containerDuration = document.createElement('div');
                containerDuration.className = 'GProuteResultsValue';
                var labelDuration = document.createElement('label');
                labelDuration.className = 'GProuteResultsValueLabel';
                labelDuration.innerHTML = 'Durée :';
                containerDuration.appendChild(labelDuration);
                var divDuration = document.createElement('div');
                divDuration.id = this._addUID('GProuteResultsValueDist');
                divDuration.innerHTML = fconvert(duration);
                containerDuration.appendChild(divDuration);
                div.appendChild(containerDuration);
                return div;
            },
            _createRouteShowResultsDetailsElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GProuteResultsShowDetails');
                input.type = 'checkbox';
                return input;
            },
            _createRouteResultsDetailsElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GProuteResultsDetails');
                return div;
            },
            _addRouteResultsDetailsElement: function (instructions, fconvert) {
                var context = this;
                var div = document.getElementById(this._addUID('GProuteResultsDetails'));
                if (div.childElementCount) {
                    while (div.firstChild) {
                        div.removeChild(div.firstChild);
                    }
                }
                var distanceCumul = 0;
                var durationCumul = 0;
                for (var i = 0; i < instructions.length; i++) {
                    var id = i + 1;
                    var o = instructions[i];
                    var divNum = document.createElement('div');
                    divNum.className = 'GProuteResultsDetailsNumber';
                    divNum.innerHTML = id + '.';
                    div.appendChild(divNum);
                    durationCumul += parseFloat(o.duration);
                    distanceCumul += parseFloat(o.distance);
                    var distance = 0;
                    var isCumulKm = parseInt(distanceCumul / 1000, 10);
                    if (!isCumulKm) {
                        distance = Math.round(distanceCumul) + ' m';
                    } else {
                        var distanceArrondi = Math.round(distanceCumul);
                        distanceArrondi = distanceArrondi / 1000;
                        distance = distanceArrondi + ' km';
                    }
                    var divIns = document.createElement('div');
                    divIns.className = 'GProuteResultsDetailsInstruction';
                    divIns.id = this._addUID('GProuteResultsDetailsInstruction_' + id);
                    divIns.title = 'distance : ' + distance + ' / ' + 'temps : ' + fconvert(durationCumul);
                    divIns.innerHTML = o.instruction;
                    divIns.addEventListener('mouseover', function (e) {
                        context.onRouteResultsDetailsMouseOver(e);
                    });
                    divIns.addEventListener('mouseout', function (e) {
                        context.onRouteResultsDetailsMouseOut(e);
                    });
                    divIns.addEventListener('click', function (e) {
                        if (typeof context.onRouteResultsDetailsClick === 'function') {
                            context.onRouteResultsDetailsClick(e);
                        }
                    });
                    div.appendChild(divIns);
                }
                return div;
            },
            _createRoutePanelFormPointElement: function (n, text, visibility) {
                var context = this;
                var div = document.createElement('div');
                div.id = 'GProutePoint' + n;
                div.className = visibility ? 'GPflexInput GProuteStageFlexInput' : 'GPflexInput GProuteStageFlexInputHidden';
                var labelOrigin = document.createElement('label');
                labelOrigin.id = 'GProuteOriginLabel' + n;
                labelOrigin.htmlFor = 'GProuteOrigin' + n;
                labelOrigin.innerHTML = text;
                labelOrigin.addEventListener('click', function () {
                    var i = this.id.charAt(this.id.length - 1);
                    document.getElementById('GProuteOriginCoords' + i).value = '';
                    for (var j = 1; j < 8; j++) {
                        document.getElementById('GProutePoint' + j).style.display = 'flex';
                    }
                    document.getElementById('GProuteForm').className = '';
                    document.getElementById('GProuteOriginPointer' + i).checked = false;
                    document.getElementById('GProuteOrigin' + i).className = 'GProuteOriginVisible';
                    document.getElementById('GProuteOriginCoords' + i).className = 'GProuteOriginHidden';
                });
                div.appendChild(labelOrigin);
                var inputOrigin = document.createElement('input');
                inputOrigin.id = 'GProuteOrigin' + n;
                inputOrigin.className = 'GProuteOriginVisible';
                inputOrigin.type = 'text';
                inputOrigin.placeholder = 'Saisir une adresse';
                inputOrigin.addEventListener('keyup', function (e) {
                    var charCode = e.which || e.keyCode;
                    if (charCode === 13 || charCode === 10) {
                        return;
                    }
                    var i = this.id.charAt(this.id.length - 1);
                    if (document.getElementById('GProuteOrigin' + i).value.length > 2) {
                        document.getElementById('GProuteAutoCompleteList' + i).style.display = 'block';
                    } else {
                        document.getElementById('GProuteAutoCompleteList' + i).style.display = 'none';
                    }
                    context.onAutoCompleteSearchText(e);
                });
                inputOrigin.addEventListener('blur', function () {
                    var i = this.id.charAt(this.id.length - 1);
                    document.getElementById('GProuteAutoCompleteList' + i).style.display = 'none';
                });
                div.appendChild(inputOrigin);
                var inputOriginCoord = document.createElement('input');
                inputOriginCoord.id = 'GProuteOriginCoords' + n;
                inputOriginCoord.className = 'GProuteOriginHidden';
                inputOriginCoord.type = 'text';
                inputOriginCoord.disabled = true;
                div.appendChild(inputOriginCoord);
                var inputOriginPointer = document.createElement('input');
                inputOriginPointer.id = 'GProuteOriginPointer' + n;
                inputOriginPointer.type = 'checkbox';
                div.appendChild(inputOriginPointer);
                var labelOriginPointer = document.createElement('label');
                labelOriginPointer.id = 'GProuteOriginPointerImg' + n;
                labelOriginPointer.htmlFor = 'GProuteOriginPointer' + n;
                labelOriginPointer.className = 'GProuteOriginPointerImg';
                labelOriginPointer.title = 'Pointer un lieu sur la carte';
                labelOriginPointer.addEventListener('click', function (evt) {
                    evt.preventDefault();
                    evt.stopPropagation();
                    var i = this.id.charAt(this.id.length - 1);
                    var j;
                    for (j = 1; j < 8; j++) {
                        if (i != j) {
                            document.getElementById('GProuteOriginPointer' + j).checked = false;
                            if (document.getElementById('GProuteOriginCoords' + j).value == 'Pointer un lieu sur la carte') {
                                document.getElementById('GProuteOriginCoords' + j).value = '';
                                document.getElementById('GProuteOrigin' + j).className = 'GProuteOriginVisible';
                                document.getElementById('GProuteOriginCoords' + j).className = 'GProuteOriginHidden';
                            }
                        }
                    }
                    if (document.getElementById('GProuteOriginPointer' + i).checked) {
                        document.getElementById('GProuteOriginCoords' + i).value = '';
                        for (j = 1; j < 8; j++) {
                            document.getElementById('GProutePoint' + j).style.display = 'flex';
                        }
                        document.getElementById('GProuteForm').className = '';
                        document.getElementById('GProuteOriginPointer' + i).checked = false;
                        document.getElementById('GProuteOrigin' + i).className = 'GProuteOriginVisible';
                        document.getElementById('GProuteOriginCoords' + i).className = 'GProuteOriginHidden';
                    } else {
                        document.getElementById('GProuteOriginCoords' + i).value = 'Pointer un lieu sur la carte';
                        for (j = 1; j < 8; j++) {
                            if (i == j) {
                                document.getElementById('GProutePoint' + j).style.display = 'flex';
                            } else {
                                document.getElementById('GProutePoint' + j).style.display = 'none';
                            }
                        }
                        document.getElementById('GProuteForm').className = 'GProuteFormMini';
                        document.getElementById('GProuteOriginPointer' + i).checked = true;
                        document.getElementById('GProuteOrigin' + i).className = 'GProuteOriginHidden';
                        document.getElementById('GProuteOriginCoords' + i).className = 'GProuteOriginVisible';
                    }
                    context.onRouteMapPointClick(evt);
                });
                div.appendChild(labelOriginPointer);
                return div;
            },
            _createRoutePanelFormRemoveStageElement: function (n) {
                var context = this;
                var divRm = document.createElement('div');
                divRm.id = 'GProuteStageRemove' + n;
                divRm.className = 'GProuteStageRemove';
                divRm.title = 'Supprimer l\'étape';
                if (n != 1 && n != 7) {
                    divRm.addEventListener('click', function (e) {
                        var i = this.id.charAt(this.id.length - 1);
                        document.getElementById('GProutePoint' + i).className = 'GPflexInput GProuteStageFlexInputHidden';
                        document.getElementById('GProuteOrigin' + i).value = '';
                        document.getElementById('GProuteOrigin' + i).className = 'GProuteOriginVisible';
                        document.getElementById('GProuteOriginCoords' + i).value = '';
                        document.getElementById('GProuteOriginCoords' + i).className = 'GProuteOriginHidden';
                        document.getElementById('GProuteStageAdd').style.display = '';
                        var exclusionsPictoTop = document.getElementById('GPshowRouteExclusionsPicto').style.top;
                        document.getElementById('GPshowRouteExclusionsPicto').style.top = (parseInt(exclusionsPictoTop, 10) - 33).toString() + 'px';
                        context.onRouteRemovePointClick(e);
                    });
                }
                return divRm;
            },
            _createRoutePanelFormAddStageElement: function () {
                var context = this;
                var divAdd = document.createElement('div');
                divAdd.id = 'GProuteStageAdd';
                divAdd.title = 'Ajouter une étape';
                divAdd.addEventListener('click', function (e) {
                    var lastStage = 1;
                    var nbStages = 0;
                    for (var i = 2; i < 7; i++) {
                        if (document.getElementById('GProutePoint' + i).className == 'GPflexInput GProuteStageFlexInputHidden') {
                            if (lastStage == 1) {
                                lastStage = i;
                            }
                        } else {
                            nbStages++;
                        }
                    }
                    if (lastStage < 7) {
                        document.getElementById('GProutePoint' + lastStage).className = 'GPflexInput GProuteStageFlexInput';
                        var exclusionsPictoTop = document.getElementById('GPshowRouteExclusionsPicto').style.top;
                        document.getElementById('GPshowRouteExclusionsPicto').style.top = (parseInt(exclusionsPictoTop, 10) + 33).toString() + 'px';
                    }
                    if (nbStages == 4) {
                        document.getElementById('GProuteStageAdd').style.display = 'none';
                    }
                    context.onRouteAddPointClick(e);
                });
                return divAdd;
            },
            _createRoutePanelFormAutoCompleteListElement: function (n) {
                var context = this;
                var div = document.createElement('div');
                div.id = 'GProuteAutoCompleteList' + n;
                div.className = 'GPadvancedAutoCompleteList';
                if (div.addEventListener) {
                    div.addEventListener('click', function (e) {
                        context.onAutoCompletedResultsItemClick(e);
                        document.getElementById('GProuteAutoCompleteList' + n).style.display = 'none';
                    }, false);
                } else if (div.attachEvent) {
                    div.attachEvent('onclick', function (e) {
                        context.onAutoCompletedResultsItemClick(e);
                        document.getElementById('GProuteAutoCompleteList' + n).style.display = 'none';
                    });
                }
                return div;
            },
            _createRouteAutoCompletedLocationElement: function (location, n, id) {
                var container = document.getElementById('GProuteAutoCompleteList' + n);
                var div = document.createElement('div');
                div.id = 'AutoCompletedLocation' + id;
                div.className = 'GPautoCompleteProposal';
                div.innerHTML = location.fullText;
                container.appendChild(div);
            },
            _createRoutePanelFormModeChoiceElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GProuteModeChoice');
                return div;
            },
            _createRoutePanelFormModeChoiceTransportElement: function (transports) {
                var context = this;
                var div = document.createElement('div');
                div.id = this._addUID('GProuteTransportChoice');
                var span = document.createElement('span');
                span.className = 'GProuteModeLabel';
                span.innerHTML = 'Mode de transport';
                div.appendChild(span);
                for (var i = 0; i < transports.length; i++) {
                    var transport = transports[i];
                    if (transport === 'Voiture') {
                        var inputCar = document.createElement('input');
                        inputCar.id = this._addUID('GProuteTransportCar');
                        inputCar.type = 'radio';
                        inputCar.name = 'GProuteTransport';
                        inputCar.value = 'Voiture';
                        if (i === 0) {
                            inputCar.checked = true;
                        }
                        if (inputCar.addEventListener) {
                            inputCar.addEventListener('change', function (e) {
                                context.onRouteModeTransportChange(e);
                            });
                        } else if (inputCar.attachEvent) {
                            inputCar.attachEvent('onchange', function (e) {
                                context.onRouteModeTransportChange(e);
                            });
                        }
                        div.appendChild(inputCar);
                        var labelCar = document.createElement('label');
                        labelCar.className = 'GProuteTransportImg';
                        labelCar.htmlFor = this._addUID('GProuteTransportCar');
                        labelCar.title = 'Voiture';
                        div.appendChild(labelCar);
                    }
                    if (transport === 'Pieton') {
                        var inputPedestrian = document.createElement('input');
                        inputPedestrian.id = this._addUID('GProuteTransportPedestrian');
                        inputPedestrian.type = 'radio';
                        inputPedestrian.name = 'GProuteTransport';
                        inputPedestrian.value = 'Pieton';
                        if (i === 0) {
                            inputPedestrian.checked = true;
                        }
                        if (inputPedestrian.addEventListener) {
                            inputPedestrian.addEventListener('change', function (e) {
                                context.onRouteModeTransportChange(e);
                            });
                        } else if (inputPedestrian.attachEvent) {
                            inputPedestrian.attachEvent('onchange', function (e) {
                                context.onRouteModeTransportChange(e);
                            });
                        }
                        div.appendChild(inputPedestrian);
                        var labelPedestrian = document.createElement('label');
                        labelPedestrian.className = 'GProuteTransportImg';
                        labelPedestrian.htmlFor = this._addUID('GProuteTransportPedestrian');
                        labelPedestrian.title = 'Piéton';
                        div.appendChild(labelPedestrian);
                    }
                }
                return div;
            },
            _createRoutePanelFormModeChoiceComputeElement: function () {
                var context = this;
                var div = document.createElement('div');
                div.id = this._addUID('GProuteComputationChoice');
                var span = document.createElement('span');
                span.className = 'GProuteModeLabel';
                span.innerHTML = 'Mode de calcul';
                div.appendChild(span);
                var select = document.createElement('select');
                select.id = this._addUID('GProuteComputationSelect');
                select.className = 'GPinputSelect';
                select.addEventListener('change', function (e) {
                    context.onRouteModeComputationChange(e);
                });
                var computes = [
                    {
                        code: 'fastest',
                        label: 'Plus rapide'
                    },
                    {
                        code: 'shortest',
                        label: 'Plus court'
                    }
                ];
                for (var i = 0; i < computes.length; i++) {
                    var option = document.createElement('option');
                    option.value = computes[i].code;
                    option.text = computes[i].label;
                    select.appendChild(option);
                }
                div.appendChild(select);
                return div;
            },
            _createShowRouteExclusionsElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPshowRouteExclusions');
                input.type = 'checkbox';
                return input;
            },
            _createShowRouteExclusionsPictoElement: function () {
                var context = this;
                var label = document.createElement('label');
                label.id = this._addUID('GPshowRouteExclusionsPicto');
                label.className = 'GPshowMoreOptions GPshowRouteExclusionsPicto';
                label.htmlFor = this._addUID('GPshowRouteExclusions');
                label.title = 'Exclusions';
                label.style.top = '185px';
                if (label.addEventListener) {
                    label.addEventListener('click', function (e) {
                        context.onShowRouteExclusionsClick(e);
                    });
                } else if (label.attachEvent) {
                    label.attachEvent('onclick', function (e) {
                        context.onShowRouteExclusionsClick(e);
                    });
                }
                return label;
            },
            _createRoutePanelFormExclusionsElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GProuteExclusions');
                var span = document.createElement('span');
                span.className = 'GProuteExclusionsLabel';
                span.innerHTML = 'Passages autorisés';
                div.appendChild(span);
                return div;
            },
            _createRoutePanelFormExclusionOptionsElement: function (exclusions) {
                var context = this;
                var div = document.createElement('div');
                div.className = 'GProuteExclusionsOptions';
                for (var value in exclusions) {
                    if (exclusions.hasOwnProperty(value)) {
                        var status = exclusions[value];
                        switch (value) {
                        case 'toll':
                            var inputToll = document.createElement('input');
                            inputToll.id = this._addUID('GProuteExclusionsToll');
                            inputToll.type = 'checkbox';
                            inputToll.value = 'Toll';
                            inputToll.checked = !status;
                            if (inputToll.addEventListener) {
                                inputToll.addEventListener('change', function (e) {
                                    context.onRouteExclusionsChange(e);
                                });
                            } else if (inputToll.attachEvent) {
                                inputToll.attachEvent('onchange', function (e) {
                                    context.onRouteExclusionsChange(e);
                                });
                            }
                            div.appendChild(inputToll);
                            var labelToll = document.createElement('label');
                            labelToll.className = 'GProuteExclusionsOption';
                            labelToll.htmlFor = this._addUID('GProuteExclusionsToll');
                            labelToll.innerHTML = 'Péages';
                            div.appendChild(labelToll);
                            break;
                        case 'tunnel':
                            var inputTunnel = document.createElement('input');
                            inputTunnel.id = this._addUID('GProuteExclusionsTunnel');
                            inputTunnel.type = 'checkbox';
                            inputTunnel.value = 'Tunnel';
                            inputTunnel.checked = !status;
                            if (inputTunnel.addEventListener) {
                                inputTunnel.addEventListener('change', function (e) {
                                    context.onRouteExclusionsChange(e);
                                });
                            } else if (inputTunnel.attachEvent) {
                                inputTunnel.attachEvent('onchange', function (e) {
                                    context.onRouteExclusionsChange(e);
                                });
                            }
                            div.appendChild(inputTunnel);
                            var labelTunnel = document.createElement('label');
                            labelTunnel.className = 'GProuteExclusionsOption';
                            labelTunnel.htmlFor = this._addUID('GProuteExclusionsTunnel');
                            labelTunnel.innerHTML = 'Tunnels';
                            div.appendChild(labelTunnel);
                            break;
                        case 'bridge':
                            var inputBridge = document.createElement('input');
                            inputBridge.id = this._addUID('GProuteExclusionsBridge');
                            inputBridge.type = 'checkbox';
                            inputBridge.value = 'Bridge';
                            inputBridge.checked = !status;
                            if (inputBridge.addEventListener) {
                                inputBridge.addEventListener('change', function (e) {
                                    context.onRouteExclusionsChange(e);
                                });
                            } else if (inputBridge.attachEvent) {
                                inputBridge.attachEvent('onchange', function (e) {
                                    context.onRouteExclusionsChange(e);
                                });
                            }
                            div.appendChild(inputBridge);
                            var labelBridge = document.createElement('label');
                            labelBridge.className = 'GProuteExclusionsOption';
                            labelBridge.htmlFor = this._addUID('GProuteExclusionsBridge');
                            labelBridge.innerHTML = 'Ponts';
                            div.appendChild(labelBridge);
                            break;
                        }
                    }
                }
                return div;
            },
            _createRouteSubmitFormElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GProuteSubmit');
                input.className = 'GPinputSubmit';
                input.type = 'submit';
                input.value = 'Calculer';
                return input;
            },
            _createRouteFormResetElement: function () {
                var self = this;
                var divReset = document.createElement('div');
                divReset.id = this._addUID('GProuteReset');
                divReset.title = 'Réinitialiser les paramètres';
                divReset.addEventListener('click', function (e) {
                    self.onRouteResetClick(e);
                });
                return divReset;
            }
        };
        return RouteDOM;
    }(CommonUtilsSelectorID);
    Ol3ControlsRoute = function (ol, Gp, Utils, woodman, RightManagement, SelectorID, LocationSelector, LayerSwitcher, Markers, RouteDOM) {
        function Route(options) {
            options = options || {};
            if (!(this instanceof Route)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            this.initialize(options);
            this._container = this._createMainContainerElement();
            this._containerElement = null;
            if (options.element && options.element.appendChild) {
                options.element.appendChild(this._container);
                this._containerElement = options.element;
            }
            ol.control.Control.call(this, {
                element: this._containerElement || this._container,
                target: options.target,
                render: options.render
            });
        }
        ol.inherits(Route, ol.control.Control);
        Route.prototype = Object.create(ol.control.Control.prototype, {});
        Utils.assign(Route.prototype, RouteDOM);
        Route.prototype.constructor = Route;
        Route.prototype.getCollapsed = function () {
            return this.collapsed;
        };
        Route.prototype.setCollapsed = function (collapsed) {
            if (collapsed === undefined) {
                console.log('[ERROR] Route:setCollapsed - missing collapsed parameter');
                return;
            }
            if (collapsed && this.collapsed || !collapsed && !this.collapsed) {
                return;
            }
            if (collapsed) {
                document.getElementById('GProutePanelClose-' + this._uid).click();
            } else {
                document.getElementById('GPshowRoute-' + this._uid).click();
            }
            this.collapsed = collapsed;
        };
        Route.prototype.getLayer = function () {
            return this._geojsonSections;
        };
        Route.prototype.setMap = function (map) {
            if (map) {
                this._container = this._initContainer(map);
            }
            ol.control.Control.prototype.setMap.call(this, map);
        };
        Route.prototype.initialize = function (options) {
            this._checkInputOptions(options);
            this.options = {
                collapsed: true,
                graphs: [
                    'Voiture',
                    'Pieton'
                ],
                exclusions: {
                    toll: false,
                    tunnel: false,
                    bridge: false
                },
                routeOptions: {},
                autocompleteOptions: {}
            };
            Utils.assign(this.options, options);
            var defaultMarkersOpts = {
                departure: {
                    url: Markers['red'],
                    offset: Markers.defaultOffset
                },
                stages: {
                    url: Markers['lightOrange'],
                    offset: Markers.defaultOffset
                },
                arrival: {
                    url: Markers['darkOrange'],
                    offset: Markers.defaultOffset
                }
            };
            this.options.markersOpts = Utils.assign(defaultMarkersOpts, options.markersOpts);
            this.collapsed = this.options.collapsed;
            this._uid = SelectorID.generate();
            this._waitingContainer = null;
            this._formRouteContainer = null;
            this._resultsRouteContainer = null;
            this._showRouteExclusionsElement = null;
            this._currentPoints = [];
            this._currentTransport = null;
            this._initTransport();
            this._currentComputation = null;
            this._initComputation();
            this._currentExclusions = [];
            this._initExclusions();
            this._waiting = false;
            this._timer = null;
            this._geojsonRoute = null;
            this._geojsonSections = null;
            this._popupContent = null;
            this._popupDiv = this._initPopupDiv();
            this._popupOverlay = null;
            this._resultsSelectInteraction = null;
            this._resultsHoverInteraction = null;
            this._defaultFeatureStyle = new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: 'rgba(0,183,152,0.9)',
                    width: 12
                })
            });
            this._selectedFeatureStyle = new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: 'rgba(255,102,0,0.9)',
                    width: 12
                })
            });
            this._currentRouteInformations = null;
            this._resources = {};
            this._noRightManagement = false;
            this._checkRightsManagement();
        };
        Route.prototype._checkInputOptions = function (options) {
            if (options.graphs) {
                if (Array.isArray(options.graphs)) {
                    if (options.graphs.length === 0) {
                        options.graphs = null;
                    } else {
                        for (var i = 0; i < options.graphs.length; i++) {
                            if (typeof options.graphs[i] !== 'string') {
                                console.log('[ol.control.Route] ERROR : parameter \'graphs\' elements should be of type \'string\'');
                                options.graphs = null;
                            } else {
                                if (options.graphs[i].toLowerCase() === 'pieton') {
                                    options.graphs[i] = 'Pieton';
                                }
                                if (options.graphs[i].toLowerCase() === 'voiture') {
                                    options.graphs[i] = 'Voiture';
                                }
                            }
                        }
                    }
                } else {
                    options.graphs = null;
                }
            }
            if (options.collapsed === 'true') {
                options.collapsed = true;
            }
            if (options.collapsed === 'false') {
                options.collapsed = false;
            }
        };
        Route.prototype._checkRightsManagement = function () {
            var _opts = null;
            var _res = [];
            var _key = null;
            _key = this.options.routeOptions.apiKey;
            _opts = this.options.routeOptions.filterOptions;
            _res = _opts ? _opts.type : [];
            if (!_res || _res.length === 0) {
                _res = [
                    'Voiture',
                    'Pieton'
                ];
            }
            var rightManagementRoute = RightManagement.check({
                key: _key || this.options.apiKey,
                resources: _res,
                services: ['Itineraire']
            });
            _key = this.options.autocompleteOptions.apiKey;
            _opts = this.options.autocompleteOptions.filterOptions;
            _res = _opts ? _opts.type : [];
            if (!_res || _res.length === 0) {
                _res = [
                    'PositionOfInterest',
                    'StreetAddress'
                ];
            }
            var rightManagementAutoComplete = RightManagement.check({
                key: _key || this.options.apiKey,
                resources: _res,
                services: ['AutoCompletion']
            });
            if (!rightManagementRoute && !rightManagementAutoComplete) {
                this._noRightManagement = true;
            }
            if (rightManagementAutoComplete) {
                this._resources['AutoCompletion'] = {};
                this._resources['AutoCompletion']['resources'] = rightManagementAutoComplete['AutoCompletion'];
                this._resources['AutoCompletion']['key'] = rightManagementAutoComplete['key'];
            }
            if (rightManagementRoute) {
                this._resources['Itineraire'] = {};
                this._resources['Itineraire']['resources'] = rightManagementRoute['Itineraire'];
                this._resources['Itineraire']['key'] = rightManagementRoute['key'];
            }
        };
        Route.prototype._initContainer = function (map) {
            var container = this._container;
            var inputShow = this._showRouteContainer = this._createShowRouteElement();
            container.appendChild(inputShow);
            if (!this.collapsed) {
                inputShow.checked = true;
            }
            var picto = this._createShowRoutePictoElement();
            container.appendChild(picto);
            var routePanel = this._createRoutePanelElement();
            var routeHeader = this._createRoutePanelHeaderElement();
            routePanel.appendChild(routeHeader);
            var routeForm = this._formRouteContainer = this._createRoutePanelFormElement();
            var points = this._createRoutePanelFormPointsElement(map);
            for (var i = 0; i < points.length; i++) {
                routeForm.appendChild(points[i]);
            }
            var choice = this._createRoutePanelFormModeChoiceElement();
            choice.appendChild(this._createRoutePanelFormModeChoiceTransportElement(this.options.graphs));
            choice.appendChild(this._createRoutePanelFormModeChoiceComputeElement());
            routeForm.appendChild(choice);
            routeForm.appendChild(this._createShowRouteExclusionsElement());
            this._showRouteExclusionsElement = this._createShowRouteExclusionsPictoElement();
            routeForm.appendChild(this._showRouteExclusionsElement);
            var exclusion = this._createRoutePanelFormExclusionsElement();
            exclusion.appendChild(this._createRoutePanelFormExclusionOptionsElement(this.options.exclusions));
            routeForm.appendChild(exclusion);
            var divReset = this._createRouteFormResetElement();
            routeForm.appendChild(divReset);
            var submit = this._createRouteSubmitFormElement();
            routeForm.appendChild(submit);
            routePanel.appendChild(routeForm);
            var routeResults = this._resultsRouteContainer = this._createRoutePanelResultsElement();
            routePanel.appendChild(routeResults);
            var waiting = this._waitingContainer = this._createRouteWaitingElement();
            routePanel.appendChild(waiting);
            container.appendChild(routePanel);
            var context = this;
            if (container.addEventListener) {
                container.addEventListener('click', function (e) {
                    context._hideRouteSuggestedLocations.call(context, e);
                });
            }
            return container;
        };
        Route.prototype._initTransport = function () {
            this._currentTransport = 'Voiture';
            var transport = this.options.graphs;
            if (!transport || transport.length === 0) {
                this.options.graphs = [
                    'Voiture',
                    'Pieton'
                ];
            }
            if (Array.isArray(transport) && transport.length) {
                if (transport[0] === 'Voiture' || transport[0] === 'Pieton') {
                    this._currentTransport = transport[0];
                }
            }
            var serviceOptions = this.options.routeOptions;
            if (serviceOptions.graph) {
                this._currentTransport = serviceOptions.graph;
            }
        };
        Route.prototype._initComputation = function () {
            this._currentComputation = 'fastest';
            var serviceOptions = this.options.routeOptions;
            if (serviceOptions.routePreference) {
                this._currentComputation = serviceOptions.routePreference;
            }
        };
        Route.prototype._initExclusions = function () {
            this._currentExclusions = [];
            var exclusion = this.options.exclusions;
            if (!exclusion || typeof exclusion === 'object' && Object.keys(exclusion).length === 0) {
                this.options.exclusions = {
                    toll: false,
                    tunnel: false,
                    bridge: false
                };
            }
            if (exclusion && typeof exclusion === 'object' && Object.keys(exclusion).length) {
                for (var k in exclusion) {
                    if (exclusion.hasOwnProperty(k)) {
                        if (exclusion[k]) {
                            this._currentExclusions.push(k);
                        }
                    }
                }
            }
            var serviceOptions = this.options.routeOptions;
            if (Array.isArray(serviceOptions.exclusions)) {
                this._currentExclusions = serviceOptions.exclusions;
            }
        };
        Route.prototype._initPopupDiv = function () {
            var context = this;
            var element = document.createElement('div');
            element.className = 'gp-feature-info-div';
            var closer = document.createElement('input');
            closer.type = 'button';
            closer.className = 'gp-styling-button closer';
            closer.onclick = function () {
                if (context._popupOverlay != null) {
                    context._popupOverlay.setPosition(undefined);
                }
                return false;
            };
            this._popupContent = document.createElement('div');
            this._popupContent.className = 'gp-features-content-div';
            element.appendChild(this._popupContent);
            element.appendChild(closer);
            return element;
        };
        Route.prototype._createRoutePanelFormPointsElement = function (map) {
            var points = [];
            var count = 1;
            var start = new LocationSelector({
                apiKey: this.options.apiKey || null,
                tag: {
                    id: count,
                    groupId: this._uid,
                    markerOpts: this.options.markersOpts['departure'],
                    label: 'Départ',
                    display: true
                },
                autocompleteOptions: this.options.autocompleteOptions || null
            });
            start.setMap(map);
            this._addFormPointsEventListeners(start);
            points.push(start._container);
            this._currentPoints.push(start);
            for (count = 2; count < 7; count++) {
                var step = new LocationSelector({
                    apiKey: this.options.apiKey || null,
                    tag: {
                        id: count,
                        groupId: this._uid,
                        label: 'Etape',
                        markerOpts: this.options.markersOpts['stages'],
                        display: false,
                        removeOption: true
                    },
                    autocompleteOptions: this.options.autocompleteOptions || null
                });
                step.setMap(map);
                this._addFormPointsEventListeners(step);
                points.push(step._container);
                this._currentPoints.push(step);
            }
            var end = new LocationSelector({
                apiKey: this.options.apiKey || null,
                tag: {
                    id: count,
                    groupId: this._uid,
                    markerOpts: this.options.markersOpts['arrival'],
                    label: 'Arrivée',
                    display: true,
                    addOption: true
                },
                autocompleteOptions: this.options.autocompleteOptions || null
            });
            end.setMap(map);
            this._addFormPointsEventListeners(end);
            points.push(end._container);
            this._currentPoints.push(end);
            return points;
        };
        Route.prototype._addFormPointsEventListeners = function (formPoint) {
            if (!formPoint) {
                return;
            }
            var context = this;
            if (formPoint._inputLabelContainer.addEventListener) {
                formPoint._inputLabelContainer.addEventListener('click', function () {
                    context.onRouteOriginLabelClick.call(this, context);
                });
                formPoint._inputShowPointer.addEventListener('click', function () {
                    context.onRouteOriginPointerClick.call(this, context, formPoint);
                });
                if (formPoint._removePointElement) {
                    formPoint._removePointElement.addEventListener('click', function () {
                        var exclusionsPictoTop = context._showRouteExclusionsElement.style.top;
                        context._showRouteExclusionsElement.style.top = (parseInt(exclusionsPictoTop, 10) - 33).toString() + 'px';
                    });
                }
                if (formPoint._addPointElement) {
                    formPoint._addPointElement.addEventListener('click', function () {
                        var exclusionsPictoTop = context._showRouteExclusionsElement.style.top;
                        context._showRouteExclusionsElement.style.top = (parseInt(exclusionsPictoTop, 10) + 33).toString() + 'px';
                    });
                }
            } else if (formPoint._inputLabelContainer.attachEvent) {
                formPoint._inputLabelContainer.attachEvent('onclick', function () {
                    context.onRouteOriginLabelClick.call(this, context);
                });
                formPoint._inputShowPointer.attachEvent('onclick', function () {
                    context.onRouteOriginPointerClick.call(this, context, formPoint);
                });
                if (formPoint._removePointElement) {
                    formPoint._removePointElement.attachEvent('onclick', function () {
                        var exclusionsPictoTop = context._showRouteExclusionsElement.style.top;
                        context._showRouteExclusionsElement.style.top = (parseInt(exclusionsPictoTop, 10) - 33).toString() + 'px';
                    });
                }
                if (formPoint._addPointElement) {
                    formPoint._addPointElement.attachEvent('onclick', function () {
                        var exclusionsPictoTop = context._showRouteExclusionsElement.style.top;
                        context._showRouteExclusionsElement.style.top = (parseInt(exclusionsPictoTop, 10) + 33).toString() + 'px';
                    });
                }
            }
        };
        Route.prototype.onRouteComputationSubmit = function (options) {
            var points = this._currentPoints;
            var start;
            if (points[0] && points[0].getCoordinate) {
                var startCoordinate = points[0].getCoordinate();
                start = {
                    x: startCoordinate[0],
                    y: startCoordinate[1]
                };
            }
            var end;
            var endPoint = points[points.length - 1];
            if (endPoint && endPoint.getCoordinate) {
                var endCoordinate = endPoint.getCoordinate();
                end = {
                    x: endCoordinate[0],
                    y: endCoordinate[1]
                };
            }
            var step = [];
            for (var i = 1; i < points.length - 1; i++) {
                if (points[i] && points[i].getCoordinate) {
                    var iCoordinate = points[i].getCoordinate();
                    if (iCoordinate) {
                        var coordinate = {
                            x: iCoordinate[0],
                            y: iCoordinate[1]
                        };
                        step.push(coordinate);
                    }
                }
            }
            if (this._noRightManagement) {
                return;
            }
            this._currentTransport = options.transport;
            this._currentComputation = options.computation;
            this._currentExclusions = options.exclusions;
            var routeOptions = this.options.routeOptions;
            var _protocol = routeOptions.protocol || 'XHR';
            var _timeout = routeOptions.timeOut || 0;
            if (_protocol === 'JSONP' && _timeout === 0) {
                _timeout = 15000;
            }
            var context = this;
            this._requestRouting({
                startPoint: start,
                endPoint: end,
                viaPoints: step,
                graph: routeOptions.graph || this._currentTransport,
                routePreference: routeOptions.routePreference || this._currentComputation,
                exclusions: routeOptions.exclusions || this._currentExclusions,
                geometryInInstructions: true,
                distanceUnit: 'm',
                timeOut: _timeout,
                protocol: _protocol,
                onSuccess: function (results) {
                    if (results) {
                        context._fillRouteResultsDetails(results);
                    }
                },
                onFailure: function (error) {
                    context._hideWaitingContainer();
                    context._clearRouteResultsDetails();
                }
            });
        };
        Route.prototype.onRouteOriginLabelClick = function (routeControl) {
            var map = routeControl.getMap();
            routeControl._formRouteContainer.className = '';
            map.un('click', function () {
                if (routeControl._formRouteContainer.className === 'GProuteFormMini') {
                    routeControl._formRouteContainer.className = '';
                }
            });
        };
        Route.prototype.onRouteOriginPointerClick = function (routeControl, locationSelector) {
            var map = routeControl.getMap();
            if (locationSelector._inputShowPointerContainer.checked) {
                routeControl._formRouteContainer.className = 'GProuteFormMini';
                map.on('click', function () {
                    if (routeControl._formRouteContainer.className === 'GProuteFormMini') {
                        routeControl._formRouteContainer.className = '';
                    }
                });
            } else {
                routeControl._formRouteContainer.className = '';
                map.un('click', function () {
                    if (routeControl._formRouteContainer.className === 'GProuteFormMini') {
                        routeControl._formRouteContainer.className = '';
                    }
                });
            }
        };
        Route.prototype.onShowRoutePanelClick = function () {
            if (!this._geojsonSections && !this._waiting) {
                this._clear();
            }
            this.collapsed = document.getElementById('GPshowRoute-' + this._uid).checked;
            this.dispatchEvent('change:collapsed');
        };
        Route.prototype.onRouteModeComputationChange = function (e) {
            var idx = e.target.selectedIndex;
            var value = e.target.options[idx].value;
            if (!value) {
                return;
            }
            this._currentComputation = value;
        };
        Route.prototype.onRouteModeComputationChangeAndRun = function (e) {
            this.onRouteModeComputationChange(e);
            this._clearRouteResultsDetails();
            this._clearRouteResultsGeometry();
            this._clearRouteResultsFeatureGeometry();
            this.onRouteComputationSubmit({
                computation: this._currentComputation,
                transport: this._currentTransport,
                exclusions: this._currentExclusions
            });
        };
        Route.prototype.onRouteModeTransportChange = function (e) {
            var value = e.target.value;
            if (!value) {
                return;
            }
            this._currentTransport = value;
        };
        Route.prototype.onShowRouteExclusionsClick = function (e) {
        };
        Route.prototype.onRouteExclusionsChange = function (e) {
            var value = e.target.value;
            var checked = e.target.checked;
            if (!value || typeof value !== 'string') {
                return;
            }
            value = value.toLowerCase();
            var bFound = false;
            var iFound = null;
            for (var i = 0; i < this._currentExclusions.length; i++) {
                if (this._currentExclusions[i] === value) {
                    iFound = i;
                    bFound = true;
                }
            }
            if (!bFound && !checked) {
                this._currentExclusions.push(value);
            }
            if (bFound && checked) {
                this._currentExclusions.splice(iFound, 1);
            }
        };
        Route.prototype.onRouteResetClick = function () {
            var currentPoints = this._currentPoints;
            for (var i = 0; i < currentPoints.length; i++) {
                currentPoints[i].clear();
            }
            this._clear();
            this._clearRouteInputOptions();
        };
        Route.prototype.onShowRouteResultsNewClick = function () {
            this._clearRouteResultsDetails();
            this._clearRouteResultsGeometry();
            this._clearRouteResultsFeatureGeometry();
        };
        Route.prototype.onRouteResultsDetailsMouseOver = function (e) {
            var tagid = e.target.id;
            var idx = tagid.substring(tagid.indexOf('_') + 1);
            if (e.target.classList) {
                e.target.classList.add('GProuteResultsDetailsInstructionHighlight');
            }
            if (!this._geojsonSections) {
                return;
            }
            var f = this._geojsonSections.getSource().getFeatureById(parseInt(idx, 10));
            f.setStyle(this._selectedFeatureStyle);
        };
        Route.prototype.onRouteResultsDetailsMouseOut = function (e) {
            var tagid = e.target.id;
            var idx = tagid.substring(tagid.indexOf('_') + 1);
            if (e.target.classList) {
                e.target.classList.remove('GProuteResultsDetailsInstructionHighlight');
            }
            if (!this._geojsonSections) {
                return;
            }
            var f = this._geojsonSections.getSource().getFeatureById(parseInt(idx, 10));
            f.setStyle(null);
        };
        Route.prototype._requestRouting = function (options) {
            if (!options || typeof options === 'object' && Object.keys(options).length === 0) {
                return;
            }
            if (!options.startPoint) {
                return;
            }
            if (!options.endPoint) {
                return;
            }
            if (this._noRightManagement || !this._resources['Itineraire']) {
                return;
            }
            var resources = this._resources['Itineraire'].resources;
            if (!resources || typeof resources === 'object' && Object.keys(resources).length === 0) {
                return;
            }
            var key = this._resources['Itineraire']['key'];
            var bFound = false;
            for (var i = 0; i < resources.length; i++) {
                if (resources[i] === options.graph) {
                    bFound = true;
                }
            }
            if (!bFound) {
                console.log('no rights for this service !?');
                return;
            }
            options.apiKey = this.options.routeOptions.apiKey || this.options.apiKey || key;
            this._displayWaitingContainer();
            Gp.Services.route(options);
        };
        Route.prototype._fillRouteResultsDetails = function (results) {
            var distance = results.totalDistance;
            var duration = results.totalTime;
            var instructions = this._simplifiedInstructions(results.routeInstructions);
            if (instructions) {
                this._fillRouteResultsDetailsContainer(distance, duration, instructions);
            }
            var geometry = results.routeGeometry;
            if (geometry) {
                this._fillRouteResultsDetailsGeometry(geometry, this._defaultFeatureStyle);
            }
            if (instructions && instructions[0].geometry) {
                this._fillRouteResultsDetailsFeatureGeometry(instructions, this._defaultFeatureStyle);
            }
            var bbox = results.bbox;
            if (bbox) {
                var map = this.getMap();
                var bounds = [
                    bbox.left,
                    bbox.bottom,
                    bbox.right,
                    bbox.top
                ];
                var mapProj = map.getView().getProjection().getCode();
                if (mapProj !== 'EPSG:4326') {
                    bounds = ol.proj.transformExtent(bounds, 'EPSG:4326', mapProj);
                }
                map.getView().fit(bounds, map.getSize());
            }
            this._currentRouteInformations = results;
            this._formRouteContainer.className = 'GProuteComponentHidden';
            this._hideWaitingContainer();
            this._resultsRouteContainer.className = '';
        };
        Route.prototype._fillRouteResultsDetailsContainer = function (distance, duration, instructions) {
            this._resultsRouteValuesContainer = this._addRouteResultsValuesElement(distance, duration, this._convertSecondsToTime);
            this._resultsRouteDetailsContainer = this._addRouteResultsDetailsElement(instructions, this._convertSecondsToTime);
        };
        Route.prototype._fillRouteResultsDetailsGeometry = function (geometry, style) {
            this._clearRouteResultsGeometry();
            var map = this.getMap();
            if (!geometry) {
                return;
            }
            var geojsonObject = {
                type: 'Feature',
                crs: {
                    type: 'name',
                    properties: { name: 'EPSG:4326' }
                },
                geometry: geometry
            };
            var geojsonformat = new ol.format.GeoJSON({ defaultDataProjection: 'EPSG:4326' });
            var features = geojsonformat.readFeatures(geojsonObject, {
                dataProjection: 'EPSG:4326',
                featureProjection: 'EPSG:3857'
            });
            this._geojsonRoute = new ol.layer.Vector({
                source: new ol.source.Vector({ features: features }),
                style: style
            });
            map.addLayer(this._geojsonRoute);
        };
        Route.prototype._fillRouteResultsDetailsFeatureGeometry = function (instructions, style) {
            this._clearRouteResultsFeatureGeometry();
            var map = this.getMap();
            var geojsonObject = {
                type: 'FeatureCollection',
                crs: {
                    type: 'name',
                    properties: { name: 'EPSG:4326' }
                },
                features: []
            };
            for (var i = 0; i < instructions.length; i++) {
                var o = instructions[i];
                var id = i + 1;
                var coords = o.geometry.coordinates;
                for (var j = 0; j < coords.length; j++) {
                    if (typeof coords[j][0] === 'string') {
                        coords[j][0] = parseFloat(coords[j][0]);
                        coords[j][1] = parseFloat(coords[j][1]);
                    }
                }
                geojsonObject.features.push({
                    type: 'Feature',
                    geometry: o.geometry,
                    properties: { popupContent: '(' + id + ') distance : ' + this._convertDistance(o.distance) + ' / temps : ' + this._convertSecondsToTime(o.duration) },
                    id: id
                });
            }
            var geojsonformat = new ol.format.GeoJSON({ defaultDataProjection: 'EPSG:4326' });
            var mapProj = this.getMap().getView().getProjection().getCode();
            var features = geojsonformat.readFeatures(geojsonObject, {
                dataProjection: 'EPSG:4326',
                featureProjection: mapProj
            });
            this._geojsonSections = new ol.layer.Vector({
                source: new ol.source.Vector({ features: features }),
                style: style,
                opacity: 0.9
            });
            var graph;
            if (this._currentTransport === 'Pieton') {
                graph = 'piéton';
                this._geojsonSections.gpResultLayerId = 'Pieton$OGC:OPENLS;Itineraire';
            } else {
                graph = 'voiture';
                this._geojsonSections.gpResultLayerId = 'Voiture$OGC:OPENLS;Itineraire';
            }
            map.addLayer(this._geojsonSections);
            map.getControls().forEach(function (control) {
                if (control instanceof LayerSwitcher) {
                    var layerId = this._geojsonSections.gpLayerId;
                    if (control._layers[layerId].title === layerId) {
                        control.addLayer(this._geojsonSections, {
                            title: ' Itinéraire ' + graph,
                            description: ' Itinéraire basé sur un graphe ' + graph
                        });
                    }
                }
            }, this);
            this._resultsHoverInteraction = new ol.interaction.Select({
                condition: ol.events.condition.pointerMove,
                layers: [this._geojsonSections],
                style: this._selectedFeatureStyle
            });
            this._resultsHoverInteraction.on('select', this._onResultsFeatureMouseOver, this);
            map.addInteraction(this._resultsHoverInteraction);
            this._resultsSelectInteraction = new ol.interaction.Select({
                layers: [this._geojsonSections],
                style: this._selectedFeatureStyle
            });
            this._resultsSelectInteraction.on('select', this._onResultsFeatureSelect, this);
            map.addInteraction(this._resultsSelectInteraction);
        };
        Route.prototype._onResultsFeatureMouseOver = function (e) {
            if (e.selected.length !== 0) {
                var f = e.selected[0];
                var selectedInstruction = document.getElementById('GProuteResultsDetailsInstruction_' + f.getId() + '-' + this._uid);
                if (selectedInstruction && selectedInstruction.classList) {
                    selectedInstruction.classList.add('GProuteResultsDetailsInstructionHighlight');
                }
            }
            if (e.deselected.length !== 0) {
                var deselectedFeature = e.deselected[0];
                var deSelectedInstruction = document.getElementById('GProuteResultsDetailsInstruction_' + deselectedFeature.getId() + '-' + this._uid);
                if (deSelectedInstruction && deSelectedInstruction.classList) {
                    deSelectedInstruction.classList.remove('GProuteResultsDetailsInstructionHighlight');
                }
            }
        };
        Route.prototype._onResultsFeatureSelect = function (e) {
            var map = this.getMap();
            if (e.selected.length !== 0) {
                var f = e.selected[0];
                this._popupContent.innerHTML = f.getProperties().popupContent;
                if (!this._popupOverlay) {
                    this._popupOverlay = new ol.Overlay({
                        element: this._popupDiv,
                        positioning: 'bottom-center',
                        position: e.mapBrowserEvent.coordinate
                    });
                    map.addOverlay(this._popupOverlay);
                } else {
                    this._popupOverlay.setPosition(e.mapBrowserEvent.coordinate);
                }
            } else {
                if (this._popupOverlay != null) {
                    this._popupOverlay.setPosition(undefined);
                }
            }
        };
        Route.prototype._clear = function () {
            this._currentTransport = null;
            this._currentExclusions = [];
            this._currentComputation = null;
            this._clearRouteResultsDetails();
            this._clearRouteResultsGeometry();
            this._clearRouteResultsFeatureGeometry();
            for (var i = 0; i < this._currentPoints.length; i++) {
                this._currentPoints[i].clear();
            }
            this._removeRouteStepLocations();
        };
        Route.prototype._clearRouteInputOptions = function () {
            this._initTransport();
            this._initComputation();
            this._initExclusions();
            var transportdiv;
            if (this._currentTransport === 'Pieton') {
                transportdiv = document.getElementById('GProuteTransportPedestrian-' + this._uid);
                if (transportdiv) {
                    transportdiv.checked = 'true';
                }
            } else {
                transportdiv = document.getElementById('GProuteTransportCar-' + this._uid);
                if (transportdiv) {
                    transportdiv.checked = 'true';
                }
            }
            var computationdiv = document.getElementById('GProuteComputationSelect-' + this._uid);
            if (computationdiv) {
                computationdiv.value = this._currentComputation;
            }
            var tollInput = document.getElementById('GProuteExclusionsToll-' + this._uid);
            if (tollInput) {
                if (this._currentExclusions.indexOf('toll') !== -1) {
                    tollInput.checked = false;
                } else {
                    tollInput.checked = true;
                }
            }
            var tunnelInput = document.getElementById('GProuteExclusionsTunnel-' + this._uid);
            if (tunnelInput) {
                if (this._currentExclusions.indexOf('tunnel') !== -1) {
                    tunnelInput.checked = false;
                } else {
                    tunnelInput.checked = true;
                }
            }
            var bridgeInput = document.getElementById('GProuteExclusionsBridge-' + this._uid);
            if (bridgeInput) {
                if (this._currentExclusions.indexOf('bridge') !== -1 && bridgeInput) {
                    bridgeInput.checked = false;
                } else {
                    bridgeInput.checked = true;
                }
            }
        };
        Route.prototype._removeRouteStepLocations = function () {
            var points = document.querySelectorAll('div[id^="GPlocationPoint"]');
            var stepPoints = 0;
            if (points.length !== 0) {
                for (var i = 1; i < points.length - 1; i++) {
                    var classList = points[i].classList;
                    if (classList.length !== 0) {
                        for (var j = 0; j < classList.length; j++) {
                            if (classList[j] === 'GPlocationStageFlexInput') {
                                document.getElementById(this._addUID('GPlocationStageRemove_' + (i + 1))).click();
                                stepPoints += 1;
                            }
                        }
                    }
                }
            }
        };
        Route.prototype._clearRouteResultsDetails = function () {
            this._currentRouteInformations = null;
            if (this._resultsRouteDetailsContainer) {
                var detailsDiv = this._resultsRouteDetailsContainer;
                if (detailsDiv.childElementCount) {
                    while (detailsDiv.firstChild) {
                        detailsDiv.removeChild(detailsDiv.firstChild);
                    }
                }
            }
            if (this._resultsRouteValuesContainer) {
                var valuesDiv = this._resultsRouteValuesContainer;
                if (valuesDiv.childElementCount) {
                    while (valuesDiv.firstChild) {
                        valuesDiv.removeChild(valuesDiv.firstChild);
                    }
                }
            }
        };
        Route.prototype._clearRouteResultsGeometry = function () {
            var map = this.getMap();
            if (this._geojsonRoute != null) {
                map.removeLayer(this._geojsonRoute);
                this._geojsonRoute = null;
            }
        };
        Route.prototype._clearRouteResultsFeatureGeometry = function () {
            var map = this.getMap();
            if (this._geojsonSections != null) {
                map.removeLayer(this._geojsonSections);
                this._geojsonSections = null;
            }
            if (this._popupOverlay != null) {
                map.removeOverlay(this._popupOverlay);
                this._popupOverlay = null;
            }
            if (this._resultsSelectInteraction != null) {
                map.removeInteraction(this._resultsSelectInteraction);
                this._resultsSelectInteraction = null;
            }
            if (this._resultsHoverInteraction != null) {
                map.removeInteraction(this._resultsHoverInteraction);
                this._resultsHoverInteraction = null;
            }
        };
        Route.prototype._hideRouteSuggestedLocations = function (e) {
            if (e.target && e.target.id && e.target.id.indexOf('GPlocationOrigin_') !== -1) {
                var pointId = parseInt(e.target.id.split('_')[1][0], 10) - 1;
                for (var j = 0; j < this._currentPoints.length; j++) {
                    if (j !== parseInt(pointId, 10)) {
                        this._currentPoints[j]._hideSuggestedLocation();
                    }
                }
            } else {
                for (var i = 0; i < this._currentPoints.length; i++) {
                    this._currentPoints[i]._hideSuggestedLocation();
                }
            }
        };
        Route.prototype._displayWaitingContainer = function () {
            this._waitingContainer.className = 'GProuteCalcWaitingContainerVisible';
            this._waiting = true;
            var opts = this.options.routeOptions;
            if (opts && opts.timeOut) {
                if (this._timer) {
                    clearTimeout(this._timer);
                    this._timer = null;
                }
                var context = this;
                this._timer = setTimeout(function () {
                    if (context._waiting === true) {
                        context._hideWaitingContainer();
                    } else {
                        if (context._timer) {
                            clearTimeout(context._timer);
                        }
                    }
                }, 16000);
            }
        };
        Route.prototype._hideWaitingContainer = function () {
            if (this._waiting) {
                this._waitingContainer.className = 'GProuteCalcWaitingContainerHidden';
                this._waiting = false;
                var opts = this.options.routeOptions;
                if (opts && opts.timeOut) {
                    clearTimeout(this._timer);
                    this._timer = null;
                }
            }
        };
        Route.prototype._simplifiedInstructions = function (instructions) {
            var newInstructions = [];
            var current = instructions[0];
            if (instructions.length === 1) {
                newInstructions.push(current);
            }
            for (var i = 1; i < instructions.length; i++) {
                var o = instructions[i];
                if (o.instruction === current.instruction) {
                    current.distance = (parseFloat(o.distance) + parseFloat(current.distance)).toString();
                    current.duration = (parseFloat(o.duration) + parseFloat(current.duration)).toString();
                    for (var j = 1; j < o.geometry.coordinates.length; j++) {
                        current.geometry.coordinates.push(o.geometry.coordinates[j]);
                    }
                } else {
                    newInstructions.push(current);
                    current = o;
                    if (i === instructions.length - 1) {
                        newInstructions.push(o);
                        current = null;
                    }
                }
            }
            return newInstructions;
        };
        Route.prototype._convertSecondsToTime = function (duration) {
            var time = '';
            duration = Math.round(duration);
            var hours = Math.floor(duration / (60 * 60));
            var divisor4minutes = duration % (60 * 60);
            var minutes = Math.floor(divisor4minutes / 60);
            if (hours) {
                time = hours + 'h ';
            }
            time += minutes + ' min';
            return time;
        };
        Route.prototype._convertDistance = function (distance) {
            var d = '';
            var distanceKm = parseInt(distance / 1000, 10);
            if (!distanceKm) {
                d = parseInt(distance, 10) + ' m';
            } else {
                d = distanceKm + ' km';
            }
            return d;
        };
        return Route;
    }(ol, gp, CommonUtils, {}, CommonUtilsCheckRightManagement, CommonUtilsSelectorID, Ol3ControlsLocationSelector, Ol3ControlsLayerSwitcher, Ol3ControlsUtilsMarkers, CommonControlsRouteDOM);
    CommonControlsIsoDOM = function () {
        var IsoDOM = {
            _addUID: function (id) {
                var uid = this._uid ? id + '-' + this._uid : id;
                return uid;
            },
            _createMainContainerElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GPisochron');
                container.className = 'GPwidget';
                return container;
            },
            _createShowIsoElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPshowIsochron');
                input.type = 'checkbox';
                return input;
            },
            _createShowIsoPictoElement: function () {
                var context = this;
                var label = document.createElement('label');
                label.id = this._addUID('GPshowIsochronPicto');
                label.className = 'GPshowAdvancedToolPicto';
                label.htmlFor = this._addUID('GPshowIsochron');
                label.title = 'Calculer une isochrone';
                if (label.addEventListener) {
                    label.addEventListener('click', function (e) {
                        context.onShowIsoPanelClick(e);
                    });
                } else if (label.attachEvent) {
                    label.attachEvent('onclick', function (e) {
                        context.onShowIsoPanelClick(e);
                    });
                }
                var spanOpen = document.createElement('span');
                spanOpen.id = this._addUID('GPshowIsochronOpen');
                spanOpen.className = 'GPshowAdvancedToolOpen';
                label.appendChild(spanOpen);
                return label;
            },
            _createIsoPanelElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPisochronPanel');
                div.className = 'GPpanel';
                return div;
            },
            _createIsoPanelHeaderElement: function () {
                var self = this;
                var container = document.createElement('div');
                container.className = 'GPpanelHeader';
                var div = document.createElement('div');
                div.className = 'GPpanelTitle';
                div.innerHTML = 'Calcul d\'isochrone';
                container.appendChild(div);
                var divClose = document.createElement('div');
                divClose.id = this._addUID('GPisochronPanelClose');
                divClose.className = 'GPpanelClose';
                divClose.title = 'Fermer le panneau';
                if (divClose.addEventListener) {
                    divClose.addEventListener('click', function () {
                        document.getElementById(self._addUID('GPshowIsochronPicto')).click();
                    }, false);
                } else if (divClose.attachEvent) {
                    divClose.attachEvent('onclick', function () {
                        document.getElementById(self._addUID('GPshowIsochronPicto')).click();
                    });
                }
                container.appendChild(divClose);
                return container;
            },
            _createIsoPanelFormElement: function () {
                var self = this;
                var form = document.createElement('form');
                form.id = this._addUID('GPisochronForm');
                form.addEventListener('submit', function (e) {
                    e.preventDefault();
                    self.onIsoComputationSubmit(e);
                    return false;
                });
                return form;
            },
            _createIsoWaitingElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPisochronCalcWaitingContainer');
                div.className = 'GPisochronCalcWaitingContainerHidden';
                var p = document.createElement('p');
                p.className = 'GPisochronCalcWaiting';
                p.innerHTML = 'Calcul en cours...';
                div.appendChild(p);
                return div;
            },
            _createIsoPanelFormTypeChoiceElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPisochronChoice');
                return div;
            },
            _createIsoPanelFormTypeChoiceChronElement: function (checked) {
                var self = this;
                var div = document.createElement('div');
                div.className = 'GPisochronChoiceAlt';
                var input = document.createElement('input');
                input.id = this._addUID('GPisochronChoiceAltChron');
                input.name = 'GPisochronChoiceMode';
                input.type = 'radio';
                input.checked = checked ? true : false;
                if (input.addEventListener) {
                    input.addEventListener('change', function (e) {
                        document.getElementById(self._addUID('GPisochronValueChron')).className = 'GPflexInput';
                        document.getElementById(self._addUID('GPisochronValueDist')).className = 'GPisochronValueHidden';
                        self.onIsoTypeChoiceChange(e);
                    }, false);
                } else if (input.attachEvent) {
                    input.attachEvent('onchange', function () {
                        document.getElementById(self._addUID('GPisochronValueChron')).className = 'GPflexInput';
                        document.getElementById(self._addUID('GPisochronValueDist')).className = 'GPisochronValueHidden';
                        self.onIsoTypeChoiceChange();
                    });
                }
                input.value = 'isochron';
                div.appendChild(input);
                var label = document.createElement('label');
                label.className = 'GPisochronChoiceAltImg';
                label.htmlFor = this._addUID('GPisochronChoiceAltChron');
                div.appendChild(label);
                var span = document.createElement('span');
                span.id = this._addUID('GPisochronChoiceAltChronTxt');
                span.innerHTML = 'isochrone';
                if (span.addEventListener) {
                    span.addEventListener('click', function () {
                        document.getElementById(self._addUID('GPisochronChoiceAltChron')).click();
                    }, false);
                } else if (span.attachEvent) {
                    span.attachEvent('onclick', function () {
                        document.getElementById(self._addUID('GPisochronChoiceAltChron')).click();
                    });
                }
                div.appendChild(span);
                return div;
            },
            _createIsoPanelFormTypeChoiceDistElement: function (checked) {
                var self = this;
                var div = document.createElement('div');
                div.className = 'GPisochronChoiceAlt';
                var input = document.createElement('input');
                input.id = this._addUID('GPisochronChoiceAltDist');
                input.name = 'GPisochronChoiceMode';
                input.type = 'radio';
                input.checked = checked ? true : false;
                if (input.addEventListener) {
                    input.addEventListener('change', function (e) {
                        document.getElementById(self._addUID('GPisochronValueDist')).className = 'GPflexInput';
                        document.getElementById(self._addUID('GPisochronValueChron')).className = 'GPisochronValueHidden';
                        self.onIsoTypeChoiceChange(e);
                    }, false);
                } else if (input.attachEvent) {
                    input.attachEvent('onchange', function () {
                        document.getElementById(self._addUID('GPisochronValueDist')).className = 'GPflexInput';
                        document.getElementById(self._addUID('GPisochronValueChron')).className = 'GPisochronValueHidden';
                        self.onIsoTypeChoiceChange();
                    });
                }
                input.value = 'isodistance';
                div.appendChild(input);
                var label = document.createElement('label');
                label.className = 'GPisochronChoiceAltImg';
                label.htmlFor = this._addUID('GPisochronChoiceAltDist');
                div.appendChild(label);
                var span = document.createElement('span');
                span.id = this._addUID('GPisochronChoiceAltDistTxt');
                span.innerHTML = 'isodistance';
                if (span.addEventListener) {
                    span.addEventListener('click', function () {
                        document.getElementById(self._addUID('GPisochronChoiceAltDist')).click();
                    }, false);
                } else if (span.attachEvent) {
                    span.attachEvent('onclick', function () {
                        document.getElementById(self._addUID('GPisochronChoiceAltDist')).click();
                    });
                }
                div.appendChild(span);
                return div;
            },
            _createIsoPanelFormValueIsochronElement: function (checked) {
                var context = this;
                var div = document.createElement('div');
                div.id = this._addUID('GPisochronValueChron');
                div.className = checked ? 'GPflexInput' : 'GPisochronValueHidden';
                var label = document.createElement('label');
                label.id = this._addUID('GPisochronValueChronLabel');
                label.htmlFor = this._addUID('GPisochronValueChronInput');
                label.innerHTML = 'Temps';
                div.appendChild(label);
                var input1 = document.createElement('input');
                input1.id = this._addUID('GPisochronValueChronInput1');
                input1.min = '0';
                input1.step = '1';
                input1.value = '0';
                input1.type = 'number';
                if (input1.addEventListener) {
                    input1.addEventListener('change', function (e) {
                        if (typeof context.onIsoValueChronTimeMinuteChange === 'function') {
                            context.onIsoValueChronTimeHourChange(e);
                        }
                    });
                } else if (input1.attachEvent) {
                    input1.attachEvent('onchange', function (e) {
                        if (typeof context.onIsoValueChronTimeMinuteChange === 'function') {
                            context.onIsoValueChronTimeHourChange(e);
                        }
                    });
                }
                div.appendChild(input1);
                var label1 = document.createElement('label');
                label1.innerHTML = 'h';
                div.appendChild(label1);
                var input2 = document.createElement('input');
                input2.id = this._addUID('GPisochronValueChronInput2');
                input2.min = '0';
                input2.max = '59';
                input2.step = '1';
                input2.value = '0';
                input2.type = 'number';
                if (input2.addEventListener) {
                    input2.addEventListener('change', function (e) {
                        if (typeof context.onIsoValueChronTimeMinuteChange === 'function') {
                            context.onIsoValueChronTimeMinuteChange(e);
                        }
                    });
                } else if (input2.attachEvent) {
                    input2.attachEvent('onchange', function (e) {
                        if (typeof context.onIsoValueChronTimeMinuteChange === 'function') {
                            context.onIsoValueChronTimeMinuteChange(e);
                        }
                    });
                }
                div.appendChild(input2);
                var label2 = document.createElement('label');
                label2.innerHTML = 'min';
                div.appendChild(label2);
                return div;
            },
            _createIsoPanelFormValueIsodistanceElement: function (checked) {
                var context = this;
                var div = document.createElement('div');
                div.id = this._addUID('GPisochronValueDist');
                div.className = checked ? 'GPflexInput' : 'GPisochronValueHidden';
                var label = document.createElement('label');
                label.id = this._addUID('GPisochronValueDistLabel');
                label.htmlFor = this._addUID('GPisochronValueDistInput');
                label.innerHTML = 'Distance';
                div.appendChild(label);
                var input1 = document.createElement('input');
                input1.id = this._addUID('GPisochronValueDistInput');
                input1.min = '0';
                input1.step = 'any';
                input1.value = '0';
                input1.type = 'number';
                if (input1.addEventListener) {
                    input1.addEventListener('change', function (e) {
                        if (typeof context.onIsoValueDistChange === 'function') {
                            context.onIsoValueDistChange(e);
                        }
                    });
                } else if (input1.attachEvent) {
                    input1.attachEvent('onchange', function (e) {
                        if (typeof context.onIsoValueDistChange === 'function') {
                            context.onIsoValueDistChange(e);
                        }
                    });
                }
                div.appendChild(input1);
                var label1 = document.createElement('label');
                label1.innerHTML = 'km';
                div.appendChild(label1);
                return div;
            },
            _createIsoPanelFormModeChoiceElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPisochronModeChoice');
                return div;
            },
            _createIsoPanelFormModeChoiceTransportElement: function (transports) {
                var context = this;
                var div = document.createElement('div');
                div.id = this._addUID('GPisochronTransportChoice');
                var span = document.createElement('span');
                span.className = 'GPisochronModeLabel';
                span.innerHTML = 'Mode de transport';
                div.appendChild(span);
                for (var i = 0; i < transports.length; i++) {
                    var transport = transports[i];
                    if (transport === 'Voiture') {
                        var inputCar = document.createElement('input');
                        inputCar.id = this._addUID('GPisochronTransportCar');
                        inputCar.type = 'radio';
                        inputCar.name = 'GPisochronTransport';
                        if (i === 0) {
                            inputCar.checked = true;
                        }
                        if (inputCar.addEventListener) {
                            inputCar.addEventListener('change', function (e) {
                                context.onIsoModeTransportChange(e);
                            });
                        } else if (inputCar.attachEvent) {
                            inputCar.attachEvent('onchange', function (e) {
                                context.onIsoModeTransportChange(e);
                            });
                        }
                        inputCar.value = 'Voiture';
                        div.appendChild(inputCar);
                        var labelCar = document.createElement('label');
                        labelCar.className = 'GPisochronTransportImg';
                        labelCar.htmlFor = this._addUID('GPisochronTransportCar');
                        labelCar.title = 'Voiture';
                        div.appendChild(labelCar);
                    }
                    if (transport === 'Pieton') {
                        var inputPedestrian = document.createElement('input');
                        inputPedestrian.id = this._addUID('GPisochronTransportPedestrian');
                        inputPedestrian.type = 'radio';
                        inputPedestrian.name = 'GPisochronTransport';
                        if (i === 0) {
                            inputPedestrian.checked = true;
                        }
                        if (inputPedestrian.addEventListener) {
                            inputPedestrian.addEventListener('change', function (e) {
                                context.onIsoModeTransportChange(e);
                            });
                        } else if (inputPedestrian.attachEvent) {
                            inputPedestrian.attachEvent('onchange', function (e) {
                                context.onIsoModeTransportChange(e);
                            });
                        }
                        inputPedestrian.value = 'Pieton';
                        div.appendChild(inputPedestrian);
                        var labelPedestrian = document.createElement('label');
                        labelPedestrian.className = 'GPisochronTransportImg';
                        labelPedestrian.htmlFor = this._addUID('GPisochronTransportPedestrian');
                        labelPedestrian.title = 'Piéton';
                        div.appendChild(labelPedestrian);
                    }
                }
                return div;
            },
            _createIsoPanelFormModeChoiceDirectionElement: function (directions) {
                var self = this;
                var div = document.createElement('div');
                div.id = this._addUID('GPisochronDirectionChoice');
                var span = document.createElement('span');
                span.className = 'GPisochronModeLabel';
                span.innerHTML = 'Sens de parcours';
                div.appendChild(span);
                var select = document.createElement('select');
                select.id = this._addUID('GPisochronDirectionSelect');
                select.className = 'GPinputSelect';
                select.addEventListener('change', function (e) {
                    self.onIsoModeDirectionChange(e);
                });
                for (var i = 0; i < directions.length; i++) {
                    var direction = directions[i];
                    if (direction.toLowerCase() === 'departure') {
                        var departureOption = document.createElement('option');
                        if (i === 0) {
                            departureOption.selected = 'selected';
                        }
                        departureOption.value = 'departure';
                        departureOption.text = 'Départ';
                        select.appendChild(departureOption);
                    }
                    if (direction.toLowerCase() === 'arrival') {
                        var arrivalOption = document.createElement('option');
                        if (i === 0) {
                            arrivalOption.selected = 'selected';
                        }
                        arrivalOption.value = 'arrival';
                        arrivalOption.text = 'Arrivée';
                        select.appendChild(arrivalOption);
                    }
                }
                div.appendChild(select);
                return div;
            },
            _createShowIsoExclusionsElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPshowIsoExclusions');
                input.type = 'checkbox';
                return input;
            },
            _createShowIsoExclusionsPictoElement: function () {
                var label = document.createElement('label');
                label.id = this._addUID('GPshowIsoExclusionsPicto');
                label.className = 'GPshowMoreOptions GPshowIsoExclusionsPicto';
                label.htmlFor = this._addUID('GPshowIsoExclusions');
                label.title = 'Exclusions';
                label.style.top = '240px';
                return label;
            },
            _createIsoPanelFormExclusionsElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPisoExclusions');
                var span = document.createElement('span');
                span.className = 'GPisoExclusionsLabel';
                span.innerHTML = 'Passages autorisés';
                div.appendChild(span);
                return div;
            },
            _createIsoPanelFormExclusionOptionsElement: function (exclusions) {
                var context = this;
                var div = document.createElement('div');
                div.className = 'GPisoExclusionsOptions';
                for (var value in exclusions) {
                    if (exclusions.hasOwnProperty(value)) {
                        var status = exclusions[value];
                        switch (value) {
                        case 'toll':
                            var inputToll = document.createElement('input');
                            inputToll.id = this._addUID('GPisoExclusionsToll');
                            inputToll.type = 'checkbox';
                            inputToll.checked = !status;
                            if (inputToll.addEventListener) {
                                inputToll.addEventListener('change', function (e) {
                                    context.onIsoExclusionsChange(e);
                                });
                            } else if (inputToll.attachEvent) {
                                inputToll.attachEvent('onchange', function (e) {
                                    context.onIsoExclusionsChange(e);
                                });
                            }
                            inputToll.value = 'Toll';
                            div.appendChild(inputToll);
                            var labelToll = document.createElement('label');
                            labelToll.className = 'GPisoExclusionsOption';
                            labelToll.htmlFor = this._addUID('GPisoExclusionsToll');
                            labelToll.innerHTML = 'Péages';
                            div.appendChild(labelToll);
                            break;
                        case 'tunnel':
                            var inputTunnel = document.createElement('input');
                            inputTunnel.id = this._addUID('GPisoExclusionsTunnel');
                            inputTunnel.type = 'checkbox';
                            inputTunnel.checked = !status;
                            if (inputTunnel.addEventListener) {
                                inputTunnel.addEventListener('change', function (e) {
                                    context.onIsoExclusionsChange(e);
                                });
                            } else if (inputTunnel.attachEvent) {
                                inputTunnel.attachEvent('onchange', function (e) {
                                    context.onIsoExclusionsChange(e);
                                });
                            }
                            inputTunnel.value = 'Tunnel';
                            div.appendChild(inputTunnel);
                            var labelTunnel = document.createElement('label');
                            labelTunnel.className = 'GPisoExclusionsOption';
                            labelTunnel.htmlFor = this._addUID('GPisoExclusionsTunnel');
                            labelTunnel.innerHTML = 'Tunnels';
                            div.appendChild(labelTunnel);
                            break;
                        case 'bridge':
                            var inputBridge = document.createElement('input');
                            inputBridge.id = this._addUID('GPisoExclusionsBridge');
                            inputBridge.type = 'checkbox';
                            inputBridge.checked = !status;
                            if (inputBridge.addEventListener) {
                                inputBridge.addEventListener('change', function (e) {
                                    context.onIsoExclusionsChange(e);
                                });
                            } else if (inputBridge.attachEvent) {
                                inputBridge.attachEvent('onchange', function (e) {
                                    context.onIsoExclusionsChange(e);
                                });
                            }
                            inputBridge.value = 'Bridge';
                            div.appendChild(inputBridge);
                            var labelBridge = document.createElement('label');
                            labelBridge.className = 'GPisoExclusionsOption';
                            labelBridge.htmlFor = this._addUID('GPisoExclusionsBridge');
                            labelBridge.innerHTML = 'Ponts';
                            div.appendChild(labelBridge);
                            break;
                        }
                    }
                }
                return div;
            },
            _createIsoSubmitFormElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPisochronSubmit');
                input.className = 'GPinputSubmit';
                input.type = 'submit';
                input.value = 'Calculer';
                return input;
            },
            _createIsoFormResetElement: function () {
                var self = this;
                var divReset = document.createElement('div');
                divReset.id = this._addUID('GPisochronReset');
                divReset.title = 'Réinitialiser les paramètres';
                divReset.addEventListener('click', function (e) {
                    self.onIsoResetClick(e);
                });
                return divReset;
            }
        };
        return IsoDOM;
    }();
    Ol3ControlsIsocurve = function (ol, Gp, Utils, woodman, RightManagement, SelectorID, LocationSelector, LayerSwitcher, Markers, IsoDOM) {
        function Isocurve(options) {
            options = options || {};
            if (!(this instanceof Isocurve)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            this.initialize(options);
            this._container = this._createMainContainerElement();
            this._containerElement = null;
            if (options.element && options.element.appendChild) {
                options.element.appendChild(this._container);
                this._containerElement = options.element;
            }
            ol.control.Control.call(this, {
                element: this._containerElement || this._container,
                target: options.target,
                render: options.render
            });
        }
        ol.inherits(Isocurve, ol.control.Control);
        Isocurve.prototype = Object.create(ol.control.Control.prototype, {});
        Utils.assign(Isocurve.prototype, IsoDOM);
        Isocurve.prototype.constructor = Isocurve;
        Isocurve.prototype.getCollapsed = function () {
            return this.collapsed;
        };
        Isocurve.prototype.setCollapsed = function (collapsed) {
            if (collapsed === undefined) {
                console.log('[ERROR] Isocurve:setCollapsed - missing collapsed parameter');
                return;
            }
            if (collapsed && this.collapsed || !collapsed && !this.collapsed) {
                return;
            }
            if (collapsed) {
                document.getElementById('GPisochronPanelClose-' + this._uid).click();
            } else {
                document.getElementById('GPshowIsochronPicto-' + this._uid).click();
            }
            this.collapsed = collapsed;
        };
        Isocurve.prototype.getLayer = function () {
            return this._geojsonLayer;
        };
        Isocurve.prototype.setMap = function (map) {
            if (map) {
                this._container = this._initContainer(map);
            }
            ol.control.Control.prototype.setMap.call(this, map);
        };
        Isocurve.prototype.initialize = function (options) {
            this._checkInputOptions(options);
            this.options = {
                collapsed: true,
                methods: [
                    'time',
                    'distance'
                ],
                graphs: [
                    'Voiture',
                    'Pieton'
                ],
                exclusions: {
                    toll: false,
                    tunnel: false,
                    bridge: false
                },
                directions: [
                    'departure',
                    'arrival'
                ],
                markerOpts: {
                    url: Markers['lightOrange'],
                    offset: Markers.defaultOffset
                },
                isocurveOptions: {},
                autocompleteOptions: {}
            };
            Utils.assign(this.options, options);
            this.collapsed = this.options.collapsed;
            this._uid = SelectorID.generate();
            this._currentTransport = null;
            this._initTransport();
            this._currentComputation = null;
            this._initComputation();
            this._currentExclusions = [];
            this._initExclusions();
            this._currentDirection = null;
            this._initDirection();
            this._originPoint = null;
            this._showIsoContainer = null;
            this._waitingContainer = null;
            this._formContainer = null;
            this._currentIsoResults = null;
            this._geojsonLayer;
            this._waiting = false;
            this._timer = null;
            this._defaultFeatureStyle = new ol.style.Style({ fill: new ol.style.Fill({ color: 'rgba(0, 183, 152, 0.7)' }) });
            this._resources = {};
            this._noRightManagement = false;
            this._checkRightsManagement();
        };
        Isocurve.prototype._checkInputOptions = function (options) {
            var i;
            if (options.methods) {
                if (Array.isArray(options.methods)) {
                    if (options.methods.length === 0) {
                        options.methods = null;
                    } else {
                        for (i = 0; i < options.methods.length; i++) {
                            if (typeof options.methods[i] !== 'string') {
                                console.log('[ol.control.Isocurve] ERROR : parameter \'methods\' elements should be of type \'string\'');
                            }
                        }
                    }
                } else {
                    options.methods = null;
                }
            }
            if (options.graphs) {
                if (Array.isArray(options.graphs)) {
                    if (options.graphs.length === 0) {
                        options.graphs = null;
                    } else {
                        for (i = 0; i < options.graphs.length; i++) {
                            if (typeof options.graphs[i] !== 'string') {
                                console.log('[ol.control.Isocurve] ERROR : parameter \'graphs\' elements should be of type \'string\'');
                            } else {
                                if (options.graphs[i].toLowerCase() === 'pieton') {
                                    options.graphs[i] = 'Pieton';
                                }
                                if (options.graphs[i].toLowerCase() === 'voiture') {
                                    options.graphs[i] = 'Voiture';
                                }
                            }
                        }
                    }
                } else {
                    options.graphs = null;
                }
            }
            if (options.directions) {
                if (Array.isArray(options.directions)) {
                    if (options.directions.length === 0) {
                        options.directions = null;
                    } else {
                        for (i = 0; i < options.directions.length; i++) {
                            if (typeof options.directions[i] !== 'string') {
                                console.log('[ol.control.Isocurve] ERROR : parameter \'directions\' elements should be of type \'string\'');
                            }
                        }
                    }
                } else {
                    options.directions = null;
                }
            }
            if (options.collapsed === 'true') {
                options.collapsed = true;
            }
            if (options.collapsed === 'false') {
                options.collapsed = false;
            }
        };
        Isocurve.prototype._initTransport = function () {
            this._currentTransport = 'Voiture';
            var transports = this.options.graphs;
            if (!transports || transports.length === 0) {
                this.options.graphs = [
                    'Voiture',
                    'Pieton'
                ];
            }
            if (Array.isArray(transports) && transports.length) {
                if (transports[0] === 'Voiture' || transports[0] === 'Pieton') {
                    this._currentTransport = transports[0];
                }
            }
            var serviceOptions = this.options.isocurveOptions;
            if (serviceOptions.graph) {
                this._currentTransport = serviceOptions.graph;
            }
        };
        Isocurve.prototype._initComputation = function () {
            this._currentComputation = 'time';
            var methods = this.options.methods;
            if (!methods || methods.length === 0) {
                this.options.methods = [
                    'time',
                    'distance'
                ];
            }
            if (Array.isArray(methods) && methods.length) {
                if (methods[0] === 'time' || methods[0] === 'distance') {
                    this._currentComputation = methods[0];
                }
            }
            var serviceOptions = this.options.isocurveOptions;
            if (serviceOptions.method) {
                this._currentComputation = serviceOptions.method;
            }
            if (serviceOptions.time) {
                this._currentComputation = 'time';
            }
            if (serviceOptions.distance) {
                this._currentComputation = 'distance';
            }
        };
        Isocurve.prototype._initDirection = function () {
            this._currentDirection = 'departure';
            var directions = this.options.directions;
            if (!directions || directions.length === 0) {
                this.options.directions = [
                    'departure',
                    'arrival'
                ];
            }
            if (Array.isArray(directions) && directions.length) {
                if (directions[0] === 'departure' || directions[0] === 'arrival') {
                    this._currentDirection = directions[0];
                }
            }
            var serviceOptions = this.options.isocurveOptions;
            if (!serviceOptions.reverse) {
                this._currentDirection = 'departure';
            }
            if (serviceOptions.reverse === true) {
                this._currentDirection = 'arrival';
                this.options.directions = [
                    'arrival',
                    'departure'
                ];
            }
        };
        Isocurve.prototype._initExclusions = function () {
            this._currentExclusions = [];
            var exclusion = this.options.exclusions;
            if (!exclusion || typeof exclusion === 'object' && Object.keys(exclusion).length === 0) {
                this.options.exclusions = {
                    toll: false,
                    tunnel: false,
                    bridge: false
                };
            }
            if (exclusion && typeof exclusion === 'object' && Object.keys(exclusion).length) {
                for (var k in exclusion) {
                    if (exclusion.hasOwnProperty(k)) {
                        if (exclusion.k) {
                            this._currentExclusions.push(k);
                        }
                    }
                }
            }
            var serviceOptions = this.options.isocurveOptions;
            if (Array.isArray(serviceOptions.exclusions)) {
                this._currentExclusions = serviceOptions.exclusions;
            }
        };
        Isocurve.prototype._checkRightsManagement = function () {
            var _opts = null;
            var _res = [];
            var _key = null;
            _key = this.options.isocurveOptions.apiKey;
            _opts = this.options.isocurveOptions.filterOptions;
            _res = _opts ? _opts.type : [];
            if (!_res || _res.length === 0) {
                _res = [
                    'Voiture',
                    'Pieton'
                ];
            }
            var rightManagementIsocurve = RightManagement.check({
                key: _key || this.options.apiKey,
                resources: _res,
                services: ['Isochrone']
            });
            _key = this.options.autocompleteOptions.apiKey;
            _opts = this.options.autocompleteOptions.filterOptions;
            _res = _opts ? _opts.type : [];
            if (!_res || _res.length === 0) {
                _res = [
                    'PositionOfInterest',
                    'StreetAddress'
                ];
            }
            var rightManagementAutoComplete = RightManagement.check({
                key: _key || this.options.apiKey,
                resources: _res,
                services: ['AutoCompletion']
            });
            if (!rightManagementIsocurve && !rightManagementAutoComplete) {
                this._noRightManagement = true;
            }
            if (rightManagementAutoComplete) {
                this._resources['AutoCompletion'] = {};
                this._resources['AutoCompletion']['resources'] = rightManagementAutoComplete['AutoCompletion'];
                this._resources['AutoCompletion']['key'] = rightManagementAutoComplete['key'];
            }
            if (rightManagementIsocurve) {
                this._resources['Isocurve'] = {};
                this._resources['Isocurve']['resources'] = rightManagementIsocurve['Isochrone'];
                this._resources['Isocurve']['key'] = rightManagementIsocurve['key'];
            }
        };
        Isocurve.prototype._initContainer = function (map) {
            var container = this._container;
            var inputShow = this._showIsoContainer = this._createShowIsoElement();
            container.appendChild(inputShow);
            if (!this.collapsed) {
                inputShow.checked = true;
            }
            var picto = this._createShowIsoPictoElement();
            container.appendChild(picto);
            var panel = this._createIsoPanelElement();
            var header = this._createIsoPanelHeaderElement();
            panel.appendChild(header);
            var form = this._formContainer = this._createIsoPanelFormElement();
            var point = this._createIsoPanelFormPointElement(map);
            form.appendChild(point);
            var isoChronChecked = false;
            var isoDistChecked = false;
            var typeChoice = this._createIsoPanelFormTypeChoiceElement();
            for (var i = 0; i < this.options.methods.length; i++) {
                if (this.options.methods[i] === 'time') {
                    isoChronChecked = i === 0 ? true : false;
                    typeChoice.appendChild(this._createIsoPanelFormTypeChoiceChronElement(isoChronChecked));
                }
                if (this.options.methods[i] === 'distance') {
                    isoDistChecked = i === 0 ? true : false;
                    typeChoice.appendChild(this._createIsoPanelFormTypeChoiceDistElement(isoDistChecked));
                }
            }
            form.appendChild(typeChoice);
            form.appendChild(this._createIsoPanelFormValueIsochronElement(isoChronChecked));
            form.appendChild(this._createIsoPanelFormValueIsodistanceElement(isoDistChecked));
            var modeChoice = this._createIsoPanelFormModeChoiceElement();
            modeChoice.appendChild(this._createIsoPanelFormModeChoiceTransportElement(this.options.graphs));
            modeChoice.appendChild(this._createIsoPanelFormModeChoiceDirectionElement(this.options.directions));
            form.appendChild(modeChoice);
            if (this.options.exclusions && typeof this.options.exclusions === 'object' && Object.keys(this.options.exclusions).length !== 0) {
                form.appendChild(this._createShowIsoExclusionsElement());
                form.appendChild(this._createShowIsoExclusionsPictoElement());
                var exclusion = this._createIsoPanelFormExclusionsElement();
                exclusion.appendChild(this._createIsoPanelFormExclusionOptionsElement(this.options.exclusions));
                form.appendChild(exclusion);
            }
            var divReset = this._createIsoFormResetElement();
            form.appendChild(divReset);
            var submit = this._submitContainer = this._createIsoSubmitFormElement();
            form.appendChild(submit);
            panel.appendChild(form);
            var waiting = this._waitingContainer = this._createIsoWaitingElement();
            panel.appendChild(waiting);
            container.appendChild(panel);
            var context = this;
            if (container.addEventListener) {
                container.addEventListener('click', function (e) {
                    context._hideIsoSuggestedLocations.call(context, e);
                });
            }
            return container;
        };
        Isocurve.prototype._createIsoPanelFormPointElement = function (map) {
            this._originPoint = new LocationSelector({
                apiKey: this.options.apiKey || null,
                tag: {
                    id: 1,
                    groupId: this._uid,
                    markerOpts: this.options.markerOpts,
                    label: 'Départ',
                    display: true
                },
                autocompleteOptions: this.options.autocompleteOptions || null
            });
            this._originPoint.setMap(map);
            var self = this;
            document.getElementById('GPlocationOriginPointerImg_1-' + this._uid).onclick = function () {
                self._clearGeojsonLayer();
                var map = self.getMap();
                if (self._originPoint._inputShowPointerContainer.checked) {
                    self._formContainer.className = 'GPisochronFormMini';
                    map.on('click', function () {
                        self._formContainer.className = '';
                    });
                } else {
                    self._formContainer.className = '';
                    map.un('click', function () {
                        self._formContainer.className = '';
                    });
                }
            };
            document.getElementById('GPlocationOriginLabel_1-' + this._uid).onclick = function () {
                self._clearGeojsonLayer();
                self._formContainer.className = '';
                map.un('click', function () {
                    self._formContainer.className = '';
                });
            };
            document.getElementById('GPlocationOrigin_1-' + this._uid).onclick = function () {
                self._clearGeojsonLayer();
            };
            return this._originPoint._container;
        };
        Isocurve.prototype.onIsoComputationSubmit = function () {
            if (!this._originPoint || !this._originPoint.getCoordinate || !this._originPoint.getCoordinate()) {
                console.log('[Isocurve] Missing position parameter to submit isocurve request');
                return;
            }
            var positionCoordinates = this._originPoint.getCoordinate();
            var position = {
                x: positionCoordinates[0],
                y: positionCoordinates[1]
            };
            var time;
            var distance;
            if (this._currentComputation.toLowerCase() === 'time') {
                var timeHourInput = document.getElementById('GPisochronValueChronInput1-' + this._uid);
                var hours = parseInt(timeHourInput.value, 10);
                if (isNaN && isNaN(hours)) {
                    hours = 0;
                }
                var timeMinutesInput = document.getElementById('GPisochronValueChronInput2-' + this._uid);
                var minutes = parseInt(timeMinutesInput.value, 10);
                if (isNaN && isNaN(minutes)) {
                    minutes = 0;
                }
                time = hours * 3600 + minutes * 60;
            }
            if (this._currentComputation.toLowerCase() === 'distance') {
                var distInput = document.getElementById('GPisochronValueDistInput-' + this._uid);
                distance = parseFloat(distInput.value) * 1000;
            }
            if (!time && !distance) {
                console.log('[Isocurve] Missing time or distance parameter to submit isocurve request');
                return;
            }
            if (this._noRightManagement) {
                console.log('[Isocurve] no rights for this service');
                return;
            }
            var options = this.options.isocurveOptions || {};
            var _protocol = options.protocol || 'XHR';
            var _timeout = options.timeOut || 0;
            if (_protocol === 'JSONP' && _timeout === 0) {
                _timeout = 15000;
            }
            var context = this;
            var isoRequestOptions = {
                position: position,
                graph: options.graph || this._currentTransport,
                exclusions: options.exclusions || this._currentExclusions,
                method: options.method || this._currentComputation,
                smoothing: options.smoothing || true,
                timeOut: _timeout,
                protocol: _protocol,
                onSuccess: function (results) {
                    if (results) {
                        context._drawIsoResults(results);
                    }
                },
                onFailure: function (error) {
                    context._hideWaitingContainer();
                }
            };
            if (this._currentDirection.toLowerCase() === 'arrival' || options.reverse) {
                isoRequestOptions.reverse = true;
            }
            if (time) {
                isoRequestOptions.time = time;
            }
            if (distance) {
                isoRequestOptions.distance = distance;
            }
            this._requestIsoCurve(isoRequestOptions);
        };
        Isocurve.prototype.onShowIsoPanelClick = function () {
            this.collapsed = this._showIsoContainer.checked;
            this.dispatchEvent('change:collapsed');
        };
        Isocurve.prototype.onIsoTypeChoiceChange = function (e) {
            var value = e.target.value;
            if (!value) {
                return;
            }
            if (value === 'isodistance') {
                this._currentComputation = 'distance';
            }
            if (value === 'isochron') {
                this._currentComputation = 'time';
            }
        };
        Isocurve.prototype.onIsoModeTransportChange = function (e) {
            var value = e.target.value;
            if (!value) {
                return;
            }
            this._currentTransport = value;
        };
        Isocurve.prototype.onIsoModeDirectionChange = function (e) {
            var value = e.target.value;
            if (!value) {
                return;
            }
            if (value.toLowerCase() === 'arrival') {
                this._originPoint._inputLabelContainer.innerHTML = 'Arrivée';
            } else {
                this._originPoint._inputLabelContainer.innerHTML = 'Départ';
            }
            this._currentDirection = value;
        };
        Isocurve.prototype.onIsoExclusionsChange = function (e) {
            var value = e.target.value;
            var checked = e.target.checked;
            if (!value) {
                return;
            }
            var bFound = false;
            var iFound = null;
            for (var i = 0; i < this._currentExclusions.length; i++) {
                if (this._currentExclusions[i] === value) {
                    iFound = i;
                    bFound = true;
                }
            }
            if (!bFound && !checked) {
                this._currentExclusions.push(value);
            }
            if (bFound && checked) {
                this._currentExclusions[iFound] = null;
            }
        };
        Isocurve.prototype.onIsoResetClick = function () {
            this._clear();
        };
        Isocurve.prototype._requestIsoCurve = function (options) {
            if (!options || typeof options === 'object' && Object.keys(options).length === 0) {
                return;
            }
            if (!options.position) {
                return;
            }
            if (this._noRightManagement || !this._resources['Isocurve']) {
                console.log('no rights for this service');
                return;
            }
            var resources = this._resources['Isocurve'].resources;
            if (!resources || typeof resources === 'object' && Object.keys(resources).length === 0) {
                console.log('no rights for this service');
                return;
            }
            var bFound = false;
            for (var i = 0; i < resources.length; i++) {
                if (resources[i] === options.graph) {
                    bFound = true;
                }
            }
            if (!bFound) {
                console.log('no rights for this service !?');
                return;
            }
            var key = this._resources['Isocurve']['key'];
            options.apiKey = this.options.isocurveOptions.apiKey || this.options.apiKey || key;
            this._clearGeojsonLayer();
            this._displayWaitingContainer();
            Gp.Services.isoCurve(options);
        };
        Isocurve.prototype._drawIsoResults = function (results) {
            this._currentIsoResults = results;
            this._hideWaitingContainer();
            if (!results.geometry) {
                return;
            }
            var map = this.getMap();
            var geojsonObject = {
                type: 'Feature',
                crs: {
                    type: 'name',
                    properties: { name: 'EPSG:4326' }
                },
                geometry: results.geometry
            };
            var geojsonformat = new ol.format.GeoJSON({ defaultDataProjection: 'EPSG:4326' });
            var mapProj = map.getView().getProjection().getCode();
            var features = geojsonformat.readFeatures(geojsonObject, {
                dataProjection: 'EPSG:4326',
                featureProjection: mapProj
            });
            this._geojsonLayer = new ol.layer.Vector({
                source: new ol.source.Vector({ features: features }),
                style: this._defaultFeatureStyle,
                opacity: 0.9
            });
            var graph;
            if (this._currentTransport === 'Pieton') {
                graph = 'piéton';
                this._geojsonLayer.gpResultLayerId = 'Pieton$GEOPORTAIL:GPP:Isocurve';
            } else {
                graph = 'voiture';
                this._geojsonLayer.gpResultLayerId = 'Voiture$GEOPORTAIL:GPP:Isocurve';
            }
            map.addLayer(this._geojsonLayer);
            if (features[0] && features[0].getGeometry() && features[0].getGeometry().getExtent()) {
                var extent = features[0].getGeometry().getExtent();
                map.getView().fit(extent, map.getSize());
            }
            var method = this._currentComputation === 'time' ? 'Isochrone' : 'Isodistance';
            map.getControls().forEach(function (control) {
                if (control instanceof LayerSwitcher) {
                    var layerId = this._geojsonLayer.gpLayerId;
                    if (control._layers[layerId].title === layerId) {
                        control.addLayer(this._geojsonLayer, {
                            title: method + ' ' + graph,
                            description: method + ' basé sur un graphe ' + graph
                        });
                    }
                }
            }, this);
        };
        Isocurve.prototype._clear = function () {
            this._clearIsoInputs();
            this._originPoint.clear();
            this._clearGeojsonLayer();
            this._currentIsoResults = null;
        };
        Isocurve.prototype._clearIsoInputs = function () {
            var timeHourInput = document.getElementById('GPisochronValueChronInput1-' + this._uid);
            if (timeHourInput) {
                timeHourInput.value = '0';
            }
            var timeMinutesInput = document.getElementById('GPisochronValueChronInput2-' + this._uid);
            if (timeMinutesInput) {
                timeMinutesInput.value = '0';
            }
            var distInput = document.getElementById('GPisochronValueDistInput-' + this._uid);
            if (distInput) {
                distInput.value = '0';
            }
            this._initTransport();
            this._initComputation();
            this._initDirection();
            this._initExclusions();
            var transportdiv;
            if (this._currentTransport === 'Pieton') {
                transportdiv = document.getElementById('GPisochronTransportPedestrian-' + this._uid);
                if (transportdiv) {
                    transportdiv.checked = 'true';
                }
            } else {
                transportdiv = document.getElementById('GPisochronTransportCar-' + this._uid);
                if (transportdiv) {
                    transportdiv.checked = 'true';
                }
            }
            var computationdiv;
            if (this._currentComputation.toLowerCase() === 'distance') {
                computationdiv = document.getElementById('GPisochronChoiceAltDist-' + this._uid);
                if (computationdiv) {
                    computationdiv.checked = 'true';
                }
                if (document.getElementById('GPisochronValueDist-' + this._uid)) {
                    document.getElementById('GPisochronValueDist-' + this._uid).className = 'GPflexInput';
                }
                if (document.getElementById('GPisochronValueChron-' + this._uid)) {
                    document.getElementById('GPisochronValueChron-' + this._uid).className = 'GPisochronValueHidden';
                }
            } else {
                computationdiv = document.getElementById('GPisochronChoiceAltChron-' + this._uid);
                if (computationdiv) {
                    computationdiv.checked = 'true';
                }
                if (document.getElementById('GPisochronValueChron-' + this._uid)) {
                    document.getElementById('GPisochronValueChron-' + this._uid).className = 'GPflexInput';
                }
                if (document.getElementById('GPisochronValueDist-' + this._uid)) {
                    document.getElementById('GPisochronValueDist-' + this._uid).className = 'GPisochronValueHidden';
                }
            }
            var directionSelect = document.getElementById('GPisochronDirectionSelect-' + this._uid);
            if (directionSelect) {
                directionSelect.value = this._currentDirection;
            }
            if (this._currentDirection === 'arrival') {
                this._originPoint._inputLabelContainer.innerHTML = 'Arrivée';
            } else {
                this._originPoint._inputLabelContainer.innerHTML = 'Départ';
            }
            var tollInput = document.getElementById('GPisoExclusionsToll-' + this._uid);
            if (tollInput) {
                if (this._currentExclusions.indexOf('toll') !== -1) {
                    tollInput.checked = false;
                } else {
                    tollInput.checked = true;
                }
            }
            var tunnelInput = document.getElementById('GPisoExclusionsTunnel-' + this._uid);
            if (tunnelInput) {
                if (this._currentExclusions.indexOf('tunnel') !== -1) {
                    tunnelInput.checked = false;
                } else {
                    tunnelInput.checked = true;
                }
            }
            var bridgeInput = document.getElementById('GPisoExclusionsBridge-' + this._uid);
            if (bridgeInput) {
                if (this._currentExclusions.indexOf('bridge') !== -1 && bridgeInput) {
                    bridgeInput.checked = false;
                } else {
                    bridgeInput.checked = true;
                }
            }
        };
        Isocurve.prototype._clearGeojsonLayer = function () {
            var map = this.getMap();
            if (this._geojsonLayer) {
                map.removeLayer(this._geojsonLayer);
                this._geojsonLayer = null;
            }
        };
        Isocurve.prototype._hideIsoSuggestedLocations = function (e) {
            if (e.target && e.target.id && e.target.id.indexOf('GPlocationOrigin_') !== -1) {
                return;
            } else {
                this._originPoint._hideSuggestedLocation();
            }
        };
        Isocurve.prototype._displayWaitingContainer = function () {
            this._waitingContainer.className = 'GPisochronCalcWaitingContainerVisible';
            this._waiting = true;
            var opts = this.options.isocurveOptions;
            if (opts && opts.timeOut) {
                if (this._timer) {
                    clearTimeout(this._timer);
                    this._timer = null;
                }
                var context = this;
                this._timer = setTimeout(function () {
                    if (context._waiting === true) {
                        context._hideWaitingContainer();
                    } else {
                        if (context._timer) {
                            clearTimeout(context._timer);
                        }
                    }
                }, 16000);
            }
        };
        Isocurve.prototype._hideWaitingContainer = function () {
            if (this._waiting) {
                this._waitingContainer.className = 'GPisochronCalcWaitingContainerHidden';
                this._waiting = false;
                var opts = this.options.isocurveOptions;
                if (opts && opts.timeOut) {
                    clearTimeout(this._timer);
                    this._timer = null;
                }
            }
        };
        return Isocurve;
    }(ol, gp, CommonUtils, {}, CommonUtilsCheckRightManagement, CommonUtilsSelectorID, Ol3ControlsLocationSelector, Ol3ControlsLayerSwitcher, Ol3ControlsUtilsMarkers, CommonControlsIsoDOM);
    CommonControlsReverseGeocodingDOM = function () {
        var ReverseGeocodingDOM = {
            _addUID: function (id) {
                var uid = this._uid ? id + '-' + this._uid : id;
                return uid;
            },
            _createMainContainerElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GPreverseGeocoding');
                container.className = 'GPwidget';
                return container;
            },
            _createShowReverseGeocodingElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPshowReverseGeocoding');
                input.type = 'checkbox';
                return input;
            },
            _createShowReverseGeocodingPictoElement: function () {
                var self = this;
                var label = document.createElement('label');
                label.id = this._addUID('GPshowReverseGeocodingPicto');
                label.className = 'GPshowAdvancedToolPicto';
                label.htmlFor = this._addUID('GPshowReverseGeocoding');
                label.title = 'Ouvrir la recherche inverse';
                if (label.addEventListener) {
                    label.addEventListener('click', function () {
                        self.onShowReverseGeocodingClick();
                    });
                } else if (label.attachEvent) {
                    label.attachEvent('onclick', function () {
                        self.onShowReverseGeocodingClick();
                    });
                }
                var spanOpen = document.createElement('span');
                spanOpen.id = this._addUID('GPshowReverseGeocodingOpen');
                spanOpen.className = 'GPshowAdvancedToolOpen';
                label.appendChild(spanOpen);
                return label;
            },
            _createReverseGeocodingWaitingElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPreverseGeocodingCalcWaitingContainer');
                div.className = 'GPreverseGeocodingCalcWaitingContainerHidden';
                var p = document.createElement('p');
                p.className = 'GPreverseGeocodingCalcWaiting';
                p.innerHTML = 'Recherche en cours...';
                div.appendChild(p);
                return div;
            },
            _createReverseGeocodingResultsPanelElement: function () {
                var resultsPanelDiv = document.createElement('div');
                resultsPanelDiv.id = this._addUID('GPreverseGeocodingResultsPanel');
                resultsPanelDiv.className = 'GPpanel GPreverseGeocodingComponentHidden';
                return resultsPanelDiv;
            },
            _createReverseGeocodingResultsListElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GPreverseGeocodingResultsList');
                return container;
            },
            _createReverseGeocodingResultElement: function (locationDescription, id) {
                var context = this;
                var container = document.getElementById(this._addUID('GPreverseGeocodingResultsList'));
                var div = document.createElement('div');
                div.id = this._addUID('ReverseGeocodedLocation_' + id);
                div.className = 'GPautoCompleteProposal';
                div.innerHTML = locationDescription;
                div.title = locationDescription;
                if (div.addEventListener) {
                    div.addEventListener('mouseover', function (e) {
                        context.onReverseGeocodingResultMouseOver(e);
                    });
                    div.addEventListener('mouseout', function (e) {
                        context.onReverseGeocodingResultMouseOut(e);
                    });
                    div.addEventListener('click', function (e) {
                        if (typeof context.onReverseGeocodingResultClick === 'function') {
                            context.onReverseGeocodingResultClick(e);
                        }
                    });
                } else if (div.attachEvent) {
                    div.attachEvent('onmouseover', function (e) {
                        context.onReverseGeocodingResultMouseOver(e);
                    });
                    div.attachEvent('onmouseout', function (e) {
                        context.onReverseGeocodingResultMouseOut(e);
                    });
                    div.attachEvent('onclick', function (e) {
                        if (typeof context.onReverseGeocodingResultClick === 'function') {
                            context.onReverseGeocodingResultClick(e);
                        }
                    });
                }
                container.appendChild(div);
            },
            _createReverseGeocodingPanelElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPreverseGeocodingPanel');
                div.className = 'GPpanel';
                return div;
            },
            _createReverseGeocodingPanelHeaderElement: function () {
                var container = document.createElement('div');
                container.className = 'GPpanelHeader';
                return container;
            },
            _createReverseGeocodingPanelReturnPictoElement: function () {
                var self = this;
                var divNew = document.createElement('div');
                divNew.id = this._addUID('GPreverseGeocodingReturnPicto');
                divNew.title = 'Nouvelle recherche';
                divNew.className = 'GPreverseGeocodingReturnPictoHidden';
                if (divNew.addEventListener) {
                    divNew.addEventListener('click', function (e) {
                        document.getElementById(self._addUID('GPreverseGeocodingResultsPanel')).className = 'GProuteComponentHidden';
                        document.getElementById(self._addUID('GPreverseGeocodingForm')).className = '';
                        document.getElementById(self._addUID('GPreverseGeocodingHeaderTitle')).innerHTML = 'Recherche inverse';
                        document.getElementById(self._addUID('GPreverseGeocodingReturnPicto')).className = 'GPreverseGeocodingReturnPictoHidden';
                        self.onGPreverseGeocodingReturnPictoClick(e);
                    });
                } else if (divNew.attachEvent) {
                    divNew.attachEvent('onclick', function (e) {
                        document.getElementById(self._addUID('GPreverseGeocodingResultsPanel')).className = 'GProuteComponentHidden';
                        document.getElementById(self._addUID('GPreverseGeocodingForm')).className = '';
                        document.getElementById(self._addUID('GPreverseGeocodingHeaderTitle')).innerHTML = 'Recherche inverse';
                        document.getElementById(self._addUID('GPreverseGeocodingReturnPicto')).className = 'GPreverseGeocodingReturnPictoHidden';
                        self.onGPreverseGeocodingReturnPictoClick(e);
                    });
                }
                return divNew;
            },
            _createReverseGeocodingPanelTitleElement: function () {
                var div = document.createElement('div');
                div.className = 'GPpanelTitle';
                div.id = this._addUID('GPreverseGeocodingHeaderTitle');
                div.innerHTML = 'Recherche inverse';
                return div;
            },
            _createReverseGeocodingPanelCloseElement: function () {
                var self = this;
                var divClose = document.createElement('div');
                divClose.id = this._addUID('GPreverseGeocodingPanelClose');
                divClose.className = 'GPpanelClose';
                divClose.title = 'Fermer le panneau';
                if (divClose.addEventListener) {
                    divClose.addEventListener('click', function () {
                        document.getElementById(self._addUID('GPshowReverseGeocodingPicto')).click();
                    }, false);
                } else if (divClose.attachEvent) {
                    divClose.attachEvent('onclick', function () {
                        document.getElementById(self._addUID('GPshowReverseGeocodingPicto')).click();
                    });
                }
                return divClose;
            },
            _createReverseGeocodingPanelFormElement: function () {
                var self = this;
                var form = document.createElement('form');
                form.id = this._addUID('GPreverseGeocodingForm');
                if (form.addEventListener) {
                    form.addEventListener('submit', function (e) {
                        e.preventDefault();
                        self.onReverseGeocodingSubmit();
                    });
                } else if (form.attachEvent) {
                    form.attachEvent('onsubmit', function (e) {
                        e.preventDefault();
                        self.onReverseGeocodingSubmit();
                    });
                }
                return form;
            },
            _createReverseGeocodingFormModeChoiceGeocodingTypeElement: function (resources) {
                var context = this;
                var div = document.createElement('div');
                div.className = 'GPflexInput';
                var label = document.createElement('label');
                label.className = 'GPreverseGeocodingCodeLabel';
                label.innerHTML = 'Recherche par';
                label.title = 'Recherche par';
                div.appendChild(label);
                var select = document.createElement('select');
                select.className = 'GPreverseGeocodingCode';
                if (select.addEventListener) {
                    select.addEventListener('change', function (e) {
                        context.onReverseGeocodingTypeChange(e);
                    });
                } else if (select.attachEvent) {
                    select.attachEvent('onchange', function (e) {
                        context.onReverseGeocodingTypeChange(e);
                    });
                }
                if (!resources || !Array.isArray(resources)) {
                    resources = [
                        'StreetAddress',
                        'PositionOfInterest',
                        'CadastralParcel'
                    ];
                }
                for (var i = 0; i < resources.length; i++) {
                    switch (resources[i]) {
                    case 'PositionOfInterest':
                        var POIOption = document.createElement('option');
                        POIOption.value = 'PositionOfInterest';
                        POIOption.text = 'Lieux/toponymes';
                        select.appendChild(POIOption);
                        break;
                    case 'StreetAddress':
                        var SAOption = document.createElement('option');
                        SAOption.value = 'StreetAddress';
                        SAOption.text = 'Adresses';
                        select.appendChild(SAOption);
                        break;
                    case 'CadastralParcel':
                        var CPOption = document.createElement('option');
                        CPOption.value = 'CadastralParcel';
                        CPOption.text = 'Parcelles cadastrales';
                        select.appendChild(CPOption);
                        break;
                    case 'Administratif':
                        var adminOption = document.createElement('option');
                        adminOption.value = 'Administratif';
                        adminOption.text = 'Unités administratives';
                        select.appendChild(adminOption);
                        break;
                    default:
                        break;
                    }
                }
                div.appendChild(select);
                return div;
            },
            _createReverseGeocodingFormModeChoiceGeocodingDelimitationElement: function (delimitations) {
                var context = this;
                var div = document.createElement('div');
                div.className = 'GPflexInput';
                var label = document.createElement('label');
                label.className = 'GPreverseGeocodingCodeLabel';
                label.innerHTML = 'Délimitation';
                label.title = 'Délimitation';
                div.appendChild(label);
                var select = document.createElement('select');
                select.className = 'GPreverseGeocodingCode';
                if (select.addEventListener) {
                    select.addEventListener('change', function (e) {
                        context.onReverseGeocodingDelimitationChange(e);
                    });
                } else if (select.attachEvent) {
                    select.attachEvent('onchange', function (e) {
                        context.onReverseGeocodingDelimitationChange(e);
                    });
                }
                if (!delimitations || !Array.isArray(delimitations)) {
                    delimitations = [
                        'Point',
                        'Circle',
                        'Extent'
                    ];
                }
                for (var i = 0; i < delimitations.length; i++) {
                    switch (delimitations[i].toLowerCase()) {
                    case 'point':
                        var pointOption = document.createElement('option');
                        pointOption.value = 'point';
                        pointOption.text = 'Pointer un lieu';
                        select.appendChild(pointOption);
                        break;
                    case 'circle':
                        var circleOption = document.createElement('option');
                        circleOption.value = 'circle';
                        circleOption.text = 'Dessiner un cercle';
                        select.appendChild(circleOption);
                        break;
                    case 'extent':
                        var extentOption = document.createElement('option');
                        extentOption.value = 'extent';
                        extentOption.text = 'Dessiner une emprise';
                        select.appendChild(extentOption);
                        break;
                    default:
                        break;
                    }
                }
                div.appendChild(select);
                return div;
            },
            _createReverseGeocodingSubmitFormElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPreverseGeocodingSubmit');
                input.className = 'GPinputSubmit';
                input.type = 'submit';
                input.value = 'Rechercher';
                return input;
            }
        };
        return ReverseGeocodingDOM;
    }();
    Ol3ControlsReverseGeocode = function (woodman, ol, Gp, Utils, Markers, LayerSwitcher, RightManagement, SelectorID, ReverseGeocodingDOM) {
        function ReverseGeocode(options) {
            options = options || {};
            if (!(this instanceof ReverseGeocode)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            this.initialize(options);
            this._container = this._initContainer();
            this._containerElement = null;
            if (options.element && options.element.appendChild) {
                options.element.appendChild(this._container);
                this._containerElement = options.element;
            }
            ol.control.Control.call(this, {
                element: this._containerElement || this._container,
                target: options.target,
                render: options.render
            });
        }
        ol.inherits(ReverseGeocode, ol.control.Control);
        ReverseGeocode.prototype = Object.create(ol.control.Control.prototype, {});
        Utils.assign(ReverseGeocode.prototype, ReverseGeocodingDOM);
        ReverseGeocode.prototype.constructor = ReverseGeocode;
        ReverseGeocode.prototype.getCollapsed = function () {
            return this.collapsed;
        };
        ReverseGeocode.prototype.setCollapsed = function (collapsed) {
            if (collapsed === undefined) {
                console.log('[ERROR] ReverseGeocode:setCollapsed - missing collapsed parameter');
                return;
            }
            if (collapsed && this.collapsed || !collapsed && !this.collapsed) {
                return;
            }
            if (collapsed) {
                document.getElementById('GPreverseGeocodingPanelClose-' + this._uid).click();
            } else {
                document.getElementById('GPshowReverseGeocoding-' + this._uid).click();
            }
            this.collapsed = collapsed;
        };
        ReverseGeocode.prototype.setMap = function (map) {
            if (map) {
                this._activateMapInteraction(map);
            } else {
                var _map = this.getMap();
                this._clearResults();
                this._clearInputFeatures();
                this._removeMapInteraction(_map);
                if (this._inputFeaturesLayer != null) {
                    _map.removeLayer(this._inputFeaturesLayer);
                    this._inputFeaturesLayer = null;
                    this._inputFeaturesSources = null;
                    this._inputFeatures = null;
                }
            }
            ol.control.Control.prototype.setMap.call(this, map);
        };
        ReverseGeocode.prototype.initialize = function (options) {
            this._checkInputOptions(options);
            this.options = {
                collapsed: true,
                resources: [
                    'StreetAddress',
                    'PositionOfInterest',
                    'CadastralParcel'
                ],
                delimitations: [
                    'Point',
                    'Circle',
                    'Extent'
                ],
                reverseGeocodeOptions: {}
            };
            Utils.assign(this.options, options);
            this.collapsed = this.options.collapsed;
            this._uid = SelectorID.generate();
            this._servicesRightManagement = {};
            this._noRightManagement = false;
            this._checkRightsManagement();
            this._currentGeocodingType = null;
            this._initGeocodingType();
            this._currentGeocodingDelimitation = null;
            this._initGeocodingDelimitation();
            this._showReverseGeocodingInput = null;
            this._panelHeaderContainer = null;
            this._panelTitleContainer = null;
            this._returnPictoContainer = null;
            this._formContainer = null;
            this._resultsContainer = null;
            this._resultsListContainer = null;
            this._waitingContainer = null;
            this._inputFeatures = null;
            this._inputFeaturesSource = null;
            this._inputFeaturesLayer = null;
            this._mapInteraction = null;
            this._requestOptions = null;
            this._requestPosition = null;
            this._requestCircleFilter = null;
            this._requestBboxFilter = null;
            this._waiting = false;
            this._timer = null;
            this._reverseGeocodingLocations = [];
            this._reverseGeocodingLocationsMarkers = [];
            this._resultsDefaultStyle = new ol.style.Style({
                image: new ol.style.Icon({
                    src: Markers['lightOrange'],
                    anchor: [
                        0.5,
                        1
                    ]
                })
            });
            this._resultsSelectedStyle = new ol.style.Style({
                image: new ol.style.Icon({
                    src: Markers['red'],
                    anchor: [
                        0.5,
                        1
                    ]
                })
            });
            this._resultsHoverInteraction = null;
            this._resultsSelectInteraction = null;
            this._popupContent = null;
            this._popupDiv = this._initPopupDiv();
            this._popupOverlay = null;
        };
        ReverseGeocode.prototype._checkInputOptions = function (options) {
            var i;
            var j;
            if (options.resources) {
                var resources = options.resources;
                if (!Array.isArray(resources)) {
                    console.log('[ReverseGeocode] \'options.resources\' parameter should be an array');
                    resources = null;
                }
                var resourcesList = [
                    'StreetAddress',
                    'PositionOfInterest',
                    'CadastralParcel',
                    'Administratif'
                ];
                var wrongResourcesIndexes = [];
                for (i = 0; i < resources.length; i++) {
                    if (resourcesList.indexOf(resources[i]) === -1) {
                        wrongResourcesIndexes.push(i);
                        console.log('[ReverseGeocode] options.resources : ' + resources[i] + ' is not a resource for reverse geocode');
                    }
                }
                if (wrongResourcesIndexes.length !== 0) {
                    for (j = 0; j < wrongResourcesIndexes.length; j++) {
                        resources.splice(wrongResourcesIndexes[j], 1);
                    }
                }
            }
            if (options.delimitations) {
                var delimitations = options.delimitations;
                if (!Array.isArray(delimitations)) {
                    console.log('[ReverseGeocode] \'options.delimitations\' parameter should be an array');
                    delimitations = null;
                }
                var delimitationsList = [
                    'Circle',
                    'Point',
                    'Extent'
                ];
                var wrongDelimitationsIndexes = [];
                for (i = 0; i < delimitations.length; i++) {
                    if (delimitationsList.indexOf(delimitations[i]) === -1) {
                        wrongDelimitationsIndexes.push(i);
                        console.log('[ReverseGeocode] options.delimitations : ' + delimitations[i] + ' is not a delimitation for reverse geocode');
                    }
                }
                if (wrongDelimitationsIndexes.length !== 0) {
                    for (j = 0; j < wrongDelimitationsIndexes.length; j++) {
                        delimitations.splice(wrongDelimitationsIndexes[j], 1);
                    }
                }
            }
        };
        ReverseGeocode.prototype._initGeocodingType = function () {
            this._currentGeocodingType = 'StreetAddress';
            var resources = this.options.resources;
            if (!resources || resources.length === 0) {
                this.options.resources = [
                    'StreetAddress',
                    'PositionOfInterest',
                    'CadastralParcel'
                ];
            }
            if (Array.isArray(resources) && resources.length) {
                var noRightsIndexes = [];
                for (var i = 0; i < resources.length; i++) {
                    if (this._servicesRightManagement['Geocode'].indexOf(resources[i]) < 0) {
                        noRightsIndexes.push(i);
                        console.log('[ReverseGeocode] no rights for options.resources : ' + resources[i]);
                    }
                }
                if (noRightsIndexes.length !== 0) {
                    for (var j = 0; j < noRightsIndexes.length; j++) {
                        resources.splice(noRightsIndexes[j], 1);
                    }
                }
                if (resources[0] === 'StreetAddress' || resources[0] === 'PositionOfInterest' || resources[0] === 'CadastralParcel' || resources[0] === 'Administratif') {
                    this._currentGeocodingType = resources[0];
                }
            }
            var serviceOptions = this.options.reverseGeocodeOptions;
            if (serviceOptions.filterOptions && Array.isArray(serviceOptions.filterOptions.type) && serviceOptions.filterOptions.type.length !== 0) {
                this._currentGeocodingType = serviceOptions.filterOptions.type[0];
            }
        };
        ReverseGeocode.prototype._initGeocodingDelimitation = function () {
            this._currentGeocodingDelimitation = 'Point';
            var delimitations = this.options.delimitations;
            if (!delimitations || delimitations.length === 0) {
                this.options.delimitations = [
                    'Point',
                    'Circle',
                    'Extent'
                ];
            }
            if (Array.isArray(delimitations) && delimitations.length) {
                var d = delimitations[0].toLowerCase();
                if (d === 'point' || d === 'circle' || d === 'extent') {
                    this._currentGeocodingDelimitation = delimitations[0];
                }
            }
        };
        ReverseGeocode.prototype._initPopupDiv = function () {
            var context = this;
            var element = document.createElement('div');
            element.className = 'gp-feature-info-div';
            var closer = document.createElement('input');
            closer.type = 'button';
            closer.className = 'gp-styling-button closer';
            closer.onclick = function () {
                if (context._popupOverlay != null) {
                    context._popupOverlay.setPosition(undefined);
                }
                return false;
            };
            this._popupContent = document.createElement('div');
            this._popupContent.className = 'gp-features-content-div';
            element.appendChild(this._popupContent);
            element.appendChild(closer);
            return element;
        };
        ReverseGeocode.prototype._checkRightsManagement = function () {
            var _resources = [];
            var _key;
            var _opts = null;
            _key = this.options.reverseGeocodeOptions.apiKey;
            _opts = this.options.reverseGeocodeOptions.filterOptions;
            _resources = _opts ? _opts.type : [];
            if (!_resources || _resources.length === 0) {
                _resources = this.options.resources;
            }
            if (!_resources || _resources.length === 0) {
                _resources = [
                    'StreetAddress',
                    'PositionOfInterest'
                ];
            }
            var rightManagementGeocode = RightManagement.check({
                key: _key || this.options.apiKey,
                resources: _resources,
                services: ['Geocode']
            });
            if (!rightManagementGeocode) {
                this._noRightManagement = true;
                return;
            }
            if (!this.options.apiKey) {
                this.options.apiKey = rightManagementGeocode.key;
            }
            if (rightManagementGeocode) {
                this._servicesRightManagement['Geocode'] = rightManagementGeocode['Geocode'];
            }
        };
        ReverseGeocode.prototype._initContainer = function () {
            var container = this._createMainContainerElement();
            var inputShow = this._showReverseGeocodingInput = this._createShowReverseGeocodingElement();
            container.appendChild(inputShow);
            if (!this.collapsed) {
                inputShow.checked = true;
            }
            var picto = this._createShowReverseGeocodingPictoElement();
            container.appendChild(picto);
            var reverseGeocodingPanel = this._createReverseGeocodingPanelElement();
            var panelHeader = this._panelHeaderContainer = this._createReverseGeocodingPanelHeaderElement();
            var returnPicto = this._returnPictoContainer = this._createReverseGeocodingPanelReturnPictoElement();
            panelHeader.appendChild(returnPicto);
            var panelTitle = this._panelTitleContainer = this._createReverseGeocodingPanelTitleElement();
            panelHeader.appendChild(panelTitle);
            var closeDiv = this._createReverseGeocodingPanelCloseElement();
            panelHeader.appendChild(closeDiv);
            reverseGeocodingPanel.appendChild(panelHeader);
            var reverseGeocodingForm = this._formContainer = this._createReverseGeocodingPanelFormElement();
            reverseGeocodingForm.appendChild(this._createReverseGeocodingFormModeChoiceGeocodingTypeElement(this.options.resources));
            reverseGeocodingForm.appendChild(this._createReverseGeocodingFormModeChoiceGeocodingDelimitationElement(this.options.delimitations));
            var submit = this._createReverseGeocodingSubmitFormElement();
            reverseGeocodingForm.appendChild(submit);
            reverseGeocodingPanel.appendChild(reverseGeocodingForm);
            var waiting = this._waitingContainer = this._createReverseGeocodingWaitingElement();
            reverseGeocodingPanel.appendChild(waiting);
            var resultsPanel = this._resultsContainer = this._createReverseGeocodingResultsPanelElement();
            var reverseGeocodingResultsList = this._resultsListContainer = this._createReverseGeocodingResultsListElement();
            resultsPanel.appendChild(reverseGeocodingResultsList);
            reverseGeocodingPanel.appendChild(resultsPanel);
            container.appendChild(reverseGeocodingPanel);
            return container;
        };
        ReverseGeocode.prototype._activateMapInteraction = function (map) {
            if (!this.collapsed) {
                if (this._inputFeaturesLayer == null) {
                    this._inputFeatures = new ol.Collection();
                    this._inputFeaturesSource = new ol.source.Vector({ features: this._inputFeatures });
                    this._inputFeaturesLayer = new ol.layer.Vector({
                        source: this._inputFeaturesSource,
                        style: new ol.style.Style({
                            fill: new ol.style.Fill({ color: 'rgba(0, 183, 152, 0.3)' }),
                            stroke: new ol.style.Stroke({
                                color: 'rgba(0, 183, 152, 0.8)',
                                width: 3
                            }),
                            image: new ol.style.Icon({
                                src: Markers['turquoiseBlue'],
                                anchor: [
                                    0.5,
                                    1
                                ]
                            })
                        })
                    });
                    this._inputFeaturesLayer.gpResultLayerId = 'reverseGeocoding';
                    map.addLayer(this._inputFeaturesLayer);
                }
                var delimitation = this._currentGeocodingDelimitation.toLowerCase();
                switch (delimitation) {
                case 'point':
                    this._activatePointInteraction(map);
                    break;
                case 'circle':
                    this._activateCircleInteraction(map);
                    break;
                case 'extent':
                    this._activateBoxInteraction(map);
                    break;
                default:
                    break;
                }
                map.getControls().forEach(function (control) {
                    if (control instanceof LayerSwitcher) {
                        var layerId = this._inputFeaturesLayer.gpLayerId;
                        if (control._layers[layerId].title === layerId) {
                            control.addLayer(this._inputFeaturesLayer, {
                                title: 'Saisie (recherche inverse)',
                                description: 'Couche de saisie d\'une zone de recherche pour la recherche inverse'
                            });
                            control.setRemovable(this._inputFeaturesLayer, false);
                        }
                    }
                }, this);
            }
        };
        ReverseGeocode.prototype._activatePointInteraction = function (map) {
            this._mapInteraction = new ol.interaction.Draw({
                style: new ol.style.Style({
                    image: new ol.style.Circle({
                        radius: 0,
                        fill: new ol.style.Fill({ color: 'rgba(0, 183, 152, 0.8)' })
                    })
                }),
                type: 'Point',
                source: this._inputFeaturesSource
            });
            this._mapInteraction.on('drawstart', function (e) {
                this._inputFeatures.clear();
                this._onDrawStart(e, 'point');
            }, this);
            map.addInteraction(this._mapInteraction);
            this._setCursor('crosshair', map);
        };
        ReverseGeocode.prototype._activateCircleInteraction = function (map) {
            this._mapInteraction = new ol.interaction.Draw({
                style: new ol.style.Style({
                    fill: new ol.style.Fill({ color: 'rgba(0, 183, 152, 0.3)' }),
                    stroke: new ol.style.Stroke({
                        color: 'rgba(0, 183, 152, 0.8)',
                        width: 3
                    }),
                    image: new ol.style.Circle({
                        radius: 4,
                        fill: new ol.style.Fill({ color: 'rgba(0, 183, 152, 0.8)' })
                    })
                }),
                type: 'Circle',
                source: this._inputFeaturesSource
            });
            this._mapInteraction.on('drawstart', function (e) {
                this._inputFeatures.clear();
                this._onDrawStart(e, 'circle');
            }, this);
            this._mapInteraction.on('drawend', function (e) {
                if (e.feature && e.feature.getGeometry) {
                    var radius = e.feature.getGeometry().getRadius();
                    this._requestCircleFilter = {};
                    this._requestCircleFilter.radius = radius;
                    if (this._requestPosition) {
                        this._requestCircleFilter.x = this._requestPosition.x;
                        this._requestCircleFilter.y = this._requestPosition.y;
                    }
                }
            }, this);
            map.addInteraction(this._mapInteraction);
        };
        ReverseGeocode.prototype._activateBoxInteraction = function (map) {
            var geometryFunction = function (coordinates, geometry) {
                if (!geometry) {
                    geometry = new ol.geom.Polygon(null);
                }
                var start = coordinates[0];
                var end = coordinates[1];
                geometry.setCoordinates([[
                        start,
                        [
                            start[0],
                            end[1]
                        ],
                        end,
                        [
                            end[0],
                            start[1]
                        ],
                        start
                    ]]);
                return geometry;
            };
            this._mapInteraction = new ol.interaction.Draw({
                style: new ol.style.Style({
                    fill: new ol.style.Fill({ color: 'rgba(0, 183, 152, 0.3)' }),
                    stroke: new ol.style.Stroke({
                        color: 'rgba(0, 183, 152, 0.8)',
                        width: 3
                    }),
                    image: new ol.style.Circle({
                        radius: 4,
                        fill: new ol.style.Fill({ color: 'rgba(0, 183, 152, 0.8)' })
                    })
                }),
                type: 'LineString',
                source: this._inputFeaturesSource,
                maxPoints: 2,
                geometryFunction: geometryFunction
            });
            this._mapInteraction.on('drawstart', function (e) {
                this._inputFeatures.clear();
            }, this);
            this._mapInteraction.on('drawend', function (e) {
                this._onBoxDrawEnd(e);
            }, this);
            map.addInteraction(this._mapInteraction);
        };
        ReverseGeocode.prototype._removeMapInteraction = function (map) {
            if (this._mapInteraction != null) {
                map.removeInteraction(this._mapInteraction);
                this._mapInteraction = null;
            }
            this._setCursor();
        };
        ReverseGeocode.prototype._onDrawStart = function (e, type) {
            var coordinate;
            if (e.feature && e.feature.getGeometry) {
                var geometry = e.feature.getGeometry();
                if (type === 'point') {
                    coordinate = geometry.getCoordinates();
                }
                if (type === 'circle') {
                    coordinate = geometry.getCenter();
                }
            }
            if (!coordinate) {
                return;
            }
            var crs;
            if (this.options.reverseGeocodeOptions && this.options.reverseGeocodeOptions.srs) {
                crs = this.options.reverseGeocodeOptions.srs;
            } else {
                var map = this.getMap();
                if (!map || !map.getView()) {
                    return;
                }
                crs = map.getView().getProjection();
            }
            var geoCoordinate = ol.proj.transform(coordinate, crs, 'EPSG:4326');
            this._requestPosition = {
                x: geoCoordinate[0],
                y: geoCoordinate[1]
            };
        };
        ReverseGeocode.prototype._onBoxDrawEnd = function (e) {
            if (e.feature && e.feature.getGeometry) {
                var coordinates = e.feature.getGeometry().getCoordinates()[0];
                var start = coordinates[0];
                var end = coordinates[2];
                var crs;
                if (this.options.reverseGeocodeOptions && this.options.reverseGeocodeOptions.srs) {
                    crs = this.options.reverseGeocodeOptions.srs;
                } else {
                    var map = this.getMap();
                    if (!map || !map.getView()) {
                        return;
                    }
                    crs = map.getView().getProjection();
                }
                var startGeoCoordinate = ol.proj.transform(start, crs, 'EPSG:4326');
                var endGeoCoordinate = ol.proj.transform(end, crs, 'EPSG:4326');
                this._requestPosition = {};
                this._requestBboxFilter = {};
                if (startGeoCoordinate[0] < endGeoCoordinate[0]) {
                    this._requestBboxFilter.left = startGeoCoordinate[0];
                    this._requestBboxFilter.right = endGeoCoordinate[0];
                } else {
                    this._requestBboxFilter.left = endGeoCoordinate[0];
                    this._requestBboxFilter.right = startGeoCoordinate[0];
                }
                if (startGeoCoordinate[1] < endGeoCoordinate[1]) {
                    this._requestBboxFilter.bottom = startGeoCoordinate[1];
                    this._requestBboxFilter.top = endGeoCoordinate[1];
                } else {
                    this._requestBboxFilter.bottom = endGeoCoordinate[1];
                    this._requestBboxFilter.top = startGeoCoordinate[1];
                }
                this._requestPosition.x = (startGeoCoordinate[0] + endGeoCoordinate[0]) / 2;
                this._requestPosition.y = (startGeoCoordinate[1] + endGeoCoordinate[1]) / 2;
            }
        };
        ReverseGeocode.prototype._setCursor = function (cursor, map) {
            map = map || this.getMap();
            if (!map) {
                return;
            }
            var div = map.getTargetElement();
            if (cursor) {
                div.style.cursor = cursor;
            } else {
                div.style.cursor = null;
            }
        };
        ReverseGeocode.prototype._reverseGeocodingRequest = function () {
            var map = this.getMap();
            this._requestOptions = this._getReverseGeocodingRequestOptions();
            this._removeMapInteraction(map);
            this._displayWaitingContainer();
            Gp.Services.reverseGeocode(this._requestOptions);
        };
        ReverseGeocode.prototype._getReverseGeocodingRequestOptions = function () {
            var map = this.getMap();
            var reverseGeocodeOptions = this.options.reverseGeocodeOptions;
            var context = this;
            var requestOptions = {
                apiKey: reverseGeocodeOptions.apiKey || this.options.apiKey,
                position: this._requestPosition,
                filterOptions: { type: [this._currentGeocodingType] },
                srs: 'CRS:84',
                returnFreeForm: false,
                maximumResponses: reverseGeocodeOptions.maximumResponses || 25,
                timeOut: reverseGeocodeOptions.timeOut || 30000,
                protocol: reverseGeocodeOptions.protocol || 'XHR',
                onSuccess: function (response) {
                    if (response.locations) {
                        context._displayGeocodedLocations(response.locations);
                    }
                },
                onFailure: function (error) {
                    context._hideWaitingContainer();
                    context._clearResults();
                    context._clearInputFeatures();
                    context._activateMapInteraction(map);
                }
            };
            if (this._currentGeocodingDelimitation.toLowerCase() === 'circle' && this._requestCircleFilter) {
                if (this._requestCircleFilter.radius > 1000) {
                    console.log('INFO : initial circle radius (' + this._requestCircleFilter.radius + ') limited to 1000m.');
                    this._requestCircleFilter.radius = 1000;
                }
                requestOptions.filterOptions.circle = this._requestCircleFilter;
            }
            if (this._currentGeocodingDelimitation.toLowerCase() === 'extent' && this._requestBboxFilter) {
                requestOptions.filterOptions.bbox = this._requestBboxFilter;
            }
            return requestOptions;
        };
        ReverseGeocode.prototype._displayGeocodedLocations = function (locations) {
            this._clearResults();
            this._reverseGeocodingLocations = locations;
            this._formContainer.className = 'GPreverseGeocodingComponentHidden';
            this._hideWaitingContainer();
            this._panelTitleContainer.innerHTML = 'Résultats de la recherche';
            this._returnPictoContainer.className = '';
            this._resultsContainer.className = 'GPpanel';
            this._fillGeocodedLocationListContainer(locations);
            this._displayGeocodedLocationsOnMap(locations);
        };
        ReverseGeocode.prototype._fillGeocodedLocationListContainer = function (locations) {
            for (var i = 0; i < locations.length; i++) {
                var location = locations[i];
                var locationDescription = this._fillGeocodedLocationDescription(location);
                if (locationDescription.length !== 0) {
                    this._createReverseGeocodingResultElement(locationDescription, i);
                }
            }
        };
        ReverseGeocode.prototype._fillGeocodedLocationDescription = function (location) {
            if (!location || !location.placeAttributes) {
                return;
            }
            var attr = location.placeAttributes;
            var locationDescription = '';
            switch (location.type) {
            case 'StreetAddress':
                if (attr.street) {
                    locationDescription += attr.number ? attr.number + ' ' : '';
                    locationDescription += attr.street + ', ';
                }
                locationDescription += attr.postalCode + ' ' + attr.commune;
                break;
            case 'PositionOfInterest':
                if (location.matchType === 'City' && attr.commune) {
                    locationDescription += attr.commune;
                    locationDescription += attr.postalCode ? ', ' + attr.postalCode : '';
                } else if (location.matchType === 'Département' && attr.municipality) {
                    locationDescription += attr.municipality;
                    locationDescription += attr.postalCode ? ', ' + attr.postalCode : '';
                } else if (location.matchType === 'Toponym' && attr.municipality) {
                    locationDescription += attr.municipality;
                    locationDescription += attr.postalCode ? ', ' + attr.postalCode : '';
                    locationDescription += attr.commune ? ' ' + attr.commune : '';
                } else {
                    locationDescription += attr.municipality ? attr.municipality : '';
                }
                locationDescription += attr.nature ? ' (' + attr.nature + ') ' : '';
                break;
            case 'CadastralParcel':
                locationDescription += attr.cadastralParcel ? attr.cadastralParcel : '';
                locationDescription += attr.municipality ? ' (' + attr.municipality + ')' : '';
                break;
            case 'Administratif':
                locationDescription += attr.municipality ? attr.municipality : '';
                if (attr.inseeDepartment) {
                    locationDescription += '(Département)';
                } else if (attr.inseeRegion) {
                    locationDescription += '(Région)';
                }
                break;
            default:
                locationDescription += attr.municipality ? attr.municipality : '';
                break;
            }
            return locationDescription;
        };
        ReverseGeocode.prototype._displayGeocodedLocationsOnMap = function (locations) {
            if (this._reverseGeocodingLocations.length !== 0) {
                var map = this.getMap();
                this._createResultsLayer();
                for (var i = 0; i < locations.length; i++) {
                    this._addResultFeature(locations[i], i);
                }
                if (this._resultsFeatures.getLength() > 1) {
                    if (this._resultsFeaturesSource && this._resultsFeaturesSource.getExtent) {
                        var extent = this._resultsFeaturesSource.getExtent();
                        map.getView().fit(extent, map.getSize());
                    }
                } else {
                    var feature = this._resultsFeatures.item(0);
                    var coords = feature.getGeometry().getCoordinates();
                    map.getView().setCenter(coords);
                    map.getView().setZoom(17);
                }
                this._resultsHoverInteraction = new ol.interaction.Select({
                    condition: ol.events.condition.pointerMove,
                    layers: [this._resultsFeaturesLayer]
                });
                this._resultsHoverInteraction.on('select', this._onResultsFeatureMouseOver, this);
                map.addInteraction(this._resultsHoverInteraction);
                this._resultsSelectInteraction = new ol.interaction.Select({ layers: [this._resultsFeaturesLayer] });
                this._resultsSelectInteraction.on('select', this._onResultsFeatureSelect, this);
                map.addInteraction(this._resultsSelectInteraction);
                var geocodeType = '';
                switch (this._currentGeocodingType) {
                case 'StreetAddress':
                    geocodeType = 'adresses';
                    break;
                case 'PositionOfInterest':
                    geocodeType = 'toponymes';
                    break;
                case 'CadastralParcel':
                    geocodeType = 'parcelles cadastrales';
                    break;
                case 'Administratif':
                    geocodeType = 'unités administratives';
                    break;
                default:
                    break;
                }
                map.getControls().forEach(function (control) {
                    if (control instanceof LayerSwitcher) {
                        var layerId = this._resultsFeaturesLayer.gpLayerId;
                        if (control._layers[layerId].title === layerId) {
                            control.addLayer(this._resultsFeaturesLayer, {
                                title: 'Résultats de la recherche inverse',
                                description: 'Résultats de la recherche inverse sur les ' + geocodeType
                            });
                            control.setRemovable(this._resultsFeaturesLayer, false);
                        }
                    }
                }, this);
            }
        };
        ReverseGeocode.prototype._createResultsLayer = function () {
            var map = this.getMap();
            this._resultsFeatures = new ol.Collection();
            this._resultsFeaturesSource = new ol.source.Vector({ features: this._resultsFeatures });
            this._resultsFeaturesLayer = new ol.layer.Vector({ source: this._resultsFeaturesSource });
            this._resultsFeaturesLayer.gpResultLayerId = 'reverseGeocodingResults';
            map.addLayer(this._resultsFeaturesLayer);
        };
        ReverseGeocode.prototype._addResultFeature = function (location, i) {
            var map = this.getMap();
            var position = [
                location.position.x,
                location.position.y
            ];
            if (!position) {
                return;
            }
            var view = map.getView();
            var mapProj = view.getProjection().getCode();
            if (mapProj !== 'EPSG:4326') {
                position = ol.proj.transform(position, 'EPSG:4326', mapProj);
            }
            var feature = new ol.Feature({ geometry: new ol.geom.Point(position) });
            feature.setStyle(this._resultsDefaultStyle);
            feature.setId(i);
            feature.setProperties({ popupContent: this._fillPopupContent(location) });
            this._resultsFeatures.push(feature);
        };
        ReverseGeocode.prototype._fillPopupContent = function (location) {
            var popupContent = '<ul>';
            var attributes = location.placeAttributes;
            for (var attr in attributes) {
                if (attributes.hasOwnProperty(attr)) {
                    if (attr !== 'bbox') {
                        popupContent += '<li>';
                        popupContent += '<span class="gp-attname-others-span">' + attr.toUpperCase() + ' : </span>';
                        popupContent += attributes[attr];
                        popupContent += ' </li>';
                    }
                }
            }
            popupContent += ' </ul>';
            return popupContent;
        };
        ReverseGeocode.prototype._onResultsFeatureMouseOver = function (e) {
            var f;
            if (e.selected.length !== 0) {
                f = e.selected[0];
                f.setStyle(this._resultsSelectedStyle);
                if (f.getId() != null) {
                    var selectedResultDiv = document.getElementById('ReverseGeocodedLocation_' + f.getId() + '-' + this._uid);
                    if (selectedResultDiv && selectedResultDiv.classList) {
                        selectedResultDiv.classList.add('GPreverseGeocodedLocationHighlight');
                    }
                }
                document.getElementById('ReverseGeocodedLocation_' + f.getId() + '-' + this._uid);
            }
            if (e.deselected.length !== 0) {
                f = e.deselected[0];
                f.setStyle(this._resultsDefaultStyle);
                var deSelectedResultDiv = document.getElementById('ReverseGeocodedLocation_' + f.getId() + '-' + this._uid);
                if (deSelectedResultDiv && deSelectedResultDiv.classList) {
                    deSelectedResultDiv.classList.remove('GPreverseGeocodedLocationHighlight');
                }
            }
        };
        ReverseGeocode.prototype._onResultsFeatureSelect = function (e) {
            var map = this.getMap();
            if (e.selected.length !== 0) {
                var f = e.selected[0];
                this._popupContent.innerHTML = f.getProperties().popupContent;
                if (!this._popupOverlay) {
                    this._popupOverlay = new ol.Overlay({
                        element: this._popupDiv,
                        positioning: 'bottom-center',
                        position: e.mapBrowserEvent.coordinate
                    });
                    map.addOverlay(this._popupOverlay);
                } else {
                    this._popupOverlay.setPosition(e.mapBrowserEvent.coordinate);
                }
            } else {
                if (this._popupOverlay != null) {
                    this._popupOverlay.setPosition(undefined);
                }
            }
        };
        ReverseGeocode.prototype.onShowReverseGeocodingClick = function () {
            this.collapsed = this._showReverseGeocodingInput.checked;
            this.dispatchEvent('change:collapsed');
            var map = this.getMap();
            if (!this._waiting && !this._reverseGeocodingLocations.length) {
                if (this.collapsed) {
                    this._clearResults();
                    this._clearInputFeatures();
                    this._removeMapInteraction(map);
                    if (this._inputFeaturesLayer != null) {
                        map.removeLayer(this._inputFeaturesLayer);
                        this._inputFeaturesLayer = null;
                        this._inputFeaturesSources = null;
                        this._inputFeatures = null;
                    }
                } else {
                    this._activateMapInteraction(map);
                }
            }
        };
        ReverseGeocode.prototype.onReverseGeocodingTypeChange = function (e) {
            var idx = e.target.selectedIndex;
            var value = e.target.options[idx].value;
            if (!value) {
                return;
            }
            this._currentGeocodingType = value;
        };
        ReverseGeocode.prototype.onReverseGeocodingDelimitationChange = function (e) {
            var idx = e.target.selectedIndex;
            var value = e.target.options[idx].value;
            if (!value) {
                return;
            }
            this._currentGeocodingDelimitation = value;
            var map = this.getMap();
            this._clearInputFeatures();
            this._removeMapInteraction(map);
            this._activateMapInteraction(map);
        };
        ReverseGeocode.prototype.onGPreverseGeocodingReturnPictoClick = function () {
            this._clearResults();
            this._clearInputFeatures();
            this._activateMapInteraction(this.getMap());
        };
        ReverseGeocode.prototype.onReverseGeocodingSubmit = function () {
            if (!this._requestPosition) {
                return;
            }
            if (this._noRightManagement) {
                return;
            }
            this._reverseGeocodingRequest();
        };
        ReverseGeocode.prototype.onReverseGeocodingResultClick = function (e) {
        };
        ReverseGeocode.prototype.onReverseGeocodingResultMouseOver = function (e) {
            var tagid = e.target.id;
            var idx = tagid.substring(tagid.indexOf('_') + 1);
            if (e.target.classList) {
                e.target.classList.add('GPreverseGeocodedLocationHighlight');
            }
            if (!this._resultsFeaturesSource) {
                return;
            }
            var f = this._resultsFeaturesSource.getFeatureById(parseInt(idx, 10));
            f.setStyle(this._resultsSelectedStyle);
        };
        ReverseGeocode.prototype.onReverseGeocodingResultMouseOut = function (e) {
            var tagid = e.target.id;
            var idx = tagid.substring(tagid.indexOf('_') + 1);
            if (e.target.classList) {
                e.target.classList.remove('GPreverseGeocodedLocationHighlight');
            }
            if (!this._resultsFeaturesSource) {
                return;
            }
            var f = this._resultsFeaturesSource.getFeatureById(parseInt(idx, 10));
            f.setStyle(this._resultsDefaultStyle);
        };
        ReverseGeocode.prototype._clearResults = function () {
            var map = this.getMap();
            this._reverseGeocodingLocations = [];
            if (this._resultsListContainer) {
                while (this._resultsListContainer.firstChild) {
                    this._resultsListContainer.removeChild(this._resultsListContainer.firstChild);
                }
            }
            if (this._resultsFeaturesLayer) {
                map.removeLayer(this._resultsFeaturesLayer);
                this._resultsFeaturesLayer = null;
            }
            if (this._popupOverlay != null) {
                map.removeOverlay(this._popupOverlay);
                this._popupOverlay = null;
            }
            if (this._resultsSelectInteraction != null) {
                map.removeInteraction(this._resultsSelectInteraction);
                this._resultsSelectInteraction = null;
            }
            if (this._resultsHoverInteraction != null) {
                map.removeInteraction(this._resultsHoverInteraction);
                this._resultsHoverInteraction = null;
            }
        };
        ReverseGeocode.prototype._clearInputFeatures = function () {
            if (this._inputFeatures) {
                this._inputFeatures.clear();
            }
            this._requestPosition = null;
            this._requestCircleFilter = null;
            this._requestBboxFilter = null;
        };
        ReverseGeocode.prototype._displayWaitingContainer = function () {
            this._waitingContainer.className = 'GProuteCalcWaitingContainerVisible';
            this._waiting = true;
            if (this._timer) {
                clearTimeout(this._timer);
                this._timer = null;
            }
            var context = this;
            this._timer = setTimeout(function () {
                if (context._waiting === true) {
                    context._hideWaitingContainer();
                } else {
                    if (context._timer) {
                        clearTimeout(context._timer);
                    }
                }
            }, 16000);
        };
        ReverseGeocode.prototype._hideWaitingContainer = function () {
            if (this._waiting) {
                this._waitingContainer.className = 'GProuteCalcWaitingContainerHidden';
                this._waiting = false;
                clearTimeout(this._timer);
                this._timer = null;
            }
        };
        return ReverseGeocode;
    }({}, ol, gp, CommonUtils, Ol3ControlsUtilsMarkers, Ol3ControlsLayerSwitcher, CommonUtilsCheckRightManagement, CommonUtilsSelectorID, CommonControlsReverseGeocodingDOM);
    CommonControlsLayerImportDOM = function () {
        var LayerImportDOM = {
            _addUID: function (id) {
                var uid = this._uid ? id + '-' + this._uid : id;
                return uid;
            },
            _createMainContainerElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GPimport');
                container.className = 'GPwidget';
                return container;
            },
            _createShowImportElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPshowImport');
                input.type = 'checkbox';
                return input;
            },
            _createShowImportPictoElement: function () {
                var self = this;
                var label = document.createElement('label');
                label.id = this._addUID('GPshowImportPicto');
                label.className = 'GPshowAdvancedToolPicto';
                label.htmlFor = this._addUID('GPshowImport');
                label.title = 'Ouvrir l\'import de couches';
                if (label.addEventListener) {
                    label.addEventListener('click', function () {
                        self._onShowImportClick();
                    });
                } else if (label.attachEvent) {
                    label.attachEvent('onclick', function () {
                        self._onShowImportClick();
                    });
                }
                var spanOpen = document.createElement('span');
                spanOpen.id = this._addUID('GPshowImportOpen');
                spanOpen.className = 'GPshowAdvancedToolOpen';
                label.appendChild(spanOpen);
                return label;
            },
            _createImportPanelElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPimportPanel');
                div.className = 'GPpanel';
                return div;
            },
            _createImportPanelHeaderElement: function () {
                var container = document.createElement('div');
                container.className = 'GPpanelHeader';
                var panelTitle = this._createImportPanelTitleElement();
                container.appendChild(panelTitle);
                var closeDiv = this._createImportPanelCloseElement();
                container.appendChild(closeDiv);
                return container;
            },
            _createImportPanelTitleElement: function () {
                var div = document.createElement('div');
                div.className = 'GPpanelTitle';
                div.innerHTML = 'Import de données';
                return div;
            },
            _createImportPanelCloseElement: function () {
                var self = this;
                var divClose = document.createElement('div');
                divClose.id = this._addUID('GPimportPanelClose');
                divClose.className = 'GPpanelClose';
                divClose.title = 'Fermer le panneau';
                if (divClose.addEventListener) {
                    divClose.addEventListener('click', function () {
                        document.getElementById(self._addUID('GPshowImportPicto')).click();
                    }, false);
                } else if (divClose.attachEvent) {
                    divClose.attachEvent('onclick', function () {
                        document.getElementById(self._addUID('GPshowImportPicto')).click();
                    });
                }
                return divClose;
            },
            _createImportPanelFormElement: function () {
                var self = this;
                var form = document.createElement('form');
                form.id = this._addUID('GPimportForm');
                form.className = 'map-tool-box';
                if (form.addEventListener) {
                    form.addEventListener('submit', function (e) {
                        e.preventDefault();
                        self._onImportSubmit();
                    });
                } else if (form.attachEvent) {
                    form.attachEvent('onsubmit', function (e) {
                        e.preventDefault();
                        self._onImportSubmit();
                    });
                }
                return form;
            },
            _createImportTypeLineElement: function (importTypes) {
                var context = this;
                var div = document.createElement('div');
                div.id = this._addUID('GPimportTypeLine');
                div.className = 'GPimportInputLine';
                var label = document.createElement('label');
                label.htmlFor = this._addUID('GPimportType');
                label.className = 'GPimportLabel';
                label.innerHTML = 'Type de donnée';
                label.title = 'Type de donnée';
                div.appendChild(label);
                var select = document.createElement('select');
                select.className = 'GPimportSelect';
                if (select.addEventListener) {
                    select.addEventListener('change', function (e) {
                        if (this.value === 'KML' || this.value === 'GPX' || this.value === 'GeoJSON') {
                            document.getElementById(context._addUID('GPimportStaticParams')).className = 'GPimportVisibleParams';
                            document.getElementById(context._addUID('GPimportServiceParams')).className = 'GPimportHiddenParams';
                        } else if (this.value === 'WMS' || this.value === 'WMTS' || this.value === 'WFS') {
                            document.getElementById(context._addUID('GPimportServiceParams')).className = 'GPimportVisibleParams';
                            document.getElementById(context._addUID('GPimportStaticParams')).className = 'GPimportHiddenParams';
                        }
                        context._onImportTypeChange(e);
                    });
                } else if (select.attachEvent) {
                    select.attachEvent('onchange', function () {
                        if (this.value === 'KML' || this.value === 'GPX' || this.value === 'GeoJSON') {
                            document.getElementById(context._addUID('GPimportStaticParams')).className = 'GPimportVisibleParams';
                            document.getElementById(context._addUID('GPimportServiceParams')).className = 'GPimportHiddenParams';
                        } else if (this.value === 'WMS' || this.value === 'WMTS' || this.value === 'WFS') {
                            document.getElementById(context._addUID('GPimportServiceParams')).className = 'GPimportVisibleParams';
                            document.getElementById(context._addUID('GPimportStaticParams')).className = 'GPimportHiddenParams';
                        }
                        context._onImportTypeChange();
                    });
                }
                select.id = this._addUID('GPimportType');
                if (!importTypes || !Array.isArray(importTypes)) {
                    importTypes = [
                        'KML',
                        'GPX',
                        'GeoJSON',
                        'WMS',
                        'WMTS',
                        'WFS'
                    ];
                }
                var option;
                for (var i = 0; i < importTypes.length; i++) {
                    option = document.createElement('option');
                    option.value = importTypes[i];
                    option.text = importTypes[i];
                    select.appendChild(option);
                }
                div.appendChild(select);
                return div;
            },
            _createImportWaitingElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPimportWaitingContainer');
                div.className = 'GPimportWaitingContainerHidden';
                var p = document.createElement('p');
                p.className = 'GPimportWaiting';
                p.innerHTML = 'Recherche en cours...';
                div.appendChild(p);
                return div;
            },
            _createImportStaticParamsContainer: function (currentType) {
                var div = document.createElement('div');
                div.id = this._addUID('GPimportStaticParams');
                if (currentType === 'KML' || currentType === 'GPX' || currentType === 'GeoJSON') {
                    div.className = 'GPimportVisibleParams';
                } else {
                    div.className = 'GPimportHiddenParams';
                }
                return div;
            },
            _createStaticNameLabel: function () {
                var div = document.createElement('div');
                div.className = 'GPimportInputLine';
                var label = document.createElement('label');
                label.className = 'GPimportLabel';
                label.htmlFor = this._addUID('GPimportName');
                label.innerHTML = 'Nom';
                label.title = 'Nom';
                div.appendChild(label);
                var input = document.createElement('input');
                input.type = 'text';
                input.id = this._addUID('GPimportName');
                input.className = 'GPimportInput';
                div.appendChild(input);
                return div;
            },
            _createStaticModeChoiceDiv: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPimportChoice');
                return div;
            },
            _createStaticLocalChoiceDiv: function () {
                var context = this;
                var div = document.createElement('div');
                div.className = 'GPimportChoiceAlt';
                var input = document.createElement('input');
                input.type = 'radio';
                if (input.addEventListener) {
                    input.addEventListener('change', function (e) {
                        document.getElementById(context._addUID('GPimportValueLocal')).className = 'GPimportInputLine';
                        document.getElementById(context._addUID('GPimportValueUrl')).className = 'GPimportValueHidden';
                        context._onStaticImportTypeChange(e);
                    });
                } else if (input.appendChild) {
                    input.appendChild('onchange', function () {
                        document.getElementById(context._addUID('GPimportValueLocal')).className = 'GPimportInputLine';
                        document.getElementById(context._addUID('GPimportValueUrl')).className = 'GPimportValueHidden';
                        context._onStaticImportTypeChange();
                    });
                }
                input.name = 'GPimportChoiceMode';
                input.value = 'local';
                input.checked = true;
                input.id = this._addUID('GPimportChoiceAltLocal');
                div.appendChild(input);
                var label = document.createElement('label');
                label.className = 'GPimportChoiceAltTxt';
                label.htmlFor = this._addUID('GPimportChoiceAltLocal');
                label.innerHTML = 'par fichier local';
                label.title = 'par fichier local';
                div.appendChild(label);
                return div;
            },
            _createStaticUrlChoiceDiv: function () {
                var context = this;
                var div = document.createElement('div');
                div.className = 'GPimportChoiceAlt';
                var input = document.createElement('input');
                input.type = 'radio';
                if (input.addEventListener) {
                    input.addEventListener('change', function (e) {
                        document.getElementById(context._addUID('GPimportValueUrl')).className = 'GPimportInputLine';
                        document.getElementById(context._addUID('GPimportValueLocal')).className = 'GPimportValueHidden';
                        context._onStaticImportTypeChange(e);
                    });
                } else if (input.appendChild) {
                    input.appendChild('onchange', function () {
                        document.getElementById(context._addUID('GPimportValueUrl')).className = 'GPimportInputLine';
                        document.getElementById(context._addUID('GPimportValueLocal')).className = 'GPimportValueHidden';
                        context._onStaticImportTypeChange();
                    });
                }
                input.id = this._addUID('GPimportChoiceAltUrl');
                input.name = 'GPimportChoiceMode';
                input.value = 'url';
                input.checked = false;
                div.appendChild(input);
                var label = document.createElement('label');
                label.className = 'GPimportChoiceAltTxt';
                label.htmlFor = this._addUID('GPimportChoiceAltUrl');
                label.innerHTML = 'par URL';
                label.title = 'par URL';
                div.appendChild(label);
                return div;
            },
            _createStaticLocalInputDiv: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPimportValueLocal');
                div.className = 'GPimportInputLine';
                return div;
            },
            _createStaticLocalInputLabel: function () {
                var label = document.createElement('label');
                label.className = 'GPimportLabel';
                label.htmlFor = this._addUID('GPimportFile');
                label.innerHTML = 'Fichier local';
                label.title = 'Fichier local';
                return label;
            },
            _createStaticLocalInput: function () {
                var input = document.createElement('input');
                input.type = 'file';
                input.id = this._addUID('GPimportFile');
                input.className = 'GPimportInputFile';
                return input;
            },
            _createStaticUrlInputDiv: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPimportValueUrl');
                div.className = 'GPimportValueHidden';
                return div;
            },
            _createStaticUrlInputLabel: function () {
                var label = document.createElement('label');
                label.className = 'GPimportLabel';
                label.htmlFor = this._addUID('GPimportUrl');
                label.innerHTML = 'URL';
                label.title = 'URL';
                return label;
            },
            _createStaticUrlInput: function () {
                var input = document.createElement('input');
                input.type = 'text';
                input.id = this._addUID('GPimportUrl');
                input.className = 'GPimportInput';
                return input;
            },
            _createServiceParamsContainer: function (currentType) {
                var div = document.createElement('div');
                div.id = this._addUID('GPimportServiceParams');
                if (currentType === 'WMS' || currentType === 'WMTS' || currentType === 'WFS') {
                    div.className = 'GPimportVisibleParams';
                } else {
                    div.className = 'GPimportHiddenParams';
                }
                return div;
            },
            _createServiceUrlDiv: function () {
                var div = document.createElement('div');
                div.className = 'GPimportInputLine';
                return div;
            },
            _createServiceUrlInputLabel: function () {
                var label = document.createElement('label');
                label.className = 'GPimportLabel';
                label.htmlFor = this._addUID('GPimportServiceUrl');
                label.innerHTML = 'URL du service';
                label.title = 'URL du service';
                return label;
            },
            _createServiceUrlInput: function () {
                var input = document.createElement('input');
                input.type = 'text';
                input.id = this._addUID('GPimportServiceUrl');
                input.className = 'GPimportInput';
                return input;
            },
            _createImportSubmitFormElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPimportSubmit');
                input.className = 'GPinputSubmit tool-form-submit';
                input.type = 'submit';
                input.value = 'Importer';
                return input;
            },
            _createImportGetCapPanelElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPimportGetCapPanel');
                div.className = 'GPpanel';
                return div;
            },
            _createImportGetCapPanelHeaderElement: function () {
                var context = this;
                var container = document.createElement('div');
                container.className = 'GPpanelHeader';
                var panelTitle = document.createElement('div');
                panelTitle.className = 'GPpanelTitle';
                panelTitle.innerHTML = 'Couches accessibles';
                panelTitle.title = 'Couches accessibles';
                container.appendChild(panelTitle);
                var closeDiv = document.createElement('div');
                if (closeDiv.addEventListener) {
                    closeDiv.addEventListener('click', function () {
                        document.getElementById(context._addUID('GPimportGetCapPanel')).style.display = 'none';
                        document.getElementById(context._addUID('GPimportPanel')).style.display = '';
                        context._onGetCapPanelClose();
                    });
                } else if (closeDiv.attachEvent) {
                    closeDiv.attachEvent('click', function () {
                        document.getElementById(context._addUID('GPimportGetCapPanel')).style.display = 'none';
                        document.getElementById(context._addUID('GPimportPanel')).style.display = '';
                        context._onGetCapPanelClose();
                    });
                }
                closeDiv.className = 'GPpanelClose';
                closeDiv.title = 'Fermer le panneau';
                closeDiv.id = this._addUID('GPimportGetCapPanelClose');
                container.appendChild(closeDiv);
                return container;
            },
            _createImportGetCapResultsListElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GPimportGetCapResults');
                return container;
            },
            _createImportGetCapResultElement: function (layerDescription, id) {
                var div = document.createElement('div');
                div.className = 'GPimportGetCapProposal';
                div.innerHTML = layerDescription;
                div.title = layerDescription;
                var context = this;
                if (div.addEventListener) {
                    div.addEventListener('click', function (e) {
                        context._onGetCapResponseLayerClick(e);
                    });
                } else if (div.attachEvent) {
                    div.attachEvent('onclick', function () {
                        context._onGetCapResponseLayerClick();
                    });
                }
                div.id = 'GPimportGetCapProposal_' + id;
                return div;
            }
        };
        return LayerImportDOM;
    }();
    Ol3ControlsLayerImport = function (ol, Gp, woodman, Utils, Markers, LayerImportDOM, SelectorID, ProxyUtils, KMLExtended) {
        function LayerImport(options) {
            options = options || {};
            if (!(this instanceof LayerImport)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            this._initialize(options);
            var container = this._initContainer(options);
            ol.control.Control.call(this, {
                element: container,
                target: options.target,
                render: options.render
            });
        }
        ol.inherits(LayerImport, ol.control.Control);
        LayerImport.DefaultStyles = {
            image: new ol.style.Icon({
                src: Markers['lightOrange'],
                anchor: [
                    25.5,
                    38
                ],
                anchorOrigin: 'top-left',
                anchorXUnits: 'pixels',
                anchorYUnits: 'pixels'
            }),
            stroke: new ol.style.Stroke({
                color: 'rgba(0,42,80,0.8)',
                width: 4
            }),
            fill: new ol.style.Fill({ color: 'rgba(0, 183, 152, 0.5)' }),
            text: new ol.style.Text({
                font: '16px Sans',
                textAlign: 'left',
                fill: new ol.style.Fill({ color: 'rgba(255, 255, 255, 1)' }),
                stroke: new ol.style.Stroke({
                    color: 'rgba(0, 0, 0, 1)',
                    width: 2
                })
            })
        };
        LayerImport.prototype = Object.create(ol.control.Control.prototype, {});
        Utils.assign(LayerImport.prototype, LayerImportDOM);
        LayerImport.prototype.constructor = LayerImport;
        LayerImport.prototype.getCollapsed = function () {
            return this.collapsed;
        };
        LayerImport.prototype.setCollapsed = function (collapsed) {
            if (collapsed === undefined) {
                console.log('[ERROR] LayerImport:setCollapsed - missing collapsed parameter');
                return;
            }
            if (collapsed && this.collapsed || !collapsed && !this.collapsed) {
                return;
            }
            if (collapsed) {
                document.getElementById('GPimportPanelClose-' + this._uid).click();
            } else {
                document.getElementById('GPshowImport-' + this._uid).click();
            }
            this.collapsed = collapsed;
        };
        LayerImport.prototype.getStaticImportContent = function () {
            return this.contentStatic;
        };
        LayerImport.prototype.getServiceImportContent = function () {
            return this.contentService;
        };
        LayerImport.prototype._initialize = function (options) {
            this._checkInputOptions(options);
            this.options = {
                collapsed: true,
                layerTypes: [
                    'KML',
                    'GPX',
                    'GeoJSON',
                    'WMS',
                    'WMTS'
                ],
                webServicesOptions: {},
                vectorStyleOptions: {
                    KML: {
                        extractStyles: true,
                        showPointNames: true,
                        defaultStyle: {}
                    },
                    GPX: { defaultStyle: {} },
                    GeoJSON: { defaultStyle: {} }
                }
            };
            if (options.vectorStyleOptions && options.vectorStyleOptions.KML && options.vectorStyleOptions.KML.extractStyles) {
                this.options.vectorStyleOptions.KML.extractStyles = options.vectorStyleOptions.KML.extractStyles;
            }
            if (options.vectorStyleOptions && options.vectorStyleOptions.KML && options.vectorStyleOptions.KML.showPointNames) {
                this.options.vectorStyleOptions.KML.showPointNames = options.vectorStyleOptions.KML.showPointNames;
            }
            if (options.vectorStyleOptions && options.vectorStyleOptions.KML && options.vectorStyleOptions.KML.defaultStyle) {
                this.options.vectorStyleOptions.KML.defaultStyle = options.vectorStyleOptions.KML.defaultStyle;
            } else {
                this.options.vectorStyleOptions.KML.defaultStyle = new ol.style.Style({
                    image: LayerImport.DefaultStyles.image,
                    stroke: LayerImport.DefaultStyles.stroke,
                    fill: LayerImport.DefaultStyles.fill,
                    text: LayerImport.DefaultStyles.text
                });
            }
            if (options.vectorStyleOptions && options.vectorStyleOptions.GPX && options.vectorStyleOptions.GPX.defaultStyle) {
                this.options.vectorStyleOptions.GPX.defaultStyle = options.vectorStyleOptions.GPX.defaultStyle;
            } else {
                this.options.vectorStyleOptions.GPX.defaultStyle = new ol.style.Style({
                    image: LayerImport.DefaultStyles.image,
                    stroke: LayerImport.DefaultStyles.stroke,
                    fill: LayerImport.DefaultStyles.fill
                });
            }
            if (options.vectorStyleOptions && options.vectorStyleOptions.GeoJSON && options.vectorStyleOptions.GeoJSON.defaultStyle) {
                this.options.vectorStyleOptions.GeoJSON.defaultStyle = options.vectorStyleOptions.GeoJSON.defaultStyle;
            } else {
                this.options.vectorStyleOptions.GeoJSON.defaultStyle = new ol.style.Style({
                    image: LayerImport.DefaultStyles.image,
                    stroke: LayerImport.DefaultStyles.stroke,
                    fill: LayerImport.DefaultStyles.fill
                });
            }
            if (Array.isArray(options.layerTypes)) {
                var layerTypes = [];
                for (var i = 0; i < options.layerTypes.length; i++) {
                    layerTypes.push(options.layerTypes[i]);
                }
                this.options.layerTypes = layerTypes;
            }
            Utils.mergeParams(this.options, options);
            this.collapsed = this.options.collapsed;
            this._uid = SelectorID.generate();
            this._waiting = false;
            this._timer = null;
            this._initImportTypes();
            this._initDefaultStyles();
            this._showImportInput = null;
            this._importPanel = null;
            this._formContainer = null;
            this._staticLocalImportInput = null;
            this._staticUrlImportInput = null;
            this._serviceUrlImportInput = null;
            this._getCapPanel = null;
            this._getCapResultsListContainer = null;
            this._waitingContainer = null;
            this._getCapRequestUrl = null;
            this._getCapResponseWMS = null;
            this._getCapResponseWMSLayers = [];
            this._getCapResponseWMTS = null;
            this._getCapResponseWMTSLayers = [];
        };
        LayerImport.prototype._checkInputOptions = function (options) {
            if (options.layerTypes) {
                var layerTypes = options.layerTypes;
                if (!Array.isArray(layerTypes)) {
                    console.log('[ol.control.LayerImport] \'options.layerTypes\' parameter should be an array. Set default values ["KML", "GPX", "GeoJSON", "WMS", "WMTS"]');
                    options.layerTypes = [
                        'KML',
                        'GPX',
                        'GeoJSON',
                        'WMS',
                        'WMTS'
                    ];
                } else {
                    var typesList = [
                        'KML',
                        'GPX',
                        'GEOJSON',
                        'WMS',
                        'WMTS',
                        'WFS'
                    ];
                    var wrongTypesIndexes = [];
                    for (var i = 0; i < layerTypes.length; i++) {
                        if (typeof layerTypes[i] !== 'string') {
                            wrongTypesIndexes.push(i);
                            console.log('[ol.control.LayerImport] \'options.layerTypes\' elements should be of type string (' + layerTypes[i] + ')');
                        } else {
                            layerTypes[i] = layerTypes[i].toUpperCase();
                            if (typesList.indexOf(layerTypes[i]) === -1) {
                                wrongTypesIndexes.push(i);
                                console.log('[ol.control.LayerImport] options.layerTypes : ' + layerTypes[i] + ' is not a supported type');
                            }
                            if (layerTypes[i] === 'GEOJSON') {
                                layerTypes[i] = 'GeoJSON';
                            }
                        }
                    }
                    if (wrongTypesIndexes.length !== 0) {
                        for (var j = wrongTypesIndexes.length - 1; j >= 0; j--) {
                            layerTypes.splice(wrongTypesIndexes[j], 1);
                        }
                    }
                }
            }
        };
        LayerImport.prototype._initDefaultStyles = function () {
            var kmlDefaultStyles = this.options.vectorStyleOptions.KML.defaultStyle;
            this._defaultKMLStyle = new ol.style.Style({
                image: kmlDefaultStyles.image,
                stroke: kmlDefaultStyles.stroke,
                fill: kmlDefaultStyles.fill,
                text: kmlDefaultStyles.text
            });
            var gpxDefaultStyles = this.options.vectorStyleOptions.GPX.defaultStyle;
            this._defaultGPXStyle = new ol.style.Style({
                image: gpxDefaultStyles.image,
                stroke: gpxDefaultStyles.stroke,
                fill: gpxDefaultStyles.fill
            });
            var geoJSONDefaultStyles = this.options.vectorStyleOptions.GeoJSON.defaultStyle;
            this._defaultGeoJSONStyle = new ol.style.Style({
                image: geoJSONDefaultStyles.image,
                stroke: geoJSONDefaultStyles.stroke,
                fill: geoJSONDefaultStyles.fill
            });
        };
        LayerImport.prototype._initImportTypes = function () {
            this._currentImportType = this.options.layerTypes[0] || 'KML';
            if (this._currentImportType === 'KML' || this._currentImportType === 'GPX' || this._currentImportType === 'GeoJSON') {
                this._isCurrentImportTypeStatic = true;
            } else if (this._currentImportType === 'WMS' || this._currentImportType === 'WMTS' || this._currentImportType === 'WFS') {
                this._isCurrentImportTypeStatic = false;
            }
            this._currentStaticImportType = 'local';
        };
        LayerImport.prototype._initContainer = function () {
            var container = this._createMainContainerElement();
            var inputShow = this._showImportInput = this._createShowImportElement();
            container.appendChild(inputShow);
            if (!this.collapsed) {
                inputShow.checked = true;
            }
            var picto = this._createShowImportPictoElement();
            container.appendChild(picto);
            var importPanel = this._importPanel = this._createImportPanelElement();
            var panelHeader = this._createImportPanelHeaderElement();
            importPanel.appendChild(panelHeader);
            var importForm = this._formContainer = this._initInputFormElement();
            importPanel.appendChild(importForm);
            container.appendChild(importPanel);
            var getCapPanel = this._getCapPanel = this._createImportGetCapPanelElement();
            getCapPanel.appendChild(this._createImportGetCapPanelHeaderElement());
            var importGetCapResultsList = this._getCapResultsListContainer = this._createImportGetCapResultsListElement();
            getCapPanel.appendChild(importGetCapResultsList);
            container.appendChild(getCapPanel);
            var waiting = this._waitingContainer = this._createImportWaitingElement();
            container.appendChild(waiting);
            return container;
        };
        LayerImport.prototype._initInputFormElement = function () {
            var importForm = this._createImportPanelFormElement();
            var importTypeChoiceDiv = this._createImportTypeLineElement(this.options.layerTypes);
            importForm.appendChild(importTypeChoiceDiv);
            var importStaticParamsContainer = this._createImportStaticParamsContainer(this.options.layerTypes[0]);
            var staticNameLabel = this._createStaticNameLabel();
            importStaticParamsContainer.appendChild(staticNameLabel);
            var staticImportChoice = this._createStaticModeChoiceDiv();
            var staticLocalImportChoice = this._createStaticLocalChoiceDiv();
            staticImportChoice.appendChild(staticLocalImportChoice);
            var staticUrlImportChoice = this._createStaticUrlChoiceDiv();
            staticImportChoice.appendChild(staticUrlImportChoice);
            importStaticParamsContainer.appendChild(staticImportChoice);
            var staticLocalInputDiv = this._createStaticLocalInputDiv();
            staticLocalInputDiv.appendChild(this._createStaticLocalInputLabel());
            this._staticLocalImportInput = this._createStaticLocalInput();
            staticLocalInputDiv.appendChild(this._staticLocalImportInput);
            importStaticParamsContainer.appendChild(staticLocalInputDiv);
            var staticUrlInputDiv = this._createStaticUrlInputDiv();
            staticUrlInputDiv.appendChild(this._createStaticUrlInputLabel());
            this._staticUrlImportInput = this._createStaticUrlInput();
            staticUrlInputDiv.appendChild(this._staticUrlImportInput);
            importStaticParamsContainer.appendChild(staticUrlInputDiv);
            importForm.appendChild(importStaticParamsContainer);
            var importServiceParamsContainer = this._createServiceParamsContainer(this.options.layerTypes[0]);
            var importServiceUrlDiv = this._createServiceUrlDiv();
            importServiceUrlDiv.appendChild(this._createServiceUrlInputLabel());
            this._serviceUrlImportInput = this._createServiceUrlInput();
            importServiceUrlDiv.appendChild(this._serviceUrlImportInput);
            importServiceParamsContainer.appendChild(importServiceUrlDiv);
            importForm.appendChild(importServiceParamsContainer);
            var submit = this._createImportSubmitFormElement();
            importForm.appendChild(submit);
            return importForm;
        };
        LayerImport.prototype._onShowImportClick = function () {
            this.collapsed = this._showImportInput.checked;
            this.dispatchEvent('change:collapsed');
        };
        LayerImport.prototype._onImportTypeChange = function (e) {
            this._currentImportType = e.target.value;
            if (this._currentImportType === 'KML' || this._currentImportType === 'GPX' || this._currentImportType === 'GeoJSON') {
                this._isCurrentImportTypeStatic = true;
            } else if (this._currentImportType === 'WMS' || this._currentImportType === 'WMTS' || this._currentImportType === 'WFS') {
                this._isCurrentImportTypeStatic = false;
            }
        };
        LayerImport.prototype._onStaticImportTypeChange = function (e) {
            this._currentStaticImportType = e.target.value;
        };
        LayerImport.prototype._onGetCapPanelClose = function () {
            this._clearGetCapParams();
            this._emptyGetCapResultsList();
        };
        LayerImport.prototype._onImportSubmit = function () {
            this.contentStatic = null;
            this.contentService = null;
            if (this._isCurrentImportTypeStatic) {
                this._importStaticLayer();
            } else {
                this._importServiceLayers();
            }
        };
        LayerImport.prototype._importStaticLayer = function () {
            var layerName;
            var staticImportNameInput = document.getElementById(this._addUID('GPimportName'));
            if (staticImportNameInput) {
                layerName = staticImportNameInput.value;
            }
            if (this._currentStaticImportType === 'local') {
                this._importStaticLayerFromLocalFile(layerName);
            } else if (this._currentStaticImportType === 'url') {
                this._importStaticLayerFromUrl(layerName);
            }
        };
        LayerImport.prototype._importStaticLayerFromUrl = function (layerName) {
            layerName = layerName || '';
            var url = this._staticUrlImportInput.value;
            if (url.length === 0) {
                console.log('[ol.control.LayerImport] url parameter is mandatory');
                return;
            }
            if (url.trim) {
                url = url.trim();
            }
            if (!this.options.webServicesOptions || !this.options.webServicesOptions.proxyUrl && !this.options.webServicesOptions.noProxyDomains) {
                console.log('[ol.control.LayerImport] options.webServicesOptions.proxyUrl parameter is mandatory to request resources on another domain (cross-domain)');
                return;
            }
            url = ProxyUtils.proxifyUrl(url, this.options.webServicesOptions);
            var context = this;
            Gp.Protocols.XHR.call({
                url: url,
                method: 'GET',
                timeOut: 15000,
                onResponse: function (response) {
                    context._hideWaitingContainer();
                    context._addFeaturesFromImportStaticLayer(response, layerName);
                },
                onFailure: function (error) {
                    context._hideWaitingContainer();
                    console.log('[ol.control.LayerImport] KML/GPX/GeoJSON request failed : ', error);
                }
            });
        };
        LayerImport.prototype._importStaticLayerFromLocalFile = function (layerName) {
            var file = this._staticLocalImportInput.files[0];
            if (!file) {
                console.log('[ol.control.LayerImport] missing file');
                return;
            }
            var fReader = new FileReader();
            var context = this;
            fReader.onerror = function (e) {
                context._hideWaitingContainer();
            };
            fReader.onprogress = function () {
            };
            fReader.onloadstart = function () {
                context._displayWaitingContainer();
            };
            fReader.onabort = function () {
                context._hideWaitingContainer();
            };
            fReader.onloadend = function (e) {
            };
            fReader.onload = function (e) {
                context._hideWaitingContainer();
                context._addFeaturesFromImportStaticLayer(e.target.result, layerName);
            };
            fReader.readAsText(file);
        };
        LayerImport.prototype._addFeaturesFromImportStaticLayer = function (fileContent, layerName) {
            var map = this.getMap();
            if (!map || !fileContent) {
                return;
            }
            this.contentStatic = fileContent;
            var format;
            var vectorStyle;
            if (this._currentImportType === 'KML') {
                format = new KMLExtended({
                    showPointNames: this.options.vectorStyleOptions.KML.showPointNames,
                    extractStyles: this.options.vectorStyleOptions.KML.extractStyles,
                    defaultStyle: [this.options.vectorStyleOptions.KML.defaultStyle]
                });
                vectorStyle = this.options.vectorStyleOptions.KML.defaultStyle;
            } else if (this._currentImportType === 'GPX') {
                format = new ol.format.GPX();
                vectorStyle = this.options.vectorStyleOptions.GPX.defaultStyle;
            } else if (this._currentImportType === 'GeoJSON') {
                format = new ol.format.GeoJSON();
                vectorStyle = this.options.vectorStyleOptions.GeoJSON.defaultStyle;
            }
            var fileProj = format.readProjection(fileContent);
            var mapProj = this._getMapProjectionCode();
            var features = null;
            features = format.readFeatures(fileContent, {
                dataProjection: fileProj,
                featureProjection: mapProj
            });
            var vectorSource = new ol.source.Vector({ features: new ol.Collection() });
            vectorSource.addFeatures(features);
            if (layerName) {
                vectorSource._title = vectorSource._description = layerName;
            } else {
                if (format.readName && format.readName(fileContent)) {
                    vectorSource._title = vectorSource._description = format.readName(fileContent);
                } else {
                    vectorSource._title = vectorSource._description = 'Import ' + this._currentImportType;
                }
            }
            var vectorLayer = new ol.layer.Vector({
                source: vectorSource,
                style: vectorStyle
            });
            vectorLayer.gpResultLayerId = 'layerimport:' + this._currentImportType;
            map.addLayer(vectorLayer);
            if (map.getView() && map.getSize() && vectorSource.getExtent) {
                var sourceExtent = vectorSource.getExtent();
                if (sourceExtent && sourceExtent[0] !== Infinity) {
                    map.getView().fit(vectorSource.getExtent(), map.getSize());
                }
            }
        };
        LayerImport.prototype._addFeaturesFromImportStaticLayerUrl = function (url, layerName) {
            var map = this.getMap();
            if (!map || !url) {
                return;
            }
            var format;
            if (this._currentImportType === 'KML') {
                format = new KMLExtended({
                    showPointNames: true,
                    extractStyles: this.options.vectorStyleOptions.KML.extractStyles,
                    defaultStyle: [this.options.vectorStyleOptions.KML.defaultStyle]
                });
            } else if (this._currentImportType === 'GPX') {
                format = new ol.format.GPX();
            } else if (this._currentImportType === 'GeoJSON') {
                format = new ol.format.GeoJSON();
            }
            var vectorSource = new ol.source.Vector({
                url: url,
                format: format
            });
            if (this._currentImportType === 'GPX') {
                vectorSource.forEachFeature(function (feature) {
                    if (feature.getStyle() == null) {
                        feature.setStyle(this.options.vectorStyleOptions.GPX.defaultStyle);
                    }
                });
            }
            if (this._currentImportType === 'GeoJSON') {
                vectorSource.forEachFeature(function (feature) {
                    if (feature.getStyle() == null) {
                        feature.setStyle(this.options.vectorStyleOptions.GeoJSON.defaultStyle);
                    }
                });
            }
            if (layerName) {
                vectorSource._title = vectorSource._description = layerName;
            } else {
                vectorSource._title = vectorSource._description = 'Import ' + this._currentImportType;
            }
            var vectorLayer = new ol.layer.Vector({ source: vectorSource });
            vectorLayer.gpResultLayerId = 'layerimport:' + this._currentImportType;
            map.addLayer(vectorLayer);
            if (map.getView() && map.getSize() && vectorSource.getExtent) {
                var sourceExtent = vectorSource.getExtent();
                if (sourceExtent && sourceExtent[0] !== Infinity) {
                    map.getView().fit(vectorSource.getExtent(), map.getSize());
                }
            }
        };
        LayerImport.prototype._importServiceLayers = function () {
            if (this._currentImportType === 'WFS') {
                console.log('[ol.control.LayerImport] WFS layer import is not implemented yet');
                return;
            }
            this._emptyGetCapResultsList();
            var url = this._getCapRequestUrl = this._serviceUrlImportInput.value;
            if (!url) {
                console.log('[ol.control.LayerImport] url parameter is mandatory');
                return;
            }
            if (url.trim) {
                url = url.trim();
            }
            var questionMarkIndex = url.indexOf('?');
            if (questionMarkIndex < 0) {
                url += '?SERVICE=' + this._currentImportType + '&REQUEST=GetCapabilities';
            } else if (questionMarkIndex === url.length - 1) {
                url += 'SERVICE=' + this._currentImportType + '&REQUEST=GetCapabilities';
            }
            if (!this.options.webServicesOptions || !this.options.webServicesOptions.proxyUrl && !this.options.webServicesOptions.noProxyDomains) {
                console.log('[ol.control.LayerImport] options.webServicesOptions.proxyUrl parameter is mandatory to request web service layers (getcapabilities request)');
                return;
            }
            var proxyUrl = this.options.webServicesOptions.proxyUrl;
            var noProxyDomains = this.options.webServicesOptions.noProxyDomains;
            var bfound = false;
            if (noProxyDomains && Array.isArray(noProxyDomains) && noProxyDomains.length > 0) {
                for (var i in noProxyDomains) {
                    if (url.indexOf(noProxyDomains[i]) !== -1) {
                        bfound = true;
                    }
                }
            }
            if (bfound === false) {
                url = proxyUrl + encodeURIComponent(url);
            }
            this._displayWaitingContainer();
            var context = this;
            Gp.Protocols.XHR.call({
                url: url,
                method: 'GET',
                timeOut: 15000,
                onResponse: function (response) {
                    context._hideWaitingContainer();
                    context._displayGetCapResponseLayers.call(context, response);
                },
                onFailure: function (error) {
                    context._hideWaitingContainer();
                    console.log('[ol.control.LayerImport] getCapabilities request failed : ', error);
                }
            });
        };
        LayerImport.prototype._displayGetCapResponseLayers = function (xmlResponse) {
            var parser;
            var layers;
            var layerDescription;
            var projection;
            this._getCapResponseWMSLayers = [];
            this.contentService = xmlResponse;
            this._importPanel.style.display = 'none';
            this._getCapPanel.style.display = 'block';
            if (this._currentImportType === 'WMS') {
                parser = new ol.format.WMSCapabilities();
                if (!parser) {
                    return;
                }
                var getCapResponseWMS = this._getCapResponseWMS = parser.read(xmlResponse);
                if (getCapResponseWMS && getCapResponseWMS.Capability && getCapResponseWMS.Capability.Layer) {
                    var getCapLayer = getCapResponseWMS.Capability.Layer;
                    if (Array.isArray(getCapLayer)) {
                        for (var i = 0; i < getCapLayer.length; i++) {
                            this._displayGetCapResponseWMSLayer(getCapLayer[i]);
                        }
                    } else {
                        this._displayGetCapResponseWMSLayer(getCapLayer);
                    }
                }
            } else if (this._currentImportType === 'WMTS') {
                parser = new ol.format.WMTSCapabilities();
                if (!parser) {
                    return;
                }
                var getCapResponseWMTS = this._getCapResponseWMTS = parser.read(xmlResponse);
                if (getCapResponseWMTS && getCapResponseWMTS.Contents && getCapResponseWMTS.Contents.Layer) {
                    layers = getCapResponseWMTS.Contents.Layer;
                    if (Array.isArray(layers)) {
                        this._getCapResponseWMTSLayers = layers;
                        for (var j = 0; j < layers.length; j++) {
                            projection = this._getWMTSLayerProjection(layers[j], getCapResponseWMTS);
                            if (projection && typeof projection === 'string') {
                                if (ol.proj.get(projection) || ol.proj.get(projection.toUpperCase())) {
                                    layerDescription = layers[j].Title;
                                    if (this._getCapResultsListContainer) {
                                        this._getCapResultsListContainer.appendChild(this._createImportGetCapResultElement(layerDescription, j));
                                    }
                                } else {
                                    console.log('[ol.control.LayerImport] wmts layer cannot be added to map : unknown projection', layers[j]);
                                    continue;
                                }
                            }
                        }
                    }
                }
            }
        };
        LayerImport.prototype._displayGetCapResponseWMSLayer = function (layerObj, parentLayersInfos) {
            if (!layerObj) {
                console.log('[ol.control.LayerImport] _displayGetCapResponseWMSLayer : getCapabilities layer object not found');
            } else {
            }
            var mapProjCode = this._getMapProjectionCode();
            var projection;
            var layerDescription;
            if (parentLayersInfos) {
                var key;
                var i;
                var addKeys = [
                    'CRS',
                    'Style'
                ];
                for (i = 0; i < addKeys.length; i++) {
                    key = addKeys[i];
                    if (Array.isArray(parentLayersInfos[key]) && parentLayersInfos[key].length !== 0) {
                        if (Array.isArray(layerObj[key]) && layerObj[key].length !== 0) {
                            for (var n = 0; n < parentLayersInfos[key]; n++) {
                                if (layerObj[key].indexOf(parentLayersInfos[key][n]) === -1) {
                                    layerObj[key].push(parentLayersInfos[key][n]);
                                }
                            }
                        } else {
                            layerObj[key] = parentLayersInfos[key];
                        }
                    }
                }
                var replaceKeys = [
                    'BoundingBox',
                    'EX_GeographicBoundingBox',
                    'MaxScaleDenominator',
                    'MinScaleDenominator',
                    'Attribution',
                    'Dimension',
                    'queryable',
                    'cascaded',
                    'opaque',
                    'noSubsets',
                    'fixedWidth',
                    'fixedHeight'
                ];
                for (i = 0; i < replaceKeys.length; i++) {
                    key = replaceKeys[i];
                    if (parentLayersInfos[key] && !layerObj[key]) {
                        layerObj[key] = parentLayersInfos[key];
                    }
                }
                if (!parentLayersInfos._isRootLayer && parentLayersInfos.Title) {
                    layerObj.Title = parentLayersInfos.Title + ' > ' + layerObj.Title;
                }
            } else {
                layerObj._isRootLayer = true;
            }
            if (layerObj.Layer) {
                if (Array.isArray(layerObj.Layer)) {
                    for (var j = 0; j < layerObj.Layer.length; j++) {
                        this._displayGetCapResponseWMSLayer(layerObj.Layer[j], layerObj);
                    }
                }
            } else {
                var lastIndex = this._getCapResponseWMSLayers.length;
                projection = this._getWMSLayerProjection(layerObj, mapProjCode);
                if (!projection) {
                    console.log('[ol.control.LayerImport] wms layer cannot be added to map : unknown projection', layerObj);
                } else {
                    layerObj._projection = projection;
                    layerDescription = layerObj.Title;
                    if (this._getCapResultsListContainer) {
                        this._getCapResultsListContainer.appendChild(this._createImportGetCapResultElement(layerDescription, lastIndex));
                    }
                    this._getCapResponseWMSLayers[lastIndex] = layerObj;
                }
            }
        };
        LayerImport.prototype._onGetCapResponseLayerClick = function (e) {
            if (e.target && e.target.id) {
                var proposalId = parseInt(e.target.id.substr(23), 10);
                if (proposalId == null) {
                    return;
                }
                var layerInfo;
                if (this._currentImportType === 'WMS') {
                    layerInfo = this._getCapResponseWMSLayers[proposalId];
                    this._addGetCapWMSLayer(layerInfo);
                } else if (this._currentImportType === 'WMTS') {
                    layerInfo = this._getCapResponseWMTSLayers[proposalId];
                    this._addGetCapWMTSLayer(layerInfo);
                }
            }
        };
        LayerImport.prototype._addGetCapWMSLayer = function (layerInfo) {
            var map = this.getMap();
            if (!map) {
                console.log('[ol.control.LayerImport] _addGetCapWMSLayer error : map is not defined');
                return;
            }
            if (!layerInfo) {
                console.log('[ol.control.LayerImport] _addGetCapWMSLayer error : layerInfo is not defined');
                return;
            }
            var mapProjCode = this._getMapProjectionCode();
            var wmsSourceOptions = {};
            var getMapUrl = this._getWMSLayerGetMapUrl();
            if (getMapUrl) {
                wmsSourceOptions.url = getMapUrl;
            } else {
                var questionMarkIndex = this._getCapRequestUrl.indexOf('?');
                if (questionMarkIndex !== -1) {
                    wmsSourceOptions.url = this._getCapRequestUrl.substring(0, questionMarkIndex);
                } else {
                    wmsSourceOptions.url = this._getCapRequestUrl;
                }
            }
            wmsSourceOptions.params = {};
            if (layerInfo.Name) {
                wmsSourceOptions.params['LAYERS'] = layerInfo.Name;
            } else {
                console.log('[ol.control.LayerImport] unable to add wms layer : mandatory layer \'name\' parameter cannot be found', layerInfo);
                return;
            }
            wmsSourceOptions.params['SERVICE'] = 'WMS';
            if (this._getCapResponseWMS.version) {
                wmsSourceOptions.params['VERSION'] = this._getCapResponseWMS.version;
            }
            var projection = layerInfo._projection;
            if (!projection) {
                console.log('[ol.control.LayerImport] wms layer cannot be added to map : unknown projection');
                return;
            } else if (projection !== mapProjCode) {
                wmsSourceOptions.projection = projection;
            }
            var legend;
            if (layerInfo.Style && Array.isArray(layerInfo.Style)) {
                var style = layerInfo.Style[0];
                wmsSourceOptions.params['STYLES'] = style.Name;
                if (style.LegendURL && Array.isArray(style.LegendURL) && style.LegendURL.length !== 0) {
                    legend = style.LegendURL[0].OnlineResource;
                }
            }
            var wmsSource = new ol.source.TileWMS(wmsSourceOptions);
            this._getWMSLayerInfoForLayerSwitcher(layerInfo, legend, wmsSource);
            var layerTileOptions = {};
            layerTileOptions['source'] = wmsSource;
            this._getWMSLayerMinMaxResolution(layerInfo, mapProjCode, layerTileOptions);
            this._getWMSLayerExtent(layerInfo, mapProjCode, layerTileOptions);
            var wmsLayer = new ol.layer.Tile(layerTileOptions);
            wmsLayer.gpResultLayerId = 'layerimport:WMS';
            if (layerInfo.queryable) {
                wmsLayer.gpGFIparams = { queryable: true };
                if (this._getCapResponseWMS && this._getCapResponseWMS.Capability && this._getCapResponseWMS.Capability.Request && this._getCapResponseWMS.Capability.Request.GetFeatureInfo && this._getCapResponseWMS.Capability.Request.GetFeatureInfo.Format && Array.isArray(this._getCapResponseWMS.Capability.Request.GetFeatureInfo.Format)) {
                    wmsLayer.gpGFIparams.formats = this._getCapResponseWMS.Capability.Request.GetFeatureInfo.Format;
                }
            }
            map.addLayer(wmsLayer);
        };
        LayerImport.prototype._getWMSLayerGetMapUrl = function () {
            var getmapurl;
            if (this._getCapResponseWMS && this._getCapResponseWMS.Capability && this._getCapResponseWMS.Capability.Request && this._getCapResponseWMS.Capability.Request.GetMap) {
                var getmap = this._getCapResponseWMS.Capability.Request.GetMap;
                if (getmap.DCPType && Array.isArray(getmap.DCPType) && getmap.DCPType.length !== 0) {
                    var url = getmap.DCPType[0];
                    if (url && url.HTTP && url.HTTP.Get) {
                        getmapurl = url.HTTP.Get.OnlineResource;
                    }
                }
            }
            return getmapurl;
        };
        LayerImport.prototype._getWMSLayerProjection = function (layerInfo, mapProjCode) {
            var projection;
            if (!layerInfo || typeof layerInfo !== 'object') {
                return;
            }
            var CRSList = layerInfo.CRS;
            if (Array.isArray(CRSList)) {
                for (var i = 0; i < CRSList.length; i++) {
                    var layerCRS = CRSList[i];
                    if (layerCRS === mapProjCode) {
                        projection = layerCRS;
                        break;
                    } else {
                        if (layerCRS && typeof layerCRS === 'string') {
                            if (ol.proj.get(layerCRS) || ol.proj.get(layerCRS.toUpperCase())) {
                                projection = layerCRS;
                                break;
                            }
                        }
                    }
                }
            }
            return projection;
        };
        LayerImport.prototype._getWMSLayerMinMaxResolution = function (layerInfo, mapProjCode, layerTileOptions) {
            var mapUnits = ol.proj.get(mapProjCode).getUnits();
            if (mapUnits === 'm') {
                if (layerInfo.MinScaleDenominator) {
                    layerTileOptions.minResolution = layerInfo.MinScaleDenominator * 0.00028;
                }
                if (layerInfo.MaxScaleDenominator) {
                    layerTileOptions.maxResolution = layerInfo.MaxScaleDenominator * 0.00028;
                }
            } else if (mapUnits === 'degrees') {
                var cste = 0.00028 * 180 / (Math.PI * 6378137);
                if (layerInfo.MinScaleDenominator) {
                    layerTileOptions.minResolution = layerInfo.MinScaleDenominator * cste;
                }
                if (layerInfo.MaxScaleDenominator) {
                    layerTileOptions.maxResolution = layerInfo.MaxScaleDenominator * cste;
                }
            }
        };
        LayerImport.prototype._getWMSLayerExtent = function (layerInfo, mapProjCode, layerTileOptions) {
            if (!layerInfo) {
                console.log('[ol.control.LayerImport] _getWMSLayerExtent error : layerInfo is not defined');
                return;
            }
            var exGeographicBoundingBox = layerInfo['EX_GeographicBoundingBox'];
            var boundingBox = layerInfo.BoundingBox;
            if (exGeographicBoundingBox && Array.isArray(exGeographicBoundingBox)) {
                if (mapProjCode === 'EPSG:4326') {
                    layerTileOptions.extent = exGeographicBoundingBox;
                } else {
                    layerTileOptions.extent = ol.proj.transformExtent(exGeographicBoundingBox, 'EPSG:4326', mapProjCode);
                }
            } else if (boundingBox && Array.isArray(boundingBox)) {
                var crs;
                var extent;
                for (var i = 0; i < boundingBox.length; i++) {
                    crs = boundingBox[i].crs;
                    extent = boundingBox[i].extent;
                    if (crs) {
                        if (crs === mapProjCode) {
                            layerTileOptions.extent = extent;
                            break;
                        } else {
                            if (crs && typeof crs === 'string') {
                                var olProj = ol.proj.get(crs) ? ol.proj.get(crs) : ol.proj.get(crs.toUpperCase());
                                if (olProj) {
                                    if (olProj.getUnits() === 'degrees' && crs.toUpperCase().indexOf('EPSG') === 0) {
                                        var reversedExtent = [
                                            extent[1],
                                            extent[0],
                                            extent[3],
                                            extent[2]
                                        ];
                                        layerTileOptions.extent = ol.proj.transformExtent(reversedExtent, olProj, mapProjCode);
                                    } else {
                                        layerTileOptions.extent = ol.proj.transformExtent(extent, olProj, mapProjCode);
                                    }
                                    break;
                                }
                            }
                        }
                    }
                }
            }
        };
        LayerImport.prototype._getWMSLayerInfoForLayerSwitcher = function (layerInfo, legend, wmsSource) {
            if (layerInfo.Title) {
                wmsSource._title = layerInfo.Title;
                wmsSource._description = layerInfo.Abstract ? layerInfo.Abstract : layerInfo.Title;
            } else {
                wmsSource._title = layerInfo.Name;
                wmsSource._description = layerInfo.Abstract ? layerInfo.Abstract : layerInfo.Name;
            }
            if (legend) {
                wmsSource._legends = [{ url: legend }];
            }
            if (layerInfo.MetadataURL && Array.isArray(layerInfo.MetadataURL)) {
                wmsSource._metadata = [];
                for (var i = 0; i < layerInfo.MetadataURL.length; i++) {
                    var metadata = layerInfo.MetadataURL[i].OnlineResource;
                    if (metadata) {
                        wmsSource._metadata.push({ url: metadata });
                    }
                }
            }
            if (layerInfo.Attribution) {
                var attribution = layerInfo.Attribution;
                wmsSource._originators = {};
                if (attribution.OnlineResource) {
                    wmsSource._originators.url = attribution.OnlineResource;
                }
                if (attribution.Title) {
                    wmsSource._originators.name = wmsSource._originators.attribution = attribution.Title;
                }
                if (attribution.LogoURL && attribution.LogoURL.OnlineResource) {
                    wmsSource._originators.logo = attribution.LogoURL.OnlineResource;
                }
            }
        };
        LayerImport.prototype._addGetCapWMTSLayer = function (layerInfo) {
            if (!layerInfo || !layerInfo.Identifier) {
                console.log('[ol.control.LayerImport] layer information not found in getCapabilities response for layer ');
                return;
            }
            var map = this.getMap();
            if (!map) {
                return;
            }
            var wmtsSourceOptions = {};
            wmtsSourceOptions.layer = layerInfo.Identifier;
            if (this._getCapResponseWMTS.version) {
                wmtsSourceOptions.version = this._getCapResponseWMTS.version;
            }
            var getMapUrl = this._getWMTSLayerGetTileUrl();
            if (getMapUrl) {
                wmtsSourceOptions.url = getMapUrl;
            } else {
                var questionMarkIndex = this._getCapRequestUrl.indexOf('?');
                if (questionMarkIndex !== -1) {
                    wmtsSourceOptions.url = this._getCapRequestUrl.substring(0, questionMarkIndex);
                } else {
                    wmtsSourceOptions.url = this._getCapRequestUrl;
                }
            }
            var tmsOptions = this._getTMSParams(layerInfo);
            wmtsSourceOptions.matrixSet = tmsOptions.tms;
            wmtsSourceOptions.projection = tmsOptions.projCode;
            wmtsSourceOptions.tileGrid = new ol.tilegrid.WMTS({
                resolutions: tmsOptions.resolutions,
                matrixIds: tmsOptions.matrixIds,
                origin: tmsOptions.origin
            });
            var defaultStyle;
            var legend;
            if (layerInfo.Style && Array.isArray(layerInfo.Style)) {
                var style;
                for (var s = 0; s < layerInfo.Style.length; s++) {
                    style = layerInfo.Style[s];
                    defaultStyle = style.Identifier;
                    if (style.isDefault) {
                        break;
                    }
                    if (style.LegendURL && Array.isArray(style.LegendURL) && style.LegendURL.length !== 0) {
                        legend = style.LegendURL[0].href;
                    }
                }
            }
            if (defaultStyle == null) {
                console.log('[ol.control.LayerImport] style information not found in getCapabilities response for layer ' + layerInfo.Identifier);
            }
            wmtsSourceOptions.style = defaultStyle;
            var format;
            if (layerInfo.Format && Array.isArray(layerInfo.Format)) {
                format = layerInfo.Format[0];
            }
            if (format == null) {
                console.log('[ol.control.LayerImport] format information not found in getCapabilities response for layer ' + layerInfo.Identifier);
            }
            wmtsSourceOptions.format = format;
            var wmtsSource = new ol.source.WMTS(wmtsSourceOptions);
            if (layerInfo.Title) {
                wmtsSource._title = layerInfo.Title;
                wmtsSource._description = layerInfo.Abstract ? layerInfo.Abstract : layerInfo.Title;
            } else {
                wmtsSource._title = layerInfo.Identifier;
                wmtsSource._description = layerInfo.Abstract ? layerInfo.Abstract : layerInfo.Identifier;
            }
            if (legend) {
                wmtsSource._legends = [{ url: legend }];
            }
            var layerTileOptions = {};
            layerTileOptions.source = wmtsSource;
            layerTileOptions.extent = this._getWMTSLayerExtent(layerInfo);
            var wmtsLayer;
            try {
                wmtsLayer = new ol.layer.Tile(layerTileOptions);
            } catch (e) {
                console.log('[ol.control.LayerImport] an error occured while trying to create ol.layer.Tile from getCapabilities information. error : ', e);
                return;
            }
            wmtsLayer.gpResultLayerId = 'layerimport:WMTS';
            map.addLayer(wmtsLayer);
        };
        LayerImport.prototype._getWMTSLayerGetTileUrl = function () {
            var gettileurl;
            if (this._getCapResponseWMTS && this._getCapResponseWMTS.OperationsMetadata && this._getCapResponseWMTS.OperationsMetadata.GetTile) {
                var gettile = this._getCapResponseWMTS.OperationsMetadata.GetTile;
                if (gettile.DCP && gettile.DCP.HTTP && gettile.DCP.HTTP.Get && Array.isArray(gettile.DCP.HTTP.Get) && gettile.DCP.HTTP.Get.length !== 0) {
                    gettileurl = gettile.DCP.HTTP.Get[0].href;
                }
            }
            return gettileurl;
        };
        LayerImport.prototype._getWMTSLayerProjection = function (layerInfo, getCapResponseWMTS) {
            var projection;
            if (!layerInfo || typeof layerInfo !== 'object') {
                return;
            }
            if (!getCapResponseWMTS || typeof getCapResponseWMTS !== 'object') {
                return;
            }
            if (layerInfo.TileMatrixSetLink && Array.isArray(layerInfo.TileMatrixSetLink)) {
                var tms = layerInfo.TileMatrixSetLink[0].TileMatrixSet;
                var crs;
                if (getCapResponseWMTS.Contents && Array.isArray(getCapResponseWMTS.Contents.TileMatrixSet)) {
                    var tileMatrixSets = getCapResponseWMTS.Contents.TileMatrixSet;
                    for (var i = 0; i < tileMatrixSets.length; i++) {
                        if (tileMatrixSets[i].Identifier === tms && tileMatrixSets[i].TileMatrix) {
                            var tileMatrixSet = tileMatrixSets[i];
                            crs = tileMatrixSet.SupportedCRS;
                            if (crs && typeof crs === 'string') {
                                if (ol.proj.get(crs) || ol.proj.get(crs.toUpperCase())) {
                                    projection = crs;
                                }
                            }
                            break;
                        }
                    }
                }
            }
            return projection;
        };
        LayerImport.prototype._getTMSParams = function (layerInfo) {
            var tmsOptions = {};
            var matrixIds = [];
            var resolutions = [];
            var origin = [];
            var tms;
            var projCode;
            var projection;
            var map = this.getMap();
            if (!map) {
                return;
            }
            if (layerInfo.TileMatrixSetLink && Array.isArray(layerInfo.TileMatrixSetLink)) {
                tms = layerInfo.TileMatrixSetLink[0].TileMatrixSet;
                if (this._getCapResponseWMTS.Contents && Array.isArray(this._getCapResponseWMTS.Contents.TileMatrixSet)) {
                    var tileMatrixSets = this._getCapResponseWMTS.Contents.TileMatrixSet;
                    for (var i = 0; i < tileMatrixSets.length; i++) {
                        if (tileMatrixSets[i].Identifier === tms && tileMatrixSets[i].TileMatrix) {
                            var tileMatrixSet = tileMatrixSets[i];
                            var tilematrix;
                            var id;
                            var scaledenominator;
                            var resolution;
                            var units;
                            if (tileMatrixSet.SupportedCRS) {
                                projCode = tileMatrixSet.SupportedCRS;
                                projection = ol.proj.get(projCode);
                            }
                            if (projection && projection.getUnits) {
                                units = projection.getUnits();
                            }
                            if (Array.isArray(tileMatrixSet.TileMatrix)) {
                                for (var j = 0; j < tileMatrixSet.TileMatrix.length; j++) {
                                    tilematrix = tileMatrixSet.TileMatrix[j];
                                    if (tilematrix.Identifier != null) {
                                        id = parseInt(tilematrix.Identifier, 10);
                                        matrixIds.push(id);
                                    }
                                    scaledenominator = tilematrix.ScaleDenominator;
                                    if (units === 'degrees') {
                                        resolution = scaledenominator * 0.00028 * 180 / (Math.PI * 6378137);
                                    } else {
                                        resolution = scaledenominator * 0.00028;
                                    }
                                    resolutions.push(resolution);
                                    origin = tilematrix.TopLeftCorner;
                                }
                            }
                            if (Array.isArray(resolutions) && resolutions.sort !== undefined) {
                                resolutions.sort(function (x, y) {
                                    return y - x;
                                });
                            }
                            if (Array.isArray(matrixIds) && matrixIds.sort !== undefined) {
                                matrixIds.sort(function (x, y) {
                                    return x - y;
                                });
                            }
                        }
                    }
                } else {
                    console.log('[ol.control.LayerImport] TileMatrixSet data not found in getCapabilities response for layer ' + layerInfo.Identifier);
                }
            } else {
                return;
            }
            tmsOptions.tms = tms;
            tmsOptions.projCode = projCode;
            tmsOptions.matrixIds = matrixIds;
            tmsOptions.resolutions = resolutions;
            tmsOptions.origin = origin;
            return tmsOptions;
        };
        LayerImport.prototype._getWMTSLayerExtent = function (layerInfo) {
            var extent;
            var mapProjCode = this._getMapProjectionCode();
            if (layerInfo.WGS84BoundingBox && Array.isArray(layerInfo.WGS84BoundingBox)) {
                extent = ol.proj.transformExtent(layerInfo.WGS84BoundingBox, 'EPSG:4326', mapProjCode);
            }
            return extent;
        };
        LayerImport.prototype._getMapProjectionCode = function () {
            var map = this.getMap();
            if (!map || !map.getView || !map.getView().getProjection) {
                return;
            }
            var mapProjCode = map.getView().getProjection().getCode();
            return mapProjCode;
        };
        LayerImport.prototype._displayWaitingContainer = function () {
            this._waitingContainer.className = 'GPimportWaitingContainerVisible';
            this._waiting = true;
            if (this._timer) {
                clearTimeout(this._timer);
                this._timer = null;
            }
            var context = this;
            this._timer = setTimeout(function () {
                if (context._waiting === true) {
                    context._hideWaitingContainer();
                } else {
                    if (context._timer) {
                        clearTimeout(context._timer);
                    }
                }
            }, 16000);
        };
        LayerImport.prototype._hideWaitingContainer = function () {
            if (this._waiting) {
                this._waitingContainer.className = 'GPimportWaitingContainerHidden';
                this._waiting = false;
                clearTimeout(this._timer);
                this._timer = null;
            }
        };
        LayerImport.prototype._clearGetCapParams = function () {
            this._getCapRequestUrl = null;
            this._getCapResponseWMS = null;
            this._getCapResponseWMTS = null;
            this._getCapResponseWMSLayers = null;
            this._getCapResponseWMTSLayers = null;
        };
        LayerImport.prototype._emptyGetCapResultsList = function () {
            if (this._getCapResultsListContainer) {
                while (this._getCapResultsListContainer.firstChild) {
                    this._getCapResultsListContainer.removeChild(this._getCapResultsListContainer.firstChild);
                }
            }
        };
        return LayerImport;
    }(ol, gp, {}, CommonUtils, Ol3ControlsUtilsMarkers, CommonControlsLayerImportDOM, CommonUtilsSelectorID, CommonUtilsProxyUtils, Ol3FormatsKML);
    Ol3ControlsGeoportalAttribution = function (ol, LayerUtils) {
        function GeoportalAttribution(options) {
            if (!(this instanceof GeoportalAttribution)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            ol.control.Attribution.call(this, options);
        }
        ol.inherits(GeoportalAttribution, ol.control.Attribution);
        GeoportalAttribution.prototype = Object.create(ol.control.Attribution.prototype, {});
        GeoportalAttribution.prototype.constructor = GeoportalAttribution;
        GeoportalAttribution.prototype.setMap = function (map) {
            if (map != null) {
                var ctrls = map.getControls();
                ctrls.forEach(function (element) {
                    if (element instanceof ol.control.Attribution && !(element instanceof GeoportalAttribution)) {
                        this.remove(element);
                    }
                }, ctrls);
                this._updateAttributions(map);
                var context = this;
                map.on('moveend', function () {
                    context._updateAttributions(map);
                }, this);
                map.getLayers().on('add', function () {
                    context._updateAttributions(map);
                }, this);
                map.getLayers().on('remove', function () {
                    context._updateAttributions(map);
                }, this);
            }
            ol.control.Attribution.prototype.setMap.call(this, map);
        };
        GeoportalAttribution.prototype._updateAttributions = function (map) {
            var mapAttributions = {};
            var view = map.getView();
            var extent = view.calculateExtent(map.getSize());
            var mapProjection = view.getProjection().getCode();
            var geoExtent = ol.proj.transformExtent(extent, mapProjection, 'EPSG:4326');
            var standardExtent = [
                geoExtent[3],
                geoExtent[0],
                geoExtent[1],
                geoExtent[2]
            ];
            var zoom = view.getZoom();
            var layers = map.getLayers().getArray();
            for (var i = 0; i < layers.length; i++) {
                if (layers[i].getSource) {
                    this._updateLayerAttributions(layers[i], mapAttributions, standardExtent, mapProjection, zoom);
                } else if (layers[i].getLayers) {
                    var lyrs = layers[i].getLayers();
                    var context = this;
                    lyrs.forEach(function (lyr) {
                        if (lyr.getSource) {
                            context._updateLayerAttributions(lyr, mapAttributions, standardExtent, mapProjection, zoom);
                        } else {
                            console.log('cannot find layer source in layergroup ', layers[i]);
                        }
                    });
                }
            }
        };
        GeoportalAttribution.prototype._updateLayerAttributions = function (layer, mapAttributions, mapExtent, mapCrs, mapZoom) {
            var src = layer.getSource();
            var attributions = [];
            var visibility = layer.getVisible();
            var originators = src._originators;
            if (typeof originators !== 'undefined') {
                src.setAttributions();
            }
            if (originators && visibility) {
                var layerAttributions = LayerUtils.getAttributions({
                    extent: mapExtent,
                    crs: mapCrs,
                    zoom: mapZoom,
                    visibility: visibility,
                    originators: originators
                });
                for (var j = 0; j < layerAttributions.length; j++) {
                    var attributionj = layerAttributions[j];
                    if (!mapAttributions || !mapAttributions[attributionj]) {
                        attributions.push(new ol.Attribution({ html: attributionj }));
                        mapAttributions[attributionj] = true;
                    }
                }
                if (attributions.length !== 0) {
                    src.setAttributions(attributions);
                }
            }
        };
        return GeoportalAttribution;
    }(ol, CommonUtilsLayerUtils);
    Ol3ControlsMeasuresMeasures = function (ol, woodman, Interactions) {
        var Measures = {
            DEFAULT_POINTER_STYLE: new ol.style.Circle({
                radius: 5,
                stroke: new ol.style.Stroke({
                    color: '#002A50',
                    width: 2
                }),
                fill: new ol.style.Fill({ color: 'rgba(255, 155, 0, 0.7)' })
            }),
            DEFAULT_DRAW_START_STYLE: new ol.style.Style({
                fill: new ol.style.Fill({ color: 'rgba(0, 183, 152, 0.2)' }),
                stroke: new ol.style.Stroke({
                    color: '#002A50',
                    lineDash: [
                        10,
                        10
                    ],
                    width: 2
                })
            }),
            DEFAULT_DRAW_FINISH_STYLE: new ol.style.Style({
                fill: new ol.style.Fill({ color: 'rgba(0, 183, 152, 0.3)' }),
                stroke: new ol.style.Stroke({
                    color: '#002A50',
                    width: 3
                })
            }),
            tools: {
                MeasureLength: {
                    active: false,
                    instance: null
                },
                MeasureArea: {
                    active: false,
                    instance: null
                },
                MeasureAzimuth: {
                    active: false,
                    instance: null
                }
            },
            measureDraw: null,
            measureSource: null,
            measureVector: null,
            sketch: null,
            measureTooltipElement: null,
            measureTooltip: null,
            helpTooltipElement: null,
            helpTooltip: null,
            clean: function () {
                var _class = this.CLASSNAME;
                this.clearMeasure();
                this.clearMeasureToolTip();
                this.removeMeasureEvents();
                this._showContainer.checked = false;
            },
            onPointerMoveHandler: function (e) {
                if (e.dragging) {
                    return;
                }
                var tooltipCoord = e.coordinate;
                if (this.sketch) {
                    var output;
                    var geom = this.sketch.getGeometry();
                    output = this.format(geom);
                    if (geom.getType() === 'LineString') {
                        tooltipCoord = geom.getLastCoordinate();
                    } else if (geom.getType() === 'Polygon') {
                        tooltipCoord = geom.getInteriorPoint().getCoordinates();
                    } else {
                        return;
                    }
                    this.measureTooltipElement.innerHTML = output;
                    this.measureTooltip.setPosition(tooltipCoord);
                }
            },
            onShowMeasureClick: function (e, type) {
                var self = this.CLASSNAME;
                for (var className in this.tools) {
                    if (this.tools.hasOwnProperty(className)) {
                        var o = this.tools[className];
                        if (o.active && className !== self) {
                            o.active = false;
                            if (o.instance !== null) {
                                o.instance.clean();
                            }
                        }
                    }
                }
                var map = this.getMap();
                Interactions.unset(map, { current: 'Measures' });
                if (!this._showContainer.checked) {
                    this.addMeasureEvents();
                    this.initMeasureInteraction();
                    this.addMeasureInteraction(type);
                    this.tools[self].active = true;
                } else {
                    this.clearMeasure();
                    this.clearMeasureToolTip();
                    this.removeMeasureEvents();
                    this.tools[self].active = false;
                }
            },
            clearMeasureToolTip: function () {
                var map = this.getMap();
                if (!map) {
                    return;
                }
                var mapContainer = map.getTargetElement();
                var overlays = mapContainer.getElementsByClassName('ol-overlaycontainer-stopevent');
                for (var k = 0; k < overlays.length; k++) {
                    var nodes = overlays[k];
                    var len = nodes.children.length;
                    var nodesToRemove = [];
                    for (var i = 0; i < len; i++) {
                        var node = nodes.children[i];
                        var child = node.children[0];
                        if (child.className === 'GPmeasureTooltip GPmeasureTooltip-static' || child.className === 'GPmeasureTooltip GPmeasureTooltip-measure') {
                            nodesToRemove.push(node);
                        }
                    }
                    for (var j = 0; j < nodesToRemove.length; j++) {
                        nodes.removeChild(nodesToRemove[j]);
                    }
                }
            },
            clearMeasure: function () {
                var map = this.getMap();
                if (this.measureVector) {
                    map.removeLayer(this.measureVector);
                    this.measureVector = null;
                }
                if (this.measureDraw) {
                    map.removeInteraction(this.measureDraw);
                    this.measureDraw = null;
                }
            },
            createMeasureTooltip: function (map) {
                if (this.measureTooltipElement) {
                    this.measureTooltipElement.parentNode.removeChild(this.measureTooltipElement);
                }
                this.measureTooltipElement = document.createElement('div');
                this.measureTooltipElement.className = 'GPmeasureTooltip GPmeasureTooltip-measure';
                this.measureTooltip = new ol.Overlay({
                    element: this.measureTooltipElement,
                    offset: [
                        0,
                        -15
                    ],
                    positioning: 'bottom-center'
                });
                map.addOverlay(this.measureTooltip);
            },
            createHelpTooltip: function (map) {
                if (this.helpTooltipElement) {
                    this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement);
                }
                this.helpTooltipElement = document.createElement('div');
                this.helpTooltipElement.className = 'tooltip hidden';
                this.helpTooltip = new ol.Overlay({
                    element: this.helpTooltipElement,
                    offset: [
                        15,
                        0
                    ],
                    positioning: 'center-left'
                });
                map.addOverlay(this.helpTooltip);
            },
            createStylingMeasureInteraction: function (styles) {
                this.options.styles = styles || {};
                var startStyleOpts = {
                    image: Measures.DEFAULT_POINTER_STYLE,
                    fill: Measures.DEFAULT_DRAW_START_STYLE.getFill(),
                    stroke: Measures.DEFAULT_DRAW_START_STYLE.getStroke()
                };
                if (this.options.styles.hasOwnProperty('pointer') && this.options.styles.pointer instanceof ol.style.Image) {
                    startStyleOpts.image = this.options.styles.pointer;
                }
                if (this.options.styles.hasOwnProperty('start') && this.options.styles.start instanceof ol.style.Style) {
                    if (this.options.styles.start.getFill() != null) {
                        startStyleOpts.fill = this.options.styles.start.getFill();
                    }
                    if (this.options.styles.start.getStroke() != null) {
                        startStyleOpts.stroke = this.options.styles.start.getStroke();
                    }
                }
                this.options.styles.start = new ol.style.Style(startStyleOpts);
                var finishStyleOpts = {
                    fill: Measures.DEFAULT_DRAW_FINISH_STYLE.getFill(),
                    stroke: Measures.DEFAULT_DRAW_FINISH_STYLE.getStroke()
                };
                if (this.options.styles.hasOwnProperty('finish') && this.options.styles.finish instanceof ol.style.Style) {
                    if (this.options.styles.finish.getFill() != null) {
                        finishStyleOpts.fill = this.options.styles.finish.getFill();
                    }
                    if (this.options.styles.finish.getStroke() != null) {
                        finishStyleOpts.stroke = this.options.styles.finish.getStroke();
                    }
                }
                this.options.styles.finish = new ol.style.Style(finishStyleOpts);
            },
            addMeasureInteraction: function (type) {
                var map = this.getMap();
                var self = this;
                this.measureDraw = new ol.interaction.Draw({
                    source: this.measureSource,
                    condition: function (event) {
                        if (event.originalEvent.ctrlKey) {
                            if (self.sketch) {
                                this.removeLastPoint();
                            }
                            return false;
                        }
                        return true;
                    },
                    type: type,
                    style: this.options.styles.start || Measures.DEFAULT_DRAW_START_STYLE
                });
                this.measureDraw.setProperties({
                    name: 'Measures',
                    source: this
                });
                map.addInteraction(this.measureDraw);
                this.createMeasureTooltip(map);
                this.measureDraw.on('drawstart', function (evt) {
                    self.sketch = evt.feature;
                }, this);
                this.measureDraw.on('drawend', function () {
                    if (self.sketch) {
                        var output;
                        var tooltipCoord;
                        var geom = self.sketch.getGeometry();
                        output = self.format(geom);
                        if (geom.getType() === 'LineString') {
                            tooltipCoord = geom.getLastCoordinate();
                        } else if (geom.getType() === 'Polygon') {
                            tooltipCoord = geom.getInteriorPoint().getCoordinates();
                        } else {
                            return;
                        }
                        self.measureTooltipElement.innerHTML = output;
                        self.measureTooltip.setPosition(tooltipCoord);
                    }
                    self.measureTooltipElement.className = 'GPmeasureTooltip GPmeasureTooltip-static';
                    self.measureTooltip.setOffset([
                        0,
                        -7
                    ]);
                    self.sketch = null;
                    self.measureTooltipElement = null;
                    self.createMeasureTooltip(map);
                }, this);
            },
            initMeasureInteraction: function () {
                var map = this.getMap();
                this.measureSource = new ol.source.Vector();
                this.measureVector = new ol.layer.Vector({
                    source: this.measureSource,
                    style: this.options.styles.finish || Measures.DEFAULT_DRAW_FINISH_STYLE
                });
                this.measureVector.gpResultLayerId = 'measure';
                map.addLayer(this.measureVector);
            }
        };
        return Measures;
    }(ol, {}, Ol3ControlsUtilsInteractions);
    CommonControlsMeasureToolBoxDOM = function () {
        var MeasureToolBoxDOM = {
            _toolboxId: 'GPtoolbox-measure-main',
            _buttonId: 'GPtoolbox-measure-button',
            _widgetId: 'GPtoolbox-measure-widget',
            getToolBoxID: function (uid) {
                return uid ? this._toolboxId + '-' + uid : this._toolboxId;
            },
            getButtonID: function (uid) {
                return uid ? this._buttonId + '-' + uid : this._buttonId;
            },
            getWidgetID: function (uid) {
                return uid ? this._widgetId + '-' + uid : this._widgetId;
            },
            _createToolBoxContainerElement: function (uid) {
                var container = document.createElement('div');
                container.id = this.getToolBoxID(uid);
                container.className = 'GPshowAdvancedToolPicto';
                var button = document.createElement('button');
                button.id = this.getButtonID(uid);
                var self = this;
                button.addEventListener('click', function () {
                    this.blur();
                    var widget = document.getElementById(self.getWidgetID(uid));
                    if (widget.style.display === 'block') {
                        widget.style.display = 'none';
                    } else {
                        widget.style.display = 'block';
                    }
                });
                container.appendChild(button);
                var widget = document.createElement('div');
                widget.id = this.getWidgetID(uid);
                widget.addEventListener('click', function () {
                }, false);
                container.appendChild(widget);
                return container;
            }
        };
        return MeasureToolBoxDOM;
    }();
    Ol3ControlsMeasureToolBox = function (ol, woodman, Utils, ID, MeasureToolBoxDOM) {
        var MeasureToolBox = {
            _toolbox: {},
            add: function (map, ctrl) {
                if (!map) {
                    return;
                }
                var mapContainer = map.getTargetElement();
                var mapDocument = mapContainer.ownerDocument;
                var mapId = mapContainer.id;
                if (!this._toolbox || Object.keys(this._toolbox).length === 0) {
                    this._toolbox[mapId] = ID.generate();
                } else {
                    if (!this._toolbox[mapId]) {
                        this._toolbox[mapId] = ID.generate();
                    }
                }
                var uid = this._toolbox[mapId];
                if (!mapDocument.getElementById(this.getToolBoxID(uid))) {
                    var toolboxContainer = this._createToolBoxContainerElement(uid);
                    var overlaysContainer = mapContainer.getElementsByClassName('ol-overlaycontainer-stopevent');
                    overlaysContainer[0].appendChild(toolboxContainer);
                }
                var widgetContainer = mapDocument.getElementById(this.getWidgetID(uid));
                ctrl.setTarget(widgetContainer);
            }
        };
        Utils.assign(MeasureToolBox, MeasureToolBoxDOM);
        return MeasureToolBox;
    }(ol, {}, CommonUtils, CommonUtilsSelectorID, CommonControlsMeasureToolBoxDOM);
    CommonControlsElevationPathDOM = function () {
        var ElevationPathDOM = {
            _addUID: function (id) {
                var uid = this._uid ? id + '-' + this._uid : id;
                return uid;
            },
            _createMainContainerElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GPelevationPath');
                container.className = 'GPwidget';
                return container;
            },
            _createShowElevationPathElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPshowElevationPath');
                input.type = 'checkbox';
                return input;
            },
            _createShowElevationPathPictoElement: function () {
                var context = this;
                var label = document.createElement('label');
                label.id = this._addUID('GPshowElevationPathPicto');
                label.className = 'GPshowAdvancedToolPicto';
                label.htmlFor = this._addUID('GPshowElevationPath');
                label.title = 'Calculer un profil';
                if (label.addEventListener) {
                    label.addEventListener('click', function (e) {
                        context.onShowElevationPathClick(e);
                    });
                } else if (label.attachEvent) {
                    label.attachEvent('onclick', function (e) {
                        context.onShowElevationPathClick(e);
                    });
                }
                var spanOpen = document.createElement('span');
                spanOpen.id = this._addUID('GPshowElevationPathOpen');
                spanOpen.className = 'GPshowAdvancedToolOpen';
                label.appendChild(spanOpen);
                return label;
            },
            _createElevationPathPanelElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPelevationPathPanel');
                div.className = 'GPpanel';
                return div;
            },
            _createElevationPathPanelHeaderElement: function () {
                var self = this;
                var container = document.createElement('div');
                container.className = 'GPpanelHeader';
                var div = document.createElement('div');
                div.className = 'GPpanelTitle';
                div.innerHTML = 'Profil Altimétrique';
                container.appendChild(div);
                var divReduce = document.createElement('div');
                divReduce.id = this._addUID('GPelevationPathPanelReduce');
                divReduce.className = 'GPpanelReduce';
                divReduce.title = 'Masquer le panneau';
                if (divReduce.addEventListener) {
                    divReduce.addEventListener('click', function () {
                        if (typeof self.onReduceElevationPathPanelClick === 'function') {
                            document.getElementById(self._addUID('GPshowElevationPath')).checked = false;
                            self.onReduceElevationPathPanelClick();
                        }
                    }, false);
                } else if (divReduce.attachEvent) {
                    divReduce.attachEvent('onclick', function () {
                        if (typeof self.onReduceElevationPathPanelClick === 'function') {
                            document.getElementById(self._addUID('GPshowElevationPath')).checked = false;
                            self.onReduceElevationPathPanelClick();
                        }
                    });
                }
                container.appendChild(divReduce);
                var divClose = document.createElement('div');
                divClose.id = this._addUID('GPelevationPathPanelClose');
                divClose.className = 'GPpanelClose';
                divClose.title = 'Fermer le panneau';
                if (divClose.addEventListener) {
                    divClose.addEventListener('click', function () {
                        document.getElementById(self._addUID('GPshowElevationPathPicto')).click();
                    }, false);
                } else if (divClose.attachEvent) {
                    divClose.attachEvent('onclick', function () {
                        document.getElementById(self._addUID('GPshowElevationPathPicto')).click();
                    });
                }
                container.appendChild(divClose);
                return container;
            },
            _createElevationPathPanelProfilElement: function () {
                var div = document.createElement('div');
                div.id = 'GPelevationPathProfil';
                return div;
            },
            _createElevationPathWaitingElement: function () {
                var div = document.createElement('div');
                div.id = this._addUID('GPelevationPathCalcWaitingContainer');
                div.className = 'GPelevationPathCalcWaitingContainerHidden';
                var p = document.createElement('p');
                p.className = 'GPelevationPathCalcWaiting';
                p.innerHTML = 'Calcul en cours...';
                div.appendChild(p);
                return div;
            }
        };
        return ElevationPathDOM;
    }();
    Ol3ControlsElevationPath = function (ol, woodman, Gp, Utils, RightManagement, Measures, MeasureToolBox, Interactions, ElevationPathDOM, ID) {
        function ElevationPath(options) {
            options = options || {};
            if (!(this instanceof ElevationPath)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            this.CLASSNAME = 'ElevationPath';
            this._uid = ID.generate();
            this._showContainer = null;
            this._pictoContainer = null;
            this._panelContainer = null;
            this._profileContainer = null;
            this._waitingContainer = null;
            this._drawStyleStart = null;
            this._drawStyleFinish = null;
            this._markerStyle = null;
            this._profile = null;
            this._measureSource = null;
            this._measureVector = null;
            this._measureDraw = null;
            this._lastSketch = null;
            this._currentSketch = null;
            this._marker = null;
            this._noRightManagement = false;
            this._initialize(options);
            this._checkRightsManagement();
            var container = options.element ? options.element : this._initializeContainer();
            ol.control.Control.call(this, {
                element: container,
                target: options.target,
                render: options.render
            });
        }
        ol.inherits(ElevationPath, ol.control.Control);
        ElevationPath.prototype = Object.create(ol.control.Control.prototype, {});
        Utils.assign(ElevationPath.prototype, ElevationPathDOM);
        ElevationPath.__removeProfilMarker = function (context) {
            var self = context;
            if (self._marker) {
                self._measureSource.removeFeature(self._marker);
                self._marker = null;
            }
        };
        ElevationPath.__updateProfilMarker = function (d, context) {
            var self = context;
            var map = self.getMap();
            var proj = map.getView().getProjection();
            ElevationPath.__removeProfilMarker(self);
            var _coordinate = ol.proj.transform([
                d.lon,
                d.lat
            ], 'EPSG:4326', proj);
            var _coordinateProj = self._measureSource.getFeatures()[0].getGeometry().getClosestPoint(_coordinate);
            var _geometry = new ol.geom.Point(_coordinateProj);
            self._marker = new ol.Feature({ geometry: _geometry });
            self._marker.setStyle(self._markerStyle);
            self._measureSource.addFeature(self._marker);
        };
        ElevationPath.DISPLAY_PROFILE_LIB_AMCHARTS = function (data, container, context) {
            if (typeof AmCharts === 'undefined') {
                console.log('Lib. AmCharts is not loaded !');
                return;
            }
            AmCharts.addInitHandler(function () {
            });
            var self = context;
            var _config = {};
            Utils.mergeParams(_config, self.options.styles.profile);
            Utils.mergeParams(_config, { dataProvider: data });
            self._profile = AmCharts.makeChart(container, _config);
            self._profile.addListener('changed', function (e) {
                var obj = e.chart.dataProvider[e.index];
                ElevationPath.__removeProfilMarker(self);
                ElevationPath.__updateProfilMarker(obj, self);
            });
        };
        ElevationPath.DISPLAY_PROFILE_LIB_D3 = function (data, container, context) {
            if (typeof d3 === 'undefined') {
                console.log('Lib. D3 is not loaded !');
                return;
            }
            if (container) {
                while (container.firstChild) {
                    container.removeChild(container.firstChild);
                }
            }
            var margin = {
                top: 20,
                right: 20,
                bottom: 30,
                left: 40
            };
            var h = getComputedStyle(container, null).getPropertyValue('height').replace('px', '');
            var w = getComputedStyle(container, null).getPropertyValue('width').replace('px', '');
            var width = w - margin.left - margin.right;
            var height = h - margin.top - margin.bottom;
            var x = d3.scale.linear().range([
                0,
                width
            ]);
            var y = d3.scale.linear().range([
                height,
                0
            ]);
            var xAxis = d3.svg.axis().scale(x).orient('bottom').ticks(5);
            var yAxis = d3.svg.axis().scale(y).orient('left').ticks(5);
            var line = d3.svg.line().interpolate('basis').x(function (d) {
                return x(d.dist);
            }).y(function (d) {
                return y(d.z);
            });
            var area = d3.svg.area().interpolate('basis').x(function (d) {
                return x(d.dist);
            }).y0(height).y1(function (d) {
                return y(d.z);
            });
            var svg = d3.select(container).append('svg').attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom).append('g').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');
            var xDomain = d3.extent(data, function (d) {
                return d.dist;
            });
            x.domain(xDomain);
            var yDomain = [
                0,
                d3.max(data, function (d) {
                    return d.z;
                })
            ];
            y.domain(yDomain);
            svg.append('path').datum(data).attr('class', 'area-d3').attr('d', area);
            svg.append('g').attr('class', 'x axis-d3').attr('transform', 'translate(0,' + height + ')').call(xAxis).append('text').attr('y', -15).attr('dy', '.71em').attr('x', width).text('Distance (km)');
            svg.append('g').attr('class', 'y axis-d3').call(yAxis).append('text').attr('transform', 'rotate(-90)').attr('y', 6).attr('dy', '.71em').text('Altitude (m)');
            svg.append('g').attr('class', 'grid-d3 vertical').attr('transform', 'translate(0,' + height + ')').call(xAxis.orient('bottom').tickSize(-height, 0, 0).tickFormat(''));
            svg.append('g').attr('class', 'grid-d3 horizontal').call(yAxis.orient('left').tickSize(-width, 0, 0).tickFormat(''));
            svg.append('path').datum(data).attr('class', 'line-d3').attr('d', line);
            svg.selectAll('circle').data(data).enter().append('circle').attr('cx', function (d) {
                return x(d.dist);
            }).attr('cy', function (d) {
                return y(d.z);
            }).attr('r', 0).attr('class', 'circle-d3');
            var focus = svg.append('g').style('display', 'none');
            focus.append('line').attr('id', 'focusLineX').attr('class', 'focusLine-d3');
            focus.append('line').attr('id', 'focusLineY').attr('class', 'focusLine-d3');
            focus.append('circle').attr('id', 'focusCircle').attr('r', 4).attr('class', 'circle-d3 focusCircle-d3');
            var div = d3.select(container).append('div').attr('class', 'tooltip-d3').style('opacity', 0);
            var bisectDist = d3.bisector(function (d) {
                return d.dist;
            }).left;
            var self = context;
            svg.append('rect').attr('class', 'overlay-d3').attr('width', width).attr('height', height).on('mouseover', function () {
                focus.style('display', null);
                ElevationPath.__updateProfilMarker(data[0], self);
            }).on('mouseout', function () {
                focus.style('display', 'none');
                ElevationPath.__removeProfilMarker(self);
                div.transition().duration(500).style('opacity', 0);
            }).on('mousemove', function () {
                var m = d3.mouse(this);
                var distance = x.invert(m[0]);
                var i = bisectDist(data, distance);
                var d0 = i === 0 ? data[0] : data[i - 1];
                var d1 = data[i];
                var d = distance - d0[0] > d1[0] - distance ? d1 : d0;
                var xc = x(d.dist);
                var yc = y(d.z);
                focus.select('#focusCircle').attr('cx', xc).attr('cy', yc);
                focus.select('#focusLineX').attr('x1', xc).attr('y1', y(yDomain[0])).attr('x2', xc).attr('y2', y(yDomain[1]));
                focus.select('#focusLineY').attr('x1', x(xDomain[0])).attr('y1', yc).attr('x2', x(xDomain[1])).attr('y2', yc);
                ElevationPath.__updateProfilMarker(d, self);
                div.transition().duration(200).style('opacity', 0.9);
                div.html('Alt : ' + d.z + ' m <br/>' + 'Lon : ' + d.lon + ' <br/>' + 'Lat : ' + d.lat).style('left', d3.event.pageX + 'px').style('top', d3.event.pageY - 28 + 'px');
            });
            self._profile = d3.selectAll('rect.overlay')[0][0];
        };
        ElevationPath.DISPLAY_PROFILE_RAW = function (data, container, context) {
            if (container) {
                while (container.firstChild) {
                    container.removeChild(container.firstChild);
                }
            }
            var self = context;
            var div = document.createElement('textarea');
            div.id = 'profileElevationRaw';
            div.rows = 10;
            div.cols = 50;
            div.style.width = '100%';
            div.wrap = 'off';
            div.innerHTML = JSON.stringify(data, undefined, 4);
            container.appendChild(div);
            self._profile = container;
            if (self.options.debug) {
                var _proj = self.getMap().getView().getProjection();
                for (var i = 0; i < data.length; i++) {
                    var obj = data[i];
                    var _coordinate = ol.proj.transform([
                        obj.lon,
                        obj.lat
                    ], 'EPSG:4326', _proj);
                    var _geometry = new ol.geom.Point(_coordinate);
                    self._marker = new ol.Feature({ geometry: _geometry });
                    var styles = ElevationPath.DEFAULT_STYLES.RESULTS;
                    var _image = new ol.style.Circle({
                        radius: styles.imageRadius,
                        stroke: new ol.style.Stroke({
                            color: styles.imageStrokeColor,
                            width: styles.imageStrokeWidth
                        }),
                        fill: new ol.style.Fill({ color: styles.imageFillColor })
                    });
                    self._marker.setStyle(new ol.style.Style({ image: _image }));
                    self._measureSource.addFeature(self._marker);
                }
            }
        };
        ElevationPath.DISPLAY_PROFILE_BY_DEFAULT = function (data, container, context) {
            if (container) {
                while (container.firstChild) {
                    container.removeChild(container.firstChild);
                }
            }
            if (!data) {
                return;
            }
            var sortedElev = JSON.parse(JSON.stringify(data));
            sortedElev.sort(function (e1, e2) {
                return e1.z - e2.z;
            });
            var minZ = sortedElev[0].z;
            var maxZ = sortedElev[sortedElev.length - 1].z;
            var diff = maxZ - minZ;
            var distMax = data[data.length - 1].dist;
            var barwidth = 100 / data.length;
            var self = context;
            var div = document.createElement('div');
            div.id = 'profileElevationByDefault';
            div.addEventListener('mouseover', function (e) {
                var _lon = parseFloat(e.target.dataset['lon']);
                var _lat = parseFloat(e.target.dataset['lat']);
                if (_lon && _lat) {
                    ElevationPath.__updateProfilMarker({
                        lon: _lon,
                        lat: _lat
                    }, self);
                }
            });
            div.addEventListener('mousemove', function () {
            });
            div.addEventListener('mouseout', function () {
                ElevationPath.__removeProfilMarker(self);
            });
            container.appendChild(div);
            var divBox = document.createElement('div');
            divBox.className = 'profile-box';
            var divZ = document.createElement('div');
            divZ.className = 'profile-z-vertical';
            var ulZ = document.createElement('ul');
            var liZmin = document.createElement('li');
            liZmin.setAttribute('class', 'profile-min-z');
            liZmin.innerHTML = minZ + ' m';
            var liZmax = document.createElement('li');
            liZmax.setAttribute('class', 'profile-max-z');
            liZmax.innerHTML = maxZ + ' m';
            ulZ.appendChild(liZmax);
            ulZ.appendChild(liZmin);
            divZ.appendChild(ulZ);
            divBox.appendChild(divZ);
            var divData = document.createElement('div');
            divData.className = 'profile-content';
            var ulData = document.createElement('ul');
            ulData.id = 'profile-data';
            ulData.className = 'profile-z-axis profile-x-axis';
            divData.appendChild(ulData);
            for (var i = 0; i < data.length; i++) {
                var d = data[i];
                var li = document.createElement('li');
                li.setAttribute('data-z', d.z);
                li.setAttribute('data-lon', d.lon);
                li.setAttribute('data-lat', d.lat);
                li.setAttribute('data-dist', d.dist);
                var pct = Math.floor((d.z - minZ) * 100 / diff);
                li.setAttribute('class', 'percent v' + pct);
                li.title = 'altitude : ' + d.z + 'm';
                li.setAttribute('style', 'width: ' + barwidth + '%');
                ulData.appendChild(li);
            }
            divBox.appendChild(divData);
            div.appendChild(divBox);
            var divX = document.createElement('div');
            divX.className = 'profile-x-horizontal';
            var ulX = document.createElement('ul');
            var liXmin = document.createElement('li');
            liXmin.setAttribute('class', 'profile-min-x');
            liXmin.innerHTML = '';
            var liXmax = document.createElement('li');
            liXmax.setAttribute('class', 'profile-max-x');
            liXmax.innerHTML = distMax + ' km';
            ulX.appendChild(liXmin);
            ulX.appendChild(liXmax);
            divX.appendChild(ulX);
            div.appendChild(divX);
            self._profile = container;
        };
        ElevationPath.DEFAULT_STYLES = {
            MARKER: new ol.style.Icon({
                src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAsCAYAAAAATWqyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABTtJREFUeNq8WGtsFUUU/rb3gtdCAykFG9AUDTQUKimhxUewEusrJYoBo4FfEgoqotHERH6oP9TGmJhIrIlWAf9hjAaEiME2pgFfVVpFii8sWqIQLLSx3EJLW7p+Z2Z2b2l7d/b23vZLTmZ2duacb2fmnDk7DlKA67rXs1hJKacsohRQppjXFygnKT9TDlH2O47zFzIFGnco91EOuqnjoBnr2Ow4FhIlLN6m3DykFTh3BGj/Doj/CfSe082xPCDnBmDWTUBeyXDVjZTHOUNHUiZCEs+weI0ySTV0/w0c2wa07gIungn+vOx8YN46oPhpYOp1Xms/5TmSeSMUERKImFnYqBoGuPRNL5LEW8BgX2rrmjWZZLYApS8BUW8r4T0zO5eTEjFr+S6lSjV0HgPqVwNdf6S30abNB+7aDeQWey3bKZtIxvU5DxvyrE/izJfAvuXpkxCIDtElOjWqjK2RM8LZWMbiG0oEnUc5kB7a14WMYvI04H56du5ieZKluZWz8r0/IyQh5TuKRH8cqFuTeRIC0Sm6xYbYok1j21+ahyhLVO3wC8D5VowbRLfY0FhibOulIavDLEoRZyD8sJDeMWBXKG5ZsIobsdDsg+OMq3u1m1u9KQo8zP45EqjRxOUpk6i50IRl4FuGjpZtwUoiMYa314GFj/EzIsN8n8v+C1e4kfvwcm+wnhsZY27xQ8oiWZpKrWRQB6tAElfxpKnjsCdGklDzG9HvpI/0DYLYEpsalVnmAAM6fgR62oMHl70C5N9mn3rpI32DILbEpkZ5ljlFgbPNFtebzij5VPhNKX1lTBASNtXSzPZ3cxCuvVOH7FTCu4yxeZDGbCES0z5+PniQ3uGpwTYmYTOWCPGTpgYP6u9OnYhtzBCbQkSH0NiM4EEdP6VOxDYmYbNLiJxQ1elFwYPaG3XQCn3QHddjgpCweUKI6K2bvzw4YROf//rJob6fZl/H2FRoFiINfqo3qyzYwD8MVIeYLw32J+8j76SP9A2C2BKbGg1CZL+EF/W4YKP9a3/fCeyhkrY9DOOXEu1SlzZ5J31sSNjqURm/OfQkY9qgvkYOvXhbuH0g505Oga7HT9rPF9+t5+pDL0ulwzt46FV5ROax+JUSRRtP0LoHMK64+xNg7iqVEVOKSKRVxRGpsKhRnaRD4SPjR0J0axKCGmP7ilQxm4X8d8xXmfvHJZlPkCR3WfODl9FLMlxCIhevSJ5Nwzo1XdKxYpe3hpmB6BKdmoS43VqPxIgsni+aWOg8biZ3f+nLmSMiuvKWek/P01az7QdLyNVT7lC/l59WAKcb0iMxhzpW1nvmvpDtSiKD1l9OkpnDgv8UyMWFU9wvTP8vdY6NhJwnD1JVtso2OiiLSeL0iJUbNfg6zikVVwRTyOn2HWOfjfLtHgnBhtFIJCViyNDZUatdmnGlaFPqJIoe1WM1aqlz71ivJbLNobgAA9zgu7nZ/vstHAk5WVdzaPRqmGC5lER6kjpV4OWJdq+1kkshSk4VH9izcy/bV66qSPQZV+0J9G7rTY6+XNmqHmYwyJVV24kse1X31dhKHdasygkzy+a64oC4nWr47F4e858nSbLv4V/KAe9JKpVDrx/SImLIXMOiRUKdujESl+49O8xVZxpXzVc/C/I/RxL/hgq8YYkYhev9q6kVO4d9B+sr3vdICNaHJTHWW8Ya/87wqy2uWwstUk/gTYw3aCRGOarMDfS67kfFWqSuIe9imAjQEC272nJHixYNaSvGRIIGN49ywbsZEw1zI11N6TZSHeaGORn+F2AAJtRIMx4t+hUAAAAASUVORK5CYII=',
                anchor: [
                    0.5,
                    1
                ],
                snapToPixel: true
            }),
            RESULTS: {
                imageRadius: 5,
                imageFillColor: 'rgba(128, 128, 128, 0.2)',
                imageStrokeColor: 'rgba(0, 0, 0, 0.7)',
                imageStrokeWidth: 2
            },
            PROFILE: {
                type: 'serial',
                pathToImages: 'http://cdn.amcharts.com/lib/3/images/',
                categoryField: 'dist',
                autoMarginOffset: 0,
                marginRight: 10,
                marginTop: 10,
                startDuration: 0,
                color: '#5E5E5E',
                fontSize: 10,
                theme: 'light',
                thousandsSeparator: '',
                categoryAxis: {
                    color: '#5E5E5E',
                    gridPosition: 'start',
                    minHorizontalGap: 40,
                    tickPosition: 'start',
                    title: 'Distance (km)',
                    titleColor: '#5E5E5E',
                    startOnAxis: true
                },
                chartCursor: {
                    animationDuration: 0,
                    bulletsEnabled: true,
                    bulletSize: 10,
                    categoryBalloonEnabled: false,
                    cursorColor: '#F90',
                    graphBulletAlpha: 1,
                    graphBulletSize: 1,
                    zoomable: false
                },
                trendLines: [],
                graphs: [{
                        balloonColor: '#CCCCCC',
                        balloonText: '<span class=\'altiPathValue\'>[[title]] : [[value]]m</span><br/><span class=\'altiPathCoords\'>(lat: [[lat]] / lon:[[lon]])</span>',
                        bullet: 'round',
                        bulletAlpha: 0,
                        bulletBorderColor: '#FFF',
                        bulletBorderThickness: 2,
                        bulletColor: '#F90',
                        bulletSize: 6,
                        hidden: false,
                        id: 'AmGraph-1',
                        fillAlphas: 0.4,
                        fillColors: '#C77A04',
                        lineAlpha: 1,
                        lineColor: '#C77A04',
                        lineThickness: 1,
                        title: 'Altitude',
                        valueField: 'z'
                    }],
                guides: [],
                valueAxes: [{
                        id: 'ValueAxis-1',
                        minVerticalGap: 20,
                        title: 'Altitude (m)'
                    }],
                allLabels: [],
                balloon: {
                    borderColor: '#CCCCCC',
                    borderThickness: 1,
                    fillColor: '#FFFFFF',
                    showBullet: true
                },
                titles: []
            }
        };
        ElevationPath.prototype.constructor = ElevationPath;
        ElevationPath.prototype.setMap = function (map) {
            if (map) {
                if (this.options.active) {
                    if (this._profile === null) {
                        this._panelContainer.style.display = 'none';
                    }
                    this._initMeasureInteraction(map);
                    this._addMeasureInteraction(map);
                }
                if (!this.options.target) {
                    MeasureToolBox.add(map, this);
                }
            }
            ol.control.Control.prototype.setMap.call(this, map);
        };
        ElevationPath.prototype.getActive = function () {
            return this.options.active;
        };
        ElevationPath.prototype.setActive = function (active) {
            this.options.active = active;
        };
        ElevationPath.prototype.clean = function () {
            var map = this.getMap();
            this._panelContainer.style.display = 'none';
            this._showContainer.checked = false;
            this._removeProfile();
            this._removeMeasure();
            this._removeMeasureInteraction(map);
        };
        ElevationPath.prototype._removeMeasure = function () {
            this._lastSketch = null;
            this._currentSketch = null;
            if (this._measureSource) {
                if (this._marker) {
                    this._measureSource.removeFeature(this._marker);
                    this._marker = null;
                }
                var _features = this._measureSource.getFeatures();
                for (var i = 0; i < _features.length; i++) {
                    this._measureSource.removeFeature(_features[i]);
                }
            }
        };
        ElevationPath.prototype._removeProfile = function () {
            this._profile = null;
            if (this._profileContainer) {
                while (this._profileContainer.firstChild) {
                    this._profileContainer.removeChild(this._profileContainer.firstChild);
                }
            }
        };
        ElevationPath.prototype._initialize = function (options) {
            this.options = {};
            this.options.target = typeof options.target !== 'undefined' ? options.target : null;
            this.options.render = typeof options.render !== 'undefined' ? options.render : null;
            this.options.apiKey = options.apiKey;
            var debug = options.debug;
            this.options.debug = typeof debug === 'undefined' ? false : debug;
            var active = options.active;
            this.options.active = typeof active === 'undefined' ? false : active;
            var service = options.elevationOptions;
            this.options.service = typeof service === 'undefined' || Object.keys(service).length === 0 ? {} : service;
            var profil = options.displayProfileOptions || {};
            if (typeof profil === 'undefined' || Object.keys(profil).length === 0) {
                this.options.profile = {
                    apply: ElevationPath.DISPLAY_PROFILE_BY_DEFAULT,
                    target: null
                };
            } else {
                this.options.profile = {};
            }
            var displayFunction = profil.apply || this.options.profile.apply;
            this.options.profile.apply = typeof displayFunction === 'function' ? displayFunction : ElevationPath.DISPLAY_PROFILE_BY_DEFAULT;
            var displayContainer = profil.target || this.options.profile.target;
            this.options.profile.target = typeof displayContainer === 'undefined' ? null : displayContainer;
            var styles = options.stylesOptions || {};
            if (typeof styles === 'undefined' || Object.keys(styles).length === 0) {
                this.options.styles = { profile: ElevationPath.DEFAULT_STYLES.PROFILE };
            } else {
                this.options.styles = {};
            }
            this.options.styles.draw = styles.draw || {};
            this._createStylingDraw();
            this.options.styles.marker = styles.marker || {};
            this._createStylingMarker();
            var profile = styles.profile || this.options.styles.profile;
            this.options.styles.profile = typeof profile === 'undefined' || Object.keys(profile).length === 0 ? ElevationPath.DEFAULT_STYLES.PROFILE : profile;
            this._createStylingProfile();
        };
        ElevationPath.prototype._initializeContainer = function () {
            var container = this._createMainContainerElement();
            var inputShow = this._showContainer = this._createShowElevationPathElement();
            container.appendChild(inputShow);
            var picto = this._pictoContainer = this._createShowElevationPathPictoElement();
            container.appendChild(picto);
            if (this.options.active) {
                this._showContainer.checked = true;
            }
            var panel = this._panelContainer = this._createElevationPathPanelElement();
            var header = this._createElevationPathPanelHeaderElement();
            panel.appendChild(header);
            var profile = this._profileContainer = this._createElevationPathPanelProfilElement();
            panel.appendChild(profile);
            var waiting = this._waitingContainer = this._createElevationPathWaitingElement();
            panel.appendChild(waiting);
            if (this.options.profile.target === null) {
                container.appendChild(panel);
            }
            return container;
        };
        ElevationPath.prototype._checkRightsManagement = function () {
            var rightManagement = RightManagement.check({
                key: this.options.apiKey,
                resources: ['SERVICE_CALCUL_ALTIMETRIQUE_RSC'],
                services: ['Elevation']
            });
            if (!rightManagement) {
                this._noRightManagement = true;
            }
            if (!this.options.apiKey) {
                this.options.apiKey = rightManagement.key;
            }
        };
        ElevationPath.prototype._createStylingMarker = function () {
            var marker = ElevationPath.DEFAULT_STYLES.MARKER;
            if (this.options.styles.marker instanceof ol.style.Image) {
                marker = this.options.styles.marker;
            }
            this._markerStyle = new ol.style.Style({ image: marker });
        };
        ElevationPath.prototype._createStylingDraw = function () {
            var styles = this.options.styles.draw;
            var startStyleOpts = {
                image: Measures.DEFAULT_POINTER_STYLE,
                stroke: Measures.DEFAULT_DRAW_START_STYLE.getStroke()
            };
            if (styles.hasOwnProperty('pointer') && styles.pointer instanceof ol.style.Image) {
                startStyleOpts.image = styles.pointer;
            }
            if (styles.hasOwnProperty('start') && styles.start instanceof ol.style.Stroke) {
                startStyleOpts.stroke = styles.start;
            }
            this._drawStyleStart = new ol.style.Style(startStyleOpts);
            var finishStyleOpts = { stroke: Measures.DEFAULT_DRAW_FINISH_STYLE.getStroke() };
            if (styles.hasOwnProperty('finish') && styles.finish instanceof ol.style.Stroke) {
                finishStyleOpts.stroke = styles.finish;
            }
            this._drawStyleFinish = new ol.style.Style(finishStyleOpts);
        };
        ElevationPath.prototype._createStylingProfile = function () {
            var userStyles = this.options.styles.profile;
            var defaultStyle = ElevationPath.DEFAULT_STYLES.PROFILE;
            Object.keys(defaultStyle).forEach(function (key) {
                if (!userStyles.hasOwnProperty(key)) {
                    userStyles[key] = defaultStyle[key];
                    return;
                } else {
                    var _defaultStyle = defaultStyle[key];
                    if (typeof _defaultStyle === 'object') {
                        Utils.mergeParams(_defaultStyle, userStyles[key]);
                        userStyles[key] = _defaultStyle;
                        return;
                    }
                }
            }, this);
        };
        ElevationPath.prototype._initMeasureInteraction = function (map) {
            if (!map) {
                return;
            }
            this._measureSource = new ol.source.Vector();
            this._measureVector = new ol.layer.Vector({
                source: this._measureSource,
                style: this._drawStyleFinish
            });
            map.addLayer(this._measureVector);
        };
        ElevationPath.prototype._addMeasureInteraction = function (map) {
            if (!map) {
                return;
            }
            this._measureDraw = new ol.interaction.Draw({
                source: this._measureSource,
                type: 'LineString',
                style: this._drawStyleStart
            });
            this._measureDraw.setProperties({
                name: 'ElevationPath',
                source: this
            });
            map.addInteraction(this._measureDraw);
            var self = this;
            this._measureDraw.on('drawstart', function (evt) {
                if (self._marker !== null) {
                    self._measureSource.removeFeature(self._marker);
                    self._marker = null;
                }
                if (self._lastSketch !== null) {
                    self._measureSource.removeFeature(self._lastSketch);
                    self._lastSketch = null;
                }
                self._currentSketch = evt.feature;
                var _features = self._measureSource.getFeatures();
                for (var i = 0; i < _features.length; i++) {
                    self._measureSource.removeFeature(_features[i]);
                }
            }, this);
            this._measureDraw.on('drawend', function (evt) {
                self._lastSketch = self._currentSketch;
                if (typeof self.options.service.onSuccess === 'undefined' && self.options.profile.target === null) {
                    self._panelContainer.style.display = 'block';
                }
                self._requestService();
            }, this);
        };
        ElevationPath.prototype._removeMeasureInteraction = function (map) {
            if (!map) {
                return;
            }
            if (this._measureVector) {
                map.removeLayer(this._measureVector);
                this._measureVector = null;
            }
            if (this._measureDraw) {
                map.removeInteraction(this._measureDraw);
                this._measureDraw = null;
            }
        };
        ElevationPath.prototype._getGeometry = function () {
            if (this._currentSketch === null) {
                return;
            }
            var geometry = [];
            var map = this.getMap();
            var projSrc = map.getView().getProjection();
            var projDest = 'EPSG:4326';
            var coordinates = this._currentSketch.getGeometry().getCoordinates();
            for (var i = 0; i < coordinates.length; i++) {
                var xy = coordinates[i];
                var ll = xy;
                if (projSrc !== projDest) {
                    ll = ol.proj.transform(xy, projSrc, projDest);
                }
                geometry.push({
                    lon: ll[0],
                    lat: ll[1]
                });
            }
            return geometry;
        };
        ElevationPath.prototype._getLength = function () {
            if (this._currentSketch === null) {
                return;
            }
            var length = 0;
            var wgs84Sphere = new ol.Sphere(6378137);
            var map = this.getMap();
            var projSrc = map.getView().getProjection();
            var projDest = 'EPSG:4326';
            var coordinates = this._currentSketch.getGeometry().getCoordinates();
            for (var i = 0, ii = coordinates.length - 1; i < ii; ++i) {
                var c1 = ol.proj.transform(coordinates[i], projSrc, projDest);
                var c2 = ol.proj.transform(coordinates[i + 1], projSrc, projDest);
                length += wgs84Sphere.haversineDistance(c1, c2);
            }
            return length;
        };
        ElevationPath.prototype._requestService = function () {
            var geometry = this._getGeometry();
            if (!geometry) {
                return;
            }
            if (this._noRightManagement) {
                return;
            }
            var options = {};
            Utils.mergeParams(options, this.options.service);
            Utils.mergeParams(options, { apiKey: this.options.apiKey });
            var self = this;
            var _requestServiceOnSuccess = function (result) {
                if (result) {
                    self._panelContainer.style.display = 'block';
                    self._displayProfile(result.elevations);
                    self._waitingContainer.className = 'GPelevationPathCalcWaitingContainerHidden';
                    self._waiting = false;
                }
            };
            var _requestServiceOnFailure = function (error) {
                self._panelContainer.style.display = 'none';
                self._waitingContainer.className = 'GPelevationPathCalcWaitingContainerHidden';
                self._waiting = false;
            };
            Utils.mergeParams(options, {
                onSuccess: this.options.service.onSuccess || _requestServiceOnSuccess,
                onFailure: this.options.service.onFailure || _requestServiceOnFailure
            });
            var sampling = options.sampling;
            if (!sampling) {
                var _sampling = 50;
                var _length = this._getLength();
                var p = Math.floor(_length) / 5;
                if (p >= 200) {
                    _sampling = 200;
                } else {
                    _sampling = Math.floor(p);
                }
                Utils.mergeParams(options, { sampling: _sampling || 50 });
            }
            Utils.mergeParams(options, { positions: geometry });
            this._waitingContainer.className = 'GPelevationPathCalcWaitingContainerVisible';
            Gp.Services.getAltitude(options);
        };
        ElevationPath.prototype._computeElevationMeasure = function (elevations) {
            var wgs84Sphere = new ol.Sphere(6378137);
            elevations[0].dist = 0;
            var distance = 0;
            for (var i = 1; i < elevations.length; i++) {
                distance += wgs84Sphere.haversineDistance([
                    elevations[i].lon,
                    elevations[i].lat
                ], [
                    elevations[i - 1].lon,
                    elevations[i - 1].lat
                ]) / 1000;
                elevations[i].dist = distance;
                elevations[i].lat = Math.round(elevations[i].lat * 10000) / 10000;
                elevations[i].lon = Math.round(elevations[i].lon * 10000) / 10000;
            }
            var coeffArrond = 100;
            if (distance > 100) {
                coeffArrond = 1;
            } else if (distance > 10) {
                coeffArrond = 10;
            }
            for (var j = 0; j < elevations.length; j++) {
                var data = elevations[j];
                if (data.z < 0) {
                    data.z = 0;
                }
                data.dist = Math.round(data.dist * coeffArrond) / coeffArrond;
            }
            return elevations;
        };
        ElevationPath.prototype._displayProfile = function (elevations) {
            var data = this._computeElevationMeasure(elevations);
            var container = this.options.profile.target;
            if (container) {
                container.appendChild(this._panelContainer);
            }
            container = this._profileContainer;
            var context = this;
            var displayFunction = this.options.profile.apply;
            displayFunction.call(this, data, container, context);
        };
        ElevationPath.prototype.onShowElevationPathClick = function () {
            var map = this.getMap();
            Interactions.unset(map, { current: 'ElevationPath' });
            if (!this._showContainer.checked) {
                if (this._profile === null) {
                    this._panelContainer.style.display = 'none';
                }
                this._initMeasureInteraction(map);
                this._addMeasureInteraction(map);
            } else {
                this._panelContainer.style.display = 'none';
                this._removeMeasure();
                this._removeProfile();
                this._removeMeasureInteraction(map);
            }
        };
        return ElevationPath;
    }(ol, {}, gp, CommonUtils, CommonUtilsCheckRightManagement, Ol3ControlsMeasuresMeasures, Ol3ControlsMeasureToolBox, Ol3ControlsUtilsInteractions, CommonControlsElevationPathDOM, CommonUtilsSelectorID);
    CommonControlsMeasureLengthDOM = function () {
        var MeasureLengthDOM = {
            _addUID: function (id) {
                var uid = this._uid ? id + '-' + this._uid : id;
                return uid;
            },
            _createMainContainerElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GPmeasureLength');
                container.className = 'GPwidget';
                return container;
            },
            _createShowMeasureLengthElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPshowMeasureLength');
                input.type = 'checkbox';
                return input;
            },
            _createShowMeasureLengthPictoElement: function () {
                var context = this;
                var label = document.createElement('label');
                label.id = this._addUID('GPshowMeasureLengthPicto');
                label.className = 'GPshowAdvancedToolPicto';
                label.htmlFor = this._addUID('GPshowMeasureLength');
                label.title = 'Mesurer une distance';
                if (label.addEventListener) {
                    label.addEventListener('click', function (e) {
                        context.onShowMeasureLengthClick(e);
                    });
                } else if (label.attachEvent) {
                    label.attachEvent('onclick', function (e) {
                        context.onShowMeasureLengthClick(e);
                    });
                }
                var spanOpen = document.createElement('span');
                spanOpen.id = this._addUID('GPshowMeasureLengthOpen');
                spanOpen.className = 'GPshowAdvancedToolOpen';
                label.appendChild(spanOpen);
                return label;
            }
        };
        return MeasureLengthDOM;
    }();
    Ol3ControlsMeasuresMeasureLength = function (ol, woodman, Utils, MeasureToolBox, Measures, MeasureLengthDOM, ID) {
        function MeasureLength(options) {
            options = options || {};
            if (!(this instanceof MeasureLength)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            this.CLASSNAME = 'MeasureLength';
            this._uid = ID.generate();
            this._showContainer = null;
            this._pictoContainer = null;
            this._initialize(options);
            var container = options.element ? options.element : this._initializeContainer();
            ol.control.Control.call(this, {
                element: container,
                target: options.target,
                render: options.render
            });
        }
        ol.inherits(MeasureLength, ol.control.Control);
        MeasureLength.prototype = Object.create(ol.control.Control.prototype, {});
        Utils.assign(MeasureLength.prototype, Measures);
        Utils.assign(MeasureLength.prototype, MeasureLengthDOM);
        MeasureLength.prototype.constructor = MeasureLength;
        MeasureLength.prototype.setMap = function (map) {
            var className = this.CLASSNAME;
            if (map) {
                if (!this.options.target) {
                    MeasureToolBox.add(map, this);
                }
            } else {
                this.clean();
            }
            this.tools[className].instance = map ? this : null;
            ol.control.Control.prototype.setMap.call(this, map);
        };
        MeasureLength.prototype._initialize = function (options) {
            this.options = {};
            this.options.geodesic = typeof options.geodesic !== 'undefined' ? options.geodesic : true;
            this.options.target = typeof options.target !== 'undefined' ? options.target : null;
            this.options.render = typeof options.render !== 'undefined' ? options.render : null;
            this.createStylingMeasureInteraction(options.styles);
        };
        MeasureLength.prototype._initializeContainer = function () {
            var container = this._createMainContainerElement();
            var show = this._showContainer = this._createShowMeasureLengthElement();
            container.appendChild(show);
            this._showContainer.checked = false;
            var picto = this._pictoContainer = this._createShowMeasureLengthPictoElement();
            container.appendChild(picto);
            return container;
        };
        MeasureLength.prototype.addMeasureEvents = function () {
            var map = this.getMap();
            map.on('singleclick', this.onPointerMoveHandler, this);
            map.on('pointermove', this.onPointerMoveHandler, this);
        };
        MeasureLength.prototype.removeMeasureEvents = function () {
            var map = this.getMap();
            map.un('singleclick', this.onPointerMoveHandler, this);
            map.un('pointermove', this.onPointerMoveHandler, this);
        };
        MeasureLength.prototype.format = function (line) {
            var map = this.getMap();
            var measure;
            if (this.options.geodesic) {
                var wgs84Sphere = new ol.Sphere(6378137);
                var coordinates = line.getCoordinates();
                measure = 0;
                var sourceProj = map.getView().getProjection();
                for (var i = 0, ii = coordinates.length - 1; i < ii; ++i) {
                    var c1 = ol.proj.transform(coordinates[i], sourceProj, 'EPSG:4326');
                    var c2 = ol.proj.transform(coordinates[i + 1], sourceProj, 'EPSG:4326');
                    measure += wgs84Sphere.haversineDistance(c1, c2);
                }
            } else {
                measure = Math.round(line.getLength() * 100) / 100;
            }
            var output;
            if (measure > 1000) {
                output = Math.round(measure / 1000 * 100) / 100 + ' ' + 'km';
            } else {
                output = Math.round(measure * 100) / 100 + ' ' + 'm';
            }
            return output;
        };
        MeasureLength.prototype.onShowMeasureLengthClick = function (e) {
            this.onShowMeasureClick(e, 'LineString');
        };
        return MeasureLength;
    }(ol, {}, CommonUtils, Ol3ControlsMeasureToolBox, Ol3ControlsMeasuresMeasures, CommonControlsMeasureLengthDOM, CommonUtilsSelectorID);
    CommonControlsMeasureAreaDOM = function () {
        var MeasureAreaDOM = {
            _addUID: function (id) {
                var uid = this._uid ? id + '-' + this._uid : id;
                return uid;
            },
            _createMainContainerElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GPmeasureArea');
                container.className = 'GPwidget';
                return container;
            },
            _createShowMeasureAreaElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPshowMeasureArea');
                input.type = 'checkbox';
                return input;
            },
            _createShowMeasureAreaPictoElement: function () {
                var context = this;
                var label = document.createElement('label');
                label.id = this._addUID('GPshowMeasureAreaPicto');
                label.className = 'GPshowAdvancedToolPicto';
                label.htmlFor = this._addUID('GPshowMeasureArea');
                label.title = 'Mesurer une surface';
                if (label.addEventListener) {
                    label.addEventListener('click', function (e) {
                        context.onShowMeasureAreaClick(e);
                    });
                } else if (label.attachEvent) {
                    label.attachEvent('onclick', function (e) {
                        context.onShowMeasureAreaClick(e);
                    });
                }
                var spanOpen = document.createElement('span');
                spanOpen.id = this._addUID('GPshowMeasureAreaOpen');
                spanOpen.className = 'GPshowAdvancedToolOpen';
                label.appendChild(spanOpen);
                return label;
            }
        };
        return MeasureAreaDOM;
    }();
    Ol3ControlsMeasuresMeasureArea = function (ol, woodman, Utils, MeasureToolBox, Measures, MeasureAreaDOM, ID) {
        function MeasureArea(options) {
            options = options || {};
            if (!(this instanceof MeasureArea)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            this.CLASSNAME = 'MeasureArea';
            this._uid = ID.generate();
            this._showContainer = null;
            this._pictoContainer = null;
            this._initialize(options);
            var container = options.element ? options.element : this._initializeContainer();
            ol.control.Control.call(this, {
                element: container,
                target: options.target,
                render: options.render
            });
        }
        ol.inherits(MeasureArea, ol.control.Control);
        MeasureArea.prototype = Object.create(ol.control.Control.prototype, {});
        Utils.assign(MeasureArea.prototype, Measures);
        Utils.assign(MeasureArea.prototype, MeasureAreaDOM);
        MeasureArea.prototype.constructor = MeasureArea;
        MeasureArea.prototype.setMap = function (map) {
            var className = this.CLASSNAME;
            if (map) {
                if (!this.options.target) {
                    MeasureToolBox.add(map, this);
                }
            } else {
                this.clean();
            }
            this.tools[className].instance = map ? this : null;
            ol.control.Control.prototype.setMap.call(this, map);
        };
        MeasureArea.prototype._initialize = function (options) {
            this.options = {};
            this.options.geodesic = typeof options.geodesic !== 'undefined' ? options.geodesic : true;
            this.options.target = typeof options.target !== 'undefined' ? options.target : null;
            this.options.render = typeof options.render !== 'undefined' ? options.render : null;
            this.createStylingMeasureInteraction(options.styles);
        };
        MeasureArea.prototype._initializeContainer = function () {
            var container = this._createMainContainerElement();
            var show = this._showContainer = this._createShowMeasureAreaElement();
            container.appendChild(show);
            this._showContainer.checked = false;
            var picto = this._pictoContainer = this._createShowMeasureAreaPictoElement();
            container.appendChild(picto);
            return container;
        };
        MeasureArea.prototype.addMeasureEvents = function () {
            var map = this.getMap();
            map.on('singleclick', this.onPointerMoveHandler, this);
            map.on('pointermove', this.onPointerMoveHandler, this);
        };
        MeasureArea.prototype.removeMeasureEvents = function () {
            var map = this.getMap();
            map.un('singleclick', this.onPointerMoveHandler, this);
            map.un('pointermove', this.onPointerMoveHandler, this);
        };
        MeasureArea.prototype.format = function (polygon) {
            var map = this.getMap();
            var measure;
            if (this.options.geodesic) {
                var wgs84Sphere = new ol.Sphere(6378137);
                var sourceProj = map.getView().getProjection();
                var geom = polygon.clone().transform(sourceProj, 'EPSG:4326');
                var coordinates = geom.getLinearRing(0).getCoordinates();
                measure = Math.abs(wgs84Sphere.geodesicArea(coordinates));
            } else {
                measure = polygon.getArea();
            }
            var output;
            if (measure > 1000000) {
                output = Math.round(measure / 1000000 * 100) / 100 + ' ' + 'km<sup>2</sup>';
            } else if (measure > 100000) {
                output = Math.round(measure / 1000000 * 1000) / 1000 + ' ' + 'km<sup>2</sup>';
            } else if (measure > 1000) {
                output = Math.round(measure / 10) * 10 + ' ' + 'm<sup>2</sup>';
            } else {
                output = Math.round(measure * 100) / 100 + ' ' + 'm<sup>2</sup>';
            }
            return output;
        };
        MeasureArea.prototype.onShowMeasureAreaClick = function (e) {
            this.onShowMeasureClick(e, 'Polygon');
        };
        return MeasureArea;
    }(ol, {}, CommonUtils, Ol3ControlsMeasureToolBox, Ol3ControlsMeasuresMeasures, CommonControlsMeasureAreaDOM, CommonUtilsSelectorID);
    CommonControlsMeasureAzimuthDOM = function () {
        var MeasureAzimuthDOM = {
            _addUID: function (id) {
                var uid = this._uid ? id + '-' + this._uid : id;
                return uid;
            },
            _createMainContainerElement: function () {
                var container = document.createElement('div');
                container.id = this._addUID('GPmeasureAzimuth');
                container.className = 'GPwidget';
                return container;
            },
            _createShowMeasureAzimuthElement: function () {
                var input = document.createElement('input');
                input.id = this._addUID('GPshowMeasureAzimuth');
                input.type = 'checkbox';
                return input;
            },
            _createShowMeasureAzimuthPictoElement: function () {
                var context = this;
                var label = document.createElement('label');
                label.id = this._addUID('GPshowMeasureAzimuthPicto');
                label.className = 'GPshowAdvancedToolPicto';
                label.htmlFor = this._addUID('GPshowMeasureAzimuth');
                label.title = 'Mesurer un azimut';
                if (label.addEventListener) {
                    label.addEventListener('click', function (e) {
                        context.onShowMeasureAzimuthClick(e);
                    });
                } else if (label.attachEvent) {
                    label.attachEvent('onclick', function (e) {
                        context.onShowMeasureAzimuthClick(e);
                    });
                }
                var spanOpen = document.createElement('span');
                spanOpen.id = this._addUID('GPshowMeasureAzimuthOpen');
                spanOpen.className = 'GPshowAdvancedToolOpen';
                label.appendChild(spanOpen);
                return label;
            }
        };
        return MeasureAzimuthDOM;
    }();
    Ol3ControlsMeasuresMeasureAzimuth = function (ol, woodman, Utils, MeasureToolBox, Measures, MeasureAzimuthDOM, ID) {
        function MeasureAzimuth(options) {
            options = options || {};
            if (!(this instanceof MeasureAzimuth)) {
                throw new TypeError('ERROR CLASS_CONSTRUCTOR');
            }
            this.CLASSNAME = 'MeasureAzimuth';
            this._uid = ID.generate();
            this._showContainer = null;
            this._pictoContainer = null;
            this._initialize(options);
            var container = options.element ? options.element : this._initializeContainer();
            ol.control.Control.call(this, {
                element: container,
                target: options.target,
                render: options.render
            });
        }
        ol.inherits(MeasureAzimuth, ol.control.Control);
        MeasureAzimuth.prototype = Object.create(ol.control.Control.prototype, {});
        Utils.assign(MeasureAzimuth.prototype, Measures);
        Utils.assign(MeasureAzimuth.prototype, MeasureAzimuthDOM);
        MeasureAzimuth.prototype.constructor = MeasureAzimuth;
        MeasureAzimuth.prototype.setMap = function (map) {
            var className = this.CLASSNAME;
            if (map) {
                if (!this.options.target) {
                    MeasureToolBox.add(map, this);
                }
            } else {
                this.clean();
            }
            this.tools[className].instance = map ? this : null;
            ol.control.Control.prototype.setMap.call(this, map);
        };
        MeasureAzimuth.prototype.setGeodesic = function (value) {
            this.options.geodesic = typeof value !== 'undefined' ? value : false;
        };
        MeasureAzimuth.prototype.isGeodesic = function () {
            return this.options.geodesic;
        };
        MeasureAzimuth.prototype._initialize = function (options) {
            this.options = {};
            this.options.geodesic = typeof options.geodesic !== 'undefined' ? options.geodesic : false;
            this.options.target = typeof options.target !== 'undefined' ? options.target : null;
            this.options.render = typeof options.render !== 'undefined' ? options.render : null;
            this.createStylingMeasureInteraction(options.styles);
        };
        MeasureAzimuth.prototype._initializeContainer = function () {
            var container = this._createMainContainerElement();
            var show = this._showContainer = this._createShowMeasureAzimuthElement();
            container.appendChild(show);
            this._showContainer.checked = false;
            var picto = this._pictoContainer = this._createShowMeasureAzimuthPictoElement();
            container.appendChild(picto);
            return container;
        };
        MeasureAzimuth.prototype.addMeasureEvents = function () {
            var map = this.getMap();
            map.on('singleclick', this.onPointerMoveAzimutHandler, this);
            map.on('pointermove', this.onPointerMoveAzimutHandler, this);
        };
        MeasureAzimuth.prototype.removeMeasureEvents = function () {
            var map = this.getMap();
            map.un('singleclick', this.onPointerMoveAzimutHandler, this);
            map.un('pointermove', this.onPointerMoveAzimutHandler, this);
        };
        MeasureAzimuth.prototype.format = function (line) {
            var map = this.getMap();
            var sourceProj = map.getView().getProjection();
            var c1 = ol.proj.transform(line.getFirstCoordinate(), sourceProj, 'EPSG:4326');
            var c2 = ol.proj.transform(line.getLastCoordinate(), sourceProj, 'EPSG:4326');
            if (!this.options.geodesic) {
                var wgs84Sphere = new ol.Sphere(6378137);
                var lengthGeodesic = wgs84Sphere.haversineDistance(c1, c2);
                if (lengthGeodesic > 500) {
                    var fraction = 500 / lengthGeodesic;
                    c2 = ol.proj.transform(line.getCoordinateAt(fraction), sourceProj, 'EPSG:4326');
                }
            }
            var degrees2radians = Math.PI / 180;
            var radians2degrees = 180 / Math.PI;
            var lon1 = degrees2radians * c1[0];
            var lon2 = degrees2radians * c2[0];
            var lat1 = degrees2radians * c1[1];
            var lat2 = degrees2radians * c2[1];
            var a = Math.sin(lon2 - lon1) * Math.cos(lat2);
            var b = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(lon2 - lon1);
            var atan = Math.atan2(a, b);
            var azimut = radians2degrees * atan;
            if (azimut < 0) {
                azimut += 360;
            }
            var output = Math.round(azimut * 100) / 100 + ' \xB0';
            return output;
        };
        MeasureAzimuth.prototype.onShowMeasureAzimuthClick = function (e) {
            this.onShowMeasureClick(e, 'LineString');
        };
        MeasureAzimuth.prototype.onPointerMoveAzimutHandler = function (e) {
            this.onPointerMoveHandler(e);
            if (this.sketch) {
                var geom = this.sketch.getGeometry();
                if (geom.getCoordinates().length > 2) {
                    this.measureDraw.finishDrawing();
                }
            }
        };
        return MeasureAzimuth;
    }(ol, {}, CommonUtils, Ol3ControlsMeasureToolBox, Ol3ControlsMeasuresMeasures, CommonControlsMeasureAzimuthDOM, CommonUtilsSelectorID);
    Ol3GpPluginOl3 = function (ol, Gp, LayerUtils, Register, ProxyUtils, GfiUtils, Utils, KML, WMTS, CRS, SourceWMTS, SourceWMS, LayerWMTS, LayerWMS, LayerSwitcher, GetFeatureInfo, SearchEngine, MousePosition, Drawing, Route, Isocurve, ReverseGeocode, LayerImport, GeoportalAttribution, Markers, ElevationPath, MeasureLength, MeasureArea, MeasureAzimuth) {
        Gp.ol3extVersion = '1.0.0';
        Gp.ol3extDate = '2017-12-11';
        Gp.olUtils = Utils;
        Gp.LayerUtils = LayerUtils;
        Gp.ProxyUtils = ProxyUtils;
        ol.gp = {};
        ol.gp.GfiUtils = GfiUtils;
        ol.format.KMLExtended = KML;
        ol.source.WMTSExtended = WMTS;
        CRS.overload();
        ol.source.GeoportalWMTS = SourceWMTS;
        ol.source.GeoportalWMS = SourceWMS;
        ol.layer.GeoportalWMTS = LayerWMTS;
        ol.layer.GeoportalWMS = LayerWMS;
        ol.control.GeoportalAttribution = GeoportalAttribution;
        ol.control.LayerSwitcher = LayerSwitcher;
        ol.control.GetFeatureInfo = GetFeatureInfo;
        ol.control.SearchEngine = SearchEngine;
        ol.control.Route = Route;
        ol.control.Isocurve = Isocurve;
        ol.control.GeoportalMousePosition = MousePosition;
        ol.control.Drawing = Drawing;
        ol.control.ReverseGeocode = ReverseGeocode;
        ol.control.LayerImport = LayerImport;
        ol.control.MeasureLength = MeasureLength;
        ol.control.MeasureArea = MeasureArea;
        ol.control.MeasureAzimuth = MeasureAzimuth;
        ol.control.DefaultMarkers = Markers;
        ol.control.ElevationPath = ElevationPath;
        return Gp;
    }(ol, gp, CommonUtilsLayerUtils, CommonUtilsRegister, CommonUtilsProxyUtils, Ol3GfiUtils, CommonUtils, Ol3FormatsKML, Ol3SourcesWMTS, Ol3CRSCRS, Ol3LayersSourceWMTS, Ol3LayersSourceWMS, Ol3LayersLayerWMTS, Ol3LayersLayerWMS, Ol3ControlsLayerSwitcher, Ol3ControlsGetFeatureInfo, Ol3ControlsSearchEngine, Ol3ControlsMousePosition, Ol3ControlsDrawing, Ol3ControlsRoute, Ol3ControlsIsocurve, Ol3ControlsReverseGeocode, Ol3ControlsLayerImport, Ol3ControlsGeoportalAttribution, Ol3ControlsUtilsMarkers, Ol3ControlsElevationPath, Ol3ControlsMeasuresMeasureLength, Ol3ControlsMeasuresMeasureArea, Ol3ControlsMeasuresMeasureAzimuth);
    window.proj4 = proj4;
    return Gp;
}));
IMap = function (Logger) {
    function IMap(opts) {
        var iMap = this;
        if (!(this instanceof IMap)) {
            throw new TypeError('IMap constructor cannot be called as a function.');
        }
        this._opts = opts;
        this._layers = [];
        this._layersRemoved = [];
        this._controls = [];
        this._events = {};
        if (this._opts.mapOptions) {
            this.apiKey = this._opts.mapOptions.apiKey;
        }
        this.div = this._opts.div;
        this.mapOptions = Object.create(IMap.DEFAULTOPTIONS);
        for (var opt in this._opts.mapOptions) {
            if (this._opts.mapOptions.hasOwnProperty(opt)) {
                this.mapOptions[opt] = this._opts.mapOptions[opt];
            }
        }
        this._initMap();
    }
    IMap.DEFAULTOPTIONS = {
        projection: 'EPSG:3857',
        center: {
            x: 0,
            y: 0,
            projection: 'EPSG:4326',
            geolocate: false,
            location: null,
            locationType: [
                'StreetAddress',
                'PositionOfInterest'
            ]
        },
        azimuth: 0,
        enableRotation: true,
        tilt: 0,
        zoom: 10,
        minZoom: 0,
        maxZoom: 21,
        reloadConfig: false,
        controlsOptions: {
            draggable: true,
            keyboard: true,
            selectable: true
        },
        mapEventsOptions: {},
        noProxyDomains: ['wxs.ign.fr']
    };
    IMap.DEFAULT_AUTOPAN_OPTIONS = {
        autoPan: true,
        duration: 250,
        margin: 5
    };
    IMap.DEFAULT_MEAS_STYLES = {
        pointer: {
            strokeColor: '#002A50',
            strokeWidth: 2,
            radius: 5,
            fillColor: 'rgba(255, 155, 0, 0.7)'
        },
        start: {
            strokeColor: '#002A50',
            strokeWidth: 2,
            strokeLineDash: '[10, 10]',
            fillColor: 'rgba(0, 183, 152, 0.2)'
        },
        finish: {
            strokeColor: '#002A50',
            strokeWidth: 3,
            fillColor: 'rgba(0, 183, 152, 0.3)'
        }
    };
    IMap.DEFAULT_VECTORLAYERS_STYLES = {
        markerSrc: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAARDSURBVFiF3ZndaxxVGMZ/Z/YjX00Nadpo1qrFBgu56D9QbAtiLoRC7ywSNK1NURRREBKRFlSwFBW0gnSrJXY1CmISgyjFiyYSFC9ajE3MmpjdjWlMUtNos9lN9mteLzbRuCbZmTMTBB+Yi51znvd5n3nPnjnnjBIR/i/wuh4xpCpI0ojiENAA1AE1wCzwKzCE0EM5l2iShJvSyrXKnFVb8dOK4hmg3AIjifAmaU7ztMy7kYI7Zs6rQwjvka+AXcyiOMZx6XGahuE0AEHVitCFnhGAGoQugqrVaSrOKpNP4FWnSaxCGy1yWpesbyY/tLpwo7p/w0RxWHfI6Zk5q7ZSwhj6Q2sjzJLiXp1JQe+p+mllc4wA1CzHtw37lQmpCha5gbXpVxdJythh9z1kvzJJGrFixPBmOXixl+Z4mONmguZ4mIMXezG8WQsq5cs6tmDfTP7NXiSqN0vTzBD1TQfwbdmDUhX4tuyhvukATTNDlgxZ0SmUtUsgv0TZGPsv9FNSvXfNtpLqvey/0O+KTgF0zNQV7XHP4dsdtVvVKYCOmeqiPbwVOx21W9UpgI6ZWNEe2cSEo3arOgWwb0YYLp5G17Sjdqs6BdCZzYqL9B3dR2puYM221NwAfUf3uaJTAB0zaye5GmbWS6i2gdFQL5mFMCIJMgthRkO9hGobMLPFN4VWdAoptlcAQeUDRoG77YrZwDhQT4tk7JDsV6ZFMggv2+bZwyt2jYDuQnOa94GIFrc4IkzRrkPUM3NKsijatLjF0copsbJ++xec7TTPqw6EI/oB/glT+PC+13Y/aSQNv/Is+tNer09lMn7DMHwAYppp8fvTIpISkVQsFrslqww4M9OuqkgzANzl1MhCyrjZGAycm573pK1yFCyi5FoWvo/FYlPOT2fOqftRXMbB9lkEs+3zbe2f/FD5i3YMj2p3vn8/IV8DZ5yE+Gqkot+JEQCPada5dRhxEriiQ5ya90w+272916F+KpnJDLhjpkUy5HgESNqhZU2Vfr5ne+dSFtOBeso06J6cnEy6d0z0hPwEPGeH8sGVykvfjpfe1NZUci2+mHg7Go2G8z/d/goQVJ9B8S1veMYffujduo/thl+ZwUzDuBqJRGZWt7n/FcDH46lFNVLilar1uiTTxsJTnTssH/QpJVlMNQa5wbGJiWERya3Vz30zzfLb3OveY3dU5j5dp4e80Xdbd3TOu/H/yyAtpjnqgeGS8crRQRks+v5xf5gtY/KM/6NAVebhwvv90bLvHu2o/XId2pJSMmIaxo/RaHRMxN6yZtPM0K5K/7hl/FxVZgZWbs0mPDceeKcuGE95/kpSKUmaImHDNIfHrl+PiIj2zOb+MFvBY7IUOVl2ZG9g6bJH4ckJuRe/2NYZT3myKIkrGM4pNRyLjY+LW09URDb1+uaF0pfm3zJ+7zhRGdq1c9eDuwOBOzdLa/OG2X+APwE8DU64Y/5gfAAAAABJRU5ErkJggg==',
        markerXAnchor: 25.5,
        markerYAnchor: 38,
        strokeColor: '#002A50',
        strokeWidth: 4,
        strokeOpacity: 0.8,
        polyFillColor: '#00B798',
        polyFillOpacity: 0.5,
        textStrokeColor: '#000000',
        textColor: '#FFFFFF'
    };
    IMap.WMTSDEFAULTS = {
        'EPSG:3857': {
            resolutions: [
                156543.033928041,
                78271.51696402048,
                39135.758482010235,
                19567.87924100512,
                9783.93962050256,
                4891.96981025128,
                2445.98490512564,
                1222.99245256282,
                611.49622628141,
                305.7481131407048,
                152.8740565703525,
                76.43702828517624,
                38.21851414258813,
                19.10925707129406,
                9.554628535647032,
                4.777314267823516,
                2.388657133911758,
                1.194328566955879,
                0.5971642834779395,
                0.2985821417389697,
                0.1492910708694849,
                0.0746455354347424
            ],
            scales: {
                0: 559082264,
                1: 279541132,
                2: 139770566,
                3: 69885283,
                4: 34942642,
                5: 17471321,
                6: 8735660,
                7: 4367830,
                8: 2183915,
                9: 1091958,
                10: 545979,
                11: 272989,
                12: 136495,
                13: 68247,
                14: 34124,
                15: 17062,
                16: 8531,
                17: 4265,
                18: 2133,
                19: 1066,
                20: 533,
                21: 267
            },
            threshold: 1e-7,
            topLeftCorner: {
                x: -20037508,
                y: 20037508
            }
        },
        'EPSG:4326': {
            resolutions: [
                1.40625,
                0.703125,
                0.3515625,
                0.17578125,
                0.087890625,
                0.0439453125,
                0.02197265625,
                0.010986328125,
                0.0054931640625,
                0.00274658203125,
                0.001373291015625,
                0.0006866455078125,
                0.00034332275390625,
                0.000171661376953126,
                0.0000858306884765628,
                0.0000429153442382813,
                0.0000214576721191407,
                0.0000107288360595703,
                0.00000536441802978517,
                0.00000268220901489259,
                0.0000013411045074463,
                6.70552253723145e-7,
                3.3527612686157e-7
            ],
            threshold: 1e-10,
            topLeftCorner: {
                x: 90,
                y: -180
            }
        },
        'EPSG:2154': {
            resolutions: [
                104579.22454989408,
                52277.53235379051,
                26135.487078595408,
                13066.891381800004,
                6533.228604113456,
                3266.5595244626675,
                1633.2660045974187,
                816.6295549860224,
                408.31391467683596,
                204.15674151090204,
                102.07831678324082,
                51.0391448966112,
                25.519569074269395,
                12.759783693647506,
                6.379891635966491,
                3.18994576530532,
                1.5949728694977277,
                0.7974864315474559,
                0.398743214900604,
                0.19937160727567999,
                0.099685803696052,
                0.049842901818919996
            ],
            threshold: 1e-8,
            topLeftCorner: {
                x: 0,
                y: 12000000
            }
        }
    };
    IMap._hexToRgba = function (hex, opacity) {
        var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
        hex = hex.replace(shorthandRegex, function (m, r, g, b) {
            return r + r + g + g + b + b;
        });
        var rgb = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        rgb = rgb ? {
            r: parseInt(rgb[1], 16),
            g: parseInt(rgb[2], 16),
            b: parseInt(rgb[3], 16)
        } : null;
        var result = rgb ? 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + opacity + ')' : null;
        return result;
    };
    IMap.CustomEvent = function (eventId, eventObj) {
        if (typeof CustomEvent === 'function') {
            eventObj.bubbles = false;
            eventObj.cancelable = true;
            return new CustomEvent(eventId, eventObj);
        }
        var e = document.createEvent('CustomEvent');
        e.initCustomEvent(eventId, false, true, eventObj.detail);
        return e;
    };
    IMap.prototype = {
        constructor: IMap,
        _getDefaultControls: function () {
            return {
                draggable: true,
                keyboard: true,
                selectable: false,
                zoom: {},
                attributions: { maximised: false }
            };
        },
        _afterInitMap: function () {
            var meOptions = this.mapOptions.mapEventsOptions;
            if (meOptions) {
                for (var evtId in meOptions) {
                    this.listen(evtId, meOptions[evtId], this);
                }
            }
            this.listen('layerChanged', this._onLayerChanged, this);
            this.setXYCenter(this.mapOptions.center);
            var needsGetConfig = false;
            if (this.apiKey || this._opts.mapOptions.configUrl || this._opts.mapOptions.autoconfUrl) {
                needsGetConfig = this._opts.reloadConfig || !Gp.Config || !Gp.Config.isConfLoaded(Array.isArray(this.apiKey) ? this.apiKey[0] : this.apiKey);
            } else {
                if (Gp.Config) {
                    this.apiKey = Object.keys(Gp.Config.generalOptions.apiKeys);
                }
            }
            if (needsGetConfig) {
                var callbackSuffix = this._opts.mapOptions.callbackSuffix;
                if (this._opts.mapOptions.configUrl || this._opts.mapOptions.autoconfUrl) {
                    callbackSuffix = callbackSuffix || '';
                }
                var map = this;
                Gp.Services.getConfig({
                    apiKey: this.apiKey,
                    serverUrl: this._opts.mapOptions.configUrl || this._opts.mapOptions.autoconfUrl,
                    callbackSuffix: callbackSuffix,
                    onSuccess: function (configResponse) {
                        map._afterGetConfig(configResponse);
                    },
                    onFailure: function (error) {
                        console.log(error);
                        map._afterGetConfig(null);
                    }
                });
            } else {
                this._afterGetConfig(Gp.Config);
            }
        },
        _afterGetConfig: function (configResponse) {
            var e = IMap.CustomEvent('configured', { detail: { config: configResponse } });
            this.div.dispatchEvent(e);
            if (configResponse && !this.mapOptions.hasOwnProperty('layersOptions')) {
                this.mapOptions.layersOptions = { 'ORTHOIMAGERY.ORTHOPHOTOS': {} };
            }
            if (configResponse && (!this.mapOptions.center.hasOwnProperty('x') || this.mapOptions.center.x == 0) && (!this.mapOptions.center.hasOwnProperty('y') || this.mapOptions.center.y == 0)) {
                var autoconfCenter;
                var autoconfProj;
                var defaultCenter;
                var territories = configResponse.getTerritories();
                for (var terrCode in territories) {
                    if (territories[terrCode].isDefault) {
                        autoconfCenter = territories[terrCode].geoCenter;
                    }
                }
                this.mapOptions.center.x = autoconfCenter.lon;
                this.mapOptions.center.y = autoconfCenter.lat;
                this.mapOptions.center.projection = 'EPSG:4326';
            }
            this.setCenter(this.mapOptions.center);
            if (this.mapOptions.hasOwnProperty('markersOptions')) {
                this._addMarkers(this.mapOptions.markersOptions);
            }
            this.addLayers(this.mapOptions.layersOptions);
            this.addControls(this._getDefaultControls());
            this.addControls(this.mapOptions.controlsOptions);
            var eMapLoaded = IMap.CustomEvent('mapLoaded', { detail: { map: this } });
            this.div.dispatchEvent(eMapLoaded);
            return;
        },
        _initMap: function () {
        },
        _getZoomFromResolution: function (resolution, projCode) {
            var mapProj = this.getProjection();
            var wmtsDefaults = IMap.WMTSDEFAULTS[projCode] || IMap.WMTSDEFAULTS[mapProj] || IMap.WMTSDEFAULTS['EPSG:3857'];
            var zoom = 0;
            var diffMin = Math.abs(wmtsDefaults.resolutions[0] - resolution);
            for (var i = 1; i < wmtsDefaults.resolutions.length; i++) {
                var diff = Math.abs(wmtsDefaults.resolutions[i] - resolution);
                if (diff >= diffMin) {
                    break;
                }
                zoom = i;
                diffMin = diff;
            }
            return zoom;
        },
        _getResolutionFromZoomLevel: function (zoom, projCode) {
            var mapProj = this.getProjection();
            var wmtsDefaults = IMap.WMTSDEFAULTS[projCode] || IMap.WMTSDEFAULTS[mapProj] || IMap.WMTSDEFAULTS['EPSG:3857'];
            var res = -1;
            if (zoom >= 0 && zoom < wmtsDefaults.resolutions.length) {
                res = wmtsDefaults.resolutions[zoom];
            } else {
                console.log('unhandled zoom level : ' + zoom);
            }
            return res;
        },
        _getWMTSDefaultOpts: function () {
            var wmtsOpts = {
                version: '1.0.0',
                outputFormat: 'image/jpeg'
            };
            var matrixIds = [];
            for (var i = 0; i <= 20; i++) {
                matrixIds.push('' + i);
            }
            wmtsOpts.matrixIds = matrixIds;
            var resolutions = null;
            var topLeftCorner = null;
            var mapProj = this.getProjection();
            if (typeof mapProj != 'string' || ['EPSG:3857'].indexOf(mapProj.toUpperCase()) >= 0) {
                resolutions = IMap.WMTSDEFAULTS['EPSG:3857'].resolutions;
                topLeftCorner = IMap.WMTSDEFAULTS['EPSG:3857'].topLeftCorner;
            } else if ([
                    'EPSG:4326',
                    'CRS:84'
                ].indexOf(mapProj.toUpperCase()) >= 0) {
                resolutions = IMap.WMTSDEFAULTS['EPSG:4326'].resolution7s;
                topLeftCorner = IMap.WMTSDEFAULTS['EPSG:4326'].topLeftCorner;
            } else if (['EPSG:2154'].indexOf(mapProj.toUpperCase()) >= 0) {
                resolutions = IMap.WMTSDEFAULTS['EPSG:2154'].resolution7s;
                topLeftCorner = IMap.WMTSDEFAULTS['EPSG:2154'].topLeftCorner;
            }
            if (resolutions) {
                wmtsOpts.resolutions = resolutions;
                wmtsOpts.topLeftCorner = topLeftCorner;
            }
            return wmtsOpts;
        },
        centerGeocode: function (opts) {
            if (!Gp.Config || !this.apiKey) {
                console.log('no rights for geocoding services');
                return;
            }
            var layersIds = Gp.Config.getLayersId(this.apiKey);
            var locTypes = opts.locationType || [
                'StreetAddress',
                'PositionOfInterest'
            ];
            var fo = {};
            fo.type = [];
            while (locTypes.length > 0) {
                var lt = locTypes.pop();
                if (layersIds.indexOf(lt + '$OGC:OPENLS;Geocode') >= 0) {
                    fo.type.push(lt);
                }
            }
            if (fo.type.length == 0) {
                console.log('no rights for geocoding services');
                return;
            }
            var map = this;
            Gp.Services.geocode({
                apiKey: this.apiKey,
                location: opts.location,
                filterOptions: fo,
                onSuccess: function (geocodeResponse) {
                    var point = {
                        x: geocodeResponse.locations[0].position.y,
                        y: geocodeResponse.locations[0].position.x,
                        projection: 'EPSG:4326'
                    };
                    map.setAutoCenter(point);
                    var e = IMap.CustomEvent('located', { detail: { position: point } });
                    map.div.dispatchEvent(e);
                },
                onFailure: function (error) {
                    console.log('Erreur du service de géocodage !!!');
                }
            });
        },
        centerGeolocate: function () {
            var map = this;
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var point = {
                        x: position.coords.longitude,
                        y: position.coords.latitude,
                        projection: 'EPSG:4326'
                    };
                    map.setAutoCenter(point, 17);
                    var e = IMap.CustomEvent('geolocated', { detail: { position: point } });
                    map.div.dispatchEvent(e);
                }, function (error) {
                    var info = 'Erreur lors de la géolocalisation : ';
                    switch (error.code) {
                    case error.TIMEOUT:
                        info += 'Timeout !';
                        break;
                    case error.PERMISSION_DENIED:
                        info += 'Vous n\u2019avez pas donné la permission';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        info += 'La position n\u2019a pu être déterminée';
                        break;
                    case error.UNKNOWN_ERROR:
                        info += 'Erreur inconnue';
                        break;
                    }
                    console.log(info);
                });
            } else {
                console.log('Geolocate impossible');
            }
        },
        setProxy: function (url) {
            return Gp.ProxyUtils.proxifyUrl(url, this.mapOptions);
        },
        getProjection: function () {
            return '';
        },
        getCenter: function () {
            return {};
        },
        getViewExtent: function () {
            return {};
        },
        getTilt: function () {
            return 0;
        },
        getAzimuth: function () {
            return 0;
        },
        getZoom: function () {
            return 0;
        },
        getResolution: function () {
            return 0;
        },
        getLib: function () {
            return this.mapOptions.library;
        },
        _getLayersObj: function (layerIds) {
            var _layerObjs = [];
            this._layers.forEach(function (layer, i, array) {
                if (layerIds.indexOf(layer.id) < 0) {
                    return;
                }
                _layerObjs.push(layer);
            }, this);
            return _layerObjs;
        },
        getLayersOptions: function (layerIds) {
            if (!layerIds || Array.isArray(layerIds) && layerIds.length == 0) {
                layerIds = [];
                this._layers.forEach(function (layer) {
                    layerIds.push(layer.id);
                }, this);
            }
            var layersOptions = {};
            this._layers.sort(function (l1, l2) {
                return l1.options.position - l2.options.position;
            });
            if (!Array.isArray(layerIds)) {
                layerIds = [layerIds];
            }
            this._layers.forEach(function (layer) {
                if (layerIds.indexOf(layer.id) < 0) {
                    return;
                }
                layersOptions[layer.id] = layer.options;
            }, this);
            return layersOptions;
        },
        getControlsOptions: function (controlIds) {
            if (!controlIds || Array.isArray(controlIds) && controlIds.length == 0) {
                controlIds = [];
                this._controls.forEach(function (control) {
                    controlIds.push(control.id);
                }, this);
            }
            var controlsOptions = {};
            if (!Array.isArray(controlIds)) {
                controlIds = [controlIds];
            }
            this._controls.forEach(function (control) {
                if (controlIds.indexOf(control.id) < 0) {
                    return;
                }
                controlsOptions[control.id] = control.options;
            }, this);
            return controlsOptions;
        },
        getLibMapControl: function (controlId) {
            var olControl = null;
            return olControl;
        },
        getLibMap: function () {
            return {};
        },
        setProjection: function (projection) {
        },
        setCenter: function (center) {
            if (!center) {
                return;
            }
            if (center.hasOwnProperty('x') && center.hasOwnProperty('y')) {
                this.setXYCenter(center);
            }
            if (center.geolocate) {
                this.centerGeolocate();
            }
            if (center.location && center.location.trim().length > 0) {
                this.centerGeocode(center);
            }
        },
        setXYCenter: function (point) {
        },
        setAutoCenter: function (point) {
        },
        setTilt: function (tilt) {
        },
        setAzimuth: function (azimuth) {
        },
        setZoom: function (zoom) {
        },
        setResolution: function (resolution) {
        },
        zoomIn: function () {
        },
        zoomOut: function () {
        },
        switchToLib: function (library) {
            var oldMap = {};
            oldMap.projection = this.getProjection();
            oldMap.center = this.getCenter();
            oldMap.azimuth = this.getAzimuth();
            oldMap.tilt = this.getTilt();
            oldMap.zoom = this.getZoom();
            oldMap.layersOptions = this.getLayersOptions();
            oldMap.controlsOptions = this.getControlsOptions();
            oldMap.mapDiv = this.div.id;
            oldMap.apiKey = this.apiKey;
            oldMap.enginePath3d = this.mapOptions.enginePath3d || null;
            for (var controlId in oldMap.controlsOptions) {
                this.removeControls(controlId);
            }
            if (library === 'vg') {
                oldMap.center = [
                    oldMap.center.x,
                    oldMap.center.y
                ];
                var lonlat = ol.proj.transform(oldMap.center, oldMap.projection, 'EPSG:4326');
                oldMap.center = {
                    x: lonlat[0],
                    y: lonlat[1]
                };
                this.libMap.setTarget(null);
            } else if (library === 'ol3') {
                oldMap.center = [
                    oldMap.center.lon,
                    oldMap.center.lat
                ];
                var xy = ol.proj.transform(oldMap.center, 'EPSG:4326', 'EPSG:3857');
                oldMap.center = {
                    x: xy[0],
                    y: xy[1]
                };
                this.libMap.dispose();
            } else {
                console.log('Unknown Library');
                return;
            }
            var newMap = Gp.Map.load(oldMap.mapDiv, {
                apiKey: oldMap.apiKey,
                enginePath3d: oldMap.enginePath3d || null,
                projection: oldMap.projection,
                center: oldMap.center,
                azimuth: oldMap.azimuth,
                tilt: oldMap.tilt,
                zoom: oldMap.zoom,
                library: library,
                layersOptions: oldMap.layersOptions,
                controlsOptions: oldMap.controlsOptions
            });
            return newMap;
        },
        switchToLibITOL3: function (library) {
            var oldMap = {};
            oldMap.projection = this.getProjection();
            oldMap.center = this.getCenter();
            oldMap.tilt = this.getTilt();
            oldMap.azimuth = this.getAzimuth();
            oldMap.zoom = this.getZoom();
            oldMap.layersOptions = this.getLayersOptions();
            oldMap.controlsOptions = this.getControlsOptions();
            oldMap.mapDiv = this.div.id;
            oldMap.apiKey = this.apiKey;
            oldMap.enginePath3d = this.mapOptions.enginePath3d || null;
            for (var controlId in oldMap.controlsOptions) {
                this.removeControls(controlId);
            }
            if (library === 'itowns') {
                oldMap.center = [
                    oldMap.center.x,
                    oldMap.center.y
                ];
                var lonlat = ol.proj.transform(oldMap.center, oldMap.projection, 'EPSG:4326');
                oldMap.center = {
                    x: lonlat[0],
                    y: lonlat[1]
                };
                oldMap.azimuth = this.getAzimuth() + 90;
                this.libMap.setTarget(null);
            } else if (library === 'ol3') {
                oldMap.center = [
                    oldMap.center.lon,
                    oldMap.center.lat
                ];
                var xy = ol.proj.transform(oldMap.center, 'EPSG:4326', 'EPSG:3857');
                oldMap.center = {
                    x: xy[0],
                    y: xy[1]
                };
                for (var listeners in this._events) {
                    var keyIdx = 0;
                    var eventName = Object.keys(this._events)[keyIdx];
                    for (var i = 0; i < this._events[listeners].length; i++) {
                        this.forget(eventName, this._events[listeners][i].action);
                    }
                    keyIdx++;
                }
                while (this.div.firstChild) {
                    this.div.removeChild(this.div.firstChild);
                }
            } else {
                console.log('Unknown Library');
                return;
            }
            var newMap = Gp.Map.load(oldMap.mapDiv, {
                apiKey: oldMap.apiKey,
                enginePath3d: oldMap.enginePath3d || null,
                projection: oldMap.projection,
                center: oldMap.center,
                azimuth: oldMap.azimuth,
                tilt: oldMap.tilt,
                zoom: oldMap.zoom,
                library: library,
                layersOptions: oldMap.layersOptions,
                controlsOptions: oldMap.controlsOptions
            });
            return newMap;
        },
        _addMarkers: function (markersOptions) {
        },
        addLayers: function (layersOptions) {
            if (!layersOptions) {
                return;
            }
            this.listen('layerChanged', this._onLayerChanged, this);
            var layerId = null;
            for (layerId in layersOptions) {
                if (this._getLayersObj([layerId]).length > 0) {
                    console.log('Layer [' + layerId + '] already added to map.');
                    return;
                }
                var layerOpts = layersOptions[layerId];
                var addLayerParam = {};
                addLayerParam[layerId] = layerOpts;
                if (!layerOpts.hasOwnProperty('url') && Gp.Config) {
                    var format = null;
                    if (layerOpts && layerOpts.format) {
                        format = layerOpts.format;
                    }
                    var layerConf = null;
                    if (format == null || format.toUpperCase() == 'WMTS') {
                        layerConf = Gp.Config.getLayerConf(layerId + '$GEOPORTAIL:OGC:WMTS');
                        if (layerConf) {
                            format = 'WMTS';
                        }
                    }
                    if (format == null || format.toUpperCase() == 'WMS') {
                        layerConf = Gp.Config.getLayerConf(layerId + '$GEOPORTAIL:OGC:WMS');
                        if (layerConf) {
                            format = 'WMS';
                        } else {
                            layerConf = Gp.Config.getLayerConf(layerId + '$INSPIRE:OGC:WMS');
                            if (layerConf) {
                                format = 'WMS';
                            }
                        }
                    }
                    if (layerConf) {
                        addLayerParam[layerId].format = format;
                        addLayerParam[layerId].originators = addLayerParam[layerId].originators || layerConf.originators;
                        addLayerParam[layerId] = this._layerOptions2layerConf(layerConf, addLayerParam[layerId]);
                    }
                    switch (format) {
                    case 'WMTS':
                    case 'WMS':
                        this._addGeoportalLayer(addLayerParam, layerConf);
                        continue;
                    default:
                    }
                }
                if (!layerOpts.hasOwnProperty('format') || typeof layerOpts.format != 'string') {
                    console.log('Impossible to add layer [' + layerId + '] : no format given');
                    continue;
                }
                if (!layerOpts.hasOwnProperty('url') || typeof layerOpts.url != 'string') {
                    console.log('Impossible to add layer [' + layerId + '] : no url given');
                    continue;
                }
                if (!this._checkLayerParams(layerOpts)) {
                    console.log('Impossible to add layer [' + layerId + '] : unsufficient or inadapted parameters given');
                    continue;
                }
                switch (layerOpts.format.toUpperCase()) {
                case 'georss':
                    break;
                case 'KML':
                case 'GPX':
                case 'GEOJSON':
                case 'WFS':
                case 'DRAWING':
                    this._addVectorLayer(addLayerParam);
                    break;
                case 'WMS':
                case 'WMTS':
                case 'OSM':
                case 'VIRTUALGEO':
                    this._addRasterLayer(addLayerParam);
                    break;
                default:
                    console.log('Impossible to add layer [' + layerId + '] : unhandled format [' + layerOpts.format + ']');
                    break;
                }
            }
            this._resetLayerChangedEvent();
        },
        _checkLayerParams: function (layerOpts) {
            var missingParams = [];
            switch (layerOpts.format.toUpperCase()) {
            case 'WMS':
                if (!layerOpts.hasOwnProperty('layers') || !(layerOpts.layers instanceof Array)) {
                    missingParams.push('layers');
                }
                break;
            case 'WMTS':
                if (!layerOpts.hasOwnProperty('layer') || typeof layerOpts.layer != 'string') {
                    missingParams.push('layer');
                }
                if (!layerOpts.hasOwnProperty('tileMatrixSet') || typeof layerOpts.tileMatrixSet != 'string') {
                    missingParams.push('tileMatrixSet');
                }
                if (!layerOpts.hasOwnProperty('styleName') || typeof layerOpts.styleName != 'string') {
                    missingParams.push('styleName');
                }
                break;
            case 'WFS':
                if (!layerOpts.hasOwnProperty('typeNames') || typeof layerOpts.typeNames != 'string') {
                    missingParams.push('typeNames');
                }
                break;
            }
            if (missingParams.length > 0) {
                console.log('Impossible to add ' + layerOpts.format + ' layer : missing mandatory parameter(s) : ' + missingParams.toString());
                return false;
            }
            return true;
        },
        _addRasterLayer: function (layerObj) {
        },
        _addVectorLayer: function (layerObj) {
        },
        _addGeoportalLayer: function (layerObj) {
        },
        removeLayers: function (layerIds) {
            if (!layerIds || Array.isArray(layerIds) && layerIds.length == 0) {
                console.log('removeLayers : nothing to remove !');
                return false;
            }
            if (!Array.isArray(layerIds)) {
                layerIds = [layerIds];
            }
            return true;
        },
        _applyCommonLayerParams: function (layerOpts) {
            return {};
        },
        modifyLayers: function (layersOptions) {
            if (!layersOptions) {
                console.log('modifyLayers : nothing to modify !');
                return false;
            }
            var layerIds = Object.keys(layersOptions);
            if (!layerIds || !Array.isArray(layerIds)) {
                console.log('modifyLayers : wrong format for layersOptions !');
                return false;
            }
            return true;
        },
        _findRegisteredControl: function (controlId) {
            var regCtrl = -1;
            if (!controlId || typeof controlId != 'string') {
                return regCtrl;
            }
            for (var i = 0; i < this._controls.length; i++) {
                if (this._controls[i].id.toLowerCase() == controlId.toLowerCase()) {
                    return i;
                }
            }
            return regCtrl;
        },
        addControls: function (controlsOptions) {
            var controlId = null;
            for (controlId in controlsOptions) {
                var controlObj = null;
                var controlOpts = controlsOptions[controlId];
                var idx = -1;
                var libControl = this.getLibMapControl(controlId);
                idx = this._findRegisteredControl(controlId);
                if (idx >= 0 || libControl) {
                    this.removeControls([controlId]);
                    if (controlOpts === null || controlOpts === undefined) {
                        continue;
                    }
                }
                switch (controlId.toLowerCase()) {
                case 'draggable':
                    controlObj = this.setDraggable(controlOpts);
                    break;
                case 'keyboard':
                    controlObj = this.setKeyboard(controlOpts);
                    break;
                case 'selectable':
                    controlObj = this.setSelectable(controlOpts);
                    break;
                case 'zoom':
                    controlObj = this.addZoomControl(controlOpts);
                    break;
                case 'zoombox':
                    controlObj = this._addZoomBoxControl(controlOpts);
                    break;
                case 'overview':
                    controlObj = this.addOverviewControl(controlOpts);
                    break;
                case 'orientation':
                    controlObj = this.addOrientationControl(controlOpts);
                    break;
                case 'graphicscale':
                    controlObj = this.addGraphicScaleControl(controlOpts);
                    break;
                case 'mouseposition':
                    controlObj = this.addMousePositionControl(controlOpts);
                    break;
                case 'route':
                    controlObj = this.addRouteControl(controlOpts);
                    break;
                case 'isocurve':
                    controlObj = this.addIsocurveControl(controlOpts);
                    break;
                case 'graticule':
                    controlObj = this.addGraticuleControl(controlOpts);
                    break;
                case 'layerswitcher':
                    controlObj = this.addLayerSwitcherControl(controlOpts);
                    break;
                case 'layerimport':
                    controlObj = this.addLayerImportControl(controlOpts);
                    break;
                case 'length':
                    controlObj = this.addLengthControl(controlOpts);
                    break;
                case 'area':
                    controlObj = this.addAreaControl(controlOpts);
                    break;
                case 'azimuth':
                    controlObj = this.addAzimuthControl(controlOpts);
                    break;
                case 'elevationpath':
                    controlObj = this.addElevationPathControl(controlOpts);
                    break;
                case 'search':
                    controlObj = this.addSearchControl(controlOpts);
                    break;
                case 'reversesearch':
                    controlObj = this.addReverseSearchControl(controlOpts);
                    break;
                case 'drawing':
                    controlObj = this.addDrawingControl(controlOpts);
                    break;
                case 'attributions':
                    controlObj = this.addAttributionsControl(controlOpts);
                    break;
                case 'camera':
                    controlObj = this.addCameraControl(controlOpts);
                    break;
                case 'getfeatureinfo':
                    controlObj = this.addGetFeatureInfoControl(controlOpts);
                    break;
                default:
                    console.log('Controle ' + controlId + 'inconnu.');
                }
                if (controlObj) {
                    this._controls.push({
                        obj: controlObj,
                        id: controlId.toLowerCase(),
                        options: controlOpts
                    });
                }
            }
        },
        setDraggable: function (controlOpts) {
        },
        setKeyboard: function (controlOpts) {
        },
        setSelectable: function (controlOpts) {
        },
        addZoomControl: function (controlOpts) {
        },
        addZoomBoxControl: function (controlOpts) {
        },
        addOverviewControl: function (controlOpts) {
        },
        addOrientationControl: function (controlOpts) {
        },
        addGraphicScaleControl: function (controlOpts) {
        },
        addMousePositionControl: function (controlOpts) {
        },
        addRouteControl: function (controlOpts) {
        },
        addIsocurveControl: function (controlOpts) {
        },
        addGraticuleControl: function (controlOpts) {
        },
        addLayerSwitcherControl: function (controlOpts) {
        },
        addLayerImportControl: function (controlOpts) {
        },
        addLengthControl: function (controlOpts) {
        },
        addAreaControl: function (controlOpts) {
        },
        addAzimuthControl: function (controlOpts) {
        },
        addElevationPathControl: function (controlOpts) {
        },
        addSearchControl: function (controlOpts) {
        },
        addReverseSearchControl: function (controlOpts) {
        },
        addDrawingControl: function (controlOpts) {
        },
        addAttributionsControl: function (controlOpts) {
        },
        addCameraControl: function (controlOpts) {
        },
        addGetFeatureInfoControl: function (controlOpts) {
        },
        removeControls: function (controlIds) {
        },
        modifyControls: function (controlsOptions) {
            var controlIds = Object.keys(controlsOptions);
            if (!controlIds || controlIds.length == 0) {
                console.log('No control to modify.');
                return;
            }
            var controlId = null;
            for (var i = 0; i < controlIds.length; i++) {
                controlId = controlIds[i];
                var controlObj = this.getLibMapControl(controlId);
                var idx = this._findRegisteredControl(controlId);
                if (idx >= 0) {
                    if (!controlObj) {
                        this.removeControls([controlId]);
                        delete controlsOptions[controlId];
                        continue;
                    }
                    var newCtrlOptions = this._controls[idx].options;
                    for (var opt in controlsOptions[controlId]) {
                        newCtrlOptions[opt] = controlsOptions[controlId][opt];
                    }
                    controlsOptions[controlId] = newCtrlOptions;
                } else if (!controlObj) {
                    delete controlsOptions[controlId];
                    continue;
                }
            }
            this.addControls(controlsOptions);
        },
        _getLayerIndexByLayerOpts: function (layerOpts) {
            if (!layerOpts) {
                return -1;
            }
            for (var i = 0; i < this._layers.length; i++) {
                var l = this._layers[i];
                if (layerOpts.hasOwnProperty(l.id)) {
                    return i;
                }
            }
            return -1;
        },
        _getLayerIndexByLayerId: function (layerId) {
            for (var i = 0; i < this._layers.length; i++) {
                var l = this._layers[i];
                if (layerId === l.id) {
                    return i;
                }
            }
            return -1;
        },
        _addLayerConfToLayerSwitcher: function (layerReg, layerConf) {
        },
        _onLayerChanged: function (evt) {
            var layerOpts = null;
            var idx = -1;
            var layerId = null;
            if (evt.hasOwnProperty('layerAdded')) {
                layerOpts = evt.layerAdded;
                idx = this._getLayerIndexByLayerOpts(layerOpts);
                if (idx >= 0 && idx < this._layers.length) {
                    layerId = this._layers[idx].id;
                    this._layers[idx].options.position = evt.position;
                } else {
                }
            } else if (evt.hasOwnProperty('layerRemoved')) {
                layerOpts = evt.layerRemoved;
                idx = this._getLayerIndexByLayerOpts(layerOpts);
                if (idx >= 0 && idx < this._layers.length) {
                    var layerRemoved = {};
                    layerRemoved['id'] = this._layers[idx].id;
                    layerRemoved['options'] = this._layers[idx].options;
                    layerRemoved['obj'] = this._layers[idx].obj;
                    this._layersRemoved.push(layerRemoved);
                    this._layers.splice(idx, 1);
                } else {
                }
            } else if (evt.hasOwnProperty('layerChanged')) {
                layerOpts = evt.layerChanged;
                var idxx = this._getLayerIndexByLayerOpts(layerOpts);
                if (idxx >= 0 && idxx < this._layers.length) {
                    layerId = this._layers[idxx].id;
                    this._layers[idxx].options[evt.property] = evt.newValue;
                } else {
                }
            }
        },
        _filterEmptyMetadata: function (metadata) {
            if (!metadata || !Array.isArray(metadata)) {
                return metadata;
            }
            var fullMetadata = [];
            for (var i = 0; i < metadata.length; i++) {
                if (metadata[i].url && metadata[i].url.trim().length > 0) {
                    fullMetadata.push(metadata[i]);
                }
            }
            return fullMetadata;
        },
        _layerOptions2layerConf: function (layerOptions, layerConf) {
            var lConf = layerConf || {};
            lConf.title = lConf.title || layerOptions.title;
            lConf.description = lConf.description || layerOptions.description;
            lConf.quicklookUrl = lConf.quicklookUrl || layerOptions.quicklookUrl;
            lConf.legends = lConf.legends || layerOptions.legends;
            lConf.metadata = lConf.metadata || layerOptions.metadata;
            lConf.metadata = this._filterEmptyMetadata(lConf.metadata);
            return lConf;
        },
        getLSLayerContainerDivId: function (layerId) {
            var id = null;
            return id;
        },
        _registerEvent: function (eventKey, eventId, action, context) {
            if (eventKey) {
                if (!this._events.hasOwnProperty(eventId)) {
                    this._events[eventId] = [];
                }
                this._events[eventId].push({
                    action: action,
                    key: eventKey,
                    context: context
                });
            }
            return this._events[eventId][this._events[eventId].length - 1];
        },
        listen: function (eventId, action, context) {
            if (typeof action != 'function') {
                console.log('no action provided for event : ' + eventId);
                return false;
            }
            context = context || this;
            var map = this;
            switch (eventId) {
            case 'mapFailure':
                break;
            case 'mapLoaded':
            case 'geolocated':
            case 'located':
            case 'configured':
                var callBack = function (evt) {
                    action.call(context, evt.detail);
                };
                var registredEvent = map._registerEvent(callBack, eventId, action, context);
                registredEvent.eventOrigin = this.div;
                registredEvent.eventType = eventId;
                registredEvent.eventOrigin.addEventListener(registredEvent.eventType, callBack, this);
                break;
            case 'centerChanged':
            case 'zoomChanged':
            case 'azimuthChanged':
            case 'tiltChanged':
            case 'layerChanged':
                break;
            case 'projectionChanged':
            case 'controlChanged':
                break;
            default:
                console.log('unhandled event : ' + eventId);
                return false;
            }
            return true;
        },
        forget: function (eventId, action) {
            if (typeof action != 'function') {
                console.log('no action provided for event : ' + eventId);
                return false;
            }
            switch (eventId) {
            case 'mapLoaded':
            case 'geolocated':
            case 'located':
            case 'configured':
            case 'mapFailure':
            case 'centerChanged':
            case 'zoomChanged':
            case 'azimuthChanged':
            case 'tiltChanged':
            case 'projectionChanged':
            case 'layerChanged':
            case 'controlChanged':
            case 'pickFeature':
                var rEvents = this._events[eventId];
                if (!rEvents) {
                    console.log('nothing to forget for  : ' + eventId);
                    return false;
                }
                var itCallback = null;
                for (var i = rEvents.length - 1; i >= 0; i--) {
                    if (rEvents[i].action == action) {
                        if (!rEvents[i].eventOrigin) {
                            continue;
                        }
                        itCallback = rEvents[i].key;
                        var eventOrigin = rEvents[i].eventOrigin;
                        var eventType = rEvents[i].eventType;
                        if (!itCallback) {
                            console.log('action to forget not found for  : ' + eventId);
                            return false;
                        }
                        rEvents.splice(i, 1);
                        eventOrigin.removeEventListener(eventType, itCallback);
                    }
                }
                if (!rEvents) {
                    console.log('action to forget not found for  : ' + eventId);
                    return false;
                }
                break;
            default:
                console.log('unhandled event : ' + eventId);
                return false;
            }
            return true;
        },
        _resetLayerChangedEvent: function () {
            if (this._events.hasOwnProperty('layerChanged')) {
                var actions = [];
                var contexts = [];
                this._events['layerChanged'].forEach(function (eventObj) {
                    if (actions.indexOf(eventObj.action) < 0) {
                        actions.push(eventObj.action);
                        contexts.push(eventObj.context);
                    }
                }, this);
                for (var i = 0; i < actions.length; ++i) {
                    this.forget('layerChanged', actions[i]);
                    this.listen('layerChanged', actions[i], contexts[i]);
                }
            }
        },
        _changeLayerColor: function (layerId, colorToGray) {
            return;
        }
    };
    return IMap;
}(UtilsLoggerByDefault);
ol3OL3 = function (Logger, ol, plugins, IMap) {
    function OL3(opts) {
        if (!(this instanceof OL3)) {
            throw new TypeError('OL3 constructor cannot be called as a function.');
        }
        this.CLASSNAME = 'OL3';
        IMap.apply(this, arguments);
    }
    OL3.LAYERPROPERTIES = {
        visible: 'visibility',
        opacity: 'opacity',
        zIndex: 'position',
        grayScaled: 'grayScaled',
        minResolution: 'maxZoom',
        maxResolution: 'minZoom'
    };
    OL3.CONTROLPROPERTIES = { maximised: 'collapsed' };
    OL3.CONTROLSCLASSES = {
        draggable: [
            ol.interaction.Pointer,
            ol.interaction.MouseWheelZoom,
            ol.interaction.DoubleClickZoom
        ],
        keyboard: [
            ol.interaction.KeyboardPan,
            ol.interaction.KeyboardZoom
        ],
        scrollwheel: null,
        selectable: [ol.interaction.Select],
        zoom: ol.control.Zoom,
        zoombox: null,
        overview: ol.control.OverviewMap,
        orientation: ol.control.Rotate,
        graphicscale: ol.control.ScaleLine,
        getfeatureinfo: ol.control.GetFeatureInfo,
        mouseposition: ol.control.GeoportalMousePosition,
        route: ol.control.Route,
        layerswitcher: ol.control.LayerSwitcher,
        layerimport: ol.control.LayerImport,
        isocurve: ol.control.Isocurve,
        length: ol.control.MeasureLength,
        area: ol.control.MeasureArea,
        azimuth: ol.control.MeasureAzimuth,
        elevationpath: ol.control.ElevationPath,
        graticule: ol.Graticule,
        search: ol.control.SearchEngine,
        reversesearch: ol.control.ReverseGeocode,
        drawing: ol.control.Drawing,
        attributions: ol.control.GeoportalAttribution,
        camera: null
    };
    OL3.prototype = Object.create(IMap.prototype, {});
    OL3.prototype.constructor = OL3;
    OL3.prototype._initMap = function () {
        var view = new ol.View({
            enableRotation: this.mapOptions.enableRotation,
            zoom: this.mapOptions.zoom,
            minZoom: this.mapOptions.minZoom,
            maxZoom: this.mapOptions.maxZoom,
            projection: this.mapOptions.projection,
            rotation: this.mapOptions.azimuth * Math.PI / 180
        });
        this.libMap = new ol.Map({
            target: this.div,
            view: view
        });
        this._afterInitMap();
    };
    OL3.prototype._toggleInteractions = function (controlId, controlOpts) {
        var interactions = this.getLibMapControl(controlId);
        if (interactions == null) {
            interactions = [];
            for (var i = 0; i < OL3.CONTROLSCLASSES[controlId].length; i++) {
                var interaction = new OL3.CONTROLSCLASSES[controlId][i]();
                this.libMap.addInteraction(interaction);
                interactions.push(interaction);
            }
        }
        for (var ii = 0; ii < interactions.length; ii++) {
            var _interaction = interactions[ii];
            _interaction.setActive(controlOpts);
        }
        return interactions;
    };
    OL3.prototype.setDraggable = function (controlOpts) {
        return this._toggleInteractions('draggable', controlOpts);
    };
    OL3.prototype.setKeyboard = function (controlOpts) {
        return this._toggleInteractions('keyboard', controlOpts);
    };
    OL3.prototype.setSelectable = function (controlOpts) {
        return this._toggleInteractions('selectable', controlOpts);
    };
    OL3.prototype.addZoomControl = function (controlOpts) {
        var control = new ol.control.Zoom({ target: controlOpts.div });
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype.addZoomBoxControl = function (controlOpts) {
        return null;
    };
    OL3.prototype.addOverviewControl = function (controlOpts) {
        var ovOpts = {};
        if (controlOpts.div) {
            ovOpts.target = controlOpts.div;
        }
        ovOpts.collapsed = controlOpts.maximised ? false : true;
        if (controlOpts.layers && Array.isArray(controlOpts.layers)) {
            var layerObjs = this._getLayersObj(controlOpts.layers);
            var olLayers = [];
            layerObjs.forEach(function (layerObj) {
                olLayers.push(layerObj.obj);
            }, this);
            if (olLayers.length == 0 && controlOpts.layers.length > 0) {
                for (var i = 0; i < controlOpts.layers.length; i++) {
                    var gpLayer = new ol.layer.GeoportalWMTS({ layer: controlOpts.layers[i] });
                    if (gpLayer) {
                        olLayers.push(gpLayer);
                    }
                }
            }
            if (olLayers.length > 0) {
                ovOpts.layers = olLayers;
            }
        }
        var viewOpts = {};
        var needsView = false;
        if (controlOpts.hasOwnProperty('minZoom')) {
            viewOpts.minZoom = controlOpts.minZoom;
            needsView = true;
        }
        if (controlOpts.hasOwnProperty('maxZoom')) {
            viewOpts.maxZoom = controlOpts.maxZoom;
            needsView = true;
        }
        if (controlOpts.hasOwnProperty('projection')) {
            viewOpts.projection = controlOpts.projection;
            needsView = true;
        }
        if (needsView) {
            ovOpts.view = new ol.View(viewOpts);
        }
        var control = new ol.control.OverviewMap(ovOpts);
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype.addOrientationControl = function (controlOpts) {
        var control = new ol.control.Rotate({
            target: controlOpts.div,
            autoHide: controlOpts.autoHide || false
        });
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype.addGraphicScaleControl = function (controlOpts) {
        var ol3units = controlOpts.units;
        if (ol3units && controlOpts.units.toLowerCase() == 'deg') {
            ol3units = 'degrees';
        } else if (ol3units && controlOpts.units.toLowerCase() == 'm') {
            ol3units = 'metric';
        }
        var control = new ol.control.ScaleLine({
            target: controlOpts.div,
            units: ol3units,
            minWidth: controlOpts.minWidth
        });
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype.addGraticuleControl = function (controlOpts) {
        var options = controlOpts || {};
        options.strokeColor = options.strokeColor || '#000000';
        options.strokeOpacity = options.strokeOpacity || 0.2;
        options.strokeWidth = options.strokeWidth || 1;
        var rgba = IMap._hexToRgba(options.strokeColor, options.strokeOpacity);
        var graticule = new ol.Graticule({
            strokeStyle: new ol.style.Stroke({
                color: rgba,
                width: options.strokeWidth
            })
        });
        graticule.setMap(this.libMap);
        this.libMap.graticule = graticule;
        return graticule;
    };
    OL3.prototype.addMousePositionControl = function (controlOpts) {
        var mpOpts = {};
        if (controlOpts.div) {
            mpOpts.target = controlOpts.div;
        }
        mpOpts.collapsed = controlOpts.maximised ? false : true;
        if (controlOpts.systems && Array.isArray(controlOpts.systems) && controlOpts.systems.length > 0) {
            for (var i = 0; i < controlOpts.systems.length; i++) {
                if (!ol.proj.get(controlOpts.systems[i].crs)) {
                    continue;
                }
                if (!mpOpts.systems) {
                    mpOpts.systems = [];
                }
                mpOpts.systems.push(controlOpts.systems[i]);
            }
        }
        if (controlOpts.units && Array.isArray(controlOpts.units) && controlOpts.units.length > 0) {
            mpOpts.units = [];
            for (var ii = 0; ii < controlOpts.units.length; ii++) {
                if (typeof controlOpts.units[ii] == 'string') {
                    mpOpts.units.push(controlOpts.units[ii]);
                }
            }
        }
        mpOpts.displayAltitude = controlOpts.displayAltitude;
        mpOpts.displayCoordinates = controlOpts.displayCoordinates;
        if (controlOpts.altitude) {
            mpOpts.altitude = controlOpts.altitude;
        }
        mpOpts.editCoordinates = controlOpts.editCoordinates;
        mpOpts.positionMarker = controlOpts.positionMarker;
        var control = new ol.control.GeoportalMousePosition(mpOpts);
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype.addRouteControl = function (controlOpts) {
        var rteOpts = {};
        if (controlOpts.div) {
            rteOpts.target = controlOpts.div;
        }
        rteOpts.collapsed = controlOpts.maximised ? false : true;
        if (controlOpts.graphs) {
            rteOpts.graphs = controlOpts.graphs;
        }
        if (controlOpts.exclusions) {
            rteOpts.exclusions = controlOpts.exclusions;
        }
        if (controlOpts.markersOpts) {
            rteOpts.markersOpts = {};
            if (controlOpts.markersOpts.departure) {
                rteOpts.markersOpts.departure = controlOpts.markersOpts.departure;
            }
            if (controlOpts.markersOpts.stages) {
                rteOpts.markersOpts.stages = controlOpts.markersOpts.stages;
            }
            if (controlOpts.markersOpts.arrival) {
                rteOpts.markersOpts.arrival = controlOpts.markersOpts.arrival;
            }
        }
        if (controlOpts.routeOptions) {
            rteOpts.routeOptions = controlOpts.routeOptions;
        }
        if (controlOpts.autocompleteOptions) {
            rteOpts.autocompleteOptions = controlOpts.autocompleteOptions;
        }
        var control = new ol.control.Route(rteOpts);
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype.addIsocurveControl = function (controlOpts) {
        var isoOpts = {};
        if (controlOpts.div) {
            isoOpts.target = controlOpts.div;
        }
        isoOpts.collapsed = controlOpts.maximised ? false : true;
        if (controlOpts.graphs) {
            isoOpts.graphs = controlOpts.graphs;
        }
        if (controlOpts.exclusions) {
            isoOpts.exclusions = controlOpts.exclusions;
        }
        if (controlOpts.methods) {
            isoOpts.methods = controlOpts.methods;
        }
        if (controlOpts.directions) {
            isoOpts.directions = controlOpts.directions;
        }
        if (controlOpts.markerOpts) {
            isoOpts.markerOpts = controlOpts.markerOpts;
        }
        if (controlOpts.isocurveOptions) {
            isoOpts.isocurveOptions = controlOpts.isocurveOptions;
        }
        if (controlOpts.autocompleteOptions) {
            isoOpts.autocompleteOptions = controlOpts.autocompleteOptions;
        }
        var control = new ol.control.Isocurve(isoOpts);
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype.addLayerImportControl = function (controlOpts) {
        var importOpts = {};
        if (controlOpts.div) {
            importOpts.target = controlOpts.div;
        }
        importOpts.collapsed = controlOpts.maximised ? false : true;
        if (controlOpts.layerTypes) {
            importOpts.layerTypes = controlOpts.layerTypes;
        }
        importOpts.webServicesOptions = {};
        if (controlOpts.webServicesOptions) {
            importOpts.webServicesOptions = controlOpts.webServicesOptions;
        } else {
            if (this.mapOptions && this.mapOptions.proxyUrl) {
                importOpts.webServicesOptions.proxyUrl = this.mapOptions.proxyUrl;
            }
            if (this.mapOptions && this.mapOptions.noProxyDomains) {
                importOpts.webServicesOptions.noProxyDomains = this.mapOptions.noProxyDomains;
            }
        }
        if (controlOpts.defaultStyles) {
            importOpts.vectorStyleOptions = {};
            var defaultMarkerSrc = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAmCAYAAABpuqMCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAARDSURBVFiF3ZndaxxVGMZ/Z/YjX00Nadpo1qrFBgu56D9QbAtiLoRC7ywSNK1NURRREBKRFlSwFBW0gnSrJXY1CmISgyjFiyYSFC9ajE3MmpjdjWlMUtNos9lN9mteLzbRuCbZmTMTBB+Yi51znvd5n3nPnjnnjBIR/i/wuh4xpCpI0ojiENAA1AE1wCzwKzCE0EM5l2iShJvSyrXKnFVb8dOK4hmg3AIjifAmaU7ztMy7kYI7Zs6rQwjvka+AXcyiOMZx6XGahuE0AEHVitCFnhGAGoQugqrVaSrOKpNP4FWnSaxCGy1yWpesbyY/tLpwo7p/w0RxWHfI6Zk5q7ZSwhj6Q2sjzJLiXp1JQe+p+mllc4wA1CzHtw37lQmpCha5gbXpVxdJythh9z1kvzJJGrFixPBmOXixl+Z4mONmguZ4mIMXezG8WQsq5cs6tmDfTP7NXiSqN0vTzBD1TQfwbdmDUhX4tuyhvukATTNDlgxZ0SmUtUsgv0TZGPsv9FNSvXfNtpLqvey/0O+KTgF0zNQV7XHP4dsdtVvVKYCOmeqiPbwVOx21W9UpgI6ZWNEe2cSEo3arOgWwb0YYLp5G17Sjdqs6BdCZzYqL9B3dR2puYM221NwAfUf3uaJTAB0zaye5GmbWS6i2gdFQL5mFMCIJMgthRkO9hGobMLPFN4VWdAoptlcAQeUDRoG77YrZwDhQT4tk7JDsV6ZFMggv2+bZwyt2jYDuQnOa94GIFrc4IkzRrkPUM3NKsijatLjF0copsbJ++xec7TTPqw6EI/oB/glT+PC+13Y/aSQNv/Is+tNer09lMn7DMHwAYppp8fvTIpISkVQsFrslqww4M9OuqkgzANzl1MhCyrjZGAycm573pK1yFCyi5FoWvo/FYlPOT2fOqftRXMbB9lkEs+3zbe2f/FD5i3YMj2p3vn8/IV8DZ5yE+Gqkot+JEQCPada5dRhxEriiQ5ya90w+272916F+KpnJDLhjpkUy5HgESNqhZU2Vfr5ne+dSFtOBeso06J6cnEy6d0z0hPwEPGeH8sGVykvfjpfe1NZUci2+mHg7Go2G8z/d/goQVJ9B8S1veMYffujduo/thl+ZwUzDuBqJRGZWt7n/FcDH46lFNVLilar1uiTTxsJTnTssH/QpJVlMNQa5wbGJiWERya3Vz30zzfLb3OveY3dU5j5dp4e80Xdbd3TOu/H/yyAtpjnqgeGS8crRQRks+v5xf5gtY/KM/6NAVebhwvv90bLvHu2o/XId2pJSMmIaxo/RaHRMxN6yZtPM0K5K/7hl/FxVZgZWbs0mPDceeKcuGE95/kpSKUmaImHDNIfHrl+PiIj2zOb+MFvBY7IUOVl2ZG9g6bJH4ckJuRe/2NYZT3myKIkrGM4pNRyLjY+LW09URDb1+uaF0pfm3zJ+7zhRGdq1c9eDuwOBOzdLa/OG2X+APwE8DU64Y/5gfAAAAABJRU5ErkJggg==';
            var strokeOpacity;
            var strokeColor;
            var fillOpacity;
            var fillColor;
            if (controlOpts.defaultStyles.KML) {
                var userKMLDefaultStyles = controlOpts.defaultStyles.KML;
                var kmldefaultStyleOptions = {};
                kmldefaultStyleOptions.image = new ol.style.Icon({
                    src: userKMLDefaultStyles.markerSrc || defaultMarkerSrc,
                    anchor: [
                        userKMLDefaultStyles.markerXAnchor || 25.5,
                        userKMLDefaultStyles.markerYAnchor || 38
                    ],
                    anchorOrigin: 'top-left',
                    anchorXUnits: 'pixels',
                    anchorYUnits: 'pixels'
                });
                strokeOpacity = userKMLDefaultStyles.strokeOpacity || 0.8;
                strokeColor = userKMLDefaultStyles.strokeColor || '#002A50';
                kmldefaultStyleOptions.stroke = new ol.style.Stroke({
                    color: IMap._hexToRgba(strokeColor, strokeOpacity),
                    width: userKMLDefaultStyles.strokeWidth || 4
                });
                fillOpacity = userKMLDefaultStyles.polyFillOpacity || 0.5;
                fillColor = userKMLDefaultStyles.polyFillColor || '#00B798';
                kmldefaultStyleOptions.fill = new ol.style.Fill({ color: IMap._hexToRgba(fillColor, fillOpacity) });
                var kmldefaultStyle = new ol.style.Style(kmldefaultStyleOptions);
                importOpts.vectorStyleOptions.KML = { defaultStyle: kmldefaultStyle };
            }
            if (controlOpts.defaultStyles.GPX) {
                var userGPXDefaultStyles = controlOpts.defaultStyles.GPX;
                var gpxdefaultStyleOptions = {};
                gpxdefaultStyleOptions.image = new ol.style.Icon({
                    src: userGPXDefaultStyles.markerSrc || defaultMarkerSrc,
                    anchor: [
                        userGPXDefaultStyles.markerXAnchor || 25.5,
                        userGPXDefaultStyles.markerYAnchor || 38
                    ],
                    anchorOrigin: 'top-left',
                    anchorXUnits: 'pixels',
                    anchorYUnits: 'pixels'
                });
                strokeOpacity = userGPXDefaultStyles.strokeOpacity || 0.8;
                strokeColor = userGPXDefaultStyles.strokeColor || '#002A50';
                gpxdefaultStyleOptions.stroke = new ol.style.Stroke({
                    color: IMap._hexToRgba(strokeColor, strokeOpacity),
                    width: userGPXDefaultStyles.strokeWidth || 4
                });
                var gpxdefaultStyle = new ol.style.Style(gpxdefaultStyleOptions);
                importOpts.vectorStyleOptions.GPX = { defaultStyle: gpxdefaultStyle };
            }
            if (controlOpts.defaultStyles.GeoJSON) {
                var userGeoJSONDefaultStyles = controlOpts.defaultStyles.GeoJSON;
                var geoJSONdefaultStyleOptions = {};
                geoJSONdefaultStyleOptions.image = new ol.style.Icon({
                    src: userGeoJSONDefaultStyles.markerSrc || defaultMarkerSrc,
                    anchor: [
                        userGeoJSONDefaultStyles.markerXAnchor || 25.5,
                        userGeoJSONDefaultStyles.markerYAnchor || 38
                    ],
                    anchorOrigin: 'top-left',
                    anchorXUnits: 'pixels',
                    anchorYUnits: 'pixels'
                });
                strokeOpacity = userGeoJSONDefaultStyles.strokeOpacity || 0.8;
                strokeColor = userGeoJSONDefaultStyles.strokeColor || '#002A50';
                geoJSONdefaultStyleOptions.stroke = new ol.style.Stroke({
                    color: IMap._hexToRgba(strokeColor, strokeOpacity),
                    width: userGeoJSONDefaultStyles.strokeWidth || 4
                });
                fillOpacity = userGeoJSONDefaultStyles.polyFillOpacity || 0.5;
                fillColor = userGeoJSONDefaultStyles.polyFillColor || '#00B798';
                geoJSONdefaultStyleOptions.fill = new ol.style.Fill({ color: IMap._hexToRgba(strokeColor, strokeOpacity) });
                var geoJSONdefaultStyle = new ol.style.Style(geoJSONdefaultStyleOptions);
                importOpts.vectorStyleOptions.GeoJSON = { defaultStyle: geoJSONdefaultStyle };
            }
        }
        var control = new ol.control.LayerImport(importOpts);
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype._addLayerConfToLayerSwitcher = function (implLayer, layerOptions) {
        var lsControl = this.getLibMapControl('layerswitcher');
        if (lsControl) {
            lsControl.addLayer(implLayer, this._layerOptions2layerConf(layerOptions));
        }
    };
    OL3.prototype.addLayerSwitcherControl = function (controlOpts) {
        var lsOpts = {
            layers: [],
            options: { collapsed: !(controlOpts && controlOpts.maximised) }
        };
        if (controlOpts.div) {
            lsOpts.options.target = controlOpts.div;
        }
        for (var i = 0; i < this._layers.length; i++) {
            var layer = this._layers[i];
            var layerConf = {
                layer: layer.obj,
                config: {}
            };
            if (layer.options.title) {
                layerConf.config.title = layer.options.title;
            }
            if (layer.options.description) {
                layerConf.config.description = layer.options.description;
            }
            if (layer.options.quicklookUrl) {
                layerConf.config.quicklookUrl = layer.options.quicklookUrl;
            }
            if (layer.options.legends) {
                layerConf.config.legends = layer.options.legends;
            }
            if (layer.options.metadata) {
                layerConf.config.metadata = this._filterEmptyMetadata(layer.options.metadata);
            }
            lsOpts.layers.push(layerConf);
        }
        var control = new ol.control.LayerSwitcher(lsOpts);
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype._fillStrokeStyles = function (stylesProps) {
        var strokeOpts = {};
        var resultStyle = null;
        if (stylesProps.hasOwnProperty('strokeLineDash')) {
            strokeOpts.lineDash = stylesProps.strokeLineDash;
        }
        if (stylesProps.hasOwnProperty('strokeColor')) {
            strokeOpts.color = stylesProps.strokeColor;
        }
        if (stylesProps.hasOwnProperty('strokeWidth')) {
            strokeOpts.width = stylesProps.strokeWidth;
        }
        if (Object.keys(strokeOpts).length > 0) {
            resultStyle = new ol.style.Stroke(strokeOpts);
        }
        return resultStyle;
    };
    OL3.prototype._fillPointerStyles = function (stylesProps) {
        var pointerOpts = {};
        if (stylesProps.hasOwnProperty('radius')) {
            pointerOpts.radius = stylesProps.radius;
        }
        pointerOpts.stroke = this._fillStrokeStyles(stylesProps);
        if (stylesProps.hasOwnProperty('fillColor')) {
            pointerOpts.fill = new ol.style.Fill({ color: stylesProps.fillColor });
        }
        var pStyle = new ol.style.Circle(pointerOpts);
        return pStyle;
    };
    OL3.prototype.addLengthControl = function (controlOpts) {
        var lengthOpts = {};
        if (controlOpts.div) {
            lengthOpts.target = controlOpts.div;
        }
        if (controlOpts.hasOwnProperty('styles')) {
            lengthOpts.styles = {};
            if (controlOpts.styles.hasOwnProperty('pointer')) {
                lengthOpts.styles.pointer = this._fillPointerStyles(controlOpts.styles.pointer);
            }
            if (controlOpts.styles.hasOwnProperty('start')) {
                var startOpts = {};
                startOpts.stroke = this._fillStrokeStyles(controlOpts.styles.start);
                if (controlOpts.styles.start.hasOwnProperty('fillColor')) {
                    startOpts.fill = new ol.style.Fill({ color: controlOpts.styles.start.fillColor });
                }
                lengthOpts.styles.start = new ol.style.Style(startOpts);
            }
            if (controlOpts.styles.hasOwnProperty('finish')) {
                var finishOpts = {};
                finishOpts.stroke = this._fillStrokeStyles(controlOpts.styles.finish);
                if (controlOpts.styles.finish.hasOwnProperty('fillColor')) {
                    finishOpts.fill = new ol.style.Fill({ color: controlOpts.styles.finish.fillColor });
                }
                lengthOpts.styles.finish = new ol.style.Style(finishOpts);
            }
        }
        if (controlOpts.hasOwnProperty('geodesic')) {
            lengthOpts.geodesic = controlOpts.geodesic;
        }
        var control = new ol.control.MeasureLength(lengthOpts);
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype.addAreaControl = function (controlOpts) {
        var areaOpts = {};
        if (controlOpts.div) {
            areaOpts.target = controlOpts.div;
        }
        if (controlOpts.hasOwnProperty('styles')) {
            areaOpts.styles = {};
            if (controlOpts.styles.hasOwnProperty('pointer')) {
                areaOpts.styles.pointer = this._fillPointerStyles(controlOpts.styles.pointer);
            }
            if (controlOpts.styles.hasOwnProperty('start')) {
                var startOpts = {};
                startOpts.stroke = this._fillStrokeStyles(controlOpts.styles.start);
                if (controlOpts.styles.start.hasOwnProperty('fillColor')) {
                    startOpts.fill = new ol.style.Fill({ color: controlOpts.styles.start.fillColor });
                }
                areaOpts.styles.start = new ol.style.Style(startOpts);
            }
            if (controlOpts.styles.hasOwnProperty('finish')) {
                var finishOpts = {};
                finishOpts.stroke = this._fillStrokeStyles(controlOpts.styles.finish);
                if (controlOpts.styles.finish.hasOwnProperty('fillColor')) {
                    finishOpts.fill = new ol.style.Fill({ color: controlOpts.styles.finish.fillColor });
                }
                areaOpts.styles.finish = new ol.style.Style(finishOpts);
            }
        }
        if (controlOpts.hasOwnProperty('geodesic')) {
            areaOpts.geodesic = controlOpts.geodesic;
        }
        var control = new ol.control.MeasureArea(areaOpts);
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype.addAzimuthControl = function (controlOpts) {
        var azimuthOpts = {};
        if (controlOpts.div) {
            azimuthOpts.target = controlOpts.div;
        }
        if (controlOpts.hasOwnProperty('styles')) {
            azimuthOpts.styles = {};
            if (controlOpts.styles.hasOwnProperty('pointer')) {
                azimuthOpts.styles.pointer = this._fillPointerStyles(controlOpts.styles.pointer);
            }
            if (controlOpts.styles.hasOwnProperty('start')) {
                var startOpts = {};
                startOpts.stroke = this._fillStrokeStyles(controlOpts.styles.start);
                if (controlOpts.styles.start.hasOwnProperty('fillColor')) {
                    startOpts.fill = new ol.style.Fill({ color: controlOpts.styles.start.fillColor });
                }
                azimuthOpts.styles.start = new ol.style.Style(startOpts);
            }
            if (controlOpts.styles.hasOwnProperty('finish')) {
                var finishOpts = {};
                finishOpts.stroke = this._fillStrokeStyles(controlOpts.styles.finish);
                if (controlOpts.styles.finish.hasOwnProperty('fillColor')) {
                    finishOpts.fill = new ol.style.Fill({ color: controlOpts.styles.finish.fillColor });
                }
                azimuthOpts.styles.finish = new ol.style.Style(finishOpts);
            }
        }
        if (controlOpts.hasOwnProperty('geodesic')) {
            azimuthOpts.geodesic = controlOpts.geodesic;
        }
        var control = new ol.control.MeasureAzimuth(azimuthOpts);
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype.addElevationPathControl = function (controlOpts) {
        var elevOpts = {};
        if (controlOpts.div) {
            elevOpts.target = controlOpts.div;
        }
        if (controlOpts.styles) {
            elevOpts.stylesOptions = {};
            if (controlOpts.styles.hasOwnProperty('pointer')) {
                elevOpts.stylesOptions.draw = {};
                elevOpts.stylesOptions.draw.pointer = this._fillPointerStyles(controlOpts.styles.pointer);
            }
            if (controlOpts.styles.hasOwnProperty('start')) {
                if (!elevOpts.stylesOptions.draw) {
                    elevOpts.stylesOptions.draw = {};
                }
                elevOpts.stylesOptions.draw.start = this._fillStrokeStyles(controlOpts.styles.start);
            }
            if (controlOpts.styles.hasOwnProperty('finish')) {
                if (!elevOpts.stylesOptions.draw) {
                    elevOpts.stylesOptions.draw = {};
                }
                elevOpts.stylesOptions.draw.finish = this._fillStrokeStyles(controlOpts.styles.finish);
            }
            if (controlOpts.styles.hasOwnProperty('marker')) {
                var markerOpts = {};
                if (controlOpts.styles.marker.src) {
                    markerOpts.src = controlOpts.styles.marker.src;
                    markerOpts.anchor = [
                        controlOpts.styles.marker.xAnchor ? controlOpts.styles.marker.xAnchor : 0,
                        controlOpts.styles.marker.yAnchor ? controlOpts.styles.marker.yAnchor : 0
                    ];
                }
                if (Object.keys(markerOpts).length > 0) {
                    elevOpts.stylesOptions.marker = new ol.style.Icon(markerOpts);
                }
            }
        }
        if (controlOpts.elevationPathOptions) {
            elevOpts.elevationPathOptions = controlOpts.elevationPathOptions;
        }
        if (controlOpts.displayProfileOptions) {
            elevOpts.displayProfileOptions = controlOpts.displayProfileOptions;
        }
        var control = new ol.control.ElevationPath(elevOpts);
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype.addSearchControl = function (controlOpts) {
        var searchOpts = {};
        if (searchOpts.div) {
            searchOpts.target = controlOpts.div;
        }
        searchOpts.collapsed = controlOpts.maximised ? false : true;
        searchOpts.zoomTo = controlOpts.zoomTo || null;
        if (controlOpts.hasOwnProperty('resources')) {
            searchOpts.resources = {};
            if (controlOpts.resources.hasOwnProperty('geocode')) {
                searchOpts.resources.geocode = controlOpts.resources.geocode;
            }
            if (controlOpts.resources.hasOwnProperty('autocomplete')) {
                searchOpts.resources.autocomplete = controlOpts.resources.autocomplete;
            }
        }
        searchOpts.displayAdvancedSearch = controlOpts.hasOwnProperty('displayAdvancedSearch') && controlOpts.displayAdvancedSearch === true ? true : false;
        if (controlOpts.hasOwnProperty('advancedSearch')) {
            searchOpts.advancedSearch = controlOpts.advancedSearch;
        }
        if (controlOpts.hasOwnProperty('geocodeOptions')) {
            searchOpts.geocodeOptions = controlOpts.geocodeOptions;
        }
        if (controlOpts.hasOwnProperty('autocompleteOptions')) {
            searchOpts.autocompleteOptions = controlOpts.autocompleteOptions;
        }
        var control = new ol.control.SearchEngine(searchOpts);
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype.addReverseSearchControl = function (controlOpts) {
        var searchOpts = {};
        if (searchOpts.div) {
            searchOpts.target = controlOpts.div;
        }
        searchOpts.collapsed = controlOpts.maximised ? false : true;
        if (controlOpts.hasOwnProperty('resources')) {
            searchOpts.resources = controlOpts.resources;
        }
        if (controlOpts.hasOwnProperty('reverseGeocodeOptions')) {
            searchOpts.reverseGeocodeOptions = controlOpts.reverseGeocodeOptions;
        }
        if (controlOpts.hasOwnProperty('delimitations')) {
            searchOpts.delimitations = controlOpts.delimitations;
        }
        var control = new ol.control.ReverseGeocode(searchOpts);
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype.addDrawingControl = function (controlOpts) {
        var drawingOpts = {};
        if (controlOpts.div) {
            drawingOpts.target = controlOpts.div;
        }
        drawingOpts.collapsed = controlOpts.maximised ? false : true;
        if (controlOpts.hasOwnProperty('tools')) {
            drawingOpts.tools = controlOpts.tools;
        }
        if (controlOpts.hasOwnProperty('labels')) {
            drawingOpts.labels = controlOpts.labels;
        }
        if (controlOpts.hasOwnProperty('defaultStyles')) {
            drawingOpts.defaultStyles = controlOpts.defaultStyles;
        }
        if (controlOpts.hasOwnProperty('cursorStyle')) {
            drawingOpts.cursorStyle = controlOpts.cursorStyle;
        }
        if (controlOpts.hasOwnProperty('markersList') && Array.isArray(controlOpts.markersList) && controlOpts.markersList.length > 0) {
            drawingOpts.markersList = [];
            for (var i = 0; i < controlOpts.markersList.length; i++) {
                var mrk = controlOpts.markersList[i];
                if (!mrk.src) {
                    continue;
                }
                var ol3mrk = { src: mrk.src };
                if (mrk.xAnchor && mrk.yAnchor) {
                    ol3mrk.anchor = [
                        mrk.xAnchor,
                        mrk.yAnchor
                    ];
                }
                drawingOpts.markersList.push(ol3mrk);
            }
        }
        if (controlOpts.layer) {
            var ol3layers = this._getLayersObj([controlOpts.layer]);
            if (ol3layers && ol3layers.length > 0) {
                drawingOpts.layer = ol3layers[0];
            }
        }
        var control = new ol.control.Drawing(drawingOpts);
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype.addAttributionsControl = function (controlOpts) {
        var attOpts = {};
        if (controlOpts.div) {
            attOpts.target = controlOpts.div;
        }
        attOpts.collapsed = controlOpts.maximised ? false : true;
        var control = new ol.control.GeoportalAttribution(attOpts);
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype.addCameraControl = function (controlOpts) {
        return null;
    };
    OL3.prototype.addGetFeatureInfoControl = function (controlOpts) {
        var gfiOpts = {};
        gfiOpts.options = {};
        if (controlOpts.hasOwnProperty('options')) {
            if (controlOpts.options.hasOwnProperty('auto')) {
                gfiOpts.options.auto = controlOpts.options.auto;
            }
            if (controlOpts.options.hasOwnProperty('active')) {
                gfiOpts.options.active = controlOpts.options.active;
            }
            if (controlOpts.options.hasOwnProperty('hidden')) {
                gfiOpts.options.hidden = controlOpts.options.hidden;
            }
            if (controlOpts.options.hasOwnProperty('defaultEvent')) {
                gfiOpts.options.defaultEvent = controlOpts.options.defaultEvent;
            }
            if (controlOpts.options.hasOwnProperty('defaultInfoFormat')) {
                gfiOpts.options.defaultInfoFormat = controlOpts.options.defaultInfoFormat;
            }
            if (controlOpts.options.hasOwnProperty('cursorStyle')) {
                gfiOpts.options.cursorStyle = controlOpts.options.cursorStyle;
            }
            if (!controlOpts.options.hasOwnProperty('autoPanOptions')) {
                controlOpts.options.autoPanOptions = IMap.DEFAULT_AUTOPAN_OPTIONS;
            }
            gfiOpts.options.autoPan = controlOpts.options.autoPanOptions.autoPan;
            gfiOpts.options.autoPanAnimation = { duration: controlOpts.options.autoPanOptions.duration };
            gfiOpts.options.autoPanMargin = controlOpts.options.autoPanOptions.margin;
        }
        if (this.mapOptions && this.mapOptions.proxyUrl) {
            gfiOpts.options.proxyUrl = this.mapOptions.proxyUrl;
        }
        if (this.mapOptions && this.mapOptions.noProxyDomains) {
            gfiOpts.options.noProxyDomains = this.mapOptions.noProxyDomains;
        }
        gfiOpts.layers = [];
        for (var gfiLayerId in controlOpts.layers) {
            var gfiLayer = controlOpts.layers[gfiLayerId];
            for (var i = 0; i < this._layers.length; ++i) {
                var mapLayer = this._layers[i];
                if (gfiLayerId === mapLayer.id) {
                    if (!mapLayer.options.queryable) {
                        console.log('GetFeatureInfo layer \'' + gfiLayerId + '\' has not been added to control because this layer is not queryable.');
                    } else {
                        var layerConf = { obj: mapLayer.obj };
                        if (gfiLayer.event) {
                            layerConf.event = gfiLayer.event;
                        }
                        if (mapLayer.options.gfiFormat) {
                            layerConf.infoFormat = mapLayer.options.gfiFormat;
                        }
                        gfiOpts.layers.push(layerConf);
                        break;
                    }
                }
            }
        }
        var control = new ol.control.GetFeatureInfo(gfiOpts);
        this.libMap.addControl(control);
        return control;
    };
    OL3.prototype.removeControls = function (controlIds) {
        if (!controlIds || Array.isArray(controlIds) && controlIds.length == 0) {
            console.log('No control to remove.');
            return;
        }
        if (!Array.isArray(controlIds)) {
            controlIds = [controlIds];
        }
        var controlId = null;
        for (var i = 0; i < controlIds.length; i++) {
            controlId = controlIds[i];
            var idx = this._findRegisteredControl(controlId);
            if (idx >= 0) {
                this._controls.splice(idx, 1);
            }
            var olControl = this.getLibMapControl(controlId);
            if (!olControl) {
                console.log('Impossible to remove control [' + controlId + '] : not found or unhandled');
                continue;
            }
            if (controlId.toLowerCase() == 'graticule') {
                olControl.setMap(null);
                delete this.getLibMap().graticule;
                continue;
            }
            if (Array.isArray(olControl)) {
                return;
            }
            this.libMap.removeControl(olControl);
        }
    };
    OL3.prototype.getLibMapControl = function (controlId) {
        var foundOlControl = null;
        if (!OL3.CONTROLSCLASSES.hasOwnProperty(controlId.toLowerCase()) || !OL3.CONTROLSCLASSES[controlId.toLowerCase()]) {
            return foundOlControl;
        }
        var olControlClass = OL3.CONTROLSCLASSES[controlId.toLowerCase()];
        if (Array.isArray(olControlClass)) {
            var olInteractions = [];
            this.getLibMap().getInteractions().forEach(function (interaction) {
                for (var j = 0; j < olControlClass.length; j++) {
                    if (interaction instanceof olControlClass[j]) {
                        olInteractions.push(interaction);
                        break;
                    }
                }
            }, this);
            return olInteractions.length > 0 ? olInteractions : null;
        }
        if (controlId.toLowerCase() == 'graticule') {
            return this.getLibMap().hasOwnProperty('graticule') ? this.getLibMap().graticule : null;
        }
        var olControls = this.getLibMap().getControls().getArray();
        if (olControls.length == 0) {
            return foundOlControl;
        }
        for (var i = 0; i < olControls.length; i++) {
            var olControl = olControls[i];
            if (olControl instanceof olControlClass) {
                foundOlControl = olControl;
                break;
            }
        }
        return foundOlControl;
    };
    OL3.prototype._addMarkers = function (markersOptions) {
        if (!Array.isArray(markersOptions)) {
            console.log('Can not process markersOptions. It is not an Array.');
            return;
        }
        var mrkSource = null;
        var mrkLayer = null;
        var mo = null;
        var context = this;
        var ii = 0;
        var fopenPopup = function (evt) {
            var evtPx = context.getLibMap().getEventPixel(evt);
            ol.gp.GfiUtils.displayInfo(context.getLibMap(), context.getLibMap().getCoordinateFromPixel([
                evtPx[0] + this.mo.ppoffset[0],
                evtPx[1] + this.mo.ppoffset[1]
            ]), this.mo.content, this.mo.contentType, this.mo.autoPanOptions);
        };
        for (ii = 0; ii < markersOptions.length; ii++) {
            mo = markersOptions[ii];
            if (!mo.hasOwnProperty('content')) {
                mo.content = '';
            }
            if (!mo.hasOwnProperty('url')) {
                mo.url = ol.control.DefaultMarkers['lightOrange'];
            }
            if (!mo.hasOwnProperty('offset')) {
                mo.offset = ol.control.DefaultMarkers['defaultOffset'];
            }
            if (!mo.hasOwnProperty('ppoffset')) {
                mo.ppoffset = [
                    0,
                    -15
                ];
            }
            var needsLocated = false;
            if (!mo.hasOwnProperty('position')) {
                mo.position = {
                    x: this.libMap.getView().getCenter()[0],
                    y: this.libMap.getView().getCenter()[1]
                };
                needsLocated = true;
            }
            if (!mo.hasOwnProperty('contentType')) {
                mo.contentType = 'text/html';
            }
            if (!mo.hasOwnProperty('autoPanOptions')) {
                mo.autoPanOptions = {
                    autoPan: IMap.DEFAULT_AUTOPAN_OPTIONS.autoPan,
                    autoPanAnimation: { duration: IMap.DEFAULT_AUTOPAN_OPTIONS.duration },
                    autoPanMargin: IMap.DEFAULT_AUTOPAN_OPTIONS.margin
                };
            }
            var fcoords = [
                mo.position.x,
                mo.position.y
            ];
            if (mo.position.hasOwnProperty('projection')) {
                fcoords = ol.proj.transform(fcoords, mo.position.projection, this.getProjection());
            }
            var mrkImg = document.createElement('img');
            mrkImg.src = mo.url;
            mrkImg.mo = mo;
            var mrk = new ol.Overlay({
                position: fcoords,
                offset: mo.offset,
                element: mrkImg
            });
            this.libMap.addOverlay(mrk);
            if (needsLocated === true) {
                var gpMap = this;
                var changeCenter = function (locEvt) {
                    var fcoords = [
                        locEvt.position.x,
                        locEvt.position.y
                    ];
                    if (locEvt.position.hasOwnProperty('projection')) {
                        fcoords = ol.proj.transform(fcoords, locEvt.position.projection, gpMap.getProjection());
                    }
                    this.setPosition(fcoords);
                };
                this.listen('located', changeCenter, mrk);
                this.listen('geolocated', changeCenter, mrk);
            }
            mrkImg.addEventListener('click', fopenPopup, true);
            mrkImg.addEventListener('touchend', fopenPopup, true);
        }
    };
    OL3.prototype._getCommonLayerParams = function (ol3layerOpts) {
        var commonOpts = {};
        if (ol3layerOpts.hasOwnProperty('opacity')) {
            commonOpts.opacity = ol3layerOpts.opacity;
        }
        if (ol3layerOpts.hasOwnProperty('visible')) {
            commonOpts.visibility = ol3layerOpts.visible;
        }
        if (ol3layerOpts.hasOwnProperty('zIndex')) {
            commonOpts.position = ol3layerOpts.zIndex;
        }
        if (ol3layerOpts.hasOwnProperty('maxResolution')) {
            var minZoom = this._getZoomFromResolution(ol3layerOpts.maxResolution);
            commonOpts.minZoom = minZoom;
        }
        if (ol3layerOpts.hasOwnProperty('minResolution')) {
            var maxZoom = this._getZoomFromResolution(ol3layerOpts.minResolution);
            commonOpts.maxZoom = maxZoom;
        }
        return commonOpts;
    };
    OL3.prototype._applyCommonLayerParams = function (layerOpts) {
        var commonOpts = {};
        if (layerOpts.hasOwnProperty('opacity')) {
            commonOpts.opacity = layerOpts.opacity;
        }
        if (layerOpts.hasOwnProperty('visibility')) {
            commonOpts.visible = layerOpts.visibility;
        }
        if (layerOpts.hasOwnProperty('position')) {
            commonOpts.zIndex = layerOpts.position;
        }
        if (layerOpts.hasOwnProperty('maxZoom') && layerOpts.maxZoom >= 0 && layerOpts.maxZoom <= 20) {
            var minRes = this._getResolutionFromZoomLevel(layerOpts.maxZoom);
            commonOpts.minResolution = minRes;
        }
        if (layerOpts.hasOwnProperty('minZoom') && layerOpts.minZoom >= 0 && layerOpts.minZoom <= 20) {
            var maxRes = this._getResolutionFromZoomLevel(layerOpts.minZoom);
            commonOpts.maxResolution = maxRes;
        }
        if (layerOpts.hasOwnProperty('grayScaled')) {
            commonOpts.grayScaled = layerOpts.grayScaled;
        }
        return commonOpts;
    };
    OL3.prototype._checkLayerParams = function (layerOpts) {
        if (!IMap.prototype._checkLayerParams.apply(this, arguments)) {
            return false;
        }
        return true;
    };
    OL3.prototype._addRasterLayer = function (layerObj) {
        var layerId = Object.keys(layerObj)[0];
        var layerOpts = layerObj[layerId];
        var constructorOpts = this._applyCommonLayerParams(layerOpts);
        switch (layerOpts.format.toUpperCase()) {
        case 'WMS':
            var params = {};
            params.LAYERS = layerOpts.layers.join(',');
            if (layerOpts.version) {
                params.VERSION = layerOpts.version;
            }
            layerOpts.stylesNames = layerOpts.stylesNames || layerOpts.stylesName;
            if (layerOpts.stylesNames) {
                if (Array.isArray(layerOpts.stylesNames)) {
                    params.STYLES = layerOpts.stylesNames.join();
                } else {
                    console.log('\'stylesNames\' parameter should be an array of style names (string)');
                }
            }
            if (layerOpts.outputFormat) {
                params.FORMAT = layerOpts.outputFormat;
            }
            if (layerOpts.backgroundColor) {
                params.BGCOLOR = layerOpts.backgroundColor;
                params.TRANSPARENT = 'FALSE';
            } else {
                params.TRANSPARENT = 'TRUE';
            }
            var sourceOpts = {
                url: layerOpts.url,
                params: params
            };
            if (layerOpts.hasOwnProperty('projection')) {
                sourceOpts.projection = layerOpts.projection;
            }
            if (layerOpts.hasOwnProperty('tiled') && layerOpts.tiled === true) {
                constructorOpts.source = new ol.source.TileWMS(sourceOpts);
            } else {
                constructorOpts.source = new ol.source.ImageWMS(sourceOpts);
            }
            break;
        case 'WMTS':
            var lOpts = this._getWMTSDefaultOpts();
            for (var opt in layerOpts) {
                lOpts[opt] = layerOpts[opt];
            }
            layerOpts = lOpts;
            var sourceOpts = {
                url: layerOpts.url,
                layer: layerOpts.layer,
                matrixSet: layerOpts.tileMatrixSet,
                format: layerOpts.outputFormat,
                version: layerOpts.version,
                style: layerOpts.styleName,
                tileGrid: new ol.tilegrid.WMTS({
                    origin: [
                        layerOpts.topLeftCorner.x,
                        layerOpts.topLeftCorner.y
                    ],
                    resolutions: layerOpts.resolutions,
                    matrixIds: layerOpts.matrixIds
                })
            };
            if (layerOpts.url.indexOf('{TileMatrixSet}') > 0 || layerOpts.url.indexOf('{TileRow}') > 0 || layerOpts.url.indexOf('{TileCol}') > 0) {
                sourceOpts.requestEncoding = 'REST';
            } else {
                sourceOpts.requestEncoding = 'KVP';
            }
            constructorOpts.source = new ol.source.WMTSExtended(sourceOpts);
            break;
        case 'OSM':
            constructorOpts.source = new ol.source.OSM({ url: layerOpts.url });
            break;
        default:
        }
        if (constructorOpts.hasOwnProperty('source')) {
            if (layerOpts.hasOwnProperty('originators')) {
                constructorOpts.source._originators = layerOpts.originators;
            }
            var layer = null;
            if (layerOpts.format.toUpperCase() == 'WMS' && (!layerOpts.hasOwnProperty('tiled') || layerOpts.tiled !== true)) {
                layer = new ol.layer.Image(constructorOpts);
            } else {
                layer = new ol.layer.Tile(constructorOpts);
            }
            if (constructorOpts.hasOwnProperty('zIndex') && constructorOpts.zIndex === 0) {
                layer._forceNullzIndex = true;
            }
            var gpLayer = {
                id: layerId,
                obj: layer,
                options: layerOpts
            };
            if (layerOpts.hasOwnProperty('grayScaled') && layerOpts.grayScaled) {
                this._colorGrayscaleLayerSwitch(gpLayer, true);
            }
            this._layers.push(gpLayer);
            this.libMap.addLayer(gpLayer.obj);
            this._addLayerConfToLayerSwitcher(gpLayer.obj, layerOpts);
        }
    };
    OL3.prototype._addVectorLayer = function (layerObj) {
        var layerId = Object.keys(layerObj)[0];
        var layerOpts = layerObj[layerId];
        var constructorOpts = this._applyCommonLayerParams(layerOpts);
        var layerStyleOptions = layerOpts.styleOptions || {};
        var defaultMapOptions = this.mapOptions.defaultFeaturesStyle || {};
        var defaultOptions = IMap.DEFAULT_VECTORLAYERS_STYLES;
        var styleOptions = {};
        styleOptions.image = new ol.style.Icon({
            src: layerStyleOptions.markerSrc || defaultMapOptions.markerSrc || defaultOptions.markerSrc,
            anchor: [
                layerStyleOptions.markerXAnchor || defaultMapOptions.markerXAnchor || defaultOptions.markerXAnchor,
                layerStyleOptions.markerYAnchor || defaultMapOptions.markerYAnchor || defaultOptions.markerYAnchor
            ],
            anchorOrigin: 'top-left',
            anchorXUnits: 'pixels',
            anchorYUnits: 'pixels'
        });
        styleOptions.stroke = new ol.style.Stroke({
            color: IMap._hexToRgba(layerStyleOptions.strokeColor || defaultMapOptions.strokeColor || defaultOptions.strokeColor, layerStyleOptions.strokeOpacity || defaultMapOptions.strokeOpacity || defaultOptions.strokeOpacity),
            width: layerStyleOptions.strokeWidth || defaultMapOptions.strokeWidth || defaultOptions.strokeWidth
        });
        styleOptions.fill = new ol.style.Fill({ color: IMap._hexToRgba(layerStyleOptions.polyFillColor || defaultMapOptions.polyFillColor || defaultOptions.polyFillColor, layerStyleOptions.polyFillOpacity || defaultMapOptions.polyFillOpacity || defaultOptions.polyFillOpacity) });
        styleOptions.text = new ol.style.Text({
            font: '16px Sans',
            textAlign: 'left',
            fill: new ol.style.Fill({ color: IMap._hexToRgba(layerStyleOptions.textColor || defaultMapOptions.textColor || defaultOptions.textColor, 1) })
        });
        if (layerStyleOptions.textStrokeColor) {
            styleOptions.text.stroke = new ol.style.Stroke({
                color: IMap._hexToRgba(layerStyleOptions.textStrokeColor || defaultMapOptions.textStrokeColor || defaultOptions.textStrokeColor, 1),
                width: 1
            });
        }
        var vectorStyle = new ol.style.Style(styleOptions);
        switch (layerOpts.format.toUpperCase()) {
        case 'KML':
            var urlKml = this.setProxy(layerOpts.url);
            var formatKml = new ol.format.KMLExtended({
                extractStyles: layerOpts.extractStyles,
                showPointNames: layerOpts.showPointNames,
                defaultStyle: [vectorStyle]
            });
            constructorOpts.source = new ol.source.Vector({
                features: new ol.Collection(),
                loader: function (extent, resolution, projectionFeature) {
                    Gp.Protocols.XHR.call({
                        url: urlKml,
                        method: 'GET',
                        timeOut: 15000,
                        onResponse: function (response) {
                            var projectionData = formatKml.readProjection(response);
                            var features = formatKml.readFeatures(response, {
                                dataProjection: projectionData,
                                featureProjection: projectionFeature
                            });
                            if (features.length > 0) {
                                constructorOpts.source.addFeatures(features);
                            }
                        },
                        onFailure: function (error) {
                            console.log('[ol.control.LayerImport] Kml/Gpx request failed : ', error);
                        }
                    });
                }
            });
            break;
        case 'GPX':
            constructorOpts.source = new ol.source.Vector({
                url: this.setProxy(layerOpts.url),
                format: new ol.format.GPX()
            });
            constructorOpts.style = vectorStyle;
            break;
        case 'GEORSS':
            break;
        case 'GEOJSON':
            constructorOpts.source = new ol.source.Vector({
                url: this.setProxy(layerOpts.url),
                format: new ol.format.GeoJSON()
            });
            constructorOpts.style = vectorStyle;
            break;
        case 'WFS':
            var maxFeatures = '';
            var sld = '';
            if (!layerOpts.version) {
                layerOpts.version = '2.0.0';
            }
            if (!layerOpts.outputFormat) {
                layerOpts.outputFormat = 'application/json';
            }
            if (layerOpts.maxFeatures) {
                if (parseInt(layerOpts.version.charAt(0)) < 2) {
                    maxFeatures = '&maxFeatures=' + layerOpts.maxFeatures;
                } else {
                    maxFeatures = '&count=' + layerOpts.maxFeatures;
                }
            }
            if (layerOpts.sld) {
                sld = '&sld=' + layerOpts.sld;
            }
            var layerUrl = this.setProxy(layerOpts.url);
            var oflc = layerOpts.outputFormat.toLowerCase();
            var format = null;
            var formatOptions = {};
            if (layerOpts.projection) {
                formatOptions['defaultDataProjection'] = layerOpts.projection;
                formatOptions['srsName'] = layerOpts.projection;
            }
            if (oflc.indexOf('gml') > 0 || oflc.indexOf('xml') > 0) {
                if (oflc.indexOf('2.1') > 0 || oflc.indexOf('gml2') > 0) {
                    format = new ol.format.GML2(formatOptions);
                } else {
                    format = new ol.format.GML3(formatOptions);
                }
            } else {
                format = new ol.format.GeoJSON(formatOptions);
            }
            constructorOpts.source = new ol.source.Vector({
                format: format,
                url: function (extent, resolution, projection) {
                    return layerUrl + '?service=WFS&request=GetFeature' + '&version=' + layerOpts.version + '&typename=' + layerOpts.typeNames + '&outputFormat=' + layerOpts.outputFormat + '&srsname=' + projection.getCode() + '&bbox=' + extent.join(',') + ',' + projection.getCode() + maxFeatures + sld;
                },
                strategy: ol.loadingstrategy.bbox
            });
            break;
        case 'drawing':
            constructorOpts.source = new ol.source.Vector({});
            break;
        default:
        }
        if (constructorOpts.hasOwnProperty('source')) {
            if (layerOpts.hasOwnProperty('originators')) {
                constructorOpts.source._originators = layerOpts.originators;
            }
            var layer = new ol.layer.Vector(constructorOpts);
            this._layers.push({
                id: layerId,
                obj: layer,
                options: layerOpts
            });
            this.libMap.addLayer(layer);
            this._addLayerConfToLayerSwitcher(layer, layerOpts);
            var _map = this.libMap;
            var _vectorSource = constructorOpts.source;
            if (_map.getView() && _map.getSize() && _vectorSource.getExtent) {
                var _fit = layerOpts.zoomToExtent || false;
                if (_fit) {
                    var key = _vectorSource.on('change', function () {
                        var _sourceExtent = _vectorSource.getExtent();
                        var _stateExtent = _vectorSource.getState();
                        if (_stateExtent === 'ready' && _sourceExtent[0] !== Infinity) {
                            ol.Observable.unByKey(key);
                            _map.getView().fit(_sourceExtent, { maxZoom: 18 });
                        }
                    });
                    setTimeout(function () {
                        _vectorSource.dispatchEvent('change');
                    }, 100);
                }
            }
        }
    };
    OL3.prototype._addGeoportalLayer = function (layerObj) {
        var layerId = Object.keys(layerObj)[0];
        var layerOpts = layerObj[layerId];
        var olParams = {};
        if (layerOpts.hasOwnProperty('opacity')) {
            olParams.opacity = layerOpts.opacity;
        }
        if (layerOpts.hasOwnProperty('visibility')) {
            olParams.visible = layerOpts.visibility;
        }
        if (layerOpts.hasOwnProperty('position')) {
            olParams.zIndex = layerOpts.position;
        }
        if (layerOpts.hasOwnProperty('minZoom') && layerOpts.minZoom >= 0 && layerOpts.minZoom <= 28) {
            olParams.maxResolution = this._getResolutionFromZoomLevel(layerOpts.minZoom);
        }
        if (layerOpts.hasOwnProperty('maxZoom') && layerOpts.maxZoom >= 0 && layerOpts.maxZoom <= 28) {
            olParams.minResolution = this._getResolutionFromZoomLevel(layerOpts.maxZoom);
        }
        var LayerClass = null;
        switch (layerOpts.format.toUpperCase()) {
        case 'WMTS':
            LayerClass = ol.layer.GeoportalWMTS;
            break;
        case 'WMS':
            LayerClass = ol.layer.GeoportalWMS;
            break;
        default:
            console.log('addGeoportalLayer : no class found for ' + layerOpts.format);
        }
        var olLayer = new LayerClass({
            layer: layerId,
            olParams: olParams
        });
        if (layerOpts.hasOwnProperty('originators')) {
            olLayer.getSource()._originators = layerOpts.originators;
        }
        if (olParams.hasOwnProperty('zIndex') && olParams.zIndex === 0) {
            olLayer._forceNullzIndex = true;
        }
        this._layers.push({
            id: layerId,
            obj: olLayer,
            options: layerOpts
        });
        this.libMap.addLayer(olLayer);
        this._addLayerConfToLayerSwitcher(olLayer, layerOpts);
    };
    OL3.prototype.removeLayers = function (layerIds) {
        if (!IMap.prototype.removeLayers.apply(this, arguments)) {
            return false;
        }
        var _layers = this._getLayersObj(layerIds);
        _layers.forEach(function (_layer, i, array) {
            this.libMap.removeLayer(_layer.obj);
        }, this);
    };
    OL3.prototype.modifyLayers = function (layersOptions) {
        if (!IMap.prototype.modifyLayers.apply(this, arguments)) {
            return false;
        }
        var layerIds = Object.keys(layersOptions);
        var _layerObjs = this._getLayersObj(layerIds);
        _layerObjs.forEach(function (_layerObj) {
            var commonOpts = this._applyCommonLayerParams(layersOptions[_layerObj.id]);
            if (commonOpts.hasOwnProperty('opacity')) {
                _layerObj.obj.setOpacity(commonOpts.opacity);
            }
            if (commonOpts.hasOwnProperty('visible')) {
                _layerObj.obj.setVisible(commonOpts.visible);
            }
            if (commonOpts.hasOwnProperty('zIndex')) {
                _layerObj.obj.setZIndex(commonOpts.zIndex);
                if (commonOpts.zIndex === 0) {
                    _layerObj.obj._forceNullzIndex = true;
                }
                if (commonOpts.zIndex !== 0 && _layerObj.obj._forceNullzIndex) {
                    _layerObj.obj._forceNullzIndex = false;
                }
            }
            if (commonOpts.hasOwnProperty('minResolution')) {
                _layerObj.obj.setMinResolution(commonOpts.minResolution);
            }
            if (commonOpts.hasOwnProperty('maxResolution')) {
                _layerObj.obj.setMaxResolution(commonOpts.maxResolution);
            }
            if (commonOpts.hasOwnProperty('grayScaled')) {
                this._changeLayerColor(_layerObj.id, commonOpts.grayScaled);
            }
        }, this);
    };
    OL3.prototype.getProjection = function () {
        return this.libMap.getView().getProjection().getCode();
    };
    OL3.prototype.getCenter = function () {
        var center = {
            x: this.libMap.getView().getCenter()[0],
            y: this.libMap.getView().getCenter()[1]
        };
        return center;
    };
    OL3.prototype.getViewExtent = function (projection) {
        var bbox = {};
        if (this.libMap && this.libMap.getView()) {
            var extent = this.libMap.getView().calculateExtent(this.libMap.getSize());
            var mapProj = this.libMap.getView().getProjection().getCode();
            if (projection && projection != mapProj) {
                extent = ol.proj.transformExtent(extent, mapProj, projection);
            }
            bbox.left = extent[0];
            bbox.right = extent[2];
            bbox.bottom = extent[1];
            bbox.top = extent[3];
        }
        return bbox;
    };
    OL3.prototype.getAzimuth = function () {
        return this.libMap.getView().getRotation() * 180 / Math.PI;
    };
    OL3.prototype.getZoom = function () {
        return this._getZoomFromResolution(this.getResolution());
    };
    OL3.prototype.getResolution = function () {
        return this.libMap.getView().getResolution();
    };
    OL3.prototype.getLibMap = function () {
        return this.libMap;
    };
    OL3.prototype.setProjection = function (projection) {
        var view = new ol.View({
            center: this.libMap.getView().getCenter(),
            projection: projection,
            rotation: this.libMap.getView().getRotation(),
            zoom: this.getZoom()
        });
        this.libMap.setView(view);
    };
    OL3.prototype.setXYCenter = function (point) {
        if (!point.hasOwnProperty('x') || !point.hasOwnProperty('y')) {
            console.log('no valid coordinates for map center');
            return;
        }
        var center = [
            point.x,
            point.y
        ];
        var mapProj = this.libMap.getView().getProjection().getCode();
        if (point.projection && point.projection != mapProj) {
            center = ol.proj.transform(center, point.projection, mapProj);
        }
        this.libMap.getView().setCenter(center);
    };
    OL3.prototype.setAutoCenter = function (point, zoom) {
        this.setXYCenter(point, zoom);
    };
    OL3.prototype.setAzimuth = function (azimuth) {
        this.libMap.getView().setRotation(azimuth * Math.PI / 180);
    };
    OL3.prototype.setZoom = function (zoom) {
        this.libMap.getView().setZoom(zoom);
    };
    OL3.prototype.setResolution = function (resolution) {
        this.libMap.getView().setResolution(resolution);
    };
    OL3.prototype.zoomIn = function () {
        this.libMap.getView().setZoom(this.getZoom() + 1);
    };
    OL3.prototype.zoomOut = function () {
        this.libMap.getView().setZoom(this.getZoom() - 1);
    };
    OL3.prototype._getLayerOpts = function (layerObj, layersStack) {
        var layerOpts = null;
        layersStack = layersStack || this._layers;
        for (var i = 0; i < layersStack.length; i++) {
            var l = layersStack[i];
            if (l.obj === layerObj) {
                layerOpts = {};
                layerOpts[l.id] = l.options;
                break;
            }
        }
        return layerOpts;
    };
    OL3.prototype._registerUnknownLayer = function (layerObj) {
        var layerId = 'unknownLayer';
        if (layerObj.hasOwnProperty('gpResultLayerId')) {
            layerId = layerObj.gpResultLayerId;
        }
        layerId += '-' + Date.now();
        var options = {};
        if (layerId.indexOf('drawing-') === 0) {
            options.format = 'drawing';
        } else if (layerId.indexOf('layerimport:KML') === 0) {
            options.format = 'KML';
        } else if (layerId.indexOf('layerimport:GPX') === 0) {
            options.format = 'GPX';
        } else if (layerId.indexOf('layerimport:GeoJSON') === 0) {
            options.format = 'GeoJSON';
        } else if (layerId.indexOf('layerimport:WMS') === 0) {
            options.format = 'WMS';
            if (layerObj.gpGFIparams) {
                if (layerObj.gpGFIparams.queryable) {
                    options.queryable = true;
                }
                if (Array.isArray(layerObj.gpGFIparams.formats)) {
                    options.gfiFormat = layerObj.gpGFIparams.formats[0];
                    for (var i = 0; i < layerObj.gpGFIparams.formats.length; i++) {
                        if (layerObj.gpGFIparams.formats[i] === 'text/html') {
                            options.gfiFormat = 'text/html';
                            break;
                        }
                    }
                }
            }
        } else if (layerId.indexOf('layerimport:WMTS') === 0) {
            options.format = 'WMTS';
        }
        this._layers.push({
            id: layerId,
            obj: layerObj,
            options: options
        });
        var layerOpts = {};
        layerOpts[layerId] = {};
        return layerOpts;
    };
    OL3.prototype.getLSLayerContainerDivId = function (layerId) {
        var id = null;
        var idxLS = this._findRegisteredControl('layerswitcher');
        if (idxLS < 0) {
            return id;
        }
        var ol3layers = this._getLayersObj([layerId]);
        if (ol3layers.length > 0) {
            var ol3ls = this._controls[idxLS].obj;
            return ol3ls.getLayerDOMId(ol3layers[0].obj);
        }
        return id;
    };
    OL3.prototype.listen = function (eventId, action, context) {
        if (!IMap.prototype.listen.apply(this, arguments)) {
            return false;
        }
        context = context || this;
        var map = this;
        var olEventKey = null;
        switch (eventId) {
        case 'mapLoaded':
            break;
        case 'mapFailure':
            break;
        case 'located':
            break;
        case 'geolocated':
            break;
        case 'configured':
            break;
        case 'centerChanged':
            olEventKey = this.libMap.getView().on('change:center', function (ol3evt) {
                var centerChangedEvt = {};
                if (ol3evt.oldValue) {
                    centerChangedEvt.oldCenter = {
                        x: ol3evt.oldValue[0],
                        y: ol3evt.oldValue[1]
                    };
                }
                centerChangedEvt.newCenter = {
                    x: this.libMap.getView().getCenter()[0],
                    y: this.libMap.getView().getCenter()[1]
                };
                action.call(context, centerChangedEvt);
            }, this);
            break;
        case 'zoomChanged':
            olEventKey = this.libMap.getView().on('change:resolution', function (ol3evt) {
                action.call(context, {
                    oldZoom: this._getZoomFromResolution(ol3evt.oldValue),
                    newZoom: this._getZoomFromResolution(this.libMap.getView().getResolution())
                });
            }, this);
            break;
        case 'azimuthChanged':
            olEventKey = this.libMap.getView().on('change:rotation', function (ol3evt) {
                action.call(context, {
                    oldAzimuth: ol3evt.oldValue * 180 / Math.PI,
                    newAzimuth: this.libMap.getView().getRotation() * 180 / Math.PI
                });
            }, this);
            break;
        case 'tiltChanged':
            break;
        case 'projectionChanged':
            break;
        case 'layerChanged':
            olEventKey = this.libMap.getLayers().on('add', function (ol3evt) {
                var ladded = ol3evt.element;
                var layerOpts = this._getLayerOpts(ladded);
                if (!layerOpts) {
                    layerOpts = this._registerUnknownLayer(ladded);
                }
                action.call(context, {
                    layerAdded: layerOpts,
                    position: ladded.getZIndex()
                });
            }, this);
            this._registerEvent(olEventKey, eventId, action, context);
            olEventKey = this.libMap.getLayers().on('remove', function (ol3evt) {
                var lremoved = ol3evt.element;
                var layerOpts = this._getLayerOpts(lremoved) || this._getLayerOpts(lremoved, this._layersRemoved);
                var self = context.getLibMap();
                if (self.featuresOverlay && layerOpts[self.featuresOverlay.getId()]) {
                    self.removeOverlay(self.featuresOverlay);
                    self.featuresOverlay = null;
                }
                action.call(context, { layerRemoved: layerOpts });
            }, this);
            this._registerEvent(olEventKey, eventId, action, context);
            olEventKey = null;
            for (var obsProperty in OL3.LAYERPROPERTIES) {
                this.libMap.getLayers().forEach(function (olLayer, i, array) {
                    var layerOpts = this._getLayerOpts(olLayer);
                    if (obsProperty === 'grayScaled') {
                        var layerChangeGrayScaledCallBack = function (evt) {
                            action.call(context, {
                                property: 'grayScaled',
                                oldValue: evt.detail.oldValue,
                                newValue: evt.detail.newValue,
                                layerChanged: layerOpts
                            });
                        };
                        var registredEvent = map._registerEvent(layerChangeGrayScaledCallBack, eventId, action, context);
                        registredEvent.eventOrigin = olLayer;
                        registredEvent.eventType = 'changed:' + obsProperty;
                        registredEvent.eventOrigin.addEventListener(registredEvent.eventType, layerChangeGrayScaledCallBack, this);
                    } else {
                        olEventKey = olLayer.on('change:' + obsProperty, function (ol3evt) {
                            var oldOl3obj = {};
                            oldOl3obj[ol3evt.key] = ol3evt.oldValue;
                            var oldCommonProp = map._getCommonLayerParams(oldOl3obj);
                            var newOl3obj = {};
                            newOl3obj[ol3evt.key] = this.get(ol3evt.key);
                            var newCommonProp = map._getCommonLayerParams(newOl3obj);
                            action.call(context, {
                                property: OL3.LAYERPROPERTIES[ol3evt.key],
                                oldValue: oldCommonProp[OL3.LAYERPROPERTIES[ol3evt.key]],
                                newValue: newCommonProp[OL3.LAYERPROPERTIES[ol3evt.key]],
                                layerChanged: layerOpts
                            });
                        }, olLayer);
                        this._registerEvent(olEventKey, eventId, action, context);
                        olEventKey = null;
                    }
                }, map);
            }
            break;
        case 'controlChanged':
            break;
        default:
            console.log('unhandled event : ' + eventId);
        }
        if (olEventKey) {
            this._registerEvent(olEventKey, eventId, action, context);
        }
        return true;
    };
    OL3.prototype.forget = function (eventId, action) {
        if (!IMap.prototype.forget.apply(this, arguments)) {
            return false;
        }
        var rEvents = this._events[eventId];
        if (!rEvents) {
            console.log('nothing to forget for : ' + eventId);
            return false;
        }
        var evKey = null;
        for (var i = rEvents.length - 1; i >= 0; i--) {
            if (rEvents[i].action == action) {
                evKey = rEvents[i].key;
                rEvents.splice(i, 1);
                ol.Observable.unByKey(evKey);
            }
        }
    };
    OL3.prototype._changeLayerColor = function (layerId, toGrayScale) {
        var layerIndex = this._getLayerIndexByLayerId(layerId);
        var gpLayer = this._layers[layerIndex];
        switch (gpLayer.options.format.toUpperCase()) {
        case 'KML':
        case 'GPX':
        case 'WFS':
        case 'drawing':
            console.log('[OL3.prototype._changeLayerColor] warning : _changeLayerColor not allowed on vector layers (layer id: ' + layerId + ')');
            return;
        }
        this._colorGrayscaleLayerSwitch(gpLayer, toGrayScale);
        var event = IMap.CustomEvent('change:grayScaled', {
            detail: {
                oldValue: !toGrayScale,
                newValue: toGrayScale
            }
        });
        gpLayer.obj.dispatchEvent(event);
    };
    OL3.prototype._colorGrayscaleLayerSwitch = function (gpLayer, toGrayScale) {
        function getGrayScaledDataUrl(img) {
            img.crossOrigin = null;
            var canvas = document.createElement('canvas');
            var ctx = canvas.getContext('2d');
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            var imageData = ctx.getImageData(0, 0, img.width, img.height);
            var data = imageData.data;
            for (var i = 0; i < data.length; i += 4) {
                var avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                data[i] = avg;
                data[i + 1] = avg;
                data[i + 2] = avg;
            }
            ctx.putImageData(imageData, 0, 0);
            return canvas.toDataURL();
        }
        function convertImagetoGrayScale(image, context) {
            var dataUrl = getGrayScaledDataUrl(image);
            image.src = '';
            image.onload = function () {
                context.changed();
            };
            image.src = dataUrl;
        }
        function imageloadstartHandler(evt) {
            evt.image.getImage().crossOrigin = 'Anonymous';
        }
        function tileloadstartHandler(evt) {
            evt.tile.getImage().crossOrigin = 'Anonymous';
        }
        function imageloadendHandler(evt) {
            convertImagetoGrayScale(evt.image.getImage(), evt.target);
        }
        function tileloadendHandler(evt) {
            convertImagetoGrayScale(evt.tile.getImage(), evt.target);
        }
        var source = gpLayer.obj.getSource();
        if (toGrayScale) {
            if (source instanceof ol.source.ImageWMS) {
                source.loadstartListenerKey = source.on('imageloadstart', imageloadstartHandler);
                source.loadendListenerKey = source.on('imageloadend', imageloadendHandler);
            } else {
                source.loadstartListenerKey = source.on('tileloadstart', tileloadstartHandler);
                source.loadendListenerKey = source.on('tileloadend', tileloadendHandler);
            }
        } else {
            ol.Observable.unByKey(source.loadstartListenerKey);
            ol.Observable.unByKey(source.loadendListenerKey);
            source.loadstartListenerKey = null;
            source.loadendListenerKey = null;
        }
        source.refresh();
    };
    OL3.prototype._manageLayerChangedEvent = function () {
        if (this._events.hasOwnProperty('layerChanged')) {
            var layerChangedArray = [];
            this._events['layerChanged'].forEach(function (eventObj) {
                layerChangedArray.push(eventObj);
            }, this);
            layerChangedArray.forEach(function (eventObj) {
                this.forget('layerChanged', eventObj.action);
                this.listen('layerChanged', eventObj.action, eventObj.context);
            }, this);
            layerChangedArray = null;
        }
    };
    return OL3;
}(UtilsLoggerByDefault, ol, gp, IMap);
Map = function (Logger, require) {
    var Map = {
        load: function (div, mapOptions) {
            if (!div) {
                throw new Error('missing parameter div !');
            }
            if (typeof div == 'string') {
                div = document.getElementById(div);
            }
            if (!div) {
                throw new Error('HTML element with id [' + div + '] not found.');
            }
            if (!mapOptions) {
                mapOptions = {};
            }
            if (!mapOptions.hasOwnProperty('library')) {
                mapOptions.library = 'ol3';
            }
            var OL3 = null;
            var VG = null;
            var IT = null;
            if (this.__classOl !== null && typeof this.__classOl === 'function') {
                OL3 = this.__classOl;
            }
            if (this.__classVg !== null && typeof this.__classVg === 'function') {
                VG = this.__classVg;
            }
            if (this.__classItowns !== null && typeof this.__classItowns === 'function') {
                IT = this.__classItowns;
            }
            var objMap = null;
            var library = mapOptions.library;
            switch (library) {
            case 'ol3':
                if (OL3 === null || typeof OL3 !== 'function') {
                    throw new Error('library ol is not loaded !');
                }
                objMap = new OL3({
                    div: div,
                    mapOptions: mapOptions
                });
                break;
            case 'vg':
                if (VG === null || typeof VG !== 'function') {
                    throw new Error('library vg is not loaded !');
                }
                objMap = new VG({
                    div: div,
                    mapOptions: mapOptions
                });
                break;
            case 'itowns':
                if (IT === null || typeof IT !== 'function') {
                    throw new Error('library itowns is not loaded !');
                }
                objMap = new IT({
                    div: div,
                    mapOptions: mapOptions
                });
                break;
            default:
                throw new Error('not supported library');
            }
            this._prototype = Object.getPrototypeOf(objMap);
            return objMap;
        }
    };
    var center = {};
    var point = {};
    var centerChangedEvent = {};
    var zoomChangedEvent = {};
    var azimuthChangedEvent = {};
    var layerChangedEvent = {};
    var geolocatedEvent = {};
    var locatedEvent = {};
    var configuredEvent = {};
    var mapLoadedEvent = {};
    var mapOptions = {};
    var markerOptions = {};
    var autoPanOptions = {};
    var layerOptions = {};
    var controlOptions = {};
    var styleOptions = {};
    return Map;
}(UtilsLoggerByDefault, {});
AHN = function (Map, require) {
    var scope = typeof window !== 'undefined' ? window : {};
    var Gp = scope.Gp || {};
    Gp.Map = Map;
    if (typeof ol3OL3 !== 'undefined' && typeof virtualVG !== 'undefined') {
        console.log('Lib. ol3 et virtualgeo détectées !');
        Gp.Map.__classOl = ol3OL3;
        Gp.Map.__classVg = virtualVG;
        Gp.Map._class = Gp.Map.__classOl.prototype;
    } else if (typeof ol3OL3 !== 'undefined' && typeof it2IT !== 'undefined') {
        console.log('Lib. ol3 et itowns détectées !');
        Gp.Map.__classOl = ol3OL3;
        Gp.Map.__classItowns = it2IT;
        Gp.Map._class = Gp.Map.__classOl.prototype;
    } else if (typeof ol3OL3 !== 'undefined') {
        console.log('Lib. ol3 détectée !');
        Gp.Map.__classOl = ol3OL3;
        Gp.Map._class = Gp.Map.__classOl.prototype;
    } else if (typeof virtualVG !== 'undefined') {
        console.log('Lib. virtualgeo détectée !');
        Gp.Map.__classVg = virtualVG;
        Gp.Map._class = Gp.Map.__classVg.prototype;
    } else if (typeof it2IT !== 'undefined') {
        console.log('Lib. itowns détectée !');
        Gp.Map.__classItowns = it2IT;
        Gp.Map._class = Gp.Map.__classItowns.prototype;
    } else {
        console.log('Aucune lib. détectée !?');
    }
    Gp.sdkVersion = '1.0.0';
    Gp.sdkDate = '2017-12-21';
    scope.Gp = Gp;
    return scope.Gp;
}(Map, {});
window.ol = ol;
/* END CODE   */

return Gp;
}));
